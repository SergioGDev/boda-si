(self.webpackChunkboda_si=self.webpackChunkboda_si||[]).push([[825],{5825:(Gg,Fa,de)=>{"use strict";de.r(Fa),de.d(Fa,{DashboardModule:()=>V0});var Nt=de(6895),io=de(529),c=de(4650),d=de(5254),zt=de(6498),dr=de(6688),ui=de(4850),jt=de(7830);function Se(...o){if(1===o.length){const l=o[0];if((0,dr.k)(l))return Ki(l,null);if((0,jt.K)(l)&&Object.getPrototypeOf(l)===Object.prototype){const e=Object.keys(l);return Ki(e.map(a=>l[a]),e)}}if("function"==typeof o[o.length-1]){const l=o.pop();return Ki(o=1===o.length&&(0,dr.k)(o[0])?o[0]:o,null).pipe((0,ui.U)(e=>l(...e)))}return Ki(o,null)}function Ki(o,l){return new zt.y(e=>{const a=o.length;if(0===a)return void e.complete();const _=new Array(a);let C=0,F=0;for(let G=0;G<a;G++){const ot=(0,d.D)(o[G]);let yt=!1;e.add(ot.subscribe({next:Ht=>{yt||(yt=!0,F++),_[G]=Ht},error:Ht=>e.error(Ht),complete:()=>{C++,(C===a||!yt)&&(F===a&&e.next(l?l.reduce((Ht,he,Si)=>(Ht[he]=_[Si],Ht),{}):_),e.complete())}}))}})}function Qi(o){return null==o||("string"==typeof o||Array.isArray(o))&&0===o.length}function ro(o){return null!=o&&"number"==typeof o.length}const Uo=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Or{static min(l){return function Ts(o){return l=>{if(Qi(l.value)||Qi(o))return null;const e=parseFloat(l.value);return!isNaN(e)&&e<o?{min:{min:o,actual:l.value}}:null}}(l)}static max(l){return function ks(o){return l=>{if(Qi(l.value)||Qi(o))return null;const e=parseFloat(l.value);return!isNaN(e)&&e>o?{max:{max:o,actual:l.value}}:null}}(l)}static required(l){return function pr(o){return Qi(o.value)?{required:!0}:null}(l)}static requiredTrue(l){return function oo(o){return!0===o.value?null:{required:!0}}(l)}static email(l){return function Gn(o){return Qi(o.value)||Uo.test(o.value)?null:{email:!0}}(l)}static minLength(l){return function Lr(o){return l=>Qi(l.value)||!ro(l.value)?null:l.value.length<o?{minlength:{requiredLength:o,actualLength:l.value.length}}:null}(l)}static maxLength(l){return function gn(o){return l=>ro(l.value)&&l.value.length>o?{maxlength:{requiredLength:o,actualLength:l.value.length}}:null}(l)}static pattern(l){return function jo(o){if(!o)return hi;let l,e;return"string"==typeof o?(e="","^"!==o.charAt(0)&&(e+="^"),e+=o,"$"!==o.charAt(o.length-1)&&(e+="$"),l=new RegExp(e)):(e=o.toString(),l=o),a=>{if(Qi(a.value))return null;const _=a.value;return l.test(_)?null:{pattern:{requiredPattern:e,actualValue:_}}}}(l)}static nullValidator(l){return null}static compose(l){return Ho(l)}static composeAsync(l){return Ds(l)}}function hi(o){return null}function zi(o){return null!=o}function Wn(o){return(0,c.QGY)(o)?(0,d.D)(o):o}function cn(o){let l={};return o.forEach(e=>{l=null!=e?{...l,...e}:l}),0===Object.keys(l).length?null:l}function Xn(o,l){return l.map(e=>e(o))}function so(o){return o.map(l=>function fr(o){return!o.validate}(l)?l:e=>l.validate(e))}function Ho(o){if(!o)return null;const l=o.filter(zi);return 0==l.length?null:function(e){return cn(Xn(e,l))}}function Ds(o){if(!o)return null;const l=o.filter(zi);return 0==l.length?null:function(e){return Se(Xn(e,l).map(Wn)).pipe((0,ui.U)(cn))}}function gr(o){return o?Array.isArray(o)?o:[o]:[]}function _n(o,l){return Array.isArray(o)?o.includes(l):o===l}function yn(o,l){const e=gr(l);return gr(o).forEach(_=>{_n(e,_)||e.push(_)}),e}function ao(o,l){return gr(l).filter(e=>!_n(o,e))}const Fi="VALID",Br="INVALID",Y="PENDING",P="DISABLED";function z(o){return(ft(o)?o.validators:o)||null}function W(o){return Array.isArray(o)?function Nn(o){return null!=o?Ho(so(o)):null}(o):o||null}function Q(o,l){return(ft(l)?l.asyncValidators:o)||null}function ut(o){return Array.isArray(o)?function mr(o){return null!=o?Ds(so(o)):null}(o):o||null}function ft(o){return null!=o&&!Array.isArray(o)&&"object"==typeof o}function pt(o,l,e){const a=o.controls;if(!(l?Object.keys(a):a).length)throw new c.vHH(1e3,"");if(!a[e])throw new c.vHH(1001,"")}function ht(o,l,e){o._forEachChild((a,_)=>{if(void 0===e[_])throw new c.vHH(1002,"")})}class gt{constructor(l,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=l,this._rawAsyncValidators=e,this._composedValidatorFn=W(this._rawValidators),this._composedAsyncValidatorFn=ut(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(l){this._rawValidators=this._composedValidatorFn=l}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(l){this._rawAsyncValidators=this._composedAsyncValidatorFn=l}get parent(){return this._parent}get valid(){return this.status===Fi}get invalid(){return this.status===Br}get pending(){return this.status==Y}get disabled(){return this.status===P}get enabled(){return this.status!==P}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(l){this._rawValidators=l,this._composedValidatorFn=W(l)}setAsyncValidators(l){this._rawAsyncValidators=l,this._composedAsyncValidatorFn=ut(l)}addValidators(l){this.setValidators(yn(l,this._rawValidators))}addAsyncValidators(l){this.setAsyncValidators(yn(l,this._rawAsyncValidators))}removeValidators(l){this.setValidators(ao(l,this._rawValidators))}removeAsyncValidators(l){this.setAsyncValidators(ao(l,this._rawAsyncValidators))}hasValidator(l){return _n(this._rawValidators,l)}hasAsyncValidator(l){return _n(this._rawAsyncValidators,l)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(l={}){this.touched=!0,this._parent&&!l.onlySelf&&this._parent.markAsTouched(l)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(l=>l.markAllAsTouched())}markAsUntouched(l={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}markAsDirty(l={}){this.pristine=!1,this._parent&&!l.onlySelf&&this._parent.markAsDirty(l)}markAsPristine(l={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}markAsPending(l={}){this.status=Y,!1!==l.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!l.onlySelf&&this._parent.markAsPending(l)}disable(l={}){const e=this._parentMarkedDirty(l.onlySelf);this.status=P,this.errors=null,this._forEachChild(a=>{a.disable({...l,onlySelf:!0})}),this._updateValue(),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...l,skipPristineCheck:e}),this._onDisabledChange.forEach(a=>a(!0))}enable(l={}){const e=this._parentMarkedDirty(l.onlySelf);this.status=Fi,this._forEachChild(a=>{a.enable({...l,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent}),this._updateAncestors({...l,skipPristineCheck:e}),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(l){this._parent&&!l.onlySelf&&(this._parent.updateValueAndValidity(l),l.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(l){this._parent=l}getRawValue(){return this.value}updateValueAndValidity(l={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Fi||this.status===Y)&&this._runAsyncValidator(l.emitEvent)),!1!==l.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!l.onlySelf&&this._parent.updateValueAndValidity(l)}_updateTreeValidity(l={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(l)),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?P:Fi}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(l){if(this.asyncValidator){this.status=Y,this._hasOwnPendingAsyncValidator=!0;const e=Wn(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(a=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(a,{emitEvent:l})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(l,e={}){this.errors=l,this._updateControlsErrors(!1!==e.emitEvent)}get(l){let e=l;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((a,_)=>a&&a._find(_),this)}getError(l,e){const a=e?this.get(e):this;return a&&a.errors?a.errors[l]:null}hasError(l,e){return!!this.getError(l,e)}get root(){let l=this;for(;l._parent;)l=l._parent;return l}_updateControlsErrors(l){this.status=this._calculateStatus(),l&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(l)}_initObservables(){this.valueChanges=new c.vpe,this.statusChanges=new c.vpe}_calculateStatus(){return this._allControlsDisabled()?P:this.errors?Br:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Y)?Y:this._anyControlsHaveStatus(Br)?Br:Fi}_anyControlsHaveStatus(l){return this._anyControls(e=>e.status===l)}_anyControlsDirty(){return this._anyControls(l=>l.dirty)}_anyControlsTouched(){return this._anyControls(l=>l.touched)}_updatePristine(l={}){this.pristine=!this._anyControlsDirty(),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}_updateTouched(l={}){this.touched=this._anyControlsTouched(),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}_registerOnCollectionChange(l){this._onCollectionChange=l}_setUpdateStrategy(l){ft(l)&&null!=l.updateOn&&(this._updateOn=l.updateOn)}_parentMarkedDirty(l){return!l&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(l){return null}}class Dt extends gt{constructor(l,e,a){super(z(e),Q(a,e)),this.controls=l,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(l,e){return this.controls[l]?this.controls[l]:(this.controls[l]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(l,e,a={}){this.registerControl(l,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(l,e={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(l,e,a={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],e&&this.registerControl(l,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(l){return this.controls.hasOwnProperty(l)&&this.controls[l].enabled}setValue(l,e={}){ht(this,0,l),Object.keys(l).forEach(a=>{pt(this,!0,a),this.controls[a].setValue(l[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(l,e={}){null!=l&&(Object.keys(l).forEach(a=>{const _=this.controls[a];_&&_.patchValue(l[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(l={},e={}){this._forEachChild((a,_)=>{a.reset(l[_],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(l,e,a)=>(l[a]=e.getRawValue(),l))}_syncPendingControls(){let l=this._reduceChildren(!1,(e,a)=>!!a._syncPendingControls()||e);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){Object.keys(this.controls).forEach(e=>{const a=this.controls[e];a&&l(a,e)})}_setUpControls(){this._forEachChild(l=>{l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(l){for(const[e,a]of Object.entries(this.controls))if(this.contains(e)&&l(a))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,a,_)=>((a.enabled||this.disabled)&&(e[_]=a.value),e))}_reduceChildren(l,e){let a=l;return this._forEachChild((_,C)=>{a=e(a,_,C)}),a}_allControlsDisabled(){for(const l of Object.keys(this.controls))if(this.controls[l].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(l){return this.controls.hasOwnProperty(l)?this.controls[l]:null}}function di(o,l){const e=o.indexOf(l);e>-1&&o.splice(e,1)}function Kl(o){return"object"==typeof o&&null!==o&&2===Object.keys(o).length&&"value"in o&&"disabled"in o}const Qn=class extends gt{constructor(l=null,e,a){super(z(e),Q(a,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(l),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ft(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=Kl(l)?l.value:l)}setValue(l,e={}){this.value=this._pendingValue=l,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(a=>a(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(l,e={}){this.setValue(l,e)}reset(l=this.defaultValue,e={}){this._applyFormState(l),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(l){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(l){this._onChange.push(l)}_unregisterOnChange(l){di(this._onChange,l)}registerOnDisabledChange(l){this._onDisabledChange.push(l)}_unregisterOnDisabledChange(l){di(this._onDisabledChange,l)}_forEachChild(l){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(l){Kl(l)?(this.value=this._pendingValue=l.value,l.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=l}};let Wo=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({}),o})();const ec=new c.OlP("NgModelWithFormControlWarning");let Uh=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Wo]}),o})(),qs=(()=>{class o{static withConfig(e){return{ngModule:o,providers:[{provide:ec,useValue:e.warnOnNgModelWithFormControl}]}}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Uh]}),o})();class il extends gt{constructor(l,e,a){super(z(e),Q(a,e)),this.controls=l,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(l){return this.controls[this._adjustIndex(l)]}push(l,e={}){this.controls.push(l),this._registerControl(l),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(l,e,a={}){this.controls.splice(l,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:a.emitEvent})}removeAt(l,e={}){let a=this._adjustIndex(l);a<0&&(a=0),this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),this.controls.splice(a,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(l,e,a={}){let _=this._adjustIndex(l);_<0&&(_=0),this.controls[_]&&this.controls[_]._registerOnCollectionChange(()=>{}),this.controls.splice(_,1),e&&(this.controls.splice(_,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(l,e={}){ht(this,0,l),l.forEach((a,_)=>{pt(this,!1,_),this.at(_).setValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(l,e={}){null!=l&&(l.forEach((a,_)=>{this.at(_)&&this.at(_).patchValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(l=[],e={}){this._forEachChild((a,_)=>{a.reset(l[_],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(l=>l.getRawValue())}clear(l={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:l.emitEvent}))}_adjustIndex(l){return l<0?l+this.length:l}_syncPendingControls(){let l=this.controls.reduce((e,a)=>!!a._syncPendingControls()||e,!1);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){this.controls.forEach((e,a)=>{l(e,a)})}_updateValue(){this.value=this.controls.filter(l=>l.enabled||this.disabled).map(l=>l.value)}_anyControls(l){return this.controls.some(e=>e.enabled&&l(e))}_setUpControls(){this._forEachChild(l=>this._registerControl(l))}_allControlsDisabled(){for(const l of this.controls)if(l.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(l){l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)}_find(l){return this.at(l)??null}}function ac(o){return!!o&&(void 0!==o.asyncValidators||void 0!==o.validators||void 0!==o.updateOn)}let lc=(()=>{class o{constructor(){this.useNonNullable=!1}get nonNullable(){const e=new o;return e.useNonNullable=!0,e}group(e,a=null){const _=this._reduceControls(e);let C={};return ac(a)?C=a:null!==a&&(C.validators=a.validator,C.asyncValidators=a.asyncValidator),new Dt(_,C)}control(e,a,_){let C={};return this.useNonNullable?(ac(a)?C=a:(C.validators=a,C.asyncValidators=_),new Qn(e,{...C,nonNullable:!0})):new Qn(e,a,_)}array(e,a,_){const C=e.map(F=>this._createControl(F));return new il(C,a,_)}_reduceControls(e){const a={};return Object.keys(e).forEach(_=>{a[_]=this._createControl(e[_])}),a}_createControl(e){return e instanceof Qn||e instanceof gt?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac,providedIn:qs}),o})();var ae=de(8929),Qo=de(591),jn=de(6787),pi=de(2198),_o=de(2868);const cc={provide:c.tb,useFactory:function bu(o,l){return()=>{if((0,Nt.NF)(l)){const e=Array.from(o.querySelectorAll(`[class*=${uc}]`)),a=/\bflex-layout-.+?\b/g;e.forEach(_=>{_.classList.contains(`${uc}ssr`)&&_.parentNode?_.parentNode.removeChild(_):_.className.replace(a,"")})}}},deps:[Nt.K0,c.Lbi],multi:!0},uc="flex-layout-";let $s=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({providers:[cc]}),o})();class Nr{constructor(l=!1,e="all",a="",_="",C=0){this.matches=l,this.mediaQuery=e,this.mqAlias=a,this.suffix=_,this.priority=C,this.property=""}clone(){return new Nr(this.matches,this.mediaQuery,this.mqAlias,this.suffix)}}let rl=(()=>{class o{constructor(){this.stylesheet=new Map}addStyleToElement(e,a,_){const C=this.stylesheet.get(e);C?C.set(a,_):this.stylesheet.set(e,new Map([[a,_]]))}clearStyles(){this.stylesheet.clear()}getStyleForElement(e,a){const _=this.stylesheet.get(e);let C="";if(_){const F=_.get(a);("number"==typeof F||"string"==typeof F)&&(C=F+"")}return C}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})();const hc={addFlexToParent:!0,addOrientationBps:!1,disableDefaultBps:!1,disableVendorPrefixes:!1,serverLoaded:!1,useColumnBasisZero:!0,printWithBreakpoints:[],mediaTriggerAutoRestore:!0,ssrObserveBreakpoints:[]},dn=new c.OlP("Flex Layout token, config options for the library",{providedIn:"root",factory:()=>hc}),yo=new c.OlP("FlexLayoutServerLoaded",{providedIn:"root",factory:()=>!1}),ts=new c.OlP("Flex Layout token, collect all breakpoints into one provider",{providedIn:"root",factory:()=>null});function dc(o,l){return o=o?o.clone():new Nr,l&&(o.mqAlias=l.alias,o.mediaQuery=l.mediaQuery,o.suffix=l.suffix,o.priority=l.priority),o}const es="inline",wu=["row","column","row-reverse","column-reverse"];function pc(o){if(o)switch(o.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":o="wrap-reverse";break;case"no":case"none":case"nowrap":o="nowrap";break;default:o="wrap"}return o}let ei=(()=>{class o{constructor(e,a,_,C){this.elementRef=e,this.styleBuilder=a,this.styler=_,this.marshal=C,this.DIRECTIVE_KEY="",this.inputs=[],this.mru={},this.destroySubject=new ae.xQ,this.styleCache=new Map}get parentElement(){return this.elementRef.nativeElement.parentElement}get nativeElement(){return this.elementRef.nativeElement}get activatedValue(){return this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY)}set activatedValue(e){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,this.marshal.activatedAlias)}ngOnChanges(e){Object.keys(e).forEach(a=>{if(-1!==this.inputs.indexOf(a)){const _=a.split(".").slice(1).join(".");this.setValue(e[a].currentValue,_)}})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete(),this.marshal.releaseElement(this.nativeElement)}init(e=[]){this.marshal.init(this.elementRef.nativeElement,this.DIRECTIVE_KEY,this.updateWithValue.bind(this),this.clearStyles.bind(this),e)}addStyles(e,a){const _=this.styleBuilder,C=_.shouldCache;let F=this.styleCache.get(e);(!F||!C)&&(F=_.buildStyles(e,a),C&&this.styleCache.set(e,F)),this.mru=Object.assign({},F),this.applyStyleToElement(F),_.sideEffect(e,F,a)}clearStyles(){Object.keys(this.mru).forEach(e=>{this.mru[e]=""}),this.applyStyleToElement(this.mru),this.mru={}}triggerUpdate(){this.marshal.triggerUpdate(this.nativeElement,this.DIRECTIVE_KEY)}getFlexFlowDirection(e,a=!1){if(e){const[_,C]=this.styler.getFlowDirection(e);if(!C&&a){const F=function ol(o){let[l,e,a]=function Cu(o){o=o?o.toLowerCase():"";let[l,e,a]=o.split(" ");return wu.find(_=>_===l)||(l=wu[0]),e===es&&(e=a!==es?a:"",a=es),[l,pc(e),!!a]}(o);return function fc(o,l=null,e=!1){return{display:e?"inline-flex":"flex","box-sizing":"border-box","flex-direction":o,"flex-wrap":l||null}}(l,e,a)}(_);this.styler.applyStyleToElements(F,[e])}return _.trim()}return"row"}hasWrap(e){return this.styler.hasWrap(e)}applyStyleToElement(e,a,_=this.nativeElement){this.styler.applyStyleToElement(_,e,a)}setValue(e,a){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,a)}updateWithValue(e){this.currentValue!==e&&(this.addStyles(e),this.currentValue=e)}}return o.\u0275fac=function(e){c.$Z()},o.\u0275dir=c.lG2({type:o,features:[c.TTD]}),o})();const Hh=[{alias:"xs",mediaQuery:"screen and (min-width: 0px) and (max-width: 599.98px)",priority:1e3},{alias:"sm",mediaQuery:"screen and (min-width: 600px) and (max-width: 959.98px)",priority:900},{alias:"md",mediaQuery:"screen and (min-width: 960px) and (max-width: 1279.98px)",priority:800},{alias:"lg",mediaQuery:"screen and (min-width: 1280px) and (max-width: 1919.98px)",priority:700},{alias:"xl",mediaQuery:"screen and (min-width: 1920px) and (max-width: 4999.98px)",priority:600},{alias:"lt-sm",overlapping:!0,mediaQuery:"screen and (max-width: 599.98px)",priority:950},{alias:"lt-md",overlapping:!0,mediaQuery:"screen and (max-width: 959.98px)",priority:850},{alias:"lt-lg",overlapping:!0,mediaQuery:"screen and (max-width: 1279.98px)",priority:750},{alias:"lt-xl",overlapping:!0,priority:650,mediaQuery:"screen and (max-width: 1919.98px)"},{alias:"gt-xs",overlapping:!0,mediaQuery:"screen and (min-width: 600px)",priority:-950},{alias:"gt-sm",overlapping:!0,mediaQuery:"screen and (min-width: 960px)",priority:-850},{alias:"gt-md",overlapping:!0,mediaQuery:"screen and (min-width: 1280px)",priority:-750},{alias:"gt-lg",overlapping:!0,mediaQuery:"screen and (min-width: 1920px)",priority:-650}],Mu="(orientation: portrait) and (max-width: 599.98px)",Au="(orientation: landscape) and (max-width: 959.98px)",Ys="(orientation: portrait) and (min-width: 600px) and (max-width: 839.98px)",mc="(orientation: landscape) and (min-width: 960px) and (max-width: 1279.98px)",gc="(orientation: portrait) and (min-width: 840px)",sl="(orientation: landscape) and (min-width: 1280px)",Hn={HANDSET:`${Mu}, ${Au}`,TABLET:`${Ys} , ${mc}`,WEB:`${gc}, ${sl} `,HANDSET_PORTRAIT:`${Mu}`,TABLET_PORTRAIT:`${Ys} `,WEB_PORTRAIT:`${gc}`,HANDSET_LANDSCAPE:`${Au}`,TABLET_LANDSCAPE:`${mc}`,WEB_LANDSCAPE:`${sl}`},Su=[{alias:"handset",priority:2e3,mediaQuery:Hn.HANDSET},{alias:"handset.landscape",priority:2e3,mediaQuery:Hn.HANDSET_LANDSCAPE},{alias:"handset.portrait",priority:2e3,mediaQuery:Hn.HANDSET_PORTRAIT},{alias:"tablet",priority:2100,mediaQuery:Hn.TABLET},{alias:"tablet.landscape",priority:2100,mediaQuery:Hn.TABLET_LANDSCAPE},{alias:"tablet.portrait",priority:2100,mediaQuery:Hn.TABLET_PORTRAIT},{alias:"web",priority:2200,mediaQuery:Hn.WEB,overlapping:!0},{alias:"web.landscape",priority:2200,mediaQuery:Hn.WEB_LANDSCAPE,overlapping:!0},{alias:"web.portrait",priority:2200,mediaQuery:Hn.WEB_PORTRAIT,overlapping:!0}],yc=/(\.|-|_)/g;function al(o){let l=o.length>0?o.charAt(0):"",e=o.length>1?o.slice(1):"";return l.toUpperCase()+e}function Eu(o,l=[]){const e={};return o.forEach(a=>{e[a.alias]=a}),l.forEach(a=>{e[a.alias]?function _c(o,...l){if(null==o)throw TypeError("Cannot convert undefined or null to object");for(let e of l)if(null!=e)for(let a in e)e.hasOwnProperty(a)&&(o[a]=e[a])}(e[a.alias],a):e[a.alias]=a}),function Ws(o){return o.forEach(l=>{l.suffix||(l.suffix=function wr(o){return o.replace(yc,"|").split("|").map(al).join("")}(l.alias),l.overlapping=!!l.overlapping)}),o}(Object.keys(e).map(a=>e[a]))}const xo=new c.OlP("Token (@angular/flex-layout) Breakpoints",{providedIn:"root",factory:()=>{const o=(0,c.f3M)(ts),l=(0,c.f3M)(dn),e=[].concat.apply([],(o||[]).map(_=>Array.isArray(_)?_:[_]));return Eu((l.disableDefaultBps?[]:Hh).concat(l.addOrientationBps?Su:[]),e)}});function ir(o,l){return(l&&l.priority||0)-(o&&o.priority||0)}function Tu(o,l){return(o.priority||0)-(l.priority||0)}let vo=(()=>{class o{constructor(e){this.findByMap=new Map,this.items=[...e].sort(Tu)}findByAlias(e){return e?this.findWithPredicate(e,a=>a.alias==e):null}findByQuery(e){return this.findWithPredicate(e,a=>a.mediaQuery==e)}get overlappings(){return this.items.filter(e=>1==e.overlapping)}get aliases(){return this.items.map(e=>e.alias)}get suffixes(){return this.items.map(e=>e.suffix?e.suffix:"")}findWithPredicate(e,a){let _=this.findByMap.get(e);return _||(_=this.items.find(a)||null,this.findByMap.set(e,_)),_||null}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(xo))},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o((0,c.LFG)(xo))},token:o,providedIn:"root"}),o})(),Re=(()=>{class o{constructor(e,a,_){this._zone=e,this._platformId=a,this._document=_,this.source=new Qo.X(new Nr(!0)),this.registry=new Map,this.pendingRemoveListenerFns=[],this._observable$=this.source.asObservable()}get activations(){const e=[];return this.registry.forEach((a,_)=>{a.matches&&e.push(_)}),e}isActive(e){const a=this.registry.get(e);return a?a.matches:this.registerQuery(e).some(_=>_.matches)}observe(e,a=!1){if(e&&e.length){const _=this._observable$.pipe((0,pi.h)(F=>!a||e.indexOf(F.mediaQuery)>-1)),C=new zt.y(F=>{const G=this.registerQuery(e);if(G.length){const ot=G.pop();G.forEach(yt=>{F.next(yt)}),this.source.next(ot)}F.complete()});return(0,jn.T)(C,_)}return this._observable$}registerQuery(e){const a=Array.isArray(e)?e:[e],_=[];return function ku(o,l){const e=o.filter(a=>!is[a]);if(e.length>0){const a=e.join(", ");try{const _=l.createElement("style");_.setAttribute("type","text/css"),_.styleSheet||_.appendChild(l.createTextNode(`\n/*\n  @angular/flex-layout - workaround for possible browser quirk with mediaQuery listeners\n  see http://bit.ly/2sd4HMP\n*/\n@media ${a} {.fx-query-test{ }}\n`)),l.head.appendChild(_),e.forEach(C=>is[C]=_)}catch(_){console.error(_)}}}(a,this._document),a.forEach(C=>{const F=ot=>{this._zone.run(()=>this.source.next(new Nr(ot.matches,C)))};let G=this.registry.get(C);G||(G=this.buildMQL(C),G.addListener(F),this.pendingRemoveListenerFns.push(()=>G.removeListener(F)),this.registry.set(C,G)),G.matches&&_.push(new Nr(!0,C))}),_}ngOnDestroy(){let e;for(;e=this.pendingRemoveListenerFns.pop();)e()}buildMQL(e){return function Xs(o,l){return l&&window.matchMedia("all").addListener?window.matchMedia(o):{matches:"all"===o||""===o,media:o,addListener:()=>{},removeListener:()=>{},onchange:null,addEventListener(){},removeEventListener(){},dispatchEvent:()=>!1}}(e,(0,Nt.NF)(this._platformId))}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(c.R0b),c.LFG(c.Lbi),c.LFG(Nt.K0))},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o((0,c.LFG)(c.R0b),(0,c.LFG)(c.Lbi),(0,c.LFG)(Nt.K0))},token:o,providedIn:"root"}),o})();const is={},Ur="print",ns={alias:Ur,mediaQuery:Ur,priority:1e3};let ll=(()=>{class o{constructor(e,a,_){this.breakpoints=e,this.layoutConfig=a,this._document=_,this.registeredBeforeAfterPrintHooks=!1,this.isPrintingBeforeAfterEvent=!1,this.beforePrintEventListeners=[],this.afterPrintEventListeners=[],this.isPrinting=!1,this.queue=new cl,this.deactivations=[]}withPrintQuery(e){return[...e,Ur]}isPrintEvent(e){return e.mediaQuery.startsWith(Ur)}get printAlias(){return this.layoutConfig.printWithBreakpoints||[]}get printBreakPoints(){return this.printAlias.map(e=>this.breakpoints.findByAlias(e)).filter(e=>null!==e)}getEventBreakpoints({mediaQuery:e}){const a=this.breakpoints.findByQuery(e);return(a?[...this.printBreakPoints,a]:this.printBreakPoints).sort(ir)}updateEvent(e){let a=this.breakpoints.findByQuery(e.mediaQuery);return this.isPrintEvent(e)&&(a=this.getEventBreakpoints(e)[0],e.mediaQuery=a?a.mediaQuery:""),dc(e,a)}registerBeforeAfterPrintHooks(e){if(!this._document.defaultView||this.registeredBeforeAfterPrintHooks)return;this.registeredBeforeAfterPrintHooks=!0;const a=()=>{this.isPrinting||(this.isPrintingBeforeAfterEvent=!0,this.startPrinting(e,this.getEventBreakpoints(new Nr(!0,Ur))),e.updateStyles())},_=()=>{this.isPrintingBeforeAfterEvent=!1,this.isPrinting&&(this.stopPrinting(e),e.updateStyles())};this._document.defaultView.addEventListener("beforeprint",a),this._document.defaultView.addEventListener("afterprint",_),this.beforePrintEventListeners.push(a),this.afterPrintEventListeners.push(_)}interceptEvents(e){return this.registerBeforeAfterPrintHooks(e),a=>{this.isPrintEvent(a)?a.matches&&!this.isPrinting?(this.startPrinting(e,this.getEventBreakpoints(a)),e.updateStyles()):!a.matches&&this.isPrinting&&!this.isPrintingBeforeAfterEvent&&(this.stopPrinting(e),e.updateStyles()):this.collectActivations(a)}}blockPropagation(){return e=>!(this.isPrinting||this.isPrintEvent(e))}startPrinting(e,a){this.isPrinting=!0,e.activatedBreakpoints=this.queue.addPrintBreakpoints(a)}stopPrinting(e){e.activatedBreakpoints=this.deactivations,this.deactivations=[],this.queue.clear(),this.isPrinting=!1}collectActivations(e){if(!this.isPrinting||this.isPrintingBeforeAfterEvent)if(e.matches)this.isPrintingBeforeAfterEvent||(this.deactivations=[]);else{const a=this.breakpoints.findByQuery(e.mediaQuery);a&&(this.deactivations.push(a),this.deactivations.sort(ir))}}ngOnDestroy(){this._document.defaultView&&(this.beforePrintEventListeners.forEach(e=>this._document.defaultView.removeEventListener("beforeprint",e)),this.afterPrintEventListeners.forEach(e=>this._document.defaultView.removeEventListener("afterprint",e)))}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(vo),c.LFG(dn),c.LFG(Nt.K0))},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o((0,c.LFG)(vo),(0,c.LFG)(dn),(0,c.LFG)(Nt.K0))},token:o,providedIn:"root"}),o})();class cl{constructor(){this.printBreakpoints=[]}addPrintBreakpoints(l){return l.push(ns),l.sort(ir),l.forEach(e=>this.addBreakpoint(e)),this.printBreakpoints}addBreakpoint(l){l&&void 0===this.printBreakpoints.find(a=>a.mediaQuery===l.mediaQuery)&&(this.printBreakpoints=function rs(o){return!!o&&o.mediaQuery.startsWith(Ur)}(l)?[l,...this.printBreakpoints]:[...this.printBreakpoints,l])}clear(){this.printBreakpoints=[]}}function $t(o){for(let l in o){let e=o[l]||"";switch(l){case"display":o.display="flex"===e?["-webkit-flex","flex"]:"inline-flex"===e?["-webkit-inline-flex","inline-flex"]:e;break;case"align-items":case"align-self":case"align-content":case"flex":case"flex-basis":case"flex-flow":case"flex-grow":case"flex-shrink":case"flex-wrap":case"justify-content":o["-webkit-"+l]=e;break;case"flex-direction":e=e||"row",o["-webkit-flex-direction"]=e,o["flex-direction"]=e;break;case"order":o.order=o["-webkit-"+l]=isNaN(+e)?"0":e}}return o}let ze=(()=>{class o{constructor(e,a,_,C){this._serverStylesheet=e,this._serverModuleLoaded=a,this._platformId=_,this.layoutConfig=C}applyStyleToElement(e,a,_=null){let C={};"string"==typeof a&&(C[a]=_,a=C),C=this.layoutConfig.disableVendorPrefixes?a:$t(a),this._applyMultiValueStyleToElement(C,e)}applyStyleToElements(e,a=[]){const _=this.layoutConfig.disableVendorPrefixes?e:$t(e);a.forEach(C=>{this._applyMultiValueStyleToElement(_,C)})}getFlowDirection(e){const a="flex-direction";let _=this.lookupStyle(e,a);return[_||"row",this.lookupInlineStyle(e,a)||(0,Nt.PM)(this._platformId)&&this._serverModuleLoaded?_:""]}hasWrap(e){return"wrap"===this.lookupStyle(e,"flex-wrap")}lookupAttributeValue(e,a){return e.getAttribute(a)||""}lookupInlineStyle(e,a){return(0,Nt.NF)(this._platformId)?e.style.getPropertyValue(a):this._getServerStyle(e,a)}lookupStyle(e,a,_=!1){let C="";return e&&((C=this.lookupInlineStyle(e,a))||((0,Nt.NF)(this._platformId)?_||(C=getComputedStyle(e).getPropertyValue(a)):this._serverModuleLoaded&&(C=this._serverStylesheet.getStyleForElement(e,a)))),C?C.trim():""}_applyMultiValueStyleToElement(e,a){Object.keys(e).sort().forEach(_=>{const C=e[_],F=Array.isArray(C)?C:[C];F.sort();for(let G of F)G=G?G+"":"",(0,Nt.NF)(this._platformId)||!this._serverModuleLoaded?(0,Nt.NF)(this._platformId)?a.style.setProperty(_,G):this._setServerStyle(a,_,G):this._serverStylesheet.addStyleToElement(a,_,G)})}_setServerStyle(e,a,_){a=a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();const C=this._readStyleAttribute(e);C[a]=_||"",this._writeStyleAttribute(e,C)}_getServerStyle(e,a){return this._readStyleAttribute(e)[a]||""}_readStyleAttribute(e){const a={},_=e.getAttribute("style");if(_){const C=_.split(/;+/g);for(let F=0;F<C.length;F++){const G=C[F].trim();if(G.length>0){const ot=G.indexOf(":");if(-1===ot)throw new Error(`Invalid CSS style: ${G}`);a[G.substr(0,ot).trim()]=G.substr(ot+1).trim()}}}return a}_writeStyleAttribute(e,a){let _="";for(const C in a)a[C]&&(_+=C+":"+a[C]+";");e.setAttribute("style",_)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(rl),c.LFG(yo),c.LFG(c.Lbi),c.LFG(dn))},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o((0,c.LFG)(rl),(0,c.LFG)(yo),(0,c.LFG)(c.Lbi),(0,c.LFG)(dn))},token:o,providedIn:"root"}),o})();class vi{constructor(){this.shouldCache=!0}sideEffect(l,e,a){}}function hl(o,l="1",e="1"){let a=[l,e,o],_=o.indexOf("calc");if(_>0){a[2]=os(o.substring(_).trim());let C=o.substr(0,_).trim().split(" ");2==C.length&&(a[0]=C[0],a[1]=C[1])}else if(0==_)a[2]=os(o.trim());else{let C=o.split(" ");a=3===C.length?C:[l,e,o]}return a}function os(o){return o.replace(/[\s]/g,"").replace(/[\/\*\+\-]/g," $& ")}let je=(()=>{class o{constructor(e,a,_){this.matchMedia=e,this.breakpoints=a,this.hook=_,this.activatedBreakpoints=[],this.elementMap=new Map,this.elementKeyMap=new WeakMap,this.watcherMap=new WeakMap,this.updateMap=new WeakMap,this.clearMap=new WeakMap,this.subject=new ae.xQ,this.observeActivations()}get activatedAlias(){return this.activatedBreakpoints[0]?this.activatedBreakpoints[0].alias:""}onMediaChange(e){const a=this.findByQuery(e.mediaQuery);a&&((e=dc(e,a)).matches&&-1===this.activatedBreakpoints.indexOf(a)?(this.activatedBreakpoints.push(a),this.activatedBreakpoints.sort(ir),this.updateStyles()):!e.matches&&-1!==this.activatedBreakpoints.indexOf(a)&&(this.activatedBreakpoints.splice(this.activatedBreakpoints.indexOf(a),1),this.activatedBreakpoints.sort(ir),this.updateStyles()))}init(e,a,_,C,F=[]){dl(this.updateMap,e,a,_),dl(this.clearMap,e,a,C),this.buildElementKeyMap(e,a),this.watchExtraTriggers(e,a,F)}getValue(e,a,_){const C=this.elementMap.get(e);if(C){const F=void 0!==_?C.get(_):this.getActivatedValues(C,a);if(F)return F.get(a)}}hasValue(e,a){const _=this.elementMap.get(e);if(_){const C=this.getActivatedValues(_,a);if(C)return void 0!==C.get(a)||!1}return!1}setValue(e,a,_,C){let F=this.elementMap.get(e);if(F){const ot=(F.get(C)||new Map).set(a,_);F.set(C,ot),this.elementMap.set(e,F)}else F=(new Map).set(C,(new Map).set(a,_)),this.elementMap.set(e,F);const G=this.getValue(e,a);void 0!==G&&this.updateElement(e,a,G)}trackValue(e,a){return this.subject.asObservable().pipe((0,pi.h)(_=>_.element===e&&_.key===a))}updateStyles(){this.elementMap.forEach((e,a)=>{const _=new Set(this.elementKeyMap.get(a));let C=this.getActivatedValues(e);C&&C.forEach((F,G)=>{this.updateElement(a,G,F),_.delete(G)}),_.forEach(F=>{if(C=this.getActivatedValues(e,F),C){const G=C.get(F);this.updateElement(a,F,G)}else this.clearElement(a,F)})})}clearElement(e,a){const _=this.clearMap.get(e);if(_){const C=_.get(a);C&&(C(),this.subject.next({element:e,key:a,value:""}))}}updateElement(e,a,_){const C=this.updateMap.get(e);if(C){const F=C.get(a);F&&(F(_),this.subject.next({element:e,key:a,value:_}))}}releaseElement(e){const a=this.watcherMap.get(e);a&&(a.forEach(C=>C.unsubscribe()),this.watcherMap.delete(e));const _=this.elementMap.get(e);_&&(_.forEach((C,F)=>_.delete(F)),this.elementMap.delete(e))}triggerUpdate(e,a){const _=this.elementMap.get(e);if(_){const C=this.getActivatedValues(_,a);C&&(a?this.updateElement(e,a,C.get(a)):C.forEach((F,G)=>this.updateElement(e,G,F)))}}buildElementKeyMap(e,a){let _=this.elementKeyMap.get(e);_||(_=new Set,this.elementKeyMap.set(e,_)),_.add(a)}watchExtraTriggers(e,a,_){if(_&&_.length){let C=this.watcherMap.get(e);if(C||(C=new Map,this.watcherMap.set(e,C)),!C.get(a)){const G=(0,jn.T)(..._).subscribe(()=>{const ot=this.getValue(e,a);this.updateElement(e,a,ot)});C.set(a,G)}}}findByQuery(e){return this.breakpoints.findByQuery(e)}getActivatedValues(e,a){for(let C=0;C<this.activatedBreakpoints.length;C++){const G=e.get(this.activatedBreakpoints[C].alias);if(G&&(void 0===a||G.has(a)&&null!=G.get(a)))return G}const _=e.get("");return void 0===a||_&&_.has(a)?_:void 0}observeActivations(){const a=this.breakpoints.items.map(_=>_.mediaQuery);this.matchMedia.observe(this.hook.withPrintQuery(a)).pipe((0,_o.b)(this.hook.interceptEvents(this)),(0,pi.h)(this.hook.blockPropagation())).subscribe(this.onMediaChange.bind(this))}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Re),c.LFG(vo),c.LFG(ll))},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o((0,c.LFG)(Re),(0,c.LFG)(vo),(0,c.LFG)(ll))},token:o,providedIn:"root"}),o})();function dl(o,l,e,a){if(void 0!==a){let _=o.get(l);_||(_=new Map,o.set(l,_)),_.set(e,a)}}function me(o){return null!=o&&"false"!=`${o}`}function ea(o){return Array.isArray(o)?o:[o]}function Ci(o){return null==o?"":"string"==typeof o?o:`${o}px`}function Gi(o){return o instanceof c.SBq?o.nativeElement:o}var ss=de(1177);function De(o){return l=>l.lift(new pl(o))}class pl{constructor(l){this.notifier=l}call(l,e){const a=new xc(l),_=(0,ss.ft)(this.notifier,new ss.IY(a));return _&&!a.seenValue?(a.add(_),e.subscribe(a)):a}}class xc extends ss.Ds{constructor(l){super(l),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}var jr=de(1481);let Lu=(()=>{class o extends ei{constructor(e,a,_,C,F,G,ot){super(e,null,a,_),this.ngClassInstance=ot,this.DIRECTIVE_KEY="ngClass",this.ngClassInstance||(this.ngClassInstance=new Nt.mk(C,F,e,G)),this.init(),this.setValue("","")}set klass(e){this.ngClassInstance.klass=e,this.setValue(e,"")}updateWithValue(e){this.ngClassInstance.ngClass=e,this.ngClassInstance.ngDoCheck()}ngDoCheck(){this.ngClassInstance.ngDoCheck()}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(ze),c.Y36(je),c.Y36(c.ZZ4),c.Y36(c.aQg),c.Y36(c.Qsj),c.Y36(Nt.mk,10))},o.\u0275dir=c.lG2({type:o,inputs:{klass:["class","klass"]},features:[c.qOj]}),o})();const fl=["ngClass","ngClass.xs","ngClass.sm","ngClass.md","ngClass.lg","ngClass.xl","ngClass.lt-sm","ngClass.lt-md","ngClass.lt-lg","ngClass.lt-xl","ngClass.gt-xs","ngClass.gt-sm","ngClass.gt-md","ngClass.gt-lg"];let wo=(()=>{class o extends Lu{constructor(){super(...arguments),this.inputs=fl}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275dir=c.lG2({type:o,selectors:[["","ngClass",""],["","ngClass.xs",""],["","ngClass.sm",""],["","ngClass.md",""],["","ngClass.lg",""],["","ngClass.xl",""],["","ngClass.lt-sm",""],["","ngClass.lt-md",""],["","ngClass.lt-lg",""],["","ngClass.lt-xl",""],["","ngClass.gt-xs",""],["","ngClass.gt-sm",""],["","ngClass.gt-md",""],["","ngClass.gt-lg",""]],inputs:{ngClass:"ngClass","ngClass.xs":"ngClass.xs","ngClass.sm":"ngClass.sm","ngClass.md":"ngClass.md","ngClass.lg":"ngClass.lg","ngClass.xl":"ngClass.xl","ngClass.lt-sm":"ngClass.lt-sm","ngClass.lt-md":"ngClass.lt-md","ngClass.lt-lg":"ngClass.lt-lg","ngClass.lt-xl":"ngClass.lt-xl","ngClass.gt-xs":"ngClass.gt-xs","ngClass.gt-sm":"ngClass.gt-sm","ngClass.gt-md":"ngClass.gt-md","ngClass.gt-lg":"ngClass.gt-lg"},features:[c.qOj]}),o})(),Pu=(()=>{class o extends vi{buildStyles(e,a){return{display:"true"===e?a.display||(a.isServer?"initial":""):"none"}}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275prov=(0,c.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})(),Ru=(()=>{class o extends ei{constructor(e,a,_,C,F,G,ot){super(e,a,_,C),this.layoutConfig=F,this.platformId=G,this.serverModuleLoaded=ot,this.DIRECTIVE_KEY="show-hide",this.display="",this.hasLayout=!1,this.hasFlexChild=!1}ngAfterViewInit(){this.trackExtraTriggers();const e=Array.from(this.nativeElement.children);for(let _=0;_<e.length;_++)if(this.marshal.hasValue(e[_],"flex")){this.hasFlexChild=!0;break}ls.has(this.nativeElement)?this.display=ls.get(this.nativeElement):(this.display=this.getDisplayStyle(),ls.set(this.nativeElement,this.display)),this.init();const a=this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY,"");void 0===a||""===a?this.setValue(!0,""):this.triggerUpdate()}ngOnChanges(e){Object.keys(e).forEach(a=>{if(-1!==this.inputs.indexOf(a)){const _=a.split("."),C=_.slice(1).join("."),F=e[a].currentValue;let G=""===F||0!==F&&me(F);"fxHide"===_[0]&&(G=!G),this.setValue(G,C)}})}trackExtraTriggers(){this.hasLayout=this.marshal.hasValue(this.nativeElement,"layout"),["layout","layout-align"].forEach(e=>{this.marshal.trackValue(this.nativeElement,e).pipe(De(this.destroySubject)).subscribe(this.triggerUpdate.bind(this))})}getDisplayStyle(){return this.hasLayout||this.hasFlexChild&&this.layoutConfig.addFlexToParent?"flex":this.styler.lookupStyle(this.nativeElement,"display",!0)}updateWithValue(e=!0){if(""===e)return;const a=(0,Nt.PM)(this.platformId);this.addStyles(e?"true":"false",{display:this.display,isServer:a}),a&&this.serverModuleLoaded&&this.nativeElement.style.setProperty("display",""),this.marshal.triggerUpdate(this.parentElement,"layout-gap")}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(Pu),c.Y36(ze),c.Y36(je),c.Y36(dn),c.Y36(c.Lbi),c.Y36(yo))},o.\u0275dir=c.lG2({type:o,features:[c.qOj,c.TTD]}),o})();const ls=new WeakMap,zu=["fxShow","fxShow.print","fxShow.xs","fxShow.sm","fxShow.md","fxShow.lg","fxShow.xl","fxShow.lt-sm","fxShow.lt-md","fxShow.lt-lg","fxShow.lt-xl","fxShow.gt-xs","fxShow.gt-sm","fxShow.gt-md","fxShow.gt-lg","fxHide","fxHide.print","fxHide.xs","fxHide.sm","fxHide.md","fxHide.lg","fxHide.xl","fxHide.lt-sm","fxHide.lt-md","fxHide.lt-lg","fxHide.lt-xl","fxHide.gt-xs","fxHide.gt-sm","fxHide.gt-md","fxHide.gt-lg"];let Li=(()=>{class o extends Ru{constructor(){super(...arguments),this.inputs=zu}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275dir=c.lG2({type:o,selectors:[["","fxShow",""],["","fxShow.print",""],["","fxShow.xs",""],["","fxShow.sm",""],["","fxShow.md",""],["","fxShow.lg",""],["","fxShow.xl",""],["","fxShow.lt-sm",""],["","fxShow.lt-md",""],["","fxShow.lt-lg",""],["","fxShow.lt-xl",""],["","fxShow.gt-xs",""],["","fxShow.gt-sm",""],["","fxShow.gt-md",""],["","fxShow.gt-lg",""],["","fxHide",""],["","fxHide.print",""],["","fxHide.xs",""],["","fxHide.sm",""],["","fxHide.md",""],["","fxHide.lg",""],["","fxHide.xl",""],["","fxHide.lt-sm",""],["","fxHide.lt-md",""],["","fxHide.lt-lg",""],["","fxHide.lt-xl",""],["","fxHide.gt-xs",""],["","fxHide.gt-sm",""],["","fxHide.gt-md",""],["","fxHide.gt-lg",""]],inputs:{fxShow:"fxShow","fxShow.print":"fxShow.print","fxShow.xs":"fxShow.xs","fxShow.sm":"fxShow.sm","fxShow.md":"fxShow.md","fxShow.lg":"fxShow.lg","fxShow.xl":"fxShow.xl","fxShow.lt-sm":"fxShow.lt-sm","fxShow.lt-md":"fxShow.lt-md","fxShow.lt-lg":"fxShow.lt-lg","fxShow.lt-xl":"fxShow.lt-xl","fxShow.gt-xs":"fxShow.gt-xs","fxShow.gt-sm":"fxShow.gt-sm","fxShow.gt-md":"fxShow.gt-md","fxShow.gt-lg":"fxShow.gt-lg",fxHide:"fxHide","fxHide.print":"fxHide.print","fxHide.xs":"fxHide.xs","fxHide.sm":"fxHide.sm","fxHide.md":"fxHide.md","fxHide.lg":"fxHide.lg","fxHide.xl":"fxHide.xl","fxHide.lt-sm":"fxHide.lt-sm","fxHide.lt-md":"fxHide.lt-md","fxHide.lt-lg":"fxHide.lt-lg","fxHide.lt-xl":"fxHide.lt-xl","fxHide.gt-xs":"fxHide.gt-xs","fxHide.gt-sm":"fxHide.gt-sm","fxHide.gt-md":"fxHide.gt-md","fxHide.gt-lg":"fxHide.gt-lg"},features:[c.qOj]}),o})();class $h{constructor(l,e,a=!0){this.key=l,this.value=e,this.key=a?l.replace(/['"]/g,"").trim():l.trim(),this.value=a?e.replace(/['"]/g,"").trim():e.trim(),this.value=this.value.replace(/;/,"")}}function ra(o){let l=typeof o;return"object"===l?o.constructor===Array?"array":o.constructor===Set?"set":"object":l}function gl(o){const[l,...e]=o.split(":");return new $h(l,e.join(":"))}function Co(o,l){return l.key&&(o[l.key]=l.value),o}let Fn=(()=>{class o extends ei{constructor(e,a,_,C,F,G,ot,yt,Ht){super(e,null,a,_),this.sanitizer=C,this.ngStyleInstance=ot,this.DIRECTIVE_KEY="ngStyle",this.ngStyleInstance||(this.ngStyleInstance=new Nt.PC(e,F,G)),this.init();const he=this.nativeElement.getAttribute("style")||"";this.fallbackStyles=this.buildStyleMap(he),this.isServer=yt&&(0,Nt.PM)(Ht)}updateWithValue(e){const a=this.buildStyleMap(e);this.ngStyleInstance.ngStyle=Object.assign(Object.assign({},this.fallbackStyles),a),this.isServer&&this.applyStyleToElement(a),this.ngStyleInstance.ngDoCheck()}clearStyles(){this.ngStyleInstance.ngStyle=this.fallbackStyles,this.ngStyleInstance.ngDoCheck()}buildStyleMap(e){const a=_=>this.sanitizer.sanitize(c.q3G.STYLE,_)||"";if(e)switch(ra(e)){case"string":return bc(function ml(o,l=";"){return String(o).trim().split(l).map(e=>e.trim()).filter(e=>""!==e)}(e),a);case"array":return bc(e,a);default:return function nr(o,l){let e=[];return"set"===ra(o)?o.forEach(a=>e.push(a)):Object.keys(o).forEach(a=>{e.push(`${a}:${o[a]}`)}),function Vu(o,l){return o.map(gl).filter(a=>!!a).map(a=>(l&&(a.value=l(a.value)),a)).reduce(Co,{})}(e,l)}(e,a)}return{}}ngDoCheck(){this.ngStyleInstance.ngDoCheck()}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(ze),c.Y36(je),c.Y36(jr.H7),c.Y36(c.aQg),c.Y36(c.Qsj),c.Y36(Nt.PC,10),c.Y36(yo),c.Y36(c.Lbi))},o.\u0275dir=c.lG2({type:o,features:[c.qOj]}),o})();const _l=["ngStyle","ngStyle.xs","ngStyle.sm","ngStyle.md","ngStyle.lg","ngStyle.xl","ngStyle.lt-sm","ngStyle.lt-md","ngStyle.lt-lg","ngStyle.lt-xl","ngStyle.gt-xs","ngStyle.gt-sm","ngStyle.gt-md","ngStyle.gt-lg"];let vc=(()=>{class o extends Fn{constructor(){super(...arguments),this.inputs=_l}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275dir=c.lG2({type:o,selectors:[["","ngStyle",""],["","ngStyle.xs",""],["","ngStyle.sm",""],["","ngStyle.md",""],["","ngStyle.lg",""],["","ngStyle.xl",""],["","ngStyle.lt-sm",""],["","ngStyle.lt-md",""],["","ngStyle.lt-lg",""],["","ngStyle.lt-xl",""],["","ngStyle.gt-xs",""],["","ngStyle.gt-sm",""],["","ngStyle.gt-md",""],["","ngStyle.gt-lg",""]],inputs:{ngStyle:"ngStyle","ngStyle.xs":"ngStyle.xs","ngStyle.sm":"ngStyle.sm","ngStyle.md":"ngStyle.md","ngStyle.lg":"ngStyle.lg","ngStyle.xl":"ngStyle.xl","ngStyle.lt-sm":"ngStyle.lt-sm","ngStyle.lt-md":"ngStyle.lt-md","ngStyle.lt-lg":"ngStyle.lt-lg","ngStyle.lt-xl":"ngStyle.lt-xl","ngStyle.gt-xs":"ngStyle.gt-xs","ngStyle.gt-sm":"ngStyle.gt-sm","ngStyle.gt-md":"ngStyle.gt-md","ngStyle.gt-lg":"ngStyle.gt-lg"},features:[c.qOj]}),o})();function bc(o,l){return o.map(gl).filter(a=>!!a).map(a=>(l&&(a.value=l(a.value)),a)).reduce(Co,{})}let cs=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[$s]}),o})();const wc=new c.OlP("cdk-dir-doc",{providedIn:"root",factory:function Gu(){return(0,c.f3M)(Nt.K0)}});let pn=(()=>{class o{constructor(e){if(this.value="ltr",this.change=new c.vpe,e){const _=e.documentElement?e.documentElement.dir:null,C=(e.body?e.body.dir:null)||_;this.value="ltr"===C||"rtl"===C?C:"ltr"}}ngOnDestroy(){this.change.complete()}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(wc,8))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(wc,8))},token:o,providedIn:"root"}),o})(),Mo=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({}),o})();const yl="inline",Hr=["row","column","row-reverse","column-reverse"];function vl(o){o=o?o.toLowerCase():"";let[l,e,a]=o.split(" ");return Hr.find(_=>_===l)||(l=Hr[0]),e===yl&&(e=a!==yl?a:"",a=yl),[l,Nu(e),!!a]}function qn(o){let[l]=vl(o);return l.indexOf("row")>-1}function Nu(o){if(o)switch(o.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":o="wrap-reverse";break;case"no":case"none":case"nowrap":o="nowrap";break;default:o="wrap"}return o}let Uu=(()=>{class o extends vi{buildStyles(e){return function xl(o){let[l,e,a]=vl(o);return function Cc(o,l=null,e=!1){return{display:e?"inline-flex":"flex","box-sizing":"border-box","flex-direction":o,"flex-wrap":l||null}}(l,e,a)}(e)}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275prov=(0,c.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})();const Mc=["fxLayout","fxLayout.xs","fxLayout.sm","fxLayout.md","fxLayout.lg","fxLayout.xl","fxLayout.lt-sm","fxLayout.lt-md","fxLayout.lt-lg","fxLayout.lt-xl","fxLayout.gt-xs","fxLayout.gt-sm","fxLayout.gt-md","fxLayout.gt-lg"];let Ac=(()=>{class o extends ei{constructor(e,a,_,C){super(e,_,a,C),this.DIRECTIVE_KEY="layout",this.styleCache=sa,this.init()}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(ze),c.Y36(Uu),c.Y36(je))},o.\u0275dir=c.lG2({type:o,features:[c.qOj]}),o})(),Ao=(()=>{class o extends Ac{constructor(){super(...arguments),this.inputs=Mc}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275dir=c.lG2({type:o,selectors:[["","fxLayout",""],["","fxLayout.xs",""],["","fxLayout.sm",""],["","fxLayout.md",""],["","fxLayout.lg",""],["","fxLayout.xl",""],["","fxLayout.lt-sm",""],["","fxLayout.lt-md",""],["","fxLayout.lt-lg",""],["","fxLayout.lt-xl",""],["","fxLayout.gt-xs",""],["","fxLayout.gt-sm",""],["","fxLayout.gt-md",""],["","fxLayout.gt-lg",""]],inputs:{fxLayout:"fxLayout","fxLayout.xs":"fxLayout.xs","fxLayout.sm":"fxLayout.sm","fxLayout.md":"fxLayout.md","fxLayout.lg":"fxLayout.lg","fxLayout.xl":"fxLayout.xl","fxLayout.lt-sm":"fxLayout.lt-sm","fxLayout.lt-md":"fxLayout.lt-md","fxLayout.lt-lg":"fxLayout.lt-lg","fxLayout.lt-xl":"fxLayout.lt-xl","fxLayout.gt-xs":"fxLayout.gt-xs","fxLayout.gt-sm":"fxLayout.gt-sm","fxLayout.gt-md":"fxLayout.gt-md","fxLayout.gt-lg":"fxLayout.gt-lg"},features:[c.qOj]}),o})();const sa=new Map,aa={"margin-left":null,"margin-right":null,"margin-top":null,"margin-bottom":null};let Hu=(()=>{class o extends vi{constructor(e){super(),this._styler=e}buildStyles(e,a){return e.endsWith(So)?function Jh(o,l){const[e,a]=o.split(" "),C=yt=>`-${yt}`;let F="0px",G=C(a||e),ot="0px";return"rtl"===l?ot=C(e):F=C(e),{margin:`0px ${F} ${G} ${ot}`}}(e=e.slice(0,e.indexOf(So)),a.directionality):{}}sideEffect(e,a,_){const C=_.items;if(e.endsWith(So)){const F=function Xh(o,l){const[e,a]=o.split(" ");let C="0px",G="0px";return"rtl"===l?G=e:C=e,{padding:`0px ${C} ${a||e} ${G}`}}(e=e.slice(0,e.indexOf(So)),_.directionality);this._styler.applyStyleToElements(F,_.items)}else{const F=C.pop(),G=function ua(o,l){const e=ca(l.directionality,l.layout),a=Object.assign({},aa);return a[e]=o,a}(e,_);this._styler.applyStyleToElements(G,C),this._styler.applyStyleToElements(aa,[F])}}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(ze))},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o((0,c.LFG)(ze))},token:o,providedIn:"root"}),o})();const qu=["fxLayoutGap","fxLayoutGap.xs","fxLayoutGap.sm","fxLayoutGap.md","fxLayoutGap.lg","fxLayoutGap.xl","fxLayoutGap.lt-sm","fxLayoutGap.lt-md","fxLayoutGap.lt-lg","fxLayoutGap.lt-xl","fxLayoutGap.gt-xs","fxLayoutGap.gt-sm","fxLayoutGap.gt-md","fxLayoutGap.gt-lg"];let la=(()=>{class o extends ei{constructor(e,a,_,C,F,G){super(e,F,C,G),this.zone=a,this.directionality=_,this.styleUtils=C,this.layout="row",this.DIRECTIVE_KEY="layout-gap",this.observerSubject=new ae.xQ;const ot=[this.directionality.change,this.observerSubject.asObservable()];this.init(ot),this.marshal.trackValue(this.nativeElement,"layout").pipe(De(this.destroySubject)).subscribe(this.onLayoutChange.bind(this))}get childrenNodes(){const e=this.nativeElement.children,a=[];for(let _=e.length;_--;)a[_]=e[_];return a}ngAfterContentInit(){this.buildChildObservable(),this.triggerUpdate()}ngOnDestroy(){super.ngOnDestroy(),this.observer&&this.observer.disconnect()}onLayoutChange(e){const _=e.value.split(" ");this.layout=_[0],Hr.find(C=>C===this.layout)||(this.layout="row"),this.triggerUpdate()}updateWithValue(e){const a=this.childrenNodes.filter(_=>1===_.nodeType&&this.willDisplay(_)).sort((_,C)=>{const F=+this.styler.lookupStyle(_,"order"),G=+this.styler.lookupStyle(C,"order");return isNaN(F)||isNaN(G)||F===G?0:F>G?1:-1});if(a.length>0){const _=this.directionality.value,C=this.layout;"row"===C&&"rtl"===_?this.styleCache=Ec:"row"===C&&"rtl"!==_?this.styleCache=Tc:"column"===C&&"rtl"===_?this.styleCache=Zu:"column"===C&&"rtl"!==_&&(this.styleCache=kc),this.addStyles(e,{directionality:_,items:a,layout:C})}}clearStyles(){const e=Object.keys(this.mru).length>0,a=e?"padding":ca(this.directionality.value,this.layout);e&&super.clearStyles(),this.styleUtils.applyStyleToElements({[a]:""},this.childrenNodes)}willDisplay(e){const a=this.marshal.getValue(e,"show-hide");return!0===a||void 0===a&&"none"!==this.styleUtils.lookupStyle(e,"display")}buildChildObservable(){this.zone.runOutsideAngular(()=>{typeof MutationObserver<"u"&&(this.observer=new MutationObserver(e=>{e.some(_=>_.addedNodes&&_.addedNodes.length>0||_.removedNodes&&_.removedNodes.length>0)&&this.observerSubject.next()}),this.observer.observe(this.nativeElement,{childList:!0}))})}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(c.R0b),c.Y36(pn),c.Y36(ze),c.Y36(Hu),c.Y36(je))},o.\u0275dir=c.lG2({type:o,features:[c.qOj]}),o})(),Sc=(()=>{class o extends la{constructor(){super(...arguments),this.inputs=qu}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275dir=c.lG2({type:o,selectors:[["","fxLayoutGap",""],["","fxLayoutGap.xs",""],["","fxLayoutGap.sm",""],["","fxLayoutGap.md",""],["","fxLayoutGap.lg",""],["","fxLayoutGap.xl",""],["","fxLayoutGap.lt-sm",""],["","fxLayoutGap.lt-md",""],["","fxLayoutGap.lt-lg",""],["","fxLayoutGap.lt-xl",""],["","fxLayoutGap.gt-xs",""],["","fxLayoutGap.gt-sm",""],["","fxLayoutGap.gt-md",""],["","fxLayoutGap.gt-lg",""]],inputs:{fxLayoutGap:"fxLayoutGap","fxLayoutGap.xs":"fxLayoutGap.xs","fxLayoutGap.sm":"fxLayoutGap.sm","fxLayoutGap.md":"fxLayoutGap.md","fxLayoutGap.lg":"fxLayoutGap.lg","fxLayoutGap.xl":"fxLayoutGap.xl","fxLayoutGap.lt-sm":"fxLayoutGap.lt-sm","fxLayoutGap.lt-md":"fxLayoutGap.lt-md","fxLayoutGap.lt-lg":"fxLayoutGap.lt-lg","fxLayoutGap.lt-xl":"fxLayoutGap.lt-xl","fxLayoutGap.gt-xs":"fxLayoutGap.gt-xs","fxLayoutGap.gt-sm":"fxLayoutGap.gt-sm","fxLayoutGap.gt-md":"fxLayoutGap.gt-md","fxLayoutGap.gt-lg":"fxLayoutGap.gt-lg"},features:[c.qOj]}),o})();const Ec=new Map,Zu=new Map,Tc=new Map,kc=new Map,So=" grid";function ca(o,l){switch(l){case"column":return"margin-bottom";case"column-reverse":return"margin-top";case"row":default:return"rtl"===o?"margin-left":"margin-right";case"row-reverse":return"rtl"===o?"margin-right":"margin-left"}}function p(o,...l){if(null==o)throw TypeError("Cannot convert undefined or null to object");for(let e of l)if(null!=e)for(let a in e)e.hasOwnProperty(a)&&(o[a]=e[a]);return o}let r=(()=>{class o extends vi{constructor(e){super(),this.layoutConfig=e}buildStyles(e,a){let[_,C,...F]=e.split(" "),G=F.join(" ");const ot=a.direction.indexOf("column")>-1?"column":"row",yt=qn(ot)?"max-width":"max-height",Ht=qn(ot)?"min-width":"min-height",he=String(G).indexOf("calc")>-1,Si=he||"auto"===G,mn=String(G).indexOf("%")>-1&&!he,Bn=String(G).indexOf("px")>-1||String(G).indexOf("rem")>-1||String(G).indexOf("em")>-1||String(G).indexOf("vw")>-1||String(G).indexOf("vh")>-1;let Ji=he||Bn;_="0"==_?0:_,C="0"==C?0:C;const Ia=!_&&!C;let Di={};const Es={"max-width":null,"max-height":null,"min-width":null,"min-height":null};switch(G||""){case"":const eo=!1!==this.layoutConfig.useColumnBasisZero;G="row"===ot?"0%":eo?"0.000000001px":"auto";break;case"initial":case"nogrow":_=0,G="auto";break;case"grow":G="100%";break;case"noshrink":C=0,G="auto";break;case"auto":break;case"none":_=0,C=0,G="auto";break;default:!Ji&&!mn&&!isNaN(G)&&(G+="%"),"0%"===G&&(Ji=!0),"0px"===G&&(G="0%"),Di=p(Es,he?{"flex-grow":_,"flex-shrink":C,"flex-basis":Ji?G:"100%"}:{flex:`${_} ${C} ${Ji?G:"100%"}`})}return Di.flex||Di["flex-grow"]||(Di=p(Es,he?{"flex-grow":_,"flex-shrink":C,"flex-basis":G}:{flex:`${_} ${C} ${G}`})),"0%"!==G&&"0px"!==G&&"0.000000001px"!==G&&"auto"!==G&&(Di[Ht]=Ia||Ji&&_?G:null,Di[yt]=Ia||!Si&&C?G:null),Di[Ht]||Di[yt]?a.hasWrap&&(Di[he?"flex-basis":"flex"]=Di[yt]?he?Di[yt]:`${_} ${C} ${Di[yt]}`:he?Di[Ht]:`${_} ${C} ${Di[Ht]}`):Di=p(Es,he?{"flex-grow":_,"flex-shrink":C,"flex-basis":G}:{flex:`${_} ${C} ${G}`}),p(Di,{"box-sizing":"border-box"})}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(dn))},o.\u0275prov=(0,c.Yz7)({factory:function(){return new o((0,c.LFG)(dn))},token:o,providedIn:"root"}),o})();const u=["fxFlex","fxFlex.xs","fxFlex.sm","fxFlex.md","fxFlex.lg","fxFlex.xl","fxFlex.lt-sm","fxFlex.lt-md","fxFlex.lt-lg","fxFlex.lt-xl","fxFlex.gt-xs","fxFlex.gt-sm","fxFlex.gt-md","fxFlex.gt-lg"];let x=(()=>{class o extends ei{constructor(e,a,_,C,F){super(e,C,a,F),this.layoutConfig=_,this.marshal=F,this.DIRECTIVE_KEY="flex",this.direction=void 0,this.wrap=void 0,this.flexGrow="1",this.flexShrink="1",this.init()}get shrink(){return this.flexShrink}set shrink(e){this.flexShrink=e||"1",this.triggerReflow()}get grow(){return this.flexGrow}set grow(e){this.flexGrow=e||"1",this.triggerReflow()}ngOnInit(){this.parentElement&&(this.marshal.trackValue(this.parentElement,"layout").pipe(De(this.destroySubject)).subscribe(this.onLayoutChange.bind(this)),this.marshal.trackValue(this.nativeElement,"layout-align").pipe(De(this.destroySubject)).subscribe(this.triggerReflow.bind(this)))}onLayoutChange(e){const _=e.value.split(" ");this.direction=_[0],this.wrap=void 0!==_[1]&&"wrap"===_[1],this.triggerUpdate()}updateWithValue(e){void 0===this.direction&&(this.direction=this.getFlexFlowDirection(this.parentElement,!1!==this.layoutConfig.addFlexToParent)),void 0===this.wrap&&(this.wrap=this.hasWrap(this.parentElement));const _=this.direction,C=_.startsWith("row"),F=this.wrap;C&&F?this.styleCache=E:C&&!F?this.styleCache=M:!C&&F?this.styleCache=D:!C&&!F&&(this.styleCache=A);const ot=hl(String(e).replace(";",""),this.flexGrow,this.flexShrink);this.addStyles(ot.join(" "),{direction:_,hasWrap:F})}triggerReflow(){const e=this.activatedValue;if(void 0!==e){const a=hl(e+"",this.flexGrow,this.flexShrink);this.marshal.updateElement(this.nativeElement,this.DIRECTIVE_KEY,a.join(" "))}}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(ze),c.Y36(dn),c.Y36(r),c.Y36(je))},o.\u0275dir=c.lG2({type:o,inputs:{shrink:["fxShrink","shrink"],grow:["fxGrow","grow"]},features:[c.qOj]}),o})(),v=(()=>{class o extends x{constructor(){super(...arguments),this.inputs=u}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275dir=c.lG2({type:o,selectors:[["","fxFlex",""],["","fxFlex.xs",""],["","fxFlex.sm",""],["","fxFlex.md",""],["","fxFlex.lg",""],["","fxFlex.xl",""],["","fxFlex.lt-sm",""],["","fxFlex.lt-md",""],["","fxFlex.lt-lg",""],["","fxFlex.lt-xl",""],["","fxFlex.gt-xs",""],["","fxFlex.gt-sm",""],["","fxFlex.gt-md",""],["","fxFlex.gt-lg",""]],inputs:{fxFlex:"fxFlex","fxFlex.xs":"fxFlex.xs","fxFlex.sm":"fxFlex.sm","fxFlex.md":"fxFlex.md","fxFlex.lg":"fxFlex.lg","fxFlex.xl":"fxFlex.xl","fxFlex.lt-sm":"fxFlex.lt-sm","fxFlex.lt-md":"fxFlex.lt-md","fxFlex.lt-lg":"fxFlex.lt-lg","fxFlex.lt-xl":"fxFlex.lt-xl","fxFlex.gt-xs":"fxFlex.gt-xs","fxFlex.gt-sm":"fxFlex.gt-sm","fxFlex.gt-md":"fxFlex.gt-md","fxFlex.gt-lg":"fxFlex.gt-lg"},features:[c.qOj]}),o})();const M=new Map,A=new Map,E=new Map,D=new Map;let qt=(()=>{class o extends vi{buildStyles(e,a){const _={},[C,F]=e.split(" ");switch(C){case"center":_["justify-content"]="center";break;case"space-around":_["justify-content"]="space-around";break;case"space-between":_["justify-content"]="space-between";break;case"space-evenly":_["justify-content"]="space-evenly";break;case"end":case"flex-end":_["justify-content"]="flex-end";break;default:_["justify-content"]="flex-start"}switch(F){case"start":case"flex-start":_["align-items"]=_["align-content"]="flex-start";break;case"center":_["align-items"]=_["align-content"]="center";break;case"end":case"flex-end":_["align-items"]=_["align-content"]="flex-end";break;case"space-between":_["align-content"]="space-between",_["align-items"]="stretch";break;case"space-around":_["align-content"]="space-around",_["align-items"]="stretch";break;case"baseline":_["align-content"]="stretch",_["align-items"]="baseline";break;default:_["align-items"]=_["align-content"]="stretch"}return p(_,{display:a.inline?"inline-flex":"flex","flex-direction":a.layout,"box-sizing":"border-box","max-width":"stretch"===F?qn(a.layout)?null:"100%":null,"max-height":"stretch"===F&&qn(a.layout)?"100%":null})}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275prov=(0,c.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})();const Ut=["fxLayoutAlign","fxLayoutAlign.xs","fxLayoutAlign.sm","fxLayoutAlign.md","fxLayoutAlign.lg","fxLayoutAlign.xl","fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg"];let ne=(()=>{class o extends ei{constructor(e,a,_,C){super(e,_,a,C),this.DIRECTIVE_KEY="layout-align",this.layout="row",this.inline=!1,this.init(),this.marshal.trackValue(this.nativeElement,"layout").pipe(De(this.destroySubject)).subscribe(this.onLayoutChange.bind(this))}updateWithValue(e){const a=this.layout||"row",_=this.inline;"row"===a&&_?this.styleCache=ai:"row"!==a||_?"row-reverse"===a&&_?this.styleCache=Ze:"row-reverse"!==a||_?"column"===a&&_?this.styleCache=xi:"column"!==a||_?"column-reverse"===a&&_?this.styleCache=Ni:"column-reverse"===a&&!_&&(this.styleCache=Be):this.styleCache=Kt:this.styleCache=fe:this.styleCache=Te,this.addStyles(e,{layout:a,inline:_})}onLayoutChange(e){const a=e.value.split(" ");this.layout=a[0],this.inline=e.value.includes("inline"),Hr.find(_=>_===this.layout)||(this.layout="row"),this.triggerUpdate()}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(ze),c.Y36(qt),c.Y36(je))},o.\u0275dir=c.lG2({type:o,features:[c.qOj]}),o})(),le=(()=>{class o extends ne{constructor(){super(...arguments),this.inputs=Ut}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275dir=c.lG2({type:o,selectors:[["","fxLayoutAlign",""],["","fxLayoutAlign.xs",""],["","fxLayoutAlign.sm",""],["","fxLayoutAlign.md",""],["","fxLayoutAlign.lg",""],["","fxLayoutAlign.xl",""],["","fxLayoutAlign.lt-sm",""],["","fxLayoutAlign.lt-md",""],["","fxLayoutAlign.lt-lg",""],["","fxLayoutAlign.lt-xl",""],["","fxLayoutAlign.gt-xs",""],["","fxLayoutAlign.gt-sm",""],["","fxLayoutAlign.gt-md",""],["","fxLayoutAlign.gt-lg",""]],inputs:{fxLayoutAlign:"fxLayoutAlign","fxLayoutAlign.xs":"fxLayoutAlign.xs","fxLayoutAlign.sm":"fxLayoutAlign.sm","fxLayoutAlign.md":"fxLayoutAlign.md","fxLayoutAlign.lg":"fxLayoutAlign.lg","fxLayoutAlign.xl":"fxLayoutAlign.xl","fxLayoutAlign.lt-sm":"fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md":"fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg":"fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl":"fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs":"fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm":"fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md":"fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg":"fxLayoutAlign.gt-lg"},features:[c.qOj]}),o})();const Te=new Map,Kt=new Map,fe=new Map,Be=new Map,ai=new Map,xi=new Map,Ze=new Map,Ni=new Map;let or=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[$s,Mo]}),o})(),dp=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[$s]}),o})(),fp=(()=>{class o{constructor(e,a){(0,Nt.PM)(a)&&!e&&console.warn("Warning: Flex Layout loaded on the server without FlexLayoutServerModule")}static withConfig(e,a=[]){return{ngModule:o,providers:e.serverLoaded?[{provide:dn,useValue:Object.assign(Object.assign({},hc),e)},{provide:ts,useValue:a,multi:!0},{provide:yo,useValue:!0}]:[{provide:dn,useValue:Object.assign(Object.assign({},hc),e)},{provide:ts,useValue:a,multi:!0}]}}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(yo),c.LFG(c.Lbi))},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[or,cs,dp,or,cs,dp]}),o})();var Ml=de(6630);let da=(()=>{class o{constructor(){}getOpcionesConfiguracion(){return[{text:"Gesti\xf3n invitados",path:"/dashboard/gestion-invitados",icono:"person_outline"},{text:"Mesas",path:"/dashboard/distribucion-mesas",icono:"restaurant"},{text:"Ubicaciones",path:"/dashboard/ubicaciones",icono:"my_location"}]}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function mp(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"li",7),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.comprimido=!_.comprimido)}),c.TgZ(1,"div",8)(2,"span",9),c._uU(3),c.qZA()(),c._UZ(4,"div",10),c.qZA()}if(2&o){const e=l.$implicit;c.Q6J("routerLink",e.path),c.xp6(3),c.hij(" ",e.text," ")}}const gp=function(o){return{abierto:o}},Al=function(o){return{comprimido:o}};let Qu=(()=>{class o{constructor(e){this.enlacesService=e,this.enlaces=[],this.comprimido=!0}ngOnInit(){this.enlaces=this.enlacesService.getOpcionesConfiguracion()}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(da))},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-menu-lateral"]],decls:9,vars:10,consts:[[1,"container"],[1,"boton-menu",3,"ngClass","click"],[1,"linea"],[1,"cortina",3,"ngClass"],[1,"sidebar",3,"ngClass"],["routerLinkActive","hovered",3,"routerLink","click",4,"ngFor","ngForOf"],[1,"content"],["routerLinkActive","hovered",3,"routerLink","click"],[1,"texto"],[1,"title"],[1,"tapa-title"]],template:function(e,a){1&e&&(c.TgZ(0,"div",0)(1,"div",1),c.NdJ("click",function(){return a.comprimido=!a.comprimido}),c._UZ(2,"div",2),c.qZA(),c._UZ(3,"div",3),c.TgZ(4,"div",4)(5,"ul"),c.YNc(6,mp,5,2,"li",5),c.qZA()(),c.TgZ(7,"div",6),c._UZ(8,"router-outlet"),c.qZA()()),2&e&&(c.xp6(1),c.Q6J("ngClass",c.VKq(4,gp,!a.comprimido)),c.xp6(2),c.Q6J("ngClass",c.VKq(6,gp,!a.comprimido)),c.xp6(1),c.Q6J("ngClass",c.VKq(8,Al,a.comprimido)),c.xp6(2),c.Q6J("ngForOf",a.enlaces))},dependencies:[Nt.mk,Nt.sg,Ml.lC,Ml.rH,Ml.Od,wo],styles:['.sidebar[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;right:0;width:500px;background:var(--tono1);color:var(--tono6);box-shadow:-5px 0 10px 10px var(--tono1);font-family:Square Peg,cursive;transition:var(--tr-menu);transition-timing-function:ease;z-index:50}.sidebar.comprimido[_ngcontent-%COMP%]{width:0;box-shadow:-5px 0 10px 10px transparent;transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-timing-function:ease}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;margin-left:80px;padding:0}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:70px;font-size:38pt;color:var(--tono6);cursor:pointer;position:relative;text-shadow:1px 1px 3px var(--tono5);transition:.2s}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{padding-left:15px;text-shadow:-14px 1px 10px var(--tono5);transition:.2s;transition-property:padding-left,text-shadow}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child{margin-top:100px}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{z-index:5;opacity:1;transform:translateY(0);transition:var(--tr-texto-items);transition-delay:var(--trd-texto-items);transition-timing-function:ease;transition-property:opacity,transform}.sidebar.comprimido[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{z-index:5;opacity:0;font-size:0pt;transform:translateY(45px);transition:opacity var(--tr-texto-items) ease 0s,transform var(--tr-texto-items) ease 0s,font-size var(--tr-texto-items) ease var(--trd-texto-items)}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .tapa-title[_ngcontent-%COMP%]{width:100%;background:var(--tono1);height:0px;position:absolute;top:50px;z-index:10;transition:var(--tr-texto-items);transition-delay:var(--trd-texto-items);transition-timing-function:ease;transition-property:height}.sidebar.comprimido[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .tapa-title[_ngcontent-%COMP%]{width:100%;background:var(--tono1);height:100px;position:absolute;top:50px;z-index:10;transition:var(--tr-texto-items);transition-timing-function:ease;transition-property:height}.cortina[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;width:0px;z-index:1;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background-color:var(--tono5-transparente);transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-property:width;z-index:49}.cortina.abierto[_ngcontent-%COMP%]{width:100%;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);transition:var(--tr-menu);transition-property:width}.boton-menu[_ngcontent-%COMP%]{color:var(--tono1);padding:24px 20px 12px;width:26px;border-top-left-radius:30px;border-bottom-left-radius:30px;background-color:var(--tono3-transparente);cursor:pointer;position:fixed;right:0;top:calc(50% - 25px);transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-timing-function:ease;z-index:51}.boton-menu.abierto[_ngcontent-%COMP%]{transition:var(--tr-menu);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%], .boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after, .boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{display:block;width:100%;border-top:2px solid var(--tono1);margin:5px 0;transition:.4s;transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]{transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{content:"";position:relative;border-top:2px solid var(--tono1);bottom:15px;transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after{content:"";position:relative;border-top:2px solid var(--tono1);bottom:6px;transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{transform:rotate(45deg);bottom:6px;border-top:2px solid var(--tono6);transition:.4s;transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after{transform:rotate(-45deg);bottom:13px;border-top:2px solid var(--tono6);transition:.4s;transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]{border-top:2px solid transparent;transition:.4s;transition-timing-function:ease}.content[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;right:0;left:0}.container[_ngcontent-%COMP%]{height:100%}@media screen and (max-width: 599px){.sidebar[_ngcontent-%COMP%]{width:100%}}']}),o})();var Jr=de(7545),An=de(4766);let _p=(()=>{class o{constructor(e){this.http=e,this.urlHeroes="api/heroe"}ngOnInit(){}obtenerListadoHeroes(){return this.http.get(`${An.N.backendUrl}/${this.urlHeroes}`)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(io.eN))},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),ad=(()=>{class o{constructor(e){this.http=e,this.urlMesa="api/mesa",this.urlMesas="api/mesas"}guardarMesa(e){return this.http.post(`${An.N.backendUrl}/${this.urlMesa}`,e)}guardarMesas(e){return this.http.post(`${An.N.backendUrl}/${this.urlMesa}`,e)}obtenerListadoMesas(){return this.http.get(`${An.N.backendUrl}/${this.urlMesa}`)}modificarMesa(e){return this.http.put(`${An.N.backendUrl}/${this.urlMesa}/${e._id}`,e)}eliminarMesa(e){return this.http.delete(`${An.N.backendUrl}/${this.urlMesa}/${e}`)}eliminarTodasLasMesas(){return this.http.delete(`${An.N.backendUrl}/${this.urlMesas}`)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(io.eN))},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),Fc=(()=>{class o{constructor(e,a){this.http=e,this.mesasService=a,this.urlInvitado="api/invitado",this.urlInvitados="api/invitados",this.urlActualizarCategoria="api/actualizar-categoria"}obtenerListadoInvitados(){return this.http.get(`${An.N.backendUrl}/${this.urlInvitado}`)}guardarInvitado(e){return this.http.post(`${An.N.backendUrl}/${this.urlInvitado}`,e)}guardarInvitados(e){return this.http.post(`${An.N.backendUrl}/${this.urlInvitado}/`,e)}actualizarInvitado(e,a){return this.http.put(`${An.N.backendUrl}/${this.urlInvitado}/${a}`,e)}eliminarInvitado(e){return this.http.delete(`${An.N.backendUrl}/${this.urlInvitado}/${e}`)}eliminarTodosLosInvitados(){return this.mesasService.eliminarTodasLasMesas().pipe((0,Jr.w)(()=>this.http.delete(`${An.N.backendUrl}/${this.urlInvitados}`)))}cambiarNombreCategoria(e,a){return this.http.post(`${An.N.backendUrl}/${this.urlActualizarCategoria}`,{nombreAntiguo:e,nombreNuevo:a})}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(io.eN),c.LFG(ad))},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),Mr=(()=>{class o{constructor(){this.vColocados=[],this.m=this.inicializarMapa()}inicializarMapa(){for(var a=[],_=0;_<20;_++){a[_]=[];for(var C=0;C<20;C++)a[_][C]={letra:" ",esHeroe:!1,coordenada:{x:_,y:C},orientaciones:[],color:{r:255,g:255,b:255}}}return this.m=a,this.vColocados=[],a}mostrarMapa(){let e="";e+="   - 0 - 1 - 2 - 3 - 4 - 5 - 6 - 7 - 8 - 9 - 0 - 11- 12- 13- 14- 20- 16- 17- 18- 19-\n",e+="   ---------------------------------------------------------------------------------\n";for(var a=0;a<this.m.length;a++){e+=a<10?`${a}  `:`${a} `;for(var _=0;_<this.m[a].length;_++)e+=`| ${this.m[a][_].letra?this.m[a][_].letra:" "} `;e+="|\n   ---------------------------------------------------------------------------------\n"}console.log(e)}getMapa(){return this.m}getVColocados(){return this.vColocados}rellenarHuecosVacios(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ";this.m.forEach(a=>{a.forEach(_=>{" "==_.letra&&(_.letra=e.charAt(this.getRandomInt(e.length)))})})}colocarNombre(e){var a=!1;return this.vColocados.forEach(_=>{if(!a&&_.prioridad===e.prioridad-1&&e.orientacion!==_.orientacion){const C=this.getCoincidencias(_,e);a=this.insertarNombreEnMapa(C,e)}}),a}colocarHeroe(e){const a={x:this.getRandomInt(20-e.texto.length),y:this.getRandomInt(5)+4};for(var _=a.x;_<a.x+e.texto.length;_++)this.m[_][a.y]=e.letras[_-a.x],e.letras[_-a.x].coordenada={x:_,y:a.y};this.vColocados.push(e)}getCoincidencias(e,a){let _=[];return e.letras.forEach(C=>{a.letras.forEach(F=>{C.letra===F.letra&&_.push({letra:C.letra,esHeroe:C.esHeroe||F.esHeroe,coordenada:C.coordenada,orientaciones:["V","H"],color:this.mezclarColores(e.color,a.color)})})}),_}insertarNombreEnMapa(e,a){let _=!1;return e.forEach(C=>{if(!_){var F=0,G=!1;do{a.letras[F].letra===C.letra?(G=!0,a.letras[F].coordenada=C.coordenada):F++}while(!G&&F<a.letras.length);if("V"===a.orientacion&&a.letras[F].coordenada.x-F>=0&&a.letras[F].coordenada.x-F+a.texto.length-1<20){const yt=a.letras[F].coordenada.x-F,Ht=yt+a.texto.length-1;console.log("Nombre:",a),console.log("i:",F,", xInicio:",yt,", xFin:",Ht);for(var ot=yt;ot<=Ht;ot++)a.letras[ot-yt].coordenada={x:ot,y:C.coordenada.y};if(this.puedoInsertarNombreEnMapa(a)){for(ot=yt;ot<=Ht;ot++)this.m[ot][C.coordenada.y]=ot===C.coordenada.x?C:a.letras[ot-yt];_=!0,this.vColocados.push(a)}}else if("H"===a.orientacion&&a.letras[F].coordenada.y-F>=0&&a.letras[F].coordenada.y-F+a.texto.length-1<20){const yt=a.letras[F].coordenada.y-F,Ht=yt+a.texto.length-1;for(ot=yt;ot<=Ht;ot++)a.letras[ot-yt].coordenada={x:C.coordenada.x,y:ot};if(this.puedoInsertarNombreEnMapa(a)){for(ot=yt;ot<=Ht;ot++)this.m[C.coordenada.x][ot]=ot===C.coordenada.y?C:a.letras[ot-yt];_=!0,this.vColocados.push(a)}}}}),_}obtenerNombre(e,a,_){const C={r:this.getRandomInt(256),g:this.getRandomInt(256),b:this.getRandomInt(256)},F=e.split("").map(G=>({letra:G.toUpperCase(),esHeroe:1===a,orientaciones:[_],color:C}));return{texto:e,prioridad:a,orientacion:_,letras:F,color:C}}puedoInsertarNombreEnMapa(e){const a=e.letras[0].coordenada,_=e.letras[e.texto.length-1].coordenada,C=e.orientacion,F="H"===C?a.y:a.x,G="H"===C?_.y:_.x;for(let ot=F;ot<=G;ot++){if("H"===C&&" "!==this.m[_.x][ot].letra&&this.m[_.x][ot].letra!=e.letras[ot-F].letra)return!1;if("V"===C&&" "!=this.m[ot][_.y].letra&&this.m[ot][_.y].letra!=e.letras[ot-F].letra)return!1}return!0}getMaximaPrioridadEnMapa(){let e=-1;return this.vColocados.forEach(a=>{e=a.prioridad>e?a.prioridad:e}),e}mezclarColores(e,a){return{r:(e.r+a.r)/2,g:(e.g+a.g)/2,b:(e.b+a.b)/2}}getRandomInt(e){return Math.floor(Math.random()*e)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const ld=function(o){return{"es-heroe":o}};function Sl(o,l){if(1&o&&(c.TgZ(0,"div",5),c._uU(1),c.qZA()),2&o){const e=l.$implicit;c.Q6J("ngClass",c.VKq(2,ld,e.esHeroe)),c.xp6(1),c.hij(" ",e.letra," ")}}function Oc(o,l){if(1&o&&(c.TgZ(0,"div",3),c.YNc(1,Sl,2,4,"div",4),c.qZA()),2&o){const e=l.$implicit;c.xp6(1),c.Q6J("ngForOf",e)}}function fa(o,l){if(1&o&&c._UZ(0,"div",6),2&o){const e=l.$implicit;c.Udp("top",30*e.letras[0].coordenada.x,"px")("left",30*e.letras[0].coordenada.y,"px")("width","V"===e.orientacion?30:30*e.letras.length,"px")("height","V"===e.orientacion?30*e.letras.length:30,"px")}}let cd=(()=>{class o{constructor(e){this.sopaLetrasService=e,this.mapa=[],this.vColocados=[]}ngOnInit(){this.generarMapa()}generarMapa(){console.log("GENERAR MAPA"),this.sopaLetrasService.inicializarMapa();const e=this.sopaLetrasService.obtenerNombre(this.heroeSt,1,"V");this.sopaLetrasService.colocarHeroe(e);var a=2,_="H",C=0;do{this.vNombres.forEach(F=>{var G=this.sopaLetrasService.obtenerNombre(F,a,_);this.sopaLetrasService.colocarNombre(G)&&this.vNombres.splice(this.vNombres.indexOf(F),1)}),_="H"===_?"V":"H",a++,C++}while(this.vNombres.length>0&&C<30);this.sopaLetrasService.rellenarHuecosVacios(),this.mapa=this.sopaLetrasService.getMapa(),this.vColocados=this.sopaLetrasService.getVColocados(),this.vColocados.splice(this.vColocados.indexOf(e),1)}getColorString(e){return`rgba(${e.r}, ${e.g}, ${e.b}, 0.7)`}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(Mr))},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-sopa-letras"]],inputs:{heroeSt:"heroeSt",vNombres:"vNombres"},decls:3,vars:2,consts:[[1,"container"],["class","fila","fxLayout","row",4,"ngFor","ngForOf"],["class","linea",3,"top","left","width","height",4,"ngFor","ngForOf"],["fxLayout","row",1,"fila"],["class","celda",3,"ngClass",4,"ngFor","ngForOf"],[1,"celda",3,"ngClass"],[1,"linea"]],template:function(e,a){1&e&&(c.TgZ(0,"div",0),c.YNc(1,Oc,2,1,"div",1),c.YNc(2,fa,1,8,"div",2),c.qZA()),2&e&&(c.xp6(1),c.Q6J("ngForOf",a.mapa),c.xp6(1),c.Q6J("ngForOf",a.vColocados))},dependencies:[Nt.mk,Nt.sg,Ao,wo],styles:[".celda[_ngcontent-%COMP%]{height:25px;width:30px;text-align:center;font-size:11pt;padding-top:5px;font-family:CustomFont,sans-serif}.es-heroe[_ngcontent-%COMP%]{background-color:#5e0000!important;color:#fff!important}.linea[_ngcontent-%COMP%]{position:absolute;border:2px solid red;border-radius:50%;box-shadow:1px 2px 3px #00000080}@font-face{font-family:CustomFont;src:url(GoboldRegular.b1cb2a30e235b7b0.otf);font-weight:400}"]}),o})(),th=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-spinner-carga"]],decls:1,vars:0,consts:[[1,"lds-hourglass"]],template:function(e,a){1&e&&c._UZ(0,"div",0)},styles:['.lds-hourglass[_ngcontent-%COMP%]{display:inline-block;position:relative;width:80px;height:80px}.lds-hourglass[_ngcontent-%COMP%]:after{content:" ";display:block;border-radius:50%;width:0;height:0;margin:8px;box-sizing:border-box;border:32px solid #fff;border-color:#fff transparent #fff transparent;animation:lds-hourglass 1.2s infinite}@keyframes lds-hourglass{0%{transform:rotate(0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}50%{transform:rotate(900deg);animation-timing-function:cubic-bezier(.215,.61,.355,1)}to{transform:rotate(1800deg)}}']}),o})();const yp=["sopaDeLetras"];function xp(o,l){1&o&&(c.TgZ(0,"div",9),c._UZ(1,"app-spinner-carga"),c.qZA())}function mm(o,l){if(1&o&&(c.TgZ(0,"div",20),c._uU(1),c.qZA()),2&o){const e=l.$implicit;c.xp6(1),c.hij(" ",e," ")}}const ud=function(o){return{"background-image":o}};function vp(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"div",12)(1,"div",13),c.NdJ("click",function(){const C=c.CHM(e).$implicit,F=c.oxw(2);return c.KtG(F.abrirListadoInvitados(C))}),c.TgZ(2,"div",14),c._UZ(3,"div",15),c.TgZ(4,"div",16),c._uU(5),c.qZA()(),c.TgZ(6,"div",17)(7,"div",18),c.YNc(8,mm,2,1,"div",19),c.qZA()()()()}if(2&o){const e=l.$implicit;c.xp6(2),c.Q6J("ngStyle",c.VKq(3,ud,"url("+e.heroeSchema.pathImagen+")")),c.xp6(3),c.hij(" Mesa ",e.heroeSchema.nombre," "),c.xp6(3),c.Q6J("ngForOf",e.vInvitados)}}function Lc(o,l){if(1&o&&(c.TgZ(0,"div",10),c.YNc(1,vp,9,5,"div",11),c.qZA()),2&o){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",e.vMesas)}}function El(o,l){if(1&o&&(c.TgZ(0,"div",26),c._uU(1),c.qZA()),2&o){const e=l.$implicit;c.xp6(1),c.hij(" ",e.nombre," ")}}function fs(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"div",21)(1,"div",22)(2,"div",23),c.YNc(3,El,2,1,"div",24),c.TgZ(4,"div",25),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.mostrandoListado=!1)}),c._uU(5," Cerrar listado "),c.qZA()()()()}if(2&o){const e=c.oxw();c.xp6(3),c.Q6J("ngForOf",e.vInvitadosMostrados)}}function hd(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"div",27)(1,"div"),c._UZ(2,"app-sopa-letras",28,29),c.qZA(),c.TgZ(4,"div",30)(5,"div",31),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.cerrarSopaDeLetras())}),c._uU(6," Cerrar sopa "),c.qZA()()()}if(2&o){const e=c.oxw();c.xp6(2),c.Q6J("heroeSt",e.heroeSr)("vNombres",e.vNombres)}}let bp=(()=>{class o{constructor(e,a,_,C){this.heroesService=e,this.mesasService=a,this.invitadosService=_,this.sopaLetrasService=C,this.vInvitados=[],this.vMesas=[],this.vHeroes=[],this.mostrandoListado=!1,this.vInvitadosMostrados=[],this.vNombres=[],this.cargandoDatos=!1,this.mostrandoSopaLetras=!1,this.anchoPantalla=0}ngOnInit(){this.anchoPantalla=window.innerWidth,this.cargandoDatos=!0,this.heroesService.obtenerListadoHeroes().pipe((0,Jr.w)(({data:e})=>(this.vHeroes=e,this.invitadosService.obtenerListadoInvitados())),(0,Jr.w)(({data:e})=>(this.vInvitados=e,this.mesasService.obtenerListadoMesas()))).subscribe(({data:e})=>{this.vMesas=e,this.vMesas.forEach(a=>{a.heroeSchema=this.vHeroes.find(_=>_._id===a.heroe),a.vInvitados=[]}),this.vInvitados.forEach(a=>{a.mesaSchema=this.vMesas.find(_=>_._id===a.mesa),this.vMesas.find(_=>_._id===a.mesa)?.vInvitados?.push(a.nombre)}),console.log(this.vMesas),this.cargandoDatos=!1})}abrirListadoInvitados(e){const a=e.heroeSchema;this.vInvitadosMostrados=[],this.vInvitados.forEach(_=>{_.mesaSchema.heroe===a._id&&this.vInvitadosMostrados.push(_)}),this.vMesas.map(_=>_.mostrando=!1),e.mostrando=!0,this.mostrandoListado=!0}cerrarListadoInvitados(){this.mostrandoListado=!1,this.vMesas.map(e=>e.mostrando=!1)}mostrarSopaLetras(e){this.vInvitadosMostrados=[],this.vInvitados.forEach(a=>{a.mesaSchema.heroe===e._id&&(this.vInvitadosMostrados.push(a),this.vNombres.push(a.nombre.replace(" ","")))}),this.heroeSr=e.nombre,this.heroeSr=this.heroeSr.replace(" ",""),this.mostrandoSopaLetras=!0}cerrarSopaDeLetras(){this.vInvitadosMostrados=[],this.sopaLetrasService.inicializarMapa(),this.heroeSr="",this.mostrandoSopaLetras=!1}onResize(e){this.anchoPantalla=e.target.innerWidth}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(_p),c.Y36(ad),c.Y36(Fc),c.Y36(Mr))},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-distribucion-mesas"]],viewQuery:function(e,a){if(1&e&&c.Gf(yp,5),2&e){let _;c.iGM(_=c.CRH())&&(a.sopaLetras=_.first)}},hostBindings:function(e,a){1&e&&c.NdJ("resize",function(C){return a.onResize(C)},!1,c.Jf7)},decls:11,vars:4,consts:[[1,"container"],[1,"titulo-distribucion-mesas"],[1,"cortina"],["fxLayoutAlign","center center",1,"texto-titulo"],["fxLayoutAlign","center","class","spinner-carga",4,"ngIf"],["fxLayout","row wrap","class","container-tarjetas","fxLayoutAlign","center",4,"ngIf"],[1,"fondo"],["class","dialog-listado-invitados",4,"ngIf"],["class","dialog-sopa-letras",4,"ngIf"],["fxLayoutAlign","center",1,"spinner-carga"],["fxLayout","row wrap","fxLayoutAlign","center",1,"container-tarjetas"],["class","content-tarjeta","fxFlex","22","fxFlex.md","30","fxFlex.sm","45","fxFlex.xs","90",4,"ngFor","ngForOf"],["fxFlex","22","fxFlex.md","30","fxFlex.sm","45","fxFlex.xs","90",1,"content-tarjeta"],[1,"tarjeta",3,"click"],[1,"tarjeta-frente",3,"ngStyle"],[1,"borde-superior-nombre"],["fxLayoutAlign","center",1,"nombre-mesa"],[1,"tarjeta-reverso"],["fxLayout","column","fxLayoutAlign","center center",1,"tarjeta-reverso-container"],["class","item-invitado",4,"ngFor","ngForOf"],[1,"item-invitado"],[1,"dialog-listado-invitados"],[1,"listado-invitados"],["fxLayout","column","fxLayoutAlign","center center",1,"listado"],["class","invitado-item",4,"ngFor","ngForOf"],[1,"boton-cerrar-listado-invitados",3,"click"],[1,"invitado-item"],[1,"dialog-sopa-letras"],[3,"heroeSt","vNombres"],["sopaDeLetras",""],["fxLayoutAlign","center",1,"botonera-cerrar-sopa-letras"],[1,"boton",3,"click"]],template:function(e,a){1&e&&(c.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),c._uU(4," Distribuci\xf3n de las mesas "),c.qZA()()(),c.YNc(5,xp,2,0,"div",4),c.YNc(6,Lc,2,1,"div",5),c.qZA(),c.TgZ(7,"div",6),c._UZ(8,"div",2),c.qZA(),c.YNc(9,fs,6,1,"div",7),c.YNc(10,hd,7,2,"div",8)),2&e&&(c.xp6(5),c.Q6J("ngIf",0===a.vMesas.length),c.xp6(1),c.Q6J("ngIf",a.vMesas.length>0),c.xp6(3),c.Q6J("ngIf",a.mostrandoListado),c.xp6(1),c.Q6J("ngIf",a.mostrandoSopaLetras))},dependencies:[Nt.sg,Nt.O5,Nt.PC,Ao,le,v,vc,cd,th],styles:['@import"https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap";.titulo-distribucion-mesas[_ngcontent-%COMP%]{width:100%;height:250px;background-image:url(foto-parador-3.54ab84ff17beded3.webp);background-position:center center;background-size:cover;font-family:Square Peg,cursive}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#00000090}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{color:#fff;text-shadow:2px 2px 3px #ffffff80;font-size:60pt;width:100%;height:100%}.spinner-carga[_ngcontent-%COMP%]{padding-top:50px}.fondo[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;right:0;background-image:url(foto-parador-1.501f9ed644383b38.jpeg);background-size:cover;background-position:center center;z-index:-10}.fondo[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#361d42c0}.container-tarjetas[_ngcontent-%COMP%]{padding-top:50px;width:100%;max-width:1400px}.tarjeta[_ngcontent-%COMP%]{min-height:450px;margin:15px;box-shadow:3px 4px 4px var(--tono5-transparente);border-radius:5px;cursor:pointer;transition:.3s;position:relative}.nombre-mesa[_ngcontent-%COMP%]{margin-top:250px;padding-top:150px;height:200px;font-size:30pt;font-family:Square Peg,cursive;border-bottom-left-radius:5px;border-bottom-right-radius:5px;background:linear-gradient(to bottom,transparent,var(--transparente-2))}.tarjeta-frente[_ngcontent-%COMP%], .tarjeta-reverso[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;border-radius:5px}.tarjeta-frente[_ngcontent-%COMP%]{background-size:cover;background-position:center center;z-index:10;transition-delay:.1s}.tarjeta-reverso[_ngcontent-%COMP%]{transform:rotateY(180deg);z-index:-10;background-image:url(fondo-comic-vinnetas-color.7eb4ad1982ffb5f0.jpeg);background-size:cover;background-position:center center;transition-delay:.1s;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:5px}.tarjeta-reverso-container[_ngcontent-%COMP%], .listado[_ngcontent-%COMP%]{background-color:#fffe;width:70%;height:85%}.content-tarjeta[_ngcontent-%COMP%]:hover   .tarjeta[_ngcontent-%COMP%]{transform:rotateY(180deg);transition:.3s}.content-tarjeta[_ngcontent-%COMP%]:hover   .tarjeta[_ngcontent-%COMP%]   .tarjeta-reverso[_ngcontent-%COMP%]{z-index:10;transition-delay:.1s}.content-tarjeta[_ngcontent-%COMP%]:hover   .tarjeta[_ngcontent-%COMP%]   .tarjeta-frente[_ngcontent-%COMP%]{z-index:-10;transition-delay:.1s}.item-invitado[_ngcontent-%COMP%]{color:#000;text-align:center;font-size:18pt;margin:8px 0;font-family:Avengers Font,Square Peg,cursive}.dialog-listado-invitados[_ngcontent-%COMP%]{z-index:30;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background-color:var(--tono5-transparente);position:fixed;top:0;bottom:0;left:0;right:0}.listado-invitados[_ngcontent-%COMP%]{width:400px;position:fixed;top:5%;bottom:5%;left:calc(50% - 200px);background-image:url(fondo-comic-vinnetas.1bc12bdaba77ae38.jpeg);background-size:cover;background-position:center center}.listado-invitados[_ngcontent-%COMP%] > .listado[_ngcontent-%COMP%]{position:relative;overflow-y:scroll;border-radius:5px;box-shadow:3px 4px 4px var(--tono5-transparente);padding-top:100px;padding-bottom:30px}.cerrar[_ngcontent-%COMP%]{position:fixed;top:0;right:0}.invitado-item[_ngcontent-%COMP%]{margin-top:30px;color:#fff;font-family:Square Peg,cursive;font-size:30pt;text-align:center}.boton-cerrar-listado-invitados[_ngcontent-%COMP%]{cursor:pointer;margin-top:50px;font-size:25pt;text-align:center;font-family:Square Peg,cursive}.dialog-sopa-letras[_ngcontent-%COMP%]{position:fixed;top:calc(45% - 300px);left:calc(50% - 300px)}.dialog-sopa-letras[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{z-index:5;background-color:#fff;border-radius:5px;box-shadow:3px 3px 3px var(--tono5-transparente)}.dialog-sopa-letras[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{border-bottom-right-radius:0!important;border-bottom-left-radius:0!important}.botonera-cerrar-sopa-letras[_ngcontent-%COMP%]{border-top-right-radius:0!important;border-top-left-radius:0!important}.botonera-cerrar-sopa-letras[_ngcontent-%COMP%]   .boton[_ngcontent-%COMP%]{margin:5px;padding:5px 20px;border:2px solid var(--tono5-transparente);background:var(--tono1);box-shadow:1px 2px 3px var(--tono1-transparente);border-radius:3px;color:var(--tono7);cursor:pointer;font-size:18pt;font-family:Square Peg,cursive}@media screen and (max-width: 595px){.listado-invitados[_ngcontent-%COMP%]{width:400px}.titulo-distribucion-mesas[_ngcontent-%COMP%]{height:300px}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{font-size:40pt}}@font-face{font-family:Avengers Font;src:url(AvengersFont.4131afb508e61ffa.otf)}']}),o})();const Lo="NOMBRE_ASC",Tl="NOMBRE_DESC",On="MESA_ASC",Pc="MESA_DESC",Yi="NUMERO_ASC",Zn="NUMERO_DESC";var Ar=de(1086),Rc=de(7043);function kl(o,l,e,a){return(0,Rc.m)(e)&&(a=e,e=void 0),a?kl(o,l,e).pipe((0,ui.U)(_=>(0,dr.k)(_)?a(..._):a(_))):new zt.y(_=>{Cp(o,l,function C(F){_.next(arguments.length>1?Array.prototype.slice.call(arguments):F)},_,e)})}function Cp(o,l,e,a,_){let C;if(function Ap(o){return o&&"function"==typeof o.addEventListener&&"function"==typeof o.removeEventListener}(o)){const F=o;o.addEventListener(l,e,_),C=()=>F.removeEventListener(l,e,_)}else if(function ma(o){return o&&"function"==typeof o.on&&"function"==typeof o.off}(o)){const F=o;o.on(l,e),C=()=>F.off(l,e)}else if(function Mp(o){return o&&"function"==typeof o.addListener&&"function"==typeof o.removeListener}(o)){const F=o;o.addListener(l,e),C=()=>F.removeListener(l,e)}else{if(!o||!o.length)throw new TypeError("Invalid event target");for(let F=0,G=o.length;F<G;F++)Cp(o[F],l,e,a,_)}a.add(C)}var Sp=de(6686),Tp=de(2268);new class dd extends Tp.v{flush(l){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let a,_=-1,C=e.length;l=l||e.shift();do{if(a=l.execute(l.state,l.delay))break}while(++_<C&&(l=e.shift()));if(this.active=!1,a){for(;++_<C&&(l=e.shift());)l.unsubscribe();throw a}}}(class Ep extends Sp.o{constructor(l,e){super(l,e),this.scheduler=l,this.work=e}requestAsyncId(l,e,a=0){return null!==a&&a>0?super.requestAsyncId(l,e,a):(l.actions.push(this),l.scheduled||(l.scheduled=requestAnimationFrame(()=>l.flush(null))))}recycleAsyncId(l,e,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(l,e,a);0===l.actions.length&&(cancelAnimationFrame(e),l.scheduled=void 0)}});de(8139);var Sr=de(2654),zc=de(5778),fd=de(353);class Ip{constructor(l){this.durationSelector=l}call(l,e){return e.subscribe(new Fp(l,this.durationSelector))}}class Fp extends ss.Ds{constructor(l,e){super(l),this.durationSelector=e,this.hasValue=!1}_next(l){if(this.value=l,this.hasValue=!0,!this.throttled){let e;try{const{durationSelector:_}=this;e=_(l)}catch(_){return this.destination.error(_)}const a=(0,ss.ft)(e,new ss.IY(this));!a||a.closed?this.clearThrottle():this.add(this.throttled=a)}}clearThrottle(){const{value:l,hasValue:e,throttled:a}=this;a&&(this.remove(a),this.throttled=void 0,a.unsubscribe()),e&&(this.value=void 0,this.hasValue=!1,this.destination.next(l))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}var md=de(4241),eh=de(2866);function Ln(o){const{index:l,period:e,subscriber:a}=o;if(a.next(l),!a.closed){if(-1===e)return a.complete();o.index=l+1,this.schedule(o,e)}}function ih(o,l=fd.P){return function gm(o){return function(e){return e.lift(new Ip(o))}}(()=>function Po(o=0,l,e){let a=-1;return(0,md.k)(l)?a=Number(l)<1?1:Number(l):(0,eh.K)(l)&&(e=l),(0,eh.K)(e)||(e=fd.P),new zt.y(_=>{const C=(0,md.k)(o)?o:+o-e.now();return e.schedule(Ln,C,{index:0,period:a,subscriber:_})})}(o,l))}var En=de(1059);let gd;de(519),de(341),de(2102),de(5279),de(5283);try{gd=typeof Intl<"u"&&Intl.v8BreakIterator}catch{gd=!1}let Vc,_a,sh,ni=(()=>{class o{constructor(e){this._platformId=e,this.isBrowser=this._platformId?(0,Nt.NF)(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!gd)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(c.Lbi))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(c.Lbi))},token:o,providedIn:"root"}),o})(),Dl=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({}),o})();function oh(o){return function _d(){if(null==Vc&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Vc=!0}))}finally{Vc=Vc||!1}return Vc}()?o:!!o.capture}function Mi(){if(null==_a){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return _a=!1,_a;if("scrollBehavior"in document.documentElement.style)_a=!0;else{const o=Element.prototype.scrollTo;_a=!!o&&!/\{\s*\[native code\]\s*\}/.test(o.toString())}}return _a}function gs(){let o=typeof document<"u"&&document?document.activeElement:null;for(;o&&o.shadowRoot;){const l=o.shadowRoot.activeElement;if(l===o)break;o=l}return o}function _s(o){return o.composedPath?o.composedPath()[0]:o.target}function ch(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}let Fl=(()=>{class o{constructor(e,a,_){this._ngZone=e,this._platform=a,this._scrolled=new ae.xQ,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=_}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const a=this.scrollContainers.get(e);a&&(a.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new zt.y(a=>{this._globalSubscription||this._addGlobalListener();const _=e>0?this._scrolled.pipe(ih(e)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{_.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,Ar.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(e,a){const _=this.getAncestorScrollContainers(e);return this.scrolled(a).pipe((0,pi.h)(C=>!C||_.indexOf(C)>-1))}getAncestorScrollContainers(e){const a=[];return this.scrollContainers.forEach((_,C)=>{this._scrollableContainsElement(C,e)&&a.push(C)}),a}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,a){let _=Gi(a),C=e.getElementRef().nativeElement;do{if(_==C)return!0}while(_=_.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>kl(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(c.R0b),c.LFG(ni),c.LFG(Nt.K0,8))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(c.R0b),c.LFG(ni),c.LFG(Nt.K0,8))},token:o,providedIn:"root"}),o})(),lr=(()=>{class o{constructor(e,a,_){this._platform=e,this._change=new ae.xQ,this._changeListener=C=>{this._change.next(C)},this._document=_,a.runOutsideAngular(()=>{if(e.isBrowser){const C=this._getWindow();C.addEventListener("resize",this._changeListener),C.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:a,height:_}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+_,right:e.left+a,height:_,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,a=this._getWindow(),_=e.documentElement,C=_.getBoundingClientRect();return{top:-C.top||e.body.scrollTop||a.scrollY||_.scrollTop||0,left:-C.left||e.body.scrollLeft||a.scrollX||_.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(ih(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(ni),c.LFG(c.R0b),c.LFG(Nt.K0,8))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(ni),c.LFG(c.R0b),c.LFG(Nt.K0,8))},token:o,providedIn:"root"}),o})(),Uc=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({}),o})(),ys=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Mo,Dl,Uc,Mo,Uc]}),o})();class xa{attach(l){return this._attachedHost=l,l.attach(this)}detach(){let l=this._attachedHost;null!=l&&(this._attachedHost=null,l.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(l){this._attachedHost=l}}class Ll extends xa{constructor(l,e,a,_){super(),this.component=l,this.viewContainerRef=e,this.injector=a,this.componentFactoryResolver=_}}class jc extends xa{constructor(l,e,a){super(),this.templateRef=l,this.viewContainerRef=e,this.context=a}get origin(){return this.templateRef.elementRef}attach(l,e=this.context){return this.context=e,super.attach(l)}detach(){return this.context=void 0,super.detach()}}class Np extends xa{constructor(l){super(),this.element=l instanceof c.SBq?l.nativeElement:l}}class Hc{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(l){return l instanceof Ll?(this._attachedPortal=l,this.attachComponentPortal(l)):l instanceof jc?(this._attachedPortal=l,this.attachTemplatePortal(l)):this.attachDomPortal&&l instanceof Np?(this._attachedPortal=l,this.attachDomPortal(l)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(l){this._disposeFn=l}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Up extends Hc{constructor(l,e,a,_,C){super(),this.outletElement=l,this._componentFactoryResolver=e,this._appRef=a,this._defaultInjector=_,this.attachDomPortal=F=>{const G=F.element,ot=this._document.createComment("dom-portal");G.parentNode.insertBefore(ot,G),this.outletElement.appendChild(G),this._attachedPortal=F,super.setDisposeFn(()=>{ot.parentNode&&ot.parentNode.replaceChild(G,ot)})},this._document=C}attachComponentPortal(l){const a=(l.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(l.component);let _;return l.viewContainerRef?(_=l.viewContainerRef.createComponent(a,l.viewContainerRef.length,l.injector||l.viewContainerRef.injector),this.setDisposeFn(()=>_.destroy())):(_=a.create(l.injector||this._defaultInjector),this._appRef.attachView(_.hostView),this.setDisposeFn(()=>{this._appRef.detachView(_.hostView),_.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(_)),this._attachedPortal=l,_}attachTemplatePortal(l){let e=l.viewContainerRef,a=e.createEmbeddedView(l.templateRef,l.context);return a.rootNodes.forEach(_=>this.outletElement.appendChild(_)),a.detectChanges(),this.setDisposeFn(()=>{let _=e.indexOf(a);-1!==_&&e.remove(_)}),this._attachedPortal=l,a}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(l){return l.hostView.rootNodes[0]}}let Pl=(()=>{class o extends Hc{constructor(e,a,_){super(),this._componentFactoryResolver=e,this._viewContainerRef=a,this._isInitialized=!1,this.attached=new c.vpe,this.attachDomPortal=C=>{const F=C.element,G=this._document.createComment("dom-portal");C.setAttachedHost(this),F.parentNode.insertBefore(G,F),this._getRootNode().appendChild(F),this._attachedPortal=C,super.setDisposeFn(()=>{G.parentNode&&G.parentNode.replaceChild(F,G)})},this._document=_}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const a=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,C=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),F=a.createComponent(C,a.length,e.injector||a.injector);return a!==this._viewContainerRef&&this._getRootNode().appendChild(F.hostView.rootNodes[0]),super.setDisposeFn(()=>F.destroy()),this._attachedPortal=e,this._attachedRef=F,this.attached.emit(F),F}attachTemplatePortal(e){e.setAttachedHost(this);const a=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context);return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=a,this.attached.emit(a),a}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c._Vd),c.Y36(c.s_b),c.Y36(Nt.K0))},o.\u0275dir=c.lG2({type:o,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[c.qOj]}),o})(),Rl=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({}),o})();var li=de(2986);de(4290);const ur=Mi();class Er{constructor(l,e){this._viewportRuler=l,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const l=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=l.style.left||"",this._previousHTMLStyles.top=l.style.top||"",l.style.left=Ci(-this._previousScrollPosition.left),l.style.top=Ci(-this._previousScrollPosition.top),l.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const l=this._document.documentElement,a=l.style,_=this._document.body.style,C=a.scrollBehavior||"",F=_.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,l.classList.remove("cdk-global-scrollblock"),ur&&(a.scrollBehavior=_.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),ur&&(a.scrollBehavior=C,_.scrollBehavior=F)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,a=this._viewportRuler.getViewportSize();return e.scrollHeight>a.height||e.scrollWidth>a.width}}class nf{constructor(l,e,a,_){this._scrollDispatcher=l,this._ngZone=e,this._viewportRuler=a,this._config=_,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(l){this._overlayRef=l}enable(){if(this._scrollSubscription)return;const l=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=l.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=l.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class rf{enable(){}disable(){}attach(){}}function Kc(o,l){return l.some(e=>o.bottom<e.top||o.top>e.bottom||o.right<e.left||o.left>e.right)}function Tr(o,l){return l.some(e=>o.top<e.top||o.bottom>e.bottom||o.left<e.left||o.right>e.right)}class sf{constructor(l,e,a,_){this._scrollDispatcher=l,this._viewportRuler=e,this._ngZone=a,this._config=_,this._scrollSubscription=null}attach(l){this._overlayRef=l}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:_}=this._viewportRuler.getViewportSize();Kc(e,[{width:a,height:_,bottom:_,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let af=(()=>{class o{constructor(e,a,_,C){this._scrollDispatcher=e,this._viewportRuler=a,this._ngZone=_,this.noop=()=>new rf,this.close=F=>new nf(this._scrollDispatcher,this._ngZone,this._viewportRuler,F),this.block=()=>new Er(this._viewportRuler,this._document),this.reposition=F=>new sf(this._scrollDispatcher,this._viewportRuler,this._ngZone,F),this._document=C}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Fl),c.LFG(lr),c.LFG(c.R0b),c.LFG(Nt.K0))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(Fl),c.LFG(lr),c.LFG(c.R0b),c.LFG(Nt.K0))},token:o,providedIn:"root"}),o})();class Ah{constructor(l){if(this.scrollStrategy=new rf,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,l){const e=Object.keys(l);for(const a of e)void 0!==l[a]&&(this[a]=l[a])}}}class Sh{constructor(l,e,a,_,C){this.offsetX=a,this.offsetY=_,this.panelClass=C,this.originX=l.originX,this.originY=l.originY,this.overlayX=e.overlayX,this.overlayY=e.overlayY}}class Bl{constructor(l,e){this.connectionPair=l,this.scrollableViewProperties=e}}let Qc=(()=>{class o{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const a=this._attachedOverlays.indexOf(e);a>-1&&this._attachedOverlays.splice(a,1),0===this._attachedOverlays.length&&this.detach()}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Nt.K0))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(Nt.K0))},token:o,providedIn:"root"}),o})(),cf=(()=>{class o extends Qc{constructor(e){super(e),this._keydownListener=a=>{const _=this._attachedOverlays;for(let C=_.length-1;C>-1;C--)if(_[C]._keydownEvents.observers.length>0){_[C]._keydownEvents.next(a);break}}}add(e){super.add(e),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Nt.K0))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(Nt.K0))},token:o,providedIn:"root"}),o})(),tu=(()=>{class o extends Qc{constructor(e,a){super(e),this._platform=a,this._cursorStyleIsSet=!1,this._pointerDownListener=_=>{this._pointerDownEventTarget=_s(_)},this._clickListener=_=>{const C=_s(_),F="click"===_.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:C;this._pointerDownEventTarget=null;const G=this._attachedOverlays.slice();for(let ot=G.length-1;ot>-1;ot--){const yt=G[ot];if(!(yt._outsidePointerEvents.observers.length<1)&&yt.hasAttached()){if(yt.overlayElement.contains(C)||yt.overlayElement.contains(F))break;yt._outsidePointerEvents.next(_)}}}}add(e){if(super.add(e),!this._isAttached){const a=this._document.body;a.addEventListener("pointerdown",this._pointerDownListener,!0),a.addEventListener("click",this._clickListener,!0),a.addEventListener("auxclick",this._clickListener,!0),a.addEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Nt.K0),c.LFG(ni))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(Nt.K0),c.LFG(ni))},token:o,providedIn:"root"}),o})(),ba=(()=>{class o{constructor(e,a){this._platform=a,this._document=e}ngOnDestroy(){const e=this._containerElement;e&&e.parentNode&&e.parentNode.removeChild(e)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||ch()){const _=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let C=0;C<_.length;C++)_[C].parentNode.removeChild(_[C])}const a=this._document.createElement("div");a.classList.add(e),ch()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Nt.K0),c.LFG(ni))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(Nt.K0),c.LFG(ni))},token:o,providedIn:"root"}),o})();class uf{constructor(l,e,a,_,C,F,G,ot,yt){this._portalOutlet=l,this._host=e,this._pane=a,this._config=_,this._ngZone=C,this._keyboardDispatcher=F,this._document=G,this._location=ot,this._outsideClickDispatcher=yt,this._backdropElement=null,this._backdropClick=new ae.xQ,this._attachments=new ae.xQ,this._detachments=new ae.xQ,this._locationChanges=Sr.w.EMPTY,this._backdropClickHandler=Ht=>this._backdropClick.next(Ht),this._keydownEvents=new ae.xQ,this._outsidePointerEvents=new ae.xQ,_.scrollStrategy&&(this._scrollStrategy=_.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=_.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(l){let e=this._portalOutlet.attach(l);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,li.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const l=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),l}dispose(){const l=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,l&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(l){l!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=l,this.hasAttached()&&(l.attach(this),this.updatePosition()))}updateSize(l){this._config=Object.assign(Object.assign({},this._config),l),this._updateElementSize()}setDirection(l){this._config=Object.assign(Object.assign({},this._config),{direction:l}),this._updateElementDirection()}addPanelClass(l){this._pane&&this._toggleClasses(this._pane,l,!0)}removePanelClass(l){this._pane&&this._toggleClasses(this._pane,l,!1)}getDirection(){const l=this._config.direction;return l?"string"==typeof l?l:l.value:"ltr"}updateScrollStrategy(l){l!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=l,this.hasAttached()&&(l.attach(this),l.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const l=this._pane.style;l.width=Ci(this._config.width),l.height=Ci(this._config.height),l.minWidth=Ci(this._config.minWidth),l.minHeight=Ci(this._config.minHeight),l.maxWidth=Ci(this._config.maxWidth),l.maxHeight=Ci(this._config.maxHeight)}_togglePointerEvents(l){this._pane.style.pointerEvents=l?"":"none"}_attachBackdrop(){const l="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(l)})}):this._backdropElement.classList.add(l)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const l=this._backdropElement;if(!l)return;let e;const a=()=>{l&&(l.removeEventListener("click",this._backdropClickHandler),l.removeEventListener("transitionend",a),this._disposeBackdrop(l)),this._config.backdropClass&&this._toggleClasses(l,this._config.backdropClass,!1),clearTimeout(e)};l.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{l.addEventListener("transitionend",a)}),l.style.pointerEvents="none",e=this._ngZone.runOutsideAngular(()=>setTimeout(a,500))}_toggleClasses(l,e,a){const _=l.classList;ea(e).forEach(C=>{C&&(a?_.add(C):_.remove(C))})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const l=this._ngZone.onStable.pipe(De((0,jn.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),l.unsubscribe())})})}_disposeScrollStrategy(){const l=this._scrollStrategy;l&&(l.disable(),l.detach&&l.detach())}_disposeBackdrop(l){l&&(l.parentNode&&l.parentNode.removeChild(l),this._backdropElement===l&&(this._backdropElement=null))}}const Vl="cdk-overlay-connected-position-bounding-box",hf=/([A-Za-z%]+)$/;class Pd{constructor(l,e,a,_,C){this._viewportRuler=e,this._document=a,this._platform=_,this._overlayContainer=C,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new ae.xQ,this._resizeSubscription=Sr.w.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(l)}get positions(){return this._preferredPositions}attach(l){this._validatePositions(),l.hostElement.classList.add(Vl),this._overlayRef=l,this._boundingBox=l.hostElement,this._pane=l.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const l=this._originRect,e=this._overlayRect,a=this._viewportRect,_=[];let C;for(let F of this._preferredPositions){let G=this._getOriginPoint(l,F),ot=this._getOverlayPoint(G,e,F),yt=this._getOverlayFit(ot,e,a,F);if(yt.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(F,G);this._canFitWithFlexibleDimensions(yt,ot,a)?_.push({position:F,origin:G,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(G,F)}):(!C||C.overlayFit.visibleArea<yt.visibleArea)&&(C={overlayFit:yt,overlayPoint:ot,originPoint:G,position:F,overlayRect:e})}if(_.length){let F=null,G=-1;for(const ot of _){const yt=ot.boundingBoxRect.width*ot.boundingBoxRect.height*(ot.position.weight||1);yt>G&&(G=yt,F=ot)}return this._isPushed=!1,void this._applyPosition(F.position,F.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(C.position,C.originPoint);this._applyPosition(C.position,C.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&wa(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(Vl),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const l=this._lastPosition||this._preferredPositions[0],e=this._getOriginPoint(this._originRect,l);this._applyPosition(l,e)}}withScrollableContainers(l){return this._scrollables=l,this}withPositions(l){return this._preferredPositions=l,-1===l.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(l){return this._viewportMargin=l,this}withFlexibleDimensions(l=!0){return this._hasFlexibleDimensions=l,this}withGrowAfterOpen(l=!0){return this._growAfterOpen=l,this}withPush(l=!0){return this._canPush=l,this}withLockedPosition(l=!0){return this._positionLocked=l,this}setOrigin(l){return this._origin=l,this}withDefaultOffsetX(l){return this._offsetX=l,this}withDefaultOffsetY(l){return this._offsetY=l,this}withTransformOriginOn(l){return this._transformOriginSelector=l,this}_getOriginPoint(l,e){let a,_;if("center"==e.originX)a=l.left+l.width/2;else{const C=this._isRtl()?l.right:l.left,F=this._isRtl()?l.left:l.right;a="start"==e.originX?C:F}return _="center"==e.originY?l.top+l.height/2:"top"==e.originY?l.top:l.bottom,{x:a,y:_}}_getOverlayPoint(l,e,a){let _,C;return _="center"==a.overlayX?-e.width/2:"start"===a.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,C="center"==a.overlayY?-e.height/2:"top"==a.overlayY?0:-e.height,{x:l.x+_,y:l.y+C}}_getOverlayFit(l,e,a,_){const C=Rd(e);let{x:F,y:G}=l,ot=this._getOffset(_,"x"),yt=this._getOffset(_,"y");ot&&(F+=ot),yt&&(G+=yt);let Si=0-G,mn=G+C.height-a.height,Bn=this._subtractOverflows(C.width,0-F,F+C.width-a.width),Ji=this._subtractOverflows(C.height,Si,mn),Ia=Bn*Ji;return{visibleArea:Ia,isCompletelyWithinViewport:C.width*C.height===Ia,fitsInViewportVertically:Ji===C.height,fitsInViewportHorizontally:Bn==C.width}}_canFitWithFlexibleDimensions(l,e,a){if(this._hasFlexibleDimensions){const _=a.bottom-e.y,C=a.right-e.x,F=df(this._overlayRef.getConfig().minHeight),G=df(this._overlayRef.getConfig().minWidth),yt=l.fitsInViewportHorizontally||null!=G&&G<=C;return(l.fitsInViewportVertically||null!=F&&F<=_)&&yt}return!1}_pushOverlayOnScreen(l,e,a){if(this._previousPushAmount&&this._positionLocked)return{x:l.x+this._previousPushAmount.x,y:l.y+this._previousPushAmount.y};const _=Rd(e),C=this._viewportRect,F=Math.max(l.x+_.width-C.width,0),G=Math.max(l.y+_.height-C.height,0),ot=Math.max(C.top-a.top-l.y,0),yt=Math.max(C.left-a.left-l.x,0);let Ht=0,he=0;return Ht=_.width<=C.width?yt||-F:l.x<this._viewportMargin?C.left-a.left-l.x:0,he=_.height<=C.height?ot||-G:l.y<this._viewportMargin?C.top-a.top-l.y:0,this._previousPushAmount={x:Ht,y:he},{x:l.x+Ht,y:l.y+he}}_applyPosition(l,e){if(this._setTransformOrigin(l),this._setOverlayElementStyles(e,l),this._setBoundingBoxStyles(e,l),l.panelClass&&this._addPanelClasses(l.panelClass),this._lastPosition=l,this._positionChanges.observers.length){const a=this._getScrollVisibility(),_=new Bl(l,a);this._positionChanges.next(_)}this._isInitialRender=!1}_setTransformOrigin(l){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let a,_=l.overlayY;a="center"===l.overlayX?"center":this._isRtl()?"start"===l.overlayX?"right":"left":"start"===l.overlayX?"left":"right";for(let C=0;C<e.length;C++)e[C].style.transformOrigin=`${a} ${_}`}_calculateBoundingBoxRect(l,e){const a=this._viewportRect,_=this._isRtl();let C,F,G,Ht,he,Si;if("top"===e.overlayY)F=l.y,C=a.height-F+this._viewportMargin;else if("bottom"===e.overlayY)G=a.height-l.y+2*this._viewportMargin,C=a.height-G+this._viewportMargin;else{const mn=Math.min(a.bottom-l.y+a.top,l.y),Bn=this._lastBoundingBoxSize.height;C=2*mn,F=l.y-mn,C>Bn&&!this._isInitialRender&&!this._growAfterOpen&&(F=l.y-Bn/2)}if("end"===e.overlayX&&!_||"start"===e.overlayX&&_)Si=a.width-l.x+this._viewportMargin,Ht=l.x-this._viewportMargin;else if("start"===e.overlayX&&!_||"end"===e.overlayX&&_)he=l.x,Ht=a.right-l.x;else{const mn=Math.min(a.right-l.x+a.left,l.x),Bn=this._lastBoundingBoxSize.width;Ht=2*mn,he=l.x-mn,Ht>Bn&&!this._isInitialRender&&!this._growAfterOpen&&(he=l.x-Bn/2)}return{top:F,left:he,bottom:G,right:Si,width:Ht,height:C}}_setBoundingBoxStyles(l,e){const a=this._calculateBoundingBoxRect(l,e);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));const _={};if(this._hasExactPosition())_.top=_.left="0",_.bottom=_.right=_.maxHeight=_.maxWidth="",_.width=_.height="100%";else{const C=this._overlayRef.getConfig().maxHeight,F=this._overlayRef.getConfig().maxWidth;_.height=Ci(a.height),_.top=Ci(a.top),_.bottom=Ci(a.bottom),_.width=Ci(a.width),_.left=Ci(a.left),_.right=Ci(a.right),_.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",_.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",C&&(_.maxHeight=Ci(C)),F&&(_.maxWidth=Ci(F))}this._lastBoundingBoxSize=a,wa(this._boundingBox.style,_)}_resetBoundingBoxStyles(){wa(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){wa(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(l,e){const a={},_=this._hasExactPosition(),C=this._hasFlexibleDimensions,F=this._overlayRef.getConfig();if(_){const Ht=this._viewportRuler.getViewportScrollPosition();wa(a,this._getExactOverlayY(e,l,Ht)),wa(a,this._getExactOverlayX(e,l,Ht))}else a.position="static";let G="",ot=this._getOffset(e,"x"),yt=this._getOffset(e,"y");ot&&(G+=`translateX(${ot}px) `),yt&&(G+=`translateY(${yt}px)`),a.transform=G.trim(),F.maxHeight&&(_?a.maxHeight=Ci(F.maxHeight):C&&(a.maxHeight="")),F.maxWidth&&(_?a.maxWidth=Ci(F.maxWidth):C&&(a.maxWidth="")),wa(this._pane.style,a)}_getExactOverlayY(l,e,a){let _={top:"",bottom:""},C=this._getOverlayPoint(e,this._overlayRect,l);this._isPushed&&(C=this._pushOverlayOnScreen(C,this._overlayRect,a));let F=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return C.y-=F,"bottom"===l.overlayY?_.bottom=this._document.documentElement.clientHeight-(C.y+this._overlayRect.height)+"px":_.top=Ci(C.y),_}_getExactOverlayX(l,e,a){let F,_={left:"",right:""},C=this._getOverlayPoint(e,this._overlayRect,l);return this._isPushed&&(C=this._pushOverlayOnScreen(C,this._overlayRect,a)),F=this._isRtl()?"end"===l.overlayX?"left":"right":"end"===l.overlayX?"right":"left","right"===F?_.right=this._document.documentElement.clientWidth-(C.x+this._overlayRect.width)+"px":_.left=Ci(C.x),_}_getScrollVisibility(){const l=this._getOriginRect(),e=this._pane.getBoundingClientRect(),a=this._scrollables.map(_=>_.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:Tr(l,a),isOriginOutsideView:Kc(l,a),isOverlayClipped:Tr(e,a),isOverlayOutsideView:Kc(e,a)}}_subtractOverflows(l,...e){return e.reduce((a,_)=>a-Math.max(_,0),l)}_getNarrowedViewportRect(){const l=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+l-this._viewportMargin,bottom:a.top+e-this._viewportMargin,width:l-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(l,e){return"x"===e?l.offsetX??this._offsetX:l.offsetY??this._offsetY}_validatePositions(){}_addPanelClasses(l){this._pane&&ea(l).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(l=>{this._pane.classList.remove(l)}),this._appliedPanelClasses=[])}_getOriginRect(){const l=this._origin;if(l instanceof c.SBq)return l.nativeElement.getBoundingClientRect();if(l instanceof Element)return l.getBoundingClientRect();const e=l.width||0,a=l.height||0;return{top:l.y,bottom:l.y+a,left:l.x,right:l.x+e,height:a,width:e}}}function wa(o,l){for(let e in l)l.hasOwnProperty(e)&&(o[e]=l[e]);return o}function df(o){if("number"!=typeof o&&null!=o){const[l,e]=o.split(hf);return e&&"px"!==e?null:parseFloat(l)}return o||null}function Rd(o){return{top:Math.floor(o.top),right:Math.floor(o.right),bottom:Math.floor(o.bottom),left:Math.floor(o.left),width:Math.floor(o.width),height:Math.floor(o.height)}}class Ca{constructor(l,e,a,_,C,F,G){this._preferredPositions=[],this._positionStrategy=new Pd(a,_,C,F,G).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(l,e),this.onPositionChange=this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(l){this._overlayRef=l,this._positionStrategy.attach(l),this._direction&&(l.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(l){this._positionStrategy.withScrollableContainers(l)}withFallbackPosition(l,e,a,_){const C=new Sh(l,e,a,_);return this._preferredPositions.push(C),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(l){return this._overlayRef?this._overlayRef.setDirection(l):this._direction=l,this}withOffsetX(l){return this._positionStrategy.withDefaultOffsetX(l),this}withOffsetY(l){return this._positionStrategy.withDefaultOffsetY(l),this}withLockedPosition(l){return this._positionStrategy.withLockedPosition(l),this}withPositions(l){return this._preferredPositions=l.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(l){return this._positionStrategy.setOrigin(l),this}}const pf="cdk-global-overlay-wrapper";class ws{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(l){const e=l.getConfig();this._overlayRef=l,this._width&&!e.width&&l.updateSize({width:this._width}),this._height&&!e.height&&l.updateSize({height:this._height}),l.hostElement.classList.add(pf),this._isDisposed=!1}top(l=""){return this._bottomOffset="",this._topOffset=l,this._alignItems="flex-start",this}left(l=""){return this._rightOffset="",this._leftOffset=l,this._justifyContent="flex-start",this}bottom(l=""){return this._topOffset="",this._bottomOffset=l,this._alignItems="flex-end",this}right(l=""){return this._leftOffset="",this._rightOffset=l,this._justifyContent="flex-end",this}width(l=""){return this._overlayRef?this._overlayRef.updateSize({width:l}):this._width=l,this}height(l=""){return this._overlayRef?this._overlayRef.updateSize({height:l}):this._height=l,this}centerHorizontally(l=""){return this.left(l),this._justifyContent="center",this}centerVertically(l=""){return this.top(l),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const l=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:_,height:C,maxWidth:F,maxHeight:G}=a,ot=!("100%"!==_&&"100vw"!==_||F&&"100%"!==F&&"100vw"!==F),yt=!("100%"!==C&&"100vh"!==C||G&&"100%"!==G&&"100vh"!==G);l.position=this._cssPosition,l.marginLeft=ot?"0":this._leftOffset,l.marginTop=yt?"0":this._topOffset,l.marginBottom=this._bottomOffset,l.marginRight=this._rightOffset,ot?e.justifyContent="flex-start":"center"===this._justifyContent?e.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?e.justifyContent="flex-end":"flex-end"===this._justifyContent&&(e.justifyContent="flex-start"):e.justifyContent=this._justifyContent,e.alignItems=yt?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const l=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,a=e.style;e.classList.remove(pf),a.justifyContent=a.alignItems=l.marginTop=l.marginBottom=l.marginLeft=l.marginRight=l.position="",this._overlayRef=null,this._isDisposed=!0}}let dg=(()=>{class o{constructor(e,a,_,C){this._viewportRuler=e,this._document=a,this._platform=_,this._overlayContainer=C}global(){return new ws}connectedTo(e,a,_){return new Ca(a,_,e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}flexibleConnectedTo(e){return new Pd(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(lr),c.LFG(Nt.K0),c.LFG(ni),c.LFG(ba))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(lr),c.LFG(Nt.K0),c.LFG(ni),c.LFG(ba))},token:o,providedIn:"root"}),o})(),eu=0,$n=(()=>{class o{constructor(e,a,_,C,F,G,ot,yt,Ht,he,Si){this.scrollStrategies=e,this._overlayContainer=a,this._componentFactoryResolver=_,this._positionBuilder=C,this._keyboardDispatcher=F,this._injector=G,this._ngZone=ot,this._document=yt,this._directionality=Ht,this._location=he,this._outsideClickDispatcher=Si}create(e){const a=this._createHostElement(),_=this._createPaneElement(a),C=this._createPortalOutlet(_),F=new Ah(e);return F.direction=F.direction||this._directionality.value,new uf(C,a,_,F,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(e){const a=this._document.createElement("div");return a.id="cdk-overlay-"+eu++,a.classList.add("cdk-overlay-pane"),e.appendChild(a),a}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(c.z2F)),new Up(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(af),c.LFG(ba),c.LFG(c._Vd),c.LFG(dg),c.LFG(cf),c.LFG(c.zs3),c.LFG(c.R0b),c.LFG(Nt.K0),c.LFG(pn),c.LFG(Nt.Ye),c.LFG(tu))},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac}),o})();const Nl={provide:new c.OlP("cdk-connected-overlay-scroll-strategy"),deps:[$n],useFactory:function pg(o){return()=>o.scrollStrategies.reposition()}};let Ul=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({providers:[$n,Nl],imports:[Mo,Rl,ys,ys]}),o})();var zd=de(3489);class fg{constructor(l,e){this.dueTime=l,this.scheduler=e}call(l,e){return e.subscribe(new mf(l,this.dueTime,this.scheduler))}}class mf extends zd.L{constructor(l,e,a){super(l),this.dueTime=e,this.scheduler=a,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(l){this.clearDebounce(),this.lastValue=l,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(mg,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:l}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(l)}}clearDebounce(){const l=this.debouncedSubscription;null!==l&&(this.remove(l),l.unsubscribe(),this.debouncedSubscription=null)}}function mg(o){o.debouncedNext()}function Bd(o){return l=>l.lift(new gg(o))}class gg{constructor(l){this.total=l}call(l,e){return e.subscribe(new gf(l,this.total))}}class gf extends zd.L{constructor(l,e){super(l),this.total=e,this.count=0}_next(l){++this.count>this.total&&this.destination.next(l)}}let Vd=(()=>{class o{create(e){return typeof MutationObserver>"u"?null:new MutationObserver(e)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=c.Yz7({factory:function(){return new o},token:o,providedIn:"root"}),o})(),jl=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({providers:[Vd]}),o})(),wf=(()=>{class o{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function Cf(o){return!!(o.offsetWidth||o.offsetHeight||"function"==typeof o.getClientRects&&o.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const a=function xg(o){try{return o.frameElement}catch{return null}}(function Sf(o){return o.ownerDocument&&o.ownerDocument.defaultView||window}(e));if(a&&(-1===Bo(a)||!this.isVisible(a)))return!1;let _=e.nodeName.toLowerCase(),C=Bo(e);return e.hasAttribute("contenteditable")?-1!==C:!("iframe"===_||"object"===_||this._platform.WEBKIT&&this._platform.IOS&&!function Ih(o){let l=o.nodeName.toLowerCase(),e="input"===l&&o.type;return"text"===e||"password"===e||"select"===l||"textarea"===l}(e))&&("audio"===_?!!e.hasAttribute("controls")&&-1!==C:"video"===_?-1!==C&&(null!==C||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,a){return function Af(o){return!function Mf(o){return function Qr(o){return"input"==o.nodeName.toLowerCase()}(o)&&"hidden"==o.type}(o)&&(function vg(o){let l=o.nodeName.toLowerCase();return"input"===l||"select"===l||"button"===l||"textarea"===l}(o)||function hr(o){return function Cs(o){return"a"==o.nodeName.toLowerCase()}(o)&&o.hasAttribute("href")}(o)||o.hasAttribute("contenteditable")||kr(o))}(e)&&!this.isDisabled(e)&&(a?.ignoreVisibility||this.isVisible(e))}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(ni))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(ni))},token:o,providedIn:"root"}),o})();function kr(o){if(!o.hasAttribute("tabindex")||void 0===o.tabIndex)return!1;let l=o.getAttribute("tabindex");return"-32768"!=l&&!(!l||isNaN(parseInt(l,10)))}function Bo(o){if(!kr(o))return null;const l=parseInt(o.getAttribute("tabindex")||"",10);return isNaN(l)?-1:l}class Ef{constructor(l,e,a,_,C=!1){this._element=l,this._checker=e,this._ngZone=a,this._document=_,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,C||this.attachAnchors()}get enabled(){return this._enabled}set enabled(l){this._enabled=l,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(l,this._startAnchor),this._toggleAnchorTabIndex(l,this._endAnchor))}destroy(){const l=this._startAnchor,e=this._endAnchor;l&&(l.removeEventListener("focus",this.startAnchorListener),l.parentNode&&l.parentNode.removeChild(l)),e&&(e.removeEventListener("focus",this.endAnchorListener),e.parentNode&&e.parentNode.removeChild(e)),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(l){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(l)))})}focusFirstTabbableElementWhenReady(l){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(l)))})}focusLastTabbableElementWhenReady(l){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(l)))})}_getRegionBoundary(l){let e=this._element.querySelectorAll(`[cdk-focus-region-${l}], [cdkFocusRegion${l}], [cdk-focus-${l}]`);for(let a=0;a<e.length;a++)e[a].hasAttribute(`cdk-focus-${l}`)?console.warn(`Found use of deprecated attribute 'cdk-focus-${l}', use 'cdkFocusRegion${l}' instead. The deprecated attribute will be removed in 8.0.0.`,e[a]):e[a].hasAttribute(`cdk-focus-region-${l}`)&&console.warn(`Found use of deprecated attribute 'cdk-focus-region-${l}', use 'cdkFocusRegion${l}' instead. The deprecated attribute will be removed in 8.0.0.`,e[a]);return"start"==l?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(l){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(e.hasAttribute("cdk-focus-initial")&&console.warn("Found use of deprecated attribute 'cdk-focus-initial', use 'cdkFocusInitial' instead. The deprecated attribute will be removed in 8.0.0",e),!this._checker.isFocusable(e)){const a=this._getFirstTabbableElement(e);return a?.focus(l),!!a}return e.focus(l),!0}return this.focusFirstTabbableElement(l)}focusFirstTabbableElement(l){const e=this._getRegionBoundary("start");return e&&e.focus(l),!!e}focusLastTabbableElement(l){const e=this._getRegionBoundary("end");return e&&e.focus(l),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(l){if(this._checker.isFocusable(l)&&this._checker.isTabbable(l))return l;let e=l.children||l.childNodes;for(let a=0;a<e.length;a++){let _=e[a].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[a]):null;if(_)return _}return null}_getLastTabbableElement(l){if(this._checker.isFocusable(l)&&this._checker.isTabbable(l))return l;let e=l.children||l.childNodes;for(let a=e.length-1;a>=0;a--){let _=e[a].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[a]):null;if(_)return _}return null}_createAnchor(){const l=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,l),l.classList.add("cdk-visually-hidden"),l.classList.add("cdk-focus-trap-anchor"),l.setAttribute("aria-hidden","true"),l}_toggleAnchorTabIndex(l,e){l?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(l){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(l,this._startAnchor),this._toggleAnchorTabIndex(l,this._endAnchor))}_executeOnStable(l){this._ngZone.isStable?l():this._ngZone.onStable.pipe((0,li.q)(1)).subscribe(l)}}let au=(()=>{class o{constructor(e,a,_){this._checker=e,this._ngZone=a,this._document=_}create(e,a=!1){return new Ef(e,this._checker,this._ngZone,this._document,a)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(wf),c.LFG(c.R0b),c.LFG(Nt.K0))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(wf),c.LFG(c.R0b),c.LFG(Nt.K0))},token:o,providedIn:"root"}),o})();function lu(o){return 0===o.offsetX&&0===o.offsetY}function Ff(o){const l=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0];return!(!l||-1!==l.identifier||null!=l.radiusX&&1!==l.radiusX||null!=l.radiusY&&1!==l.radiusY)}typeof Element<"u"&&Element;const Sa=new c.OlP("cdk-input-modality-detector-options"),Nd={ignoreKeys:[18,17,224,91,16]},Tn=oh({passive:!0,capture:!0});let Oh=(()=>{class o{constructor(e,a,_,C){this._platform=e,this._mostRecentTarget=null,this._modality=new Qo.X(null),this._lastTouchMs=0,this._onKeydown=F=>{var G,ot;null!==(ot=null===(G=this._options)||void 0===G?void 0:G.ignoreKeys)&&void 0!==ot&&ot.some(yt=>yt===F.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=_s(F))},this._onMousedown=F=>{Date.now()-this._lastTouchMs<650||(this._modality.next(lu(F)?"keyboard":"mouse"),this._mostRecentTarget=_s(F))},this._onTouchstart=F=>{Ff(F)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=_s(F))},this._options=Object.assign(Object.assign({},Nd),C),this.modalityDetected=this._modality.pipe(Bd(1)),this.modalityChanged=this.modalityDetected.pipe((0,zc.x)()),e.isBrowser&&a.runOutsideAngular(()=>{_.addEventListener("keydown",this._onKeydown,Tn),_.addEventListener("mousedown",this._onMousedown,Tn),_.addEventListener("touchstart",this._onTouchstart,Tn)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Tn),document.removeEventListener("mousedown",this._onMousedown,Tn),document.removeEventListener("touchstart",this._onTouchstart,Tn))}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(ni),c.LFG(c.R0b),c.LFG(Nt.K0),c.LFG(Sa,8))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(ni),c.LFG(c.R0b),c.LFG(Nt.K0),c.LFG(Sa,8))},token:o,providedIn:"root"}),o})();const Lh=new c.OlP("liveAnnouncerElement",{providedIn:"root",factory:function Dr(){return null}}),Ms=new c.OlP("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let cu=(()=>{class o{constructor(e,a,_,C){this._ngZone=a,this._defaultOptions=C,this._document=_,this._liveElement=e||this._createLiveElement()}announce(e,...a){const _=this._defaultOptions;let C,F;return 1===a.length&&"number"==typeof a[0]?F=a[0]:[C,F]=a,this.clear(),clearTimeout(this._previousTimeout),C||(C=_&&_.politeness?_.politeness:"polite"),null==F&&_&&(F=_.duration),this._liveElement.setAttribute("aria-live",C),this._ngZone.runOutsideAngular(()=>new Promise(G=>{clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,G(),"number"==typeof F&&(this._previousTimeout=setTimeout(()=>this.clear(),F))},100)}))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement&&this._liveElement.parentNode&&(this._liveElement.parentNode.removeChild(this._liveElement),this._liveElement=null)}_createLiveElement(){const e="cdk-live-announcer-element",a=this._document.getElementsByClassName(e),_=this._document.createElement("div");for(let C=0;C<a.length;C++)a[C].parentNode.removeChild(a[C]);return _.classList.add(e),_.classList.add("cdk-visually-hidden"),_.setAttribute("aria-atomic","true"),_.setAttribute("aria-live","polite"),this._document.body.appendChild(_),_}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Lh,8),c.LFG(c.R0b),c.LFG(Nt.K0),c.LFG(Ms,8))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(Lh,8),c.LFG(c.R0b),c.LFG(Nt.K0),c.LFG(Ms,8))},token:o,providedIn:"root"}),o})();const Hl=new c.OlP("cdk-focus-monitor-default-options"),Ea=oh({passive:!0,capture:!0});let As=(()=>{class o{constructor(e,a,_,C,F){this._ngZone=e,this._platform=a,this._inputModalityDetector=_,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new ae.xQ,this._rootNodeFocusAndBlurListener=G=>{const ot=_s(G),yt="focus"===G.type?this._onFocus:this._onBlur;for(let Ht=ot;Ht;Ht=Ht.parentElement)yt.call(this,G,Ht)},this._document=C,this._detectionMode=F?.detectionMode||0}monitor(e,a=!1){const _=Gi(e);if(!this._platform.isBrowser||1!==_.nodeType)return(0,Ar.of)(null);const C=function lh(o){if(function ah(){if(null==sh){const o=typeof document<"u"?document.head:null;sh=!(!o||!o.createShadowRoot&&!o.attachShadow)}return sh}()){const l=o.getRootNode?o.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&l instanceof ShadowRoot)return l}return null}(_)||this._getDocument(),F=this._elementInfo.get(_);if(F)return a&&(F.checkChildren=!0),F.subject;const G={checkChildren:a,subject:new ae.xQ,rootNode:C};return this._elementInfo.set(_,G),this._registerGlobalListeners(G),G.subject}stopMonitoring(e){const a=Gi(e),_=this._elementInfo.get(a);_&&(_.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(_))}focusVia(e,a,_){const C=Gi(e);C===this._getDocument().activeElement?this._getClosestElementsInfo(C).forEach(([G,ot])=>this._originChanged(G,a,ot)):(this._setOrigin(a),"function"==typeof C.focus&&C.focus(_))}ngOnDestroy(){this._elementInfo.forEach((e,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_toggleClass(e,a,_){_?e.classList.add(a):e.classList.remove(a)}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,a){this._toggleClass(e,"cdk-focused",!!a),this._toggleClass(e,"cdk-touch-focused","touch"===a),this._toggleClass(e,"cdk-keyboard-focused","keyboard"===a),this._toggleClass(e,"cdk-mouse-focused","mouse"===a),this._toggleClass(e,"cdk-program-focused","program"===a)}_setOrigin(e,a=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&a,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,a){const _=this._elementInfo.get(a),C=_s(e);!_||!_.checkChildren&&a!==C||this._originChanged(a,this._getFocusOrigin(C),_)}_onBlur(e,a){const _=this._elementInfo.get(a);!_||_.checkChildren&&e.relatedTarget instanceof Node&&a.contains(e.relatedTarget)||(this._setClasses(a),this._emitOrigin(_.subject,null))}_emitOrigin(e,a){this._ngZone.run(()=>e.next(a))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const a=e.rootNode,_=this._rootNodeFocusListenerCount.get(a)||0;_||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,Ea),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,Ea)}),this._rootNodeFocusListenerCount.set(a,_+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(De(this._stopInputModalityDetector)).subscribe(C=>{this._setOrigin(C,!0)}))}_removeGlobalListeners(e){const a=e.rootNode;if(this._rootNodeFocusListenerCount.has(a)){const _=this._rootNodeFocusListenerCount.get(a);_>1?this._rootNodeFocusListenerCount.set(a,_-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Ea),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Ea),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,a,_){this._setClasses(e,a),this._emitOrigin(_.subject,a),this._lastFocusOrigin=a}_getClosestElementsInfo(e){const a=[];return this._elementInfo.forEach((_,C)=>{(C===e||_.checkChildren&&C.contains(e))&&a.push([C,_])}),a}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(c.R0b),c.LFG(ni),c.LFG(Oh),c.LFG(Nt.K0,8),c.LFG(Hl,8))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(c.R0b),c.LFG(ni),c.LFG(Oh),c.LFG(Nt.K0,8),c.LFG(Hl,8))},token:o,providedIn:"root"}),o})();const Of="cdk-high-contrast-black-on-white",Ud="cdk-high-contrast-white-on-black",jd="cdk-high-contrast-active";let Ph=(()=>{class o{constructor(e,a){this._platform=e,this._document=a}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const a=this._document.defaultView||window,_=a&&a.getComputedStyle?a.getComputedStyle(e):null,C=(_&&_.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(e),C){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(jd),e.remove(Of),e.remove(Ud),this._hasCheckedHighContrastMode=!0;const a=this.getHighContrastMode();1===a?(e.add(jd),e.add(Of)):2===a&&(e.add(jd),e.add(Ud))}}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(ni),c.LFG(Nt.K0))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(ni),c.LFG(Nt.K0))},token:o,providedIn:"root"}),o})();const Hd=new c.GfV("12.2.13"),b=new c.GfV("12.2.13"),S=new c.OlP("mat-sanity-checks",{providedIn:"root",factory:function w(){return!0}});let nt,T=(()=>{class o{constructor(e,a,_){this._hasDoneGlobalChecks=!1,this._document=_,e._applyBodyHighContrastModeCssClasses(),this._sanityChecks=a,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!(!(0,c.X6Q)()||ch())&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}_checkDoctypeIsDefined(){this._checkIsEnabled("doctype")&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checkIsEnabled("theme")||!this._document.body||"function"!=typeof getComputedStyle)return;const e=this._document.createElement("div");e.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(e);const a=getComputedStyle(e);a&&"none"!==a.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(e)}_checkCdkVersionMatch(){this._checkIsEnabled("version")&&b.full!==Hd.full&&console.warn("The Angular Material version ("+b.full+") does not match the Angular CDK version ("+Hd.full+").\nPlease ensure the versions of these two packages exactly match.")}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Ph),c.LFG(S,8),c.LFG(Nt.K0))},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Mo,Mo]}),o})();function k(o){return class extends o{constructor(...l){super(...l),this._disabled=!1}get disabled(){return this._disabled}set disabled(l){this._disabled=me(l)}}}function O(o,l){return class extends o{constructor(...e){super(...e),this.defaultColor=l,this.color=l}get color(){return this._color}set color(e){const a=e||this.defaultColor;a!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),a&&this._elementRef.nativeElement.classList.add(`mat-${a}`),this._color=a)}}}function L(o){return class extends o{constructor(...l){super(...l),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(l){this._disableRipple=me(l)}}}try{nt=typeof Intl<"u"}catch{nt=!1}let ge=(()=>{class o{isErrorState(e,a){return!!(e&&e.invalid&&(e.touched||a&&a.submitted))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=c.Yz7({factory:function(){return new o},token:o,providedIn:"root"}),o})(),ue=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[T,T]}),o})();class Xt{constructor(l,e,a){this._renderer=l,this.element=e,this.config=a,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const Xe={enterDuration:225,exitDuration:150},oi=oh({passive:!0}),Ce=["mousedown","touchstart"],Le=["mouseup","mouseleave","touchend","touchcancel"];class ti{constructor(l,e,a,_){this._target=l,this._ngZone=e,this._isPointerDown=!1,this._activeRipples=new Set,this._pointerUpEventsRegistered=!1,_.isBrowser&&(this._containerElement=Gi(a))}fadeInRipple(l,e,a={}){const _=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),C=Object.assign(Object.assign({},Xe),a.animation);a.centered&&(l=_.left+_.width/2,e=_.top+_.height/2);const F=a.radius||function $e(o,l,e){const a=Math.max(Math.abs(o-e.left),Math.abs(o-e.right)),_=Math.max(Math.abs(l-e.top),Math.abs(l-e.bottom));return Math.sqrt(a*a+_*_)}(l,e,_),G=l-_.left,ot=e-_.top,yt=C.enterDuration,Ht=document.createElement("div");Ht.classList.add("mat-ripple-element"),Ht.style.left=G-F+"px",Ht.style.top=ot-F+"px",Ht.style.height=2*F+"px",Ht.style.width=2*F+"px",null!=a.color&&(Ht.style.backgroundColor=a.color),Ht.style.transitionDuration=`${yt}ms`,this._containerElement.appendChild(Ht),function Ke(o){window.getComputedStyle(o).getPropertyValue("opacity")}(Ht),Ht.style.transform="scale(1)";const he=new Xt(this,Ht,a);return he.state=0,this._activeRipples.add(he),a.persistent||(this._mostRecentTransientRipple=he),this._runTimeoutOutsideZone(()=>{const Si=he===this._mostRecentTransientRipple;he.state=1,!a.persistent&&(!Si||!this._isPointerDown)&&he.fadeOut()},yt),he}fadeOutRipple(l){const e=this._activeRipples.delete(l);if(l===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),!e)return;const a=l.element,_=Object.assign(Object.assign({},Xe),l.config.animation);a.style.transitionDuration=`${_.exitDuration}ms`,a.style.opacity="0",l.state=2,this._runTimeoutOutsideZone(()=>{l.state=3,a.parentNode.removeChild(a)},_.exitDuration)}fadeOutAll(){this._activeRipples.forEach(l=>l.fadeOut())}fadeOutAllNonPersistent(){this._activeRipples.forEach(l=>{l.config.persistent||l.fadeOut()})}setupTriggerEvents(l){const e=Gi(l);!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,this._registerEvents(Ce))}handleEvent(l){"mousedown"===l.type?this._onMousedown(l):"touchstart"===l.type?this._onTouchStart(l):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(Le),this._pointerUpEventsRegistered=!0)}_onMousedown(l){const e=lu(l),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!e&&!a&&(this._isPointerDown=!0,this.fadeInRipple(l.clientX,l.clientY,this._target.rippleConfig))}_onTouchStart(l){if(!this._target.rippleDisabled&&!Ff(l)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const e=l.changedTouches;for(let a=0;a<e.length;a++)this.fadeInRipple(e[a].clientX,e[a].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._activeRipples.forEach(l=>{!l.config.persistent&&(1===l.state||l.config.terminateOnPointerUp&&0===l.state)&&l.fadeOut()}))}_runTimeoutOutsideZone(l,e=0){this._ngZone.runOutsideAngular(()=>setTimeout(l,e))}_registerEvents(l){this._ngZone.runOutsideAngular(()=>{l.forEach(e=>{this._triggerElement.addEventListener(e,this,oi)})})}_removeTriggerEvents(){this._triggerElement&&(Ce.forEach(l=>{this._triggerElement.removeEventListener(l,this,oi)}),this._pointerUpEventsRegistered&&Le.forEach(l=>{this._triggerElement.removeEventListener(l,this,oi)}))}}const ci=new c.OlP("mat-ripple-global-options");let qe=(()=>{class o{constructor(e,a,_,C,F){this._elementRef=e,this._animationMode=F,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=C||{},this._rippleRenderer=new ti(this,a,e,_)}get disabled(){return this._disabled}set disabled(e){e&&this.fadeOutAllNonPersistent(),this._disabled=e,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign(Object.assign(Object.assign({},this._globalOptions.animation),"NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(e,a=0,_){return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,a,Object.assign(Object.assign({},this.rippleConfig),_)):this._rippleRenderer.fadeInRipple(0,0,Object.assign(Object.assign({},this.rippleConfig),e))}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(c.R0b),c.Y36(ni),c.Y36(ci,8),c.Y36(c.QbO,8))},o.\u0275dir=c.lG2({type:o,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(e,a){2&e&&c.ekj("mat-ripple-unbounded",a.unbounded)},inputs:{radius:["matRippleRadius","radius"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"],color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],animation:["matRippleAnimation","animation"]},exportAs:["matRipple"]}),o})(),ki=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[T,Dl,T]}),o})(),ke=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[T]}),o})(),to=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[ki,Nt.ez,T,ke]}),o})();const Ta=["mat-button",""],ql=["*"],Pf=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],Rf=O(k(L(class{constructor(o){this._elementRef=o}})));let $l=(()=>{class o extends Rf{constructor(e,a,_){super(e),this._focusMonitor=a,this._animationMode=_,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const C of Pf)this._hasHostAttributes(C)&&this._getHostElement().classList.add(C);e.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,a){e?this._focusMonitor.focusVia(this._getHostElement(),e,a):this._getHostElement().focus(a)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...e){return e.some(a=>this._getHostElement().hasAttribute(a))}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(As),c.Y36(c.QbO,8))},o.\u0275cmp=c.Xpm({type:o,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(e,a){if(1&e&&c.Gf(qe,5),2&e){let _;c.iGM(_=c.CRH())&&(a.ripple=_.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(e,a){2&e&&(c.uIk("disabled",a.disabled||null),c.ekj("_mat-animation-noopable","NoopAnimations"===a._animationMode)("mat-button-disabled",a.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[c.qOj],attrs:Ta,ngContentSelectors:ql,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(e,a){1&e&&(c.F$t(),c.TgZ(0,"span",0),c.Hsn(1),c.qZA(),c._UZ(2,"span",1)(3,"span",2)),2&e&&(c.xp6(2),c.ekj("mat-button-ripple-round",a.isRoundButton||a.isIconButton),c.Q6J("matRippleDisabled",a._isRippleDisabled())("matRippleCentered",a.isIconButton)("matRippleTrigger",a._getHostElement()))},dependencies:[qe],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}.cdk-high-contrast-active .mat-button-base.cdk-keyboard-focused,.cdk-high-contrast-active .mat-button-base.cdk-program-focused{outline:solid 3px}\n"],encapsulation:2,changeDetection:0}),o})(),Ir=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[ki,T,T]}),o})();var pe=de(7340),ka=de(3426),qd=de(1221);const Vo=new Set;let Ss,Vf=(()=>{class o{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):zn}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function Rn(o){if(!Vo.has(o))try{Ss||(Ss=document.createElement("style"),Ss.setAttribute("type","text/css"),document.head.appendChild(Ss)),Ss.sheet&&(Ss.sheet.insertRule(`@media ${o} {body{ }}`,0),Vo.add(o))}catch(l){console.error(l)}}(e),this._matchMedia(e)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(ni))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(ni))},token:o,providedIn:"root"}),o})();function zn(o){return{matches:"all"===o||""===o,media:o,addListener:()=>{},removeListener:()=>{}}}let Yl=(()=>{class o{constructor(e,a){this._mediaMatcher=e,this._zone=a,this._queries=new Map,this._destroySubject=new ae.xQ}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return Rh(ea(e)).some(_=>this._registerQuery(_).mql.matches)}observe(e){const _=Rh(ea(e)).map(F=>this._registerQuery(F).observable);let C=(0,ka.aj)(_);return C=(0,qd.z)(C.pipe((0,li.q)(1)),C.pipe(Bd(1),function nu(o,l=fd.P){return e=>e.lift(new fg(o,l))}(0))),C.pipe((0,ui.U)(F=>{const G={matches:!1,breakpoints:{}};return F.forEach(({matches:ot,query:yt})=>{G.matches=G.matches||ot,G.breakpoints[yt]=ot}),G}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const a=this._mediaMatcher.matchMedia(e),C={observable:new zt.y(F=>{const G=ot=>this._zone.run(()=>F.next(ot));return a.addListener(G),()=>{a.removeListener(G)}}).pipe((0,En.O)(a),(0,ui.U)(({matches:F})=>({query:e,matches:F})),De(this._destroySubject)),mql:a};return this._queries.set(e,C),C}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(Vf),c.LFG(c.R0b))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(Vf),c.LFG(c.R0b))},token:o,providedIn:"root"}),o})();function Rh(o){return o.map(l=>l.split(",")).reduce((l,e)=>l.concat(e)).map(l=>l.trim())}function Da(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"div",1)(1,"button",2),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.action())}),c._uU(2),c.qZA()()}if(2&o){const e=c.oxw();c.xp6(2),c.Oqu(e.data.action)}}function Iy(o,l){}const B_=new c.OlP("MatSnackBarData");class Nf{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}}const Fy=Math.pow(2,31)-1;class Tg{constructor(l,e){this._overlayRef=e,this._afterDismissed=new ae.xQ,this._afterOpened=new ae.xQ,this._onAction=new ae.xQ,this._dismissedByAction=!1,this.containerInstance=l,this.onAction().subscribe(()=>this.dismiss()),l._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(l){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(l,Fy))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}}let Oy=(()=>{class o{constructor(e,a){this.snackBarRef=e,this.data=a}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(Tg),c.Y36(B_))},o.\u0275cmp=c.Xpm({type:o,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-simple-snackbar"],decls:3,vars:2,consts:[["class","mat-simple-snackbar-action",4,"ngIf"],[1,"mat-simple-snackbar-action"],["mat-button","",3,"click"]],template:function(e,a){1&e&&(c.TgZ(0,"span"),c._uU(1),c.qZA(),c.YNc(2,Da,3,1,"div",0)),2&e&&(c.xp6(1),c.Oqu(a.data.message),c.xp6(1),c.Q6J("ngIf",a.hasAction))},dependencies:[Nt.O5,$l],styles:[".mat-simple-snackbar{display:flex;justify-content:space-between;align-items:center;line-height:20px;opacity:1}.mat-simple-snackbar-action{flex-shrink:0;margin:-8px -8px -8px 8px}.mat-simple-snackbar-action button{max-height:36px;min-width:0}[dir=rtl] .mat-simple-snackbar-action{margin-left:-8px;margin-right:8px}\n"],encapsulation:2,changeDetection:0}),o})();const Ly={snackBarState:(0,pe.X$)("state",[(0,pe.SB)("void, hidden",(0,pe.oB)({transform:"scale(0.8)",opacity:0})),(0,pe.SB)("visible",(0,pe.oB)({transform:"scale(1)",opacity:1})),(0,pe.eR)("* => visible",(0,pe.jt)("150ms cubic-bezier(0, 0, 0.2, 1)")),(0,pe.eR)("* => void, * => hidden",(0,pe.jt)("75ms cubic-bezier(0.4, 0.0, 1, 1)",(0,pe.oB)({opacity:0})))])};let Py=(()=>{class o extends Hc{constructor(e,a,_,C,F){super(),this._ngZone=e,this._elementRef=a,this._changeDetectorRef=_,this._platform=C,this.snackBarConfig=F,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new ae.xQ,this._onExit=new ae.xQ,this._onEnter=new ae.xQ,this._animationState="void",this.attachDomPortal=G=>(this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachDomPortal(G)),this._live="assertive"!==F.politeness||F.announcementMessage?"off"===F.politeness?"off":"polite":"assertive",this._platform.FIREFOX&&("polite"===this._live&&(this._role="status"),"assertive"===this._live&&(this._role="alert"))}attachComponentPortal(e){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachComponentPortal(e)}attachTemplatePortal(e){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachTemplatePortal(e)}onAnimationEnd(e){const{fromState:a,toState:_}=e;if(("void"===_&&"void"!==a||"hidden"===_)&&this._completeExit(),"visible"===_){const C=this._onEnter;this._ngZone.run(()=>{C.next(),C.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe((0,li.q)(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_applySnackBarClasses(){const e=this._elementRef.nativeElement,a=this.snackBarConfig.panelClass;a&&(Array.isArray(a)?a.forEach(_=>e.classList.add(_)):e.classList.add(a)),"center"===this.snackBarConfig.horizontalPosition&&e.classList.add("mat-snack-bar-center"),"top"===this.snackBarConfig.verticalPosition&&e.classList.add("mat-snack-bar-top")}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector("[aria-hidden]"),a=this._elementRef.nativeElement.querySelector("[aria-live]");if(e&&a){let _=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&e.contains(document.activeElement)&&(_=document.activeElement),e.removeAttribute("aria-hidden"),a.appendChild(e),_?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.R0b),c.Y36(c.SBq),c.Y36(c.sBO),c.Y36(ni),c.Y36(Nf))},o.\u0275cmp=c.Xpm({type:o,selectors:[["snack-bar-container"]],viewQuery:function(e,a){if(1&e&&c.Gf(Pl,7),2&e){let _;c.iGM(_=c.CRH())&&(a._portalOutlet=_.first)}},hostAttrs:[1,"mat-snack-bar-container"],hostVars:1,hostBindings:function(e,a){1&e&&c.WFA("@state.done",function(C){return a.onAnimationEnd(C)}),2&e&&c.d8E("@state",a._animationState)},features:[c.qOj],decls:3,vars:2,consts:[["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(e,a){1&e&&(c.TgZ(0,"div",0),c.YNc(1,Iy,0,0,"ng-template",1),c.qZA(),c._UZ(2,"div")),2&e&&(c.xp6(2),c.uIk("aria-live",a._live)("role",a._role))},dependencies:[Pl],styles:[".mat-snack-bar-container{border-radius:4px;box-sizing:border-box;display:block;margin:24px;max-width:33vw;min-width:344px;padding:14px 16px;min-height:48px;transform-origin:center}.cdk-high-contrast-active .mat-snack-bar-container{border:solid 1px}.mat-snack-bar-handset{width:100%}.mat-snack-bar-handset .mat-snack-bar-container{margin:8px;max-width:100%;min-width:0;width:100%}\n"],encapsulation:2,data:{animation:[Ly.snackBarState]}}),o})(),V_=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Ul,Rl,Nt.ez,Ir,T,T]}),o})();const G_=new c.OlP("mat-snack-bar-default-options",{providedIn:"root",factory:function Ry(){return new Nf}});let zy=(()=>{class o{constructor(e,a,_,C,F,G){this._overlay=e,this._live=a,this._injector=_,this._breakpointObserver=C,this._parentSnackBar=F,this._defaultConfig=G,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=Oy,this.snackBarContainerComponent=Py,this.handsetCssClass="mat-snack-bar-handset"}get _openedSnackBarRef(){const e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}openFromComponent(e,a){return this._attach(e,a)}openFromTemplate(e,a){return this._attach(e,a)}open(e,a="",_){const C=Object.assign(Object.assign({},this._defaultConfig),_);return C.data={message:e,action:a},C.announcementMessage===e&&(C.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,C)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,a){const C=c.zs3.create({parent:a&&a.viewContainerRef&&a.viewContainerRef.injector||this._injector,providers:[{provide:Nf,useValue:a}]}),F=new Ll(this.snackBarContainerComponent,a.viewContainerRef,C),G=e.attach(F);return G.instance.snackBarConfig=a,G.instance}_attach(e,a){const _=Object.assign(Object.assign(Object.assign({},new Nf),this._defaultConfig),a),C=this._createOverlay(_),F=this._attachSnackBarContainer(C,_),G=new Tg(F,C);if(e instanceof c.Rgc){const ot=new jc(e,null,{$implicit:_.data,snackBarRef:G});G.instance=F.attachTemplatePortal(ot)}else{const ot=this._createInjector(_,G),yt=new Ll(e,void 0,ot),Ht=F.attachComponentPortal(yt);G.instance=Ht.instance}return this._breakpointObserver.observe("(max-width: 599.98px) and (orientation: portrait)").pipe(De(C.detachments())).subscribe(ot=>{const yt=C.overlayElement.classList;ot.matches?yt.add(this.handsetCssClass):yt.remove(this.handsetCssClass)}),_.announcementMessage&&F._onAnnounce.subscribe(()=>{this._live.announce(_.announcementMessage,_.politeness)}),this._animateSnackBar(G,_),this._openedSnackBarRef=G,this._openedSnackBarRef}_animateSnackBar(e,a){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),a.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter(),a.duration&&a.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(a.duration))}_createOverlay(e){const a=new Ah;a.direction=e.direction;let _=this._overlay.position().global();const C="rtl"===e.direction,F="left"===e.horizontalPosition||"start"===e.horizontalPosition&&!C||"end"===e.horizontalPosition&&C,G=!F&&"center"!==e.horizontalPosition;return F?_.left("0"):G?_.right("0"):_.centerHorizontally(),"top"===e.verticalPosition?_.top("0"):_.bottom("0"),a.positionStrategy=_,this._overlay.create(a)}_createInjector(e,a){return c.zs3.create({parent:e&&e.viewContainerRef&&e.viewContainerRef.injector||this._injector,providers:[{provide:Tg,useValue:a},{provide:B_,useValue:e.data}]})}}return o.\u0275fac=function(e){return new(e||o)(c.LFG($n),c.LFG(cu),c.LFG(c.zs3),c.LFG(Yl),c.LFG(o,12),c.LFG(G_))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG($n),c.LFG(cu),c.LFG(c.gxx),c.LFG(Yl),c.LFG(o,12),c.LFG(G_))},token:o,providedIn:V_}),o})();var By=de(1737),Vy=de(7221),Gy=de(537),Ny=de(2474);const Uy=["*"];function N_(o){return Error(`Unable to find icon with the name "${o}"`)}function U_(o){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${o}".`)}function j_(o){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${o}".`)}class uu{constructor(l,e,a){this.url=l,this.svgText=e,this.options=a}}let Uf=(()=>{class o{constructor(e,a,_,C){this._httpClient=e,this._sanitizer=a,this._errorHandler=C,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass="material-icons",this._document=_}addSvgIcon(e,a,_){return this.addSvgIconInNamespace("",e,a,_)}addSvgIconLiteral(e,a,_){return this.addSvgIconLiteralInNamespace("",e,a,_)}addSvgIconInNamespace(e,a,_,C){return this._addSvgIconConfig(e,a,new uu(_,null,C))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,a,_,C){const F=this._sanitizer.sanitize(c.q3G.HTML,_);if(!F)throw j_(_);return this._addSvgIconConfig(e,a,new uu("",F,C))}addSvgIconSet(e,a){return this.addSvgIconSetInNamespace("",e,a)}addSvgIconSetLiteral(e,a){return this.addSvgIconSetLiteralInNamespace("",e,a)}addSvgIconSetInNamespace(e,a,_){return this._addSvgIconSetConfig(e,new uu(a,null,_))}addSvgIconSetLiteralInNamespace(e,a,_){const C=this._sanitizer.sanitize(c.q3G.HTML,a);if(!C)throw j_(a);return this._addSvgIconSetConfig(e,new uu("",C,_))}registerFontClassAlias(e,a=e){return this._fontCssClassesByAlias.set(e,a),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const a=this._sanitizer.sanitize(c.q3G.RESOURCE_URL,e);if(!a)throw U_(e);const _=this._cachedIconsByUrl.get(a);return _?(0,Ar.of)(jf(_)):this._loadSvgIconFromConfig(new uu(e,null)).pipe((0,_o.b)(C=>this._cachedIconsByUrl.set(a,C)),(0,ui.U)(C=>jf(C)))}getNamedSvgIcon(e,a=""){const _=H_(a,e);let C=this._svgIconConfigs.get(_);if(C)return this._getSvgFromConfig(C);if(C=this._getIconConfigFromResolvers(a,e),C)return this._svgIconConfigs.set(_,C),this._getSvgFromConfig(C);const F=this._iconSetConfigs.get(a);return F?this._getSvgFromIconSetConfigs(e,F):(0,By._)(N_(_))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?(0,Ar.of)(jf(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe((0,ui.U)(a=>jf(a)))}_getSvgFromIconSetConfigs(e,a){const _=this._extractIconWithNameFromAnySet(e,a);return _?(0,Ar.of)(_):Se(a.filter(F=>!F.svgText).map(F=>this._loadSvgIconSetFromConfig(F).pipe((0,Vy.K)(G=>{const yt=`Loading icon set URL: ${this._sanitizer.sanitize(c.q3G.RESOURCE_URL,F.url)} failed: ${G.message}`;return this._errorHandler.handleError(new Error(yt)),(0,Ar.of)(null)})))).pipe((0,ui.U)(()=>{const F=this._extractIconWithNameFromAnySet(e,a);if(!F)throw N_(e);return F}))}_extractIconWithNameFromAnySet(e,a){for(let _=a.length-1;_>=0;_--){const C=a[_];if(C.svgText&&C.svgText.indexOf(e)>-1){const F=this._svgElementFromConfig(C),G=this._extractSvgIconFromSet(F,e,C.options);if(G)return G}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe((0,_o.b)(a=>e.svgText=a),(0,ui.U)(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?(0,Ar.of)(null):this._fetchIcon(e).pipe((0,_o.b)(a=>e.svgText=a))}_extractSvgIconFromSet(e,a,_){const C=e.querySelector(`[id="${a}"]`);if(!C)return null;const F=C.cloneNode(!0);if(F.removeAttribute("id"),"svg"===F.nodeName.toLowerCase())return this._setSvgAttributes(F,_);if("symbol"===F.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(F),_);const G=this._svgElementFromString("<svg></svg>");return G.appendChild(F),this._setSvgAttributes(G,_)}_svgElementFromString(e){const a=this._document.createElement("DIV");a.innerHTML=e;const _=a.querySelector("svg");if(!_)throw Error("<svg> tag not found");return _}_toSvgElement(e){const a=this._svgElementFromString("<svg></svg>"),_=e.attributes;for(let C=0;C<_.length;C++){const{name:F,value:G}=_[C];"id"!==F&&a.setAttribute(F,G)}for(let C=0;C<e.childNodes.length;C++)e.childNodes[C].nodeType===this._document.ELEMENT_NODE&&a.appendChild(e.childNodes[C].cloneNode(!0));return a}_setSvgAttributes(e,a){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),a&&a.viewBox&&e.setAttribute("viewBox",a.viewBox),e}_fetchIcon(e){var a;const{url:_,options:C}=e,F=null!==(a=C?.withCredentials)&&void 0!==a&&a;if(!this._httpClient)throw function jy(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==_)throw Error(`Cannot fetch icon from URL "${_}".`);const G=this._sanitizer.sanitize(c.q3G.RESOURCE_URL,_);if(!G)throw U_(_);const ot=this._inProgressUrlFetches.get(G);if(ot)return ot;const yt=this._httpClient.get(G,{responseType:"text",withCredentials:F}).pipe((0,Gy.x)(()=>this._inProgressUrlFetches.delete(G)),(0,Ny.B)());return this._inProgressUrlFetches.set(G,yt),yt}_addSvgIconConfig(e,a,_){return this._svgIconConfigs.set(H_(e,a),_),this}_addSvgIconSetConfig(e,a){const _=this._iconSetConfigs.get(e);return _?_.push(a):this._iconSetConfigs.set(e,[a]),this}_svgElementFromConfig(e){if(!e.svgElement){const a=this._svgElementFromString(e.svgText);this._setSvgAttributes(a,e.options),e.svgElement=a}return e.svgElement}_getIconConfigFromResolvers(e,a){for(let _=0;_<this._resolvers.length;_++){const C=this._resolvers[_](a,e);if(C)return qy(C)?new uu(C.url,null,C.options):new uu(C,null)}}}return o.\u0275fac=function(e){return new(e||o)(c.LFG(io.eN,8),c.LFG(jr.H7),c.LFG(Nt.K0,8),c.LFG(c.qLn))},o.\u0275prov=c.Yz7({factory:function(){return new o(c.LFG(io.eN,8),c.LFG(jr.H7),c.LFG(Nt.K0,8),c.LFG(c.qLn))},token:o,providedIn:"root"}),o})();function jf(o){return o.cloneNode(!0)}function H_(o,l){return o+":"+l}function qy(o){return!(!o.url||!o.options)}const Zy=O(class{constructor(o){this._elementRef=o}}),$y=new c.OlP("mat-icon-location",{providedIn:"root",factory:function Yy(){const o=(0,c.f3M)(Nt.K0),l=o?o.location:null;return{getPathname:()=>l?l.pathname+l.search:""}}}),q_=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],Xy=q_.map(o=>`[${o}]`).join(", "),Jy=/^url\(['"]?#(.*?)['"]?\)$/;let Ky=(()=>{class o extends Zy{constructor(e,a,_,C,F){super(e),this._iconRegistry=a,this._location=C,this._errorHandler=F,this._inline=!1,this._currentIconFetch=Sr.w.EMPTY,_||e.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=me(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const a=this._cleanupFontValue(e);a!==this._fontSet&&(this._fontSet=a,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const a=this._cleanupFontValue(e);a!==this._fontIcon&&(this._fontIcon=a,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const a=e.split(":");switch(a.length){case 1:return["",a[0]];case 2:return a;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const a=this._location.getPathname();a!==this._previousPath&&(this._previousPath=a,this._prependPathToReferences(a))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const a=e.querySelectorAll("style");for(let C=0;C<a.length;C++)a[C].textContent+=" ";const _=this._location.getPathname();this._previousPath=_,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(_),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let a=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();a--;){const _=e.childNodes[a];(1!==_.nodeType||"svg"===_.nodeName.toLowerCase())&&e.removeChild(_)}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,a=this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet):this._iconRegistry.getDefaultFontSetClass();a!=this._previousFontSetClass&&(this._previousFontSetClass&&e.classList.remove(this._previousFontSetClass),a&&e.classList.add(a),this._previousFontSetClass=a),this.fontIcon!=this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const a=this._elementsWithExternalReferences;a&&a.forEach((_,C)=>{_.forEach(F=>{C.setAttribute(F.name,`url('${e}#${F.value}')`)})})}_cacheChildrenWithExternalReferences(e){const a=e.querySelectorAll(Xy),_=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let C=0;C<a.length;C++)q_.forEach(F=>{const G=a[C],ot=G.getAttribute(F),yt=ot?ot.match(Jy):null;if(yt){let Ht=_.get(G);Ht||(Ht=[],_.set(G,Ht)),Ht.push({name:F,value:yt[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[a,_]=this._splitIconName(e);a&&(this._svgNamespace=a),_&&(this._svgName=_),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(_,a).pipe((0,li.q)(1)).subscribe(C=>this._setSvgElement(C),C=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${a}:${_}! ${C.message}`))})}}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(Uf),c.$8M("aria-hidden"),c.Y36($y),c.Y36(c.qLn))},o.\u0275cmp=c.Xpm({type:o,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:7,hostBindings:function(e,a){2&e&&(c.uIk("data-mat-icon-type",a._usingFontIcon()?"font":"svg")("data-mat-icon-name",a._svgName||a.fontIcon)("data-mat-icon-namespace",a._svgNamespace||a.fontSet),c.ekj("mat-icon-inline",a.inline)("mat-icon-no-color","primary"!==a.color&&"accent"!==a.color&&"warn"!==a.color))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[c.qOj],ngContentSelectors:Uy,decls:1,vars:0,template:function(e,a){1&e&&(c.F$t(),c.Hsn(0))},styles:[".mat-icon{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}\n"],encapsulation:2,changeDetection:0}),o})(),Qy=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[T,T]}),o})(),tx=(()=>{class o{constructor(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),ex=(()=>{class o{constructor(e){this.dataFunctionService=e,this.onLoadCsv=new c.vpe,this.textoBoton="Cargar fichero CSV"}ngOnInit(){}csvInputChange(e){const a=e.target.files[0];if(a&&a.name.endsWith(".csv"))try{const _=new FileReader;_.readAsText(a),_.onload=C=>{const G=this.csvToArray(_.result);this.onLoadCsv.emit(G)}}catch(_){console.log(_)}else console.log("EL FICHERO TIENE QUE SER CSV")}csvToArray(e){const a=e.split("\n"),_=[];return a.forEach(C=>{const F=C.replace("\r","").split(";");_.push({nombre:F[0],categoria:F[1]})}),_}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(tx))},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-load-csv"]],inputs:{textoBoton:"textoBoton"},outputs:{onLoadCsv:"onLoadCsv"},decls:4,vars:1,consts:[["hidden","true","type","file","onclick","this.value=null","accept",".csv",1,"form-control-file",3,"change"],["csvInput",""],["mat-button","",1,"button-class",3,"click"]],template:function(e,a){if(1&e){const _=c.EpF();c.TgZ(0,"input",0,1),c.NdJ("change",function(F){return a.csvInputChange(F)}),c.qZA(),c.TgZ(2,"button",2),c.NdJ("click",function(){c.CHM(_);const F=c.MAs(1);return c.KtG(F.click())}),c._uU(3),c.qZA()}2&e&&(c.xp6(3),c.hij(" ",a.textoBoton," "))},dependencies:[$l],styles:[".button-class[_ngcontent-%COMP%]{border:2px solid var(--tono1);padding:5px 30px;font-family:Crimson Text,serif;font-size:11pt;box-shadow:1px 2px 3px 0 var(--tono3-transparente);background:var(--tono2);color:var(--tono6)}@media screen and (max-width: 599px){.button-class[_ngcontent-%COMP%]{width:100%;padding:0}}"]}),o})();function ix(o,l){if(1&o&&(c.TgZ(0,"span"),c._uU(1),c.qZA()),2&o){const e=c.oxw().$implicit;c.xp6(1),c.hij(" \xa0(",null==e.mesaSchema||null==e.mesaSchema.heroeSchema?null:e.mesaSchema.heroeSchema.nombre,") ")}}function nx(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"tr",12)(1,"td",18),c._uU(2),c.qZA(),c.TgZ(3,"td",19),c._uU(4),c.YNc(5,ix,2,1,"span",11),c.qZA(),c.TgZ(6,"td",16)(7,"button",20),c.NdJ("click",function(){const _=c.CHM(e),C=_.$implicit,F=_.index,G=c.oxw(2);return c.KtG(G.editarInvitado(C,F))}),c.TgZ(8,"mat-icon"),c._uU(9,"edit"),c.qZA()(),c.TgZ(10,"button",21),c.NdJ("click",function(){const _=c.CHM(e),C=_.$implicit,F=_.index,G=c.oxw(2);return c.KtG(G.abrirDialogEliminarInvitado(C,F))}),c.TgZ(11,"mat-icon"),c._uU(12,"delete"),c.qZA()()()()}if(2&o){const e=l.$implicit;c.xp6(2),c.hij(" ",e.nombre," "),c.xp6(2),c.hij(" ",null==e.mesaSchema?null:e.mesaSchema.nombre," "),c.xp6(1),c.Q6J("ngIf",null==e.mesaSchema?null:e.mesaSchema.heroeSchema)}}function rx(o,l){1&o&&(c.TgZ(0,"tr")(1,"td",22),c._uU(2,"No hay invitados registrados"),c.qZA()())}function ox(o,l){1&o&&(c.TgZ(0,"tr")(1,"td",22),c._uU(2,"Cargando datos de los invitados..."),c.qZA()())}const Zd=function(o,l){return{ascendente:o,descendente:l}};function sx(o,l){if(1&o&&(c.TgZ(0,"mat-icon",23),c._uU(1,"arrow_forward_ios"),c.qZA()),2&o){const e=c.oxw(2);c.Q6J("ngClass",c.WLB(1,Zd,"NOMBRE_ASC"===e.ordenTablaInvitados,"NOMBRE_DESC"===e.ordenTablaInvitados))}}function ax(o,l){if(1&o&&(c.TgZ(0,"mat-icon",23),c._uU(1,"arrow_forward_ios"),c.qZA()),2&o){const e=c.oxw(2);c.Q6J("ngClass",c.WLB(1,Zd,"MESA_ASC"===e.ordenTablaInvitados,"MESA_DESC"===e.ordenTablaInvitados))}}function lx(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"div",26),c.NdJ("click",function(){c.CHM(e);const _=c.oxw(3);return c.KtG(_.paginaAnterior())}),c.TgZ(1,"mat-icon"),c._uU(2,"chevron_left"),c.qZA(),c._uU(3," Anterior "),c.qZA()}}function cx(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"div",26),c.NdJ("click",function(){c.CHM(e);const _=c.oxw(3);return c.KtG(_.paginaSiguiente())}),c._uU(1," Siguiente "),c.TgZ(2,"mat-icon"),c._uU(3,"chevron_right"),c.qZA()()}}function ux(o,l){if(1&o&&(c.TgZ(0,"div",24),c.YNc(1,lx,4,0,"div",25),c.YNc(2,cx,4,0,"div",25),c.qZA()),2&o){const e=c.oxw(2);c.xp6(1),c.Q6J("ngIf",0!==e.page),c.xp6(1),c.Q6J("ngIf",e.page<e.maxPaginas)}}function hx(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"div",9)(1,"table")(2,"tbody"),c.YNc(3,nx,13,3,"tr",10),c.YNc(4,rx,3,0,"tr",11),c.YNc(5,ox,3,0,"tr",11),c.qZA(),c.TgZ(6,"thead")(7,"tr",12)(8,"th",13),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.ordenar("nombre"))}),c._uU(9," Nombre "),c.YNc(10,sx,2,4,"mat-icon",14),c.qZA(),c.TgZ(11,"th",15),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.ordenar("mesa"))}),c._uU(12," Mesa "),c.YNc(13,ax,2,4,"mat-icon",14),c.qZA(),c.TgZ(14,"th",16),c._uU(15," Acciones "),c.qZA()()()(),c.YNc(16,ux,3,2,"div",17),c.qZA()}if(2&o){const e=c.oxw();c.xp6(3),c.Q6J("ngForOf",e.vInvitadosVisible),c.xp6(1),c.Q6J("ngIf",0===e.vInvitados.length&&!e.cargandoInvitados),c.xp6(1),c.Q6J("ngIf",e.cargandoInvitados),c.xp6(5),c.Q6J("ngIf","NOMBRE_ASC"===e.ordenTablaInvitados||"NOMBRE_DESC"===e.ordenTablaInvitados),c.xp6(3),c.Q6J("ngIf","MESA_ASC"===e.ordenTablaInvitados||"MESA_DESC"===e.ordenTablaInvitados),c.xp6(3),c.Q6J("ngIf",e.vInvitados.length>0)}}function dx(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"tr",12)(1,"td",18),c._uU(2),c.qZA(),c.TgZ(3,"td",16),c._uU(4),c.qZA(),c.TgZ(5,"td",18),c._uU(6),c.qZA(),c.TgZ(7,"td",16)(8,"button",20),c.NdJ("click",function(){const C=c.CHM(e).$implicit,F=c.oxw(2);return c.KtG(F.abrirDialogEditarMesa(C))}),c.TgZ(9,"mat-icon"),c._uU(10,"edit"),c.qZA()()()()}if(2&o){const e=l.$implicit;c.xp6(2),c.hij(" ",e.nombre," "),c.xp6(2),c.hij(" ",e.numeroInvitados?e.numeroInvitados:0," "),c.xp6(2),c.hij(" ",null==e.heroeSchema?null:e.heroeSchema.nombre," ")}}function px(o,l){1&o&&(c.TgZ(0,"tr")(1,"td",22),c._uU(2,"No hay mesas registradas"),c.qZA()())}function fx(o,l){if(1&o&&(c.TgZ(0,"mat-icon",23),c._uU(1,"arrow_forward_ios"),c.qZA()),2&o){const e=c.oxw(2);c.Q6J("ngClass",c.WLB(1,Zd,"NOMBRE_ASC"===e.ordenTablaMesas,"NOMBRE_DESC"===e.ordenTablaMesas))}}function mx(o,l){if(1&o&&(c.TgZ(0,"mat-icon",23),c._uU(1,"arrow_forward_ios"),c.qZA()),2&o){const e=c.oxw(2);c.Q6J("ngClass",c.WLB(1,Zd,"NUMERO_ASC"===e.ordenTablaMesas,"NUMERO_DESC"===e.ordenTablaMesas))}}function gx(o,l){if(1&o&&(c.TgZ(0,"mat-icon",23),c._uU(1,"arrow_forward_ios"),c.qZA()),2&o){const e=c.oxw(2);c.Q6J("ngClass",c.WLB(1,Zd,"HEROE_ASC"===e.ordenTablaMesas,"HEROE_DESC"===e.ordenTablaMesas))}}function _x(o,l){if(1&o){const e=c.EpF();c.TgZ(0,"div",9)(1,"table")(2,"tbody"),c.YNc(3,dx,11,3,"tr",10),c.YNc(4,px,3,0,"tr",11),c.qZA(),c.TgZ(5,"thead")(6,"tr",12)(7,"th",13),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.ordenarTablaMesas("nombre"))}),c._uU(8," Nombre "),c.YNc(9,fx,2,4,"mat-icon",14),c.qZA(),c.TgZ(10,"th",27),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.ordenarTablaMesas("numero"))}),c._uU(11," N\xba invitados "),c.YNc(12,mx,2,4,"mat-icon",14),c.qZA(),c.TgZ(13,"th",13),c.NdJ("click",function(){c.CHM(e);const _=c.oxw();return c.KtG(_.ordenarTablaMesas("heroe"))}),c._uU(14," Heroe "),c.YNc(15,gx,2,4,"mat-icon",14),c.qZA(),c.TgZ(16,"th",16),c._uU(17," Acciones "),c.qZA()()()()()}if(2&o){const e=c.oxw();c.xp6(3),c.Q6J("ngForOf",e.vMesas),c.xp6(1),c.Q6J("ngIf",0===e.vInvitados.length&&!e.cargandoInvitados),c.xp6(5),c.Q6J("ngIf","NOMBRE_ASC"===e.ordenTablaMesas||"NOMBRE_DESC"===e.ordenTablaMesas),c.xp6(3),c.Q6J("ngIf","NUMERO_ASC"===e.ordenTablaMesas||"NUMERO_DESC"===e.ordenTablaMesas),c.xp6(3),c.Q6J("ngIf","HEROE_ASC"===e.ordenTablaMesas||"HEROE_DESC"===e.ordenTablaMesas)}}let yx=(()=>{class o{constructor(e,a,_,C,F){this.invitadosService=e,this.mesasService=a,this.heroesService=_,this.fb=C,this.snackBarService=F,this.vInvitados=[],this.vInvitadosVisible=[],this.vMesas=[],this.vHeroes=[],this.page=0,this.maxPaginas=0,this.pageSize=10,this.ordenTablaInvitados=On,this.ordenTablaMesas=Lo,this.cargandoInvitados=!1,this.dialogEditarInvitadoAbierto=!1,this.creandoNuevoInvitado=!1,this.creandoNuevaMesa=!1,this.formEditarInvitado=this.fb.group({nombre:[,[Or.required]],mesaSelect:[,[]]}),this.formEditarMesa=this.fb.group({nombre:[,[Or.required]],heroe:[,[Or.required]]}),this.dialogEliminarInvitadoAbierto=!1,this.dialogEliminarTodosLosInvitadosAbierto=!1,this.dialogEditarMesaAbierto=!1}ngOnInit(){this.cargandoInvitados=!0,this.invitadosService.obtenerListadoInvitados().pipe((0,Jr.w)(e=>(this.vInvitados=e,this.mesasService.obtenerListadoMesas())),(0,Jr.w)(e=>(this.vMesas=e,this.heroesService.obtenerListadoHeroes()))).subscribe(e=>{this.vHeroes=e,this.vMesas.forEach(a=>{const _=this.vHeroes.find(C=>C._id===a.heroe);a.heroeSchema=_}),this.vInvitados.forEach(a=>{const _=this.vMesas.find(C=>C._id===a.mesa);a.mesaSchema=_}),this.page=0,this.maxPaginas=Math.floor(this.vInvitados.length/this.pageSize),this.asignarVInvitados(),this.cargandoInvitados=!1})}ordenar(e){switch("nombre"===e?this.ordenTablaInvitados=this.ordenTablaInvitados===Lo?Tl:Lo:"mesa"===e&&(this.ordenTablaInvitados=this.ordenTablaInvitados===On?Pc:On),this.ordenTablaInvitados){case Lo:this.vInvitados=this.vInvitados.sort((a,_)=>a.nombre<_.nombre?-1:1);break;case Tl:this.vInvitados=this.vInvitados.sort((a,_)=>a.nombre<_.nombre?1:-1);break;case On:this.vInvitados=this.vInvitados.sort((a,_)=>a.mesaSchema?.nombre<_.mesaSchema?.nombre?-1:1);break;case Pc:this.vInvitados=this.vInvitados.sort((a,_)=>a.mesaSchema?.nombre<_.mesaSchema?.nombre?1:-1)}this.asignarVInvitados()}ordenarTablaMesas(e){switch("nombre"===e?this.ordenTablaMesas=this.ordenTablaMesas===Lo?Tl:Lo:"numero"===e&&(this.ordenTablaMesas=this.ordenTablaMesas===Yi?Zn:Yi),this.ordenTablaMesas){case Lo:this.vMesas=this.vMesas.sort((a,_)=>a.nombre<_.nombre?-1:1);break;case Tl:this.vMesas=this.vMesas.sort((a,_)=>a.nombre<_.nombre?1:-1);break;case Yi:this.vMesas=this.vMesas.sort((a,_)=>a.numeroInvitados<_.numeroInvitados?-1:1);break;case Zn:this.vMesas=this.vMesas.sort((a,_)=>a.numeroInvitados<_.numeroInvitados?1:-1)}}asignarVInvitados(e){e&&(this.vInvitados=this.vInvitados.concat(e),this.page=0,this.maxPaginas=Math.floor(this.vInvitados.length/this.pageSize)),this.asignarVMesas();const a=this.page*this.pageSize;this.vInvitadosVisible=this.vInvitados.slice(a,a+this.pageSize)}asignarVMesas(){let e={};this.vInvitados.forEach(a=>{e[a.categoria]?e[a.categoria]++:e[a.categoria]=1}),Object.keys(e).forEach(a=>{this.vMesas.find(_=>_.nombre===a).numeroInvitados=e[a]})}cargarDatosCsv(e){this.cargandoInvitados=!0;let a=[],_={};e.forEach(C=>{_[C.categoria]?_[C.categoria]++:_[C.categoria]=1}),Object.keys(_).forEach(C=>{a.push({nombre:C})}),this.mesasService.guardarMesas(a).pipe((0,Jr.w)(C=>(this.vMesas=this.vMesas.concat(C.data),e.forEach(F=>{F.mesa=this.vMesas.find(G=>G.nombre===F.categoria)?._id}),this.invitadosService.guardarInvitados(e)))).subscribe(C=>{this.vInvitados=this.vInvitados.concat(C.data),this.vInvitados.forEach(F=>F.mesaSchema=this.vMesas.find(G=>G._id===F.mesa)),this.asignarVInvitados(),this.cargandoInvitados=!1})}paginaSiguiente(){this.page=this.page===this.maxPaginas?this.page:this.page+1,this.asignarVInvitados()}paginaAnterior(){this.page=0===this.page?0:this.page-1,this.asignarVInvitados()}abrirDialogNuevoInvitado(){this.invitadoSeleccionado=void 0,this.dialogEditarInvitadoAbierto=!0,this.formEditarInvitado.reset({nombre:"",mesaSelect:"",mesaNueva:"",checkMesaNueva:!1})}editarInvitado(e,a){this.indexInvitadoEditando=a,this.invitadoSeleccionado=e,this.dialogEditarInvitadoAbierto=!0,this.formEditarInvitado.reset({nombre:this.invitadoSeleccionado.nombre,mesaSelect:this.invitadoSeleccionado.mesaSchema})}abrirDialogNuevaMesa(){this.mesaSeleccionada=void 0,this.dialogEditarMesaAbierto=!0,this.creandoNuevaMesa=!0,this.formEditarMesa.reset({nombre:"",heroe:void 0})}abrirDialogEliminarInvitado(e,a){this.dialogEliminarInvitadoAbierto=!0,this.invitadoSeleccionado=e}abrirDialogEditarMesa(e){this.mesaSeleccionada=e,this.dialogEditarMesaAbierto=!0,this.creandoNuevaMesa=!1,this.formEditarMesa.reset({nombre:e.nombre,heroe:e.heroeSchema})}submitGuardarNuevoInvitado(){const e=this.formEditarInvitado.value.checkMesaNueva;if(e&&""===this.formEditarInvitado.value.mesaNueva.trim())return this.formEditarInvitado.get("mesaNueva").setErrors({"mesa-requerida":!0}),void this.formEditarInvitado.markAllAsTouched();this.formEditarInvitado.get("mesaNueva").setErrors({"mesa-requerida":!0}),this.invitadosService.guardarInvitado({nombre:this.formEditarInvitado.value.nombre,categoria:e?this.formEditarInvitado.value.mesaNueva:this.formEditarInvitado.value.mesaSelect}).subscribe(_=>{this.vInvitados.push(_.data),this.asignarVInvitados(),this.formEditarInvitado.reset({}),this.invitadoSeleccionado=void 0,this.dialogEditarInvitadoAbierto=!1,this.snackBarService.open("Invitado guardado correctamente","Aceptar")})}submitEditarInvitado(){var e={_id:this.invitadoSeleccionado._id,nombre:this.formEditarInvitado.value.nombre,mesa:this.formEditarInvitado.value.mesaSelect};this.invitadosService.actualizarInvitado(e,this.invitadoSeleccionado._id).subscribe(a=>{const _=this.vInvitados.find(F=>F._id===this.invitadoSeleccionado._id),C=this.vInvitados.indexOf(_);e.mesaSchema=_.mesaSchema,e.categoria=_.categoria,this.vInvitados[C]=e,this.asignarVInvitados(),this.formEditarInvitado.reset({}),this.invitadoSeleccionado=void 0,this.dialogEditarInvitadoAbierto=!1,this.snackBarService.open("Invitado editado correctamente","Aceptar")})}submitEliminarInvitado(){this.invitadosService.eliminarInvitado(this.invitadoSeleccionado._id).subscribe(e=>{this.dialogEliminarInvitadoAbierto=!1,this.vInvitados.splice(this.vInvitados.indexOf(this.invitadoSeleccionado),1),this.asignarVInvitados(),this.snackBarService.open("Invitado eliminado correctamente","Aceptar")})}submitEliminarListadoInvitados(){this.invitadosService.eliminarTodosLosInvitados().subscribe(e=>{this.vInvitados.splice(0),this.asignarVInvitados(),this.dialogEliminarTodosLosInvitadosAbierto=!1,this.snackBarService.open("Se han eliminado todos los invitados.","Aceptar")})}submitCrearNuevaMesa(){this.formEditarMesa.invalid?this.formEditarMesa.markAllAsTouched():this.mesasService.guardarMesa({nombre:this.formEditarMesa.value.nombre,heroe:this.formEditarMesa.value.heroe._id}).subscribe(a=>{this.vMesas.push(a.data),this.asignarVInvitados(),this.snackBarService.open("Se ha guardado la nueva mesa correctamente.","Aceptar"),this.dialogEditarMesaAbierto=!1,this.creandoNuevaMesa=!1},a=>{console.log(a),this.snackBarService.open("Ha ocurrido un error al guardar los datos.","Aceptar"),this.dialogEditarMesaAbierto=!1,this.creandoNuevaMesa=!1})}submitEditarMesa(){this.formEditarMesa.invalid?this.formEditarMesa.markAllAsTouched():this.mesasService.modificarMesa({_id:this.mesaSeleccionada._id,nombre:this.formEditarMesa.value.nombre,heroe:this.formEditarMesa.value.heroe}).subscribe(a=>{this.vMesas.forEach(_=>{_._id===this.mesaSeleccionada?._id&&(_.heroe=this.formEditarMesa.value.heroe.nombre,_.heroeSchema=this.formEditarMesa.value.heroe)}),this.vInvitados.map(_=>{_.mesaSchema._id===this.mesaSeleccionada._id&&(_.mesa=a.data._id,_.mesaSchema=a.data)}),this.asignarVInvitados(),this.dialogEditarMesaAbierto=!1,this.mesaSeleccionada=void 0,this.formEditarMesa.reset({}),this.snackBarService.open("Se han modificadolos datos de la mesa.","Aceptar")},a=>{this.dialogEditarMesaAbierto=!1,this.snackBarService.open("Ha ocurrido un error al cambiar los datos de la mesa.","Aceptar"),console.log(a)})}cerrarDialogEditarMesa(){this.mesaSeleccionada=void 0,this.formEditarMesa.reset(),this.dialogEditarMesaAbierto=!1}cerrarDialogEditar(){this.creandoNuevoInvitado=!1,this.dialogEditarInvitadoAbierto=!1,this.invitadoSeleccionado=void 0}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(Fc),c.Y36(ad),c.Y36(_p),c.Y36(lc),c.Y36(zy))},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-gestion-invitados"]],decls:17,vars:2,consts:[[1,"titulo-gestion-invitados"],[1,"cortina"],["fxLayoutAlign","center center",1,"texto-titulo"],[1,"container"],["fxLayout","row","fxLayoutAlign","end","fxLayoutGap","20px","fxLayoutGap.xs","10px","fxLayout.xs","column",1,"boton-cargar-container"],[1,"boton-nuevo-invitado",3,"click"],[3,"onLoadCsv"],["class","table-content",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end","fxLayoutGap","20px",1,"boton-cargar-container"],[1,"table-content"],["fxLayout","row",4,"ngFor","ngForOf"],[4,"ngIf"],["fxLayout","row"],["fxFlex","30","fxLayoutAlign","start center",3,"click"],["class","icon-order",3,"ngClass",4,"ngIf"],["fxFlex","50","fxLayoutAlign","start center",3,"click"],["fxFlex","20","fxLayoutAlign","start center"],["class","control-table","fxLayout","row","fxLayoutAlign","center",4,"ngIf"],["fxFlex","30","fxLayoutAlign","start center"],["fxFlex","50","fxLayoutAlign","start center"],["mat-icon-button","",1,"edit-button",3,"click"],["mat-icon-button","",1,"delete-button",3,"click"],["colspan","4"],[1,"icon-order",3,"ngClass"],["fxLayout","row","fxLayoutAlign","center",1,"control-table"],["class","control-table-button","fxFlex","25","fxFlex.sm","40","fxFlex.xs","45","fxLayoutAlign","center center",3,"click",4,"ngIf"],["fxFlex","25","fxFlex.sm","40","fxFlex.xs","45","fxLayoutAlign","center center",1,"control-table-button",3,"click"],["fxFlex","20","fxLayoutAlign","start center",3,"click"]],template:function(e,a){1&e&&(c.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"div",2),c._uU(4," Gesti\xf3n de los invitados "),c.qZA()()(),c.TgZ(5,"div",3)(6,"div",4)(7,"button",5),c.NdJ("click",function(){return a.dialogEliminarTodosLosInvitadosAbierto=!0}),c._uU(8," Vaciar listado de invitados "),c.qZA(),c.TgZ(9,"button",5),c.NdJ("click",function(){return a.abrirDialogNuevoInvitado()}),c._uU(10," Nuevo invitado "),c.qZA(),c.TgZ(11,"app-load-csv",6),c.NdJ("onLoadCsv",function(C){return a.cargarDatosCsv(C)}),c.qZA()(),c.YNc(12,hx,17,6,"div",7),c.TgZ(13,"div",8)(14,"button",5),c.NdJ("click",function(){return a.abrirDialogNuevaMesa()}),c._uU(15," Nueva mesa "),c.qZA()(),c.YNc(16,_x,18,5,"div",7),c.qZA()()),2&e&&(c.xp6(12),c.Q6J("ngIf",a.vInvitados.length>0),c.xp6(4),c.Q6J("ngIf",a.vMesas.length>0&&!a.cargandoInvitados))},dependencies:[Nt.mk,Nt.sg,Nt.O5,$l,Ky,Ao,Sc,le,v,wo,ex],styles:[".container[_ngcontent-%COMP%]{font-family:Crimson Text,serif;padding:40px;min-width:calc(100% - 80px);max-width:calc(100% - 80px);min-height:calc(100% - 80px);background-color:var(--tono6)}.boton-nuevo-invitado[_ngcontent-%COMP%]{border:2px solid var(--tono1);border-radius:3px;padding:5px 30px;font-family:Crimson Text,serif;font-size:12pt;box-shadow:1px 2px 3px 0 var(--tono3-transparente);background:var(--tono2);color:var(--tono6);cursor:pointer}.subtitle-container[_ngcontent-%COMP%]{font-weight:900;text-shadow:3px 2px 4px var(--tono-box-shadow)}.titulo-gestion-invitados[_ngcontent-%COMP%]{width:100%;height:250px;background-image:url(santuario-puerto-1.632d610674907cb1.jpeg);background-position:center center;background-size:cover;font-family:Square Peg,cursive}.titulo-gestion-invitados[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#00000090}.titulo-gestion-invitados[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{color:#fff;text-shadow:2px 2px 3px #ffffff80;font-size:60pt;width:100%;height:100%}.subtitle-container[_ngcontent-%COMP%]{font-size:18pt;margin:5px 20px}.boton-cargar-container[_ngcontent-%COMP%]{margin:10px 10% 0 0;text-align:right}.table-content[_ngcontent-%COMP%]{margin:25px 10% 10px}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;background-color:var(--tono2);border-radius:3px;box-shadow:2px 2px 10px #000;margin:15px 0;border-spacing:0;border-collapse:collapse}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:2px solid var(--tono6);text-align:start;padding:15px 10px;background-color:var(--tono1);font-size:15pt;font-weight:900}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .icon-order[_ngcontent-%COMP%]{margin-left:10px}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .icon-order.no-order[_ngcontent-%COMP%]{display:none}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .icon-order.ascendente[_ngcontent-%COMP%]{transform:rotate(-90deg)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .icon-order.descendente[_ngcontent-%COMP%]{transform:rotate(90deg)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-right:1px solid var(--tono5-transparente);border-bottom:1px solid var(--tono5-transparente);max-width:500px;color:#000!important;text-align:start}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:2px 10px}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-right:0}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--tono7)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:var(--tono8)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr#row-nueva-seccion[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0 10px 8px;text-align:center}.edit-button[_ngcontent-%COMP%]{color:var(--tono2)}.delete-button[_ngcontent-%COMP%]{color:red}input[_ngcontent-%COMP%]{color:var(--tono1)}input[_ngcontent-%COMP%]::placeholder{color:var(--tono1-transparente)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#fff}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:13pt}.control-table[_ngcontent-%COMP%]{margin:25px 10px;font-size:14pt;text-shadow:1px 1px 1px #00000030}.control-table-button[_ngcontent-%COMP%]{padding:10px 15px;margin:0 20px;border:2px solid var(--tono5-transparente);background:var(--tono1);box-shadow:1px 2px 3px var(--tono1-transparente);border-radius:3px;color:var(--tono7);cursor:pointer}.control-table-button[_ngcontent-%COMP%]:hover{background-color:var(--tono2);transform:translateY(-1px);box-shadow:2px 3px 5px var(--tono1-transparente)}.control-table-button[_ngcontent-%COMP%]:active{background-color:var(--tono1)}.dialog-edit-invitado[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;right:0;background-color:var(--tono5-transparente);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);z-index:50;transition:.3s}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]{width:750px;height:auto;border-radius:3px;box-shadow:1px 2px 3px var(--tono1-transparente);background-color:var(--tono8)}.dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]{width:600px;height:auto;border-radius:3px;box-shadow:1px 2px 3px var(--tono1-transparente);background-color:var(--tono8)}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]{padding:20px}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:10px 0}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%]{color:var(--tono1);text-shadow:1px 2px 3px var(--tono1-transparente);font-size:22pt;margin-bottom:40px;font-family:Crimson Text,serif}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .botonera[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%]   .botonera[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%]   .botonera[_ngcontent-%COMP%]{margin:20px 5px 10px}@media screen and (max-width: 599px){.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:11pt}.edit-button[_ngcontent-%COMP%], .delete-button[_ngcontent-%COMP%]{height:30px;width:30px;line-height:30px;font-size:12pt}.container[_ngcontent-%COMP%]{padding:40px 2px;min-width:calc(100% - 4px);max-width:calc(100% - 4px);min-height:calc(100% - 80px)}.table-content[_ngcontent-%COMP%]{margin:25px 1px 10px}.boton-cargar-container[_ngcontent-%COMP%]{margin:30px 1px 0}}@media screen and (min-width: 600px) and (max-width: 959px){.container[_ngcontent-%COMP%]{padding:40px 5px;min-width:calc(100% - 10px);max-width:calc(100% - 10px);min-height:calc(100% - 80px)}.table-content[_ngcontent-%COMP%]{margin:25px 5px 10px}.boton-cargar-container[_ngcontent-%COMP%]{margin:30px 5px 0 0}}@media screen and (min-width: 960px) and (max-width: 1279px){.container[_ngcontent-%COMP%]{padding:40px 10px;min-width:calc(100% - 20px);max-width:calc(100% - 20px);min-height:calc(100% - 80px)}.table-content[_ngcontent-%COMP%]{margin:25px 5% 10px}.boton-cargar-container[_ngcontent-%COMP%]{margin:30px 5% 0 0}}"]}),o})();var hu=de(9898),xx=de(3963);const vx=[{path:"",component:Qu,children:[{path:"distribucion-mesas",component:bp},{path:"gestion-invitados",component:yx},{path:"ubicaciones",component:(()=>{class o{constructor(){this.centerIglesia=[-6.07987967275465,40.06193837264466],this.centerParador=[-6.094094531103214,40.02918737941208],this.zoomParador=16,this.zoomIglesia=15,this.containerIglesia="mapaIglesia",this.containerParador="mapaParador",this.containerParador2="mapaParador2",this.ubicacionIglesia="https://www.google.com/maps/place/Santuario+de+Nuestra+Se%C3%B1ora+del+Puerto/@40.0618776,-6.0818982,17z/data=!3m1!4b1!4m5!3m4!1s0xd3e160f40a550fb:0xe88a4d3fd88ddc91!8m2!3d40.0619512!4d-6.0798938",this.ubicacionParador="https://www.google.com/maps/place/Parador+de+Plasencia/@40.0291874,-6.0962725,17z/data=!3m1!4b1!4m8!3m7!1s0xd3e164b9c9b1465:0x44caa32733429e63!5m2!4m1!1i2!8m2!3d40.0291874!4d-6.0940838"}ngOnInit(){window.scroll({top:0,left:0})}ngAfterViewInit(){hu.accessToken=xx.N.mapboxToken;var e=new hu.Map({container:this.containerIglesia,style:"mapbox://styles/mapbox/streets-v11",center:this.centerIglesia,zoom:this.zoomIglesia,scrollZoom:!1});(new hu.Marker).setLngLat(this.centerIglesia).addTo(e);var _=new hu.Map({container:this.containerParador,style:"mapbox://styles/mapbox/streets-v11",center:this.centerParador,zoom:this.zoomParador,scrollZoom:!1});(new hu.Marker).setLngLat(this.centerParador).addTo(_),new hu.Map({container:this.containerParador2,style:"mapbox://styles/mapbox/streets-v11",center:this.centerParador,zoom:this.zoomParador,scrollZoom:!1}),(new hu.Marker).setLngLat(this.centerParador).addTo(_)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=c.Xpm({type:o,selectors:[["app-ubicaciones"]],decls:27,vars:2,consts:[[1,"container-ubicaciones"],[1,"titulo-ubicaciones"],[1,"cortina"],["fxLayoutAlign","center center",1,"texto-titulo"],["fxLayout","row wrap"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"descripcion","iglesia"],["fxLayout","column","fxLayoutAlign","center center",1,"cortina"],[1,"linea-texto"],["target","_blank",1,"como-llegar",3,"href"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"ubicacion-iglesia"],["id","mapaIglesia",1,"mapa"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100","fxShow.sm","false","fxShow.xs","false","fxShow","true",1,"ubicacion-parador"],["id","mapaParador",1,"mapa"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"descripcion","parador"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100","fxShow.sm","true","fxShow.xs","true","fxShow","false",1,"ubicacion-parador"],["id","mapaParador2",1,"mapa"]],template:function(e,a){1&e&&(c.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),c._uU(4," Ubicaciones del enlace "),c.qZA()()(),c.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),c._uU(9," Santuario Virgen del Puerto "),c.qZA(),c.TgZ(10,"div",7),c._uU(11," Hora: 12.30 "),c.qZA(),c.TgZ(12,"a",8),c._uU(13," C\xf3mo llegar "),c.qZA()()(),c.TgZ(14,"div",9),c._UZ(15,"div",10),c.qZA()(),c.TgZ(16,"div",4)(17,"div",11),c._UZ(18,"div",12),c.qZA(),c.TgZ(19,"div",13)(20,"div",6)(21,"div",7),c._uU(22," Parador de Plasencia "),c.qZA(),c.TgZ(23,"a",8),c._uU(24," C\xf3mo llegar "),c.qZA()()(),c.TgZ(25,"div",14),c._UZ(26,"div",15),c.qZA()()()),2&e&&(c.xp6(12),c.Q6J("href",a.ubicacionIglesia,c.LSH),c.xp6(11),c.Q6J("href",a.ubicacionParador,c.LSH))},dependencies:[Ao,le,v,Li],styles:[".titulo-ubicaciones[_ngcontent-%COMP%]{width:100%;height:400px;background-image:url(foto-parador-2.f0d5aaf8d1f80569.jpeg);background-position:center center;background-size:cover;font-family:Square Peg,cursive}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#00000090}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{color:#fff;text-shadow:2px 2px 3px #ffffff80;font-size:60pt;width:100%;height:100%}.ubicacion-iglesia[_ngcontent-%COMP%], .ubicacion-parador[_ngcontent-%COMP%], .descripcion[_ngcontent-%COMP%]{height:500px}#mapaIglesia[_ngcontent-%COMP%], #mapaParador[_ngcontent-%COMP%], #mapaParador2[_ngcontent-%COMP%]{width:100%;height:100%}.descripcion.iglesia[_ngcontent-%COMP%]{background-image:url(santuario-puerto-1.632d610674907cb1.jpeg);background-position:center center;background-size:cover;z-index:10;box-shadow:2px 2px 4px #00000050}.descripcion.parador[_ngcontent-%COMP%]{background-image:url(foto-parador-1.501f9ed644383b38.jpeg);background-position:center center;background-size:cover;z-index:9;box-shadow:-2px -1px 4px #00000050}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{font-family:Dancing Script,cursive;font-size:20pt;background-color:#ffffffc0;width:100%;height:100%}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .linea-texto[_ngcontent-%COMP%]{margin:15px 0}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .como-llegar[_ngcontent-%COMP%]{margin:30px 0;border:1px solid var(--tono1);padding:15px 40px;cursor:pointer;box-shadow:2px 2px 4px #00000050;border-radius:2px;text-decoration:none;color:#000;transition:.3s}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .como-llegar[_ngcontent-%COMP%]:hover{background-color:var(--tono5-transparente);border:1px solid var(--tono1);color:var(--tono1);transform:translateY(-3px) scale(1.02);transition:.3s}@media (max-width: 595px){.ubicacion-iglesia[_ngcontent-%COMP%], .ubicacion-parador[_ngcontent-%COMP%], .titulo-ubicaciones[_ngcontent-%COMP%]{height:300px}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{font-size:40pt}}"]}),o})()},{path:"**",redirectTo:"ubicaciones"}]}];let bx=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Ml.Bz.forChild(vx),Ml.Bz]}),o})(),Tx=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[T,T]}),o})(),Y_=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({}),o})(),Gx=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[ki,T,jl,Y_,T,Y_]}),o})();var W_=de(8514);function Nx(o,l){}class kg{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.closeOnNavigation=!0}}const Ux={dialogContainer:(0,pe.X$)("dialogContainer",[(0,pe.SB)("void, exit",(0,pe.oB)({opacity:0,transform:"scale(0.7)"})),(0,pe.SB)("enter",(0,pe.oB)({transform:"none"})),(0,pe.eR)("* => enter",(0,pe.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,pe.oB)({transform:"none",opacity:1}))),(0,pe.eR)("* => void, * => exit",(0,pe.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,pe.oB)({opacity:0})))])};let jx=(()=>{class o extends Hc{constructor(e,a,_,C,F,G){super(),this._elementRef=e,this._focusTrapFactory=a,this._changeDetectorRef=_,this._config=F,this._focusMonitor=G,this._animationStateChanged=new c.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=ot=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(ot)),this._ariaLabelledBy=F.ariaLabelledBy||null,this._document=C}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}attachComponentPortal(e){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(e)}attachTemplatePortal(e){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(e)}_recaptureFocus(){this._containsFocus()||(!this._config.autoFocus||!this._focusTrap.focusInitialElement())&&this._elementRef.nativeElement.focus()}_trapFocus(){this._config.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){const e=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&e&&"function"==typeof e.focus){const a=gs(),_=this._elementRef.nativeElement;(!a||a===this._document.body||a===_||_.contains(a))&&(this._focusMonitor?(this._focusMonitor.focusVia(e,this._closeInteractionType),this._closeInteractionType=null):e.focus())}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=gs())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,a=gs();return e===a||e.contains(a)}}return o.\u0275fac=function(e){return new(e||o)(c.Y36(c.SBq),c.Y36(au),c.Y36(c.sBO),c.Y36(Nt.K0,8),c.Y36(kg),c.Y36(As))},o.\u0275dir=c.lG2({type:o,viewQuery:function(e,a){if(1&e&&c.Gf(Pl,7),2&e){let _;c.iGM(_=c.CRH())&&(a._portalOutlet=_.first)}},features:[c.qOj]}),o})(),Hx=(()=>{class o extends jx{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:e,totalTime:a}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:a})):"exit"===e&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:a}))}_onAnimationStart({toState:e,totalTime:a}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:a}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:a})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return o.\u0275fac=function(){let l;return function(a){return(l||(l=c.n5z(o)))(a||o)}}(),o.\u0275cmp=c.Xpm({type:o,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(e,a){1&e&&c.WFA("@dialogContainer.start",function(C){return a._onAnimationStart(C)})("@dialogContainer.done",function(C){return a._onAnimationDone(C)}),2&e&&(c.Ikx("id",a._id),c.uIk("role",a._config.role)("aria-labelledby",a._config.ariaLabel?null:a._ariaLabelledBy)("aria-label",a._config.ariaLabel)("aria-describedby",a._config.ariaDescribedBy||null),c.d8E("@dialogContainer",a._state))},features:[c.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,a){1&e&&c.YNc(0,Nx,0,0,"ng-template",0)},dependencies:[Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[Ux.dialogContainer]}}),o})(),qx=0;class Dg{constructor(l,e,a="mat-dialog-"+qx++){this._overlayRef=l,this._containerInstance=e,this.id=a,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new ae.xQ,this._afterClosed=new ae.xQ,this._beforeClosed=new ae.xQ,this._state=0,e._id=a,e._animationStateChanged.pipe((0,pi.h)(_=>"opened"===_.state),(0,li.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),e._animationStateChanged.pipe((0,pi.h)(_=>"closed"===_.state),(0,li.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),l.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),l.keydownEvents().pipe((0,pi.h)(_=>27===_.keyCode&&!this.disableClose&&!function Pn(o,...l){return l.length?l.some(e=>o[e]):o.altKey||o.shiftKey||o.ctrlKey||o.metaKey}(_))).subscribe(_=>{_.preventDefault(),Ig(this,"keyboard")}),l.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():Ig(this,"mouse")})}close(l){this._result=l,this._containerInstance._animationStateChanged.pipe((0,pi.h)(e=>"closing"===e.state),(0,li.q)(1)).subscribe(e=>{this._beforeClosed.next(l),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(l){let e=this._getPositionStrategy();return l&&(l.left||l.right)?l.left?e.left(l.left):e.right(l.right):e.centerHorizontally(),l&&(l.top||l.bottom)?l.top?e.top(l.top):e.bottom(l.bottom):e.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(l="",e=""){return this._overlayRef.updateSize({width:l,height:e}),this._overlayRef.updatePosition(),this}addPanelClass(l){return this._overlayRef.addPanelClass(l),this}removePanelClass(l){return this._overlayRef.removePanelClass(l),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function Ig(o,l,e){return void 0!==o._containerInstance&&(o._containerInstance._closeInteractionType=l),o.close(e)}const Zx=new c.OlP("MatDialogData"),$x=new c.OlP("mat-dialog-default-options"),X_=new c.OlP("mat-dialog-scroll-strategy"),Wx={provide:X_,deps:[$n],useFactory:function Yx(o){return()=>o.scrollStrategies.block()}};let Xx=(()=>{class o{constructor(e,a,_,C,F,G,ot,yt,Ht){this._overlay=e,this._injector=a,this._defaultOptions=_,this._parentDialog=C,this._overlayContainer=F,this._dialogRefConstructor=ot,this._dialogContainerType=yt,this._dialogDataToken=Ht,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new ae.xQ,this._afterOpenedAtThisLevel=new ae.xQ,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,W_.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,En.O)(void 0))),this._scrollStrategy=G}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,a){a=function Jx(o,l){return Object.assign(Object.assign({},l),o)}(a,this._defaultOptions||new kg),a.id&&this.getDialogById(a.id);const _=this._createOverlay(a),C=this._attachDialogContainer(_,a),F=this._attachDialogContent(e,C,_,a);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(F),F.afterClosed().subscribe(()=>this._removeOpenDialog(F)),this.afterOpened.next(F),C._initializeWithAttachedContent(),F}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(a=>a.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(e){const a=this._getOverlayConfig(e);return this._overlay.create(a)}_getOverlayConfig(e){const a=new Ah({positionStrategy:this._overlay.position().global(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(a.backdropClass=e.backdropClass),a}_attachDialogContainer(e,a){const C=c.zs3.create({parent:a&&a.viewContainerRef&&a.viewContainerRef.injector||this._injector,providers:[{provide:kg,useValue:a}]}),F=new Ll(this._dialogContainerType,a.viewContainerRef,C,a.componentFactoryResolver);return e.attach(F).instance}_attachDialogContent(e,a,_,C){const F=new this._dialogRefConstructor(_,a,C.id);if(e instanceof c.Rgc)a.attachTemplatePortal(new jc(e,null,{$implicit:C.data,dialogRef:F}));else{const G=this._createInjector(C,F,a),ot=a.attachComponentPortal(new Ll(e,C.viewContainerRef,G));F.componentInstance=ot.instance}return F.updateSize(C.width,C.height).updatePosition(C.position),F}_createInjector(e,a,_){const C=e&&e.viewContainerRef&&e.viewContainerRef.injector,F=[{provide:this._dialogContainerType,useValue:_},{provide:this._dialogDataToken,useValue:e.data},{provide:this._dialogRefConstructor,useValue:a}];return e.direction&&(!C||!C.get(pn,null,c.XFs.Optional))&&F.push({provide:pn,useValue:{value:e.direction,change:(0,Ar.of)()}}),c.zs3.create({parent:C||this._injector,providers:F})}_removeOpenDialog(e){const a=this.openDialogs.indexOf(e);a>-1&&(this.openDialogs.splice(a,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((_,C)=>{_?C.setAttribute("aria-hidden",_):C.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const a=e.parentElement.children;for(let _=a.length-1;_>-1;_--){let C=a[_];C!==e&&"SCRIPT"!==C.nodeName&&"STYLE"!==C.nodeName&&!C.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(C,C.getAttribute("aria-hidden")),C.setAttribute("aria-hidden","true"))}}}_closeDialogs(e){let a=e.length;for(;a--;)e[a].close()}}return o.\u0275fac=function(e){return new(e||o)(c.Y36($n),c.Y36(c.zs3),c.Y36(void 0),c.Y36(void 0),c.Y36(ba),c.Y36(void 0),c.Y36(c.DyG),c.Y36(c.DyG),c.Y36(c.OlP))},o.\u0275dir=c.lG2({type:o}),o})(),Fg=(()=>{class o extends Xx{constructor(e,a,_,C,F,G,ot){super(e,a,C,G,ot,F,Dg,Hx,Zx)}}return o.\u0275fac=function(e){return new(e||o)(c.LFG($n),c.LFG(c.zs3),c.LFG(Nt.Ye,8),c.LFG($x,8),c.LFG(X_),c.LFG(o,12),c.LFG(ba))},o.\u0275prov=c.Yz7({token:o,factory:o.\u0275fac}),o})(),K_=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({providers:[Fg,Wx],imports:[Ul,Rl,T,T]}),o})(),Qx=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[T,T]}),o})(),dv=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[ue,ki,T,ke,Nt.ez,ue,T,ke,Qx]}),o})(),Cv=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[ue,T,ue,T]}),o})(),zg=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Nt.ez,T,jl,T]}),o})();const l0={provide:new c.OlP("mat-select-scroll-strategy"),deps:[$n],useFactory:function s0(o){return()=>o.scrollStrategies.reposition()}};let d0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({providers:[l0],imports:[Nt.ez,Ul,to,T,Uc,zg,to,T]}),o})();de(7604);let A0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Nt.ez,T,Dl,Uc,Uc,T]}),o})(),D0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[T,T]}),o})();de(8896);let ky=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Dl]}),o})(),z0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({providers:[ge],imports:[ky,zg,T,ky,zg]}),o})(),B0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Ir,Tx,K_,Cv,Qy,dv,A0,D0,K_,d0,Gx,z0,V_]}),o})(),V0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=c.oAB({type:o}),o.\u0275inj=c.cJS({imports:[Nt.ez,bx,B0,qs,io.JF,fp]}),o})()},9898:function(Gg){Gg.exports=function(){"use strict";var Fa,de,Nt;function io(d,zt){if(Fa)if(de){var dr="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Fa+")(sharedChunk); ("+de+")(sharedChunk); self.onerror = null;",ui={};Fa(ui),Nt=zt(ui),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Nt.workerUrl=window.URL.createObjectURL(new Blob([dr],{type:"text/javascript"})))}else de=zt;else Fa=zt}return io(0,function(d){var zt=typeof self<"u"?self:{},dr=ui;function ui(n,t,i,s){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=i,this.p2y=s}ui.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},ui.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},ui.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},ui.prototype.solveCurveX=function(n,t){var i,s,h,f,g;for(void 0===t&&(t=1e-6),h=n,g=0;g<8;g++){if(f=this.sampleCurveX(h)-n,Math.abs(f)<t)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=f/y}if((h=n)<(i=0))return i;if(h>(s=1))return s;for(;i<s;){if(f=this.sampleCurveX(h),Math.abs(f-n)<t)return h;n>f?i=h:s=h,h=.5*(s-i)+i}return h},ui.prototype.solve=function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))};var jt=Se;function Se(n,t){this.x=n,this.y=t}Se.prototype={clone:function(){return new Se(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),i=Math.sin(n),s=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=s,this},_rotateAround:function(n,t){var i=Math.cos(n),s=Math.sin(n),h=t.y+s*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-s*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Se.convert=function(n){return n instanceof Se?n:Array.isArray(n)?new Se(n[0],n[1]):n};const Ki=Math.PI/180,Vn=180/Math.PI;function _e(n){return n*Ki}function si(n){return n*Vn}const Oa=[[0,0],[1,0],[1,1],[0,1]];function Go(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,i=t*n;return 4*(n<.5?i:3*(n-t)+i-.75)}function no(n,t,i,s){const h=new dr(n,t,i,s);return function(f){return h.solve(f)}}const No=no(.25,.1,.25,1);function ye(n,t,i){return Math.min(i,Math.max(t,n))}function kn(n,t,i){return(i=ye((i-n)/(t-n),0,1))*i*(3-2*i)}function Fr(n,t,i){const s=i-t,h=((n-t)%s+s)%s+t;return h===t?i:h}function Qi(n,t,i){if(!n.length)return i(null,[]);let s=n.length;const h=new Array(n.length);let f=null;n.forEach((g,y)=>{t(g,(b,w)=>{b&&(f=b),h[y]=w,0==--s&&i(f,h)})})}function ro(n){const t=[];for(const i in n)t.push(n[i]);return t}function Ve(n,...t){for(const i of t)for(const s in i)n[s]=i[s];return n}let Yn=1;function Uo(){return Yn++}function Or(){return function n(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Ts(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function ks(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function pr(n,t){n.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function oo(n,t){return-1!==n.indexOf(t,n.length-t.length)}function Gn(n,t,i){const s={};for(const h in n)s[h]=t.call(i||this,n[h],h,n);return s}function Lr(n,t,i){const s={};for(const h in n)t.call(i||this,n[h],h,n)&&(s[h]=n[h]);return s}function gn(n){return Array.isArray(n)?n.map(gn):"object"==typeof n&&n?Gn(n,gn):n}const jo={};function hi(n){jo[n]||(typeof console<"u"&&console.warn(n),jo[n]=!0)}function zi(n,t,i){return(i.y-n.y)*(t.x-n.x)>(t.y-n.y)*(i.x-n.x)}function Wn(n){let t=0;for(let i,s,h=0,f=n.length,g=f-1;h<f;g=h++)i=n[h],s=n[g],t+=(s.x-i.x)*(i.y+s.y);return t}function cn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Xn(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,h,f)=>{const g=h||f;return t[s]=!g||g.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let fr=null;function so(n){if(null==fr){const t=n.navigator?n.navigator.userAgent:null;fr=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return fr}function Ho(n){try{const t=zt[n];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Nn(n,t){return[n[4*t],n[4*t+1],n[4*t+2],n[4*t+3]]}const Ds=zt.performance;function mr(n){const t=n?n.url.toString():void 0;return Ds.getEntriesByName(t)}let Fe,Jn,gr,_n;const yn={now:()=>void 0!==gr?gr:zt.performance.now(),setNow(n){gr=n},restoreNow(){gr=void 0},frame(n){const t=zt.requestAnimationFrame(n);return{cancel:()=>zt.cancelAnimationFrame(t)}},getImageData(n,t=0){const{width:i,height:s}=n;_n||(_n=zt.document.createElement("canvas"));const h=_n.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(i>_n.width||s>_n.height)&&(_n.width=i,_n.height=s),h.clearRect(-t,-t,i+2*t,s+2*t),h.drawImage(n,0,0,i,s),h.getImageData(-t,-t,i+2*t,s+2*t)},resolveURL:n=>(Fe||(Fe=zt.document.createElement("a")),Fe.href=n,Fe.href),get devicePixelRatio(){return zt.devicePixelRatio},get prefersReducedMotion(){return!!zt.matchMedia&&(null==Jn&&(Jn=zt.matchMedia("(prefers-reduced-motion: reduce)")),Jn.matches)}};let ao;const Ie={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ao){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ao=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{ao=n}}return ao},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},bi={supported:!1,testSupport:function(n){!qo&&Kn&&(Is?Fs(n):Ii=n)}};let Ii,Kn,qo=!1,Is=!1;function Fs(n){const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Kn),n.isContextLost())return;bi.supported=!0}catch{}n.deleteTexture(t),qo=!0}zt.document&&(Kn=zt.document.createElement("img"),Kn.onload=function(){Ii&&Fs(Ii),Ii=null,Is=!0},Kn.onerror=function(){qo=!0,Ii=null},Kn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Os="01",tn="NO_ACCESS_TOKEN";function xn(n){return 0===n.indexOf("mapbox:")}function lo(n){return Ie.API_URL_REGEX.test(n)}const Zo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function vn(n){const t=n.match(Zo);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Rr(n){const t=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${t}`}function Wl(n){if(!n)return null;const t=n.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(zt.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class La{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=Wl(Ie.ACCESS_TOKEN);let s="";return s=i&&i.u?zt.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(Number("0x"+f)))):Ie.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const t=Ho("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{const h=zt.localStorage.getItem(i);h&&(this.eventData=JSON.parse(h));const f=zt.localStorage.getItem(s);f&&(this.anonId=f)}catch{hi("Unable to read from LocalStorage")}}saveEventData(){const t=Ho("localStorage"),i=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{zt.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&zt.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{hi("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,s,h){if(!Ie.EVENTS_URL)return;const f=vn(Ie.EVENTS_URL);f.params.push(`access_token=${h||Ie.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.10.0",skuId:Os,userId:this.anonId},y=i?Ve(g,i):g,b={url:Rr(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=Dt(b,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(h)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const Pa=new class extends La{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,t){Ie.EVENTS_URL&&Ie.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>xn(i)||lo(i))&&this.queueRequest(Date.now(),t)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Wl(Ie.ACCESS_TOKEN),i=t?t.u:Ie.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;ks(this.anonId)||(this.anonId=Or(),s=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(h),y=(h-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||f.getDate()!==g.getDate()}else s=!0;s?this.postEvent(h,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=i)},n):this.processRequests()}},Ra=Pa.postTurnstileEvent.bind(Pa),za=new class extends La{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,t,i,s){this.skuToken=t,this.errorCb=s,Ie.EVENTS_URL&&(i||Ie.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(tn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),ks(this.anonId)||(this.anonId=Or()),this.postEvent(i,{skuToken:this.skuToken},s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},n))}},Xl=za.postMapLoadEvent.bind(za),Ba=new class extends La{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,t,i,s){if(!Ie.API_URL||!Ie.SESSION_PATH)return;const h=vn(Ie.API_URL+Ie.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${s||Ie.ACCESS_TOKEN||""}`);const f={url:Rr(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Yt(f,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(s)})}getSessionAPI(n,t,i,s){this.skuToken=t,this.errorCb=s,Ie.SESSION_PATH&&Ie.API_URL&&(i||Ie.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(tn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},n)}},Va=Ba.getSessionAPI.bind(Ba),zr=new Set;let _r,$o=500,Yo=50,Fi={};function Br(n){const t=z(n);let i,s;t&&t.forEach(f=>{const g=f.split("=");"language"===g[0]?i=g[1]:"worldview"===g[0]&&(s=g[1])});let h="mapbox-tiles";return i&&(h+=`-${i}`),s&&(h+=`-${s}`),h}function Y(){try{return zt.caches}catch{}}function P(n){const t=Y();t&&!Fi[n]&&(Fi[n]=t.open(n))}function z(n){const t=n.indexOf("?");return t>0?n.slice(t+1).split("&"):[]}function W(n){const t=n.indexOf("?");if(t<0)return n;const i=z(n).filter(s=>{const h=s.split("=");return"language"===h[0]||"worldview"===h[0]});return i.length?`${n.slice(0,t)}?${i.join("&")}`:n.slice(0,t)}let Q=1/0;const ut={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ut);class ft extends Error{constructor(t,i,s){401===i&&lo(s)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pt=cn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===zt.location.protocol?zt.parent:zt).location.href,ht=function(n,t){if(!(/^file:/.test(i=n.url)||/^file:/.test(pt())&&!/^\w+:/.test(i))){if(zt.fetch&&zt.Request&&zt.AbortController&&zt.Request.prototype.hasOwnProperty("signal"))return function(s,h){const f=new zt.AbortController,g=new zt.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:pt(),signal:f.signal});let y=!1,b=!1;const w=(S=g.url).indexOf("sku=")>0&&lo(S);var S;"json"===s.type&&g.headers.set("Accept","application/json");const T=(O,L,B)=>{if(b)return;if(O&&"SecurityError"!==O.message&&hi(O),L&&B)return k(L);const N=Date.now();zt.fetch(g).then(X=>{if(X.ok){const it=w?X.clone():null;return k(X,it,N)}return h(new ft(X.statusText,X.status,s.url))}).catch(X=>{20!==X.code&&h(new Error(X.message))})},k=(O,L,B)=>{("arrayBuffer"===s.type?O.arrayBuffer():"json"===s.type?O.json():O.text()).then(N=>{b||(L&&B&&function(X,it,K){const tt=Br(X.url);if(P(tt),!Fi[tt])return;const ct={status:it.status,statusText:it.statusText,headers:new zt.Headers};it.headers.forEach((xt,Mt)=>ct.headers.set(Mt,xt));const nt=Xn(it.headers.get("Cache-Control")||"");if(nt["no-store"])return;nt["max-age"]&&ct.headers.set("Expires",new Date(K+1e3*nt["max-age"]).toUTCString());const vt=ct.headers.get("Expires");vt&&(new Date(vt).getTime()-K<42e4||function(xt,Mt){if(void 0===_r)try{new Response(new ReadableStream),_r=!0}catch{_r=!1}_r?Mt(xt.body):xt.blob().then(Mt)}(it,xt=>{const Mt=new zt.Response(xt,ct);P(tt),Fi[tt]&&Fi[tt].then(Bt=>Bt.put(W(X.url),Mt)).catch(Bt=>hi(Bt.message))}))}(g,L,B),y=!0,h(null,N,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(N=>{b||h(new Error(N.message))})};return w?function(O,L){const B=Br(O.url);if(P(B),!Fi[B])return L(null);const N=W(O.url);Fi[B].then(X=>{X.match(N).then(it=>{const K=function(tt){if(!tt)return!1;const ct=new Date(tt.headers.get("Expires")||0),nt=Xn(tt.headers.get("Cache-Control")||"");return ct>Date.now()&&!nt["no-cache"]}(it);X.delete(N),K&&X.put(N,it.clone()),L(null,it,K)}).catch(L)}).catch(L)}(g,T):T(null,null),{cancel:()=>{b=!0,y||f.abort()}}}(n,t);if(cn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,t,void 0,!0)}var i;return function(s,h){const f=new zt.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const g in s.headers)f.setRequestHeader(g,s.headers[g]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===s.type)try{g=JSON.parse(f.response)}catch(y){return h(y)}h(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new ft(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(n,t)},gt=function(n,t){return ht(Ve(n,{type:"arrayBuffer"}),t)},Dt=function(n,t){return ht(Ve(n,{method:"POST"}),t)},Yt=function(n,t){return ht(Ve(n,{method:"GET"}),t)};function Ot(n){const t=zt.document.createElement("a");return t.href=n,t.protocol===zt.document.location.protocol&&t.host===zt.document.location.host}const re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let se,te;se=[],te=0;const oe=function(n,t){if(bi.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),te>=Ie.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return se.push(f),f}te++;let i=!1;const s=()=>{if(!i)for(i=!0,te--;se.length&&te<Ie.MAX_PARALLEL_IMAGE_REQUESTS;){const f=se.shift(),{requestParameters:g,callback:y,cancelled:b}=f;b||(f.cancel=oe(g,y).cancel)}},h=gt(n,(f,g,y,b)=>{s(),f?t(f):g&&(zt.createImageBitmap?function(w,S){const T=new zt.Blob([new Uint8Array(w)],{type:"image/png"});zt.createImageBitmap(T).then(k=>{S(null,k)}).catch(k=>{S(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(w,S)=>t(w,S,y,b)):function(w,S){const T=new zt.Image,k=zt.URL;T.onload=()=>{S(null,T),k.revokeObjectURL(T.src),T.onload=null,zt.requestAnimationFrame(()=>{T.src=re})},T.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new zt.Blob([new Uint8Array(w)],{type:"image/png"});T.src=w.byteLength?k.createObjectURL(O):re}(g,(w,S)=>t(w,S,y,b)))});return{cancel:()=>{h.cancel(),s()}}};function xe(n,t,i){i[n]&&-1!==i[n].indexOf(t)||(i[n]=i[n]||[],i[n].push(t))}function Ge(n,t,i){if(i&&i[n]){const s=i[n].indexOf(t);-1!==s&&i[n].splice(s,1)}}class Ye{constructor(t,i={}){Ve(this,i),this.type=t}}class Ne extends Ye{constructor(t,i={}){super("error",Ve({error:t},i))}}class ie{on(t,i){return this._listeners=this._listeners||{},xe(t,i,this._listeners),this}off(t,i){return Ge(t,i,this._listeners),Ge(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},xe(t,i,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,i){"string"==typeof t&&(t=new Ye(t,i||{}));const s=t.type;if(this.listens(s)){t.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of h)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)Ge(s,y,this._oneTimeListeners),y.call(this,t);const g=this._eventedParent;g&&(Ve(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Ne&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var Ct=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function bn(n,...t){for(const i of t)for(const s in i)n[s]=i[s];return n}function gi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Vr(n){if(Array.isArray(n))return n.map(Vr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const i in n)t[i]=Vr(n[i]);return t}return gi(n)}class Ls extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var Un=Ls;class Jl{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[s,h]of i)this.bindings[s]=h}concat(t){return new Jl(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Bh=Jl;const co={kind:"null"},Wt={kind:"number"},Me={kind:"string"},Ee={kind:"boolean"},Dn={kind:"color"},wn={kind:"object"},ve={kind:"value"},Ga={kind:"collator"},Ps={kind:"formatted"},yr={kind:"resolvedImage"};function Bi(n,t){return{kind:"array",itemType:n,N:t}}function di(n){if("array"===n.kind){const t=di(n.itemType);return"number"==typeof n.N?`array<${t}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${t}>`}return n.kind}const Kl=[co,Wt,Me,Ee,Dn,Ps,wn,Bi(ve),yr];function Qn(n,t){if("error"===t.kind)return null;if("array"===n.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Qn(n.itemType,t.itemType))&&("number"!=typeof n.N||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if("value"===n.kind)for(const i of Kl)if(!Qn(i,t))return null}return`Expected ${di(n)} but found ${di(t)} instead.`}function Ql(n,t){return t.some(i=>i.kind===n.kind)}function Gr(n,t){return t.some(i=>"null"===i?null===n:"array"===i?Array.isArray(n):"object"===i?n&&!Array.isArray(n)&&"object"==typeof n:i===typeof n)}function Na(n){var t={exports:{}};return n(t,t.exports),t.exports}var uo=Na(function(n,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(y){return(y=Math.round(y))<0?0:y>255?255:y}function h(y){return s("%"===y[y.length-1]?parseFloat(y)/100*255:parseInt(y))}function f(y){return(b="%"===y[y.length-1]?parseFloat(y)/100:parseFloat(y))<0?0:b>1?1:b;var b}function g(y,b,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?y+(b-y)*w*6:2*w<1?b:3*w<2?y+(b-y)*(2/3-w)*6:y}try{t.parseCSSColor=function(y){var b,w=y.replace(/ /g,"").toLowerCase();if(w in i)return i[w].slice();if("#"===w[0])return 4===w.length?(b=parseInt(w.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===w.length&&(b=parseInt(w.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var S=w.indexOf("("),T=w.indexOf(")");if(-1!==S&&T+1===w.length){var k=w.substr(0,S),O=w.substr(S+1,T-(S+1)).split(","),L=1;switch(k){case"rgba":if(4!==O.length)return null;L=f(O.pop());case"rgb":return 3!==O.length?null:[h(O[0]),h(O[1]),h(O[2]),L];case"hsla":if(4!==O.length)return null;L=f(O.pop());case"hsl":if(3!==O.length)return null;var B=(parseFloat(O[0])%360+360)%360/360,N=f(O[1]),X=f(O[2]),it=X<=.5?X*(N+1):X+N-X*N,K=2*X-it;return[s(255*g(K,it,B+1/3)),s(255*g(K,it,B)),s(255*g(K,it,B-1/3)),L];default:return null}}return null}}catch{}});class un{constructor(t,i,s,h=1){this.r=t,this.g=i,this.b=s,this.a=h}static parse(t){if(!t)return;if(t instanceof un)return t;if("string"!=typeof t)return;const i=uo.parseCSSColor(t);return i?new un(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,i,s,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(s)},${h})`}toArray(){const{r:t,g:i,b:s,a:h}=this;return 0===h?[0,0,0,0]:[255*t/h,255*i/h,255*s/h,h]}toArray01(){const{r:t,g:i,b:s,a:h}=this;return 0===h?[0,0,0,0]:[t/h,i/h,s/h,h]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:s,a:h}=this;return[t,i,s,h]}}un.black=new un(0,0,0,1),un.white=new un(1,1,1,1),un.transparent=new un(0,0,0,0),un.red=new un(1,0,0,1),un.blue=new un(0,0,1,1);var We=un;class pu{constructor(t,i,s){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Rs{constructor(t,i,s,h,f){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=s,this.fontStack=h,this.textColor=f}}class en{constructor(t){this.sections=t}static fromString(t){return new en([new Rs(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof en?t:en.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){t.push(["image",i.image.name]);continue}t.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(s)}return t}}class hn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new hn({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Ua(n,t,i,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,t,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,t,i,s]:[n,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xr(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof We||n instanceof pu||n instanceof en||n instanceof hn)return!0;if(Array.isArray(n)){for(const t of n)if(!xr(t))return!1;return!0}if("object"==typeof n){for(const t in n)if(!xr(n[t]))return!1;return!0}return!1}function wi(n){if(null===n)return co;if("string"==typeof n)return Me;if("boolean"==typeof n)return Ee;if("number"==typeof n)return Wt;if(n instanceof We)return Dn;if(n instanceof pu)return Ga;if(n instanceof en)return Ps;if(n instanceof hn)return yr;if(Array.isArray(n)){const t=n.length;let i;for(const s of n){const h=wi(s);if(i){if(i===h)continue;i=ve;break}i=h}return Bi(i||ve,t)}return wn}function zs(n){const t=typeof n;return null===n?"":"string"===t||"number"===t||"boolean"===t?String(n):n instanceof We||n instanceof en||n instanceof hn?n.toString():JSON.stringify(n)}class ja{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(2!==t.length)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!xr(t[1]))return i.error("invalid value");const s=t[1];let h=wi(s);const f=i.expectedType;return"array"!==h.kind||0!==h.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(h=f),new ja(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof We?["rgba"].concat(this.value.toArray()):this.value instanceof en?this.value.serialize():this.value}}var Bs=ja,Vi=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const Wo={string:Me,number:Wt,boolean:Ee,object:wn};class tc{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let s,h=1;const f=t[0];if("array"===f){let y,b;if(t.length>2){const w=t[1];if("string"!=typeof w||!(w in Wo)||"object"===w)return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Wo[w],h++}else y=ve;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}s=Bi(y,b)}else s=Wo[f];const g=[];for(;h<t.length;h++){const y=i.parse(t[h],h,ve);if(!y)return null;g.push(y)}return new tc(s,g)}evaluate(t){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(t);if(!Qn(this.type,wi(s)))return s;if(i===this.args.length-1)throw new Vi(`Expected value to be of type ${di(this.type)}, but found ${di(wi(s))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if("array"===t.kind){const s=t.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){i.push(s.kind);const h=t.N;("number"==typeof h||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(s=>s.serialize()))}}var Cn=tc;class Vs{constructor(t){this.type=Ps,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&"object"==typeof s)return i.error("First argument must be an image or text section.");const h=[];let f=!1;for(let g=1;g<=t.length-1;++g){const y=t[g];if(f&&"object"==typeof y&&!Array.isArray(y)){f=!1;let b=null;if(y["font-scale"]&&(b=i.parse(y["font-scale"],1,Wt),!b))return null;let w=null;if(y["text-font"]&&(w=i.parse(y["text-font"],1,Bi(Me)),!w))return null;let S=null;if(y["text-color"]&&(S=i.parse(y["text-color"],1,Dn),!S))return null;const T=h[h.length-1];T.scale=b,T.font=w,T.textColor=S}else{const b=i.parse(t[g],1,ve);if(!b)return null;const w=b.type.kind;if("string"!==w&&"value"!==w&&"null"!==w&&"resolvedImage"!==w)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Vs(h)}evaluate(t){return new en(this.sections.map(i=>{const s=i.content.evaluate(t);return wi(s)===yr?new Rs("",s,null,null,null):new Rs(zs(s),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),t.push(s)}return t}}class Gs{constructor(t){this.type=yr,this.input=t}static parse(t,i){if(2!==t.length)return i.error("Expected two arguments.");const s=i.parse(t[1],1,Me);return s?new Gs(s):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),s=hn.fromString(i);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(i)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ec={"to-boolean":Ee,"to-color":Dn,"to-number":Wt,"to-string":Me};class ic{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const s=t[0];if(("to-boolean"===s||"to-string"===s)&&2!==t.length)return i.error("Expected one argument.");const h=ec[s],f=[];for(let g=1;g<t.length;g++){const y=i.parse(t[g],g,ve);if(!y)return null;f.push(y)}return new ic(h,f)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let i,s;for(const h of this.args){if(i=h.evaluate(t),s=null,i instanceof We)return i;if("string"==typeof i){const f=t.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ua(i[0],i[1],i[2],i[3]),!s))return new We(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Vi(s||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const s of this.args){if(i=s.evaluate(t),null===i)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Vi(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?en.fromString(zs(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?hn.fromString(zs(this.args[0].evaluate(t))):zs(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Vs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Gs(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var ho=ic;const Vh=["Unknown","Point","LineString","Polygon"];var Xo=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Vh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-n[0])+this.featureDistanceData.bearing[1]*(s*t-n[1])}return 0}parseColor(n){let t=this._parseColorCache[n];return t||(t=this._parseColorCache[n]=We.parse(n)),t}};class po{constructor(t,i,s,h){this.name=t,this.type=i,this._evaluate=s,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const s=t[0],h=po.definitions[s];if(!h)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,y=g.filter(([w])=>!Array.isArray(w)||w.length===t.length-1);let b=null;for(const[w,S]of y){b=new br(i.registry,i.path,null,i.scope);const T=[];let k=!1;for(let O=1;O<t.length;O++){const L=t[O],B=Array.isArray(w)?w[O-1]:w.type,N=b.parse(L,1+T.length,B);if(!N){k=!0;break}T.push(N)}if(!k)if(Array.isArray(w)&&w.length!==T.length)b.error(`Expected ${w.length} arguments, but found ${T.length} instead.`);else{for(let O=0;O<T.length;O++){const L=Array.isArray(w)?w[O]:w.type,B=T[O];b.concat(O+1).checkSubtype(L,B.type)}if(0===b.errors.length)return new po(s,f,S,T)}}if(1===y.length)i.errors.push(...b.errors);else{const w=(y.length?y:g).map(([T])=>{return k=T,Array.isArray(k)?`(${k.map(di).join(", ")})`:`(${di(k.type)}...)`;var k}).join(" | "),S=[];for(let T=1;T<t.length;T++){const k=i.parse(t[T],1+S.length);if(!k)return null;S.push(di(k.type))}i.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(t,i){po.definitions=i;for(const s in i)t[s]=po}}var Mn=po;class Ha{constructor(t,i,s){this.type=Ga,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(2!==t.length)return i.error("Expected one argument.");const s=t[1];if("object"!=typeof s||Array.isArray(s))return i.error("Collator options argument must be an object.");const h=i.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Ee);if(!h)return null;const f=i.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Ee);if(!f)return null;let g=null;return s.locale&&(g=i.parse(s.locale,1,Me),!g)?null:new Ha(h,f,g)}evaluate(t){return new pu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const tr=8192;function qa(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Za(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function fu(n,t){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*tr),Math.round(s*h*tr)]}function Gh(n,t,i){const s=n[0]-t[0],h=n[1]-t[1],f=n[0]-i[0],g=n[1]-i[1];return s*g-f*h==0&&s*f<=0&&h*g<=0}function Ns(n,t){let i=!1;for(let g=0,y=t.length;g<y;g++){const b=t[g];for(let w=0,S=b.length;w<S-1;w++){if(Gh(n,b[w],b[w+1]))return!1;(h=b[w])[1]>(s=n)[1]!=(f=b[w+1])[1]>s[1]&&s[0]<(f[0]-h[0])*(s[1]-h[1])/(f[1]-h[1])+h[0]&&(i=!i)}}var s,h,f;return i}function $a(n,t){for(let i=0;i<t.length;i++)if(Ns(n,t[i]))return!0;return!1}function Ya(n,t,i,s){const h=s[0]-i[0],f=s[1]-i[1],g=(n[0]-i[0])*f-h*(n[1]-i[1]),y=(t[0]-i[0])*f-h*(t[1]-i[1]);return g>0&&y<0||g<0&&y>0}function Nh(n,t,i){for(const w of i)for(let S=0;S<w.length-1;++S)if((y=[(g=w[S+1])[0]-(f=w[S])[0],g[1]-f[1]])[0]*(b=[(h=t)[0]-(s=n)[0],h[1]-s[1]])[1]-y[1]*b[0]!=0&&Ya(s,h,f,g)&&Ya(f,g,s,h))return!0;var s,h,f,g,y,b;return!1}function mu(n,t){for(let i=0;i<n.length;++i)if(!Ns(n[i],t))return!1;for(let i=0;i<n.length-1;++i)if(Nh(n[i],n[i+1],t))return!1;return!0}function gu(n,t){for(let i=0;i<t.length;i++)if(mu(n,t[i]))return!0;return!1}function In(n,t,i){const s=[];for(let h=0;h<n.length;h++){const f=[];for(let g=0;g<n[h].length;g++){const y=fu(n[h][g],i);qa(t,y),f.push(y)}s.push(f)}return s}function _u(n,t,i){const s=[];for(let h=0;h<n.length;h++){const f=In(n[h],t,i);s.push(f)}return s}function Us(n,t,i,s){if(n[0]<i[0]||n[0]>i[2]){const h=.5*s;let f=n[0]-i[0]>h?-s:i[0]-n[0]>h?s:0;0===f&&(f=n[0]-i[2]>h?-s:i[2]-n[0]>h?s:0),n[0]+=f}qa(t,n)}function nc(n,t,i,s){const h=Math.pow(2,s.z)*tr,f=[s.x*tr,s.y*tr],g=[];if(!n)return g;for(const y of n)for(const b of y){const w=[b.x+f[0],b.y+f[1]];Us(w,t,i,h),g.push(w)}return g}function Wa(n,t,i,s){const h=Math.pow(2,s.z)*tr,f=[s.x*tr,s.y*tr],g=[];if(!n)return g;for(const b of n){const w=[];for(const S of b){const T=[S.x+f[0],S.y+f[1]];qa(t,T),w.push(T)}g.push(w)}if(t[2]-t[0]<=h/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of g)for(const w of b)Us(w,t,i,h)}var y;return g}class fo{constructor(t,i){this.type=Ee,this.geojson=t,this.geometries=i}static parse(t,i){if(2!==t.length)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(xr(t[1])){const s=t[1];if("FeatureCollection"===s.type)for(let h=0;h<s.features.length;++h){const f=s.features[h].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new fo(s,s.features[h].geometry)}else if("Feature"===s.type){const h=s.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new fo(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new fo(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(i,s){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if("Polygon"===s.type){const y=In(s.coordinates,f,g),b=nc(i.geometry(),h,f,g);if(!Za(h,f))return!1;for(const w of b)if(!Ns(w,y))return!1}if("MultiPolygon"===s.type){const y=_u(s.coordinates,f,g),b=nc(i.geometry(),h,f,g);if(!Za(h,f))return!1;for(const w of b)if(!$a(w,y))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(i,s){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if("Polygon"===s.type){const y=In(s.coordinates,f,g),b=Wa(i.geometry(),h,f,g);if(!Za(h,f))return!1;for(const w of b)if(!mu(w,y))return!1}if("MultiPolygon"===s.type){const y=_u(s.coordinates,f,g),b=Wa(i.geometry(),h,f,g);if(!Za(h,f))return!1;for(const w of b)if(!gu(w,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var er=fo;function mo(n){if(n instanceof Mn&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof er)return!1;let t=!0;return n.eachChild(i=>{t&&!mo(i)&&(t=!1)}),t}function vr(n){if(n instanceof Mn&&"feature-state"===n.name)return!1;let t=!0;return n.eachChild(i=>{t&&!vr(i)&&(t=!1)}),t}function js(n,t){if(n instanceof Mn&&t.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!js(s,t)&&(i=!1)}),i}class Hs{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(2!==t.length||"string"!=typeof t[1])return i.error("'var' expression requires exactly one string literal argument.");const s=t[1];return i.scope.has(s)?new Hs(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Xa=Hs;class Ja{constructor(t,i=[],s,h=new Bh,f=[]){this.registry=t,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=h,this.errors=f,this.expectedType=s}parse(t,i,s,h,f={}){return i?this.concat(i,s,h)._parse(t,f):this._parse(t,f)}_parse(t,i){function s(h,f,g){return"assert"===g?new Cn(f,[h]):"coerce"===g?new ho(f,[h]):h}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let g=f.parse(t,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,b=g.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==b.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(y,b))return null}else g=s(g,y,i.typeAnnotation||"coerce");else g=s(g,y,i.typeAnnotation||"assert")}if(!(g instanceof Bs)&&"resolvedImage"!==g.type.kind&&Pe(g)){const y=new Xo;try{g=new Bs(g.type,g.evaluate(y))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,s){const h="number"==typeof t?this.path.concat(t):this.path,f=s?this.scope.concat(s):this.scope;return new Ja(this.registry,h,i||null,f,this.errors)}error(t,...i){const s=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Un(s,t))}checkSubtype(t,i){const s=Qn(t,i);return s&&this.error(s),s}}var br=Ja;function Pe(n){if(n instanceof Xa)return Pe(n.boundExpression);if(n instanceof Mn&&"error"===n.name||n instanceof Ha||n instanceof er)return!1;const t=n instanceof ho||n instanceof Cn;let i=!0;return n.eachChild(s=>{i=t?i&&Pe(s):i&&s instanceof Bs}),!!i&&mo(n)&&js(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ka(n,t){const i=n.length-1;let s,h,f=0,g=i,y=0;for(;f<=g;)if(y=Math.floor((f+g)/2),s=n[y],h=n[y+1],s<=t){if(y===i||t<h)return y;f=y+1}else{if(!(s>t))throw new Vi("Input is not a number.");g=y-1}return 0}class Qa{constructor(t,i,s){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,f]of s)this.labels.push(h),this.outputs.push(f)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(t[1],1,Wt);if(!s)return null;const h=[];let f=null;i.expectedType&&"value"!==i.expectedType.kind&&(f=i.expectedType);for(let g=1;g<t.length;g+=2){const y=1===g?-1/0:t[g],b=t[g+1],w=g,S=g+1;if("number"!=typeof y)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(h.length&&h[h.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const T=i.parse(b,S,f);if(!T)return null;f=f||T.type,h.push([y,T])}return new Qa(f,s,h)}evaluate(t){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return s[0].evaluate(t);const f=i.length;return h>=i[f-1]?s[f-1].evaluate(t):s[Ka(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var rc=Qa;function Oe(n,t,i){return n*(1-i)+t*i}function Jo(n,t,i){return n.map((s,h)=>Oe(s,t[h],i))}var Ko=Object.freeze({__proto__:null,number:Oe,color:function(n,t,i){return new We(Oe(n.r,t.r,i),Oe(n.g,t.g,i),Oe(n.b,t.b,i),Oe(n.a,t.a,i))},array:Jo});const yu=4/29,go=6/29,el=3*go*go,Uh=Math.PI/180,xu=180/Math.PI;function qs(n){return n>.008856451679035631?Math.pow(n,1/3):n/el+yu}function il(n){return n>go?n*n*n:el*(n-yu)}function vu(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function sc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ac(n){const t=sc(n.r),i=sc(n.g),s=sc(n.b),h=qs((.4124564*t+.3575761*i+.1804375*s)/.95047),f=qs((.2126729*t+.7151522*i+.072175*s)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-qs((.0193339*t+.119192*i+.9503041*s)/1.08883)),alpha:n.a}}function lc(n){let t=(n.l+16)/116,i=isNaN(n.a)?t:t+n.a/500,s=isNaN(n.b)?t:t-n.b/200;return t=1*il(t),i=.95047*il(i),s=1.08883*il(s),new We(vu(3.2404542*i-1.5371385*t-.4985314*s),vu(-.969266*i+1.8760108*t+.041556*s),vu(.0556434*i-.2040259*t+1.0572252*s),n.alpha)}function jh(n,t,i){const s=t-n;return n+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const nl={forward:ac,reverse:lc,interpolate:function(n,t,i){return{l:Oe(n.l,t.l,i),a:Oe(n.a,t.a,i),b:Oe(n.b,t.b,i),alpha:Oe(n.alpha,t.alpha,i)}}},Zs={forward:function(n){const{l:t,a:i,b:s}=ac(n),h=Math.atan2(s,i)*xu;return{h:h<0?h+360:h,c:Math.sqrt(i*i+s*s),l:t,alpha:n.a}},reverse:function(n){const t=n.h*Uh,i=n.c;return lc({l:n.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:n.alpha})},interpolate:function(n,t,i){return{h:jh(n.h,t.h,i),c:Oe(n.c,t.c,i),l:Oe(n.l,t.l,i),alpha:Oe(n.alpha,t.alpha,i)}}};var ae=Object.freeze({__proto__:null,lab:nl,hcl:Zs});class Qo{constructor(t,i,s,h,f){this.type=t,this.operator=i,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[g,y]of f)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(t,i,s,h){let f=0;if("exponential"===t.name)f=jn(i,t.base,s,h);else if("linear"===t.name)f=jn(i,1,s,h);else if("cubic-bezier"===t.name){const g=t.controlPoints;f=new dr(g[0],g[1],g[2],g[3]).solve(jn(i,1,s,h))}return f}static parse(t,i){let[s,h,f,...g]=t;if(!Array.isArray(h)||0===h.length)return i.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const w=h[1];if("number"!=typeof w)return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:w}}else{if("cubic-bezier"!==h[0])return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const w=h.slice(1);if(4!==w.length||w.some(S=>"number"!=typeof S||S<0||S>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:w}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Wt),!f)return null;const y=[];let b=null;"interpolate-hcl"===s||"interpolate-lab"===s?b=Dn:i.expectedType&&"value"!==i.expectedType.kind&&(b=i.expectedType);for(let w=0;w<g.length;w+=2){const S=g[w],T=g[w+1],k=w+3,O=w+4;if("number"!=typeof S)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=S)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const L=i.parse(T,O,b);if(!L)return null;b=b||L.type,y.push([S,L])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new Qo(b,s,h,f,y):i.error(`Type ${di(b)} is not interpolatable.`)}evaluate(t){const i=this.labels,s=this.outputs;if(1===i.length)return s[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return s[0].evaluate(t);const f=i.length;if(h>=i[f-1])return s[f-1].evaluate(t);const g=Ka(i,h),y=Qo.interpolationFactor(this.interpolation,h,i[g],i[g+1]),b=s[g].evaluate(t),w=s[g+1].evaluate(t);return"interpolate"===this.operator?Ko[this.type.kind.toLowerCase()](b,w,y):"interpolate-hcl"===this.operator?Zs.reverse(Zs.interpolate(Zs.forward(b),Zs.forward(w),y)):nl.reverse(nl.interpolate(nl.forward(b),nl.forward(w),y))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,t,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function jn(n,t,i,s){const h=s-i,f=n-i;return 0===h?0:1===t?f/h:(Math.pow(t,f)-1)/(Math.pow(t,h)-1)}var pi=Qo;class _o{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let s=null;const h=i.expectedType;h&&"value"!==h.kind&&(s=h);const f=[];for(const y of t.slice(1)){const b=i.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,f.push(b)}const g=h&&f.some(y=>Qn(h,y.type));return new _o(g?ve:s,f)}evaluate(t){let i,s=null,h=0;for(const f of this.args){if(h++,s=f.evaluate(t),s&&s instanceof hn&&!s.available&&(i||(i=s),s=null,h===this.args.length))return i;if(null!==s)break}return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var bu=_o;class cc{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let f=1;f<t.length-1;f+=2){const g=t[f];if("string"!=typeof g)return i.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(t[f+1],f+1);if(!y)return null;s.push([g,y])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,s);return h?new cc(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,s]of this.bindings)t.push(i,s.serialize());return t.push(this.result.serialize()),t}}var uc=cc;class $s{constructor(t,i,s){this.type=t,this.index=i,this.input=s}static parse(t,i){if(3!==t.length)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,Wt),h=i.parse(t[2],2,Bi(i.expectedType||ve));return s&&h?new $s(h.type.itemType,s,h):null}evaluate(t){const i=this.index.evaluate(t),s=this.input.evaluate(t);if(i<0)throw new Vi(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new Vi(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new Vi(`Array index must be an integer, but found ${i} instead.`);return s[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Nr=$s;class rl{constructor(t,i){this.type=Ee,this.needle=t,this.haystack=i}static parse(t,i){if(3!==t.length)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,ve),h=i.parse(t[2],2,ve);return s&&h?Ql(s.type,[Ee,Me,Wt,co,ve])?new rl(s,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(s.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(null==s)return!1;if(!Gr(i,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${di(wi(i))} instead.`);if(!Gr(s,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${di(wi(s))} instead.`);return s.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var hc=rl;class dn{constructor(t,i,s){this.type=Wt,this.needle=t,this.haystack=i,this.fromIndex=s}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,ve),h=i.parse(t[2],2,ve);if(!s||!h)return null;if(!Ql(s.type,[Ee,Me,Wt,co,ve]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(s.type)} instead`);if(4===t.length){const f=i.parse(t[3],3,Wt);return f?new dn(s,h,f):null}return new dn(s,h)}evaluate(t){const i=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Gr(i,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${di(wi(i))} instead.`);if(!Gr(s,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${di(wi(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return s.indexOf(i,h)}return s.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var yo=dn;class ts{constructor(t,i,s,h,f,g){this.inputType=t,this.type=i,this.input=s,this.cases=h,this.outputs=f,this.otherwise=g}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let s,h;i.expectedType&&"value"!==i.expectedType.kind&&(h=i.expectedType);const f={},g=[];for(let w=2;w<t.length-1;w+=2){let S=t[w];const T=t[w+1];Array.isArray(S)||(S=[S]);const k=i.concat(w);if(0===S.length)return k.error("Expected at least one branch label.");for(const L of S){if("number"!=typeof L&&"string"!=typeof L)return k.error("Branch labels must be numbers or strings.");if("number"==typeof L&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof L&&Math.floor(L)!==L)return k.error("Numeric branch labels must be integer values.");if(s){if(k.checkSubtype(s,wi(L)))return null}else s=wi(L);if(void 0!==f[String(L)])return k.error("Branch labels must be unique.");f[String(L)]=g.length}const O=i.parse(T,w,h);if(!O)return null;h=h||O.type,g.push(O)}const y=i.parse(t[1],1,ve);if(!y)return null;const b=i.parse(t[t.length-1],t.length-1,h);return b?"value"!==y.type.kind&&i.concat(1).checkSubtype(s,y.type)?null:new ts(s,h,y,f,g,b):null}evaluate(t){const i=this.input.evaluate(t);return(wi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],h={};for(const g of i){const y=h[this.cases[g]];void 0===y?(h[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[y][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,y]of s)t.push(1===y.length?f(y[0]):y.map(f)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}var dc=ts;class es{constructor(t,i,s){this.type=t,this.branches=i,this.otherwise=s}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const y=i.parse(t[g],g,Ee);if(!y)return null;const b=i.parse(t[g+1],g+1,s);if(!b)return null;h.push([y,b]),s=s||b.type}const f=i.parse(t[t.length-1],t.length-1,s);return f?new es(s,h,f):null}evaluate(t){for(const[i,s]of this.branches)if(i.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,s]of this.branches)t(i),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var wu=es;class ol{constructor(t,i,s,h){this.type=t,this.input=i,this.beginIndex=s,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=i.parse(t[1],1,ve),h=i.parse(t[2],2,Wt);if(!s||!h)return null;if(!Ql(s.type,[Bi(ve),Me,ve]))return i.error(`Expected first argument to be of type array or string, but found ${di(s.type)} instead`);if(4===t.length){const f=i.parse(t[3],3,Wt);return f?new ol(s.type,s,h,f):null}return new ol(s.type,s,h)}evaluate(t){const i=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Gr(i,["string","array"]))throw new Vi(`Expected first argument to be of type array or string, but found ${di(wi(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return i.slice(s,h)}return i.slice(s)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Cu=ol;function pc(n,t){return"=="===n||"!="===n?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function fc(n,t,i,s){return 0===s.compare(t,i)}function ei(n,t,i){const s="=="!==n&&"!="!==n;return class Dy{constructor(f,g,y){this.type=Ee,this.lhs=f,this.rhs=g,this.collator=y,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const y=f[0];let b=g.parse(f[1],1,ve);if(!b)return null;if(!pc(y,b.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${di(b.type)}'.`);let w=g.parse(f[2],2,ve);if(!w)return null;if(!pc(y,w.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${di(w.type)}'.`);if(b.type.kind!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return g.error(`Cannot compare types '${di(b.type)}' and '${di(w.type)}'.`);s&&("value"===b.type.kind&&"value"!==w.type.kind?b=new Cn(w.type,[b]):"value"!==b.type.kind&&"value"===w.type.kind&&(w=new Cn(b.type,[w])));let S=null;if(4===f.length){if("string"!==b.type.kind&&"string"!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return g.error("Cannot use collator to compare non-string types.");if(S=g.parse(f[3],3,Ga),!S)return null}return new Dy(b,w,S)}evaluate(f){const g=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const b=wi(g),w=wi(y);if(b.kind!==w.kind||"string"!==b.kind&&"number"!==b.kind)throw new Vi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=wi(g),w=wi(y);if("string"!==b.kind||"string"!==w.kind)return t(f,g,y)}return this.collator?i(f,g,y,this.collator.evaluate(f)):t(f,g,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const Hh=ei("==",function(n,t,i){return t===i},fc),Mu=ei("!=",function(n,t,i){return t!==i},function(n,t,i,s){return!fc(0,t,i,s)}),Au=ei("<",function(n,t,i){return t<i},function(n,t,i,s){return s.compare(t,i)<0}),Ys=ei(">",function(n,t,i){return t>i},function(n,t,i,s){return s.compare(t,i)>0}),mc=ei("<=",function(n,t,i){return t<=i},function(n,t,i,s){return s.compare(t,i)<=0}),gc=ei(">=",function(n,t,i){return t>=i},function(n,t,i,s){return s.compare(t,i)>=0});class sl{constructor(t,i,s,h,f,g){this.type=Me,this.number=t,this.locale=i,this.currency=s,this.unit=h,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(t,i){if(3!==t.length)return i.error("Expected two arguments.");const s=i.parse(t[1],1,Wt);if(!s)return null;const h=t[2];if("object"!=typeof h||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=i.parse(h.locale,1,Me),!f))return null;let g=null;if(h.currency&&(g=i.parse(h.currency,1,Me),!g))return null;let y=null;if(h.unit&&(y=i.parse(h.unit,1,Me),!y))return null;let b=null;if(h["min-fraction-digits"]&&(b=i.parse(h["min-fraction-digits"],1,Wt),!b))return null;let w=null;return h["max-fraction-digits"]&&(w=i.parse(h["max-fraction-digits"],1,Wt),!w)?null:new sl(s,f,g,y,b,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Hn{constructor(t){this.type=Wt,this.input=t}static parse(t,i){if(2!==t.length)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=i.parse(t[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?i.error(`Expected argument of type string or array, but found ${di(s.type)} instead.`):new Hn(s):null}evaluate(t){const i=this.input.evaluate(t);if("string"==typeof i||Array.isArray(i))return i.length;throw new Vi(`Expected value to be of type string or array, but found ${di(wi(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}const Su={"==":Hh,"!=":Mu,">":Ys,"<":Au,">=":gc,"<=":mc,array:Cn,at:Nr,boolean:Cn,case:wu,coalesce:bu,collator:Ha,format:Vs,image:Gs,in:hc,"index-of":yo,interpolate:pi,"interpolate-hcl":pi,"interpolate-lab":pi,length:Hn,let:uc,literal:Bs,match:dc,number:Cn,"number-format":sl,object:Cn,slice:Cu,step:rc,string:Cn,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:Xa,within:er};function _c(n,[t,i,s,h]){t=t.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const f=h?h.evaluate(n):1,g=Ua(t,i,s,f);if(g)throw new Vi(g);return new We(t/255*f,i/255*f,s/255*f,f)}function yc(n,t){return n in t}function al(n,t){const i=t[n];return void 0===i?null:i}function wr(n){return{type:n}}Mn.register(Su,{error:[{kind:"error"},[Me],(n,[t])=>{throw new Vi(t.evaluate(n))}],typeof:[Me,[ve],(n,[t])=>di(wi(t.evaluate(n)))],"to-rgba":[Bi(Wt,4),[Dn],(n,[t])=>t.evaluate(n).toArray()],rgb:[Dn,[Wt,Wt,Wt],_c],rgba:[Dn,[Wt,Wt,Wt,Wt],_c],has:{type:Ee,overloads:[[[Me],(n,[t])=>yc(t.evaluate(n),n.properties())],[[Me,wn],(n,[t,i])=>yc(t.evaluate(n),i.evaluate(n))]]},get:{type:ve,overloads:[[[Me],(n,[t])=>al(t.evaluate(n),n.properties())],[[Me,wn],(n,[t,i])=>al(t.evaluate(n),i.evaluate(n))]]},"feature-state":[ve,[Me],(n,[t])=>al(t.evaluate(n),n.featureState||{})],properties:[wn,[],n=>n.properties()],"geometry-type":[Me,[],n=>n.geometryType()],id:[ve,[],n=>n.id()],zoom:[Wt,[],n=>n.globals.zoom],pitch:[Wt,[],n=>n.globals.pitch||0],"distance-from-center":[Wt,[],n=>n.distanceFromCenter()],"heatmap-density":[Wt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Wt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Wt,[],n=>n.globals.skyRadialProgress||0],accumulated:[ve,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Wt,wr(Wt),(n,t)=>{let i=0;for(const s of t)i+=s.evaluate(n);return i}],"*":[Wt,wr(Wt),(n,t)=>{let i=1;for(const s of t)i*=s.evaluate(n);return i}],"-":{type:Wt,overloads:[[[Wt,Wt],(n,[t,i])=>t.evaluate(n)-i.evaluate(n)],[[Wt],(n,[t])=>-t.evaluate(n)]]},"/":[Wt,[Wt,Wt],(n,[t,i])=>t.evaluate(n)/i.evaluate(n)],"%":[Wt,[Wt,Wt],(n,[t,i])=>t.evaluate(n)%i.evaluate(n)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(n,[t,i])=>Math.pow(t.evaluate(n),i.evaluate(n))],sqrt:[Wt,[Wt],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))],log2:[Wt,[Wt],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Wt,[Wt],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Wt,[Wt],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Wt,[Wt],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Wt,[Wt],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Wt,[Wt],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Wt,[Wt],(n,[t])=>Math.atan(t.evaluate(n))],min:[Wt,wr(Wt),(n,t)=>Math.min(...t.map(i=>i.evaluate(n)))],max:[Wt,wr(Wt),(n,t)=>Math.max(...t.map(i=>i.evaluate(n)))],abs:[Wt,[Wt],(n,[t])=>Math.abs(t.evaluate(n))],round:[Wt,[Wt],(n,[t])=>{const i=t.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Wt,[Wt],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Wt,[Wt],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Ee,[Me,ve],(n,[t,i])=>n.properties()[t.value]===i.value],"filter-id-==":[Ee,[ve],(n,[t])=>n.id()===t.value],"filter-type-==":[Ee,[Me],(n,[t])=>n.geometryType()===t.value],"filter-<":[Ee,[Me,ve],(n,[t,i])=>{const s=n.properties()[t.value],h=i.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Ee,[ve],(n,[t])=>{const i=n.id(),s=t.value;return typeof i==typeof s&&i<s}],"filter->":[Ee,[Me,ve],(n,[t,i])=>{const s=n.properties()[t.value],h=i.value;return typeof s==typeof h&&s>h}],"filter-id->":[Ee,[ve],(n,[t])=>{const i=n.id(),s=t.value;return typeof i==typeof s&&i>s}],"filter-<=":[Ee,[Me,ve],(n,[t,i])=>{const s=n.properties()[t.value],h=i.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Ee,[ve],(n,[t])=>{const i=n.id(),s=t.value;return typeof i==typeof s&&i<=s}],"filter->=":[Ee,[Me,ve],(n,[t,i])=>{const s=n.properties()[t.value],h=i.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Ee,[ve],(n,[t])=>{const i=n.id(),s=t.value;return typeof i==typeof s&&i>=s}],"filter-has":[Ee,[ve],(n,[t])=>t.value in n.properties()],"filter-has-id":[Ee,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Ee,[Bi(Me)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ee,[Bi(ve)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Ee,[Me,Bi(ve)],(n,[t,i])=>i.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Ee,[Me,Bi(ve)],(n,[t,i])=>function(s,h,f,g){for(;f<=g;){const y=f+g>>1;if(h[y]===s)return!0;h[y]>s?g=y-1:f=y+1}return!1}(n.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Ee,overloads:[[[Ee,Ee],(n,[t,i])=>t.evaluate(n)&&i.evaluate(n)],[wr(Ee),(n,t)=>{for(const i of t)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Ee,overloads:[[[Ee,Ee],(n,[t,i])=>t.evaluate(n)||i.evaluate(n)],[wr(Ee),(n,t)=>{for(const i of t)if(i.evaluate(n))return!0;return!1}]]},"!":[Ee,[Ee],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Ee,[Me],(n,[t])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(t.evaluate(n))}],upcase:[Me,[Me],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[Me,[Me],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[Me,wr(ve),(n,t)=>t.map(i=>zs(i.evaluate(n))).join("")],"resolved-locale":[Me,[Ga],(n,[t])=>t.evaluate(n).resolvedLocale()]});var Ws=Su;function Eu(n){return{result:"success",value:n}}function xo(n){return{result:"error",value:n}}function ir(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function Tu(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function vo(n){return!!n.expression&&n.expression.interpolated}function Re(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function is(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function ku(n){return n}function Xs(n,t){const i="color"===t.type,s=n.stops&&"object"==typeof n.stops[0][0],h=s||!(s||void 0!==n.property),f=n.type||(vo(t)?"exponential":"interval");if(i&&((n=bn({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],We.parse(w[1])])),n.default=We.parse(n.default?n.default:t.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!ae[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,y,b;if("exponential"===f)g=Ur;else if("interval"===f)g=bo;else if("categorical"===f){g=qh,y=Object.create(null);for(const w of n.stops)y[w[0]]=w[1];b=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=ns}if(s){const w={},S=[];for(let O=0;O<n.stops.length;O++){const L=n.stops[O],B=L[0].zoom;void 0===w[B]&&(w[B]={zoom:B,type:n.type,property:n.property,default:n.default,stops:[]},S.push(B)),w[B].stops.push([L[0].value,L[1]])}const T=[];for(const O of S)T.push([w[O].zoom,Xs(w[O],t)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:pi.interpolationFactor.bind(void 0,k),zoomStops:T.map(O=>O[0]),evaluate:({zoom:O},L)=>Ur({stops:T,base:n.base},t,O).evaluate(O,L)}}if(h){const w="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:pi.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(S=>S[0]),evaluate:({zoom:S})=>g(n,t,S,y,b)}}return{kind:"source",evaluate(w,S){const T=S&&S.properties?S.properties[n.property]:void 0;return void 0===T?Js(n.default,t.default):g(n,t,T,y,b)}}}function Js(n,t,i){return void 0!==n?n:void 0!==t?t:void 0!==i?i:void 0}function qh(n,t,i,s,h){return Js(typeof i===h?s[i]:void 0,n.default,t.default)}function bo(n,t,i){if("number"!==Re(i))return Js(n.default,t.default);const s=n.stops.length;if(1===s||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const h=Ka(n.stops.map(f=>f[0]),i);return n.stops[h][1]}function Ur(n,t,i){const s=void 0!==n.base?n.base:1;if("number"!==Re(i))return Js(n.default,t.default);const h=n.stops.length;if(1===h||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[h-1][0])return n.stops[h-1][1];const f=Ka(n.stops.map(S=>S[0]),i),g=function(S,T,k,O){const L=O-k,B=S-k;return 0===L?0:1===T?B/L:(Math.pow(T,B)-1)/(Math.pow(T,L)-1)}(i,s,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],b=n.stops[f+1][1];let w=Ko[t.type]||ku;if(n.colorSpace&&"rgb"!==n.colorSpace){const S=ae[n.colorSpace];w=(T,k)=>S.reverse(S.interpolate(S.forward(T),S.forward(k),g))}return"function"==typeof y.evaluate?{evaluate(...S){const T=y.evaluate.apply(void 0,S),k=b.evaluate.apply(void 0,S);if(void 0!==T&&void 0!==k)return w(T,k,g)}}:w(y,b,g)}function ns(n,t,i){return"color"===t.type?i=We.parse(i):"formatted"===t.type?i=en.fromString(i.toString()):"resolvedImage"===t.type?i=hn.fromString(i.toString()):Re(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Js(i,n.default,t.default)}class ll{constructor(t,i){var s;this.expression=t,this._warningHistory={},this._evaluator=new Xo,this._defaultValue=i?"color"===(s=i).type&&(is(s.default)||Array.isArray(s.default))?new We(0,0,0,0):"color"===s.type?We.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(t,i,s,h,f,g,y,b){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,s,h,f,g,y,b){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(null==w||"number"==typeof w&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Vi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function cl(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in Ws}function rs(n,t){const i=new br(Ws,[],t?function(h){const f={color:Dn,string:Me,number:Wt,enum:Me,boolean:Ee,formatted:Ps,resolvedImage:yr};return"array"===h.type?Bi(f[h.value]||ve,h.length):f[h.type]}(t):void 0),s=i.parse(n,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return s?Eu(new ll(s,t)):xo(i.errors)}class Du{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent="constant"!==t&&!vr(i.expression)}evaluateWithoutErrorHandling(t,i,s,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,s,h,f,g)}evaluate(t,i,s,h,f,g){return this._styleExpression.evaluate(t,i,s,h,f,g)}}class ul{constructor(t,i,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=i,this.isStateDependent="camera"!==t&&!vr(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,s,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,s,h,f,g)}evaluate(t,i,s,h,f,g){return this._styleExpression.evaluate(t,i,s,h,f,g)}interpolationFactor(t,i,s){return this.interpolationType?pi.interpolationFactor(this.interpolationType,t,i,s):0}}function Iu(n,t){if("error"===(n=rs(n,t)).result)return n;const i=n.value.expression,s=mo(i);if(!s&&!ir(t))return xo([new Un("","data expressions not supported")]);const h=js(i,["zoom","pitch","distance-from-center"]);if(!h&&!Tu(t))return xo([new Un("","zoom expressions not supported")]);const f=Qs(i);return f||h?f instanceof Un?xo([f]):f instanceof pi&&!vo(t)?xo([new Un("",'"interpolate" expressions cannot be used with this property')]):Eu(f?new ul(s?"camera":"composite",n.value,f.labels,f instanceof pi?f.interpolation:void 0):new Du(s?"constant":"source",n.value)):xo([new Un("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ks{constructor(t,i){this._parameters=t,this._specification=i,bn(this,Xs(this._parameters,this._specification))}static deserialize(t){return new Ks(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Qs(n){let t=null;if(n instanceof uc)t=Qs(n.result);else if(n instanceof bu){for(const i of n.args)if(t=Qs(i),t)break}else(n instanceof rc||n instanceof pi)&&n.input instanceof Mn&&"zoom"===n.input.name&&(t=n);return t instanceof Un||n.eachChild(i=>{const s=Qs(i);s instanceof Un?t=s:!t&&s?t=new Un("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new Un("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class $t{constructor(t,i,s,h){this.message=(t?`${t}: `:"")+s,h&&(this.identifier=h),null!=i&&i.__line__&&(this.line=i.__line__)}}function ze(n){const t=n.key,i=n.value,s=n.valueSpec||{},h=n.objectElementValidators||{},f=n.style,g=n.styleSpec;let y=[];const b=Re(i);if("object"!==b)return[new $t(t,i,`object expected, ${b} found`)];for(const w in i){const S=w.split(".")[0],T=s[S]||s["*"];let k;h[S]?k=h[S]:s[S]?k=Li:h["*"]?k=h["*"]:s["*"]&&(k=Li),k?y=y.concat(k({key:(t&&`${t}.`)+w,value:i[w],valueSpec:T,style:f,styleSpec:g,object:i,objectKey:w},i)):y.push(new $t(t,i[w],`unknown property "${w}"`))}for(const w in s)h[w]||s[w].required&&void 0===s[w].default&&void 0===i[w]&&y.push(new $t(t,i,`missing required property "${w}"`));return y}function vi(n){const t=n.value,i=n.valueSpec,s=n.style,h=n.styleSpec,f=n.key,g=n.arrayElementValidator||Li;if("array"!==Re(t))return[new $t(f,t,`array expected, ${Re(t)} found`)];if(i.length&&t.length!==i.length)return[new $t(f,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new $t(f,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let y={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};h.$version<7&&(y.function=i.function),"object"===Re(i.value)&&(y=i.value);let b=[];for(let w=0;w<t.length;w++)b=b.concat(g({array:t,arrayIndex:w,value:t[w],valueSpec:y,style:s,styleSpec:h,key:`${f}[${w}]`}));return b}function hl(n){const t=n.key,i=n.value,s=n.valueSpec;let h=Re(i);if("number"===h&&i!=i&&(h="NaN"),"number"!==h)return[new $t(t,i,`number expected, ${h} found`)];if("minimum"in s){let f=s.minimum;if("array"===Re(s.minimum)&&(f=s.minimum[n.arrayIndex]),i<f)return[new $t(t,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===Re(s.maximum)&&(f=s.maximum[n.arrayIndex]),i>f)return[new $t(t,i,`${i} is greater than the maximum value ${f}`)]}return[]}function os(n){const t=n.valueSpec,i=gi(n.value.type);let s,h,f,g={};const y="categorical"!==i&&void 0===n.value.property,b=!y,w="array"===Re(n.value.stops)&&"array"===Re(n.value.stops[0])&&"object"===Re(n.value.stops[0][0]),S=ze({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(O){if("identity"===i)return[new $t(O.key,O.value,'identity function may not have a "stops" property')];let L=[];const B=O.value;return L=L.concat(vi({key:O.key,value:B,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:T})),"array"===Re(B)&&0===B.length&&L.push(new $t(O.key,B,"array must have at least one stop")),L},default:function(O){return Li({key:O.key,value:O.value,valueSpec:t,style:O.style,styleSpec:O.styleSpec})}}});return"identity"===i&&y&&S.push(new $t(n.key,n.value,'missing required property "property"')),"identity"===i||n.value.stops||S.push(new $t(n.key,n.value,'missing required property "stops"')),"exponential"===i&&n.valueSpec.expression&&!vo(n.valueSpec)&&S.push(new $t(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!ir(n.valueSpec)?S.push(new $t(n.key,n.value,"property functions not supported")):y&&!Tu(n.valueSpec)&&S.push(new $t(n.key,n.value,"zoom functions not supported"))),"categorical"!==i&&!w||void 0!==n.value.property||S.push(new $t(n.key,n.value,'"property" property is required')),S;function T(O){let L=[];const B=O.value,N=O.key;if("array"!==Re(B))return[new $t(N,B,`array expected, ${Re(B)} found`)];if(2!==B.length)return[new $t(N,B,`array length 2 expected, length ${B.length} found`)];if(w){if("object"!==Re(B[0]))return[new $t(N,B,`object expected, ${Re(B[0])} found`)];if(void 0===B[0].zoom)return[new $t(N,B,"object stop key must have zoom")];if(void 0===B[0].value)return[new $t(N,B,"object stop key must have value")];const X=gi(B[0].zoom);if("number"!=typeof X)return[new $t(N,B[0].zoom,"stop zoom values must be numbers")];if(f&&f>X)return[new $t(N,B[0].zoom,"stop zoom values must appear in ascending order")];X!==f&&(f=X,h=void 0,g={}),L=L.concat(ze({key:`${N}[0]`,value:B[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:hl,value:k}}))}else L=L.concat(k({key:`${N}[0]`,value:B[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},B));return cl(Vr(B[1]))?L.concat([new $t(`${N}[1]`,B[1],"expressions are not allowed in function stops.")]):L.concat(Li({key:`${N}[1]`,value:B[1],valueSpec:t,style:O.style,styleSpec:O.styleSpec}))}function k(O,L){const B=Re(O.value),N=gi(O.value),X=null!==O.value?O.value:L;if(s){if(B!==s)return[new $t(O.key,X,`${B} stop domain type must match previous stop domain type ${s}`)]}else s=B;if("number"!==B&&"string"!==B&&"boolean"!==B&&"number"!=typeof N&&"string"!=typeof N&&"boolean"!=typeof N)return[new $t(O.key,X,"stop domain value must be a number, string, or boolean")];if("number"!==B&&"categorical"!==i){let it=`number expected, ${B} found`;return ir(t)&&void 0===i&&(it+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $t(O.key,X,it)]}return"categorical"!==i||"number"!==B||"number"==typeof N&&isFinite(N)&&Math.floor(N)===N?"categorical"!==i&&"number"===B&&"number"==typeof N&&"number"==typeof h&&void 0!==h&&N<h?[new $t(O.key,X,"stop domain values must appear in ascending order")]:(h=N,"categorical"===i&&N in g?[new $t(O.key,X,"stop domain values must be unique")]:(g[N]=!0,[])):[new $t(O.key,X,`integer expected, found ${String(N)}`)]}}function je(n){const t=("property"===n.expressionContext?Iu:rs)(Vr(n.value),n.valueSpec);if("error"===t.result)return t.value.map(s=>new $t(`${n.key}${s.key}`,n.value,s.message));const i=t.value.expression||t.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!i.outputDefined())return[new $t(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!vr(i))return[new $t(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return dl(i,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!js(i,["zoom","feature-state"]))return[new $t(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!mo(i))return[new $t(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dl(n,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const h of t.valueSpec.expression.parameters)i.delete(h);if(0===i.size)return[];const s=[];return n instanceof Mn&&i.has(n.name)?[new $t(t.key,t.value,`["${n.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(n.eachChild(h=>{s.push(...dl(h,t))}),s)}function me(n){const t=n.key,i=n.value,s=n.valueSpec,h=[];return Array.isArray(s.values)?-1===s.values.indexOf(gi(i))&&h.push(new $t(t,i,`expected one of [${s.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(s.values).indexOf(gi(i))&&h.push(new $t(t,i,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function Oi(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Oi(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ta(n,t="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Oi(n)||(n=pl(n));const i=n;let s=!0;try{s=function(w){if(!Gi(w))return w;let S=Vr(w);return Ci(S),S=ea(S),S}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const h=Ct[`filter_${t}`],f=rs(s,h);let g=null;if("error"===f.result)throw new Error(f.value.map(w=>`${w.key}: ${w.message}`).join(", "));g=(w,S,T)=>f.value.evaluate(w,S,{},T);let y=null,b=null;if(s!==i){const w=rs(i,h);if("error"===w.result)throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,T,k,O,L)=>w.value.evaluate(S,T,{},k,void 0,void 0,O,L),b=!mo(w.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:De(s),needFeature:!!b}}function ea(n){if(!Array.isArray(n))return n;const t=function(i){if(Yd.has(i[0]))for(let s=1;s<i.length;s++)if(Gi(i[s]))return!0;return i}(n);return!0===t?t:t.map(i=>ea(i))}function Ci(n){let t=!1;const i=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)t=t||Gi(n[s]),i.push(n[s+1]);i.push(n[n.length-1])}else if("match"===n[0]){t=t||Gi(n[1]);for(let s=2;s<n.length-1;s+=2)i.push(n[s+1]);i.push(n[n.length-1])}else if("step"===n[0]){t=t||Gi(n[1]);for(let s=1;s<n.length-1;s+=2)i.push(n[s+1])}t&&(n.length=0,n.push("any",...i));for(let s=1;s<n.length;s++)Ci(n[s])}function Gi(n){if(!Array.isArray(n))return!1;if("pitch"===(t=n[0])||"distance-from-center"===t)return!0;var t;for(let i=1;i<n.length;i++)if(Gi(n[i]))return!0;return!1}const Yd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ss(n,t){return n<t?-1:n>t?1:0}function De(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let t=1;t<n.length;t++)if(De(n[t]))return!0;return!1}function pl(n){if(!n)return!0;const t=n[0];return n.length<=1?"any"!==t:"=="===t?xc(n[1],n[2],"=="):"!="===t?Hi(xc(n[1],n[2],"==")):"<"===t||">"===t||"<="===t||">="===t?xc(n[1],n[2],t):"any"===t?(i=n.slice(1),["any"].concat(i.map(pl))):"all"===t?["all"].concat(n.slice(1).map(pl)):"none"===t?["all"].concat(n.slice(1).map(pl).map(Hi)):"in"===t?jr(n[1],n.slice(2)):"!in"===t?Hi(jr(n[1],n.slice(2))):"has"===t?ia(n[1]):"!has"===t?Hi(ia(n[1])):"within"!==t||n;var i}function xc(n,t,i){switch(n){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,n,t]}}function jr(n,t){if(0===t.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",n,["literal",t.sort(ss)]]:["filter-in-small",n,["literal",t]]}}function ia(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Hi(n){return["!",n]}function as(n){return Oi(Vr(n.value))?je(bn({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Fu(n)}function Fu(n){const t=n.value,i=n.key;if("array"!==Re(t))return[new $t(i,t,`array expected, ${Re(t)} found`)];const s=n.styleSpec;let h,f=[];if(t.length<1)return[new $t(i,t,"filter array must have at least 1 element")];switch(f=f.concat(me({key:`${i}[0]`,value:t[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),gi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===gi(t[1])&&f.push(new $t(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&f.push(new $t(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Re(t[1]),"string"!==h&&f.push(new $t(`${i}[1]`,t[1],`string expected, ${h} found`)));for(let g=2;g<t.length;g++)h=Re(t[g]),"$type"===gi(t[1])?f=f.concat(me({key:`${i}[${g}]`,value:t[g],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&f.push(new $t(`${i}[${g}]`,t[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)f=f.concat(Fu({key:`${i}[${g}]`,value:t[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=Re(t[1]),2!==t.length?f.push(new $t(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==h&&f.push(new $t(`${i}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=Re(t[1]),2!==t.length?f.push(new $t(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==h&&f.push(new $t(`${i}[1]`,t[1],`object expected, ${h} found`))}return f}function Zh(n,t){const i=n.key,s=n.style,h=n.styleSpec,f=n.value,g=n.objectKey,y=h[`${t}_${n.layerType}`];if(!y)return[];const b=g.match(/^(.*)-transition$/);if("paint"===t&&b&&y[b[1]]&&y[b[1]].transition)return Li({key:i,value:f,valueSpec:h.transition,style:s,styleSpec:h});const w=n.valueSpec||y[g];if(!w)return[new $t(i,f,`unknown property "${g}"`)];let S;if("string"===Re(f)&&ir(w)&&!w.tokens&&(S=/^{([^}]+)}$/.exec(f)))return[new $t(i,f,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const T=[];return"symbol"===n.layerType&&("text-field"===g&&s&&!s.glyphs&&T.push(new $t(i,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&is(Vr(f))&&"identity"===gi(f.type)&&T.push(new $t(i,f,'"text-font" does not support identity functions'))),T.concat(Li({key:n.key,value:f,valueSpec:w,style:s,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:g}))}function Ou(n){return Zh(n,"paint")}function Lu(n){return Zh(n,"layout")}function fl(n){let t=[];const i=n.value,s=n.key,h=n.style,f=n.styleSpec;i.type||i.ref||t.push(new $t(s,i,'either "type" or "ref" is required'));let g=gi(i.type);const y=gi(i.ref);if(i.id){const b=gi(i.id);for(let w=0;w<n.arrayIndex;w++){const S=h.layers[w];gi(S.id)===b&&t.push(new $t(s,i.id,`duplicate layer id "${i.id}", previously used at line ${S.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in i&&t.push(new $t(s,i[w],`"${w}" is prohibited for ref layers`))}),h.layers.forEach(w=>{gi(w.id)===y&&(b=w)}),b?b.ref?t.push(new $t(s,i.ref,"ref cannot reference another ref layer")):g=gi(b.type):"string"==typeof y&&t.push(new $t(s,i.ref,`ref layer "${y}" not found`))}else if("background"!==g&&"sky"!==g)if(i.source){const b=h.sources&&h.sources[i.source],w=b&&gi(b.type);b?"vector"===w&&"raster"===g?t.push(new $t(s,i.source,`layer "${i.id}" requires a raster source`)):"raster"===w&&"raster"!==g?t.push(new $t(s,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==w||i["source-layer"]?"raster-dem"===w&&"hillshade"!==g?t.push(new $t(s,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===w&&b.lineMetrics||t.push(new $t(s,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new $t(s,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new $t(s,i.source,`source "${i.source}" not found`))}else t.push(new $t(s,i,'missing required property "source"'));return t=t.concat(ze({key:s,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Li({key:`${s}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:b=>as(bn({layerType:g},b)),layout:b=>ze({layer:i,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Lu(bn({layerType:g},w))}}),paint:b=>ze({layer:i,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Ou(bn({layerType:g},w))}})}})),t}function na(n){const t=n.value,i=n.key,s=Re(t);return"string"!==s?[new $t(i,t,`string expected, ${s} found`)]:[]}const wo={promoteId:function({key:n,value:t}){if("string"===Re(t))return na({key:n,value:t});{const i=[];for(const s in t)i.push(...na({key:`${n}.${s}`,value:t[s]}));return i}}};function Pu(n){const t=n.value,i=n.key,s=n.styleSpec,h=n.style;if(!t.type)return[new $t(i,t,'"type" is required')];const f=gi(t.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=ze({key:i,value:t,valueSpec:s[`source_${f.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:wo}),g;case"geojson":if(g=ze({key:i,value:t,valueSpec:s.source_geojson,style:h,styleSpec:s,objectElementValidators:wo}),t.cluster)for(const y in t.clusterProperties){const[b,w]=t.clusterProperties[y],S="string"==typeof b?[b,["accumulated"],["get",y]]:b;g.push(...je({key:`${i}.${y}.map`,value:w,expressionContext:"cluster-map"})),g.push(...je({key:`${i}.${y}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return g;case"video":return ze({key:i,value:t,valueSpec:s.source_video,style:h,styleSpec:s});case"image":return ze({key:i,value:t,valueSpec:s.source_image,style:h,styleSpec:s});case"canvas":return[new $t(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return me({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:s})}}function Ru(n){const t=n.value,i=n.styleSpec,s=i.light,h=n.style;let f=[];const g=Re(t);if(void 0===t)return f;if("object"!==g)return f=f.concat([new $t("light",t,`object expected, ${g} found`)]),f;for(const y in t){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&s[b[1]]&&s[b[1]].transition?Li({key:y,value:t[y],valueSpec:i.transition,style:h,styleSpec:i}):s[y]?Li({key:y,value:t[y],valueSpec:s[y],style:h,styleSpec:i}):[new $t(y,t[y],`unknown property "${y}"`)])}return f}function ls(n){const t=n.value,i=n.key,s=n.style,h=n.styleSpec,f=h.terrain;let g=[];const y=Re(t);if(void 0===t)return g;if("object"!==y)return g=g.concat([new $t("terrain",t,`object expected, ${y} found`)]),g;for(const b in t){const w=b.match(/^(.*)-transition$/);g=g.concat(w&&f[w[1]]&&f[w[1]].transition?Li({key:b,value:t[b],valueSpec:h.transition,style:s,styleSpec:h}):f[b]?Li({key:b,value:t[b],valueSpec:f[b],style:s,styleSpec:h}):[new $t(b,t[b],`unknown property "${b}"`)])}if(t.source){const b=s.sources&&s.sources[t.source],w=b&&gi(b.type);b?"raster-dem"!==w&&g.push(new $t(i,t.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):g.push(new $t(i,t.source,`source "${t.source}" not found`))}else g.push(new $t(i,t,'terrain is missing required property "source"'));return g}function zu(n){const t=n.value,i=n.style,s=n.styleSpec,h=s.fog;let f=[];const g=Re(t);if(void 0===t)return f;if("object"!==g)return f=f.concat([new $t("fog",t,`object expected, ${g} found`)]),f;for(const y in t){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&h[b[1]]&&h[b[1]].transition?Li({key:y,value:t[y],valueSpec:s.transition,style:i,styleSpec:s}):h[y]?Li({key:y,value:t[y],valueSpec:h[y],style:i,styleSpec:s}):[new $t(y,t[y],`unknown property "${y}"`)])}return f}const Bu={"*":()=>[],array:vi,boolean:function(n){const t=n.value,i=n.key,s=Re(t);return"boolean"!==s?[new $t(i,t,`boolean expected, ${s} found`)]:[]},number:hl,color:function(n){const t=n.key,i=n.value,s=Re(i);return"string"!==s?[new $t(t,i,`color expected, ${s} found`)]:null===uo.parseCSSColor(i)?[new $t(t,i,`color expected, "${i}" found`)]:[]},enum:me,filter:as,function:os,layer:fl,object:ze,source:Pu,light:Ru,terrain:ls,fog:zu,string:na,formatted:function(n){return 0===na(n).length?[]:je(n)},resolvedImage:function(n){return 0===na(n).length?[]:je(n)},projection:function(n){const t=n.value,i=n.styleSpec,s=i.projection,h=n.style;let f=[];const g=Re(t);if("object"===g)for(const y in t)f=f.concat(Li({key:y,value:t[y],valueSpec:s[y],style:h,styleSpec:i}));else"string"!==g&&(f=f.concat([new $t("projection",t,`object or string expected, ${g} found`)]));return f}};function Li(n){const t=n.value,i=n.valueSpec,s=n.styleSpec;return i.expression&&is(gi(t))?os(n):i.expression&&cl(Vr(t))?je(n):i.type&&Bu[i.type]?Bu[i.type](n):ze(bn({},n,{valueSpec:i.type?s[i.type]:i}))}function $h(n){const t=n.value,i=n.key,s=na(n);return s.length||(-1===t.indexOf("{fontstack}")&&s.push(new $t(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&s.push(new $t(i,t,'"glyphs" url must include a "{range}" token'))),s}function ra(n,t=Ct){return nr(Li({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,objectElementValidators:{glyphs:$h,"*":()=>[]}}))}const ml=n=>nr(Ou(n)),Vu=n=>nr(Lu(n));function nr(n){return n.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function gl(n,t){let i=!1;if(t&&t.length)for(const s of t)n.fire(new Ne(new Error(s.message))),i=!0;return i}var Co=Fn;function Fn(n,t,i){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var h=new Int32Array(this.arrayBuffer);n=h[0],this.d=(t=h[1])+2*(i=h[2]);for(var f=0;f<this.d*this.d;f++){var g=h[3+f],y=h[3+f+1];s.push(g===y?null:h.subarray(g,y))}var b=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=n,this.padding=i,this.scale=t/n,this.uid=0;var S=i/t*n;this.min=-S,this.max=n+S}Fn.prototype.insert=function(n,t,i,s,h){this._forEachCell(t,i,s,h,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(h)},Fn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fn.prototype._insertCell=function(n,t,i,s,h,f){this.cells[h].push(f)},Fn.prototype.query=function(n,t,i,s,h){var f=this.min,g=this.max;if(n<=f&&t<=f&&g<=i&&g<=s&&!h)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,t,i,s,this._queryCell,y,{},h),y},Fn.prototype._queryCell=function(n,t,i,s,h,f,g,y){var b=this.cells[h];if(null!==b)for(var w=this.keys,S=this.bboxes,T=0;T<b.length;T++){var k=b[T];if(void 0===g[k]){var O=4*k;(y?y(S[O+0],S[O+1],S[O+2],S[O+3]):n<=S[O+2]&&t<=S[O+3]&&i>=S[O+0]&&s>=S[O+1])?(g[k]=!0,f.push(w[k])):g[k]=!1}}},Fn.prototype._forEachCell=function(n,t,i,s,h,f,g,y){for(var b=this._convertToCellCoord(n),w=this._convertToCellCoord(t),S=this._convertToCellCoord(i),T=this._convertToCellCoord(s),k=b;k<=S;k++)for(var O=w;O<=T;O++){var L=this.d*O+k;if((!y||y(this._convertFromCellCoord(k),this._convertFromCellCoord(O),this._convertFromCellCoord(k+1),this._convertFromCellCoord(O+1)))&&h.call(this,n,t,i,s,L,f,g,y))return}},Fn.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Fn.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Fn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,t=3+this.cells.length+1+1,i=0,s=0;s<this.cells.length;s++)i+=this.cells[s].length;var h=new Int32Array(t+i+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=t,g=0;g<n.length;g++){var y=n[g];h[3+g]=f,h.set(y,f),f+=y.length}return h[3+n.length]=f,h.set(this.keys,f),h[3+n.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};const _l={};function Jt(n,t,i={}){Object.defineProperty(n,"_classRegistryKey",{value:t,writeable:!1}),_l[t]={klass:n,omit:i.omit||[]}}Jt(Object,"Object"),Co.serialize=function(n,t){const i=n.toArrayBuffer();return t&&t.push(i),{buffer:i}},Co.deserialize=function(n){return new Co(n.buffer)},Object.defineProperty(Co,"name",{value:"Grid"}),Jt(Co,"Grid"),Jt(We,"Color"),Jt(Error,"Error"),Jt(ft,"AJAXError"),Jt(hn,"ResolvedImage"),Jt(Ks,"StylePropertyFunction"),Jt(ll,"StyleExpression",{omit:["_evaluator"]}),Jt(ul,"ZoomDependentExpression"),Jt(Du,"ZoomConstantExpression"),Jt(Mn,"CompoundExpression",{omit:["_evaluate"]});for(const n in Ws)_l[Ws[n]._classRegistryKey]||Jt(Ws[n],`Expression${n}`);function vc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function bc(n){return zt.ImageBitmap&&n instanceof zt.ImageBitmap}function oa(n,t){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(vc(n)||bc(n))return t&&t.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return t&&t.push(i.buffer),i}if(n instanceof zt.ImageData)return t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const s of n)i.push(oa(s,t));return i}if("object"==typeof n){const i=n.constructor,s=i._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const h=i.serialize?i.serialize(n,t):{};if(!i.serialize){for(const f in n)n.hasOwnProperty(f)&&(_l[s].omit.indexOf(f)>=0||(h[f]=oa(n[f],t)));n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof n)}function cs(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||vc(n)||bc(n)||ArrayBuffer.isView(n)||n instanceof zt.ImageData)return n;if(Array.isArray(n))return n.map(cs);if("object"==typeof n){const t=n.$name||"Object",{klass:i}=_l[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const h of Object.keys(n))"$name"!==h&&(s[h]=cs(n[h]));return s}throw new Error("can't deserialize object of type "+typeof n)}class wc{constructor(){this.first=!0}update(t,i){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const Gu=n=>n>=1536&&n<=1791,pn=n=>n>=1872&&n<=1919,Yh=n=>n>=2208&&n<=2303,Mo=n=>n>=11904&&n<=12031,yl=n=>n>=12032&&n<=12255,Hr=n=>n>=12272&&n<=12287,xl=n=>n>=12288&&n<=12351,vl=n=>n>=12352&&n<=12447,qn=n=>n>=12448&&n<=12543,Nu=n=>n>=12544&&n<=12591,Cc=n=>n>=12704&&n<=12735,Uu=n=>n>=12736&&n<=12783,Mc=n=>n>=12784&&n<=12799,ju=n=>n>=12800&&n<=13055,Ac=n=>n>=13056&&n<=13311,Ao=n=>n>=13312&&n<=19903,sa=n=>n>=19968&&n<=40959,aa=n=>n>=40960&&n<=42127,Hu=n=>n>=42128&&n<=42191,qu=n=>n>=44032&&n<=55215,Wh=n=>n>=63744&&n<=64255,la=n=>n>=64336&&n<=65023,Sc=n=>n>=65040&&n<=65055,Ec=n=>n>=65072&&n<=65103,Zu=n=>n>=65104&&n<=65135,Tc=n=>n>=65136&&n<=65279,kc=n=>n>=65280&&n<=65519;function So(n){for(const t of n)if(ca(t.charCodeAt(0)))return!0;return!1}function Xh(n){for(const t of n)if(!Jh(t.charCodeAt(0)))return!1;return!0}function Jh(n){return!(Gu(n)||pn(n)||Yh(n)||la(n)||Tc(n))}function ca(n){return!(746!==n&&747!==n&&(n<4352||!(Cc(n)||Nu(n)||Ec(n)&&!(n>=65097&&n<=65103)||Wh(n)||Ac(n)||Mo(n)||Uu(n)||!(!xl(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||Ao(n)||sa(n)||ju(n)||(t=n,t>=12592&&t<=12687)||(t=>t>=43360&&t<=43391)(n)||(t=>t>=55216&&t<=55295)(n)||(t=>t>=4352&&t<=4607)(n)||qu(n)||vl(n)||Hr(n)||(t=>t>=12688&&t<=12703)(n)||yl(n)||Mc(n)||qn(n)&&12540!==n||!(!kc(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!Zu(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(t=>t>=5120&&t<=5759)(n)||(t=>t>=6320&&t<=6399)(n)||Sc(n)||(t=>t>=19904&&t<=19967)(n)||aa(n)||Hu(n))));var t}function ua(n){return!(ca(n)||(t=n,(i=t)>=128&&i<=255&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(i=>i>=8192&&i<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(i=>i>=8448&&i<=8527)(t)||(i=>i>=8528&&i<=8591)(t)||(i=>i>=8960&&i<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(i=>i>=9216&&i<=9279)(t)&&9251!==t||(i=>i>=9280&&i<=9311)(t)||(i=>i>=9312&&i<=9471)(t)||(i=>i>=9632&&i<=9727)(t)||(i=>i>=9728&&i<=9983)(t)&&!(t>=9754&&t<=9759)||(i=>i>=11008&&i<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||xl(t)||qn(t)||(i=>i>=57344&&i<=63743)(t)||Ec(t)||Zu(t)||kc(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t,i}function p(n){return n>=1424&&n<=2303||la(n)||Tc(n)}function r(n,t){return!(!t&&p(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=n,i>=6016&&i<=6143));var i}function u(n){for(const t of n)if(p(t.charCodeAt(0)))return!0;return!1}const m="deferred",x="loading",v="loaded";let M=null,A="unavailable",E=null;const D=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(A="error"),M&&M(n)};function I(){R.fire(new Ye("pluginStateChange",{pluginStatus:A,pluginURL:E}))}const R=new ie,V=function(){return A},Z=function(){if(A!==m||!E)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");A=x,I(),E&&gt({url:E},n=>{n?D(n):(A=v,I())})},j={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>A===v||null!=j.applyArabicShaping,isLoading:()=>A===x,setState(n){A=n.pluginStatus,E=n.pluginURL},isParsed:()=>null!=j.applyArabicShaping&&null!=j.processBidirectionalText&&null!=j.processStyledBidirectionalText,getPluginURL:()=>E};class H{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wc,this.transition={},this.pitch=0)}isSupportedScript(t){return function(i,s){for(const h of i)if(!r(h.charCodeAt(0),s))return!1;return!0}(t,j.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*i}}}class q{constructor(t,i){this.property=t,this.value=i,this.expression=function(s,h){if(is(s))return new Ks(s,h);if(cl(s)){const f=Iu(s,h);if("error"===f.result)throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===h.type&&(f=We.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===i?t.specification.default:i,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,i,s){return this.property.possiblyEvaluate(this,t,i,s)}}class U{constructor(t){this.property=t,this.value=new q(t,void 0)}transitioned(t,i){return new $(this.property,this.value,i,Ve({},t.transition,this.transition),t.now)}untransitioned(){return new $(this.property,this.value,null,{},0)}}class J{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return gn(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new U(this._values[t].property)),this._values[t].value=new q(this._values[t].property,null===i?void 0:gn(i))}getTransition(t){return gn(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new U(this._values[t].property)),this._values[t].transition=gn(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(t[i]=s);const h=this.getTransition(i);void 0!==h&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const s=new lt(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(t,i._values[h]);return s}untransitioned(){const t=new lt(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class ${constructor(t,i,s,h,f){const g=h.delay||0,y=h.duration||0;f=f||0,this.property=t,this.value=i,this.begin=f+g,this.end=this.begin+y,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(t,i,s){const h=t.now||0,f=this.value.possiblyEvaluate(t,i,s),g=this.prior;if(g){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return g.possiblyEvaluate(t,i,s);{const y=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,i,s),f,Go(y))}}return f}}class lt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,s){const h=new at(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,i,s);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class st{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return gn(this._values[t].value)}setValue(t,i){this._values[t]=new q(this._values[t].property,null===i?void 0:gn(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const s=this.getValue(i);void 0!==s&&(t[i]=s)}return t}possiblyEvaluate(t,i,s){const h=new at(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,i,s);return h}}class et{constructor(t,i,s){this.property=t,this.value=i,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,i,s,h){return this.property.evaluate(this.value,this.parameters,t,i,s,h)}}class at{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class rt{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,s){const h=Ko[this.specification.type];return h?h(t,i,s):t}}class dt{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,s,h){return new et(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(i,null,{},s,h)}:t.expression,i)}interpolate(t,i,s){if("constant"!==t.value.kind||"constant"!==i.value.kind)return t;if(void 0===t.value.value||void 0===i.value.value)return new et(this,{kind:"constant",value:void 0},t.parameters);const h=Ko[this.specification.type];return h?new et(this,{kind:"constant",value:h(t.value.value,i.value.value,s)},t.parameters):t}evaluate(t,i,s,h,f,g){return"constant"===t.kind?t.value:t.evaluate(i,s,h,f,g)}}class _t extends dt{possiblyEvaluate(t,i,s,h){if(void 0===t.value)return new et(this,{kind:"constant",value:void 0},i);if("constant"===t.expression.kind){const f=t.expression.evaluate(i,null,{},s,h),g="resolvedImage"===t.property.specification.type&&"string"!=typeof f?f.name:f,y=this._calculate(g,g,g,i);return new et(this,{kind:"constant",value:y},i)}if("camera"===t.expression.kind){const f=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new et(this,{kind:"constant",value:f},i)}return new et(this,t.expression,i)}evaluate(t,i,s,h,f,g){if("source"===t.kind){const y=t.evaluate(i,s,h,f,g);return this._calculate(y,y,y,i)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},s,h),t.evaluate({zoom:Math.floor(i.zoom)},s,h),t.evaluate({zoom:Math.floor(i.zoom)+1},s,h),i):t.value}_calculate(t,i,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i,other:s}:{from:s,to:i,other:t}}interpolate(t){return t}}class Lt{constructor(t){this.specification=t}possiblyEvaluate(t,i,s,h){if(void 0!==t.value){if("constant"===t.expression.kind){const f=t.expression.evaluate(i,null,{},s,h);return this._calculate(f,f,f,i)}return this._calculate(t.expression.evaluate(new H(Math.floor(i.zoom-1),i)),t.expression.evaluate(new H(Math.floor(i.zoom),i)),t.expression.evaluate(new H(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:s,to:i}}interpolate(t){return t}}class mt{constructor(t){this.specification=t}possiblyEvaluate(t,i,s,h){return!!t.expression.evaluate(i,null,{},s,h)}interpolate(){return!1}}class At{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new H(0,{});for(const s in t){const h=t[s];h.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new q(h,void 0),g=this.defaultTransitionablePropertyValues[s]=new U(h);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(i)}}}function kt(n,t){return 256*(n=ye(Math.floor(n),0,255))+ye(Math.floor(t),0,255)}Jt(dt,"DataDrivenProperty"),Jt(rt,"DataConstantProperty"),Jt(_t,"CrossFadedDataDrivenProperty"),Jt(Lt,"CrossFadedProperty"),Jt(mt,"ColorRampProperty");const Gt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wt{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Tt(n,t=1){let i=0,s=0;return{members:n.map(h=>{const f=Gt[h.type].BYTES_PER_ELEMENT,g=i=qt(i,Math.max(t,f)),y=h.components||1;return s=Math.max(s,f),i+=f*y,{name:h.name,type:h.type,components:y,offset:g}}),size:qt(i,Math.max(s,t)),alignment:t}}function qt(n,t){return Math.ceil(n/t)*t}class Ut extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=s,t}}Ut.prototype.bytesPerElement=4,Jt(Ut,"StructArrayLayout2i4");class Qt extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,s)}emplace(t,i,s,h){const f=3*t;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=h,t}}Qt.prototype.bytesPerElement=6,Jt(Qt,"StructArrayLayout3i6");class ne extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,h)}emplace(t,i,s,h,f){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=h,this.int16[g+3]=f,t}}ne.prototype.bytesPerElement=8,Jt(ne,"StructArrayLayout4i8");class le extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,s,h,f,g,y)}emplace(t,i,s,h,f,g,y,b){const w=6*t,S=12*t,T=3*t;return this.int16[w+0]=i,this.int16[w+1]=s,this.uint8[S+4]=h,this.uint8[S+5]=f,this.uint8[S+6]=g,this.uint8[S+7]=y,this.float32[T+2]=b,t}}le.prototype.bytesPerElement=12,Jt(le,"StructArrayLayout2i4ub1f12");class Te extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,h)}emplace(t,i,s,h,f){const g=4*t;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=h,this.float32[g+3]=f,t}}Te.prototype.bytesPerElement=16,Jt(Te,"StructArrayLayout4f16");class Kt extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g,y,b,w,S){const T=this.length;return this.resize(T+1),this.emplace(T,t,i,s,h,f,g,y,b,w,S)}emplace(t,i,s,h,f,g,y,b,w,S,T){const k=10*t;return this.uint16[k+0]=i,this.uint16[k+1]=s,this.uint16[k+2]=h,this.uint16[k+3]=f,this.uint16[k+4]=g,this.uint16[k+5]=y,this.uint16[k+6]=b,this.uint16[k+7]=w,this.uint16[k+8]=S,this.uint16[k+9]=T,t}}Kt.prototype.bytesPerElement=20,Jt(Kt,"StructArrayLayout10ui20");class fe extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g,y,b){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,s,h,f,g,y,b)}emplace(t,i,s,h,f,g,y,b,w){const S=8*t;return this.uint16[S+0]=i,this.uint16[S+1]=s,this.uint16[S+2]=h,this.uint16[S+3]=f,this.uint16[S+4]=g,this.uint16[S+5]=y,this.uint16[S+6]=b,this.uint16[S+7]=w,t}}fe.prototype.bytesPerElement=16,Jt(fe,"StructArrayLayout8ui16");class Be extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,s,h,f,g)}emplace(t,i,s,h,f,g,y){const b=6*t;return this.int16[b+0]=i,this.int16[b+1]=s,this.int16[b+2]=h,this.int16[b+3]=f,this.int16[b+4]=g,this.int16[b+5]=y,t}}Be.prototype.bytesPerElement=12,Jt(Be,"StructArrayLayout6i12");class ai extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g,y,b,w,S,T,k){const O=this.length;return this.resize(O+1),this.emplace(O,t,i,s,h,f,g,y,b,w,S,T,k)}emplace(t,i,s,h,f,g,y,b,w,S,T,k,O){const L=12*t;return this.int16[L+0]=i,this.int16[L+1]=s,this.int16[L+2]=h,this.int16[L+3]=f,this.uint16[L+4]=g,this.uint16[L+5]=y,this.uint16[L+6]=b,this.uint16[L+7]=w,this.int16[L+8]=S,this.int16[L+9]=T,this.int16[L+10]=k,this.int16[L+11]=O,t}}ai.prototype.bytesPerElement=24,Jt(ai,"StructArrayLayout4i4ui4i24");class xi extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,s,h,f,g)}emplace(t,i,s,h,f,g,y){const b=10*t,w=5*t;return this.int16[b+0]=i,this.int16[b+1]=s,this.int16[b+2]=h,this.float32[w+2]=f,this.float32[w+3]=g,this.float32[w+4]=y,t}}xi.prototype.bytesPerElement=20,Jt(xi,"StructArrayLayout3i3f20");class Ze extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Ze.prototype.bytesPerElement=4,Jt(Ze,"StructArrayLayout1ul4");class Ni extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g,y,b,w,S,T,k,O){const L=this.length;return this.resize(L+1),this.emplace(L,t,i,s,h,f,g,y,b,w,S,T,k,O)}emplace(t,i,s,h,f,g,y,b,w,S,T,k,O,L){const B=20*t,N=10*t;return this.int16[B+0]=i,this.int16[B+1]=s,this.int16[B+2]=h,this.int16[B+3]=f,this.int16[B+4]=g,this.float32[N+3]=y,this.float32[N+4]=b,this.float32[N+5]=w,this.float32[N+6]=S,this.int16[B+14]=T,this.uint32[N+8]=k,this.uint16[B+18]=O,this.uint16[B+19]=L,t}}Ni.prototype.bytesPerElement=40,Jt(Ni,"StructArrayLayout5i4f1i1ul2ui40");class rr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,s,h,f,g,y)}emplace(t,i,s,h,f,g,y,b){const w=8*t;return this.int16[w+0]=i,this.int16[w+1]=s,this.int16[w+2]=h,this.int16[w+4]=f,this.int16[w+5]=g,this.int16[w+6]=y,this.int16[w+7]=b,t}}rr.prototype.bytesPerElement=16,Jt(rr,"StructArrayLayout3i2i2i16");class or extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,s,h,f)}emplace(t,i,s,h,f,g){const y=4*t,b=8*t;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=h,this.int16[b+6]=f,this.int16[b+7]=g,t}}or.prototype.bytesPerElement=16,Jt(or,"StructArrayLayout2f1f2i16");class ii extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,h)}emplace(t,i,s,h,f){const g=12*t,y=3*t;return this.uint8[g+0]=i,this.uint8[g+1]=s,this.float32[y+1]=h,this.float32[y+2]=f,t}}ii.prototype.bytesPerElement=12,Jt(ii,"StructArrayLayout2ub2f12");class fi extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,s)}emplace(t,i,s,h){const f=3*t;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=h,t}}fi.prototype.bytesPerElement=12,Jt(fi,"StructArrayLayout3f12");class Ae extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,s)}emplace(t,i,s,h){const f=3*t;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=h,t}}Ae.prototype.bytesPerElement=6,Jt(Ae,"StructArrayLayout3ui6");class Ei extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g,y,b,w,S,T,k,O,L,B,N,X,it,K,tt,ct){const nt=this.length;return this.resize(nt+1),this.emplace(nt,t,i,s,h,f,g,y,b,w,S,T,k,O,L,B,N,X,it,K,tt,ct)}emplace(t,i,s,h,f,g,y,b,w,S,T,k,O,L,B,N,X,it,K,tt,ct,nt){const vt=30*t,xt=15*t,Mt=60*t;return this.int16[vt+0]=i,this.int16[vt+1]=s,this.int16[vt+2]=h,this.float32[xt+2]=f,this.float32[xt+3]=g,this.uint16[vt+8]=y,this.uint16[vt+9]=b,this.uint32[xt+5]=w,this.uint32[xt+6]=S,this.uint32[xt+7]=T,this.uint16[vt+16]=k,this.uint16[vt+17]=O,this.uint16[vt+18]=L,this.float32[xt+10]=B,this.float32[xt+11]=N,this.uint8[Mt+48]=X,this.uint8[Mt+49]=it,this.uint8[Mt+50]=K,this.uint32[xt+13]=tt,this.int16[vt+28]=ct,this.uint8[Mt+58]=nt,t}}Ei.prototype.bytesPerElement=60,Jt(Ei,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class qi extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f,g,y,b,w,S,T,k,O,L,B,N,X,it,K,tt,ct,nt,vt,xt,Mt,Bt,bt,St,It,Et){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,t,i,s,h,f,g,y,b,w,S,T,k,O,L,B,N,X,it,K,tt,ct,nt,vt,xt,Mt,Bt,bt,St,It,Et)}emplace(t,i,s,h,f,g,y,b,w,S,T,k,O,L,B,N,X,it,K,tt,ct,nt,vt,xt,Mt,Bt,bt,St,It,Et,Pt){const Ft=38*t,Zt=19*t;return this.int16[Ft+0]=i,this.int16[Ft+1]=s,this.int16[Ft+2]=h,this.float32[Zt+2]=f,this.float32[Zt+3]=g,this.int16[Ft+8]=y,this.int16[Ft+9]=b,this.int16[Ft+10]=w,this.int16[Ft+11]=S,this.int16[Ft+12]=T,this.int16[Ft+13]=k,this.uint16[Ft+14]=O,this.uint16[Ft+15]=L,this.uint16[Ft+16]=B,this.uint16[Ft+17]=N,this.uint16[Ft+18]=X,this.uint16[Ft+19]=it,this.uint16[Ft+20]=K,this.uint16[Ft+21]=tt,this.uint16[Ft+22]=ct,this.uint16[Ft+23]=nt,this.uint16[Ft+24]=vt,this.uint16[Ft+25]=xt,this.uint16[Ft+26]=Mt,this.uint16[Ft+27]=Bt,this.uint16[Ft+28]=bt,this.uint32[Zt+15]=St,this.float32[Zt+16]=It,this.float32[Zt+17]=Et,this.float32[Zt+18]=Pt,t}}qi.prototype.bytesPerElement=76,Jt(qi,"StructArrayLayout3i2f6i15ui1ul3f76");class Qe extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Qe.prototype.bytesPerElement=4,Jt(Qe,"StructArrayLayout1f4");class nn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,s,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,s,h,f)}emplace(t,i,s,h,f,g){const y=5*t;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=h,this.float32[y+3]=f,this.float32[y+4]=g,t}}nn.prototype.bytesPerElement=20,Jt(nn,"StructArrayLayout5f20");class Eo extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,s,h)}emplace(t,i,s,h,f){const g=6*t;return this.uint32[3*t+0]=i,this.uint16[g+2]=s,this.uint16[g+3]=h,this.uint16[g+4]=f,t}}Eo.prototype.bytesPerElement=12,Jt(Eo,"StructArrayLayout1ul3ui12");class rn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=s,t}}rn.prototype.bytesPerElement=4,Jt(rn,"StructArrayLayout2ui4");class qr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}qr.prototype.bytesPerElement=2,Jt(qr,"StructArrayLayout1ui2");class Zr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,i)}emplace(t,i,s){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=s,t}}Zr.prototype.bytesPerElement=8,Jt(Zr,"StructArrayLayout2f8");class To extends wt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}To.prototype.size=12;class on extends Be{get(t){return new To(this,t)}}Jt(on,"FillExtrusionExtArray");class ko extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ko.prototype.size=40;class $r extends Ni{get(t){return new ko(this,t)}}Jt($r,"CollisionBoxArray");class ha extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}ha.prototype.size=60;class Yf extends Ei{get(t){return new ha(this,t)}}Jt(Yf,"PlacedSymbolArray");class Wd extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Wd.prototype.size=76;class Xd extends qi{get(t){return new Wd(this,t)}}Jt(Xd,"SymbolInstanceArray");class Kh extends Qe{getoffsetX(t){return this.float32[1*t+0]}}Jt(Kh,"GlyphOffsetArray");class Qh extends Qt{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Jt(Qh,"SymbolLineVertexArray");class Jd extends wt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Jd.prototype.size=12;class Kd extends Eo{get(t){return new Jd(this,t)}}Jt(Kd,"FeatureIndexArray");class Qd extends wt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Qd.prototype.size=4;class tp extends rn{get(t){return new Qd(this,t)}}Jt(tp,"FillExtrusionCentroidArray");class ep extends wt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ep.prototype.size=12;class Wf extends Be{get(t){return new ep(this,t)}}Jt(Wf,"CircleGlobeExtArray");const Xf=Tt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Jf=Tt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ip=Na(function(n){n.exports=function(t,i){var s,h,f,g,y,b,w,S;for(h=t.length-(s=3&t.length),f=i,y=3432918353,b=461845907,S=0;S<h;)w=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24,++S,f=27492+(65535&(g=5*(65535&(f=(f^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&t.charCodeAt(S+2))<<16;case 2:w^=(255&t.charCodeAt(S+1))<<8;case 1:f^=w=(65535&(w=(w=(65535&(w^=255&t.charCodeAt(S)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295}return f^=t.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Kf=Na(function(n){n.exports=function(t,i){for(var s,h=t.length,f=i^h,g=0;h>=4;)s=1540483477*(65535&(s=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:f^=(255&t.charCodeAt(g+2))<<16;case 2:f^=(255&t.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&t.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),Dc=ip,Qf=Kf;Dc.murmur3=ip,Dc.murmur2=Qf;class $u{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,s,h){this.ids.push(tm(t)),this.positions.push(i,s,h)}getPositions(t){const i=tm(t);let s=0,h=this.ids.length-1;for(;s<h;){const g=s+h>>1;this.ids[g]>=i?h=g:s=g+1}const f=[];for(;this.ids[s]===i;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(t,i){const s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return td(s,h,0,s.length-1),i&&i.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(t){const i=new $u;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function tm(n){const t=+n;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Dc(String(n))}function td(n,t,i,s){for(;i<s;){const h=n[i+s>>1];let f=i-1,g=s+1;for(;;){do{f++}while(n[f]<h);do{g--}while(n[g]>h);if(f>=g)break;Yu(n,f,g),Yu(t,3*f,3*g),Yu(t,3*f+1,3*g+1),Yu(t,3*f+2,3*g+2)}g-i<s-g?(td(n,t,i,g),i=g+1):(td(n,t,g+1,s),s=g)}}function Yu(n,t,i){const s=n[t];n[t]=n[i],n[i]=s}Jt($u,"FeaturePositionMap");class Do{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class Wu extends Do{constructor(t){super(t),this.current=0}set(t,i,s){this.fetchUniformLocation(t,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class np extends Do{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,s){this.fetchUniformLocation(t,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class rp extends Do{constructor(t){super(t),this.current=We.transparent}set(t,i,s){this.fetchUniformLocation(t,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const em=new Float32Array(16),im=new Float32Array(9),Ng=new Float32Array(4);function ed(n){return[kt(255*n.r,255*n.g),kt(255*n.b,255*n.a)]}class Ic{constructor(t,i,s){this.value=t,this.uniformNames=i.map(h=>`u_${h}`),this.type=s}setUniform(t,i,s,h,f){i.set(t,f,h.constantOr(this.value))}getBinding(t,i){return"color"===this.type?new rp(t):new Wu(t)}}class bl{constructor(t,i){this.uniformNames=i.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio||1,this.pixelRatioTo=t.pixelRatio||1,this.patternFrom=i.tl.concat(i.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,i,s,h,f){const g="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;g&&i.set(t,f,g)}getBinding(t,i){return"u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?new np(t):new Wu(t)}}class Io{constructor(t,i,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,s,h,f,g){const y=this.paintVertexArray.length,b=this.expression.evaluate(new H(0),i,{},f,h,g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,b)}updatePaintArray(t,i,s,h,f){const g=this.expression.evaluate({zoom:0},s,h,void 0,f);this._setPaintValue(t,i,g)}_setPaintValue(t,i,s){if("color"===this.type){const h=ed(s);for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cr{constructor(t,i,s,h,f,g){this.expression=t,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,i,s,h,f,g){const y=this.expression.evaluate(new H(this.zoom),i,{},f,h,g),b=this.expression.evaluate(new H(this.zoom+1),i,{},f,h,g),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,y,b)}updatePaintArray(t,i,s,h,f){const g=this.expression.evaluate({zoom:this.zoom},s,h,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},s,h,void 0,f);this._setPaintValue(t,i,g,y)}_setPaintValue(t,i,s,h){if("color"===this.type){const f=ed(s),g=ed(h);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],g[0],g[1])}else{for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,s,h,f){const g=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=ye(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(t,f,y)}getBinding(t,i){return new Wu(t)}}class us{constructor(t,i,s,h,f,g,y){this.expression=t,this.type=s,this.useIntegerZoom=h,this.zoom=f,this.layerId=y,this.paintVertexAttributes=("array"===s?Jf:Xf).members;for(let b=0;b<i.length;++b);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,i,s){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(t,i,s,h,f,g){this._setPaintValues(t,i,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(t,i,s,h){if(!h||!s)return;const{min:f,mid:g,max:y}=s,b=h[f],w=h[g],S=h[y];if(b&&w&&S)for(let T=t;T<i;T++)this._setPaintValue(this.zoomInPaintVertexArray,T,w,b),this._setPaintValue(this.zoomOutPaintVertexArray,T,w,S)}_setPaintValue(t,i,s,h){t.emplace(i,s.tl[0],s.tl[1],s.br[0],s.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],s.pixelRatio,h.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class hs{constructor(t,i,s=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const f in t.paint._values){if(!s(f))continue;const g=t.paint.get(f);if(!(g instanceof et&&ir(g.property.specification)))continue;const y=rm(f,t.type),b=g.value,w=g.property.specification.type,S=g.property.useIntegerZoom,T=g.property.specification["property-type"],k="cross-faded"===T||"cross-faded-data-driven"===T,O="line-dasharray"===String(f)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==b.kind||O)if("source"===b.kind||O||k){const L=op(f,w,"source");this.binders[f]=k?new us(b,y,w,S,i,L,t.id):new Io(b,y,w,L),h.push(`/a_${f}`)}else{const L=op(f,w,"composite");this.binders[f]=new Cr(b,y,w,S,i,L),h.push(`/z_${f}`)}else this.binders[f]=k?new bl(b.value,y):new Ic(b.value,y,w),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Io||i instanceof Cr?i.maxValue:0}populatePaintArrays(t,i,s,h,f,g){for(const y in this.binders){const b=this.binders[y];(b instanceof Io||b instanceof Cr||b instanceof us)&&b.populatePaintArray(t,i,s,h,f,g)}}setConstantPatternPositions(t,i){for(const s in this.binders){const h=this.binders[s];h instanceof bl&&h.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,s,h,f,g){let y=!1;for(const b in t){const w=i.getPositions(b);for(const S of w){const T=s.feature(S.index);for(const k in this.binders){const O=this.binders[k];if((O instanceof Io||O instanceof Cr||O instanceof us)&&!0===O.expression.isStateDependent){const L=h.paint.get(k);O.expression=L.value,O.updatePaintArray(S.start,S.end,T,t[b],f,g),y=!0}}}}return y}defines(){const t=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Ic||s instanceof bl)&&t.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Io||s instanceof Cr||s instanceof us)for(let h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Ic||s instanceof bl||s instanceof Cr)for(const h of s.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Ic||h instanceof bl||h instanceof Cr)for(const f of h.uniformNames)i.push({name:f,property:s,binding:h.getBinding(t,f)})}return i}setUniforms(t,i,s,h,f){for(const{name:g,property:y,binding:b}of s)this.binders[y].setUniform(t,b,f,h.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const s=this.binders[i];if(t&&s instanceof us){const h=2===t.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof Io||s instanceof Cr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const i in this.binders){const s=this.binders[i];(s instanceof Io||s instanceof Cr||s instanceof us)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Io||i instanceof Cr||i instanceof us)&&i.destroy()}}}class wl{constructor(t,i,s=(()=>!0)){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new hs(h,i,s);this.needsUpload=!1,this._featureMap=new $u,this._bufferOffset=0}populatePaintArrays(t,i,s,h,f,g,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,i,h,f,g,y);void 0!==i.id&&this._featureMap.add(i.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,s,h,f){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,i,g,h,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const nm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function rm(n,t){return nm[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}const om={"line-pattern":{source:Kt,composite:Kt},"fill-pattern":{source:Kt,composite:Kt},"fill-extrusion-pattern":{source:Kt,composite:Kt},"line-dasharray":{source:fe,composite:fe}},sm={color:{source:Zr,composite:Te},number:{source:Qe,composite:Zr}};function op(n,t,i){const s=om[n];return s&&s[i]||sm[t][i]}Jt(Ic,"ConstantBinder"),Jt(bl,"CrossFadedConstantBinder"),Jt(Io,"SourceExpressionBinder"),Jt(us,"CrossFadedCompositeBinder"),Jt(Cr,"CompositeExpressionBinder"),Jt(hs,"ProgramConfiguration",{omit:["_buffers"]}),Jt(wl,"ProgramConfigurationSet");const Xu="-transition";class Yr extends ie{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new st(i.layout)),i.paint)){this._transitionablePaint=new J(i.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new at(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,s={}){null!=i&&this._validate(Vu,`layers.${this.id}.layout.${t}`,t,i,s)||("visibility"!==t?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return oo(t,Xu)?this._transitionablePaint.getTransition(t.slice(0,-Xu.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,s={}){if(null!=i&&this._validate(ml,`layers.${this.id}.paint.${t}`,t,i,s))return!1;if(oo(t,Xu))return this._transitionablePaint.setTransition(t.slice(0,-Xu.length),i||void 0),!1;{const h=this._transitionablePaint._values[t],f="cross-faded-data-driven"===h.property.specification["property-type"],g=h.value.isDataDriven(),y=h.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(t,y,b)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,i,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Lr(t,(i,s)=>!(void 0===i||"layout"===s&&!Object.keys(i).length||"paint"===s&&!Object.keys(i).length))}_validate(t,i,s,h,f={}){return(!f||!1!==f.validate)&&gl(this,t.call(ra,{key:i,layerType:this.type,objectKey:s,value:h,styleSpec:Ct,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof et&&ir(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ta(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const am=Tt([{name:"a_pos",components:2,type:"Int16"}],4),lm=Tt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ti{constructor(t=[]){this.segments=t}prepareSegment(t,i,s,h){let f=this.segments[this.segments.length-1];return t>Ti.MAX_VERTEX_ARRAY_LENGTH&&hi(`Max vertices per segment is ${Ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>Ti.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:i.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==h&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,s,h){return new Ti([{vertexOffset:t,primitiveOffset:i,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}Ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jt(Ti,"SegmentVector");var ce=8192;class ds{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof He?new He(t.lng,t.lat):He.convert(t),this}setSouthWest(t){return this._sw=t instanceof He?new He(t.lng,t.lat):He.convert(t),this}extend(t){const i=this._sw,s=this._ne;let h,f;if(t instanceof He)h=t,f=t;else{if(!(t instanceof ds))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(ds.convert(t)):this.extend(He.convert(t)):this;if(h=t._sw,f=t._ne,!h||!f)return this}return i||s?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new He(h.lng,h.lat),this._ne=new He(f.lng,f.lat)),this}getCenter(){return new He((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new He(this.getWest(),this.getNorth())}getSouthEast(){return new He(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:s}=He.convert(t);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(t){return!t||t instanceof ds?t:new ds(t)}}const id=6371008.8;class He{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new He(Fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,s=this.lat*i,h=t.lat*i,f=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return id*Math.acos(Math.min(f,1))}toBounds(t=0){const i=360*t/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new ds(new He(this.lng-s,this.lat-i),new He(this.lng+s,this.lat+i))}static convert(t){if(t instanceof He)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new He(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new He(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const sp=2*Math.PI*id;function ap(n){return sp*Math.cos(n*Math.PI/180)}function Wr(n){return(180+n)/360}function Fo(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function sr(n,t){return n/ap(t)}function ar(n){return 360*n-180}function Zi(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function lp(n,t){return n*ap(Zi(t))}const Xr=85.051129;function cm(n){return 1/Math.cos(n*Math.PI/180)}class Cl{constructor(t,i,s=0){this.x=+t,this.y=+i,this.z=+s}static fromLngLat(t,i=0){const s=He.convert(t);return new Cl(Wr(s.lng),Fo(s.lat),sr(i,s.lat))}toLngLat(){return new He(ar(this.x),Zi(this.y))}toAltitude(){return lp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/sp*cm(Zi(this.y))}}function nd(n,t,i,s,h,f,g,y,b){const w=(t+s)/2,S=(i+h)/2,T=new jt(w,S);y(T),function(k,O,L,B,N,X){const it=L-N,K=B-X;return Math.abs((B-O)*it-(L-k)*K)/Math.hypot(it,K)}(T.x,T.y,f.x,f.y,g.x,g.y)>=b?(nd(n,t,i,w,S,f,T,y,b),nd(n,w,S,s,h,T,g,y,b)):n.push(g)}function cp(n,t,i){let s=n[0],h=s.x,f=s.y;t(s);const g=[s];for(let y=1;y<n.length;y++){const b=n[y],{x:w,y:S}=b;t(b),nd(g,h,f,w,S,s,b,t,i),h=w,f=S,s=b}return g}function rd(n,t,i,s,h){if(h(t,i)){const f=t.add(i).mult(.5);s(f),rd(n,t,f,s,h),rd(n,f,i,s,h)}else n.push(i)}function um(n,t,i){let s=n[0];t(s);const h=[s];for(let f=1;f<n.length;f++){const g=n[f];t(g),rd(h,s,g,t,i),s=g}return h}const od=Math.pow(2,14)-1,hm=-od-1;function dm(n,t){const i=Math.round(n.x*t),s=Math.round(n.y*t);return n.x=ye(i,hm,od),n.y=ye(s,hm,od),(i<n.x||i>n.x+1||s<n.y||s>n.y+1)&&hi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Oo(n,t,i){const s=n.loadGeometry(),h=n.extent,f=ce/h;if(t&&i&&i.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:y,x:b,y:w,projection:S}=i,T=k=>{const O=ar((t.x+k.x/h)/g),L=Zi((t.y+k.y/h)/g),B=S.project(O,L);k.x=(B.x*y-b)*h,k.y=(B.y*y-w)*h};for(let k=0;k<s.length;k++)if(1!==n.type)s[k]=cp(s[k],T,1);else{const O=[];for(const L of s[k])L.x<0||L.x>=h||L.y<0||L.y>=h||(T(L),O.push(L));s[k]=O}}for(const g of s)for(const y of g)dm(y,f);return s}function ps(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Oo(n):[]}}function Ju(n,t,i,s,h){n.emplaceBack(2*t+(s+1)/2,2*i+(h+1)/2)}function Ku(n,t,i){n.emplaceBack(t.x,t.y,t.z,16384*i[0],16384*i[1],16384*i[2])}class sd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Ut,this.indexArray=new Ae,this.segments=new Ti,this.programConfigurations=new wl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s,h){const f=this.layers[0],g=[];let y=null;"circle"===f.type&&(y=f.layout.get("circle-sort-key"));for(const{feature:w,id:S,index:T,sourceLayerIndex:k}of t){const O=this.layers[0]._featureFilter.needGeometry,L=ps(w,O);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),L,s))continue;const B=y?y.evaluate(L,{},s):void 0,N={id:S,properties:w.properties,type:w.type,sourceLayerIndex:k,index:T,geometry:O?L.geometry:Oo(w,s,h),patterns:{},sortKey:B};g.push(N)}y&&g.sort((w,S)=>w.sortKey-S.sortKey);let b=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Wf,b=h.projection);for(const w of g){const{geometry:S,index:T,sourceLayerIndex:k}=w,O=t[T].feature;this.addFeature(w,S,T,i.availableImages,s,b),i.featureIndex.insert(O,S,T,k,this.index)}}update(t,i,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,am.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,lm.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,s,h,f,g){for(const y of i)for(const b of y){const w=b.x,S=b.y;if(w<0||w>=ce||S<0||S>=ce)continue;if(g){const O=g.projectTilePoint(w,S,f),L=g.upVector(f,w,S),B=this.globeExtVertexArray;Ku(B,O,L),Ku(B,O,L),Ku(B,O,L),Ku(B,O,L)}const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),k=T.vertexLength;Ju(this.layoutVertexArray,w,S,-1,-1),Ju(this.layoutVertexArray,w,S,1,-1),Ju(this.layoutVertexArray,w,S,1,1),Ju(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h,f)}}function up(n,t){for(let i=0;i<n.length;i++)if(da(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(da(n,t[i]))return!0;return!!hp(n,t)}function pm(n,t,i){return!!da(n,t)||!!pp(t,n,i)}function fm(n,t){if(1===n.length)return Ml(t,n[0]);for(let i=0;i<t.length;i++){const s=t[i];for(let h=0;h<s.length;h++)if(da(n,s[h]))return!0}for(let i=0;i<n.length;i++)if(Ml(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(hp(n,t[i]))return!0;return!1}function Ug(n,t,i){if(n.length>1){if(hp(n,t))return!0;for(let s=0;s<t.length;s++)if(pp(t[s],n,i))return!0}for(let s=0;s<n.length;s++)if(pp(n[s],t,i))return!0;return!1}function hp(n,t){if(0===n.length||0===t.length)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],h=n[i+1];for(let f=0;f<t.length-1;f++)if(dp(s,h,t[f],t[f+1]))return!0}return!1}function dp(n,t,i,s){return zi(n,i,s)!==zi(t,i,s)&&zi(n,t,i)!==zi(n,t,s)}function pp(n,t,i){const s=i*i;if(1===t.length)return n.distSqr(t[0])<s;for(let h=1;h<t.length;h++)if(fp(n,t[h-1],t[h])<s)return!0;return!1}function fp(n,t,i){const s=t.distSqr(i);if(0===s)return n.distSqr(t);const h=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/s;return n.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function Ml(n,t){let i,s,h,f=!1;for(let g=0;g<n.length;g++){i=n[g];for(let y=0,b=i.length-1;y<i.length;b=y++)s=i[y],h=i[b],s.y>t.y!=h.y>t.y&&t.x<(h.x-s.x)*(t.y-s.y)/(h.y-s.y)+s.x&&(f=!f)}return f}function da(n,t){let i=!1;for(let s=0,h=n.length-1;s<n.length;h=s++){const f=n[s],g=n[h];f.y>t.y!=g.y>t.y&&t.x<(g.x-f.x)*(t.y-f.y)/(g.y-f.y)+f.x&&(i=!i)}return i}function mp(n,t,i,s,h){for(const g of n)if(t<=g.x&&i<=g.y&&s>=g.x&&h>=g.y)return!0;const f=[new jt(t,i),new jt(t,h),new jt(s,h),new jt(s,i)];if(n.length>2)for(const g of f)if(da(n,g))return!0;for(let g=0;g<n.length-1;g++)if(gp(n[g],n[g+1],f))return!0;return!1}function gp(n,t,i){const s=i[0],h=i[2];if(n.x<s.x&&t.x<s.x||n.x>h.x&&t.x>h.x||n.y<s.y&&t.y<s.y||n.y>h.y&&t.y>h.y)return!1;const f=zi(n,t,i[0]);return f!==zi(n,t,i[1])||f!==zi(n,t,i[2])||f!==zi(n,t,i[3])}function Al(n,t,i){const s=t.paint.get(n).value;return"constant"===s.kind?s.value:i.programConfigurations.get(t.id).getMaxValue(n)}function Qu(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Jr(n,t,i,s,h){if(!t[0]&&!t[1])return n;const f=jt.convert(t)._mult(h);"viewport"===i&&f._rotate(-s);const g=[];for(let y=0;y<n.length;y++)g.push(n[y].sub(f));return g}function An(n,t,i,s){const h=jt.convert(n)._mult(s);return"viewport"===t&&h._rotate(-i),h}Jt(sd,"CircleBucket",{omit:["layers"]});const _p=new At({"circle-sort-key":new dt(Ct.layout_circle["circle-sort-key"])});var ad={paint:new At({"circle-radius":new dt(Ct.paint_circle["circle-radius"]),"circle-color":new dt(Ct.paint_circle["circle-color"]),"circle-blur":new dt(Ct.paint_circle["circle-blur"]),"circle-opacity":new dt(Ct.paint_circle["circle-opacity"]),"circle-translate":new rt(Ct.paint_circle["circle-translate"]),"circle-translate-anchor":new rt(Ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rt(Ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rt(Ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dt(Ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dt(Ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dt(Ct.paint_circle["circle-stroke-opacity"])}),layout:_p},Fc=1e-6,$i=typeof Float32Array<"u"?Float32Array:Array;function pa(){var n=new $i(9);return $i!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Mr(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ld(n,t){var i=t[0],s=t[1],h=t[2],f=t[3],g=t[4],y=t[5],b=t[6],w=t[7],S=t[8],T=t[9],k=t[10],O=t[11],L=t[12],B=t[13],N=t[14],X=t[15],it=i*y-s*g,K=i*b-h*g,tt=i*w-f*g,ct=s*b-h*y,nt=s*w-f*y,vt=h*w-f*b,xt=S*B-T*L,Mt=S*N-k*L,Bt=S*X-O*L,bt=T*N-k*B,St=T*X-O*B,It=k*X-O*N,Et=it*It-K*St+tt*bt+ct*Bt-nt*Mt+vt*xt;return Et?(n[0]=(y*It-b*St+w*bt)*(Et=1/Et),n[1]=(h*St-s*It-f*bt)*Et,n[2]=(B*vt-N*nt+X*ct)*Et,n[3]=(k*nt-T*vt-O*ct)*Et,n[4]=(b*Bt-g*It-w*Mt)*Et,n[5]=(i*It-h*Bt+f*Mt)*Et,n[6]=(N*tt-L*vt-X*K)*Et,n[7]=(S*vt-k*tt+O*K)*Et,n[8]=(g*St-y*Bt+w*xt)*Et,n[9]=(s*Bt-i*St-f*xt)*Et,n[10]=(L*nt-B*tt+X*it)*Et,n[11]=(T*tt-S*nt-O*it)*Et,n[12]=(y*Mt-g*bt-b*xt)*Et,n[13]=(i*bt-s*Mt+h*xt)*Et,n[14]=(B*K-L*ct-N*it)*Et,n[15]=(S*ct-T*K+k*it)*Et,n):null}function Sl(n,t,i){var s=t[0],h=t[1],f=t[2],g=t[3],y=t[4],b=t[5],w=t[6],S=t[7],T=t[8],k=t[9],O=t[10],L=t[11],B=t[12],N=t[13],X=t[14],it=t[15],K=i[0],tt=i[1],ct=i[2],nt=i[3];return n[0]=K*s+tt*y+ct*T+nt*B,n[1]=K*h+tt*b+ct*k+nt*N,n[2]=K*f+tt*w+ct*O+nt*X,n[3]=K*g+tt*S+ct*L+nt*it,n[4]=(K=i[4])*s+(tt=i[5])*y+(ct=i[6])*T+(nt=i[7])*B,n[5]=K*h+tt*b+ct*k+nt*N,n[6]=K*f+tt*w+ct*O+nt*X,n[7]=K*g+tt*S+ct*L+nt*it,n[8]=(K=i[8])*s+(tt=i[9])*y+(ct=i[10])*T+(nt=i[11])*B,n[9]=K*h+tt*b+ct*k+nt*N,n[10]=K*f+tt*w+ct*O+nt*X,n[11]=K*g+tt*S+ct*L+nt*it,n[12]=(K=i[12])*s+(tt=i[13])*y+(ct=i[14])*T+(nt=i[15])*B,n[13]=K*h+tt*b+ct*k+nt*N,n[14]=K*f+tt*w+ct*O+nt*X,n[15]=K*g+tt*S+ct*L+nt*it,n}function Oc(n,t,i){var s,h,f,g,y,b,w,S,T,k,O,L,B=i[0],N=i[1],X=i[2];return t===n?(n[12]=t[0]*B+t[4]*N+t[8]*X+t[12],n[13]=t[1]*B+t[5]*N+t[9]*X+t[13],n[14]=t[2]*B+t[6]*N+t[10]*X+t[14],n[15]=t[3]*B+t[7]*N+t[11]*X+t[15]):(h=t[1],f=t[2],g=t[3],y=t[4],b=t[5],w=t[6],S=t[7],T=t[8],k=t[9],O=t[10],L=t[11],n[0]=s=t[0],n[1]=h,n[2]=f,n[3]=g,n[4]=y,n[5]=b,n[6]=w,n[7]=S,n[8]=T,n[9]=k,n[10]=O,n[11]=L,n[12]=s*B+y*N+T*X+t[12],n[13]=h*B+b*N+k*X+t[13],n[14]=f*B+w*N+O*X+t[14],n[15]=g*B+S*N+L*X+t[15]),n}function fa(n,t,i){var s=i[0],h=i[1],f=i[2];return n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n[3]=t[3]*s,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*f,n[9]=t[9]*f,n[10]=t[10]*f,n[11]=t[11]*f,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function cd(n,t,i){var s=Math.sin(i),h=Math.cos(i),f=t[4],g=t[5],y=t[6],b=t[7],w=t[8],S=t[9],T=t[10],k=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=f*h+w*s,n[5]=g*h+S*s,n[6]=y*h+T*s,n[7]=b*h+k*s,n[8]=w*h-f*s,n[9]=S*h-g*s,n[10]=T*h-y*s,n[11]=k*h-b*s,n}function th(n,t,i){var s=Math.sin(i),h=Math.cos(i),f=t[0],g=t[1],y=t[2],b=t[3],w=t[8],S=t[9],T=t[10],k=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*h-w*s,n[1]=g*h-S*s,n[2]=y*h-T*s,n[3]=b*h-k*s,n[8]=f*s+w*h,n[9]=g*s+S*h,n[10]=y*s+T*h,n[11]=b*s+k*h,n}function yp(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function xp(n,t,i){var s,h,f,g=i[0],y=i[1],b=i[2],w=Math.hypot(g,y,b);return w<Fc?null:(g*=w=1/w,y*=w,b*=w,s=Math.sin(t),h=Math.cos(t),n[0]=g*g*(f=1-h)+h,n[1]=y*g*f+b*s,n[2]=b*g*f-y*s,n[3]=0,n[4]=g*y*f-b*s,n[5]=y*y*f+h,n[6]=b*y*f+g*s,n[7]=0,n[8]=g*b*f+y*s,n[9]=y*b*f-g*s,n[10]=b*b*f+h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var mm=Sl;function ud(){var n=new $i(3);return $i!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function vp(n){var t=new $i(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function Lc(n){return Math.hypot(n[0],n[1],n[2])}function El(n,t,i){var s=new $i(3);return s[0]=n,s[1]=t,s[2]=i,s}function fs(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n[2]=t[2]+i[2],n}function hd(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],n}function bp(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n}function Lo(n,t,i){return n[0]=Math.min(t[0],i[0]),n[1]=Math.min(t[1],i[1]),n[2]=Math.min(t[2],i[2]),n}function Tl(n,t,i){return n[0]=Math.max(t[0],i[0]),n[1]=Math.max(t[1],i[1]),n[2]=Math.max(t[2],i[2]),n}function On(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function Pc(n,t,i,s){return n[0]=t[0]+i[0]*s,n[1]=t[1]+i[1]*s,n[2]=t[2]+i[2]*s,n}function Yi(n,t){var i=t[0],s=t[1],h=t[2],f=i*i+s*s+h*h;return f>0&&(f=1/Math.sqrt(f)),n[0]=t[0]*f,n[1]=t[1]*f,n[2]=t[2]*f,n}function Zn(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function wp(n,t,i){var s=t[0],h=t[1],f=t[2],g=i[0],y=i[1],b=i[2];return n[0]=h*b-f*y,n[1]=f*g-s*b,n[2]=s*y-h*g,n}function Pi(n,t,i){var s=t[0],h=t[1],f=t[2],g=i[3]*s+i[7]*h+i[11]*f+i[15];return n[0]=(i[0]*s+i[4]*h+i[8]*f+i[12])/(g=g||1),n[1]=(i[1]*s+i[5]*h+i[9]*f+i[13])/g,n[2]=(i[2]*s+i[6]*h+i[10]*f+i[14])/g,n}function Ar(n,t,i){var s=i[0],h=i[1],f=i[2],g=t[0],y=t[1],b=t[2],w=h*b-f*y,S=f*g-s*b,T=s*y-h*g,k=h*T-f*S,O=f*w-s*T,L=s*S-h*w,B=2*i[3];return S*=B,T*=B,O*=2,L*=2,n[0]=g+(w*=B)+(k*=2),n[1]=y+S+O,n[2]=b+T+L,n}var Rc,Kr=hd,kl=bp,Cp=Lc;function Mp(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n}function ma(n,t,i){var s=t[0],h=t[1],f=t[2],g=t[3];return n[0]=i[0]*s+i[4]*h+i[8]*f+i[12]*g,n[1]=i[1]*s+i[5]*h+i[9]*f+i[13]*g,n[2]=i[2]*s+i[6]*h+i[10]*f+i[14]*g,n[3]=i[3]*s+i[7]*h+i[11]*f+i[15]*g,n}function Ap(){var n=new $i(4);return $i!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Sp(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Ep(n,t,i){i*=.5;var s=t[0],h=t[1],f=t[2],g=t[3],y=Math.sin(i),b=Math.cos(i);return n[0]=s*b+g*y,n[1]=h*b+f*y,n[2]=f*b-h*y,n[3]=g*b-s*y,n}function Tp(n,t,i){i*=.5;var s=t[0],h=t[1],f=t[2],g=t[3],y=Math.sin(i),b=Math.cos(i);return n[0]=s*b-f*y,n[1]=h*b+g*y,n[2]=f*b+s*y,n[3]=g*b-h*y,n}ud(),Rc=new $i(4),$i!=Float32Array&&(Rc[0]=0,Rc[1]=0,Rc[2]=0,Rc[3]=0),ud(),El(1,0,0),El(0,1,0),Ap(),Ap(),pa();class dd{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,s){const h=Zn(i,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/h;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(t,i,s){if(B=(O=this.pos)[0],N=O[1],X=O[2],it=(L=t)[0],K=L[1],tt=L[2],Math.abs(B-it)<=Fc*Math.max(1,Math.abs(B),Math.abs(it))&&Math.abs(N-K)<=Fc*Math.max(1,Math.abs(N),Math.abs(K))&&Math.abs(X-tt)<=Fc*Math.max(1,Math.abs(X),Math.abs(tt))||0===i)return s[0]=s[1]=s[2]=0,!1;var O,L,B,N,X,it,K,tt;const[h,f,g]=this.dir,y=this.pos[0]-t[0],b=this.pos[1]-t[1],w=this.pos[2]-t[2],S=h*h+f*f+g*g,T=2*(y*h+b*f+w*g),k=T*T-4*S*(y*y+b*b+w*w-i*i);if(k<0){const O=Math.max(-T/2,0),L=y+h*O,B=b+f*O,N=w+g*O,X=Math.hypot(L,B,N);return s[0]=L*i/X,s[1]=B*i/X,s[2]=N*i/X,!1}{const O=(-T-Math.sqrt(k))/(2*S);if(O<0){const L=Math.hypot(y,b,w);return s[0]=y*i/L,s[1]=b*i/L,s[2]=w*i/L,!1}return s[0]=y+h*O,s[1]=b+f*O,s[2]=w+g*O,!0}}}class pd{constructor(t,i,s,h,f){this.TL=t,this.TR=i,this.BR=s,this.BL=h,this.horizon=f}static fromInvProjectionMatrix(t,i,s){const h=[-1,1,1],f=[1,1,1],g=[1,-1,1],y=[-1,-1,1],b=Pi(h,h,t),w=Pi(f,f,t),S=Pi(g,g,t),T=Pi(y,y,t);return new pd(b,w,S,T,i/s)}}class kp{constructor(t,i){this.points=t,this.planes=i}static fromInvProjectionMatrix(t,i,s,h){const f=Math.pow(2,s),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const w=ma([],b,t),S=1/w[3]/i*f;return(T=w)[0]=(k=w)[0]*(O=[S,S,h?1/w[3]:S,S])[0],T[1]=k[1]*O[1],T[2]=k[2]*O[2],T[3]=k[3]*O[3],T;var T,k,O}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const w=Yi([],wp([],Kr([],g[b[0]],g[b[1]]),Kr([],g[b[2]],g[b[1]]))),S=-Zn(w,g[b[1]]);return w.concat(S)});return new kp(g,y)}}class Sn{static fromPoints(t){const i=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],s=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const h of t)i[0]=Math.min(i[0],h[0]),i[1]=Math.min(i[1],h[1]),i[2]=Math.min(i[2],h[2]),s[0]=Math.max(s[0],h[0]),s[1]=Math.max(s[1],h[1]),s[2]=Math.max(s[2],h[2]);return new Sn(i,s)}constructor(t,i){this.min=t,this.max=i,this.center=On([],fs([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],s=vp(this.min),h=vp(this.max);for(let f=0;f<i.length;f++)s[f]=i[f]?this.min[f]:this.center[f],h[f]=i[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Sn(s,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){const i=this.getCorners();let s=!0;for(let h=0;h<t.planes.length;h++){const f=t.planes[h];let g=0;for(let y=0;y<i.length;y++)g+=Zn(f,i[y])+f[3]>=0;if(0===g)return 0;g!==i.length&&(s=!1)}if(s)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const b=t.points[y][h]-this.min[h];f=Math.min(f,b),g=Math.max(g,b)}if(g<0||f>this.max[h]-this.min[h])return 0}return 1}}function Sr(n,t,i,s,h,f,g,y,b){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(b*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,S=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const T of t)for(const k of T){const O=k.add(y),L=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,B=i.projection.projectTilePoint(O.x,O.y,w);if(L>0){const K=i.projection.upVector(w,O.x,O.y);B.x+=K[0]*S*L,B.y+=K[1]*S*L,B.z+=K[2]*S*L}const N=f?O:Dp(B.x,B.y,B.z,s),X=f?n.tilespaceRays.map(K=>gm(K,L)):n.queryGeometry.screenGeometry,it=ma([],[B.x,B.y,B.z,1],s);if(!g&&f?b*=it[3]/i.cameraToCenterDistance:g&&!f&&(b*=i.cameraToCenterDistance/it[3]),f){const K=Zi((k.y/ce+w.y)/(1<<w.z));b/=i.projection.pixelsPerMeter(K,1)/sr(1,K)}if(pm(X,N,b))return!0}return!1}function Dp(n,t,i,s){const h=ma([],[n,t,i,1],s);return new jt(h[0]/h[3],h[1]/h[3])}const zc=El(0,0,0),fd=El(0,0,1);function gm(n,t){const i=ud();return zc[2]=t,n.intersectsPlane(zc,fd,i),new jt(i[0],i[1])}class Ip extends sd{}function Fp(n,{width:t,height:i},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*i*s);return n.width=t,n.height=i,n.data=h,n}function md(n,t,i){const{width:s,height:h}=t;s===n.width&&h===n.height||(eh(n,t,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,h)},i),n.width=s,n.height=h,n.data=t.data)}function eh(n,t,i,s,h,f){if(0===h.width||0===h.height)return t;if(h.width>n.width||h.height>n.height||i.x>n.width-h.width||i.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||s.x>t.width-h.width||s.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,y=t.data;for(let b=0;b<h.height;b++){const w=((i.y+b)*n.width+i.x)*f,S=((s.y+b)*t.width+s.x)*f;for(let T=0;T<h.width*f;T++)y[S+T]=g[w+T]}return t}Jt(Ip,"HeatmapBucket",{omit:["layers"]});class Po{constructor(t,i){Fp(this,t,1,i)}resize(t){md(this,new Po(t),1)}clone(){return new Po({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,s,h,f){eh(t,i,s,h,f,1)}}class Ln{constructor(t,i){Fp(this,t,4,i)}resize(t){md(this,new Ln(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ln({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,s,h,f){eh(t,i,s,h,f,4)}}Jt(Po,"AlphaImage"),Jt(Ln,"RGBAImage");var ih={paint:new At({"heatmap-radius":new dt(Ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dt(Ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rt(Ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mt(Ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rt(Ct.paint_heatmap["heatmap-opacity"])})};function En(n){const t={},i=n.resolution||256,s=n.clips?n.clips.length:1,h=n.image||new Ln({width:i,height:s}),f=(g,y,b)=>{t[n.evaluationKey]=b;const w=n.expression.evaluate(t);h.data[g+y+0]=Math.floor(255*w.r/w.a),h.data[g+y+1]=Math.floor(255*w.g/w.a),h.data[g+y+2]=Math.floor(255*w.b/w.a),h.data[g+y+3]=Math.floor(255*w.a)};if(n.clips)for(let g=0,y=0;g<s;++g,y+=4*i)for(let b=0,w=0;b<i;b++,w+=4){const S=b/(i-1),{start:T,end:k}=n.clips[g];f(y,w,T*(1-S)+k*S)}else for(let g=0,y=0;g<i;g++,y+=4)f(0,y,g/(i-1));return h}var _m={paint:new At({"hillshade-illumination-direction":new rt(Ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new rt(Ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rt(Ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rt(Ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rt(Ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rt(Ct.paint_hillshade["hillshade-accent-color"])})};const ym=Tt([{name:"a_pos",components:2,type:"Int16"}],4),{members:xm}=ym;var nh=rh,vm=rh;function rh(n,t,i){i=i||2;var s,h,f,g,y,b,w,S=t&&t.length,T=S?t[0]*i:n.length,k=Op(n,0,T,i,!0),O=[];if(!k||k.next===k.prev)return O;if(S&&(k=function(B,N,X,it){var K,tt,ct,nt=[];for(K=0,tt=N.length;K<tt;K++)(ct=Op(B,N[K]*it,K<tt-1?N[K+1]*it:B.length,it,!1))===ct.next&&(ct.steiner=!0),nt.push(oh(ct));for(nt.sort(Lp),K=0;K<nt.length;K++)X=Pp(nt[K],X);return X}(n,t,k,i)),n.length>80*i){s=f=n[0],h=g=n[1];for(var L=i;L<T;L+=i)(y=n[L])<s&&(s=y),(b=n[L+1])<h&&(h=b),y>f&&(f=y),b>g&&(g=b);w=0!==(w=Math.max(f-s,g-h))?32767/w:0}return Bc(k,O,i,s,h,w,0),O}function Op(n,t,i,s,h){var f,g;if(h===xd(n,t,i,s)>0)for(f=t;f<i;f+=s)g=ch(f,n[f],n[f+1],g);else for(f=i-s;f>=t;f-=s)g=ch(f,n[f],n[f+1],g);return g&&ms(g,g.next)&&(Gc(g),g=g.next),g}function ga(n,t){if(!n)return n;t||(t=n);var i,s=n;do{if(i=!1,s.steiner||!ms(s,s.next)&&0!==Mi(s.prev,s,s.next))s=s.next;else{if(Gc(s),(s=t=s.prev)===s.next)break;i=!0}}while(i||s!==t);return t}function Bc(n,t,i,s,h,f,g){if(n){!g&&f&&function(S,T,k,O){var L=S;do{0===L.z&&(L.z=_d(L.x,L.y,T,k,O)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next}while(L!==S);L.prevZ.nextZ=null,L.prevZ=null,function(B){var N,X,it,K,tt,ct,nt,vt,xt=1;do{for(X=B,B=null,tt=null,ct=0;X;){for(ct++,it=X,nt=0,N=0;N<xt&&(nt++,it=it.nextZ);N++);for(vt=xt;nt>0||vt>0&&it;)0!==nt&&(0===vt||!it||X.z<=it.z)?(K=X,X=X.nextZ,nt--):(K=it,it=it.nextZ,vt--),tt?tt.nextZ=K:B=K,K.prevZ=tt,tt=K;X=it}tt.nextZ=null,xt*=2}while(ct>1)}(L)}(n,s,h,f);for(var y,b,w=n;n.prev!==n.next;)if(y=n.prev,b=n.next,f?ni(n,s,h,f):gd(n))t.push(y.i/i|0),t.push(n.i/i|0),t.push(b.i/i|0),Gc(n),n=b.next,w=b.next;else if((n=b)===w){g?1===g?Bc(n=Dl(ga(n),t,i),t,i,s,h,f,2):2===g&&Il(n,t,i,s,h,f):Bc(ga(n),t,i,s,h,f,1);break}}}function gd(n){var t=n.prev,i=n,s=n.next;if(Mi(t,i,s)>=0)return!1;for(var h=t.x,f=i.x,g=s.x,y=t.y,b=i.y,w=s.y,S=h<f?h<g?h:g:f<g?f:g,T=y<b?y<w?y:w:b<w?b:w,k=h>f?h>g?h:g:f>g?f:g,O=y>b?y>w?y:w:b>w?b:w,L=s.next;L!==t;){if(L.x>=S&&L.x<=k&&L.y>=T&&L.y<=O&&Ro(h,y,f,b,g,w,L.x,L.y)&&Mi(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function ni(n,t,i,s){var h=n.prev,f=n,g=n.next;if(Mi(h,f,g)>=0)return!1;for(var y=h.x,b=f.x,w=g.x,S=h.y,T=f.y,k=g.y,O=y<b?y<w?y:w:b<w?b:w,L=S<T?S<k?S:k:T<k?T:k,B=y>b?y>w?y:w:b>w?b:w,N=S>T?S>k?S:k:T>k?T:k,X=_d(O,L,t,i,s),it=_d(B,N,t,i,s),K=n.prevZ,tt=n.nextZ;K&&K.z>=X&&tt&&tt.z<=it;){if(K.x>=O&&K.x<=B&&K.y>=L&&K.y<=N&&K!==h&&K!==g&&Ro(y,S,b,T,w,k,K.x,K.y)&&Mi(K.prev,K,K.next)>=0||(K=K.prevZ,tt.x>=O&&tt.x<=B&&tt.y>=L&&tt.y<=N&&tt!==h&&tt!==g&&Ro(y,S,b,T,w,k,tt.x,tt.y)&&Mi(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;K&&K.z>=X;){if(K.x>=O&&K.x<=B&&K.y>=L&&K.y<=N&&K!==h&&K!==g&&Ro(y,S,b,T,w,k,K.x,K.y)&&Mi(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;tt&&tt.z<=it;){if(tt.x>=O&&tt.x<=B&&tt.y>=L&&tt.y<=N&&tt!==h&&tt!==g&&Ro(y,S,b,T,w,k,tt.x,tt.y)&&Mi(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function Dl(n,t,i){var s=n;do{var h=s.prev,f=s.next.next;!ms(h,f)&&sh(h,s,s.next,f)&&gs(h,f)&&gs(f,h)&&(t.push(h.i/i|0),t.push(s.i/i|0),t.push(f.i/i|0),Gc(s),Gc(s.next),s=n=f),s=s.next}while(s!==n);return ga(s)}function Il(n,t,i,s,h,f){var g=n;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&_a(g,y)){var b=_s(g,y);return g=ga(g,g.next),b=ga(b,b.next),Bc(g,t,i,s,h,f,0),void Bc(b,t,i,s,h,f,0)}y=y.next}g=g.next}while(g!==n)}function Lp(n,t){return n.x-t.x}function Pp(n,t){var i=function(h,f){var g,y=f,b=h.x,w=h.y,S=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var T=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(T<=b&&T>S&&(S=T,g=y.x<y.next.x?y:y.next,T===b))return g}y=y.next}while(y!==f);if(!g)return null;var k,O=g,L=g.x,B=g.y,N=1/0;y=g;do{b>=y.x&&y.x>=L&&b!==y.x&&Ro(w<B?b:S,w,L,B,w<B?S:b,w,y.x,y.y)&&(k=Math.abs(w-y.y)/(b-y.x),gs(y,h)&&(k<N||k===N&&(y.x>g.x||y.x===g.x&&Vc(g,y)))&&(g=y,N=k)),y=y.next}while(y!==O);return g}(n,t);if(!i)return t;var s=_s(i,n);return ga(s,s.next),ga(i,i.next)}function Vc(n,t){return Mi(n.prev,n,t.prev)<0&&Mi(t.next,n,n.next)<0}function _d(n,t,i,s,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function oh(n){var t=n,i=n;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==n);return i}function Ro(n,t,i,s,h,f,g,y){return(h-g)*(t-y)>=(n-g)*(f-y)&&(n-g)*(s-y)>=(i-g)*(t-y)&&(i-g)*(f-y)>=(h-g)*(s-y)}function _a(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(i,s){var h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==s.i&&h.next.i!==s.i&&sh(h,h.next,i,s))return!0;h=h.next}while(h!==i);return!1}(n,t)&&(gs(n,t)&&gs(t,n)&&function(i,s){var h=i,f=!1,g=(i.x+s.x)/2,y=(i.y+s.y)/2;do{h.y>y!=h.next.y>y&&h.next.y!==h.y&&g<(h.next.x-h.x)*(y-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next}while(h!==i);return f}(n,t)&&(Mi(n.prev,n,t.prev)||Mi(n,t.prev,t))||ms(n,t)&&Mi(n.prev,n,n.next)>0&&Mi(t.prev,t,t.next)>0)}function Mi(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function ms(n,t){return n.x===t.x&&n.y===t.y}function sh(n,t,i,s){var h=lh(Mi(n,t,i)),f=lh(Mi(n,t,s)),g=lh(Mi(i,s,n)),y=lh(Mi(i,s,t));return h!==f&&g!==y||!(0!==h||!ah(n,i,t))||!(0!==f||!ah(n,s,t))||!(0!==g||!ah(i,n,s))||!(0!==y||!ah(i,t,s))}function ah(n,t,i){return t.x<=Math.max(n.x,i.x)&&t.x>=Math.min(n.x,i.x)&&t.y<=Math.max(n.y,i.y)&&t.y>=Math.min(n.y,i.y)}function lh(n){return n>0?1:n<0?-1:0}function gs(n,t){return Mi(n.prev,n,n.next)<0?Mi(n,t,n.next)>=0&&Mi(n,n.prev,t)>=0:Mi(n,t,n.prev)<0||Mi(n,n.next,t)<0}function _s(n,t){var i=new yd(n.i,n.x,n.y),s=new yd(t.i,t.x,t.y),h=n.next,f=t.prev;return n.next=t,t.prev=n,i.next=h,h.prev=i,s.next=i,i.prev=s,f.next=s,s.prev=f,s}function ch(n,t,i,s){var h=new yd(n,t,i);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Gc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function yd(n,t,i){this.i=n,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xd(n,t,i,s){for(var h=0,f=t,g=i-s;f<i;f+=s)h+=(n[g]-n[f])*(n[f+1]+n[g+1]),g=f;return h}function jg(n,t,i,s,h){Rp(n,t,i||0,s||n.length-1,h||Hg)}function Rp(n,t,i,s,h){for(;s>i;){if(s-i>600){var f=s-i+1,g=t-i+1,y=Math.log(f),b=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*b*(f-b)/f)*(g-f/2<0?-1:1);Rp(n,t,Math.max(i,Math.floor(t-g*b/f+w)),Math.min(s,Math.floor(t+(f-g)*b/f+w)),h)}var S=n[t],T=i,k=s;for(ya(n,i,t),h(n[s],S)>0&&ya(n,i,s);T<k;){for(ya(n,T,k),T++,k--;h(n[T],S)<0;)T++;for(;h(n[k],S)>0;)k--}0===h(n[i],S)?ya(n,i,k):ya(n,++k,s),k<=t&&(i=k+1),t<=k&&(s=k-1)}}function ya(n,t,i){var s=n[t];n[t]=n[i],n[i]=s}function Hg(n,t){return n<t?-1:n>t?1:0}function zp(n,t){const i=n.length;if(i<=1)return[n];const s=[];let h,f;for(let g=0;g<i;g++){const y=Wn(n[g]);0!==y&&(n[g].area=Math.abs(y),void 0===f&&(f=y<0),f===y<0?(h&&s.push(h),h=[n[g]]):h.push(n[g]))}if(h&&s.push(h),t>1)for(let g=0;g<s.length;g++)s[g].length<=t||(jg(s[g],t,1,s[g].length-1,Bp),s[g]=s[g].slice(0,t));return s}function Bp(n,t){return t.area-n.area}function vd(n,t,i){const s=i.patternDependencies;let h=!1;for(const f of t){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(h=!0);const y=g.constantOr(null);y&&(h=!0,s[y.to]=!0,s[y.from]=!0)}return h}function bd(n,t,i,s,h){const f=h.patternDependencies;for(const g of t){const y=g.paint.get(`${n}-pattern`).value;if("constant"!==y.kind){let b=y.evaluate({zoom:s-1},i,{},h.availableImages),w=y.evaluate({zoom:s},i,{},h.availableImages),S=y.evaluate({zoom:s+1},i,{},h.availableImages);b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,S=S&&S.name?S.name:S,f[b]=!0,f[w]=!0,f[S]=!0,i.patterns[g.id]={min:b,mid:w,max:S}}}return i}rh.deviation=function(n,t,i,s){var h=t&&t.length,f=Math.abs(xd(n,0,h?t[0]*i:n.length,i));if(h)for(var g=0,y=t.length;g<y;g++)f-=Math.abs(xd(n,t[g]*i,g<y-1?t[g+1]*i:n.length,i));var b=0;for(g=0;g<s.length;g+=3){var w=s[g]*i,S=s[g+1]*i,T=s[g+2]*i;b+=Math.abs((n[w]-n[T])*(n[S+1]-n[w+1])-(n[w]-n[S])*(n[T+1]-n[w+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)},rh.flatten=function(n){for(var t=n[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,h=0;h<n.length;h++){for(var f=0;f<n[h].length;f++)for(var g=0;g<t;g++)i.vertices.push(n[h][f][g]);h>0&&i.holes.push(s+=n[h-1].length)}return i},nh.default=vm;class Nc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ut,this.indexArray=new Ae,this.indexArray2=new rn,this.programConfigurations=new wl(t.layers,t.zoom),this.segments=new Ti,this.segments2=new Ti,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,s,h){this.hasPattern=vd("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:y,id:b,index:w,sourceLayerIndex:S}of t){const T=this.layers[0]._featureFilter.needGeometry,k=ps(y,T);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),k,s))continue;const O=f?f.evaluate(k,{},s,i.availableImages):void 0,L={id:b,properties:y.properties,type:y.type,sourceLayerIndex:S,index:w,geometry:T?k.geometry:Oo(y,s,h),patterns:{},sortKey:O};g.push(L)}f&&g.sort((y,b)=>y.sortKey-b.sortKey);for(const y of g){const{geometry:b,index:w,sourceLayerIndex:S}=y;if(this.hasPattern){const T=bd("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(T)}else this.addFeature(y,b,w,s,{},i.availableImages);i.featureIndex.insert(t[w].feature,b,w,S,this.index)}}update(t,i,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,h)}addFeatures(t,i,s,h,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,s,h,f,g=[]){for(const y of zp(i,500)){let b=0;for(const L of y)b+=L.length;const w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),S=w.vertexLength,T=[],k=[];for(const L of y){if(0===L.length)continue;L!==y[0]&&k.push(T.length/2);const B=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),N=B.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(N+L.length-1,N),T.push(L[0].x),T.push(L[0].y);for(let X=1;X<L.length;X++)this.layoutVertexArray.emplaceBack(L[X].x,L[X].y),this.indexArray2.emplaceBack(N+X-1,N+X),T.push(L[X].x),T.push(L[X].y);B.vertexLength+=L.length,B.primitiveLength+=L.length}const O=nh(T,k);for(let L=0;L<O.length;L+=3)this.indexArray.emplaceBack(S+O[L],S+O[L+1],S+O[L+2]);w.vertexLength+=b,w.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,g,h)}}Jt(Nc,"FillBucket",{omit:["layers","patternFeatures"]});const bm=new At({"fill-sort-key":new dt(Ct.layout_fill["fill-sort-key"])});var wm={paint:new At({"fill-antialias":new rt(Ct.paint_fill["fill-antialias"]),"fill-opacity":new dt(Ct.paint_fill["fill-opacity"]),"fill-color":new dt(Ct.paint_fill["fill-color"]),"fill-outline-color":new dt(Ct.paint_fill["fill-outline-color"]),"fill-translate":new rt(Ct.paint_fill["fill-translate"]),"fill-translate-anchor":new rt(Ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new _t(Ct.paint_fill["fill-pattern"])}),layout:bm};const qg=Tt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Cm=Tt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Fl=Tt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ol}=qg;var Vp=lr;function lr(n,t,i,s,h){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=h,n.readFields(Mm,this,t)}function Mm(n,t,i){1==n?t.id=i.readVarint():2==n?function(s,h){for(var f=s.readVarint()+s.pos;s.pos<f;){var g=h._keys[s.readVarint()],y=h._values[s.readVarint()];h.properties[g]=y}}(i,t):3==n?t.type=i.readVarint():4==n&&(t._geometry=i.pos)}function Am(n){for(var t,i,s=0,h=0,f=n.length,g=f-1;h<f;g=h++)s+=((i=n[g]).x-(t=n[h]).x)*(t.y+i.y);return s}lr.types=["Unknown","Point","LineString","Polygon"],lr.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,i=n.readVarint()+n.pos,s=1,h=0,f=0,g=0,y=[];n.pos<i;){if(h<=0){var b=n.readVarint();s=7&b,h=b>>3}if(h--,1===s||2===s)f+=n.readSVarint(),g+=n.readSVarint(),1===s&&(t&&y.push(t),t=[]),t.push(new jt(f,g));else{if(7!==s)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&y.push(t),y},lr.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,i=1,s=0,h=0,f=0,g=1/0,y=-1/0,b=1/0,w=-1/0;n.pos<t;){if(s<=0){var S=n.readVarint();i=7&S,s=S>>3}if(s--,1===i||2===i)(h+=n.readSVarint())<g&&(g=h),h>y&&(y=h),(f+=n.readSVarint())<b&&(b=f),f>w&&(w=f);else if(7!==i)throw new Error("unknown command "+i)}return[g,b,y,w]},lr.prototype.toGeoJSON=function(n,t,i){var s,h,f=this.extent*Math.pow(2,i),g=this.extent*n,y=this.extent*t,b=this.loadGeometry(),w=lr.types[this.type];function S(O){for(var L=0;L<O.length;L++){var B=O[L];O[L]=[360*(B.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(s=0;s<b.length;s++)T[s]=b[s][0];S(b=T);break;case 2:for(s=0;s<b.length;s++)S(b[s]);break;case 3:for(b=function(O){var L=O.length;if(L<=1)return[O];for(var B,N,X=[],it=0;it<L;it++){var K=Am(O[it]);0!==K&&(void 0===N&&(N=K<0),N===K<0?(B&&X.push(B),B=[O[it]]):B.push(O[it]))}return B&&X.push(B),X}(b),s=0;s<b.length;s++)for(h=0;h<b[s].length;h++)S(b[s][h])}1===b.length?b=b[0]:w="Multi"+w;var k={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(k.id=this.id),k};var Gp=wd;function wd(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Zg,this,t),this.length=this._features.length}function Zg(n,t,i){15===n?t.version=i.readVarint():1===n?t.name=i.readString():5===n?t.extent=i.readVarint():2===n?t._features.push(i.pos):3===n?t._keys.push(i.readString()):4===n&&t._values.push(function(s){for(var h=null,f=s.readVarint()+s.pos;s.pos<f;){var g=s.readVarint()>>3;h=1===g?s.readString():2===g?s.readFloat():3===g?s.readDouble():4===g?s.readVarint64():5===g?s.readVarint():6===g?s.readSVarint():7===g?s.readBoolean():null}return h}(i))}function Uc(n,t,i){if(3===n){var s=new Gp(i,i.readVarint()+i.pos);s.length&&(t[s.name]=s)}}wd.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new Vp(this._pbf,t,this.extent,this._keys,this._values)};var ys={VectorTile:function(n,t){this.layers=n.readFields(Uc,{},t)},VectorTileFeature:Vp,VectorTileLayer:Gp};function Cd(n,t,i,s){const h=[],f=0===s?(g,y,b,w,S,T)=>{g.push(new jt(T,b+(T-y)/(w-y)*(S-b)))}:(g,y,b,w,S,T)=>{g.push(new jt(y+(T-b)/(S-b)*(w-y),T))};for(const g of n){const y=[];for(const b of g){if(b.length<=2)continue;const w=[];for(let k=0;k<b.length-1;k++){const O=b[k].x,L=b[k].y,B=b[k+1].x,N=b[k+1].y,X=0===s?O:L,it=0===s?B:N;X<t?it>t&&f(w,O,L,B,N,t):X>i?it<i&&f(w,O,L,B,N,i):w.push(b[k]),it<t&&X>=t&&f(w,O,L,B,N,t),it>i&&X<=i&&f(w,O,L,B,N,i)}let S=b[b.length-1];const T=0===s?S.x:S.y;T>=t&&T<=i&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),y.push(w))}y.length&&h.push(y)}return h}const $g=ys.VectorTileFeature.types,Yg=Math.pow(2,13);function uh(n,t,i,s,h,f,g,y){n.emplaceBack((t<<1)+g,(i<<1)+f,(Math.floor(s*Yg)<<1)+h,Math.round(y))}function hh(n,t,i){n.emplaceBack(t.x,t.y,t.z,16384*i[0],16384*i[1],16384*i[2])}class Sm{constructor(){this.acc=new jt(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new jt(t.x,t.y),this.max=new jt(t.x,t.y))}append(t,i){this.currentPolyCount.edges++,this.acc._add(t);const s=this.min,h=this.max;t.x<s.x?s.x=t.x:t.x>h.x&&(h.x=t.x),t.y<s.y?s.y=t.y:t.y>h.y&&(h.y=t.y),((0===t.x||t.x===ce)&&t.x===i.x)!=((0===t.y||t.y===ce)&&t.y===i.y)&&this.processBorderOverlap(t,i),i.x<0!=t.x<0&&this.addBorderIntersection(0,Oe(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>ce!=t.x>ce&&this.addBorderIntersection(1,Oe(i.y,t.y,(ce-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,Oe(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>ce!=t.y>ce&&this.addBorderIntersection(3,Oe(i.x,t.x,(ce-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[t];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const s=0===t.x?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,t.y)}else{const s=0===t.y?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,t.x)}}centroid(){const t=this.polyCount.reduce((i,s)=>i+s.edges,0);return 0!==t?this.acc.div(t)._round():new jt(0,0)}span(){return new jt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0)}}class xa{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new ne,this.centroidVertexArray=new tp,this.indexArray=new Ae,this.programConfigurations=new wl(t.layers,t.zoom),this.segments=new Ti,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=t.enableTerrain}populate(t,i,s,h){this.features=[],this.hasPattern=vd("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/ce/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:g,index:y,sourceLayerIndex:b}of t){const w=this.layers[0]._featureFilter.needGeometry,S=ps(f,w);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),S,s))continue;const T={id:g,sourceLayerIndex:b,index:y,geometry:w?S.geometry:Oo(f,s,h),properties:f.properties,type:f.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(bd("fill-extrusion",this.layers,T,this.zoom,i)):this.addFeature(T,T.geometry,y,s,{},i.availableImages,h),i.featureIndex.insert(f,T.geometry,y,b,this.index,k)}this.sortBorders()}addFeatures(t,i,s,h,f){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,i,s,h,f)}this.sortBorders()}update(t,i,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ol),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Fl.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Cm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,s,h,f,g,y){const b=[new jt(0,0),new jt(ce,ce)],w=y.projection,S="globe"===w.name,T=this.enableTerrain&&!S?new Sm:null,k="Polygon"===$g[t.type];S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new on);const O=zp(i,500);for(let X=O.length-1;X>=0;X--){const it=O[X];(0===it.length||(L=it[0]).every(K=>K.x<=0)||L.every(K=>K.x>=ce)||L.every(K=>K.y<=0)||L.every(K=>K.y>=ce))&&O.splice(X,1)}var L;let B;if(S)B=Md(O,b,h);else{B=[];for(const X of O)B.push({polygon:X,bounds:b})}const N=k?this.edgeRadius:0;for(const{polygon:X,bounds:it}of B){let K=0,tt=0;for(const nt of X)k&&!nt[0].equals(nt[nt.length-1])&&nt.push(nt[0]),tt+=k?nt.length-1:nt.length;const ct=this.segments.prepareSegment((k?5:4)*tt,this.layoutVertexArray,this.indexArray);if(k){const nt=[],vt=[];K=ct.vertexLength;for(const Mt of X){let Bt,bt;Mt.length&&Mt!==X[0]&&vt.push(nt.length/2),Bt=Mt[1].sub(Mt[0])._perp()._unit();for(let St=1;St<Mt.length;St++){const It=Mt[St],Et=Mt[St===Mt.length-1?1:St+1];let{x:Pt,y:Ft}=It;if(N){bt=Et.sub(It)._perp()._unit();const Zt=Bt.add(bt)._unit(),be=N*Math.min(4,1/(Bt.x*Zt.x+Bt.y*Zt.y));Pt+=be*Zt.x,Ft+=be*Zt.y,Bt=bt}uh(this.layoutVertexArray,Pt,Ft,0,0,1,1,0),ct.vertexLength++,nt.push(It.x,It.y),S&&hh(this.layoutVertexExtArray,w.projectTilePoint(Pt,Ft,h),w.upVector(h,Pt,Ft))}}const xt=nh(nt,vt);for(let Mt=0;Mt<xt.length;Mt+=3)this.indexArray.emplaceBack(K+xt[Mt],K+xt[Mt+2],K+xt[Mt+1]),ct.primitiveLength++}for(const nt of X){T&&nt.length&&T.startRing(nt[0]);let vt,xt,Mt,Bt=nt.length>4&&Em(nt[nt.length-2],nt[0],nt[1]),bt=N?jc(nt[nt.length-2],nt[0],nt[1],N):0;xt=nt[1].sub(nt[0])._perp()._unit();for(let St=1,It=0;St<nt.length;St++){let Et=nt[St-1],Pt=nt[St];const Ft=nt[St===nt.length-1?1:St+1];if(T&&k&&T.currentPolyCount.top++,Hc(Pt,Et,it)){N&&(xt=Ft.sub(Pt)._perp()._unit());continue}T&&T.append(Pt,Et);const Zt=Pt.sub(Et)._perp(),be=Zt.x/(Math.abs(Zt.x)+Math.abs(Zt.y)),ge=Zt.y>0?1:0,ee=Et.dist(Pt);if(It+ee>32768&&(It=0),N){Mt=Ft.sub(Pt)._perp()._unit();let Xt=Np(Et,Pt,Ft,Ll(xt,Mt),N);isNaN(Xt)&&(Xt=0);const Xe=Pt.sub(Et)._unit();Et=Et.add(Xe.mult(bt))._round(),Pt=Pt.add(Xe.mult(-Xt))._round(),bt=Xt,xt=Mt}const Vt=ct.vertexLength,we=nt.length>4&&Em(Et,Pt,Ft);let ue=Up(It,Bt,!0);if(uh(this.layoutVertexArray,Et.x,Et.y,be,ge,0,0,ue),uh(this.layoutVertexArray,Et.x,Et.y,be,ge,0,1,ue),It+=ee,ue=Up(It,we,!1),Bt=we,uh(this.layoutVertexArray,Pt.x,Pt.y,be,ge,0,0,ue),uh(this.layoutVertexArray,Pt.x,Pt.y,be,ge,0,1,ue),ct.vertexLength+=4,this.indexArray.emplaceBack(Vt+0,Vt+1,Vt+2),this.indexArray.emplaceBack(Vt+1,Vt+3,Vt+2),ct.primitiveLength+=2,N){const Xt=K+(1===St?nt.length-2:St-2),Xe=1===St?K:Xt+1;if(this.indexArray.emplaceBack(Vt+1,Xt,Vt+3),this.indexArray.emplaceBack(Xt,Xe,Vt+3),ct.primitiveLength+=2,void 0===vt&&(vt=Vt),!Hc(Ft,nt[St],it)){const Je=St===nt.length-1?vt:ct.vertexLength;this.indexArray.emplaceBack(Vt+2,Vt+3,Je),this.indexArray.emplaceBack(Vt+3,Je+1,Je),this.indexArray.emplaceBack(Vt+3,Xe,Je+1),ct.primitiveLength+=3}}if(S){const Xt=this.layoutVertexExtArray,Xe=w.projectTilePoint(Et.x,Et.y,h),Je=w.projectTilePoint(Pt.x,Pt.y,h),oi=w.upVector(h,Et.x,Et.y),Ce=w.upVector(h,Pt.x,Pt.y);hh(Xt,Xe,oi),hh(Xt,Xe,oi),hh(Xt,Je,Ce),hh(Xt,Je,Ce)}}k&&(K+=nt.length-1)}}if(T&&T.polyCount.length>0){if(T.borders){T.vertexArrayOffset=this.centroidVertexArray.length;const X=T.borders,it=this.featuresOnBorder.push(T)-1;for(let K=0;K<4;K++)X[K][0]!==Number.MAX_VALUE&&this.borders[K].push(it)}this.encodeCentroid(T.borders?void 0:T.centroid(),T)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,g,h)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((i,s)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[s].borders[t][0])}encodeCentroid(t,i,s=!0){let h,f;if(t)if(0!==t.y){const y=i.span()._mult(this.tileToMeter);h=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else h=Math.ceil(7*(t.x+450)),f=0;else h=0,f=+s;let g=s?this.centroidVertexArray.length:i.vertexArrayOffset;for(const y of i.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(g++,h,f);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,h,f)}}}function Ll(n,t){const i=n.add(t)._unit();return n.x*i.x+n.y*i.y}function jc(n,t,i,s){const h=t.sub(n)._perp()._unit(),f=i.sub(t)._perp()._unit();return Np(n,t,i,Ll(h,f),s)}function Np(n,t,i,s,h){const f=Math.sqrt(1-s*s);return Math.min(n.dist(t)/3,t.dist(i)/3,h*f/s)}function Hc(n,t,i){return n.x<i[0].x&&t.x<i[0].x||n.x>i[1].x&&t.x>i[1].x||n.y<i[0].y&&t.y<i[0].y||n.y>i[1].y&&t.y>i[1].y}function Em(n,t,i){if(n.x<0||n.x>=ce||t.x<0||t.x>=ce||i.x<0||i.x>=ce)return!1;const s=i.sub(t),h=s.perp(),f=n.sub(t);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&h.x*f.x+h.y*f.y<0}function Up(n,t,i){const s=t?2|n:-3&n;return i?1|s:-2&s}function Tm(){const n=Math.PI/32,t=Math.tan(n),i=id;return i*Math.sqrt(1+2*t*t)-i}function Md(n,t,i){const s=1<<i.z,h=ar(i.x/s),f=ar((i.x+1)/s),g=Zi(i.y/s),y=Zi((i.y+1)/s);return function(b,w,S,T,k=0,O){const L=[];if(!b.length||!S||!T)return L;const B=(nt,vt)=>{for(const xt of nt)L.push({polygon:xt,bounds:vt})},N=Math.ceil(Math.log2(S)),X=Math.ceil(Math.log2(T)),it=N-X,K=[];for(let nt=0;nt<Math.abs(it);nt++)K.push(it>0?0:1);for(let nt=0;nt<Math.min(N,X);nt++)K.push(0),K.push(1);let tt=b;if(tt=Cd(tt,w[0].y-k,w[1].y+k,1),tt=Cd(tt,w[0].x-k,w[1].x+k,0),!tt.length)return L;const ct=[];for(K.length?ct.push({polygons:tt,bounds:w,depth:0}):B(tt,w);ct.length;){const nt=ct.pop(),vt=nt.depth,xt=K[vt],Mt=nt.bounds[0],Bt=nt.bounds[1],bt=0===xt?Mt.x:Mt.y,St=0===xt?Bt.x:Bt.y,It=O?O(xt,bt,St):.5*(bt+St),Et=Cd(nt.polygons,bt-k,It+k,xt),Pt=Cd(nt.polygons,It-k,St+k,xt);if(Et.length){const Ft=[Mt,new jt(0===xt?It:Bt.x,1===xt?It:Bt.y)];K.length>vt+1?ct.push({polygons:Et,bounds:Ft,depth:vt+1}):B(Et,Ft)}if(Pt.length){const Ft=[new jt(0===xt?It:Mt.x,1===xt?It:Mt.y),Bt];K.length>vt+1?ct.push({polygons:Pt,bounds:Ft,depth:vt+1}):B(Pt,Ft)}}return L}(n,t,Math.ceil((f-h)/11.25),Math.ceil((g-y)/11.25),1,(b,w,S)=>{if(0===b)return.5*(w+S);{const T=Zi((i.y+w/ce)/s);return(Fo(.5*(Zi((i.y+S/ce)/s)+T))*s-i.y)*ce}})}Jt(xa,"FillExtrusionBucket",{omit:["layers","features"]}),Jt(Sm,"PartMetadata");const Wg=new At({"fill-extrusion-edge-radius":new rt(Ct["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Pl={paint:new At({"fill-extrusion-opacity":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dt(Ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _t(Ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dt(Ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dt(Ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Wg};function km(n,t,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class Rl{constructor(t,i,s){this.z=t,this.x=i,this.y=s,this.key=qc(0,t,t,i,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const s=(g=this.y,y=this.z,b=km(256*(f=this.x),256*(g=Math.pow(2,y)-g-1),y),w=km(256*(f+1),256*(g+1),y),b[0]+","+b[1]+","+w[0]+","+w[1]),h=function(f,g,y){let b,w="";for(let S=f;S>0;S--)b=1<<S-1,w+=(g&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);var f,g,y,b,w;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dm{constructor(t,i){this.wrap=t,this.canonical=i,this.key=qc(t,i.z,i.z,i.x,i.y)}}class li{constructor(t,i,s,h,f){this.overscaledZ=t,this.wrap=i,this.canonical=new Rl(s,+h,+f),this.key=0===i&&t===s?this.canonical.key:qc(i,t,s,h,f)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new li(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new li(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return qc(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-t;return qc(this.wrap*+i,t,t,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new li(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new li(i,this.wrap,i,s,h),new li(i,this.wrap,i,s+1,h),new li(i,this.wrap,i,s,h+1),new li(i,this.wrap,i,s+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new li(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new li(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function qc(n,t,i,s,h){const f=1<<Math.min(i,22);let g=f*(h%f)+s%f;return n&&i<22&&(g+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(t-i)}function dh(n,t){return n.x*t.x+n.y*t.y}function Im(n,t){if(1===n.length){let i=0;const s=t[i++];let h;for(;!h||s.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const f=t[i],g=n[0],y=h.sub(s),b=f.sub(s),w=g.sub(s),S=dh(y,y),T=dh(y,b),k=dh(b,b),O=dh(w,y),L=dh(w,b),B=S*k-T*T,N=(k*O-T*L)/B,X=(S*L-T*O)/B,it=s.z*(1-N-X)+h.z*N+f.z*X;if(isFinite(it))return it}return 1/0}{let i=1/0;for(const s of t)i=Math.min(i,s.z);return i}}function ph(n){const t=new jt(n[0],n[1]);return t.z=n[2],t}function Fm(n,t,i,s,h,f,g,y){const b=g*h.getElevationAt(n,t,!0,!0),w=0!==f[0],S=w?0===f[1]?g*(f[0]/7-450):g*function(T,k,O){const L=Math.floor(k[0]/8),B=Math.floor(k[1]/8),N=10*(k[0]-8*L),X=10*(k[1]-8*B),it=T.getElevationAt(L,B,!0,!0),K=T.getMeterToDEM(O),tt=Math.floor(.5*(N*K-1)),ct=Math.floor(.5*(X*K-1)),nt=T.tileCoordToPixel(L,B),vt=2*tt+1,xt=2*ct+1,Mt=(be=vt,ge=xt,[(Pt=T).getElevationAtPixel(Ft=nt.x-tt,Zt=nt.y-ct,!0),Pt.getElevationAtPixel(Ft+ge,Zt,!0),Pt.getElevationAtPixel(Ft,Zt+ge,!0),Pt.getElevationAtPixel(Ft+be,Zt+ge,!0)]),Bt=Math.abs(Mt[0]-Mt[1]),bt=Math.abs(Mt[2]-Mt[3]),St=Math.abs(Mt[0]-Mt[2])+Math.abs(Mt[1]-Mt[3]),It=Math.min(.25,.5*K*(Bt+bt)/vt),Et=Math.min(.25,.5*K*St/xt);var Pt,Ft,Zt,be,ge;return it+Math.max(It*N,Et*X)}(h,f,y):b;return{base:b+(0===i)?-1:i,top:w?Math.max(S+s,b+i+2):b+s}}Jt(Rl,"CanonicalTileID"),Jt(li,"OverscaledTileID",{omit:["projMatrix"]});const fh=Tt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Om}=fh,Lm=Tt([{name:"a_packed",components:4,type:"Float32"}]),{members:Pm}=Lm,Xg=ys.VectorTileFeature.types,Jg=Math.cos(Math.PI/180*37.5);class zl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new le,this.layoutVertexArray2=new Te,this.indexArray=new Ae,this.programConfigurations=new wl(t.layers,t.zoom),this.segments=new Ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,s,h){this.hasPattern=vd("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:S,id:T,index:k,sourceLayerIndex:O}of t){const L=this.layers[0]._featureFilter.needGeometry,B=ps(S,L);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),B,s))continue;const N=f?f.evaluate(B,{},s):void 0,X={id:T,properties:S.properties,type:S.type,sourceLayerIndex:O,index:k,geometry:L?B.geometry:Oo(S,s,h),patterns:{},sortKey:N};g.push(X)}f&&g.sort((S,T)=>S.sortKey-T.sortKey);const{lineAtlas:y,featureIndex:b}=i,w=this.addConstantDashes(y);for(const S of g){const{geometry:T,index:k,sourceLayerIndex:O}=S;if(w&&this.addFeatureDashes(S,y),this.hasPattern){const L=bd("line",this.layers,S,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(S,T,k,s,y.positions,i.availableImages);b.insert(t[k].feature,T,k,O,this.index)}}addConstantDashes(t){let i=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==f.kind)i=!0;else{const g=f.value,y=h.value;if(!y)continue;t.addDash(y.from,g),t.addDash(y.to,g),y.other&&t.addDash(y.other,g)}}return i}addFeatureDashes(t,i){const s=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let y,b,w,S,T,k;if("constant"===f.kind){const N=f.value;if(!N)continue;y=N.other||N.to,b=N.to,w=N.from}else y=f.evaluate({zoom:s-1},t),b=f.evaluate({zoom:s},t),w=f.evaluate({zoom:s+1},t);"constant"===g.kind?S=T=k=g.value:(S=g.evaluate({zoom:s-1},t),T=g.evaluate({zoom:s},t),k=g.evaluate({zoom:s+1},t)),i.addDash(y,S),i.addDash(b,T),i.addDash(w,k);const O=i.getKey(y,S),L=i.getKey(b,T),B=i.getKey(w,k);t.patterns[h.id]={min:O,mid:L,max:B}}}update(t,i,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,s,h)}addFeatures(t,i,s,h,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Pm)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Om),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,s,h,f,g){const y=this.layers[0].layout,b=y.get("line-join").evaluate(t,{}),w=y.get("line-cap").evaluate(t,{}),S=y.get("line-miter-limit"),T=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const k of i)this.addLine(k,t,b,w,S,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,g,h)}addLine(t,i,s,h,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y="Polygon"===Xg[i.type];let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let w=0;for(;w<b-1&&t[w].equals(t[w+1]);)w++;if(b<(y?3:2))return;"bevel"===s&&(f=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,T=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let k,O,L,B,N;this.e1=this.e2=-1,y&&(k=t[b-2],N=t[w].sub(k)._unit()._perp());for(let X=w;X<b;X++){if(L=X===b-1?y?t[w+1]:void 0:t[X+1],L&&t[X].equals(L))continue;N&&(B=N),k&&(O=k),k=t[X],N=L?L.sub(k)._unit()._perp():B,B=B||N;let it=B.add(N);0===it.x&&0===it.y||it._unit();const K=B.x*N.x+B.y*N.y,tt=it.x*N.x+it.y*N.y,ct=0!==tt?1/tt:1/0,nt=2*Math.sqrt(2-2*tt),vt=tt<Jg&&O&&L,xt=B.x*N.y-B.y*N.x>0;if(vt&&X>w){const bt=k.dist(O);if(bt>2*S){const St=k.sub(k.sub(O)._mult(S/bt)._round());this.updateDistance(O,St),this.addCurrentVertex(St,B,0,0,T),O=St}}const Mt=O&&L;let Bt=Mt?s:y?"butt":h;if(Mt&&"round"===Bt&&(ct<g?Bt="miter":ct<=2&&(Bt="fakeround")),"miter"===Bt&&ct>f&&(Bt="bevel"),"bevel"===Bt&&(ct>2&&(Bt="flipbevel"),ct<f&&(Bt="miter")),O&&this.updateDistance(O,k),"miter"===Bt)it._mult(ct),this.addCurrentVertex(k,it,0,0,T);else if("flipbevel"===Bt){if(ct>100)it=N.mult(-1);else{const bt=ct*B.add(N).mag()/B.sub(N).mag();it._perp()._mult(bt*(xt?-1:1))}this.addCurrentVertex(k,it,0,0,T),this.addCurrentVertex(k,it.mult(-1),0,0,T)}else if("bevel"===Bt||"fakeround"===Bt){const bt=-Math.sqrt(ct*ct-1),St=xt?bt:0,It=xt?0:bt;if(O&&this.addCurrentVertex(k,B,St,It,T),"fakeround"===Bt){const Et=Math.round(180*nt/Math.PI/20);for(let Pt=1;Pt<Et;Pt++){let Ft=Pt/Et;if(.5!==Ft){const be=Ft-.5;Ft+=Ft*be*(Ft-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*be*be+(.848013+K*(.215638*K-1.06021)))}const Zt=N.sub(B)._mult(Ft)._add(B)._unit()._mult(xt?-1:1);this.addHalfVertex(k,Zt.x,Zt.y,!1,xt,0,T)}}L&&this.addCurrentVertex(k,N,-St,-It,T)}else if("butt"===Bt)this.addCurrentVertex(k,it,0,0,T);else if("square"===Bt){const bt=O?1:-1;O||this.addCurrentVertex(k,it,bt,bt,T),this.addCurrentVertex(k,it,0,0,T),O&&this.addCurrentVertex(k,it,bt,bt,T)}else"round"===Bt&&(O&&(this.addCurrentVertex(k,B,0,0,T),this.addCurrentVertex(k,B,1,1,T,!0)),L&&(this.addCurrentVertex(k,N,-1,-1,T,!0),this.addCurrentVertex(k,N,0,0,T)));if(vt&&X<b-1){const bt=k.dist(L);if(bt>2*S){const St=k.add(L.sub(k)._mult(S/bt)._round());this.updateDistance(k,St),this.addCurrentVertex(St,N,0,0,T),k=St}}}}addCurrentVertex(t,i,s,h,f,g=!1){const y=i.y*h-i.x,b=-i.y-i.x*h;this.addHalfVertex(t,i.x+i.y*s,i.y-i.x*s,g,!1,s,f),this.addHalfVertex(t,y,b,g,!0,-h,f)}addHalfVertex({x:t,y:i},s,h,f,g,y,b){this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(i<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(0===y?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),g?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}Jt(zl,"LineBucket",{omit:["layers","patternFeatures"]});const mh=new At({"line-cap":new dt(Ct.layout_line["line-cap"]),"line-join":new dt(Ct.layout_line["line-join"]),"line-miter-limit":new rt(Ct.layout_line["line-miter-limit"]),"line-round-limit":new rt(Ct.layout_line["line-round-limit"]),"line-sort-key":new dt(Ct.layout_line["line-sort-key"])});var Rm={paint:new At({"line-opacity":new dt(Ct.paint_line["line-opacity"]),"line-color":new dt(Ct.paint_line["line-color"]),"line-translate":new rt(Ct.paint_line["line-translate"]),"line-translate-anchor":new rt(Ct.paint_line["line-translate-anchor"]),"line-width":new dt(Ct.paint_line["line-width"]),"line-gap-width":new dt(Ct.paint_line["line-gap-width"]),"line-offset":new dt(Ct.paint_line["line-offset"]),"line-blur":new dt(Ct.paint_line["line-blur"]),"line-dasharray":new _t(Ct.paint_line["line-dasharray"]),"line-pattern":new _t(Ct.paint_line["line-pattern"]),"line-gradient":new mt(Ct.paint_line["line-gradient"]),"line-trim-offset":new rt(Ct.paint_line["line-trim-offset"])}),layout:mh};const zm=new class extends dt{possiblyEvaluate(n,t){return t=new H(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(n,t)}evaluate(n,t,i,s){return t=Ve({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(n,t,i,s)}}(Rm.paint.properties["line-width"].specification);function jp(n,t){return t>0?t+2*n:n}zm.useIntegerZoom=!0;const Bm=Tt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hp=Tt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gh=Tt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Tt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qp=Tt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),_h=Tt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Tt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vm=Tt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Kg=Tt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Tt([{name:"triangle",components:3,type:"Uint16"}]),Tt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Tt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Tt([{type:"Float32",name:"offsetX"}]),Tt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const zo=128;function Ad(n,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new H(n+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:h}=i;let f=0;for(;f<s.length&&s[f]<=n;)f++;f=Math.max(0,f-1);let g=f;for(;g<s.length&&s[g]<n+1;)g++;g=Math.min(s.length-1,g);const y=s[f],b=s[g];return"composite"===i.kind?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:y,maxZoom:b,minSize:i.evaluate(new H(y)),maxSize:i.evaluate(new H(b)),interpolationType:h}}}function Sd(n,{uSize:t,uSizeT:i},{lowerSize:s,upperSize:h}){return"source"===n.kind?s/zo:"composite"===n.kind?Oe(s/zo,h/zo,i):t}function Zc(n,t){let i=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:h,minZoom:f,maxZoom:g}=n,y=h?ye(pi.interpolationFactor(h,t,f,g),0,1):0;"camera"===n.kind?s=Oe(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:s}}var Qg=Object.freeze({__proto__:null,getSizeData:Ad,evaluateSizeForFeature:Sd,evaluateSizeForZoom:Zc,SIZE_PACK_FACTOR:zo});function t_(n,t,i){return n.sections.forEach(s=>{s.text=function(h,f,g){const y=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===y?h=h.toLocaleUpperCase():"lowercase"===y&&(h=h.toLocaleLowerCase()),j.applyArabicShaping&&(h=j.applyArabicShaping(h)),h}(s.text,t,i)}),n}const yh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function e_(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function i_(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Gm=function(n,t,i,s,h){var f,g,y=8*h-s-1,b=(1<<y)-1,w=b>>1,S=-7,T=i?h-1:0,k=i?-1:1,O=n[t+T];for(T+=k,f=O&(1<<-S)-1,O>>=-S,S+=y;S>0;f=256*f+n[t+T],T+=k,S-=8);for(g=f&(1<<-S)-1,f>>=-S,S+=s;S>0;g=256*g+n[t+T],T+=k,S-=8);if(0===f)f=1-w;else{if(f===b)return g?NaN:1/0*(O?-1:1);g+=Math.pow(2,s),f-=w}return(O?-1:1)*g*Math.pow(2,f-s)},Zp=function(n,t,i,s,h,f){var g,y,b,w=8*f-h-1,S=(1<<w)-1,T=S>>1,k=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,O=s?0:f-1,L=s?1:-1,B=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,g=S):(g=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-g))<1&&(g--,b*=2),(t+=g+T>=1?k/b:k*Math.pow(2,1-T))*b>=2&&(g++,b/=2),g+T>=S?(y=0,g=S):g+T>=1?(y=(t*b-1)*Math.pow(2,h),g+=T):(y=t*Math.pow(2,T-1)*Math.pow(2,h),g=0));h>=8;n[i+O]=255&y,O+=L,y/=256,h-=8);for(g=g<<h|y,w+=h;w>0;n[i+O]=255&g,O+=L,g/=256,w-=8);n[i+O-L]|=128*B},xh=ri;function ri(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}ri.Varint=0,ri.Fixed64=1,ri.Bytes=2,ri.Fixed32=5;var $p=4294967296,Nm=1/$p,vh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function xs(n){return n.type===ri.Bytes?n.readVarint()+n.pos:n.pos+1}function Um(n,t,i){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(s);for(var h=i.pos-1;h>=n;h--)i.buf[h+s]=i.buf[h]}function n_(n,t){for(var i=0;i<n.length;i++)t.writeVarint(n[i])}function r_(n,t){for(var i=0;i<n.length;i++)t.writeSVarint(n[i])}function o_(n,t){for(var i=0;i<n.length;i++)t.writeFloat(n[i])}function s_(n,t){for(var i=0;i<n.length;i++)t.writeDouble(n[i])}function a_(n,t){for(var i=0;i<n.length;i++)t.writeBoolean(n[i])}function l_(n,t){for(var i=0;i<n.length;i++)t.writeFixed32(n[i])}function c_(n,t){for(var i=0;i<n.length;i++)t.writeSFixed32(n[i])}function u_(n,t){for(var i=0;i<n.length;i++)t.writeFixed64(n[i])}function h_(n,t){for(var i=0;i<n.length;i++)t.writeSFixed64(n[i])}function Ed(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Yc(n,t,i){n[i]=t,n[i+1]=t>>>8,n[i+2]=t>>>16,n[i+3]=t>>>24}function jm(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}function d_(n,t,i){t.glyphs=[],1===n&&i.readMessage(p_,t)}function p_(n,t,i){if(3===n){const{id:s,bitmap:h,width:f,height:g,left:y,top:b,advance:w}=i.readMessage(f_,{});t.glyphs.push({id:s,bitmap:new Po({width:f+6,height:g+6},h),metrics:{width:f,height:g,left:y,top:b,advance:w}})}else 4===n?t.ascender=i.readSVarint():5===n&&(t.descender=i.readSVarint())}function f_(n,t,i){1===n?t.id=i.readVarint():2===n?t.bitmap=i.readBytes():3===n?t.width=i.readVarint():4===n?t.height=i.readVarint():5===n?t.left=i.readSVarint():6===n?t.top=i.readSVarint():7===n&&(t.advance=i.readVarint())}function Yp(n){let t=0,i=0;for(const g of n)t+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,y)=>y.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,f=0;for(const g of n)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,f=Math.max(f,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===b.w&&g.h===b.h){const w=s.pop();y<s.length&&(s[y]=w)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(s.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:h,h:f,fill:t/(h*f)||0}}ri.prototype={destroy:function(){this.buf=null},readFields:function(n,t,i){for(i=i||this.length;this.pos<i;){var s=this.readVarint(),h=s>>3,f=this.pos;this.type=7&s,n(h,t,this),this.pos===f&&this.skip(s)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=Ed(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=jm(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Ed(this.buf,this.pos)+Ed(this.buf,this.pos+4)*$p;return this.pos+=8,n},readSFixed64:function(){var n=Ed(this.buf,this.pos)+jm(this.buf,this.pos+4)*$p;return this.pos+=8,n},readFloat:function(){var n=Gm(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Gm(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,i,s=this.buf;return t=127&(i=s[this.pos++]),i<128?t:(t|=(127&(i=s[this.pos++]))<<7,i<128?t:(t|=(127&(i=s[this.pos++]))<<14,i<128?t:(t|=(127&(i=s[this.pos++]))<<21,i<128?t:function(h,f,g){var y,b,w=g.buf;if(y=(112&(b=w[g.pos++]))>>4,b<128||(y|=(127&(b=w[g.pos++]))<<3,b<128)||(y|=(127&(b=w[g.pos++]))<<10,b<128)||(y|=(127&(b=w[g.pos++]))<<17,b<128)||(y|=(127&(b=w[g.pos++]))<<24,b<128)||(y|=(1&(b=w[g.pos++]))<<31,b<128))return function $c(n,t,i){return i?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}(h,y,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&vh?vh.decode(this.buf.subarray(t,n)):function(i,s,h){for(var f="",g=s;g<h;){var y,b,w,S=i[g],T=null,k=S>239?4:S>223?3:S>191?2:1;if(g+k>h)break;1===k?S<128&&(T=S):2===k?128==(192&(y=i[g+1]))&&(T=(31&S)<<6|63&y)<=127&&(T=null):3===k?(b=i[g+2],128==(192&(y=i[g+1]))&&128==(192&b)&&((T=(15&S)<<12|(63&y)<<6|63&b)<=2047||T>=55296&&T<=57343)&&(T=null)):4===k&&(b=i[g+2],w=i[g+3],128==(192&(y=i[g+1]))&&128==(192&b)&&128==(192&w)&&((T=(15&S)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||T>=1114112)&&(T=null)),null===T?(T=65533,k=1):T>65535&&(T-=65536,f+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),f+=String.fromCharCode(T),g+=k}return f}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==ri.Bytes)return n.push(this.readVarint(t));var i=xs(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==ri.Bytes)return n.push(this.readSVarint());var t=xs(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==ri.Bytes)return n.push(this.readBoolean());var t=xs(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==ri.Bytes)return n.push(this.readFloat());var t=xs(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==ri.Bytes)return n.push(this.readDouble());var t=xs(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==ri.Bytes)return n.push(this.readFixed32());var t=xs(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==ri.Bytes)return n.push(this.readSFixed32());var t=xs(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==ri.Bytes)return n.push(this.readFixed64());var t=xs(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==ri.Bytes)return n.push(this.readSFixed64());var t=xs(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===ri.Varint)for(;this.buf[this.pos++]>127;);else if(t===ri.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ri.Fixed32)this.pos+=4;else{if(t!==ri.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Yc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Yc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Yc(this.buf,-1&n,this.pos),Yc(this.buf,Math.floor(n*Nm),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Yc(this.buf,-1&n,this.pos),Yc(this.buf,Math.floor(n*Nm),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,i){var s,h,f,y;if(t>=0?(s=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,h=h+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),f=s,(y=i).buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7),function(f,g){var y=(7&f)<<4;g.buf[g.pos++]|=y|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(h,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(s,h,f){for(var g,y,b=0;b<h.length;b++){if((g=h.charCodeAt(b))>55295&&g<57344){if(!y){g>56319||b+1===h.length?(s[f++]=239,s[f++]=191,s[f++]=189):y=g;continue}if(g<56320){s[f++]=239,s[f++]=191,s[f++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(s[f++]=239,s[f++]=191,s[f++]=189,y=null);g<128?s[f++]=g:(g<2048?s[f++]=g>>6|192:(g<65536?s[f++]=g>>12|224:(s[f++]=g>>18|240,s[f++]=g>>12&63|128),s[f++]=g>>6&63|128),s[f++]=63&g|128)}return f}(this.buf,n,this.pos);var i=this.pos-t;i>=128&&Um(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),Zp(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Zp(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,t){this.pos++;var i=this.pos;n(t,this);var s=this.pos-i;s>=128&&Um(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,t,i){this.writeTag(n,ri.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,n_,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,r_,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,a_,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,o_,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,s_,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,l_,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,c_,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,u_,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,h_,t)},writeBytesField:function(n,t){this.writeTag(n,ri.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,ri.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,ri.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,ri.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,ri.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,ri.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,ri.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,ri.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,ri.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,ri.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,Boolean(t))}};class Wp{constructor(t,{pixelRatio:i,version:s,stretchX:h,stretchY:f,content:g}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=h,this.stretchY=f,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hm{constructor(t,i){const s={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,s,f),this.addImages(i,h,f);const{w:g,h:y}=Yp(f),b=new Ln({width:g||1,height:y||1});for(const w in t){const S=t[w],T=s[w].paddedRect;Ln.copy(S.data,b,{x:0,y:0},{x:T.x+1,y:T.y+1},S.data)}for(const w in i){const S=i[w],T=h[w].paddedRect,k=T.x+1,O=T.y+1,L=S.data.width,B=S.data.height;Ln.copy(S.data,b,{x:0,y:0},{x:k,y:O},S.data),Ln.copy(S.data,b,{x:0,y:B-1},{x:k,y:O-1},{width:L,height:1}),Ln.copy(S.data,b,{x:0,y:0},{x:k,y:O+B},{width:L,height:1}),Ln.copy(S.data,b,{x:L-1,y:0},{x:k-1,y:O},{width:1,height:B}),Ln.copy(S.data,b,{x:0,y:0},{x:k+L,y:O},{width:1,height:B})}this.image=b,this.iconPositions=s,this.patternPositions=h}addImages(t,i,s){for(const h in t){const f=t[h],g={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(g),i[h]=new Wp(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>t.hasImage(s)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),i),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),i)}patchUpdatedImage(t,i,s){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,f]=t.tl;s.update(i.data,void 0,{x:h,y:f})}}Jt(Wp,"ImagePosition"),Jt(Hm,"ImageAtlas");const cr={horizontal:1,vertical:2,horizontalOnly:3};class bh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const s=new bh;return s.scale=t||1,s.fontStack=i,s}static forImage(t){const i=new bh;return i.imageName=t,i}}class Wc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const s=new Wc;for(let h=0;h<t.sections.length;h++){const f=t.sections[h];f.image?s.addImageSection(f):s.addTextSection(f,i)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(i,s){let h="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,y=i.charCodeAt(f-1)||null;h+=!s&&(g&&ua(g)&&!yh[i[f+1]]||y&&ua(y)&&!yh[i[f-1]])||!yh[i[f]]?i[f]:yh[i[f]]}return h}(this.text,t)}trim(){let t=0;for(let s=0;s<this.text.length&&wh[this.text.charCodeAt(s)];s++)t++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&wh[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const s=new Wc;return s.text=this.text.substring(t,i),s.sectionIndex=this.sectionIndex.slice(t,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(bh.forText(t.scale,t.fontStack||i));const s=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(s)}addImageSection(t){const i=t.image?t.image.name:"";if(0===i.length)return void hi("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(bh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):hi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Td(n,t,i,s,h,f,g,y,b,w,S,T,k,O,L,B){const N=Wc.fromFeature(n,h);let X;T===cr.vertical&&N.verticalizePunctuation(k);const{processBidirectionalText:it,processStyledBidirectionalText:K}=j;if(it&&1===N.sections.length){X=[];const nt=it(N.toString(),Xp(N,w,f,t,s,O,L));for(const vt of nt){const xt=new Wc;xt.text=vt,xt.sections=N.sections;for(let Mt=0;Mt<vt.length;Mt++)xt.sectionIndex.push(0);X.push(xt)}}else if(K){X=[];const nt=K(N.text,N.sectionIndex,Xp(N,w,f,t,s,O,L));for(const vt of nt){const xt=new Wc;xt.text=vt[0],xt.sectionIndex=vt[1],xt.sections=N.sections,X.push(xt)}}else X=function(nt,vt){const xt=[],Mt=nt.text;let Bt=0;for(const bt of vt)xt.push(nt.substring(Bt,bt)),Bt=bt;return Bt<Mt.length&&xt.push(nt.substring(Bt,Mt.length)),xt}(N,Xp(N,w,f,t,s,O,L));const tt=[],ct={positionedLines:tt,text:N.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(nt,vt,xt,Mt,Bt,bt,St,It,Et,Pt,Ft,Zt){let be=0,ge=0,ee=0;const Vt="right"===It?1:"left"===It?0:.5;let we=!1;for(const Ce of Bt){const Le=Ce.getSections();for(const ti of Le){if(ti.imageName)continue;const Ke=vt[ti.fontStack];if(Ke&&(we=void 0!==Ke.ascender&&void 0!==Ke.descender,!we))break}if(!we)break}let ue=0;for(const Ce of Bt){Ce.trim();const Le=Ce.getMaxScale(),ti=24*(Le-1),Ke={positionedGlyphs:[],lineOffset:0};nt.positionedLines[ue]=Ke;const $e=Ke.positionedGlyphs;let ci=0;if(!Ce.length()){ge+=bt,++ue;continue}let qe=0,ki=0;for(let ke=0;ke<Ce.length();ke++){const _i=Ce.getSection(ke),an=Ce.getSectionIndex(ke),Ue=Ce.getCharCode(ke);let mi=_i.scale,Wi=null,yi=null,Ai=null,Ui=24,Ri=0;const Xi=!(Et===cr.horizontal||!Ft&&!ca(Ue)||Ft&&(wh[Ue]||(Xt=Ue,Gu(Xt)||pn(Xt)||Yh(Xt)||la(Xt)||Tc(Xt))));if(_i.imageName){const ln=Mt[_i.imageName];if(!ln)continue;Ai=_i.imageName,nt.iconsInText=nt.iconsInText||!0,yi=ln.paddedRect;const ji=ln.displaySize;mi=24*mi/Zt,Wi={width:ji[0],height:ji[1],left:1,top:-3,advance:Xi?ji[1]:ji[0],localGlyph:!1},Ri=we?-Wi.height*mi:24*Le-17-ji[1]*mi,Ui=Wi.advance;const to=(Xi?ji[0]:ji[1])*mi-24*Le;to>0&&to>ci&&(ci=to)}else{const ln=xt[_i.fontStack];if(!ln)continue;ln[Ue]&&(yi=ln[Ue]);const ji=vt[_i.fontStack];if(!ji)continue;const to=ji.glyphs[Ue];if(!to)continue;if(Wi=to.metrics,Ui=8203!==Ue?24:0,we){const Ta=void 0!==ji.ascender?Math.abs(ji.ascender):0,ql=void 0!==ji.descender?Math.abs(ji.descender):0,Zl=(Ta+ql)*mi;qe<Zl&&(qe=Zl,ki=(Ta-ql)/2*mi),Ri=-Ta*mi}else Ri=24*(Le-mi)-17}Xi?(nt.verticalizable=!0,$e.push({glyph:Ue,imageName:Ai,x:be,y:ge+Ri,vertical:Xi,scale:mi,localGlyph:Wi.localGlyph,fontStack:_i.fontStack,sectionIndex:an,metrics:Wi,rect:yi}),be+=Ui*mi+Pt):($e.push({glyph:Ue,imageName:Ai,x:be,y:ge+Ri,vertical:Xi,scale:mi,localGlyph:Wi.localGlyph,fontStack:_i.fontStack,sectionIndex:an,metrics:Wi,rect:yi}),be+=Wi.advance*mi+Pt)}0!==$e.length&&(ee=Math.max(be-Pt,ee),we?Wm($e,Vt,ci,ki,bt*Le/2):Wm($e,Vt,ci,0,bt/2)),be=0;const fn=bt*Le+ci;Ke.lineOffset=Math.max(ci,ti),ge+=fn,++ue}var Xt;const Xe=ge,{horizontalAlign:Je,verticalAlign:oi}=Jp(St);(function(Ce,Le,ti,Ke,$e,ci){const qe=(Le-ti)*$e,ki=-ci*Ke;for(const fn of Ce)for(const ke of fn.positionedGlyphs)ke.x+=qe,ke.y+=ki})(nt.positionedLines,Vt,Je,oi,ee,Xe),nt.top+=-oi*Xe,nt.bottom=nt.top+Xe,nt.left+=-Je*ee,nt.right=nt.left+ee,nt.hasBaseline=we}(ct,t,i,s,X,g,y,b,T,w,k,B),!function(nt){for(const vt of nt)if(0!==vt.positionedGlyphs.length)return!1;return!0}(tt)&&ct}const wh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},m_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qm(n,t,i,s,h,f){if(t.imageName){const g=s[t.imageName];return g?g.displaySize[0]*t.scale*24/f+h:0}{const g=i[t.fontStack],y=g&&g.glyphs[n];return y?y.metrics.advance*t.scale+h:0}}function Zm(n,t,i,s){const h=Math.pow(n-t,2);return s?n<t?h/2:2*h:h+Math.abs(i)*i}function g_(n,t,i){let s=0;return 10===n&&(s-=1e4),i&&(s+=150),40!==n&&65288!==n||(s+=50),41!==t&&65289!==t||(s+=50),s}function $m(n,t,i,s,h,f){let g=null,y=Zm(t,i,h,f);for(const b of s){const w=Zm(t-b.x,i,h,f)+b.badness;w<=y&&(g=b,y=w)}return{index:n,x:t,priorBreak:g,badness:y}}function Ym(n){return n?Ym(n.priorBreak).concat(n.index):[]}function Xp(n,t,i,s,h,f,g){if("point"!==f)return[];if(!n)return[];const y=[],b=function(k,O,L,B,N,X){let it=0;for(let K=0;K<k.length();K++){const tt=k.getSection(K);it+=qm(k.getCharCode(K),tt,B,N,O,X)}return it/Math.max(1,Math.ceil(it/L))}(n,t,i,s,h,g),w=n.text.indexOf("\u200b")>=0;let S=0;for(let k=0;k<n.length();k++){const O=n.getSection(k),L=n.getCharCode(k);if(wh[L]||(S+=qm(L,O,s,h,t,g)),k<n.length()-1){const B=!((T=L)<11904||!(Cc(T)||Nu(T)||Ec(T)||Wh(T)||Ac(T)||Mo(T)||Uu(T)||xl(T)||Ao(T)||sa(T)||ju(T)||kc(T)||vl(T)||Hr(T)||yl(T)||Mc(T)||qn(T)||Sc(T)||Hu(T)||aa(T)));(m_[L]||B||O.imageName)&&y.push($m(k+1,S,b,y,g_(L,n.getCharCode(k+1),B&&w),!1))}}var T;return Ym($m(n.length(),S,b,y,0,!0))}function Jp(n){let t=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Wm(n,t,i,s,h){if(!(t||i||s||h))return;const f=n.length-1,g=n[f],y=(g.x+g.metrics.advance*g.scale)*t;for(let b=0;b<=f;b++)n[b].x-=y,n[b].y+=i+s+h}function __(n,t,i){const{horizontalAlign:s,verticalAlign:h}=Jp(i),f=t[0]-n.displaySize[0]*s,g=t[1]-n.displaySize[1]*h;return{image:n,top:g,bottom:g+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Xm(n,t,i,s,h,f){const g=n.image;let y;if(g.content){const N=g.content,X=g.pixelRatio||1;y=[N[0]/X,N[1]/X,g.displaySize[0]-N[2]/X,g.displaySize[1]-N[3]/X]}const b=t.left*f,w=t.right*f;let S,T,k,O;"width"===i||"both"===i?(O=h[0]+b-s[3],T=h[0]+w+s[1]):(O=h[0]+(b+w-g.displaySize[0])/2,T=O+g.displaySize[0]);const L=t.top*f,B=t.bottom*f;return"height"===i||"both"===i?(S=h[1]+L-s[0],k=h[1]+B+s[2]):(S=h[1]+(L+B-g.displaySize[1])/2,k=S+g.displaySize[1]),{image:g,top:S,right:T,bottom:k,left:O,collisionPadding:y}}class vs extends jt{constructor(t,i,s,h,f){super(t,i),this.angle=h,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new vs(this.x,this.y,this.z,this.angle,this.segment)}}function Jm(n,t,i,s,h){if(void 0===t.segment)return!0;let f=t,g=t.segment+1,y=0;for(;y>-i/2;){if(g--,g<0)return!1;y-=n[g].dist(f),f=n[g]}y+=n[g].dist(n[g+1]),g++;const b=[];let w=0;for(;y<i/2;){const S=n[g],T=n[g+1];if(!T)return!1;let k=n[g-1].angleTo(S)-S.angleTo(T);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:k}),w+=k;y-b[0].distance>s;)w-=b.shift().angleDelta;if(w>h)return!1;g++,y+=S.dist(T)}return!0}function Km(n){let t=0;for(let i=0;i<n.length-1;i++)t+=n[i].dist(n[i+1]);return t}function Qm(n,t,i){return n?.6*t*i:0}function tg(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function y_(n,t,i,s,h,f){const g=Qm(i,h,f),y=tg(i,s)*f;let b=0;const w=Km(n)/2;for(let S=0;S<n.length-1;S++){const T=n[S],k=n[S+1],O=T.dist(k);if(b+O>w){const L=(w-b)/O,B=Oe(T.x,k.x,L),N=Oe(T.y,k.y,L),X=new vs(B,N,0,k.angleTo(T),S);return!g||Jm(n,X,y,g,t)?X:void 0}b+=O}}function x_(n,t,i,s,h,f,g,y,b){const w=Qm(s,f,g),S=tg(s,h),T=S*g,k=0===n[0].x||n[0].x===b||0===n[0].y||n[0].y===b;return t-T<t/4&&(t=T+t/4),eg(n,k?t/2*y%t:(S/2+2*f)*g*y%t,t,w,i,T,k,!1,b)}function eg(n,t,i,s,h,f,g,y,b){const w=f/2,S=Km(n);let T=0,k=t-i,O=[];for(let L=0;L<n.length-1;L++){const B=n[L],N=n[L+1],X=B.dist(N),it=N.angleTo(B);for(;k+i<T+X;){k+=i;const K=(k-T)/X,tt=Oe(B.x,N.x,K),ct=Oe(B.y,N.y,K);if(tt>=0&&tt<b&&ct>=0&&ct<b&&k-w>=0&&k+w<=S){const nt=new vs(tt,ct,0,it,L);nt._round(),s&&!Jm(n,nt,f,s,h)||O.push(nt)}}T+=X}return y||O.length||g||(O=eg(n,T/2,i,s,h,f,g,!0,b)),O}function ig(n,t,i,s,h){const f=[];for(let g=0;g<n.length;g++){const y=n[g];let b;for(let w=0;w<y.length-1;w++){let S=y[w],T=y[w+1];S.x<t&&T.x<t||(S.x<t?S=new jt(t,S.y+(t-S.x)/(T.x-S.x)*(T.y-S.y))._round():T.x<t&&(T=new jt(t,S.y+(t-S.x)/(T.x-S.x)*(T.y-S.y))._round()),S.y<i&&T.y<i||(S.y<i?S=new jt(S.x+(i-S.y)/(T.y-S.y)*(T.x-S.x),i)._round():T.y<i&&(T=new jt(S.x+(i-S.y)/(T.y-S.y)*(T.x-S.x),i)._round()),S.x>=s&&T.x>=s||(S.x>=s?S=new jt(s,S.y+(s-S.x)/(T.x-S.x)*(T.y-S.y))._round():T.x>=s&&(T=new jt(s,S.y+(s-S.x)/(T.x-S.x)*(T.y-S.y))._round()),S.y>=h&&T.y>=h||(S.y>=h?S=new jt(S.x+(h-S.y)/(T.y-S.y)*(T.x-S.x),h)._round():T.y>=h&&(T=new jt(S.x+(h-S.y)/(T.y-S.y)*(T.x-S.x),h)._round()),b&&S.equals(b[b.length-1])||(b=[S],f.push(b)),b.push(T)))))}}return f}Jt(vs,"Anchor");const Ch=1e20;function ng(n,t,i,s,h,f,g,y,b){for(let w=t;w<t+s;w++)rg(n,i*f+w,f,h,g,y,b);for(let w=i;w<i+h;w++)rg(n,w*f+t,1,s,g,y,b)}function rg(n,t,i,s,h,f,g){f[0]=0,g[0]=-Ch,g[1]=Ch,h[0]=n[t];for(let y=1,b=0,w=0;y<s;y++){h[y]=n[t+y*i];const S=y*y;do{const T=f[b];w=(h[y]-h[T]+S-T*T)/(y-T)/2}while(w<=g[b]&&--b>-1);b++,f[b]=y,g[b]=w,g[b+1]=Ch}for(let y=0,b=0;y<s;y++){for(;g[b+1]<y;)b++;const w=f[b],S=y-w;n[t+y*i]=h[w]+S*S}}const Kp={none:0,ideographs:1,all:2};class Xc{constructor(t,i,s){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,i){const s=[];for(const h in t)for(const f of t[h])s.push({stack:h,id:f});Qi(s,({stack:h,id:f},g)=>{let y=this.entries[h];y||(y=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[f];if(void 0!==b)return void g(null,{stack:h,id:f,glyph:b});if(b=this._tinySDF(y,h,f),b)return y.glyphs[f]=b,void g(null,{stack:h,id:f,glyph:b});const w=Math.floor(f/256);if(256*w>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void g(null,{stack:h,id:f,glyph:b});let S=y.requests[w];S||(S=y.requests[w]=[],Xc.loadGlyphRange(h,w,this.url,this.requestManager,(T,k)=>{if(k){y.ascender=k.ascender,y.descender=k.descender;for(const O in k.glyphs)this._doesCharSupportLocalGlyph(+O)||(y.glyphs[+O]=k.glyphs[+O]);y.ranges[w]=!0}for(const O of S)O(T,k);delete y.requests[w]})),S.push((T,k)=>{T?g(T):k&&g(null,{stack:h,id:f,glyph:k.glyphs[f]||null})})},(h,f)=>{if(h)i(h);else if(f){const g={};for(const{stack:y,id:b,glyph:w}of f)void 0===g[y]&&(g[y]={}),void 0===g[y].glyphs&&(g[y].glyphs={}),g[y].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;i(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Kp.none&&(this.localGlyphMode===Kp.all?!!this.localFontFamily:!!this.localFontFamily&&(sa(t)||qu(t)||vl(t)||qn(t)||xl(t)))}_tinySDF(t,i,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let f=t.tinySDF;if(!f){let B="400";/bold/i.test(i)?B="900":/medium/i.test(i)?B="500":/light/i.test(i)&&(B="200"),f=t.tinySDF=new Xc.TinySDF({fontFamily:h,fontWeight:B,fontSize:48,buffer:6,radius:16}),f.fontWeight=B}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const g=String.fromCharCode(s),{data:y,width:b,height:w,glyphWidth:S,glyphHeight:T,glyphLeft:k,glyphTop:O,glyphAdvance:L}=f.draw(g);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new Po({width:b,height:w},y),metrics:{width:S/2,height:T/2,left:k/2,top:O/2-27,advance:L/2,localGlyph:!0}}}}function og(n,t,i,s){const h=[],f=n.image,g=f.pixelRatio,y=f.paddedRect.w-2,b=f.paddedRect.h-2,w=n.right-n.left,S=n.bottom-n.top,T=f.stretchX||[[0,y]],k=f.stretchY||[[0,b]],O=(bt,St)=>bt+St[1]-St[0],L=T.reduce(O,0),B=k.reduce(O,0),N=y-L,X=b-B;let it=0,K=L,tt=0,ct=B,nt=0,vt=N,xt=0,Mt=X;if(f.content&&s){const bt=f.content;it=kd(T,0,bt[0]),tt=kd(k,0,bt[1]),K=kd(T,bt[0],bt[2]),ct=kd(k,bt[1],bt[3]),nt=bt[0]-it,xt=bt[1]-tt,vt=bt[2]-bt[0]-K,Mt=bt[3]-bt[1]-ct}const Bt=(bt,St,It,Et)=>{const Pt=Dd(bt.stretch-it,K,w,n.left),Ft=Id(bt.fixed-nt,vt,bt.stretch,L),Zt=Dd(St.stretch-tt,ct,S,n.top),be=Id(St.fixed-xt,Mt,St.stretch,B),ge=Dd(It.stretch-it,K,w,n.left),ee=Id(It.fixed-nt,vt,It.stretch,L),Vt=Dd(Et.stretch-tt,ct,S,n.top),we=Id(Et.fixed-xt,Mt,Et.stretch,B),ue=new jt(Pt,Zt),Xt=new jt(ge,Zt),Xe=new jt(ge,Vt),Je=new jt(Pt,Vt),oi=new jt(Ft/g,be/g),Ce=new jt(ee/g,we/g),Le=t*Math.PI/180;if(Le){const $e=Math.sin(Le),ci=Math.cos(Le),qe=[ci,-$e,$e,ci];ue._matMult(qe),Xt._matMult(qe),Je._matMult(qe),Xe._matMult(qe)}const ti=bt.stretch+bt.fixed,Ke=St.stretch+St.fixed;return{tl:ue,tr:Xt,bl:Je,br:Xe,tex:{x:f.paddedRect.x+1+ti,y:f.paddedRect.y+1+Ke,w:It.stretch+It.fixed-ti,h:Et.stretch+Et.fixed-Ke},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:oi,pixelOffsetBR:Ce,minFontScaleX:vt/g/w,minFontScaleY:Mt/g/S,isSDF:i}};if(s&&(f.stretchX||f.stretchY)){const bt=sg(T,N,L),St=sg(k,X,B);for(let It=0;It<bt.length-1;It++){const Et=bt[It],Pt=bt[It+1];for(let Ft=0;Ft<St.length-1;Ft++)h.push(Bt(Et,St[Ft],Pt,St[Ft+1]))}}else h.push(Bt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return h}function kd(n,t,i){let s=0;for(const h of n)s+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return s}function sg(n,t,i){const s=[{fixed:-1,stretch:0}];for(const[h,f]of n){const g=s[s.length-1];s.push({fixed:h-g.stretch,stretch:g.stretch}),s.push({fixed:h-g.stretch,stretch:g.stretch+(f-h)})}return s.push({fixed:t+1,stretch:i}),s}function Dd(n,t,i,s){return n/t*i+s}function Id(n,t,i,s){return n-t*i/s}function v_(n,t,i,s){const h=t+n.positionedLines[s].lineOffset;return 0===s?i+h/2:i+(h+(t+n.positionedLines[s-1].lineOffset))/2}Xc.loadGlyphRange=function(n,t,i,s,h){const f=256*t,g=f+255,y=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${f}-${g}`),ut.Glyphs);gt(y,(b,w)=>{if(b)h(b);else if(w){const S={},T=new xh(w).readFields(d_,{});for(const k of T.glyphs)S[k.id]=k;h(null,{glyphs:S,ascender:T.ascender,descender:T.descender})}})},Xc.TinySDF=class{constructor({fontSize:n=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=i;const y=this.size=n+4*t,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${g} ${f} ${n}px ${h}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const t=document.createElement("canvas");return t.width=t.height=n,t}draw(n){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(n),g=Math.ceil(i),y=Math.min(this.size-this.buffer,Math.ceil(f-h)),b=Math.min(this.size-this.buffer,g+Math.ceil(s)),w=y+2*this.buffer,S=b+2*this.buffer,T=Math.max(w*S,0),k=new Uint8ClampedArray(T),O={data:k,width:w,height:S,glyphWidth:y,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(0===y||0===b)return O;const{ctx:L,buffer:B,gridInner:N,gridOuter:X}=this;L.clearRect(B,B,y,b),L.fillText(n,B,B+g);const it=L.getImageData(B,B,y,b);X.fill(Ch,0,T),N.fill(0,0,T);for(let K=0;K<b;K++)for(let tt=0;tt<y;tt++){const ct=it.data[4*(K*y+tt)+3]/255;if(0===ct)continue;const nt=(K+B)*w+tt+B;if(1===ct)X[nt]=0,N[nt]=Ch;else{const vt=.5-ct;X[nt]=vt>0?vt*vt:0,N[nt]=vt<0?vt*vt:0}}ng(X,0,0,w,S,w,this.f,this.v,this.z),ng(N,B,B,y,b,w,this.f,this.v,this.z);for(let K=0;K<T;K++){const tt=Math.sqrt(X[K])-Math.sqrt(N[K]);k[K]=Math.round(255-255*(tt/this.radius+this.cutoff))}return O}};class b_{constructor(t=[],i=w_){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:s}=this,h=i[t];for(;t>0;){const f=t-1>>1,g=i[f];if(s(h,g)>=0)break;i[t]=g,t=f}i[t]=h}_down(t){const{data:i,compare:s}=this,h=this.length>>1,f=i[t];for(;t<h;){let g=1+(t<<1),y=i[g];const b=g+1;if(b<this.length&&s(i[b],y)<0&&(g=b,y=i[b]),s(y,f)>=0)break;i[t]=y,t=g}i[t]=f}}function w_(n,t){return n<t?-1:n>t?1:0}function C_(n,t=1,i=!1){let s=1/0,h=1/0,f=-1/0,g=-1/0;const y=n[0];for(let O=0;O<y.length;O++){const L=y[O];(!O||L.x<s)&&(s=L.x),(!O||L.y<h)&&(h=L.y),(!O||L.x>f)&&(f=L.x),(!O||L.y>g)&&(g=L.y)}const b=Math.min(f-s,g-h);let w=b/2;const S=new b_([],M_);if(0===b)return new jt(s,h);for(let O=s;O<f;O+=b)for(let L=h;L<g;L+=b)S.push(new Jc(O+w,L+w,w,n));let T=function(O){let L=0,B=0,N=0;const X=O[0];for(let it=0,K=X.length,tt=K-1;it<K;tt=it++){const ct=X[it],nt=X[tt],vt=ct.x*nt.y-nt.x*ct.y;B+=(ct.x+nt.x)*vt,N+=(ct.y+nt.y)*vt,L+=3*vt}return new Jc(B/L,N/L,0,O)}(n),k=S.length;for(;S.length;){const O=S.pop();(O.d>T.d||!T.d)&&(T=O,i&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,k)),O.max-T.d<=t||(w=O.h/2,S.push(new Jc(O.p.x-w,O.p.y-w,w,n)),S.push(new Jc(O.p.x+w,O.p.y-w,w,n)),S.push(new Jc(O.p.x-w,O.p.y+w,w,n)),S.push(new Jc(O.p.x+w,O.p.y+w,w,n)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${T.d}`)),T.p}function M_(n,t){return t.max-n.max}function Jc(n,t,i,s){this.p=new jt(n,t),this.h=i,this.d=function(h,f){let g=!1,y=1/0;for(let b=0;b<f.length;b++){const w=f[b];for(let S=0,T=w.length,k=T-1;S<T;k=S++){const O=w[S],L=w[k];O.y>h.y!=L.y>h.y&&h.x<(L.x-O.x)*(h.y-O.y)/(L.y-O.y)+O.x&&(g=!g),y=Math.min(y,fp(h,O,L))}}return(g?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Qp=Number.POSITIVE_INFINITY,A_=Math.sqrt(2);function ag(n,t){return t[1]!==Qp?function(i,s,h){let f=0,g=0;switch(s=Math.abs(s),h=Math.abs(h),i){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(i){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,g]}(n,t[0],t[1]):function(i,s){let h=0,f=0;s<0&&(s=0);const g=s/A_;switch(i){case"top-right":case"top-left":f=g-7;break;case"bottom-right":case"bottom-left":f=7-g;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(i){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=s;break;case"right":h=-s}return[h,f]}(n,t[0])}function S_(n,t,i,s,h,f,g,y,b,w){n.createArrays(),n.tilePixelRatio=ce/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const S=n.layers[0].layout,T=n.layers[0]._unevaluatedLayout._values,k={};if("composite"===n.textSizeData.kind){const{minZoom:B,maxZoom:N}=n.textSizeData;k.compositeTextSizes=[T["text-size"].possiblyEvaluate(new H(B),y),T["text-size"].possiblyEvaluate(new H(N),y)]}if("composite"===n.iconSizeData.kind){const{minZoom:B,maxZoom:N}=n.iconSizeData;k.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new H(B),y),T["icon-size"].possiblyEvaluate(new H(N),y)]}k.layoutTextSize=T["text-size"].possiblyEvaluate(new H(b+1),y),k.layoutIconSize=T["icon-size"].possiblyEvaluate(new H(b+1),y),k.textMaxSize=T["text-size"].possiblyEvaluate(new H(18),y);const O="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),L=S.get("text-size");for(const B of n.features){const N=S.get("text-font").evaluate(B,{},y).join(","),X=L.evaluate(B,{},y),it=k.layoutTextSize.evaluate(B,{},y),K=(k.layoutIconSize.evaluate(B,{},y),{horizontal:{},vertical:void 0}),tt=B.text;let ct,nt=[0,0];if(tt){const Mt=tt.toString(),Bt=24*S.get("text-letter-spacing").evaluate(B,{},y),bt=24*S.get("text-line-height").evaluate(B,{},y),St=Xh(Mt)?Bt:0,It=S.get("text-anchor").evaluate(B,{},y),Et=S.get("text-variable-anchor");if(!Et){const ee=S.get("text-radial-offset").evaluate(B,{},y);nt=ee?ag(It,[24*ee,Qp]):S.get("text-offset").evaluate(B,{},y).map(Vt=>24*Vt)}let Pt=O?"center":S.get("text-justify").evaluate(B,{},y);const Ft=S.get("symbol-placement"),Zt="point"===Ft,be="point"===Ft?24*S.get("text-max-width").evaluate(B,{},y):0,ge=ee=>{n.allowVerticalPlacement&&So(Mt)&&(K.vertical=Td(tt,t,i,h,N,be,bt,It,ee,St,nt,cr.vertical,!0,Ft,it,X))};if(!O&&Et){const ee="auto"===Pt?Et.map(we=>tf(we)):[Pt];let Vt=!1;for(let we=0;we<ee.length;we++){const ue=ee[we];if(!K.horizontal[ue])if(Vt)K.horizontal[ue]=K.horizontal[0];else{const Xt=Td(tt,t,i,h,N,be,bt,"center",ue,St,nt,cr.horizontal,!1,Ft,it,X);Xt&&(K.horizontal[ue]=Xt,Vt=1===Xt.positionedLines.length)}}ge("left")}else{if("auto"===Pt&&(Pt=tf(It)),Zt||S.get("text-writing-mode").indexOf("horizontal")>=0||!So(Mt)){const ee=Td(tt,t,i,h,N,be,bt,It,Pt,St,nt,cr.horizontal,!1,Ft,it,X);ee&&(K.horizontal[Pt]=ee)}ge("point"===Ft?"left":Pt)}}let vt=!1;if(B.icon&&B.icon.name){const Mt=s[B.icon.name];Mt&&(ct=__(h[B.icon.name],S.get("icon-offset").evaluate(B,{},y),S.get("icon-anchor").evaluate(B,{},y)),vt=Mt.sdf,void 0===n.sdfIcons?n.sdfIcons=Mt.sdf:n.sdfIcons!==Mt.sdf&&hi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Mt.pixelRatio!==n.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const xt=cg(K.horizontal)||K.vertical;n.iconsInText||(n.iconsInText=!!xt&&xt.iconsInText),(xt||ct)&&E_(n,B,K,ct,s,k,it,0,nt,vt,g,y,w)}f&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)}function tf(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function E_(n,t,i,s,h,f,g,y,b,w,S,T,k){let O=f.textMaxSize.evaluate(t,{},T);void 0===O&&(O=g);const L=n.layers[0].layout,B=L.get("icon-offset").evaluate(t,{},T),N=cg(i.horizontal)||i.vertical,X="globe"===k.name,it=g/24,K=n.tilePixelRatio*O/24,tt=(St=n.overscaling,n.zoom>18&&St>2&&(St>>=1),Math.max(ce/(512*St),1)*L.get("symbol-spacing")),ct=L.get("text-padding")*n.tilePixelRatio,nt=L.get("icon-padding")*n.tilePixelRatio,vt=_e(L.get("text-max-angle")),xt="map"===L.get("text-rotation-alignment")&&"point"!==L.get("symbol-placement"),Mt="map"===L.get("icon-rotation-alignment")&&"point"!==L.get("symbol-placement"),Bt=L.get("symbol-placement"),bt=tt/2;var St;const It=L.get("icon-text-fit");let Et;s&&"none"!==It&&(n.allowVerticalPlacement&&i.vertical&&(Et=Xm(s,i.vertical,It,L.get("icon-text-fit-padding"),B,it)),N&&(s=Xm(s,N,It,L.get("icon-text-fit-padding"),B,it)));const Pt=(Ft,Zt,be)=>{if(Zt.x<0||Zt.x>=ce||Zt.y<0||Zt.y>=ce)return;let ge=null;if(X){const{x:ee,y:Vt,z:we}=k.projectTilePoint(Zt.x,Zt.y,be);ge={anchor:new vs(ee,Vt,we,0,void 0),up:k.upVector(be,Zt.x,Zt.y)}}!function(ee,Vt,we,ue,Xt,Xe,Je,oi,Ce,Le,ti,Ke,$e,ci,qe,ki,fn,ke,_i,an,Ue,mi,Wi,yi,Ai){const Ui=ee.addToLineVertexArray(Vt,ue);let Ri,Xi,ln,ji,to,Ta,ql,Zl=0,Lf=0,Pf=0,Rf=0,$l=-1,zf=-1;const Ir={};let pe=Dc("");const ka=we?we.anchor:Vt;let qd=0,Bf=0;if(void 0===Ce._unevaluatedLayout.getValue("text-radial-offset")?[qd,Bf]=Ce.layout.get("text-offset").evaluate(Ue,{},Ai).map(Rn=>24*Rn):(qd=24*Ce.layout.get("text-radial-offset").evaluate(Ue,{},Ai),Bf=Qp),ee.allowVerticalPlacement&&Xt.vertical){const Rn=Xt.vertical;if(qe)Ta=ef(Rn),oi&&(ql=ef(oi));else{const zn=Ce.layout.get("text-rotate").evaluate(Ue,{},Ai)+90;ln=Fd(Le,ka,Vt,ti,Ke,$e,Rn,ci,zn,ki),oi&&(ji=Fd(Le,ka,Vt,ti,Ke,$e,oi,ke,zn))}}if(Xe){const Rn=Ce.layout.get("icon-rotate").evaluate(Ue,{},Ai),zn="none"!==Ce.layout.get("icon-text-fit"),Yl=og(Xe,Rn,Wi,zn),Rh=oi?og(oi,Rn,Wi,zn):void 0;Xi=Fd(Le,ka,Vt,ti,Ke,$e,Xe,ke,Rn),Zl=4*Yl.length;const Gf=ee.iconSizeData;let Da=null;"source"===Gf.kind?(Da=[zo*Ce.layout.get("icon-size").evaluate(Ue,{},Ai)],Da[0]>va&&hi(`${ee.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Gf.kind&&(Da=[zo*mi.compositeIconSizes[0].evaluate(Ue,{},Ai),zo*mi.compositeIconSizes[1].evaluate(Ue,{},Ai)],(Da[0]>va||Da[1]>va)&&hi(`${ee.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ee.addSymbols(ee.icon,Yl,Da,an,_i,Ue,!1,we,Vt,Ui.lineStartIndex,Ui.lineLength,-1,yi,Ai),$l=ee.icon.placedSymbolArray.length-1,Rh&&(Lf=4*Rh.length,ee.addSymbols(ee.icon,Rh,Da,an,_i,Ue,cr.vertical,we,Vt,Ui.lineStartIndex,Ui.lineLength,-1,yi,Ai),zf=ee.icon.placedSymbolArray.length-1)}for(const Rn in Xt.horizontal){const zn=Xt.horizontal[Rn];Ri||(pe=Dc(zn.text),qe?to=ef(zn):Ri=Fd(Le,ka,Vt,ti,Ke,$e,zn,ci,Ce.layout.get("text-rotate").evaluate(Ue,{},Ai),ki));const Yl=1===zn.positionedLines.length;if(Pf+=lg(ee,we,Vt,zn,Je,Ce,qe,Ue,ki,Ui,Xt.vertical?cr.horizontal:cr.horizontalOnly,Yl?Object.keys(Xt.horizontal):[Rn],Ir,$l,mi,yi,Ai),Yl)break}Xt.vertical&&(Rf+=lg(ee,we,Vt,Xt.vertical,Je,Ce,qe,Ue,ki,Ui,cr.vertical,["vertical"],Ir,zf,mi,yi,Ai));let Vo=-1;const Ss=(Rn,zn)=>Rn?Math.max(Rn,zn):zn;Vo=Ss(to,Vo),Vo=Ss(Ta,Vo),Vo=Ss(ql,Vo);const Vf=Vo>-1?1:0;ee.glyphOffsetArray.length>=Ma.MAX_GLYPHS&&hi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ue.sortKey&&ee.addToSortKeyRanges(ee.symbolInstances.length,Ue.sortKey),ee.symbolInstances.emplaceBack(ka.x,ka.y,ka.z,Vt.x,Vt.y,Ir.right>=0?Ir.right:-1,Ir.center>=0?Ir.center:-1,Ir.left>=0?Ir.left:-1,Ir.vertical>=0?Ir.vertical:-1,$l,zf,pe,void 0!==Ri?Ri:ee.collisionBoxArray.length,void 0!==Ri?Ri+1:ee.collisionBoxArray.length,void 0!==ln?ln:ee.collisionBoxArray.length,void 0!==ln?ln+1:ee.collisionBoxArray.length,void 0!==Xi?Xi:ee.collisionBoxArray.length,void 0!==Xi?Xi+1:ee.collisionBoxArray.length,ji||ee.collisionBoxArray.length,ji?ji+1:ee.collisionBoxArray.length,ti,Pf,Rf,Zl,Lf,Vf,0,qd,Bf,Vo)}(n,Zt,ge,Ft,i,s,h,Et,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ct,xt,b,0,nt,Mt,B,t,f,w,S,T)};if("line"===Bt)for(const Ft of ig(t.geometry,0,0,ce,ce)){const Zt=x_(Ft,tt,vt,i.vertical||N,s,24,K,n.overscaling,ce);for(const be of Zt){const ge=N;ge&&T_(n,ge.text,bt,be)||Pt(Ft,be,T)}}else if("line-center"===Bt){for(const Ft of t.geometry)if(Ft.length>1){const Zt=y_(Ft,vt,i.vertical||N,s,24,K);Zt&&Pt(Ft,Zt,T)}}else if("Polygon"===t.type)for(const Ft of zp(t.geometry,0)){const Zt=C_(Ft,16);Pt(Ft[0],new vs(Zt.x,Zt.y,0,0,void 0),T)}else if("LineString"===t.type)for(const Ft of t.geometry)Pt(Ft,new vs(Ft[0].x,Ft[0].y,0,0,void 0),T);else if("Point"===t.type)for(const Ft of t.geometry)for(const Zt of Ft)Pt([Zt],new vs(Zt.x,Zt.y,0,0,void 0),T)}const va=32640;function lg(n,t,i,s,h,f,g,y,b,w,S,T,k,O,L,B,N){const X=function(tt,ct,nt,vt,xt,Mt,Bt,bt){const St=[];if(0===ct.positionedLines.length)return St;const It=vt.layout.get("text-rotate").evaluate(Mt,{})*Math.PI/180,Et=function(ge){const ee=ge[0],Vt=ge[1],we=ee*Vt;return we>0?[ee,-Vt]:we<0?[-ee,Vt]:0===ee?[Vt,ee]:[Vt,-ee]}(nt);let Pt=Math.abs(ct.top-ct.bottom);for(const ge of ct.positionedLines)Pt-=ge.lineOffset;const Ft=ct.positionedLines.length,Zt=Pt/Ft;let be=ct.top-nt[1];for(let ge=0;ge<Ft;++ge){const ee=ct.positionedLines[ge];be=v_(ct,Zt,be,ge);for(const Vt of ee.positionedGlyphs){if(!Vt.rect)continue;const we=Vt.rect||{};let ue=4,Xt=!0,Xe=1,Je=0;if(Vt.imageName){const yi=Bt[Vt.imageName];if(!yi)continue;if(yi.sdf){hi("SDF images are not supported in formatted text and will be ignored.");continue}Xt=!1,Xe=yi.pixelRatio,ue=1/Xe}const oi=(xt||bt)&&Vt.vertical,Ce=Vt.metrics.advance*Vt.scale/2,Le=Vt.metrics,ti=Vt.rect;if(null===ti)continue;bt&&ct.verticalizable&&(Je=Vt.imageName?Ce-Vt.metrics.width*Vt.scale/2:0);const Ke=xt?[Vt.x+Ce,Vt.y]:[0,0];let $e=[0,0],ci=[0,0],qe=!1;xt||(oi?(ci=[Vt.x+Ce+Et[0],Vt.y+Et[1]-Je],qe=!0):$e=[Vt.x+Ce+nt[0],Vt.y+nt[1]-Je]);const ki=ti.w*Vt.scale/(Xe*(Vt.localGlyph?2:1)),fn=ti.h*Vt.scale/(Xe*(Vt.localGlyph?2:1));let ke,_i,an,Ue;if(oi){const yi=Vt.y-be,Ai=new jt(-Ce,Ce-yi),Ui=-Math.PI/2,Ri=new jt(...ci);ke=new jt(-Ce+$e[0],$e[1]),ke._rotateAround(Ui,Ai)._add(Ri),ke.x+=-yi+Ce,ke.y-=(Le.left-ue)*Vt.scale;const Xi=Vt.imageName?Le.advance*Vt.scale:24*Vt.scale,ln=String.fromCharCode(Vt.glyph);e_(ln)?ke.x+=(1-ue)*Vt.scale:i_(ln)?ke.x+=Xi-Le.height*Vt.scale+(-ue-1)*Vt.scale:ke.x+=Vt.imageName||Le.width+2*ue===ti.w&&Le.height+2*ue===ti.h?(Xi-fn)/2:(Xi-(Le.height+2*ue)*Vt.scale)/2,_i=new jt(ke.x,ke.y-ki),an=new jt(ke.x+fn,ke.y),Ue=new jt(ke.x+fn,ke.y-ki)}else{const yi=(Le.left-ue)*Vt.scale-Ce+$e[0],Ai=(-Le.top-ue)*Vt.scale+$e[1],Ui=yi+ki,Ri=Ai+fn;ke=new jt(yi,Ai),_i=new jt(Ui,Ai),an=new jt(yi,Ri),Ue=new jt(Ui,Ri)}if(It){let yi;yi=xt?new jt(0,0):qe?new jt(Et[0],Et[1]):new jt(nt[0],nt[1]),ke._rotateAround(It,yi),_i._rotateAround(It,yi),an._rotateAround(It,yi),Ue._rotateAround(It,yi)}const mi=new jt(0,0),Wi=new jt(0,0);St.push({tl:ke,tr:_i,bl:an,br:Ue,tex:we,writingMode:ct.writingMode,glyphOffset:Ke,sectionIndex:Vt.sectionIndex,isSDF:Xt,pixelOffsetTL:mi,pixelOffsetBR:Wi,minFontScaleX:0,minFontScaleY:0})}}return St}(0,s,b,f,g,y,h,n.allowVerticalPlacement),it=n.textSizeData;let K=null;"source"===it.kind?(K=[zo*f.layout.get("text-size").evaluate(y,{},N)],K[0]>va&&hi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===it.kind&&(K=[zo*L.compositeTextSizes[0].evaluate(y,{},N),zo*L.compositeTextSizes[1].evaluate(y,{},N)],(K[0]>va||K[1]>va)&&hi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,X,K,b,g,y,S,t,i,w.lineStartIndex,w.lineLength,O,B,N);for(const tt of T)k[tt]=n.text.placedSymbolArray.length-1;return 4*X.length}function cg(n){for(const t in n)return n[t];return null}function Fd(n,t,i,s,h,f,g,y,b,w){let S=g.top,T=g.bottom,k=g.left,O=g.right;const L=g.collisionPadding;if(L&&(k-=L[0],S-=L[1],O+=L[2],T+=L[3]),b){const B=new jt(k,S),N=new jt(O,S),X=new jt(k,T),it=new jt(O,T),K=_e(b);let tt=new jt(0,0);w&&(tt=new jt(w[0],w[1])),B._rotateAround(K,tt),N._rotateAround(K,tt),X._rotateAround(K,tt),it._rotateAround(K,tt),k=Math.min(B.x,N.x,X.x,it.x),O=Math.max(B.x,N.x,X.x,it.x),S=Math.min(B.y,N.y,X.y,it.y),T=Math.max(B.y,N.y,X.y,it.y)}return n.emplaceBack(t.x,t.y,t.z,i.x,i.y,k,S,O,T,y,s,h,f),n.length-1}function ef(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const t=n.bottom-n.top;return t>0?Math.max(10,t):null}function T_(n,t,i,s){const h=n.compareText;if(t in h){const f=h[t];for(let g=f.length-1;g>=0;g--)if(s.dist(f[g])<i)return!0}else h[t]=[];return h[t].push(s),!1}const k_=Tt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ug}=k_,hg=Tt([{name:"a_pos_3",components:3,type:"Int16"}]);var Mh=Tt([{name:"a_pos",type:"Int16",components:2}]);const bs=ce/Math.PI/2,Od=2*sr(1,0)*bs*Math.PI,Pn=[64,32,16],ur=-bs,Er=bs,D_=[new Sn([ur,ur,ur],[Er,Er,Er]),new Sn([ur,ur,ur],[0,0,Er]),new Sn([0,ur,ur],[Er,0,Er]),new Sn([ur,0,ur],[0,Er,Er]),new Sn([0,0,ur],[Er,Er,Er])];function nf(n,t,i,s=!0){const h=On([],n._camera.position,n.worldSize),f=[t,i,1,1];ma(f,f,n.pixelMatrixInverse),Mp(f,f,1/f[3]);const g=Yi([],Kr([],f,h)),y=n.globeMatrix,b=[y[12],y[13],y[14]],w=Kr([],b,h),S=Lc(w),T=Yi([],w),k=n.worldSize/(2*Math.PI),O=Zn(T,g),L=Math.asin(k/S);if(L<Math.acos(O)){if(!s)return null;const Bt=[],bt=[];On(Bt,g,S/O),Yi(bt,Kr(bt,Bt,w)),Yi(g,fs(g,w,On(g,bt,Math.tan(L)*S)))}const B=[];new dd(h,g).closestPointOnSphere(b,k,B);const N=Yi([],Nn(y,0)),X=Yi([],Nn(y,1)),it=Yi([],Nn(y,2)),K=Zn(N,B),tt=Zn(X,B),ct=Zn(it,B),nt=si(Math.asin(-tt/k));let vt=si(Math.atan2(K,ct));vt=n.center.lng+function(Bt,bt){const St=(bt-Bt+180)%360-180;return St<-180?St+360:St}(n.center.lng,vt);const xt=Wr(vt),Mt=ye(Fo(nt),0,1);return new Cl(xt,Mt)}class rf{constructor(t,i,s){this.a=Kr([],t,s),this.b=Kr([],i,s),this.center=s;const h=Yi([],this.a),f=Yi([],this.b);this.angle=Math.acos(Zn(h,f))}}function Kc(n,t){if(0===n.angle)return null;let i;return i=0===n.a[t]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[t]/n.a[t]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(s,h,f,g){const y=Math.sin(f);return s*(Math.sin((1-g)*f)/y)+h*(Math.sin(g*f)/y)}(n.a[t],n.b[t],n.angle,ye(i,0,1))+n.center[t]}function Tr(n){if(n.z<=1)return D_[n.z+2*n.y+n.x];const t=lf(Sh(n));return Sn.fromPoints(t)}function sf(n,t){const i=Vl(t.zoom);if(0===i)return Tr(n);const s=Sh(n),h=lf(s),f=Wr(s.getWest())*t.worldSize,g=Wr(s.getEast())*t.worldSize,y=Fo(s.getNorth())*t.worldSize,b=Fo(s.getSouth())*t.worldSize,w=[f,y,0],S=[g,y,0],T=[f,b,0],k=[g,b,0],O=ld([],t.globeMatrix);return Pi(w,w,O),Pi(S,S,O),Pi(T,T,O),Pi(k,k,O),h[0]=Jo(h[0],T,i),h[1]=Jo(h[1],k,i),h[2]=Jo(h[2],S,i),h[3]=Jo(h[3],w,i),Sn.fromPoints(h)}function af(n,t,i,s,h){for(const f of i)Pi(f,f,s),On(f,f,h),Lo(n,n,f),Tl(t,t,f)}function Sh({x:n,y:t,z:i}){const s=1/(1<<i),h=new He(ar(n*s),Zi((t+1)*s)),f=new He(ar((n+1)*s),Zi(t*s));return new ds(h,f)}function lf(n){const t=_e(n.getNorth()),i=_e(n.getSouth()),s=Math.cos(t),h=Math.cos(i),f=Math.sin(t),g=Math.sin(i),y=n.getWest(),b=n.getEast();return[Bl(h,g,y),Bl(h,g,b),Bl(s,f,b),Bl(s,f,y)]}function Bl(n,t,i,s=bs){return i=_e(i),[n*Math.sin(i)*s,-t*s,n*Math.cos(i)*s]}function Ld(n,t,i){return Bl(Math.cos(_e(n)),Math.sin(_e(n)),t,i)}function Eh(n,t,i,s){const h=1<<i.z,f=(n/ce+i.x)/h;return Ld(Zi((t/ce+i.y)/h),ar(f),s)}function Qc({min:n,max:t}){return 16383/Math.max(t[0]-n[0],t[1]-n[1],t[2]-n[2])}const cf=new Float64Array(16);function tu(n){const t=Qc(n),i=yp(cf,[t,t,t]);return Oc(i,i,((s=[])[0]=-(h=n.min)[0],s[1]=-h[1],s[2]=-h[2],s));var s,h}function ba(n){const t=(s=n.min,(i=cf)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const h=1/Qc(n);return fa(t,t,[h,h,h])}function uf(n,t,i,s,h){const f=function(b){const w=ce/(2*Math.PI);return b/(2*Math.PI)/w}(i),g=[n,t,-i/(2*Math.PI)],y=Mr(new Float64Array(16));return Oc(y,y,g),fa(y,y,[f,f,f]),cd(y,y,_e(-h)),th(y,y,_e(-s)),y}function Vl(n){return kn(5,6,n)}function hf(n,t){const i=Ld(t.lat,t.lng);return f=(s=hd([],function(O){const L=Ld(O._center.lat,O._center.lng);let B=wp([],El(0,1,0),L);const N=xp([],-O.angle,L);B=Pi(B,B,N),xp(N,-O._pitch,B);const X=Yi([],L);return On(X,X,O.cameraToCenterDistance/O.pixelsPerMeter*Od),Pi(X,X,N),fs([],L,X)}(n),i))[0],g=s[1],y=s[2],b=(h=i)[0],w=h[1],S=h[2],k=(T=Math.sqrt(f*f+g*g+y*y)*Math.sqrt(b*b+w*w+S*S))&&Zn(s,h)/T,Math.acos(Math.min(Math.max(k,-1),1));var s,h,f,g,y,b,w,S,T,k}const Pd=_e(85),wa=Math.cos(Pd),df=Math.sin(Pd);function Rd(n,t){const i=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*t:0,h=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),f=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),g=Math.sin(n._pitch)*f+h;return Math.min(1.01*g,h*(1/n._horizonShift))}function Ca(n,t){if(!t.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:t};const i=Math.pow(2,-n.z),s=n.x*i,h=(n.x+1)*i,f=n.y*i,g=(n.y+1)*i,y=ar(s),b=ar(h),w=Zi(f),S=Zi(g),T=t.project(y,w),k=t.project(b,w),O=t.project(b,S),L=t.project(y,S);let B=Math.min(T.x,k.x,O.x,L.x),N=Math.min(T.y,k.y,O.y,L.y),X=Math.max(T.x,k.x,O.x,L.x),it=Math.max(T.y,k.y,O.y,L.y);const K=i/16;function tt(nt,vt,xt,Mt,Bt,bt){const St=(xt+Bt)/2,It=(Mt+bt)/2,Et=t.project(ar(St),Zi(It)),Pt=Math.max(0,B-Et.x,N-Et.y,Et.x-X,Et.y-it);B=Math.min(B,Et.x),X=Math.max(X,Et.x),N=Math.min(N,Et.y),it=Math.max(it,Et.y),Pt>K&&(tt(nt,Et,xt,Mt,St,It),tt(Et,vt,St,It,Bt,bt))}tt(T,k,s,f,h,f),tt(k,O,h,f,h,g),tt(O,L,h,g,s,g),tt(L,T,s,g,s,f),B-=K,N-=K,X+=K,it+=K;const ct=1/Math.max(X-B,it-N);return{scale:ct,x:B*ct,y:N*ct,x2:X*ct,y2:it*ct,projection:t}}const pf=Mr(new Float32Array(16));class ws{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new He(0,0)}projectTilePoint(t,i,s){return{x:t,y:i,z:0}}locationPoint(t,i,s=!0){return t._coordinatePoint(t.locationCoordinate(i),s)}pixelsPerMeter(t,i){return sr(1,t)*i}pixelSpaceConversion(t,i,s){return 1}farthestPixelDistance(t){return Rd(t,t.pixelsPerMeter)}pointCoordinate(t,i,s,h){const f=t.horizonLineFromTop(!1),g=new jt(i,Math.max(f,s));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}pointCoordinate3D(t,i,s){const h=new jt(i,s);if(t.elevation)return t.elevation.pointCoordinate(h);{const f=this.pointCoordinate(t,h.x,h.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);const s=t.horizonLineFromTop();return i.y<s}createInversionMatrix(t,i){return pf}createTileMatrix(t,i,s){let h,f,g;const y=s.canonical,b=Mr(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Ca(y,this);h=1,f=w.x+s.wrap*w.scale,g=w.y,fa(b,b,[h/w.scale,h/w.scale,t.pixelsPerMeter/i])}else h=i/t.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*s.wrap)*h,g=y.y*h;return Oc(b,b,[f,g,0]),fa(b,b,[h/ce,h/ce,1]),b}upVector(t,i,s){return[0,0,1]}upVectorScale(t,i,s){return{metersToTile:1}}}class dg extends ws{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,s]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(_e(i));this.n=(h+Math.sin(_e(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:s,c:h,r0:f}=this,g=_e(t-this.center[0]),y=_e(i),b=Math.sqrt(h-2*s*Math.sin(y))/s;return{x:b*Math.sin(g*s),y:b*Math.cos(g*s)-f,z:0}}unproject(t,i){const{n:s,c:h,r0:f}=this,g=f+i;let y=Math.atan2(t,Math.abs(g))*Math.sign(g);g*s<0&&(y-=Math.PI*Math.sign(t)*Math.sign(g));const b=_e(this.center[0])*s;y=Fr(y,-Math.PI-b,Math.PI-b);const w=si(y/s)+this.center[0],S=Math.asin(ye((h-(t*t+g*g)*s*s)/(2*s),-1,1)),T=ye(si(S),-85.051129,Xr);return new He(w,T)}}const eu=1.340264,$n=-.081106,iu=893e-6,Gl=.003796,Th=Math.sqrt(3)/2;class ff extends ws{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const s=Math.asin(Th*Math.sin(i)),h=s*s,f=h*h*h;return{x:.5*(t*Math.cos(s)/(Th*(eu+3*$n*h+f*(7*iu+9*Gl*h)))/Math.PI+.5),y:1-.5*(s*(eu+$n*h+f*(iu+Gl*h))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,h=s*s,f=h*h*h;for(let S,T,k,O=0;O<12&&(T=s*(eu+$n*h+f*(iu+Gl*h))-i,k=eu+3*$n*h+f*(7*iu+9*Gl*h),S=T/k,s=ye(s-S,-Math.PI/3,Math.PI/3),h=s*s,f=h*h*h,!(Math.abs(S)<1e-12));++O);const g=Th*t*(eu+3*$n*h+f*(7*iu+9*Gl*h))/Math.cos(s),y=Math.asin(Math.sin(s)/Th),b=ye(180*g/Math.PI,-180,180),w=ye(180*y/Math.PI,-85.051129,Xr);return new He(b,w)}}class pg extends ws{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const s=360*(t-.5),h=ye(360*(.5-i),-85.051129,Xr);return new He(s,h)}}const Nl=Math.PI/2;function Ul(n){return Math.tan((Nl+n)/2)}class I_ extends ws{constructor(t){super(t),this.center=t.center||[0,30];const[i,s]=this.parallels=t.parallels||[30,30],h=_e(i),f=_e(s),g=Math.cos(h);this.n=h===f?Math.sin(h):Math.log(g/Math.cos(f))/Math.log(Ul(f)/Ul(h)),this.f=g*Math.pow(Ul(h),this.n)/this.n}project(t,i){i=_e(i),t=_e(t-this.center[0]);const s=1e-6,{n:h,f}=this;f>0?i<-Nl+s&&(i=-Nl+s):i>Nl-s&&(i=Nl-s);const g=f/Math.pow(Ul(i),h),y=g*Math.sin(h*t),b=f-g*Math.cos(h*t);return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,i=(2*(1-i)-.5)*Math.PI;const{n:s,f:h}=this,f=h-i,g=Math.sign(f),y=Math.sign(s)*Math.sqrt(t*t+f*f);let b=Math.atan2(t,Math.abs(f))*g;f*s<0&&(b-=Math.PI*Math.sign(t)*g);const w=ye(si(b/s)+this.center[0],-180,180),S=ye(si(2*Math.atan(Math.pow(h/y,1/s))-Nl),-85.051129,Xr);return new He(w,S)}}class zd extends ws{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:Wr(t),y:Fo(i),z:0}}unproject(t,i){const s=ar(t),h=Zi(i);return new He(s,h)}}const nu=_e(Xr);class fg extends ws{project(t,i){const s=(i=_e(i))*i,h=s*s;return{x:.5*((t=_e(t))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,h=25,f=0,g=s*s;do{g=s*s;const w=g*g;f=(s*(1.007226+g*(.015085+w*(.028874*g-.044475-.005916*w)))-i)/(1.007226+g*(.045255+w*(.259866*g-.311325-.005916*11*w))),s=ye(s-f,-nu,nu)}while(Math.abs(f)>1e-6&&--h>0);g=s*s;const y=ye(si(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=si(s);return new He(y,b)}}const mf=_e(Xr);class mg extends ws{project(t,i){i=_e(i),t=_e(t);const s=Math.cos(i),h=2/Math.PI,f=Math.acos(s*Math.cos(t/2)),g=Math.sin(f)/f,y=.5*(t*h+2*s*Math.sin(t/2)/g)||0,b=.5*(i+Math.sin(i)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(t,i){let s=t=(2*t-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,f=25;const g=1e-6;let y=0,b=0;do{const w=Math.cos(h),S=Math.sin(h),T=2*S*w,k=S*S,O=w*w,L=Math.cos(s/2),B=Math.sin(s/2),N=2*L*B,X=B*B,it=1-O*L*L,K=it?1/it:0,tt=it?Math.acos(w*L)*Math.sqrt(1/it):0,ct=.5*(2*tt*w*B+2*s/Math.PI)-t,nt=.5*(tt*S+h)-i,vt=.5*K*(O*X+tt*w*L*k)+1/Math.PI,xt=K*(N*T/4-tt*S*B),Mt=.125*K*(T*B-tt*S*O*N),Bt=.5*K*(k*L+tt*X*w)+.5,bt=xt*Mt-Bt*vt;y=(nt*xt-ct*Bt)/bt,b=(ct*Mt-nt*vt)/bt,s=ye(s-y,-Math.PI,Math.PI),h=ye(h-b,-mf,mf)}while((Math.abs(y)>g||Math.abs(b)>g)&&--f>0);return new He(si(s),si(h))}}class Bd extends ws{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_e(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:s,cosPhi:h}=this;return{x:_e(t)*h*s+.5,y:-Math.sin(_e(i))/h*s+.5,z:0}}unproject(t,i){const{scale:s,cosPhi:h}=this,f=-(i-.5)/s,g=ye(si((t-.5)/s)/h,-180,180),y=Math.asin(ye(f*h,-1,1)),b=ye(si(y),-85.051129,Xr);return new He(g,b)}}class gg extends zd{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(t,i,s){const h=Eh(t,i,s);return Pi(h,h,tu(Tr(s))),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,i){const s=Ld(i.lat,i.lng),h=Yi([],s),f=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude;Pc(s,s,h,sr(1,0)*ce*f);const g=Mr(new Float64Array(16));return Sl(g,t.pixelMatrix,t.globeMatrix),Pi(s,s,g),new jt(s[0],s[1])}pixelsPerMeter(t,i){return sr(1,0)*i}pixelSpaceConversion(t,i,s){const h=Oe(sr(1,45)*i,sr(1,t)*i,s);return this.pixelsPerMeter(t,i)/h}createTileMatrix(t,i,s){const h=ba(Tr(s.canonical));return Sl(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,i){const{center:s}=t,h=tu(Tr(i));return th(h,h,_e(s.lng)),cd(h,h,_e(s.lat)),fa(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,i,s,h){return nf(t,i,s,!0)||new Cl(0,0)}pointCoordinate3D(t,i,s){const h=this.pointCoordinate(t,i,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,i){return!nf(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(h,f){const g=h.cameraToCenterDistance,y=h._centerAltitude*f,b=h._camera,w=h._camera.forward(),S=fs([],On([],w,-g),[0,0,y]),T=h.worldSize/(2*Math.PI),k=[0,0,-T],O=h.width/h.height,L=Math.tan(h.fovAboveCenter),B=On([],b.up(),L),N=On([],b.right(),L*O),X=Yi([],fs([],fs([],w,B),N)),it=[];let K;if(new dd(S,X).closestPointOnSphere(k,T,it)){const tt=fs([],it,k),ct=Kr([],tt,S);K=Math.cos(h.fovAboveCenter)*Lc(ct)}else{const tt=Kr([],S,k),ct=Kr([],k,S);Yi(ct,ct);const nt=Lc(tt)-T;K=Math.sqrt(nt*(nt+2*T));const vt=Math.acos(K/(T+nt))-Math.acos(Zn(w,ct));K*=Math.cos(vt)}return 1.01*K}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),s=Vl(t.zoom);if(s>0){const h=Rd(t,sr(1,t.center.lat)*t.worldSize),f=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Oe(i,h+f*(1-Math.cos(g)),Math.pow(s,10))}return i}upVector(t,i,s){return Eh(i,s,t,1)}upVectorScale(t){return{metersToTile:Od*Qc(Tr(t))}}}function gf(n){const t=n.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(n.name){case"mercator":return new zd(n);case"equirectangular":return new pg(n);case"naturalEarth":return new fg(n);case"equalEarth":return new ff(n);case"winkelTripel":return new mg(n);case"albers":return i?new Bd(n):new dg(n);case"lambertConformalConic":return i?new Bd(n):new I_(n);case"globe":return new gg(n)}throw new Error(`Invalid projection name: ${n.name}`)}const Vd=ys.VectorTileFeature.types,_f=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ru(n,t,i,s,h,f,g,y,b,w,S,T,k){const O=y?Math.min(va,Math.round(y[0])):0,L=y?Math.min(va,Math.round(y[1])):0;n.emplaceBack(t,i,Math.round(32*s),Math.round(32*h),f,g,(O<<1)+(b?1:0),L,16*w,16*S,256*T,256*k)}function jl(n,t,i,s,h,f,g){n.emplaceBack(t,i,s,h,f,g)}function ou(n,t,i,s,h){n.emplaceBack(t,i,s,h),n.emplaceBack(t,i,s,h),n.emplaceBack(t,i,s,h),n.emplaceBack(t,i,s,h)}function F_(n){for(const t of n.sections)if(u(t.text))return!0;return!1}class yf{constructor(t){this.layoutVertexArray=new ai,this.indexArray=new Ae,this.programConfigurations=t,this.segments=new Ti,this.dynamicLayoutVertexArray=new Te,this.opacityVertexArray=new Ze,this.placedSymbolArray=new Yf,this.globeExtVertexArray=new xi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,i,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,gh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_f,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Hp.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Jt(yf,"SymbolBuffers");class kh{constructor(t,i,s){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Ti,this.collisionVertexArray=new ii,this.collisionVertexArrayExt=new fi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,qp.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,_h.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Jt(kh,"CollisionBuffers");class Ma{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Mr([]),this.placementViewportMatrix=Mr([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ad(this.zoom,i["text-size"]),this.iconSizeData=Ad(this.zoom,i["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(g=>cr[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new yf(new wl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new yf(new wl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Kh,this.lineVertexArray=new Qh,this.symbolInstances=new Xd}calculateGlyphDependencies(t,i,s,h,f){for(let g=0;g<t.length;g++)if(i[t.charCodeAt(g)]=!0,h&&f){const y=yh[t.charAt(g)];y&&(i[y.charCodeAt(0)]=!0)}}populate(t,i,s,h){const f=this.layers[0],g=f.layout,y="globe"===this.projection.name,b=g.get("text-font"),w=g.get("text-field"),S=g.get("icon-image"),T=("constant"!==w.value.kind||w.value.value instanceof en&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),k="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,O=g.get("symbol-sort-key");if(this.features=[],!T&&!k)return;const L=i.iconDependencies,B=i.glyphDependencies,N=i.availableImages,X=new H(this.zoom);for(const{feature:it,id:K,index:tt,sourceLayerIndex:ct}of t){const nt=f._featureFilter.needGeometry,vt=ps(it,nt);if(!f._featureFilter.filter(X,vt,s))continue;if(nt||(vt.geometry=Oo(it,s,h)),y&&1!==it.type&&s.z<=5){const bt=vt.geometry,St=.98078528056;for(let It=0;It<bt.length;It++)bt[It]=um(bt[It],Et=>Et,(Et,Pt)=>Zn(Eh(Et.x,Et.y,s,1),Eh(Pt.x,Pt.y,s,1))<St)}let xt,Mt;if(T){const bt=f.getValueAndResolveTokens("text-field",vt,s,N),St=en.factory(bt);F_(St)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===V()||this.hasRTLText&&j.isParsed())&&(xt=t_(St,f,vt))}if(k){const bt=f.getValueAndResolveTokens("icon-image",vt,s,N);Mt=bt instanceof hn?bt:hn.fromString(bt)}if(!xt&&!Mt)continue;const Bt=this.sortFeaturesByKey?O.evaluate(vt,{},s):void 0;if(this.features.push({id:K,text:xt,icon:Mt,index:tt,sourceLayerIndex:ct,geometry:vt.geometry,properties:it.properties,type:Vd[it.type],sortKey:Bt}),Mt&&(L[Mt.name]=!0),xt){const bt=b.evaluate(vt,{},s).join(","),St="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(cr.vertical)>=0;for(const It of xt.sections)if(It.image)L[It.image.name]=!0;else{const Et=So(xt.toString()),Pt=It.fontStack||bt,Ft=B[Pt]=B[Pt]||{};this.calculateGlyphDependencies(It.text,Ft,St,this.allowVerticalPlacement,Et)}}}"line"===g.get("symbol-placement")&&(this.features=function(it){const K={},tt={},ct=[];let nt=0;function vt(bt){ct.push(it[bt]),nt++}function xt(bt,St,It){const Et=tt[bt];return delete tt[bt],tt[St]=Et,ct[Et].geometry[0].pop(),ct[Et].geometry[0]=ct[Et].geometry[0].concat(It[0]),Et}function Mt(bt,St,It){const Et=K[St];return delete K[St],K[bt]=Et,ct[Et].geometry[0].shift(),ct[Et].geometry[0]=It[0].concat(ct[Et].geometry[0]),Et}function Bt(bt,St,It){const Et=It?St[0][St[0].length-1]:St[0][0];return`${bt}:${Et.x}:${Et.y}`}for(let bt=0;bt<it.length;bt++){const St=it[bt],It=St.geometry,Et=St.text?St.text.toString():null;if(!Et){vt(bt);continue}const Pt=Bt(Et,It),Ft=Bt(Et,It,!0);if(Pt in tt&&Ft in K&&tt[Pt]!==K[Ft]){const Zt=Mt(Pt,Ft,It),be=xt(Pt,Ft,ct[Zt].geometry);delete K[Pt],delete tt[Ft],tt[Bt(Et,ct[be].geometry,!0)]=be,ct[Zt].geometry=null}else Pt in tt?xt(Pt,Ft,It):Ft in K?Mt(Pt,Ft,It):(vt(bt),K[Pt]=nt-1,tt[Ft]=nt-1)}return ct.filter(bt=>bt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((it,K)=>it.sortKey-K.sortKey)}update(t,i,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,s,h),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,s,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=gf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const s=this.lineVertexArray.length,h=t.segment;if(void 0!==h){let f=t.dist(i[h+1]),g=t.dist(i[h]);const y={};for(let b=h+1;b<i.length;b++)y[b]={x:i[b].x,y:i[b].y,tileUnitDistanceFromAnchor:f},b<i.length-1&&(f+=i[b+1].dist(i[b]));for(let b=h||0;b>=0;b--)y[b]={x:i[b].x,y:i[b].y,tileUnitDistanceFromAnchor:g},b>0&&(g+=i[b-1].dist(i[b]));for(let b=0;b<i.length;b++){const w=y[b];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,i,s,h,f,g,y,b,w,S,T,k,O,L){const B=t.indexArray,N=t.layoutVertexArray,X=t.globeExtVertexArray,it=t.segments.prepareSegment(4*i.length,N,B,this.canOverlap?g.sortKey:void 0),K=this.glyphOffsetArray.length,tt=it.vertexLength,ct=this.allowVerticalPlacement&&y===cr.vertical?Math.PI/2:0,nt=g.text&&g.text.sections;for(let xt=0;xt<i.length;xt++){const{tl:Mt,tr:Bt,bl:bt,br:St,tex:It,pixelOffsetTL:Et,pixelOffsetBR:Pt,minFontScaleX:Ft,minFontScaleY:Zt,glyphOffset:be,isSDF:ge,sectionIndex:ee}=i[xt],Vt=it.vertexLength,we=be[1];if(ru(N,w.x,w.y,Mt.x,we+Mt.y,It.x,It.y,s,ge,Et.x,Et.y,Ft,Zt),ru(N,w.x,w.y,Bt.x,we+Bt.y,It.x+It.w,It.y,s,ge,Pt.x,Et.y,Ft,Zt),ru(N,w.x,w.y,bt.x,we+bt.y,It.x,It.y+It.h,s,ge,Et.x,Pt.y,Ft,Zt),ru(N,w.x,w.y,St.x,we+St.y,It.x+It.w,It.y+It.h,s,ge,Pt.x,Pt.y,Ft,Zt),b){const ue=b.anchor,Xt=b.up;jl(X,ue.x,ue.y,ue.z,Xt[0],Xt[1],Xt[2]),jl(X,ue.x,ue.y,ue.z,Xt[0],Xt[1],Xt[2]),jl(X,ue.x,ue.y,ue.z,Xt[0],Xt[1],Xt[2]),jl(X,ue.x,ue.y,ue.z,Xt[0],Xt[1],Xt[2]),ou(t.dynamicLayoutVertexArray,ue.x,ue.y,ue.z,ct)}else ou(t.dynamicLayoutVertexArray,w.x,w.y,w.z,ct);B.emplaceBack(Vt,Vt+1,Vt+2),B.emplaceBack(Vt+1,Vt+2,Vt+3),it.vertexLength+=4,it.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(be[0]),xt!==i.length-1&&ee===i[xt+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,g,g.index,{},O,L,nt&&nt[ee])}const vt=b?b.anchor:w;t.placedSymbolArray.emplaceBack(vt.x,vt.y,vt.z,w.x,w.y,K,this.glyphOffsetArray.length-K,tt,S,T,w.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],y,0,!1,0,k,0)}_commitLayoutVertex(t,i,s,h,f,g,y){t.emplaceBack(i,s,h,f,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(t,i,s,h,f,g,y){const b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=b.vertexLength,S=y.tileAnchorX,T=y.tileAnchorY;for(let O=0;O<4;O++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(i,-t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(i,t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(i,t.padding,t.padding),s.collisionVertexArrayExt.emplaceBack(i,-t.padding,t.padding),this._commitLayoutVertex(s.layoutVertexArray,h,f,g,S,T,new jt(t.x1,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,f,g,S,T,new jt(t.x2,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,f,g,S,T,new jt(t.x2,t.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,f,g,S,T,new jt(t.x1,t.y2)),b.vertexLength+=4;const k=s.indexArray;k.emplaceBack(w,w+1),k.emplaceBack(w+1,w+2),k.emplaceBack(w+2,w+3),k.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,s,h,f,g){for(let y=h;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(t,g,i,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,i,s,h,f,g){for(let y=h;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceIconSize(t,i,y);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new kh(rr,Vm.members,rn),this.iconCollisionBox=new kh(rr,Vm.members,rn);const s=Zc(this.iconSizeData,t),h=Zc(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,i,s,h){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),g=Sd(this.textSizeData,t,f)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,i,s){const h=this.icon.placedSymbolArray.get(s),f=Sd(this.iconSizeData,t,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(t,i,s){t.emplaceBack(i,-s,-s),t.emplaceBack(i,s,-s),t.emplaceBack(i,s,s),t.emplaceBack(i,-s,s)}_updateTextDebugCollisionBoxes(t,i,s,h,f,g){for(let y=h;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(t,g,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(t,i,s,h,f){for(let g=h;g<f;g++){const y=s.get(g),b=this.getSymbolInstanceIconSize(t,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Zc(this.iconSizeData,t),h=Zc(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,s,h,f,g,y,b,w){const S={};for(let T=i;T<s;T++){const k=t.get(T);S.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.textFeatureIndex=k.featureIndex;break}for(let T=h;T<f;T++){const k=t.get(T);S.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalTextFeatureIndex=k.featureIndex;break}for(let T=g;T<y;T++){const k=t.get(T);S.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.iconFeatureIndex=k.featureIndex;break}for(let T=b;T<w;T++){const k=t.get(T);S.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalIconFeatureIndex=k.featureIndex;break}return S}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const s=t.placedSymbolArray.get(i),h=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<h;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(t),s=Math.cos(t),h=[],f=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const b=this.symbolInstances.get(y);h.push(0|Math.round(i*b.tileAnchorX+s*b.tileAnchorY)),f.push(b.featureIndex)}return g.sort((y,b)=>h[y]-h[b]||f[b]-f[y]),g}addToSortKeyRanges(t,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((h,f,g)=>{h>=0&&g.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Jt(Ma,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ma.MAX_GLYPHS=65535,Ma.addDynamicAttributes=ou;const _g=new At({"symbol-placement":new rt(Ct.layout_symbol["symbol-placement"]),"symbol-spacing":new rt(Ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rt(Ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dt(Ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rt(Ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new rt(Ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new rt(Ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new rt(Ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rt(Ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new dt(Ct.layout_symbol["icon-size"]),"icon-text-fit":new rt(Ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new rt(Ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new dt(Ct.layout_symbol["icon-image"]),"icon-rotate":new dt(Ct.layout_symbol["icon-rotate"]),"icon-padding":new rt(Ct.layout_symbol["icon-padding"]),"icon-keep-upright":new rt(Ct.layout_symbol["icon-keep-upright"]),"icon-offset":new dt(Ct.layout_symbol["icon-offset"]),"icon-anchor":new dt(Ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rt(Ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rt(Ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rt(Ct.layout_symbol["text-rotation-alignment"]),"text-field":new dt(Ct.layout_symbol["text-field"]),"text-font":new dt(Ct.layout_symbol["text-font"]),"text-size":new dt(Ct.layout_symbol["text-size"]),"text-max-width":new dt(Ct.layout_symbol["text-max-width"]),"text-line-height":new dt(Ct.layout_symbol["text-line-height"]),"text-letter-spacing":new dt(Ct.layout_symbol["text-letter-spacing"]),"text-justify":new dt(Ct.layout_symbol["text-justify"]),"text-radial-offset":new dt(Ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rt(Ct.layout_symbol["text-variable-anchor"]),"text-anchor":new dt(Ct.layout_symbol["text-anchor"]),"text-max-angle":new rt(Ct.layout_symbol["text-max-angle"]),"text-writing-mode":new rt(Ct.layout_symbol["text-writing-mode"]),"text-rotate":new dt(Ct.layout_symbol["text-rotate"]),"text-padding":new rt(Ct.layout_symbol["text-padding"]),"text-keep-upright":new rt(Ct.layout_symbol["text-keep-upright"]),"text-transform":new dt(Ct.layout_symbol["text-transform"]),"text-offset":new dt(Ct.layout_symbol["text-offset"]),"text-allow-overlap":new rt(Ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new rt(Ct.layout_symbol["text-ignore-placement"]),"text-optional":new rt(Ct.layout_symbol["text-optional"])});var xf={paint:new At({"icon-opacity":new dt(Ct.paint_symbol["icon-opacity"]),"icon-color":new dt(Ct.paint_symbol["icon-color"]),"icon-halo-color":new dt(Ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new dt(Ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dt(Ct.paint_symbol["icon-halo-blur"]),"icon-translate":new rt(Ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new rt(Ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new dt(Ct.paint_symbol["text-opacity"]),"text-color":new dt(Ct.paint_symbol["text-color"],{runtimeType:Dn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new dt(Ct.paint_symbol["text-halo-color"]),"text-halo-width":new dt(Ct.paint_symbol["text-halo-width"]),"text-halo-blur":new dt(Ct.paint_symbol["text-halo-blur"]),"text-translate":new rt(Ct.paint_symbol["text-translate"]),"text-translate-anchor":new rt(Ct.paint_symbol["text-translate-anchor"])}),layout:_g};class vf{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:co,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Jt(vf,"FormatSectionOverride",{omit:["defaultValue"]});class Gd extends Yr{constructor(t){super(t,xf)}recalculate(t,i){super.recalculate(t,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const f of s)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,s,h){const f=this.layout.get(t).evaluate(i,{},s,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||cl(g.value)||!f?f:(y=i.properties,f.replace(/{([^{}]+)}/g,(w,S)=>S in y?String(y[S]):""));var y}createBucket(t){return new Ma(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of xf.paint.overridableProperties){if(!Gd.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),s=new vf(i),h=new ll(s,i.property.specification);let f=null;f="constant"===i.value.kind||"source"===i.value.kind?new Du("source",h):new ul("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new et(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Gd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const s=t.get("text-field"),h=xf.paint.properties[i];let f=!1;const g=y=>{for(const b of y)if(h.overrides&&h.overrides.hasOverride(b))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof en)g(s.value.value.sections);else if("source"===s.value.kind){const y=w=>{f||(w instanceof Bs&&wi(w.value)===Ps?g(w.value.sections):w instanceof Vs?g(w.sections):w.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return f}getProgramConfiguration(t){return new hs(this,t)}}var O_={paint:new At({"background-color":new rt(Ct.paint_background["background-color"]),"background-pattern":new Lt(Ct.paint_background["background-pattern"]),"background-opacity":new rt(Ct.paint_background["background-opacity"])})},L_={paint:new At({"raster-opacity":new rt(Ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new rt(Ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rt(Ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rt(Ct.paint_raster["raster-brightness-max"]),"raster-saturation":new rt(Ct.paint_raster["raster-saturation"]),"raster-contrast":new rt(Ct.paint_raster["raster-contrast"]),"raster-resampling":new rt(Ct.paint_raster["raster-resampling"]),"raster-fade-duration":new rt(Ct.paint_raster["raster-fade-duration"])})};class P_ extends Yr{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var R_={paint:new At({"sky-type":new rt(Ct.paint_sky["sky-type"]),"sky-atmosphere-sun":new rt(Ct.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new rt(Ct.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new rt(Ct.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new rt(Ct.paint_sky["sky-gradient-radius"]),"sky-gradient":new mt(Ct.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new rt(Ct.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new rt(Ct.paint_sky["sky-atmosphere-color"]),"sky-opacity":new rt(Ct.paint_sky["sky-opacity"])})};function Dh(n,t,i){const s=[0,0,1],h=Sp([]);return Tp(h,h,i?-_e(n)+Math.PI:_e(n)),Ep(h,h,-_e(t)),Ar(s,s,h),Yi(s,s)}const yg={circle:class extends Yr{constructor(n){super(n,ad)}createBucket(n){return new sd(n)}queryRadius(n){const t=n;return Al("circle-radius",this,t)+Al("circle-stroke-width",this,t)+Qu(this.paint.get("circle-translate"))}queryIntersectsFeature(n,t,i,s,h,f,g,y){const b=An(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Sr(n,s,f,g,y,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new hs(this,n)}},heatmap:class extends Yr{createBucket(n){return new Ip(n)}constructor(n){super(n,ih),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=En({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Al("heatmap-radius",this,n)}queryIntersectsFeature(n,t,i,s,h,f,g,y){const b=this.paint.get("heatmap-radius").evaluate(t,i);return Sr(n,s,f,g,y,!0,!0,new jt(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new hs(this,n)}},hillshade:class extends Yr{constructor(n){super(n,_m)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Yr{constructor(n){super(n,wm)}getProgramIds(){const n=this.paint.get("fill-pattern"),t=n&&n.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new hs(this,n)}recalculate(n,t){super.recalculate(n,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Nc(n)}queryRadius(){return Qu(this.paint.get("fill-translate"))}queryIntersectsFeature(n,t,i,s,h,f){return!n.queryGeometry.isAboveHorizon&&fm(Jr(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Yr{constructor(n){super(n,Pl)}createBucket(n){return new xa(n)}queryRadius(){return Qu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new hs(this,n)}queryIntersectsFeature(n,t,i,s,h,f,g,y,b){const w=An(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(t,i),T=this.paint.get("fill-extrusion-base").evaluate(t,i),k=[0,0],O=y&&f.elevation,L=f.elevation?f.elevation.exaggeration():1,B=n.tile.getBucket(this);if(O&&B instanceof xa){const it=B.centroidVertexArray,K=b+1;if(K<it.length){const tt=it.get(K);k[0]=tt.a_centroid_pos0,k[1]=tt.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;"globe"===f.projection.name&&(s=Md([s],[new jt(0,0),new jt(ce,ce)],n.tileID.canonical).map(it=>it.polygon).flat());const N=(K=s,tt=T,ct=S,nt=w,vt=g,xt=O?y:null,Mt=k,Bt=L,bt=f.center.lat,"globe"===(it=f).projection.name?function(It,Et,Pt,Ft,Zt,be,ge,ee,Vt,we,ue){const Xt=[],Xe=[],Je=It.projection.upVectorScale(ue,It.center.lat,It.worldSize).metersToTile,oi=[0,0,0,1],Ce=[0,0,0,1],Le=(Ke,$e,ci,qe)=>{Ke[0]=$e,Ke[1]=ci,Ke[2]=qe,Ke[3]=1},ti=Tm();Pt>0&&(Pt+=ti),Ft+=ti;for(const Ke of Et){const $e=[],ci=[];for(const qe of Ke){const ki=qe.x+Zt.x,fn=qe.y+Zt.y,ke=It.projection.projectTilePoint(ki,fn,ue),_i=It.projection.upVector(ue,qe.x,qe.y);let an=Pt,Ue=Ft;if(ge){const mi=Fm(ki,fn,Pt,Ft,ge,ee,Vt,we);an+=mi.base,Ue+=mi.top}0!==Pt?Le(oi,ke.x+_i[0]*Je*an,ke.y+_i[1]*Je*an,ke.z+_i[2]*Je*an):Le(oi,ke.x,ke.y,ke.z),Le(Ce,ke.x+_i[0]*Je*Ue,ke.y+_i[1]*Je*Ue,ke.z+_i[2]*Je*Ue),Pi(oi,oi,be),Pi(Ce,Ce,be),$e.push(ph(oi)),ci.push(ph(Ce))}Xt.push($e),Xe.push(ci)}return[Xt,Xe]}(it,K,tt,ct,nt,vt,xt,Mt,Bt,bt,n.tileID.canonical):xt?function(It,Et,Pt,Ft,Zt,be,ge,ee,Vt){const we=[],ue=[],Xt=[0,0,0,1];for(const Xe of It){const Je=[],oi=[];for(const Ce of Xe){const Le=Ce.x+Ft.x,ti=Ce.y+Ft.y,Ke=Fm(Le,ti,Et,Pt,be,ge,ee,Vt);Xt[0]=Le,Xt[1]=ti,Xt[2]=Ke.base,Xt[3]=1,ma(Xt,Xt,Zt),Xt[3]=Math.max(Xt[3],1e-5);const $e=ph([Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]]);Xt[0]=Le,Xt[1]=ti,Xt[2]=Ke.top,Xt[3]=1,ma(Xt,Xt,Zt),Xt[3]=Math.max(Xt[3],1e-5);const ci=ph([Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]]);Je.push($e),oi.push(ci)}we.push(Je),ue.push(oi)}return[we,ue]}(K,tt,ct,nt,vt,xt,Mt,Bt,bt):function(It,Et,Pt,Ft,Zt){const be=[],ge=[],ee=Zt[8]*Et,Vt=Zt[9]*Et,we=Zt[10]*Et,ue=Zt[11]*Et,Xt=Zt[8]*Pt,Xe=Zt[9]*Pt,Je=Zt[10]*Pt,oi=Zt[11]*Pt;for(const Ce of It){const Le=[],ti=[];for(const Ke of Ce){const $e=Ke.x+Ft.x,ci=Ke.y+Ft.y,qe=Zt[0]*$e+Zt[4]*ci+Zt[12],ki=Zt[1]*$e+Zt[5]*ci+Zt[13],fn=Zt[2]*$e+Zt[6]*ci+Zt[14],ke=Zt[3]*$e+Zt[7]*ci+Zt[15],_i=qe+ee,an=ki+Vt,Ue=fn+we,mi=Math.max(ke+ue,1e-5),Wi=qe+Xt,yi=ki+Xe,Ai=fn+Je,Ui=Math.max(ke+oi,1e-5),Ri=new jt(_i/mi,an/mi);Ri.z=Ue/mi,Le.push(Ri);const Xi=new jt(Wi/Ui,yi/Ui);Xi.z=Ai/Ui,ti.push(Xi)}be.push(Le),ge.push(ti)}return[be,ge]}(K,tt,ct,nt,vt)),X=n.queryGeometry;var it,K,tt,ct,nt,vt,xt,Mt,Bt,bt;return function(it,K,tt){let ct=1/0;fm(tt,K)&&(ct=Im(tt,K[0]));for(let nt=0;nt<K.length;nt++){const vt=K[nt],xt=it[nt];for(let Mt=0;Mt<vt.length-1;Mt++){const Bt=vt[Mt],bt=[Bt,vt[Mt+1],xt[Mt+1],xt[Mt],Bt];up(tt,bt)&&(ct=Math.min(ct,Im(tt,bt)))}}return ct!==1/0&&ct}(N[0],N[1],X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Yr{constructor(n){super(n,Rm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof rc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,t){super.recalculate(n,t),this.paint._values["line-floorwidth"]=zm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new zl(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new hs(this,n)}queryRadius(n){const t=n,i=jp(Al("line-width",this,t),Al("line-gap-width",this,t)),s=Al("line-offset",this,t);return i/2+Math.abs(s)+Qu(this.paint.get("line-translate"))}queryIntersectsFeature(n,t,i,s,h,f){if(n.queryGeometry.isAboveHorizon)return!1;const g=Jr(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*jp(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),b=this.paint.get("line-offset").evaluate(t,i);return b&&(s=function(w,S){const T=[],k=new jt(0,0);for(let O=0;O<w.length;O++){const L=w[O],B=[];for(let N=0;N<L.length;N++){const X=L[N-1],it=L[N],K=L[N+1],tt=0===N?k:it.sub(X)._unit()._perp(),ct=N===L.length-1?k:K.sub(it)._unit()._perp(),nt=tt._add(ct)._unit();nt._mult(1/(nt.x*ct.x+nt.y*ct.y)),B.push(nt._mult(S)._add(it))}T.push(B)}return T}(s,b*n.pixelToTileUnitsFactor)),function(w,S,T){for(let k=0;k<S.length;k++){const O=S[k];if(w.length>=3)for(let L=0;L<O.length;L++)if(da(w,O[L]))return!0;if(Ug(w,O,T))return!0}return!1}(g,s,y)}isTileClipped(){return!0}},symbol:Gd,background:class extends Yr{constructor(n){super(n,O_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Yr{constructor(n){super(n,L_)}getProgramIds(){return["raster"]}},sky:class extends Yr{constructor(n){super(n,R_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=En({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(n,t){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),h=!s,f=n.style.light,g=f.properties.get("position");return h&&"viewport"===f.properties.get("anchor")&&hi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Dh(g.azimuthal,90-g.polar,t):Dh(s[0],90-s[1],t)}const i=this.paint.get("sky-gradient-center");return Dh(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class su{constructor(t,i,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(i,h)}update(t,i,s){const{width:h,height:f}=t,{context:g}=this,{gl:y}=g,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:S,ImageData:T,ImageBitmap:k}=zt;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||!1!==i.premultiply)),s||this.size&&this.size[0]===h&&this.size[1]===f){const{x:O,y:L}=s||{x:0,y:0};t instanceof b||t instanceof w||t instanceof S||t instanceof T||k&&t instanceof k?y.texSubImage2D(y.TEXTURE_2D,0,O,L,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,O,L,h,f,y.RGBA,y.UNSIGNED_BYTE,t.data)}else this.size=[h,f],t instanceof b||t instanceof w||t instanceof S||t instanceof T||k&&t instanceof k?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,h,f,0,this.format,y.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(t,i){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.filter=t),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class bf{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new Po({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const s=this.getKey(t,i);return this.positions[s]}trim(){const t=this.width,i=this.height=Ts(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,s){const h=[];let f=t.length%2==1?-t[t.length-1]*s:0,g=t[0]*s,y=!0;h.push({left:f,right:g,isDash:y,zeroLength:0===t[0]});let b=t[0];for(let w=1;w<t.length;w++){y=!y;const S=t[w];f=b*s,b+=S,g=b*s,h.push({left:f,right:g,isDash:y,zeroLength:0===S})}return h}addRoundDash(t,i,s){const h=i/2;for(let f=-s;f<=s;f++){const g=this.width*(this.nextRow+s+f);let y=0,b=t[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=t[++y]);const S=Math.abs(w-b.left),T=Math.abs(w-b.right),k=Math.min(S,T);let O;const L=f/s*(h+1);if(b.isDash){const B=h-Math.abs(L);O=Math.sqrt(k*k+B*B)}else O=h-Math.sqrt(k*k+L*L);this.image.data[g+w]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(t,i){for(let b=t.length-1;b>=0;--b){const w=t[b],S=t[b+1];w.zeroLength?t.splice(b,1):S&&S.isDash===w.isDash&&(S.left=w.left,t.splice(b,1))}const s=t[0],h=t[t.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const f=this.width*this.nextRow;let g=0,y=t[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=t[++g]);const w=Math.abs(b-y.left),S=Math.abs(b-y.right),T=Math.min(w,S);this.image.data[f+b]=Math.max(0,Math.min(255,(y.isDash?T:-T)+i+128))}}addDash(t,i){const s=this.getKey(t,i);if(this.positions[s])return this.positions[s];const h="round"===i,f=h?7:0,g=2*f+1;if(this.nextRow+g>this.height)return hi("LineAtlas out of space"),null;0===t.length&&t.push(1);let y=0;for(let S=0;S<t.length;S++)t[S]<0&&(hi("Negative value is found in line dasharray, replacing values with 0"),t[S]=0),y+=t[S];if(0!==y){const S=this.width/y,T=this.getDashRanges(t,this.width,S);h?this.addRoundDash(T,S,f):this.addRegularDash(T,"square"===i?.5*S:0)}const b=this.nextRow+f;this.nextRow+=g;const w={tl:[b,f],br:[y,0]};return this.positions[s]=w,w}}Jt(bf,"LineAtlas");class wf{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class xg{constructor(){this.tasks={},this.taskQueue=[],pr(["process"],this),this.invoker=new wf(this.process),this.nextId=0}add(t,i){const s=this.nextId++,h=function({type:f,isSymbolTile:g,zoom:y}){return y=y||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-y:"maybePrepare"===f&&g?400-y:500:200-y:100-y}(i);if(0===h){cn();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:t,metadata:i,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){cn();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<i&&(i=f.priority,t=h)}if(null===t)return null;const s=this.taskQueue[t];return this.taskQueue.splice(t,1),s}remove(){this.invoker.remove()}}class Cf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const s=t[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const vg=["tile","layer","source","sourceLayer","state"];class Mf{constructor(t,i,s,h,f){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=s,this._y=h,this.properties=t.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const i of vg)void 0!==this[i]&&(t[i]=this[i]);return t}}const Cs=new Uint16Array(8184);for(let n=0;n<2046;n++){let t=n+2,i=0,s=0,h=0,f=0,g=0,y=0;for(1&t?h=f=g=32:i=s=y=32;(t>>=1)>1;){const w=i+h>>1,S=s+f>>1;1&t?(h=i,f=s,i=g,s=y):(i=h,s=f,h=g,f=y),g=w,y=S}const b=4*n;Cs[b+0]=i,Cs[b+1]=s,Cs[b+2]=h,Cs[b+3]=f}const kr=new Uint16Array(2178),Bo=new Uint8Array(1089),Ih=new Uint16Array(1089);function Af(n){return 0===n?-.03125:32===n?.03125:0}var Sf=Tt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ef={type:2,extent:ce,loadGeometry:()=>[[new jt(0,0),new jt(8193,0),new jt(8193,8193),new jt(0,8193),new jt(0,0)]]};class au{constructor(t,i,s,h,f){this.tileID=t,this.uid=Uo(),this.uses=0,this.tileSize=i,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<yn.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ca(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,s){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,f){const g={};if(!f)return g;for(const y of h){const b=y.layerIds.map(w=>f.getLayer(w)).filter(Boolean);if(0!==b.length){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(S=>S.id===w)[0]));for(const w of b)g[w.id]=y}}return g}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof Ma){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof Ma&&f.hasRTLText){this.hasRTLText=!0,j.isLoading()||j.isLoaded()||"deferred"!==V()||Z();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new $r}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const s in this.buckets){const h=this.buckets[s];h.uploadPending()&&h.upload(t)}const i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new su(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new su(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new su(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,i,s,h,f,g,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:y,transform:g,params:f,tileTransform:this.tileTransform},t,i,s):{}}querySourceFeatures(t,i){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const h=s.loadVTLayers(),f=i?i.sourceLayer:"",g=h._geojsonTileLayer||h[f];if(!g)return;const y=ta(i&&i.filter),{z:b,x:w,y:S}=this.tileID.canonical,T={z:b,x:w,y:S};for(let k=0;k<g.length;k++){const O=g.feature(k);if(y.needGeometry){const N=ps(O,!0);if(!y.filter(new H(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!y.filter(new H(this.tileID.overscaledZ),O))continue;const L=s.getId(O,f),B=new Mf(O,b,w,S,L);B.tile=T,t.push(B)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const s=Xn(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const s=Date.now();let h=!1;if(this.expirationTime>s)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const f=this.expirationTime-i;f?this.expirationTime=s+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!i)return;const s=this.latestFeatureIndex.loadVTLayers(),h=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const g=this.buckets[f],y=g.layers[0].sourceLayer||"_geojsonTileLayer",b=s[y],w=t[y];if(!b||!w||0===Object.keys(w).length)continue;if(g.update(w,b,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof zl||g instanceof Nc){const T=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&T&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(T.id,this.tileID)}const S=i&&i.style&&i.style.getLayer(f);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<yn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=yn.now()+t}setTexture(t,i){const s=i.context,h=s.gl;this.texture=i.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new su(s,t,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(t,i){const s={};for(const h of i)s[h]=!0;this.dependencies[t]=s}hasDependency(t,i){for(const s of t){const h=this.dependencies[s];if(h)for(const f of i)if(h[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const s=Oo(Ef,this.tileID.canonical,this.tileTransform)[0],h=new Ut,f=new qr;for(let g=0;g<s.length;g++){const{x:y,y:b}=s[g];h.emplaceBack(y,b),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(h,Mh.members),this._tileDebugSegments=Ti.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const s=Oo(Ef,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const g=function(y,b){const w=Ca(y,b),S=Math.pow(2,y.z);for(let N=0;N<33;N++)for(let X=0;X<33;X++){const it=ar((y.x+(X+Af(X))/32)/S),K=Zi((y.y+(N+Af(N))/32)/S),tt=b.project(it,K),ct=33*N+X;kr[2*ct+0]=Math.round((tt.x*w.scale-w.x)*ce),kr[2*ct+1]=Math.round((tt.y*w.scale-w.y)*ce)}Bo.fill(0),Ih.fill(0);for(let N=2045;N>=0;N--){const X=4*N,it=Cs[X+0],K=Cs[X+1],tt=Cs[X+2],ct=Cs[X+3],nt=it+tt>>1,vt=K+ct>>1,xt=nt+vt-K,Mt=vt+it-nt,Bt=33*K+it,bt=33*ct+tt,St=33*vt+nt,It=Math.hypot((kr[2*Bt+0]+kr[2*bt+0])/2-kr[2*St+0],(kr[2*Bt+1]+kr[2*bt+1])/2-kr[2*St+1])>=16;if(Bo[St]=Bo[St]||(It?1:0),N<1022){const Et=33*(K+Mt>>1)+(it+xt>>1),Pt=33*(ct+Mt>>1)+(tt+xt>>1);Bo[St]=Bo[St]||Bo[Et]||Bo[Pt]}}const T=new ne,k=new Ae;let O=0;function L(N,X){const it=33*X+N;return 0===Ih[it]&&(T.emplaceBack(kr[2*it+0],kr[2*it+1],N*ce/32,X*ce/32),Ih[it]=++O),Ih[it]-1}function B(N,X,it,K,tt,ct){const nt=N+it>>1,vt=X+K>>1;if(Math.abs(N-tt)+Math.abs(X-ct)>1&&Bo[33*vt+nt])B(tt,ct,N,X,nt,vt),B(it,K,tt,ct,nt,vt);else{const xt=L(N,X),Mt=L(it,K),Bt=L(tt,ct);k.emplaceBack(xt,Mt,Bt)}}return B(0,0,32,32,32,0),B(32,32,0,0,0,32),{vertices:T,indices:k}}(this.tileID.canonical,i);h=g.vertices,f=g.indices}else{h=new ne,f=new Ae;for(const{x:y,y:b}of s)h.emplaceBack(y,b,0,0);const g=nh(h.int16,void 0,4);for(let y=0;y<g.length;y+=3)f.emplaceBack(g[y],g[y+1],g[y+2])}this._tileBoundsBuffer=t.createVertexBuffer(h,Sf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(f),this._tileBoundsSegments=Ti.simpleSegment(0,0,h.length,f.length)}_makeGlobeTileDebugBuffers(t,i){const s=i.projection;if(!s||"globe"!==s.name||i.freezeTileCoverage)return;const h=this.tileID.canonical,f=tu(sf(h,i)),g=Vl(i.zoom);let y;g>0&&(y=ld(new Float64Array(16),i.globeMatrix));const b=(h.x+.5)/(1<<h.z)-Wr(i.center.lng);let w=0;b>.5?w=-1:b<-.5&&(w=1),this._makeGlobeTileDebugBorderBuffer(t,h,i,f,y,g,w),this._makeGlobeTileDebugTextBuffer(t,h,i,f,y,g,w)}_globePoint(t,i,s,h,f,g,y,b){let w=Eh(t,i,s);if(g){const S=1<<s.z,T=[((t/ce+s.x)/S+b)*h,(i/ce+s.y)/S*h,0];Pi(T,T,g),w=Jo(w,T,y)}return Pi(w,w,f)}_makeGlobeTileDebugBorderBuffer(t,i,s,h,f,g,y){const b=new Ut,w=new qr,S=new Qt,T=(O,L,B,N,X)=>{const it=(B-O)/(X-1),K=(N-L)/(X-1),tt=b.length;for(let ct=0;ct<X;ct++){const nt=O+ct*it,vt=L+ct*K;b.emplaceBack(nt,vt);const xt=this._globePoint(nt,vt,i,s.worldSize,h,f,g,y);S.emplaceBack(xt[0],xt[1],xt[2]),w.emplaceBack(tt+ct)}},k=ce;T(0,0,k,0,16),T(k,0,k,k,16),T(k,k,0,k,16),T(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(w),this._tileDebugBuffer=t.createVertexBuffer(b,Mh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(S,hg.members),this._tileDebugSegments=Ti.simpleSegment(0,0,b.length,w.length)}_makeGlobeTileDebugTextBuffer(t,i,s,h,f,g,y){const b=new Ut,w=new Ae,S=new Qt,T=25;w.reserve(32),b.reserve(T),S.reserve(T);const k=(O,L)=>T*O+L;for(let O=0;O<T;O++){const L=2048*O;for(let B=0;B<T;B++){const N=2048*B;b.emplaceBack(N,L);const X=this._globePoint(N,L,i,s.worldSize,h,f,g,y);S.emplaceBack(X[0],X[1],X[2])}}for(let O=0;O<4;O++)for(let L=0;L<4;L++){const B=k(O,L),N=k(O,L+1),X=k(O+1,L),it=k(O+1,L+1);w.emplaceBack(B,N,X),w.emplaceBack(X,N,it)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(w),this._tileDebugTextBuffer=t.createVertexBuffer(b,Mh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(S,hg.members),this._tileDebugTextSegments=Ti.simpleSegment(0,0,T,32)}}class z_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,s){const h=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Ve(this.stateChanges[t][h],s),null===this.deletedStates[t]){this.deletedStates[t]={};for(const f in this.state[t])f!==h&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][h]){this.deletedStates[t][h]={};for(const f in this.state[t][h])s[f]||(this.deletedStates[t][h][f]=null)}else for(const f in s)this.deletedStates[t]&&this.deletedStates[t][h]&&null===this.deletedStates[t][h][f]&&delete this.deletedStates[t][h][f]}removeFeatureState(t,i,s){if(null===this.deletedStates[t])return;const h=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&void 0!==i)null!==this.deletedStates[t][h]&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][s]=null);else if(void 0!==i)if(this.stateChanges[t]&&this.stateChanges[t][h])for(s in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][s]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,i){const s=String(i),h=Ve({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const f=this.deletedStates[t][i];if(null===f)return{};for(const g in f)delete h[g]}return h}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){const s={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const g in this.stateChanges[h])this.state[h][g]||(this.state[h][g]={}),Ve(this.state[h][g],this.stateChanges[h][g]),f[g]=this.state[h][g];s[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(null===this.deletedStates[h])for(const g in this.state[h])f[g]={},this.state[h][g]={};else for(const g in this.deletedStates[h]){if(null===this.deletedStates[h][g])this.state[h][g]={};else for(const y of Object.keys(this.deletedStates[h][g]))delete this.state[h][g][y];f[g]=this.state[h][g]}s[h]=s[h]||{},Ve(s[h],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const h in t)t[h].setFeatureState(s,i)}}class bg{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const s=this.toIdx(t,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function wg(n,t,i,s){let h=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(s[g])<1e-15){if(i[g]<n[g]||i[g]>t[g])return null}else{const y=1/s[g];let b=(n[g]-i[g])*y,w=(t[g]-i[g])*y;if(b>w){const S=b;b=w,w=S}if(b>h&&(h=b),w<f&&(f=w),h>f)return null}return h}function Tf(n,t,i,s,h,f,g,y,b,w,S){const T=s-n,k=h-t,O=f-i,L=g-n,B=y-t,N=b-i,X=S[1]*N-S[2]*B,it=S[2]*L-S[0]*N,K=S[0]*B-S[1]*L,tt=T*X+k*it+O*K;if(Math.abs(tt)<1e-15)return null;const ct=1/tt,nt=w[0]-n,vt=w[1]-t,xt=w[2]-i,Mt=(nt*X+vt*it+xt*K)*ct;if(Mt<0||Mt>1)return null;const Bt=vt*O-xt*k,bt=xt*T-nt*O,St=nt*k-vt*T,It=(S[0]*Bt+S[1]*bt+S[2]*St)*ct;return It<0||Mt+It>1?null:(L*Bt+B*bt+N*St)*ct}function kf(n,t,i){return(n-t)/(i-t)}function Df(n,t,i,s,h,f,g,y,b){const w=1<<i,S=f-s,T=g-h,k=(n+1)/w*S+s,O=(t+0)/w*T+h,L=(t+1)/w*T+h;y[0]=(n+0)/w*S+s,y[1]=O,b[0]=k,b[1]=L}class If{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const g=Math.ceil(Math.log2(f.dim/8)),y=[];let b=Math.ceil(Math.pow(2,g));const w=1/b,S=(O,L,B,N,X)=>{const it=N?1:0,K=(O+1)*B-it,tt=L*B,ct=(L+1)*B-it;X[0]=O*B,X[1]=tt,X[2]=K,X[3]=ct};let T=new bg(b);const k=[];for(let O=0;O<b*b;O++){S(O%b,Math.floor(O/b),w,!1,k);const L=Aa(k[0],k[1],f),B=Aa(k[2],k[1],f),N=Aa(k[2],k[3],f),X=Aa(k[0],k[3],f);T.minimums.push(Math.min(L,B,N,X)),T.maximums.push(Math.max(L,B,N,X)),T.leaves.push(1)}for(y.push(T),b/=2;b>=1;b/=2){const O=y[y.length-1];T=new bg(b);for(let L=0;L<b*b;L++){S(L%b,Math.floor(L/b),2,!0,k);const B=O.getElevation(k[0],k[1]),N=O.getElevation(k[2],k[1]),X=O.getElevation(k[2],k[3]),it=O.getElevation(k[0],k[3]),K=O.isLeaf(k[0],k[1]),tt=O.isLeaf(k[2],k[1]),ct=O.isLeaf(k[2],k[3]),nt=O.isLeaf(k[0],k[3]),vt=Math.min(B.min,N.min,X.min,it.min),xt=Math.max(B.max,N.max,X.max,it.max),Mt=K&&tt&&ct&&nt;T.maximums.push(xt),T.minimums.push(vt),T.leaves.push(xt-vt<=5&&Mt?1:0)}y.push(T)}return y}(this.dem),s=i.length-1,h=i[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(t,i,s,h,f,g,y=1){return wg([t,i,-100],[s,h,this.maximums[0]*y],f,g)}raycast(t,i,s,h,f,g,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(t,i,s,h,f,g,y);if(null==b)return null;const w=[],S=[],T=[],k=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:L,t:B,nodex:N,nodey:X,depth:it}=O.pop();if(this.leaves[L]){Df(N,X,it,t,i,s,h,T,k);const tt=1<<it,ct=(N+0)/tt,nt=(N+1)/tt,vt=(X+0)/tt,xt=(X+1)/tt,Mt=Aa(ct,vt,this.dem)*y,Bt=Aa(nt,vt,this.dem)*y,bt=Aa(nt,xt,this.dem)*y,St=Aa(ct,xt,this.dem)*y,It=Tf(T[0],T[1],Mt,k[0],T[1],Bt,k[0],k[1],bt,f,g),Et=Tf(k[0],k[1],bt,T[0],k[1],St,T[0],T[1],Mt,f,g),Pt=Math.min(null!==It?It:Number.MAX_VALUE,null!==Et?Et:Number.MAX_VALUE);if(Pt!==Number.MAX_VALUE)return Pt;{const Ft=Pc([],f,g,B);if(Cg(Mt,Bt,St,bt,kf(Ft[0],T[0],k[0]),kf(Ft[1],T[1],k[1]))>=Ft[2])return B}continue}let K=0;for(let tt=0;tt<this._siblingOffset.length;tt++){Df((N<<1)+this._siblingOffset[tt][0],(X<<1)+this._siblingOffset[tt][1],it+1,t,i,s,h,T,k),T[2]=-100,k[2]=this.maximums[this.childOffsets[L]+tt]*y;const ct=wg(T,k,f,g);if(null!=ct){const nt=ct;w[tt]=nt;let vt=!1;for(let xt=0;xt<K&&!vt;xt++)nt>=w[S[xt]]&&(S.splice(xt,0,tt),vt=!0);vt||(S[K]=tt),K++}}for(let tt=0;tt<K;tt++){const ct=S[tt];O.push({idx:this.childOffsets[L]+ct,t:w[ct],nodex:(N<<1)+this._siblingOffset[ct][0],nodey:(X<<1)+this._siblingOffset[ct][1],depth:it+1})}}return null}_addNode(t,i,s){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,s,h,f){if(1===t[h].isLeaf(i,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=h-1,y=t[g];let b=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){const T=2*i+this._siblingOffset[S][0],k=2*s+this._siblingOffset[S][1],O=y.getElevation(T,k),L=y.isLeaf(T,k),B=this._addNode(O.min,O.max,L);L&&(b|=1<<S),w||(w=B)}for(let S=0;S<this._siblingOffset.length;S++)b&1<<S||this._construct(t,2*i+this._siblingOffset[S][0],2*s+this._siblingOffset[S][1],g,w+S)}}function Cg(n,t,i,s,h,f){return Oe(Oe(n,i,f),Oe(t,s,f),h)}function Aa(n,t,i){const s=i.dim,h=ye(n*s-.5,0,s-1),f=ye(t*s-.5,0,s-1),g=Math.floor(h),y=Math.floor(f),b=Math.min(g+1,s-1),w=Math.min(y+1,s-1);return Cg(i.get(g,y),i.get(b,y),i.get(g,w),i.get(b,w),h-g,f-y)}const Mg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class lu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,s,h=!1,f=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return hi(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,y=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=s||"mapbox",this.borderReady=h,!h){for(let b=0;b<g;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(g,b)]=y[this._idx(g-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,g)]=y[this._idx(b,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new If(this)}get(t,i,s=!1){s&&(t=ye(t,-1,this.dim),i=ye(i,-1,this.dim));const h=4*this._idx(t,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(t){return Mg[t]}get unpackVector(){return Mg[this.encoding]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}_unpackMapbox(t,i,s){return(256*t*256+256*i+s)/10-1e4}_unpackTerrarium(t,i,s){return 256*t+i+s/256-32768}static pack(t,i){const s=[0,0,0,0],h=lu.getUnpackVector(i);let f=Math.floor((t+h[3])/h[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Ln({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,f=i*this.dim+this.dim,g=s*this.dim,y=s*this.dim+this.dim;switch(i){case-1:h=f-1;break;case 1:f=h+1}switch(s){case-1:g=y-1;break;case 1:y=g+1}const b=-i*this.dim,w=-s*this.dim;for(let S=g;S<y;S++)for(let T=h;T<f;T++){const k=4*this._idx(T,S),O=4*this._idx(T+b,S+w);this.pixels[k+0]=t.pixels[O+0],this.pixels[k+1]=t.pixels[O+1],this.pixels[k+2]=t.pixels[O+2],this.pixels[k+3]=t.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Jt(lu,"DEMData"),Jt(If,"DemMinMaxQuadTree",{omit:["dem"]});class Ff{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,s){const h=t.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const f={value:i,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(t,f)},s)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const s=t.wrapped().key,h=void 0===i?0:this.data[s].indexOf(i),f=this.data[s][h];return this.data[s].splice(h,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const s in this.data)for(const h of this.data[s])t(h.value)||i.push(h);for(const s of i)this.remove(s.value.tileID,s)}}class Sa{constructor(t,i,s){this.func=t,this.mask=i,this.range=s}}Sa.ReadOnly=!1,Sa.ReadWrite=!0,Sa.disabled=new Sa(519,Sa.ReadOnly,[0,1]);class Fh{constructor(t,i,s,h,f,g){this.test=t,this.ref=i,this.mask=s,this.fail=h,this.depthFail=f,this.pass=g}}Fh.disabled=new Fh({func:519,mask:0},0,0,7680,7680,7680);class Tn{constructor(t,i,s){this.blendFunction=t,this.blendColor=i,this.mask=s}}Tn.Replace=[1,0],Tn.disabled=new Tn(Tn.Replace,We.transparent,[!1,!1,!1,!1]),Tn.unblended=new Tn(Tn.Replace,We.transparent,[!0,!0,!0,!0]),Tn.alphaBlended=new Tn([1,771],We.transparent,[!0,!0,!0,!0]);class Dr{constructor(t,i,s){this.enable=t,this.mode=i,this.frontFace=s}}Dr.disabled=new Dr(!1,1029,2305),Dr.backCCW=new Dr(!0,1029,2305),Dr.backCW=new Dr(!0,1029,2304),Dr.frontCW=new Dr(!0,1028,2304),Dr.frontCCW=new Dr(!0,1028,2305);class Ms extends ie{constructor(t,i,s){super(),this.id=t,this._onlySymbols=s,i.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new Ff(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new z_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const i=this._tiles[t];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const i in this._tiles){const s=this._tiles[i];this._source.prepareTile(s)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,s.tileID),s.upload(t),s.prepare(this.map.style.imageManager)}else for(const i in this._tiles){const s=this._tiles[i];s.upload(t),s.prepare(this.map.style.imageManager)}}getIds(){return ro(this._tiles).map(t=>t.tileID).sort(cu).map(t=>t.key)}getRenderableIds(t){const i=[];for(const s in this._tiles)this._isIdRenderable(+s,t)&&i.push(this._tiles[s]);return t?i.sort((s,h)=>{const f=s.tileID,g=h.tileID,y=new jt(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new jt(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||b.y-y.y||b.x-y.x}).map(s=>s.tileID.key):i.map(s=>s.tileID).sort(cu).map(s=>s.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const s=this._tiles[t];s&&("loading"!==s.state&&(s.state=i),this._loadTile(s,this._tileLoaded.bind(this,s,t,i)))}_tileLoaded(t,i,s,h){if(h)if(t.state="errored",404!==h.status)this._source.fire(new Ne(h,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=yn.now(),"expired"===s&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Ye("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const f=i[h];if(t.neighboringTiles&&t.neighboringTiles[f]){const g=this.getTileByID(f);s(t,g),s(g,t)}}function s(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-h.tileID.canonical.x;const y=f.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),w=f.tileID.key;0===g&&0===y||Math.abs(y)>1||(Math.abs(g)>1&&(1===Math.abs(g+b)?g+=b:1===Math.abs(g-b)&&(g-=b)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,g,y),h.neighboringTiles&&h.neighboringTiles[w]&&(h.neighboringTiles[w].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,s,h){for(const f in this._tiles){let g=this._tiles[f];if(h[f]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>s)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const w=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[w.key],g&&g.hasData()&&(y=w)}let b=y;for(;b.overscaledZ>i;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){h[y.key]=y;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const s=this._loadedParentTiles[t.key];return s&&s.tileID.overscaledZ>=i?s:null}for(let s=t.overscaledZ-1;s>=i;s--){const h=t.scaledTo(s),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const s=Math.ceil(t.width/i)+1,h=Math.ceil(t.height/i)+1,f=Math.floor(s*h*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(t){const i=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,i){const s={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),s[f.tileID.key]=f}this._tiles=s;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(t,i,s){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let h;this.updateCacheSize(t,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new li(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(h=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(y=>this._source.hasTile(y)))):h=[];const f=this._updateRetainedTiles(h);if(Ag(this._source.type)&&0!==h.length){const y={},b={},w=Object.keys(f);for(const T of w){const k=f[T],O=this._tiles[T];if(!O||O.fadeEndTime&&O.fadeEndTime<=yn.now())continue;const L=this.findLoadedParent(k,Math.max(k.overscaledZ-Ms.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),y[L.tileID.key]=L.tileID),b[T]=k}const S=h[h.length-1].overscaledZ;for(const T in this._tiles){const k=this._tiles[T];if(f[T]||!k.hasData())continue;let O=k.tileID;for(;O.overscaledZ>S;){O=O.scaledTo(O.overscaledZ-1);const L=this._tiles[O.key];if(L&&L.hasData()&&b[O.key]){f[T]=k.tileID;break}}}for(const T in y)f[T]||(this._coveredTiles[T]=!0,f[T]=y[T])}for(const y in f)this._tiles[y].clearFadeHold();const g=function(y,b){const w=[];for(const S in y)S in b||w.push(S);return w}(this._tiles,f);for(const y of g){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(0===t.length)return i;const s={},h=t.reduce((w,S)=>Math.min(w,S.overscaledZ),1/0),f=t[0].overscaledZ,g=Math.max(f-Ms.maxOverzooming,this._source.minzoom),y=Math.max(f+Ms.maxUnderzooming,this._source.minzoom),b={};for(const w of t){const S=this._addTile(w);i[w.key]=w,S.hasData()||h<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,h,y,i);for(const w of t){let S=this._tiles[w.key];if(S.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const k=w.children(this._source.maxzoom)[0],O=this.getTile(k);if(O&&O.hasData()){i[k.key]=k;continue}}else{const k=w.children(this._source.maxzoom);if(i[k[0].key]&&i[k[1].key]&&i[k[2].key]&&i[k[3].key])continue}let T=S.wasRequested();for(let k=w.overscaledZ-1;k>=g;--k){const O=w.scaledTo(k);if(s[O.key]||(s[O.key]=!0,S=this.getTile(O),!S&&T&&(S=this._addTile(O)),S&&(i[O.key]=O,T=S.wasRequested(),S.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let s,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}i.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;h=f}for(const f of i)this._loadedParentTiles[f]=s}}_addTile(t){let i=this._tiles[t.key];if(i)return this._source.prepareTile&&this._source.prepareTile(i),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const s=Boolean(i);if(!s){const h=this.map?this.map.painter:null;i=new au(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._source.prepareTile&&this._source.prepareTile(i)||this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,s||this._source.fire(new Ye("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const s=i.getExpiryTimeout();s&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},s))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,s){const h=[],f=this.transform;if(!f)return h;const g="globe"===f.projection.name,y=Wr(f.center.lng);for(const b in this._tiles){const w=this._tiles[b];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let S;if(g){const T=w.tileID.canonical;if(0===T.z){const k=[Math.abs(ye(y,...Hl(T,-1))-y),Math.abs(ye(y,...Hl(T,1))-y)];S=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(ye(y,...Hl(T,-1))-y),Math.abs(ye(y,...Hl(T,0))-y),Math.abs(ye(y,...Hl(T,1))-y)];S=[k.indexOf(Math.min(...k))-1]}}else S=[0];for(const T of S){const k=t.containsTile(w,f,i,T);k&&h.push(k)}}return h}getVisibleCoordinates(t){const i=this.getRenderableIds(t).map(s=>this._tiles[s].tileID);for(const s of i)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Ag(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=yn.now())return!0}return!1}setFeatureState(t,i,s){this._state.updateState(t=t||"_geojsonTileLayer",i,s)}removeFeatureState(t,i,s){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,s)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,s){const h=this._tiles[t];h&&h.setDependencies(i,s)}reloadTilesForDependencies(t,i){for(const s in this._tiles)this._tiles[s].hasDependency(t,i)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(t,i))}_preloadTiles(t,i){const s=new Map,h=Array.isArray(t)?t:[t],f=this.map.painter.terrain,g=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of h){const b=y.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of b)s.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}Qi(Array.from(s.values()),(y,b)=>{const w=new au(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,S=>{"raster-dem"===this._source.type&&w.dem&&this._backfillDEM(w),b(S,w)})},i)}}function cu(n,t){const i=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*t.wrap)-+(t.wrap<0);return n.overscaledZ-t.overscaledZ||s-i||t.canonical.y-n.canonical.y||t.canonical.x-n.canonical.x}function Ag(n){return"raster"===n||"image"===n||"video"===n}function Hl(n,t){const i=1<<n.z;return[n.x/i+t,(n.x+1)/i+t]}Ms.maxOverzooming=10,Ms.maxUnderzooming=3;class Ea{constructor(t,i,s){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(t,i,s){const h=s||t.findDEMTileFor(i);if(!h||!h.dem)return;const f=h.dem,g=h.tileID,y=1<<i.canonical.z-g.canonical.z;return new Ea(h,h.tileSize/ce/y,[(i.canonical.x/y-g.canonical.x)*f.dim,(i.canonical.y/y-g.canonical.y)*f.dim])}tileCoordToPixel(t,i){const s=i*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),f=Math.floor(s);return new jt(h,f)}getElevationAt(t,i,s,h){const f=t*this._scale+this._offset[0],g=i*this._scale+this._offset[1],y=Math.floor(f),b=Math.floor(g),w=this._dem;return h=!!h,s?Oe(Oe(w.get(y,b,h),w.get(y,b+1,h),g-b),Oe(w.get(y+1,b,h),w.get(y+1,b+1,h),g-b),f-y):w.get(y,b,h)}getElevationAtPixel(t,i,s){return this._dem.get(t,i,!!s)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*sr(1,t)*this._dem.stride}}class As{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Co(ce,16,0),this.featureIndexArray=new Kd,this.promoteId=i}insert(t,i,s,h,f,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,f,g);const b=this.grid;for(let w=0;w<i.length;w++){const S=i[w],T=[1/0,1/0,-1/0,-1/0];for(let k=0;k<S.length;k++){const O=S[k];T[0]=Math.min(T[0],O.x),T[1]=Math.min(T[1],O.y),T[2]=Math.max(T[2],O.x),T[3]=Math.max(T[3],O.y)}T[0]<ce&&T[1]<ce&&T[2]>=0&&T[3]>=0&&b.insert(y,T[0],T[1],T[2],T[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ys.VectorTile(new xh(this.rawTileData)).layers,this.sourceLayerCoder=new Cf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,s,h){this.loadVTLayers();const f=t.params||{},g=ta(f.filter),y=t.tileResult,b=t.transform,w=y.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(L,B,N,X)=>mp(y.bufferedTilespaceGeometry,L,B,N,X));S.sort(Of);let T=null;b.elevation&&S.length>0&&(T=Ea.create(b.elevation,this.tileID));const k={};let O;for(let L=0;L<S.length;L++){const B=S[L];if(B===O)continue;O=B;const N=this.featureIndexArray.get(B);let X=null;this.loadMatchingFeature(k,N,g,f.layers,f.availableImages,i,s,h,(it,K,tt,ct=0)=>(X||(X=Oo(it,this.tileID.canonical,t.tileTransform)),K.queryIntersectsFeature(y,it,tt,X,this.z,t.transform,t.pixelPosMatrix,T,ct)))}return k}loadMatchingFeature(t,i,s,h,f,g,y,b,w){const{featureIndex:S,bucketIndex:T,sourceLayerIndex:k,layoutVertexArrayOffset:O}=i,L=this.bucketLayerIDs[T];if(h&&!function(it,K){for(let tt=0;tt<it.length;tt++)if(K.indexOf(it[tt])>=0)return!0;return!1}(h,L))return;const B=this.sourceLayerCoder.decode(k),N=this.vtLayers[B].feature(S);if(s.needGeometry){const it=ps(N,!0);if(!s.filter(new H(this.tileID.overscaledZ),it,this.tileID.canonical))return}else if(!s.filter(new H(this.tileID.overscaledZ),N))return;const X=this.getId(N,B);for(let it=0;it<L.length;it++){const K=L[it];if(h&&h.indexOf(K)<0)continue;const tt=g[K];if(!tt)continue;let ct={};void 0!==X&&b&&(ct=b.getState(tt.sourceLayer||"_geojsonTileLayer",X));const nt=Ve({},y[K]);nt.paint=Sg(nt.paint,tt.paint,N,ct,f),nt.layout=Sg(nt.layout,tt.layout,N,ct,f);const vt=!w||w(N,tt,ct,O);if(!vt)continue;const xt=new Mf(N,this.z,this.x,this.y,X);xt.layer=nt;let Mt=t[K];void 0===Mt&&(Mt=t[K]=[]),Mt.push({featureIndex:S,feature:xt,intersectionZ:vt})}}lookupSymbolFeatures(t,i,s,h,f,g,y,b){const w={};this.loadVTLayers();const S=ta(f);for(const T of t)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:h,featureIndex:T,layoutVertexArrayOffset:0},S,g,y,b,i);return w}loadFeature(t){const{featureIndex:i,sourceLayerIndex:s}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),f=this.vtFeatures[h];if(f[i])return f[i];const g=this.vtLayers[h].feature(i);return f[i]=g,g}hasLayer(t){for(const i of this.bucketLayerIDs)for(const s of i)if(t===s)return!0;return!1}getId(t,i){let s=t.id;return this.promoteId&&(s=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[i]],"boolean"==typeof s&&(s=Number(s))),s}}function Sg(n,t,i,s,h){return Gn(n,(f,g)=>{const y=t instanceof at?t.get(g):null;return y&&y.evaluate?y.evaluate(i,s,h):y})}function Of(n,t){return t-n}Jt(As,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Ud{constructor(t){const i={},s=[];for(const y in t){const b=t[y],w=i[y]={};for(const S in b.glyphs){const T=b.glyphs[+S];if(!T||0===T.bitmap.width||0===T.bitmap.height)continue;const k=T.metrics.localGlyph?2:1,O={x:0,y:0,w:T.bitmap.width+2*k,h:T.bitmap.height+2*k};s.push(O),w[S]=O}}const{w:h,h:f}=Yp(s),g=new Po({width:h||1,height:f||1});for(const y in t){const b=t[y];for(const w in b.glyphs){const S=b.glyphs[+w];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const T=i[y][w],k=S.metrics.localGlyph?2:1;Po.copy(S.bitmap,g,{x:0,y:0},{x:T.x+k,y:T.y+k},S.bitmap)}}this.image=g,this.positions=i}}Jt(Ud,"GlyphAtlas");class jd{constructor(t){this.tileID=new li(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Ca(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,i,s,h,f){this.status="parsing",this.data=t,this.collisionBoxArray=new $r;const g=new Cf(Object.keys(t.layers).sort()),y=new As(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},w=new bf(256,256),S={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:s},T=i.familiesBySource[this.source];for(const ct in T){const nt=t.layers[ct];if(!nt)continue;let vt=!1,xt=!1;for(const bt of T[ct])"symbol"===bt[0].type?vt=!0:xt=!0;if(!0===this.isSymbolTile&&!vt||!1===this.isSymbolTile&&!xt)continue;1===nt.version&&hi(`Vector tile source "${this.source}" layer "${ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mt=g.encode(ct),Bt=[];for(let bt=0;bt<nt.length;bt++){const St=nt.feature(bt),It=y.getId(St,ct);Bt.push({feature:St,id:It,index:bt,sourceLayerIndex:Mt})}for(const bt of T[ct]){const St=bt[0];void 0!==this.isSymbolTile&&"symbol"===St.type!==this.isSymbolTile||St.minzoom&&this.zoom<Math.floor(St.minzoom)||St.maxzoom&&this.zoom>=St.maxzoom||"none"!==St.visibility&&(Ph(bt,this.zoom,s),(b[St.id]=St.createBucket({index:y.bucketLayerIDs.length,layers:bt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Bt,S,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(bt.map(It=>It.id)))}}let k,O,L,B;w.trim();const N={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},X=Gn(S.glyphDependencies,ct=>Object.keys(ct).map(Number));Object.keys(X).length?h.send("getGlyphs",{uid:this.uid,stacks:X},(ct,nt)=>{k||(k=ct,O=nt,tt.call(this))},void 0,!1,N):O={};const it=Object.keys(S.iconDependencies);it.length?h.send("getImages",{icons:it,source:this.source,tileID:this.tileID,type:"icons"},(ct,nt)=>{k||(k=ct,L=nt,tt.call(this))},void 0,!1,N):L={};const K=Object.keys(S.patternDependencies);function tt(){if(k)return f(k);if(O&&L&&B){const ct=new Ud(O),nt=new Hm(L,B);for(const vt in b){const xt=b[vt];xt instanceof Ma?(Ph(xt.layers,this.zoom,s),S_(xt,O,ct.positions,L,nt.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):xt.hasPattern&&(xt instanceof zl||xt instanceof Nc||xt instanceof xa)&&(Ph(xt.layers,this.zoom,s),xt.addFeatures(S,this.tileID.canonical,nt.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:ro(b).filter(vt=>!vt.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ct.image,lineAtlas:w,imageAtlas:nt,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?ct.positions:null})}}K.length?h.send("getImages",{icons:K,source:this.source,tileID:this.tileID,type:"patterns"},(ct,nt)=>{k||(k=ct,B=nt,tt.call(this))},void 0,!1,N):B={},tt.call(this)}}function Ph(n,t,i){const s=new H(t);for(const h of n)h.recalculate(s,i)}class Eg{constructor(t){this.entries={},this.scheduler=t}request(t,i,s,h){const f=this.entries[t]=this.entries[t]||{callbacks:[]};if(f.result){const[g,y]=f.result;return this.scheduler?this.scheduler.add(()=>{h(g,y)},i):h(g,y),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=s((g,y)=>{f.result=[g,y];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,y)},i):b(g,y);setTimeout(()=>delete this.entries[t],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==h),f.callbacks.length||(f.cancel(),delete this.entries[t]))}}}function Hd(n,t,i){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},h=>{const f=gt(n.request,(g,y,b,w)=>{g?h(g):y&&h(null,{vectorTile:i?void 0:new ys.VectorTile(new xh(y)),rawData:y,cacheControl:b,expires:w})});return()=>{f.cancel(),h()}},t)}d.ARRAY_TYPE=$i,d.AUTH_ERR_MSG=tn,d.Aabb=Sn,d.Actor=class{constructor(n,t,i){this.target=n,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},pr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=cn()?n:zt,this.scheduler=new xg}send(n,t,i,s,h=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[g]=i);const y=so(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:oa(t,y)},y),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const t=n.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const s=this.cancelCallbacks[i];delete this.cancelCallbacks[i],s&&s.cancel()}else if(t.mustQueue||cn()){const s=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,t),s&&s.metadata||{type:"message"})}else this.processTask(i,t)}processTask(n,t){if("<response>"===t.type){const i=this.callbacks[n];delete this.callbacks[n],i&&(t.error?i(cs(t.error)):i(null,cs(t.data)))}else{const i=so(this.globalScope)?void 0:[],s=t.hasCallback?(f,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?oa(f):null,data:oa(g,i)},i)}:f=>{},h=cs(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,h,s);else if(this.parent.getWorkerSource){const f=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,f[0],h.source)[f[1]](h,s)}else s(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=Rl,d.Color=We,d.ColorMode=Tn,d.CullFaceMode=Dr,d.DEMData=lu,d.DataConstantProperty=rt,d.DedupedRequest=Eg,d.DepthMode=Sa,d.EXTENT=ce,d.Elevation=class{isDataAvailableAtPoint(n){const t=this._source();if(!t||n.y<0||n.y>1)return!1;const i=t.getSource().maxzoom,s=1<<i,h=Math.floor(n.x),f=Math.floor((n.x-h)*s),g=Math.floor(n.y*s),y=this.findDEMTileFor(new li(i,h,i,f,g));return!(!y||!y.dem)}getAtPointOrZero(n,t=0){return this.getAtPoint(n,t)||0}getAtPoint(n,t,i=!0){null==t&&(t=null);const s=this._source();if(!s||n.y<0||n.y>1)return t;const h=s.getSource().maxzoom,f=1<<h,g=Math.floor(n.x),y=n.x-g,b=new li(h,g,h,Math.floor(y*f),Math.floor(n.y*f)),w=this.findDEMTileFor(b);if(!w||!w.dem)return t;const S=w.dem,T=1<<w.tileID.canonical.z,k=(y*T-w.tileID.canonical.x)*S.dim,O=(n.y*T-w.tileID.canonical.y)*S.dim,L=Math.floor(k),B=Math.floor(O);return(i?this.exaggeration():1)*Oe(Oe(S.get(L,B),S.get(L,B+1),O-B),Oe(S.get(L+1,B),S.get(L+1,B+1),O-B),k-L)}getAtTileOffset(n,t,i){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Cl(n.wrap+(n.canonical.x+t/ce)/s,(n.canonical.y+i/ce)/s))}getAtTileOffsetFunc(n,t,i,s){return h=>{const f=this.getAtTileOffset(n,h.x,h.y),g=s.upVector(n.canonical,h.x,h.y);return On(g,g,f*s.upVectorScale(n.canonical,t,i).metersToTile),g}}getForTilePoints(n,t,i,s){const h=Ea.create(this,n,s);return!!h&&(t.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(n){const t=this.findDEMTileFor(n);if(!t||!t.dem)return null;const i=t.dem.tree,s=t.tileID,h=1<<n.canonical.z-s.canonical.z;let f=n.canonical.x/h-s.canonical.x,g=n.canonical.y/h-s.canonical.y,y=0;for(let b=0;b<n.canonical.z-s.canonical.z&&!i.leaves[y];b++){f*=2,g*=2;const w=2*Math.floor(g)+Math.floor(f);y=i.childOffsets[y]+w,f%=1,g%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=Ne,d.EvaluationParameters=H,d.Event=Ye,d.Evented=ie,d.FillExtrusionBucket=xa,d.Frustum=kp,d.FrustumCorners=pd,d.GLOBE_METERS_TO_ECEF=Od,d.GLOBE_RADIUS=bs,d.GLOBE_SCALE_MATCH_LATITUDE=45,d.GLOBE_ZOOM_THRESHOLD_MAX=6,d.GLOBE_ZOOM_THRESHOLD_MIN=5,d.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const t=new Ut,i=new Ae,s=65;for(let h=0;h<s;h++)for(let f=0;f<s;f++)t.emplaceBack(f,h);this._gridSegments=[];for(let h=0,f=0;h<Pn.length;h++){const g=Pn[h];for(let b=0;b<g;b++)for(let w=0;w<64;w++){const S=b*s+w;i.emplaceBack(S+1,S,S+s),i.emplaceBack(S+s,S+s+1,S+1)}const y=64*g*2;this._gridSegments.push(Ti.simpleSegment(0,f,(g+1)*s,y)),f+=y}this._gridBuffer=n.createVertexBuffer(t,Mh.members),this._gridIndexBuffer=n.createIndexBuffer(i,!0)}_createPoles(n){const t=new Ae;for(let h=0;h<=64;h++)t.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=n.createIndexBuffer(t,!0);const i=new nn,s=new nn;this._poleSegments=[];for(let h=0,f=0;h<5;h++){const g=360/(1<<h);i.emplaceBack(0,-bs,0,.5,0),s.emplaceBack(0,-bs,0,.5,1);for(let y=0;y<=64;y++){const b=y/64,w=Oe(0,g,b),[S,T,k]=Bl(wa,df,w,bs);i.emplaceBack(S,T,k,b,0),s.emplaceBack(S,T,k,b,1)}this._poleSegments.push(Ti.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,ug,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,ug,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,t){if(!this._wireframeSegments){const i=new rn,s=64,h=s+1;this._wireframeSegments=[];for(let f=0,g=0;f<Pn.length;f++){const y=Pn[f];for(let w=0;w<y;w++)for(let S=0;S<s;S++){const T=w*h+S;i.emplaceBack(T,T+1),i.emplaceBack(T,T+h),i.emplaceBack(T,T+h+1)}const b=y*s*3;this._wireframeSegments.push(Ti.simpleSegment(0,g,(y+1)*h,b)),g+=b}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},d.GlyphManager=Xc,d.ImagePosition=Wp,d.LineAtlas=bf,d.LngLat=He,d.LngLatBounds=ds,d.LocalGlyphMode=Kp,d.MAX_MERCATOR_LATITUDE=Xr,d.MercatorCoordinate=Cl,d.ONE_EM=24,d.OverscaledTileID=li,d.Properties=At,d.RGBAImage=Ln,d.Ray=dd,d.RequestManager=class{constructor(n,t,i){this._transformRequestFn=n,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Os,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,t){return this._transformRequestFn&&this._transformRequestFn(n,t)||{url:n}}normalizeStyleURL(n,t){if(!xn(n))return n;const i=vn(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(n,t){if(!xn(n))return n;const i=vn(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(n,t,i,s){if(!xn(n))return n;const h=vn(n);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),i&&h.params.push(`language=${i}`),s&&h.params.push(`worldview=${s}`),this._makeAPIURL(h,this._customAccessToken||t)}normalizeSpriteURL(n,t,i,s){const h=vn(n);return xn(n)?(h.path=`/styles/v1${h.path}/sprite${t}${i}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${t}${i}`,Rr(h))}normalizeTileURL(n,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!xn(n))return n;const s=vn(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==s.authority&&512===i?"@2x":""}${bi.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${Ie.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Ie.TILE_URL_VERSION}${s.path}`);const h=this._customAccessToken||function(f){for(const g of f){const y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||Ie.ACCESS_TOKEN;return Ie.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(n,t){const i=vn(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${Ie.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${Ie.TILE_URL_VERSION}/`,"")}`;let h=i.params;return t&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(n,t){const i=!!t&&xn(t),s=[];for(const h of n.tiles||[])lo(h)?s.push(this.canonicalizeTileURL(h,i)):s.push(h);return s}_makeAPIURL(n,t){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=vn(Ie.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,"http"===n.protocol){const h=n.params.indexOf("secure");h>=0&&n.params.splice(h,1)}if("/"!==s.path&&(n.path=`${s.path}${n.path}`),!Ie.REQUIRE_ACCESS_TOKEN)return Rr(n);if(t=t||Ie.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(h=>-1===h.indexOf("access_token")),n.params.push(`access_token=${t||""}`),Rr(n)}},d.ResourceType=ut,d.SegmentVector=Ti,d.SourceCache=Ms,d.StencilMode=Fh,d.StructArrayLayout1ui2=qr,d.StructArrayLayout2f1f2i16=or,d.StructArrayLayout2i4=Ut,d.StructArrayLayout2ui4=rn,d.StructArrayLayout3f12=fi,d.StructArrayLayout3ui6=Ae,d.StructArrayLayout4i8=ne,d.StructArrayLayout5f20=nn,d.Texture=su,d.Tile=au,d.Transitionable=J,d.Uniform1f=Wu,d.Uniform1i=class extends Do{constructor(n){super(n),this.current=0}set(n,t,i){this.fetchUniformLocation(n,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},d.Uniform2f=class extends Do{constructor(n){super(n),this.current=[0,0]}set(n,t,i){this.fetchUniformLocation(n,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},d.Uniform3f=class extends Do{constructor(n){super(n),this.current=[0,0,0]}set(n,t,i){this.fetchUniformLocation(n,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},d.Uniform4f=np,d.UniformColor=rp,d.UniformMatrix2f=class extends Do{constructor(n){super(n),this.current=Ng}set(n,t,i){if(this.fetchUniformLocation(n,t))for(let s=0;s<4;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},d.UniformMatrix3f=class extends Do{constructor(n){super(n),this.current=im}set(n,t,i){if(this.fetchUniformLocation(n,t))for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},d.UniformMatrix4f=class extends Do{constructor(n){super(n),this.current=em}set(n,t,i){if(this.fetchUniformLocation(n,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let s=1;s<16;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},d.UnwrappedTileID=Dm,d.ValidationError=$t,d.VectorTileWorkerSource=class extends ie{constructor(n,t,i,s,h){super(),this.actor=n,this.layerIndex=t,this.availableImages=i,this.loadVectorData=h||Hd,this.loading={},this.loaded={},this.deduped=new Eg(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,t){const i=n.uid,s=n&&n.request,h=s&&s.collectResourceTiming,f=this.loading[i]=new jd(n);f.abort=this.loadVectorData(n,(g,y)=>{const b=!this.loading[i];if(delete this.loading[i],b||g||!y)return f.status="done",b||(this.loaded[i]=f),t(g);const w=y.rawData,S={};y.expires&&(S.expires=y.expires),y.cacheControl&&(S.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new ys.VectorTile(new xh(w));const T=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,O)=>{if(k||!O)return t(k);const L={};if(h){const B=mr(s);B.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(B)))}t(null,Ve({rawTileData:w.slice(0)},O,S,L))})};this.isSpriteLoaded?T():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(T,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):T()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(n,t){const i=this.loaded,s=n.uid,h=this;if(i&&i[s]){const f=i[s];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain,f.projection=n.projection,f.tileTransform=Ca(n.tileID.canonical,n.projection);const g=(y,b)=>{const w=f.reloadCallback;w&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,w)),t(y,b)};"parsing"===f.status?f.reloadCallback=g:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,t){const i=n.uid,s=this.loading[i];s&&(s.abort&&s.abort(),delete this.loading[i]),t()}removeTile(n,t){const i=this.loaded,s=n.uid;i&&i[s]&&delete i[s],t()}},d.WritingMode=cr,d.ZoomHistory=wc,d.add=fs,d.addDynamicAttributes=ou,d.adjoint=function(n,t){var i=t[0],s=t[1],h=t[2],f=t[3],g=t[4],y=t[5],b=t[6],w=t[7],S=t[8];return n[0]=g*S-y*w,n[1]=h*w-s*S,n[2]=s*y-h*g,n[3]=y*b-f*S,n[4]=i*S-h*b,n[5]=h*f-i*y,n[6]=f*w-g*b,n[7]=s*b-i*w,n[8]=i*g-s*f,n},d.asyncAll=Qi,d.bezier=no,d.bindAll=pr,d.boundsAttributes=Sf,d.bufferConvexPolygon=function(n,t){const i=[];for(let s=0;s<n.length;s++){const h=Fr(s-1,-1,n.length-1),f=Fr(s+1,-1,n.length-1),g=n[s],y=n[f],b=n[h].sub(g).unit(),w=y.sub(g).unit(),S=w.angleWithSep(b.x,b.y),T=b.add(w).unit().mult(-1*t/Math.sin(S/2));i.push(g.add(T))}return i},d.cacheEntryPossiblyAdded=function(n){Q++,Q>Yo&&(n.getActor().send("enforceCacheSizeLimit",$o),Q=0)},d.calculateGlobeLabelMatrix=function(n,t){const{x:i,y:s}=n.point,h=uf(i,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Sl(h,h,ba(Tr(t)))},d.calculateGlobeMatrix=function(n){const{x:t,y:i}=n.point,{lng:s,lat:h}=n._center;return uf(t,i,n.worldSize,s,h)},d.calculateGlobeMercatorMatrix=function(n){const t=n.pixelsPerMeter,i=t/sr(1,n.center.lat),s=Mr(new Float64Array(16));return Oc(s,s,[n.point.x,n.point.y,0]),fa(s,s,[i,i,t]),Float32Array.from(s)},d.circumferenceAtLatitude=ap,d.clamp=ye,d.clearTileCache=function(n){const t=Y(),i=[];for(const s in Fi)t&&i.push(t.delete(s)),delete Fi[s];n&&Promise.all(i).catch(n).then(()=>n())},d.clipLine=ig,d.clone=function(n){var t=new $i(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},d.clone$1=gn,d.collisionCircleLayout=Kg,d.config=Ie,d.conjugate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n},d.create=function(){var n=new $i(16);return $i!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},d.create$1=pa,d.createExpression=rs,d.createLayout=Tt,d.createStyleLayer=function(n){return"custom"===n.type?new P_(n):new yg[n.type](n)},d.cross=wp,d.degToRad=_e,d.distance=function(n,t){return Math.hypot(t[0]-n[0],t[1]-n[1],t[2]-n[2])},d.div=function(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n[2]=t[2]/i[2],n},d.dot=Zn,d.ease=No,d.easeCubicInOut=Go,d.emitValidationErrors=gl,d.endsWith=oo,d.enforceCacheSizeLimit=function(n){for(const t in Fi)P(t),Fi[t].then(i=>{i.keys().then(s=>{for(let h=0;h<s.length-n;h++)i.delete(s[h])})})},d.evaluateSizeForFeature=Sd,d.evaluateSizeForZoom=Zc,d.evaluateVariableOffset=ag,d.evented=R,d.exactEquals=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},d.exactEquals$1=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]},d.exported=yn,d.exported$1=bi,d.extend=Ve,d.extend$1=bn,d.fillExtrusionHeightLift=Tm,d.filterObject=Lr,d.fromMat4=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[4],n[4]=t[5],n[5]=t[6],n[6]=t[8],n[7]=t[9],n[8]=t[10],n},d.fromQuat=function(n,t){var i=t[0],s=t[1],h=t[2],f=t[3],g=i+i,y=s+s,b=h+h,w=i*g,S=s*g,T=s*y,k=h*g,O=h*y,L=h*b,B=f*g,N=f*y,X=f*b;return n[0]=1-T-L,n[1]=S+X,n[2]=k-N,n[3]=0,n[4]=S-X,n[5]=1-w-L,n[6]=O+B,n[7]=0,n[8]=k+N,n[9]=O-B,n[10]=1-w-T,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},d.fromRotation=function(n,t){var i=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},d.fromScaling=yp,d.furthestTileCorner=function(n){const t=Math.round((n+45+360)%360/90)%4;return Oa[t]},d.getAABBPointSquareDist=function(n,t,i){let s=0;for(let h=0;h<2;++h){const f=i?i[h]:0;n[h]>f&&(s+=(n[h]-f)*(n[h]-f)),t[h]<f&&(s+=(f-t[h])*(f-t[h]))}return s},d.getAnchorAlignment=Jp,d.getAnchorJustification=tf,d.getBounds=function(n){let t=1/0,i=1/0,s=-1/0,h=-1/0;for(const f of n)t=Math.min(t,f.x),i=Math.min(i,f.y),s=Math.max(s,f.x),h=Math.max(h,f.y);return{min:new jt(t,i),max:new jt(s,h)}},d.getColumn=Nn,d.getGridMatrix=function(n,t,i){const s=t.getNorth(),h=t.getSouth(),f=t.getWest(),g=.015625;return[0,(t.getEast()-f)*g,1<<n.z,(h-s)/Pn[i],0,n.y,s,f,g]},d.getImage=oe,d.getJSON=function(n,t){return ht(Ve(n,{type:"json"}),t)},d.getLatitudinalLod=function(n){const t=80.051129;n=ye(n,-80.051129,t)/t*90;const i=Math.pow(Math.abs(Math.sin(_e(n))),3);return Math.round(i*(Pn.length-1))},d.getMapSessionAPI=Va,d.getPerformanceMeasurement=mr,d.getProjection=gf,d.getRTLTextPluginStatus=V,d.getReferrer=pt,d.getTilePoint=function(n,{x:t,y:i},s=0){return new jt(((t-s)*n.scale-n.x)*ce,(i*n.scale-n.y)*ce)},d.getTileVec3=function(n,t,i=0){return El(((t.x-i)*n.scale-n.x)*ce,(t.y*n.scale-n.y)*ce,lp(t.z,t.y))},d.getVideo=function(n,t){const i=zt.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let s=0;s<n.length;s++){const h=zt.document.createElement("source");Ot(n[s])||(i.crossOrigin="Anonymous"),h.src=n[s],i.appendChild(h)}return{cancel:()=>{}}},d.globeCenterToScreenPoint=function(n){const t=[0,0,0],i=Mr(new Float64Array(16));return Sl(i,n.pixelMatrix,n.globeMatrix),Pi(t,t,i),new jt(t[0],t[1])},d.globeDenormalizeECEF=ba,d.globeECEFOrigin=function(n,t){const i=[0,0,0];return Pi(i,i,tu(Tr(t.canonical))),Pi(i,i,n),i},d.globeNormalizeECEF=tu,d.globePixelsToTileUnits=function(n,t){return ce/(512*Math.pow(2,n))*Qc(Tr(t))},d.globePoleMatrixForTile=function(n,t,i){const s=Mr(new Float64Array(16)),h=(t/(1<<n)-.5)*Math.PI*2;return th(s,i.globeMatrix,h),Float32Array.from(s)},d.globeTileBounds=Tr,d.globeTiltAtLngLat=hf,d.globeToMercatorTransition=Vl,d.globeUseCustomAntiAliasing=function(n,t,i){const s=Vl(i.zoom),h=n.style.map._antialias,f=!!t.extStandardDerivatives,g=t.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===s&&!h&&!g&&f},d.identity=Mr,d.identity$1=Sp,d.invert=ld,d.isFullscreen=function(){return!!zt.document.fullscreenElement||!!zt.document.webkitFullscreenElement},d.isLngLatBehindGlobe=function(n,t){return hf(n,t)>Math.PI/2*1.01},d.isMapAuthenticated=function(n){return zr.has(n)},d.isMapboxURL=xn,d.isSafariWithAntialiasingBug=function(n){const t=n.navigator?n.navigator.userAgent:null;return!!so(n)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},d.latFromMercatorY=Zi,d.len=Cp,d.length=Lc,d.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},d.loadVectorTile=Hd,d.makeRequest=ht,d.mapValue=function(n,t,i,s,h){return ye((n-t)/(i-t)*(h-s)+s,s,h)},d.mercatorScale=cm,d.mercatorXfromLng=Wr,d.mercatorYfromLat=Fo,d.mercatorZfromAltitude=sr,d.mul=mm,d.mul$1=kl,d.multiply=Sl,d.multiply$1=function(n,t,i){var s=t[0],h=t[1],f=t[2],g=t[3],y=t[4],b=t[5],w=t[6],S=t[7],T=t[8],k=i[0],O=i[1],L=i[2],B=i[3],N=i[4],X=i[5],it=i[6],K=i[7],tt=i[8];return n[0]=k*s+O*g+L*w,n[1]=k*h+O*y+L*S,n[2]=k*f+O*b+L*T,n[3]=B*s+N*g+X*w,n[4]=B*h+N*y+X*S,n[5]=B*f+N*b+X*T,n[6]=it*s+K*g+tt*w,n[7]=it*h+K*y+tt*S,n[8]=it*f+K*b+tt*T,n},d.multiply$2=bp,d.nextPowerOfTwo=Ts,d.normalize=Yi,d.normalize$1=function(n,t){var i=t[0],s=t[1],h=t[2],f=t[3],g=i*i+s*s+h*h+f*f;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=s*g,n[2]=h*g,n[3]=f*g,n},d.number=Oe,d.ortho=function(n,t,i,s,h,f,g){var y=1/(t-i),b=1/(s-h),w=1/(f-g);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(t+i)*y,n[13]=(h+s)*b,n[14]=(g+f)*w,n[15]=1,n},d.pbf=xh,d.perspective=function(n,t,i,s,h){var f,g=1/Math.tan(t/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=h&&h!==1/0?(n[10]=(h+s)*(f=1/(s-h)),n[14]=2*h*s*f):(n[10]=-1,n[14]=-2*s),n},d.pick=function(n,t){const i={};for(let s=0;s<t.length;s++){const h=t[s];h in n&&(i[h]=n[h])}return i},d.plugin=j,d.pointGeometry=jt,d.polygonContainsPoint=da,d.polygonIntersectsBox=mp,d.polygonIntersectsPolygon=up,d.polygonizeBounds=function(n,t,i=0,s=!0){const h=new jt(i,i),f=n.sub(h),g=t.add(h),y=[f,new jt(g.x,f.y),g,new jt(f.x,g.y)];return s&&y.push(f.clone()),y},d.posAttributes=Mh,d.postMapLoadEvent=Xl,d.postTurnstileEvent=Ra,d.potpack=Yp,d.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},d.radToDeg=si,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(n){return n({pluginStatus:A,pluginURL:E}),R.on("pluginStateChange",n),n},d.removeAuthState=function(n){zr.delete(n)},d.renderColorRamp=En,d.resample=cp,d.rotateX=cd,d.rotateX$1=Ep,d.rotateY=th,d.rotateY$1=Tp,d.rotateZ=function(n,t,i){var s=Math.sin(i),h=Math.cos(i),f=t[0],g=t[1],y=t[2],b=t[3],w=t[4],S=t[5],T=t[6],k=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=f*h+w*s,n[1]=g*h+S*s,n[2]=y*h+T*s,n[3]=b*h+k*s,n[4]=w*h-f*s,n[5]=S*h-g*s,n[6]=T*h-y*s,n[7]=k*h-b*s,n},d.rotateZ$1=function(n,t,i){i*=.5;var s=t[0],h=t[1],f=t[2],g=t[3],y=Math.sin(i),b=Math.cos(i);return n[0]=s*b+h*y,n[1]=h*b-s*y,n[2]=f*b+g*y,n[3]=g*b-f*y,n},d.scale=fa,d.scale$1=Mp,d.scale$2=On,d.scaleAndAdd=Pc,d.setCacheLimits=function(n,t){$o=n,Yo=t},d.setColumn=function(n,t,i){n[4*t+0]=i[0],n[4*t+1]=i[1],n[4*t+2]=i[2],n[4*t+3]=i[3]},d.setRTLTextPlugin=function(n,t,i=!1){if(A===m||A===x||A===v)throw new Error("setRTLTextPlugin cannot be called multiple times.");E=yn.resolveURL(n),A=m,M=t,I(),i||Z()},d.smoothstep=kn,d.spec=Ct,d.storeAuthState=function(n,t){t?zr.add(n):zr.delete(n)},d.sub=Kr,d.subtract=hd,d.symbolSize=Qg,d.tileAABB=function(n,t,i,s,h,f,g,y,b){if("globe"===b.name)return function Ah(n,t,i){const s=t/n.worldSize,h=Number.MAX_VALUE,f=[-h,-h,-h],g=[h,h,h],y=n.globeMatrix;if(i.z<=1)return af(g,f,Tr(i).getCorners(),y,s),new Sn(g,f);const b=Sh(i),w=lf(b);if(af(g,f,w,y,s),b.contains(n.center)){f[2]=0;const vt=n.point,xt=[vt.x*s,vt.y*s,0];return Lo(g,g,xt),Tl(f,f,xt),new Sn(g,f)}const S=[y[12]*s,y[13]*s,y[14]*s],T=b.getCenter(),k=ye(n.center.lat,-85.051129,Xr),O=ye(T.lat,-85.051129,Xr),L=Wr(n.center.lng),B=Fo(k);let N=L-Wr(T.lng);const X=B-Fo(O);N>.5?N-=1:N<-.5&&(N+=1);let it=0;Math.abs(N)>Math.abs(X)?it=N>=0?1:3:(it=X>=0?0:2,Pc(S,S,[y[4]*s,y[5]*s,y[6]*s],-Math.sin(_e(X>=0?b.getSouth():b.getNorth()))*bs));const K=w[it],tt=w[(it+1)%4],ct=new rf(K,tt,S),nt=[Kc(ct,0)||K[0],Kc(ct,1)||K[1],Kc(ct,2)||K[2]];return g[2]=Math.min(K[2],tt[2]),Lo(g,g,nt),Tl(f,f,nt),new Sn(g,f)}(n,t,new Rl(i,s,h));const w=Ca({z:i,x:s,y:h},b);return new Sn([(f+w.x/w.scale)*t,t*(w.y/w.scale),g],[(f+w.x2/w.scale)*t,t*(w.y2/w.scale),y])},d.tileCornersToBounds=Sh,d.tileTransform=Ca,d.transformMat3=function(n,t,i){var s=t[0],h=t[1],f=t[2];return n[0]=s*i[0]+h*i[3]+f*i[6],n[1]=s*i[1]+h*i[4]+f*i[7],n[2]=s*i[2]+h*i[5]+f*i[8],n},d.transformMat4=Pi,d.transformMat4$1=ma,d.transformQuat=Ar,d.transitionTileAABBinECEF=sf,d.translate=Oc,d.transpose=function(n,t){if(n===t){var i=t[1],s=t[2],h=t[5];n[1]=t[3],n[2]=t[6],n[3]=i,n[5]=t[7],n[6]=s,n[7]=h}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n},d.triggerPluginCompletionEvent=D,d.uniqueId=Uo,d.updateGlobeVertexNormal=function(n,t,i,s,h){const f=5*t+2;n.float32[f+0]=i,n.float32[f+1]=s,n.float32[f+2]=h},d.validateCustomStyleLayer=function(n){const t=[],i=n.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===n.render&&t.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},d.validateFilter=n=>nr(as(n)),d.validateFog=n=>nr(zu(n)),d.validateLayer=n=>nr(fl(n)),d.validateLight=n=>nr(Ru(n)),d.validateSource=n=>nr(Pu(n)),d.validateStyle=ra,d.validateTerrain=n=>nr(ls(n)),d.values=ro,d.vectorTile=ys,d.version="2.10.0",d.warnOnce=hi,d.window=zt,d.wrap=Fr}),io(0,function(d){function zt(Y){if("number"==typeof Y||"boolean"==typeof Y||"string"==typeof Y||null==Y)return JSON.stringify(Y);if(Array.isArray(Y)){let z="[";for(const W of Y)z+=`${zt(W)},`;return`${z}]`}let P="{";for(const z of Object.keys(Y).sort())P+=`${z}:${zt(Y[z])},`;return`${P}}`}function dr(Y){let P="";for(const z of d.refProperties)P+=`/${zt(Y[z])}`;return P}class ui{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,z){for(const Q of P)this._layerConfigs[Q.id]=Q,(this._layers[Q.id]=d.createStyleLayer(Q)).compileFilter(),this.keyCache[Q.id]&&delete this.keyCache[Q.id];for(const Q of z)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const W=function(Q,ut){const ft={};for(let ht=0;ht<Q.length;ht++){const gt=ut&&ut[Q[ht].id]||dr(Q[ht]);ut&&(ut[Q[ht].id]=gt);let Dt=ft[gt];Dt||(Dt=ft[gt]=[]),Dt.push(Q[ht])}const pt=[];for(const ht in ft)pt.push(ft[ht]);return pt}(d.values(this._layerConfigs),this.keyCache);for(const Q of W){const ut=Q.map(Yt=>this._layers[Yt.id]),ft=ut[0];if("none"===ft.visibility)continue;const pt=ft.source||"";let ht=this.familiesBySource[pt];ht||(ht=this.familiesBySource[pt]={});const gt=ft.sourceLayer||"_geojsonTileLayer";let Dt=ht[gt];Dt||(Dt=ht[gt]=[]),Dt.push(ut)}}}class jt{loadTile(P,z){const{uid:W,encoding:Q,rawImageData:ut,padding:ft,buildQuadTree:pt}=P,ht=d.window.ImageBitmap&&ut instanceof d.window.ImageBitmap?this.getImageData(ut,ft):ut;z(null,new d.DEMData(W,ht,Q,ft<1,pt))}getImageData(P,z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const W=this.offscreenCanvasContext.getImageData(-z,-z,P.width+2*z,P.height+2*z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),W}}var Se=function Y(P,z){var W,Q=P&&P.type;if("FeatureCollection"===Q)for(W=0;W<P.features.length;W++)Y(P.features[W],z);else if("GeometryCollection"===Q)for(W=0;W<P.geometries.length;W++)Y(P.geometries[W],z);else if("Feature"===Q)Y(P.geometry,z);else if("Polygon"===Q)Ki(P.coordinates,z);else if("MultiPolygon"===Q)for(W=0;W<P.coordinates.length;W++)Ki(P.coordinates[W],z);return P};function Ki(Y,P){if(0!==Y.length){Vn(Y[0],P);for(var z=1;z<Y.length;z++)Vn(Y[z],!P)}}function Vn(Y,P){for(var z=0,W=0,Q=0,ut=Y.length,ft=ut-1;Q<ut;ft=Q++){var pt=(Y[Q][0]-Y[ft][0])*(Y[ft][1]+Y[Q][1]),ht=z+pt;W+=Math.abs(z)>=Math.abs(pt)?z-ht+pt:pt-ht+z,z=ht}z+W>=0!=!!P&&Y.reverse()}const _e=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class si{constructor(P){this._feature=P,this.extent=d.EXTENT,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(1===this._feature.type){const P=[];for(const z of this._feature.geometry)P.push([new d.pointGeometry(z[0],z[1])]);return P}{const P=[];for(const z of this._feature.geometry){const W=[];for(const Q of z)W.push(new d.pointGeometry(Q[0],Q[1]));P.push(W)}return P}}toGeoJSON(P,z,W){return _e.call(this,P,z,W)}}class Oa{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=P.length,this._features=P}feature(P){return new si(this._features[P])}}var Go=d.vectorTile.VectorTileFeature,no=No;function No(Y,P){this.options=P||{},this.features=Y,this.length=Y.length}function ye(Y,P){this.id="number"==typeof Y.id?Y.id:void 0,this.type=Y.type,this.rawGeometry=1===Y.type?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=P||4096}No.prototype.feature=function(Y){return new ye(this.features[Y],this.options.extent)},ye.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var P=0;P<Y.length;P++){for(var z=Y[P],W=[],Q=0;Q<z.length;Q++)W.push(new d.pointGeometry(z[Q][0],z[Q][1]));this.geometry.push(W)}return this.geometry},ye.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,P=1/0,z=-1/0,W=1/0,Q=-1/0,ut=0;ut<Y.length;ut++)for(var ft=Y[ut],pt=0;pt<ft.length;pt++){var ht=ft[pt];P=Math.min(P,ht.x),z=Math.max(z,ht.x),W=Math.min(W,ht.y),Q=Math.max(Q,ht.y)}return[P,W,z,Q]},ye.prototype.toGeoJSON=Go.prototype.toGeoJSON;var kn=Qi,Fr=no;function Qi(Y){var P=new d.pbf;return function(z,W){for(var Q in z.layers)W.writeMessage(3,ro,z.layers[Q])}(Y,P),P.finish()}function ro(Y,P){var z;P.writeVarintField(15,Y.version||1),P.writeStringField(1,Y.name||""),P.writeVarintField(5,Y.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<Y.length;z++)W.feature=Y.feature(z),P.writeMessage(2,Ve,W);var Q=W.keys;for(z=0;z<Q.length;z++)P.writeStringField(3,Q[z]);var ut=W.values;for(z=0;z<ut.length;z++)P.writeMessage(4,ks,ut[z])}function Ve(Y,P){var z=Y.feature;void 0!==z.id&&P.writeVarintField(1,z.id),P.writeMessage(2,Yn,Y),P.writeVarintField(3,z.type),P.writeMessage(4,Ts,z)}function Yn(Y,P){var z=Y.feature,W=Y.keys,Q=Y.values,ut=Y.keycache,ft=Y.valuecache;for(var pt in z.properties){var ht=z.properties[pt],gt=ut[pt];if(null!==ht){void 0===gt&&(W.push(pt),ut[pt]=gt=W.length-1),P.writeVarint(gt);var Dt=typeof ht;"string"!==Dt&&"boolean"!==Dt&&"number"!==Dt&&(ht=JSON.stringify(ht));var Yt=Dt+":"+ht,Ot=ft[Yt];void 0===Ot&&(Q.push(ht),ft[Yt]=Ot=Q.length-1),P.writeVarint(Ot)}}}function Uo(Y,P){return(P<<3)+(7&Y)}function Or(Y){return Y<<1^Y>>31}function Ts(Y,P){for(var z=Y.loadGeometry(),W=Y.type,Q=0,ut=0,ft=z.length,pt=0;pt<ft;pt++){var ht=z[pt],gt=1;1===W&&(gt=ht.length),P.writeVarint(Uo(1,gt));for(var Dt=3===W?ht.length-1:ht.length,Yt=0;Yt<Dt;Yt++){1===Yt&&1!==W&&P.writeVarint(Uo(2,Dt-1));var Ot=ht[Yt].x-Q,re=ht[Yt].y-ut;P.writeVarint(Or(Ot)),P.writeVarint(Or(re)),Q+=Ot,ut+=re}3===W&&P.writeVarint(Uo(7,1))}}function ks(Y,P){var z=typeof Y;"string"===z?P.writeStringField(1,Y):"boolean"===z?P.writeBooleanField(7,Y):"number"===z&&(Y%1!=0?P.writeDoubleField(3,Y):Y<0?P.writeSVarintField(6,Y):P.writeVarintField(5,Y))}function pr(Y,P,z,W,Q,ut){if(Q-W<=z)return;const ft=W+Q>>1;oo(Y,P,ft,W,Q,ut%2),pr(Y,P,z,W,ft-1,ut+1),pr(Y,P,z,ft+1,Q,ut+1)}function oo(Y,P,z,W,Q,ut){for(;Q>W;){if(Q-W>600){const gt=Q-W+1,Dt=z-W+1,Yt=Math.log(gt),Ot=.5*Math.exp(2*Yt/3),re=.5*Math.sqrt(Yt*Ot*(gt-Ot)/gt)*(Dt-gt/2<0?-1:1);oo(Y,P,z,Math.max(W,Math.floor(z-Dt*Ot/gt+re)),Math.min(Q,Math.floor(z+(gt-Dt)*Ot/gt+re)),ut)}const ft=P[2*z+ut];let pt=W,ht=Q;for(Gn(Y,P,W,z),P[2*Q+ut]>ft&&Gn(Y,P,W,Q);pt<ht;){for(Gn(Y,P,pt,ht),pt++,ht--;P[2*pt+ut]<ft;)pt++;for(;P[2*ht+ut]>ft;)ht--}P[2*W+ut]===ft?Gn(Y,P,W,ht):(ht++,Gn(Y,P,ht,Q)),ht<=z&&(W=ht+1),z<=ht&&(Q=ht-1)}}function Gn(Y,P,z,W){Lr(Y,z,W),Lr(P,2*z,2*W),Lr(P,2*z+1,2*W+1)}function Lr(Y,P,z){const W=Y[P];Y[P]=Y[z],Y[z]=W}function gn(Y,P,z,W){const Q=Y-z,ut=P-W;return Q*Q+ut*ut}kn.fromVectorTileJs=Qi,kn.fromGeojsonVt=function(Y,P){P=P||{};var z={};for(var W in Y)z[W]=new no(Y[W].features,P),z[W].name=W,z[W].version=P.version,z[W].extent=P.extent;return Qi({layers:z})},kn.GeoJSONWrapper=Fr;const jo=Y=>Y[0],hi=Y=>Y[1];class zi{constructor(P,z=jo,W=hi,Q=64,ut=Float64Array){this.nodeSize=Q,this.points=P;const ft=P.length<65536?Uint16Array:Uint32Array,pt=this.ids=new ft(P.length),ht=this.coords=new ut(2*P.length);for(let gt=0;gt<P.length;gt++)pt[gt]=gt,ht[2*gt]=z(P[gt]),ht[2*gt+1]=W(P[gt]);pr(pt,ht,Q,0,pt.length-1,0)}range(P,z,W,Q){return function(ut,ft,pt,ht,gt,Dt,Yt){const Ot=[0,ut.length-1,0],re=[];let se,te;for(;Ot.length;){const oe=Ot.pop(),xe=Ot.pop(),Ge=Ot.pop();if(xe-Ge<=Yt){for(let ie=Ge;ie<=xe;ie++)se=ft[2*ie],te=ft[2*ie+1],se>=pt&&se<=gt&&te>=ht&&te<=Dt&&re.push(ut[ie]);continue}const Ye=Math.floor((Ge+xe)/2);se=ft[2*Ye],te=ft[2*Ye+1],se>=pt&&se<=gt&&te>=ht&&te<=Dt&&re.push(ut[Ye]);const Ne=(oe+1)%2;(0===oe?pt<=se:ht<=te)&&(Ot.push(Ge),Ot.push(Ye-1),Ot.push(Ne)),(0===oe?gt>=se:Dt>=te)&&(Ot.push(Ye+1),Ot.push(xe),Ot.push(Ne))}return re}(this.ids,this.coords,P,z,W,Q,this.nodeSize)}within(P,z,W){return function(Q,ut,ft,pt,ht,gt){const Dt=[0,Q.length-1,0],Yt=[],Ot=ht*ht;for(;Dt.length;){const re=Dt.pop(),se=Dt.pop(),te=Dt.pop();if(se-te<=gt){for(let Ne=te;Ne<=se;Ne++)gn(ut[2*Ne],ut[2*Ne+1],ft,pt)<=Ot&&Yt.push(Q[Ne]);continue}const oe=Math.floor((te+se)/2),xe=ut[2*oe],Ge=ut[2*oe+1];gn(xe,Ge,ft,pt)<=Ot&&Yt.push(Q[oe]);const Ye=(re+1)%2;(0===re?ft-ht<=xe:pt-ht<=Ge)&&(Dt.push(te),Dt.push(oe-1),Dt.push(Ye)),(0===re?ft+ht>=xe:pt+ht>=Ge)&&(Dt.push(oe+1),Dt.push(se),Dt.push(Ye))}return Yt}(this.ids,this.coords,P,z,W,this.nodeSize)}}const Wn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},cn=Math.fround||(Xn=new Float32Array(1),Y=>(Xn[0]=+Y,Xn[0]));var Xn;class fr{constructor(P){this.options=Jn(Object.create(Wn),P),this.trees=new Array(this.options.maxZoom+1)}load(P){const{log:z,minZoom:W,maxZoom:Q,nodeSize:ut}=this.options;z&&console.time("total time");const ft=`prepare ${P.length} points`;z&&console.time(ft),this.points=P;let pt=[];for(let ht=0;ht<P.length;ht++)P[ht].geometry&&pt.push(Ho(P[ht],ht));this.trees[Q+1]=new zi(pt,gr,_n,ut,Float32Array),z&&console.timeEnd(ft);for(let ht=Q;ht>=W;ht--){const gt=+Date.now();pt=this._cluster(pt,ht),this.trees[ht]=new zi(pt,gr,_n,ut,Float32Array),z&&console.log("z%d: %d clusters in %dms",ht,pt.length,+Date.now()-gt)}return z&&console.timeEnd("total time"),this}getClusters(P,z){let W=((P[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,P[1]));let ut=180===P[2]?180:((P[2]+180)%360+360)%360-180;const ft=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)W=-180,ut=180;else if(W>ut){const Dt=this.getClusters([W,Q,180,ft],z),Yt=this.getClusters([-180,Q,ut,ft],z);return Dt.concat(Yt)}const pt=this.trees[this._limitZoom(z)],ht=pt.range(mr(W),Pr(ft),mr(ut),Pr(Q)),gt=[];for(const Dt of ht){const Yt=pt.points[Dt];gt.push(Yt.numPoints?Nn(Yt):this.points[Yt.index])}return gt}getChildren(P){const z=this._getOriginId(P),W=this._getOriginZoom(P),Q="No cluster with the specified id.",ut=this.trees[W];if(!ut)throw new Error(Q);const ft=ut.points[z];if(!ft)throw new Error(Q);const pt=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ht=ut.within(ft.x,ft.y,pt),gt=[];for(const Dt of ht){const Yt=ut.points[Dt];Yt.parentId===P&&gt.push(Yt.numPoints?Nn(Yt):this.points[Yt.index])}if(0===gt.length)throw new Error(Q);return gt}getLeaves(P,z,W){const Q=[];return this._appendLeaves(Q,P,z=z||10,W=W||0,0),Q}getTile(P,z,W){const Q=this.trees[this._limitZoom(P)],ut=Math.pow(2,P),{extent:ft,radius:pt}=this.options,ht=pt/ft,gt=(W-ht)/ut,Dt=(W+1+ht)/ut,Yt={features:[]};return this._addTileFeatures(Q.range((z-ht)/ut,gt,(z+1+ht)/ut,Dt),Q.points,z,W,ut,Yt),0===z&&this._addTileFeatures(Q.range(1-ht/ut,gt,1,Dt),Q.points,ut,W,ut,Yt),z===ut-1&&this._addTileFeatures(Q.range(0,gt,ht/ut,Dt),Q.points,-1,W,ut,Yt),Yt.features.length?Yt:null}getClusterExpansionZoom(P){let z=this._getOriginZoom(P)-1;for(;z<=this.options.maxZoom;){const W=this.getChildren(P);if(z++,1!==W.length)break;P=W[0].properties.cluster_id}return z}_appendLeaves(P,z,W,Q,ut){const ft=this.getChildren(z);for(const pt of ft){const ht=pt.properties;if(ht&&ht.cluster?ut+ht.point_count<=Q?ut+=ht.point_count:ut=this._appendLeaves(P,ht.cluster_id,W,Q,ut):ut<Q?ut++:P.push(pt),P.length===W)break}return ut}_addTileFeatures(P,z,W,Q,ut,ft){for(const pt of P){const ht=z[pt],gt=ht.numPoints;let Dt,Yt,Ot;if(gt)Dt=Ds(ht),Yt=ht.x,Ot=ht.y;else{const te=this.points[ht.index];Dt=te.properties,Yt=mr(te.geometry.coordinates[0]),Ot=Pr(te.geometry.coordinates[1])}const re={type:1,geometry:[[Math.round(this.options.extent*(Yt*ut-W)),Math.round(this.options.extent*(Ot*ut-Q))]],tags:Dt};let se;gt?se=ht.id:this.options.generateId?se=ht.index:this.points[ht.index].id&&(se=this.points[ht.index].id),void 0!==se&&(re.id=se),ft.features.push(re)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(+P,this.options.maxZoom+1))}_cluster(P,z){const W=[],{radius:Q,extent:ut,reduce:ft,minPoints:pt}=this.options,ht=Q/(ut*Math.pow(2,z));for(let gt=0;gt<P.length;gt++){const Dt=P[gt];if(Dt.zoom<=z)continue;Dt.zoom=z;const Yt=this.trees[z+1],Ot=Yt.within(Dt.x,Dt.y,ht),re=Dt.numPoints||1;let se=re;for(const te of Ot){const oe=Yt.points[te];oe.zoom>z&&(se+=oe.numPoints||1)}if(se>re&&se>=pt){let te=Dt.x*re,oe=Dt.y*re,xe=ft&&re>1?this._map(Dt,!0):null;const Ge=(gt<<5)+(z+1)+this.points.length;for(const Ye of Ot){const Ne=Yt.points[Ye];if(Ne.zoom<=z)continue;Ne.zoom=z;const ie=Ne.numPoints||1;te+=Ne.x*ie,oe+=Ne.y*ie,Ne.parentId=Ge,ft&&(xe||(xe=this._map(Dt,!0)),ft(xe,this._map(Ne)))}Dt.parentId=Ge,W.push(so(te/se,oe/se,Ge,se,xe))}else if(W.push(Dt),se>1)for(const te of Ot){const oe=Yt.points[te];oe.zoom<=z||(oe.zoom=z,W.push(oe))}}return W}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,z){if(P.numPoints)return z?Jn({},P.properties):P.properties;const W=this.points[P.index].properties,Q=this.options.map(W);return z&&Q===W?Jn({},Q):Q}}function so(Y,P,z,W,Q){return{x:cn(Y),y:cn(P),zoom:1/0,id:z,parentId:-1,numPoints:W,properties:Q}}function Ho(Y,P){const[z,W]=Y.geometry.coordinates;return{x:cn(mr(z)),y:cn(Pr(W)),zoom:1/0,index:P,parentId:-1}}function Nn(Y){return{type:"Feature",id:Y.id,properties:Ds(Y),geometry:{type:"Point",coordinates:[(P=Y.x,360*(P-.5)),Fe(Y.y)]}};var P}function Ds(Y){const P=Y.numPoints,z=P>=1e4?`${Math.round(P/1e3)}k`:P>=1e3?Math.round(P/100)/10+"k":P;return Jn(Jn({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:P,point_count_abbreviated:z})}function mr(Y){return Y/360+.5}function Pr(Y){const P=Math.sin(Y*Math.PI/180),z=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return z<0?0:z>1?1:z}function Fe(Y){const P=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function Jn(Y,P){for(const z in P)Y[z]=P[z];return Y}function gr(Y){return Y.x}function _n(Y){return Y.y}function yn(Y,P,z,W){for(var Q,ut=W,ft=z-P>>1,pt=z-P,ht=Y[P],gt=Y[P+1],Dt=Y[z],Yt=Y[z+1],Ot=P+3;Ot<z;Ot+=3){var re=ao(Y[Ot],Y[Ot+1],ht,gt,Dt,Yt);if(re>ut)Q=Ot,ut=re;else if(re===ut){var se=Math.abs(Ot-ft);se<pt&&(Q=Ot,pt=se)}}ut>W&&(Q-P>3&&yn(Y,P,Q,W),Y[Q+2]=ut,z-Q>3&&yn(Y,Q,z,W))}function ao(Y,P,z,W,Q,ut){var ft=Q-z,pt=ut-W;if(0!==ft||0!==pt){var ht=((Y-z)*ft+(P-W)*pt)/(ft*ft+pt*pt);ht>1?(z=Q,W=ut):ht>0&&(z+=ft*ht,W+=pt*ht)}return(ft=Y-z)*ft+(pt=P-W)*pt}function Ie(Y,P,z,W){var Q={id:void 0===Y?null:Y,type:P,geometry:z,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ut){var ft=ut.geometry,pt=ut.type;if("Point"===pt||"MultiPoint"===pt||"LineString"===pt)bi(ut,ft);else if("Polygon"===pt||"MultiLineString"===pt)for(var ht=0;ht<ft.length;ht++)bi(ut,ft[ht]);else if("MultiPolygon"===pt)for(ht=0;ht<ft.length;ht++)for(var gt=0;gt<ft[ht].length;gt++)bi(ut,ft[ht][gt])}(Q),Q}function bi(Y,P){for(var z=0;z<P.length;z+=3)Y.minX=Math.min(Y.minX,P[z]),Y.minY=Math.min(Y.minY,P[z+1]),Y.maxX=Math.max(Y.maxX,P[z]),Y.maxY=Math.max(Y.maxY,P[z+1])}function Ii(Y,P,z,W){if(P.geometry){var Q=P.geometry.coordinates,ut=P.geometry.type,ft=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),pt=[],ht=P.id;if(z.promoteId?ht=P.properties[z.promoteId]:z.generateId&&(ht=W||0),"Point"===ut)Kn(Q,pt);else if("MultiPoint"===ut)for(var gt=0;gt<Q.length;gt++)Kn(Q[gt],pt);else if("LineString"===ut)qo(Q,pt,ft,!1);else if("MultiLineString"===ut){if(z.lineMetrics){for(gt=0;gt<Q.length;gt++)qo(Q[gt],pt=[],ft,!1),Y.push(Ie(ht,"LineString",pt,P.properties));return}Is(Q,pt,ft,!1)}else if("Polygon"===ut)Is(Q,pt,ft,!0);else{if("MultiPolygon"!==ut){if("GeometryCollection"===ut){for(gt=0;gt<P.geometry.geometries.length;gt++)Ii(Y,{id:ht,geometry:P.geometry.geometries[gt],properties:P.properties},z,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(gt=0;gt<Q.length;gt++){var Dt=[];Is(Q[gt],Dt,ft,!0),pt.push(Dt)}}Y.push(Ie(ht,ut,pt,P.properties))}}function Kn(Y,P){P.push(Fs(Y[0])),P.push(Os(Y[1])),P.push(0)}function qo(Y,P,z,W){for(var Q,ut,ft=0,pt=0;pt<Y.length;pt++){var ht=Fs(Y[pt][0]),gt=Os(Y[pt][1]);P.push(ht),P.push(gt),P.push(0),pt>0&&(ft+=W?(Q*gt-ht*ut)/2:Math.sqrt(Math.pow(ht-Q,2)+Math.pow(gt-ut,2))),Q=ht,ut=gt}var Dt=P.length-3;P[2]=1,yn(P,0,Dt,z),P[Dt+2]=1,P.size=Math.abs(ft),P.start=0,P.end=P.size}function Is(Y,P,z,W){for(var Q=0;Q<Y.length;Q++){var ut=[];qo(Y[Q],ut,z,W),P.push(ut)}}function Fs(Y){return Y/360+.5}function Os(Y){var P=Math.sin(Y*Math.PI/180),z=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return z<0?0:z>1?1:z}function tn(Y,P,z,W,Q,ut,ft,pt){if(W/=P,ut>=(z/=P)&&ft<W)return Y;if(ft<z||ut>=W)return null;for(var ht=[],gt=0;gt<Y.length;gt++){var Dt=Y[gt],Yt=Dt.geometry,Ot=Dt.type,re=0===Q?Dt.minX:Dt.minY,se=0===Q?Dt.maxX:Dt.maxY;if(re>=z&&se<W)ht.push(Dt);else if(!(se<z||re>=W)){var te=[];if("Point"===Ot||"MultiPoint"===Ot)xn(Yt,te,z,W,Q);else if("LineString"===Ot)lo(Yt,te,z,W,Q,!1,pt.lineMetrics);else if("MultiLineString"===Ot)vn(Yt,te,z,W,Q,!1);else if("Polygon"===Ot)vn(Yt,te,z,W,Q,!0);else if("MultiPolygon"===Ot)for(var oe=0;oe<Yt.length;oe++){var xe=[];vn(Yt[oe],xe,z,W,Q,!0),xe.length&&te.push(xe)}if(te.length){if(pt.lineMetrics&&"LineString"===Ot){for(oe=0;oe<te.length;oe++)ht.push(Ie(Dt.id,Ot,te[oe],Dt.tags));continue}"LineString"!==Ot&&"MultiLineString"!==Ot||(1===te.length?(Ot="LineString",te=te[0]):Ot="MultiLineString"),"Point"!==Ot&&"MultiPoint"!==Ot||(Ot=3===te.length?"Point":"MultiPoint"),ht.push(Ie(Dt.id,Ot,te,Dt.tags))}}}return ht.length?ht:null}function xn(Y,P,z,W,Q){for(var ut=0;ut<Y.length;ut+=3){var ft=Y[ut+Q];ft>=z&&ft<=W&&(P.push(Y[ut]),P.push(Y[ut+1]),P.push(Y[ut+2]))}}function lo(Y,P,z,W,Q,ut,ft){for(var pt,ht,gt=Zo(Y),Dt=0===Q?Wl:La,Yt=Y.start,Ot=0;Ot<Y.length-3;Ot+=3){var re=Y[Ot],se=Y[Ot+1],te=Y[Ot+2],oe=Y[Ot+3],xe=Y[Ot+4],Ge=0===Q?re:se,Ye=0===Q?oe:xe,Ne=!1;ft&&(pt=Math.sqrt(Math.pow(re-oe,2)+Math.pow(se-xe,2))),Ge<z?Ye>z&&(ht=Dt(gt,re,se,oe,xe,z),ft&&(gt.start=Yt+pt*ht)):Ge>W?Ye<W&&(ht=Dt(gt,re,se,oe,xe,W),ft&&(gt.start=Yt+pt*ht)):Rr(gt,re,se,te),Ye<z&&Ge>=z&&(ht=Dt(gt,re,se,oe,xe,z),Ne=!0),Ye>W&&Ge<=W&&(ht=Dt(gt,re,se,oe,xe,W),Ne=!0),!ut&&Ne&&(ft&&(gt.end=Yt+pt*ht),P.push(gt),gt=Zo(Y)),ft&&(Yt+=pt)}var ie=Y.length-3;re=Y[ie],se=Y[ie+1],te=Y[ie+2],(Ge=0===Q?re:se)>=z&&Ge<=W&&Rr(gt,re,se,te),ie=gt.length-3,ut&&ie>=3&&(gt[ie]!==gt[0]||gt[ie+1]!==gt[1])&&Rr(gt,gt[0],gt[1],gt[2]),gt.length&&P.push(gt)}function Zo(Y){var P=[];return P.size=Y.size,P.start=Y.start,P.end=Y.end,P}function vn(Y,P,z,W,Q,ut){for(var ft=0;ft<Y.length;ft++)lo(Y[ft],P,z,W,Q,ut,!1)}function Rr(Y,P,z,W){Y.push(P),Y.push(z),Y.push(W)}function Wl(Y,P,z,W,Q,ut){var ft=(ut-P)/(W-P);return Y.push(ut),Y.push(z+(Q-z)*ft),Y.push(1),ft}function La(Y,P,z,W,Q,ut){var ft=(ut-z)/(Q-z);return Y.push(P+(W-P)*ft),Y.push(ut),Y.push(1),ft}function Pa(Y,P){for(var z=[],W=0;W<Y.length;W++){var Q,ut=Y[W],ft=ut.type;if("Point"===ft||"MultiPoint"===ft||"LineString"===ft)Q=Ra(ut.geometry,P);else if("MultiLineString"===ft||"Polygon"===ft){Q=[];for(var pt=0;pt<ut.geometry.length;pt++)Q.push(Ra(ut.geometry[pt],P))}else if("MultiPolygon"===ft)for(Q=[],pt=0;pt<ut.geometry.length;pt++){for(var ht=[],gt=0;gt<ut.geometry[pt].length;gt++)ht.push(Ra(ut.geometry[pt][gt],P));Q.push(ht)}z.push(Ie(ut.id,ft,Q,ut.tags))}return z}function Ra(Y,P){var z=[];z.size=Y.size,void 0!==Y.start&&(z.start=Y.start,z.end=Y.end);for(var W=0;W<Y.length;W+=3)z.push(Y[W]+P,Y[W+1],Y[W+2]);return z}function za(Y,P){if(Y.transformed)return Y;var z,W,Q,ut=1<<Y.z,ft=Y.x,pt=Y.y;for(z=0;z<Y.features.length;z++){var ht=Y.features[z],gt=ht.geometry,Dt=ht.type;if(ht.geometry=[],1===Dt)for(W=0;W<gt.length;W+=2)ht.geometry.push(Xl(gt[W],gt[W+1],P,ut,ft,pt));else for(W=0;W<gt.length;W++){var Yt=[];for(Q=0;Q<gt[W].length;Q+=2)Yt.push(Xl(gt[W][Q],gt[W][Q+1],P,ut,ft,pt));ht.geometry.push(Yt)}}return Y.transformed=!0,Y}function Xl(Y,P,z,W,Q,ut){return[Math.round(z*(Y*W-Q)),Math.round(z*(P*W-ut))]}function Ba(Y,P,z,W,Q){for(var ut=P===Q.maxZoom?0:Q.tolerance/((1<<P)*Q.extent),ft={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:W,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pt=0;pt<Y.length;pt++){ft.numFeatures++,Va(ft,Y[pt],ut,Q);var ht=Y[pt].minX,gt=Y[pt].minY,Dt=Y[pt].maxX,Yt=Y[pt].maxY;ht<ft.minX&&(ft.minX=ht),gt<ft.minY&&(ft.minY=gt),Dt>ft.maxX&&(ft.maxX=Dt),Yt>ft.maxY&&(ft.maxY=Yt)}return ft}function Va(Y,P,z,W){var Q=P.geometry,ut=P.type,ft=[];if("Point"===ut||"MultiPoint"===ut)for(var pt=0;pt<Q.length;pt+=3)ft.push(Q[pt]),ft.push(Q[pt+1]),Y.numPoints++,Y.numSimplified++;else if("LineString"===ut)zr(ft,Q,Y,z,!1,!1);else if("MultiLineString"===ut||"Polygon"===ut)for(pt=0;pt<Q.length;pt++)zr(ft,Q[pt],Y,z,"Polygon"===ut,0===pt);else if("MultiPolygon"===ut)for(var ht=0;ht<Q.length;ht++){var gt=Q[ht];for(pt=0;pt<gt.length;pt++)zr(ft,gt[pt],Y,z,!0,0===pt)}if(ft.length){var Dt=P.tags||null;if("LineString"===ut&&W.lineMetrics){for(var Yt in Dt={},P.tags)Dt[Yt]=P.tags[Yt];Dt.mapbox_clip_start=Q.start/Q.size,Dt.mapbox_clip_end=Q.end/Q.size}var Ot={geometry:ft,type:"Polygon"===ut||"MultiPolygon"===ut?3:"LineString"===ut||"MultiLineString"===ut?2:1,tags:Dt};null!==P.id&&(Ot.id=P.id),Y.features.push(Ot)}}function zr(Y,P,z,W,Q,ut){var ft=W*W;if(W>0&&P.size<(Q?ft:W))z.numPoints+=P.length/3;else{for(var pt=[],ht=0;ht<P.length;ht+=3)(0===W||P[ht+2]>ft)&&(z.numSimplified++,pt.push(P[ht]),pt.push(P[ht+1])),z.numPoints++;Q&&function(gt,Dt){for(var Yt=0,Ot=0,re=gt.length,se=re-2;Ot<re;se=Ot,Ot+=2)Yt+=(gt[Ot]-gt[se])*(gt[Ot+1]+gt[se+1]);if(Yt>0===Dt)for(Ot=0,re=gt.length;Ot<re/2;Ot+=2){var te=gt[Ot],oe=gt[Ot+1];gt[Ot]=gt[re-2-Ot],gt[Ot+1]=gt[re-1-Ot],gt[re-2-Ot]=te,gt[re-1-Ot]=oe}}(pt,ut),Y.push(pt)}}function _r(Y,P){var z=(P=this.options=function(Q,ut){for(var ft in ut)Q[ft]=ut[ft];return Q}(Object.create(this.options),P)).debug;if(z&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var Q,ut,ft,pt,ht,gt,W=function(Q,ut){var ft=[];if("FeatureCollection"===Q.type)for(var pt=0;pt<Q.features.length;pt++)Ii(ft,Q.features[pt],ut,pt);else Ii(ft,"Feature"===Q.type?Q:{geometry:Q},ut);return ft}(Y,P);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Q=W,ut=P,ft=ut.buffer/ut.extent,pt=Q,ht=tn(Q,1,-1-ft,ft,0,-1,2,ut),gt=tn(Q,1,1-ft,2+ft,0,-1,2,ut),(ht||gt)&&(pt=tn(Q,1,-ft,1+ft,0,-1,2,ut)||[],ht&&(pt=Pa(ht,1).concat(pt)),gt&&(pt=pt.concat(Pa(gt,-1)))),W=pt).length&&this.splitTile(W,0,0,0),z&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $o(Y,P,z){return 32*((1<<Y)*z+P)+Y}function Yo(Y,P){const z=Y.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const W=this._geoJSONIndex.getTile(z.z,z.x,z.y);if(!W)return P(null,null);const Q=new Oa(W.features);let ut=kn(Q);0===ut.byteOffset&&ut.byteLength===ut.buffer.byteLength||(ut=new Uint8Array(ut)),P(null,{vectorTile:Q,rawData:ut.buffer})}_r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_r.prototype.splitTile=function(Y,P,z,W,Q,ut,ft){for(var pt=[Y,P,z,W],ht=this.options,gt=ht.debug;pt.length;){W=pt.pop(),z=pt.pop(),P=pt.pop(),Y=pt.pop();var Dt=1<<P,Yt=$o(P,z,W),Ot=this.tiles[Yt];if(!Ot&&(gt>1&&console.time("creation"),Ot=this.tiles[Yt]=Ba(Y,P,z,W,ht),this.tileCoords.push({z:P,x:z,y:W}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,z,W,Ot.numFeatures,Ot.numPoints,Ot.numSimplified),console.timeEnd("creation"));var re="z"+P;this.stats[re]=(this.stats[re]||0)+1,this.total++}if(Ot.source=Y,Q){if(P===ht.maxZoom||P===Q)continue;var se=1<<Q-P;if(z!==Math.floor(ut/se)||W!==Math.floor(ft/se))continue}else if(P===ht.indexMaxZoom||Ot.numPoints<=ht.indexMaxPoints)continue;if(Ot.source=null,0!==Y.length){gt>1&&console.time("clipping");var te,oe,xe,Ge,Ye,Ne,ie=.5*ht.buffer/ht.extent,Ct=.5-ie,bn=.5+ie,gi=1+ie;te=oe=xe=Ge=null,Ye=tn(Y,Dt,z-ie,z+bn,0,Ot.minX,Ot.maxX,ht),Ne=tn(Y,Dt,z+Ct,z+gi,0,Ot.minX,Ot.maxX,ht),Y=null,Ye&&(te=tn(Ye,Dt,W-ie,W+bn,1,Ot.minY,Ot.maxY,ht),oe=tn(Ye,Dt,W+Ct,W+gi,1,Ot.minY,Ot.maxY,ht),Ye=null),Ne&&(xe=tn(Ne,Dt,W-ie,W+bn,1,Ot.minY,Ot.maxY,ht),Ge=tn(Ne,Dt,W+Ct,W+gi,1,Ot.minY,Ot.maxY,ht),Ne=null),gt>1&&console.timeEnd("clipping"),pt.push(te||[],P+1,2*z,2*W),pt.push(oe||[],P+1,2*z,2*W+1),pt.push(xe||[],P+1,2*z+1,2*W),pt.push(Ge||[],P+1,2*z+1,2*W+1)}}},_r.prototype.getTile=function(Y,P,z){var W=this.options,Q=W.extent,ut=W.debug;if(Y<0||Y>24)return null;var ft=1<<Y,pt=$o(Y,P=(P%ft+ft)%ft,z);if(this.tiles[pt])return za(this.tiles[pt],Q);ut>1&&console.log("drilling down to z%d-%d-%d",Y,P,z);for(var ht,gt=Y,Dt=P,Yt=z;!ht&&gt>0;)gt--,Dt=Math.floor(Dt/2),Yt=Math.floor(Yt/2),ht=this.tiles[$o(gt,Dt,Yt)];return ht&&ht.source?(ut>1&&console.log("found parent tile z%d-%d-%d",gt,Dt,Yt),ut>1&&console.time("drilling down"),this.splitTile(ht.source,gt,Dt,Yt,Y,P,z),ut>1&&console.timeEnd("drilling down"),this.tiles[pt]?za(this.tiles[pt],Q):null):null};class Fi extends d.VectorTileWorkerSource{constructor(P,z,W,Q,ut){super(P,z,W,Q,Yo),ut&&(this.loadGeoJSON=ut)}loadData(P,z){const W=P&&P.request,Q=W&&W.collectResourceTiming;this.loadGeoJSON(P,(ut,ft)=>{if(ut||!ft)return z(ut);if("object"!=typeof ft)return z(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));{Se(ft,!0);try{if(P.filter){const ht=d.createExpression(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ht.result)throw new Error(ht.value.map(Dt=>`${Dt.key}: ${Dt.message}`).join(", "));const gt=ft.features.filter(Dt=>ht.value.evaluate({zoom:0},Dt));ft={type:"FeatureCollection",features:gt}}this._geoJSONIndex=P.cluster?new fr(function({superclusterOptions:ht,clusterProperties:gt}){if(!gt||!ht)return ht;const Dt={},Yt={},Ot={accumulated:null,zoom:0},re={properties:null},se=Object.keys(gt);for(const te of se){const[oe,xe]=gt[te],Ge=d.createExpression(xe),Ye=d.createExpression("string"==typeof oe?[oe,["accumulated"],["get",te]]:oe);Dt[te]=Ge.value,Yt[te]=Ye.value}return ht.map=te=>{re.properties=te;const oe={};for(const xe of se)oe[xe]=Dt[xe].evaluate(Ot,re);return oe},ht.reduce=(te,oe)=>{re.properties=oe;for(const xe of se)Ot.accumulated=te[xe],te[xe]=Yt[xe].evaluate(Ot,re)},ht}(P)).load(ft.features):new _r(ht=ft,P.geojsonVtOptions)}catch(ht){return z(ht)}this.loaded={};const pt={};if(Q){const ht=d.getPerformanceMeasurement(W);ht&&(pt.resourceTiming={},pt.resourceTiming[P.source]=JSON.parse(JSON.stringify(ht)))}z(null,pt)}var ht})}reloadTile(P,z){const W=this.loaded;return W&&W[P.uid]?super.reloadTile(P,z):this.loadTile(P,z)}loadGeoJSON(P,z){if(P.request)d.getJSON(P.request,z);else{if("string"!=typeof P.data)return z(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));try{return z(null,JSON.parse(P.data))}catch{return z(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(P,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch(W){z(W)}}getClusterChildren(P,z){try{z(null,this._geoJSONIndex.getChildren(P.clusterId))}catch(W){z(W)}}getClusterLeaves(P,z){try{z(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch(W){z(W)}}}class Br{constructor(P){this.self=P,this.actor=new d.Actor(P,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:Fi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(z,W)=>{if(this.workerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.workerSourceTypes[z]=W},this.self.registerRTLTextPlugin=z=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=z.applyArabicShaping,d.plugin.processBidirectionalText=z.processBidirectionalText,d.plugin.processStyledBidirectionalText=z.processStyledBidirectionalText}}clearCaches(P,z,W){delete this.layerIndexes[P],delete this.availableImages[P],delete this.workerSources[P],delete this.demWorkerSources[P],W()}checkIfReady(P,z,W){W()}setReferrer(P,z){this.referrer=z}spriteLoaded(P,z){this.isSpriteLoaded[P]=z;for(const W in this.workerSources[P]){const Q=this.workerSources[P][W];for(const ut in Q)Q[ut]instanceof d.VectorTileWorkerSource&&(Q[ut].isSpriteLoaded=z,Q[ut].fire(new d.Event("isSpriteLoaded")))}}setImages(P,z,W){this.availableImages[P]=z;for(const Q in this.workerSources[P]){const ut=this.workerSources[P][Q];for(const ft in ut)ut[ft].availableImages=z}W()}enableTerrain(P,z,W){this.terrain=z,W()}setProjection(P,z){this.projections[P]=d.getProjection(z)}setLayers(P,z,W){this.getLayerIndex(P).replace(z),W()}updateLayers(P,z,W){this.getLayerIndex(P).update(z.layers,z.removedIds),W()}loadTile(P,z,W){const Q=this.enableTerrain?d.extend({enableTerrain:this.terrain},z):z;Q.projection=this.projections[P]||this.defaultProjection,this.getWorkerSource(P,z.type,z.source).loadTile(Q,W)}loadDEMTile(P,z,W){const Q=this.enableTerrain?d.extend({buildQuadTree:this.terrain},z):z;this.getDEMWorkerSource(P,z.source).loadTile(Q,W)}reloadTile(P,z,W){const Q=this.enableTerrain?d.extend({enableTerrain:this.terrain},z):z;Q.projection=this.projections[P]||this.defaultProjection,this.getWorkerSource(P,z.type,z.source).reloadTile(Q,W)}abortTile(P,z,W){this.getWorkerSource(P,z.type,z.source).abortTile(z,W)}removeTile(P,z,W){this.getWorkerSource(P,z.type,z.source).removeTile(z,W)}removeSource(P,z,W){if(!this.workerSources[P]||!this.workerSources[P][z.type]||!this.workerSources[P][z.type][z.source])return;const Q=this.workerSources[P][z.type][z.source];delete this.workerSources[P][z.type][z.source],void 0!==Q.removeSource?Q.removeSource(z,W):W()}loadWorkerSource(P,z,W){try{this.self.importScripts(z.url),W()}catch(Q){W(Q.toString())}}syncRTLPluginState(P,z,W){try{d.plugin.setState(z);const Q=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=Q){this.self.importScripts(Q);const ut=d.plugin.isParsed();W(ut?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),ut)}}catch(Q){W(Q.toString())}}getAvailableImages(P){let z=this.availableImages[P];return z||(z=[]),z}getLayerIndex(P){let z=this.layerIndexes[P];return z||(z=this.layerIndexes[P]=new ui),z}getWorkerSource(P,z,W){return this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][z]||(this.workerSources[P][z]={}),this.workerSources[P][z][W]||(this.workerSources[P][z][W]=new this.workerSourceTypes[z]({send:(Q,ut,ft,pt,ht,gt)=>{this.actor.send(Q,ut,ft,P,ht,gt)},scheduler:this.actor.scheduler},this.getLayerIndex(P),this.getAvailableImages(P),this.isSpriteLoaded[P])),this.workerSources[P][z][W]}getDEMWorkerSource(P,z){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][z]||(this.demWorkerSources[P][z]=new jt),this.demWorkerSources[P][z]}enforceCacheSizeLimit(P,z){d.enforceCacheSizeLimit(z)}getWorkerPerformanceMetrics(P,z,W){W(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Br(self)),Br}),io(0,function(d){function zt(p,r){if(Array.isArray(p)){if(!Array.isArray(r)||p.length!==r.length)return!1;for(let u=0;u<p.length;u++)if(!zt(p[u],r[u]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==r){if("object"!=typeof r||Object.keys(p).length!==Object.keys(r).length)return!1;for(const u in p)if(!zt(p[u],r[u]))return!1;return!0}return p===r}var dr=ui;function ui(p){return r=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,x,v=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(v);try{x=new Worker(M),m=!0}catch{m=!1}return x&&x.terminate(),URL.revokeObjectURL(M),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var x=m.getContext("2d");if(!x)return!1;var v=x.getImageData(0,0,1,1);return v&&v.width===m.width}()||(void 0===jt[u=r&&r.failIfMajorPerformanceCaveat]&&(jt[u]=function(m){var x,M,A,E,v=(M=m,A=document.createElement("canvas"),(E=Object.create(ui.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,A.getContext("webgl",E)||A.getContext("experimental-webgl",E));if(!v)return!1;try{x=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!x||v.isContextLost())&&(v.shaderSource(x,"void main() {}"),v.compileShader(x),!0===v.getShaderParameter(x,v.COMPILE_STATUS))}(u)),!jt[u]||document.documentMode));var r,u}var jt={};function Se(p,r,u){const m=d.window.document.createElement(p);return void 0!==r&&(m.className=r),u&&u.appendChild(m),m}function Ki(p,r,u){const m=d.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const x of Object.keys(r))m.setAttributeNS(null,x,r[x]);return u&&u.appendChild(m),m}ui.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Vn=d.window.document&&d.window.document.documentElement.style,_e=Vn&&void 0!==Vn.userSelect?"userSelect":"WebkitUserSelect";let si;function Oa(){Vn&&_e&&(si=Vn[_e],Vn[_e]="none")}function Go(){Vn&&_e&&(Vn[_e]=si)}function no(p){p.preventDefault(),p.stopPropagation(),d.window.removeEventListener("click",no,!0)}function No(){d.window.addEventListener("click",no,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",no,!0)},0)}function ye(p,r){const u=p.getBoundingClientRect();return Qi(p,u,r)}function kn(p,r){const u=p.getBoundingClientRect(),m=[];for(let x=0;x<r.length;x++)m.push(Qi(p,u,r[x]));return m}function Fr(p){return void 0!==d.window.InstallTrigger&&2===p.button&&p.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Qi(p,r,u){const m=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new d.pointGeometry((u.clientX-r.left)*m,(u.clientY-r.top)*m)}function ro(p,r){var u=r[0],m=r[1],x=r[2],v=r[3],M=u*v-x*m;return M?(p[0]=v*(M=1/M),p[1]=-m*M,p[2]=-x*M,p[3]=u*M,p):null}function Ve(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class Yn extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,m);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,u){this._validate(r,u)&&(this.images[r]=u)}_validate(r,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,u){if(!r)return!0;let m=0;for(const x of r){if(x[0]<m||x[1]<x[0]||u<x[1])return!1;m=x[1]}return!0}_validateContent(r,u){return!(r&&(4!==r.length||r[0]<0||u.data.width<r[0]||r[1]<0||u.data.height<r[1]||r[2]<0||u.data.width<r[2]||r[3]<0||u.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,u){u.version=this.images[r].version+1,this.images[r]=u,this.updatedImages[r]=!0}removeImage(r){const u=this.images[r];delete this.images[r],delete this.patterns[r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,u){let m=!0;if(!this.isLoaded())for(const x of r)this.images[x]||(m=!1);this.isLoaded()||m?this._notify(r,u):this.requestors.push({ids:r,callback:u})}_notify(r,u){const m={};for(const x of r){this.images[x]||this.fire(new d.Event("styleimagemissing",{id:x}));const v=this.images[x];v?m[x]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:d.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,m)}getPixelSize(){const{width:r,height:u}=this.atlasImage;return{width:r,height:u}}getPattern(r){const u=this.patterns[r],m=this.getImage(r);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{const x={w:m.data.width+2,h:m.data.height+2,x:0,y:0},v=new d.ImagePosition(x,m);this.patterns[r]={bin:x,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const u=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(r,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:u,h:m}=d.potpack(r),x=this.atlasImage;x.resize({width:u||1,height:m||1});for(const v in this.patterns){const{bin:M}=this.patterns[v],A=M.x+1,E=M.y+1,D=this.images[v].data,I=D.width,R=D.height;d.RGBAImage.copy(D,x,{x:0,y:0},{x:A,y:E},{width:I,height:R}),d.RGBAImage.copy(D,x,{x:0,y:R-1},{x:A,y:E-1},{width:I,height:1}),d.RGBAImage.copy(D,x,{x:0,y:0},{x:A,y:E+R},{width:I,height:1}),d.RGBAImage.copy(D,x,{x:I-1,y:0},{x:A-1,y:E},{width:1,height:R}),d.RGBAImage.copy(D,x,{x:0,y:0},{x:A+I,y:E},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const u of r){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const m=this.images[u];Ve(m)&&this.updateImage(u,m)}}}const Uo=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(p,r){return function([u,m,x]){const v=d.degToRad(m+90),M=d.degToRad(x);return{x:u*Math.cos(v)*Math.sin(M),y:u*Math.sin(v)*Math.sin(M),z:u*Math.cos(M),azimuthal:m,polar:x}}(p.expression.evaluate(r))}interpolate(p,r,u){return{x:d.number(p.x,r.x,u),y:d.number(p.y,r.y,u),z:d.number(p.z,r.z,u),azimuthal:d.number(p.azimuthal,r.azimuthal,u),polar:d.number(p.polar,r.polar,u)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),Or="-transition";class Ts extends d.Evented{constructor(r){super(),this._transitionable=new d.Transitionable(Uo),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u={}){if(!this._validate(d.validateLight,r,u))for(const m in r){const x=r[m];d.endsWith(m,Or)?this._transitionable.setTransition(m.slice(0,-Or.length),x):this._transitionable.setValue(m,x)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,r.call(d.validateStyle,d.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const ks=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),pr="-transition";class oo extends d.Evented{constructor(r,u){super(),this._transitionable=new d.Transitionable(ks),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(r){for(const u in r){const m=r[u];d.endsWith(u,pr)?this._transitionable.setTransition(u.slice(0,-pr.length),m):this._transitionable.setValue(u,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Gn(p,r,u,m){const x=d.smoothstep(45,65,u),[v,M]=Lr(p,m),A=d.length(r);let E=1-Math.min(1,Math.exp((A-v)/(M-v)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*x*p.alpha}function Lr(p,r){const u=.5/Math.tan(.5*r);return[p.range[0]+u,p.range[1]+u]}const gn=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"high-color":new d.DataConstantProperty(d.spec.fog["high-color"]),"space-color":new d.DataConstantProperty(d.spec.fog["space-color"]),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"]),"star-intensity":new d.DataConstantProperty(d.spec.fog["star-intensity"])}),jo="-transition";class hi extends d.Evented{constructor(r,u){super(),this._transitionable=new d.Transitionable(gn),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const r=this._transform,u="globe"===r.projection.name,m=d.globeToMercatorTransition(r.zoom),x=this.properties.get("range"),v=[.5,3];return{range:u?[d.number(v[0],x[0],m),d.number(v[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,u={}){if(!this._validate(d.validateFog,r,u)){for(const m of Object.keys(d.spec.fog))r&&void 0===r[m]&&(r[m]=d.spec.fog[m].default);for(const m in r){const x=r[m];d.endsWith(m,jo)?this._transitionable.setTransition(m.slice(0,-jo.length),x):this._transitionable.setValue(m,x)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.smoothstep(45,65,r))*u.a}getOpacityAtLatLng(r,u){return this._transform.projection.supportsFog?function(m,x,v){const M=d.MercatorCoordinate.fromLngLat(x),A=v.elevation?v.elevation.getAtPointOrZero(M):0,E=[M.x,M.y,A];return d.transformMat4(E,E,v.mercatorFogMatrix),Gn(m,E,v.pitch,v._fov)}(this.state,r,u):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Lr(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,r.call(d.validateStyle,d.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class zi{constructor(r,u){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const m=this.workerPool.acquire(this.id);for(let x=0;x<m.length;x++){const v=new zi.Actor(m[x],u,this.id);v.name=`Worker ${x}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,u,m){d.asyncAll(this.actors,(x,v)=>{x.send(r,u,v)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Wn(p,r,u){return r*(d.EXTENT/(p.tileSize*Math.pow(2,u-p.tileID.overscaledZ)))}zi.Actor=d.Actor;class cn{constructor(r,u,m,x){this.screenBounds=r,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(r,u){let m,x;if(r instanceof d.pointGeometry||"number"==typeof r[0]){const v=d.pointGeometry.convert(r);m=[d.pointGeometry.convert(r)],x=u.isPointAboveHorizon(v)}else{const v=d.pointGeometry.convert(r[0]),M=d.pointGeometry.convert(r[1]);m=[v,M],x=d.polygonizeBounds(v,M).every(A=>u.isPointAboveHorizon(A))}return new cn(m,u.getCameraPoint(),x,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const u=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],x=d.polygonizeBounds(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(x[3]=this.cameraPoint)),d.bufferConvexPolygon(x,r)}bufferedCameraGeometryGlobe(r){const u=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],x=d.polygonizeBounds(u,m,r),v=this.cameraPoint.clone();switch(3*((v.y>u.y)+(v.y>m.y))+((v.x>u.x)+(v.x>m.x))){case 0:x[0]=v,x[4]=v.clone();break;case 1:x.splice(1,0,v);break;case 2:x[1]=v;break;case 3:x.splice(4,0,v);break;case 5:x.splice(2,0,v);break;case 6:x[3]=v;break;case 7:x.splice(3,0,v);break;case 8:x[2]=v}return x}containsTile(r,u,m,x=0){const v=r.queryPadding/u._pixelsPerMercatorPixel+1,M=m?this._bufferedCameraMercator(v,u):this._bufferedScreenMercator(v,u);let A=r.tileID.wrap+(M.unwrapped?x:0);const E=M.polygon.map(q=>d.getTilePoint(r.tileTransform,q,A));if(!d.polygonIntersectsBox(E,0,0,d.EXTENT,d.EXTENT))return;A=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const D=this.screenGeometryMercator.polygon.map(q=>d.getTileVec3(r.tileTransform,q,A)),I=D.map(q=>new d.pointGeometry(q[0],q[1])),R=u.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),V=d.getTileVec3(r.tileTransform,R,A),Z=D.map(q=>{const U=d.sub(q,q,V);return d.normalize(U,U),new d.Ray(V,U)}),j=Wn(r,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:Z,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(H=d.getBounds(E),H.min.x=d.clamp(H.min.x,0,d.EXTENT),H.min.y=d.clamp(H.min.y,0,d.EXTENT),H.max.x=d.clamp(H.max.x,0,d.EXTENT),H.max.y=d.clamp(H.max.y,0,d.EXTENT),H),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:j};var H}_bufferedScreenMercator(r,u){const m=so(r);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x="globe"===u.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),u):{polygon:this.bufferedScreenGeometry(r).map(v=>u.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(r,u){const m=so(r);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x="globe"===u.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),u):{polygon:this.bufferedCameraGeometry(r).map(v=>u.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(r,u){const m=function(v,M){const A=d.multiply([],M.pixelMatrix,M.globeMatrix),E=[0,-d.GLOBE_RADIUS,0,1],D=[0,d.GLOBE_RADIUS,0,1],I=[0,0,0,1];d.transformMat4$1(E,E,A),d.transformMat4$1(D,D,A),d.transformMat4$1(I,I,A);const R=new d.pointGeometry(E[0]/E[3],E[1]/E[3]),V=new d.pointGeometry(D[0]/D[3],D[1]/D[3]),Z=d.polygonContainsPoint(v,R)&&E[3]<I[3],j=d.polygonContainsPoint(v,V)&&D[3]<I[3];if(!Z&&!j)return null;const H=function(at,rt,dt){for(let _t=1;_t<at.length;_t++){const Lt=fr(rt.pointCoordinate3D(at[_t-1]).x),mt=fr(rt.pointCoordinate3D(at[_t]).x);if(dt<0){if(Lt<mt)return{idx:_t,t:-Lt/(mt-1-Lt)}}else if(mt<Lt)return{idx:_t,t:(1-Lt)/(mt+1-Lt)}}return null}(v,M,Z?-1:1);if(!H)return null;const{idx:q,t:U}=H;let J=q>1?Xn(v.slice(0,q),M):[],$=q<v.length?Xn(v.slice(q),M):[];J=J.map(at=>new d.pointGeometry(fr(at.x),at.y)),$=$.map(at=>new d.pointGeometry(fr(at.x),at.y));const lt=[...J];0===lt.length&&lt.push($[$.length-1]);const st=d.number(lt[lt.length-1].y,(0===$.length?J[0]:$[0]).y,U);let et;return et=Z?[new d.pointGeometry(0,st),new d.pointGeometry(0,0),new d.pointGeometry(1,0),new d.pointGeometry(1,st)]:[new d.pointGeometry(1,st),new d.pointGeometry(1,1),new d.pointGeometry(0,1),new d.pointGeometry(0,st)],lt.push(...et),0===$.length?lt.push(J[0]):lt.push(...$),{polygon:lt.map(at=>new d.MercatorCoordinate(at.x,at.y)),unwrapped:!1}}(r,u);if(m)return m;const x=function(v,M){let A=!1,E=-1/0,D=0;for(let R=0;R<v.length-1;R++)v[R].x>E&&(E=v[R].x,D=R);for(let R=0;R<v.length-1;R++){const V=(D+R)%(v.length-1),Z=v[V],j=v[V+1];Math.abs(Z.x-j.x)>.5&&(Z.x<j.x?(Z.x+=1,0===V&&(v[v.length-1].x+=1)):(j.x+=1,V+1===v.length-1&&(v[0].x+=1)),A=!0)}const I=d.mercatorXfromLng(M.center.lng);return A&&I<Math.abs(I-1)&&v.forEach(R=>{R.x-=1}),{polygon:v,unwrapped:A}}(Xn(r,u).map(v=>new d.pointGeometry(fr(v.x),v.y)),u);return{polygon:x.polygon.map(v=>new d.MercatorCoordinate(v.x,v.y)),unwrapped:x.unwrapped}}}function Xn(p,r){return d.resample(p,u=>{const m=r.pointCoordinate3D(u);u.x=m.x,u.y=m.y},1/256)}function fr(p){return p<0?1+p%1:p%1}function so(p){return 100*p|0}function Ho(p,r,u,m,x){const v=function(M,A){if(M)return x(M);if(A){const E=d.pick(d.extend(A,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(E.vectorLayers=A.vector_layers,E.vectorLayerIds=E.vectorLayers.map(D=>D.id)),A.language_options&&(E.languageOptions=A.language_options),A.language&&A.language[A.id]&&(E.language=A.language[A.id]),A.worldview_options&&(E.worldviewOptions=A.worldview_options),A.worldview?E.worldview=A.worldview[A.id]:A.worldview_default&&(E.worldview=A.worldview_default),E.tiles=r.canonicalizeTileset(E,p.url),x(null,E)}};return p.url?d.getJSON(r.transformRequest(r.normalizeSourceURL(p.url,null,u,m),d.ResourceType.Source),v):d.exported.frame(()=>v(null,p))}class Nn{constructor(r,u,m){this.bounds=d.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const u=Math.pow(2,r.z),m=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*u),x=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*u),v=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*u),M=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*u);return r.x>=m&&r.x<v&&r.y>=x&&r.y<M}}class Ds{constructor(r,u,m){this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const mr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Pr{constructor(r,u,m,x){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=x,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let m=0;m<this.attributes.length;m++){const x=u.attributes[this.attributes[m].name];void 0!==x&&r.enableVertexAttribArray(x)}}setVertexAttribPointers(r,u,m){for(let x=0;x<this.attributes.length;x++){const v=this.attributes[x],M=u.attributes[v.name];void 0!==M&&r.vertexAttribPointer(M,v.components,r[mr[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fe{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jn extends Fe{getDefault(){return d.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class gr extends Fe{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class _n extends Fe{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class yn extends Fe{getDefault(){return[!0,!0,!0,!0]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ao extends Fe{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ie extends Fe{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class bi extends Fe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Ii extends Fe{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Kn extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class qo extends Fe{getDefault(){return[0,1]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Is extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class Fs extends Fe{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Os extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class tn extends Fe{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class xn extends Fe{getDefault(){return d.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class lo extends Fe{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Zo extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class vn extends Fe{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Rr extends Fe{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Wl extends Fe{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class La extends Fe{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Pa extends Fe{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ra extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class za extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Xl extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Ba extends Fe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Va extends Fe{getDefault(){return null}set(r){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class zr extends Fe{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class _r extends Fe{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class $o extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Yo extends Fe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Fi extends Fe{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class Br extends Fi{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Y extends Fi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class P extends Y{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class z{constructor(r,u,m,x){this.context=r,this.width=u,this.height=m;const v=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Br(r,v),x&&(this.depthAttachment=new Y(r,v))}destroy(){const r=this.context.gl,u=this.colorAttachment.get();if(u&&r.deleteTexture(u),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class W{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Jn(this),this.clearDepth=new gr(this),this.clearStencil=new _n(this),this.colorMask=new yn(this),this.depthMask=new ao(this),this.stencilMask=new Ie(this),this.stencilFunc=new bi(this),this.stencilOp=new Ii(this),this.stencilTest=new Kn(this),this.depthRange=new qo(this),this.depthTest=new Is(this),this.depthFunc=new Fs(this),this.blend=new Os(this),this.blendFunc=new tn(this),this.blendColor=new xn(this),this.blendEquation=new lo(this),this.cullFace=new Zo(this),this.cullFaceSide=new vn(this),this.frontFace=new Rr(this),this.program=new Wl(this),this.activeTexture=new La(this),this.viewport=new Pa(this),this.bindFramebuffer=new Ra(this),this.bindRenderbuffer=new za(this),this.bindTexture=new Xl(this),this.bindVertexBuffer=new Ba(this),this.bindElementBuffer=new Va(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new zr(this),this.pixelStoreUnpack=new _r(this),this.pixelStoreUnpackPremultiplyAlpha=new $o(this),this.pixelStoreUnpackFlipY=new Yo(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u){return new Ds(this,r,u)}createVertexBuffer(r,u,m){return new Pr(this,r,u,m)}createRenderbuffer(r,u,m){const x=this.gl,v=x.createRenderbuffer();return this.bindRenderbuffer.set(v),x.renderbufferStorage(x.RENDERBUFFER,r,u,m),this.bindRenderbuffer.set(null),v}createFramebuffer(r,u,m){return new z(this,r,u,m)}clear({color:r,depth:u,stencil:m}){const x=this.gl;let v=0;r&&(v|=x.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(v|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==m&&(v|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(v)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){zt(r.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Q extends d.Evented{constructor(r,u,m,x){super(),this.id=r,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},u),d.extend(this,d.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ho(this._options,this.map._requestManager,null,null,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new d.ErrorEvent(r)):u&&(d.extend(this,u),u.bounds&&(this.tileBounds=new Nn(u.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(u.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,u){const m=d.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);r.request=d.getImage(this.map._requestManager.transformRequest(x,d.ResourceType.Tile),(v,M,A,E)=>(delete r.request,r.aborted?(r.state="unloaded",u(null)):v?(r.state="errored",u(v)):M?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:A,expires:E}),r.setTexture(M,this.map.painter),r.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(r,u,m){r.setTexture(u,m)}static unloadTileData(r,u){r.texture&&u.saveTileTexture(r.texture)}abortTile(r,u){r.request&&(r.request.cancel(),delete r.request),u()}unloadTile(r,u){r.texture&&this.map.painter.saveTileTexture(r.texture),u()}hasTransition(){return!1}}let ut;function ft(p,r,u,m,x,v,M,A){const E=[p,u,x,r,m,v,1,1,1],D=[M,A,1],I=d.adjoint([],E),[R,V,Z]=d.transformMat3(D,D,d.transpose(I,I));return d.multiply$1(E,[R,0,0,0,V,0,0,0,Z],E)}class pt extends d.Evented{constructor(r,u,m,x){super(),this.id=r,this.dispatcher=m,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=u}load(r,u){this._loaded=u||!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(m,x)=>{if(this._loaded=!0,m)this.fire(new d.ErrorEvent(m));else if(x){const{HTMLImageElement:v}=d.window;this.image=x instanceof v?d.exported.getImageData(x):x,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const u=r.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let x=1/0,v=1/0,M=-1/0,A=-1/0;for(const R of m)x=Math.min(x,R.x),v=Math.min(v,R.y),M=Math.max(M,R.x),A=Math.max(A,R.y);const E=Math.max(M-x,A-v),D=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),I=Math.pow(2,D);return new d.CanonicalTileID(D,Math.floor((x+M)/2*I),Math.floor((v+A)/2*I))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const E in this.tiles){const D=this.tiles[E];"loaded"!==D.state&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const u=d.tileTransform(this.tileID,this.map.transform.projection),[m,x,v,M]=this.coordinates.map(E=>{const D=u.projection.project(E[0],E[1]);return d.getTilePoint(u,D)._round()});this.perspectiveTransform=function(E,D,I,R,V,Z,j,H,q,U){const J=ft(0,0,E,0,0,D,E,D),$=ft(I,R,V,Z,j,H,q,U);return d.multiply$1($,d.adjoint(J,J),$),[$[6]/$[8]*E/d.EXTENT,$[7]/$[8]*D/d.EXTENT]}(this.width,this.height,m.x,m.y,x.x,x.y,M.x,M.y,v.x,v.y);const A=this._boundsArray=new d.StructArrayLayout4i8;A.emplaceBack(m.x,m.y,0,0),A.emplaceBack(x.x,x.y,d.EXTENT,0),A.emplaceBack(M.x,M.y,0,d.EXTENT),A.emplaceBack(v.x,v.y,d.EXTENT,d.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(A,d.boundsAttributes.members),this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,u=r.gl;this.texture?this.texture.update(this.image):(this.texture=new d.Texture(r,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,u){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},u(null)):(r.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ht={vector:class extends d.Evented{constructor(p,r,u,m){if(super(),this.id=p,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(r,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(p){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"}));const r=this.language||this.map._language,u=this.worldview||this.map._worldview;this._tileJSONRequest=Ho(this._options,this.map._requestManager,r,u,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,m?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${r}`),u&&2!==u.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new d.ErrorEvent(m))):x&&(d.extend(this,x),x.bounds&&(this.tileBounds=new Nn(x.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.load(()=>{const r=this.map.style._getSourceCaches(this.id);for(const u of r)u.clearTiles()})}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}_setLanguage(p){return p===this.language||this.setSourceProperty(()=>{this.language=p}),this}_setWorldview(p){return p===this.worldview?this:this.worldviewOptions&&p&&!this.worldviewOptions[p]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${p}".`),this):(this.setSourceProperty(()=>{this.worldview=p}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(p,r){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(u,d.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=r:p.request=p.actor.send("reloadTile",m,x.bind(this));else if(p.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",m,x.bind(this),void 0,!0);else{const v=d.loadVectorTile.call({deduped:this._deduped},m,(M,A)=>{M||!A?x.call(this,M):(m.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},p.actor&&p.actor.send("loadTile",m,x.bind(this),void 0,!0))},!0);p.request={cancel:v}}function x(v,M){return delete p.request,p.aborted?r(null):v&&404!==v.status?r(v):(M&&M.resourceTiming&&(p.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&p.setExpiryData(M),p.loadVectorData(M,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Q,"raster-dem":class extends Q{constructor(p,r,u,m){super(p,r,u,m),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,v){x&&(p.state="errored",r(x)),v&&(p.dem=v,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=d.getImage(this.map._requestManager.transformRequest(u,d.ResourceType.Tile),function(x,v,M,A){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(x)p.state="errored",r(x);else if(v){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:M,expires:A});const E=d.window.ImageBitmap&&v instanceof d.window.ImageBitmap&&(null==ut&&(ut=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),ut),D=1-(v.width-d.prevPowerOfTwo(v.width))/2;D<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const I=E?v:d.exported.getImageData(v,D),R={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:D};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",R,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const r=p.canonical,u=Math.pow(2,r.z),m=(r.x-1+u)%u,x=0===r.x?p.wrap-1:p.wrap,v=(r.x+1+u)%u,M=r.x+1===u?p.wrap+1:p.wrap,A={};return A[new d.OverscaledTileID(p.overscaledZ,x,r.z,m,r.y).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,M,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(A[new d.OverscaledTileID(p.overscaledZ,x,r.z,m,r.y-1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,M,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<u&&(A[new d.OverscaledTileID(p.overscaledZ,x,r.z,m,r.y+1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,M,r.z,v,r.y+1).key]={backfilled:!1}),A}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends d.Evented{constructor(p,r,u,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=r.data,this._options=d.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const x=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*x,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*x,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*x,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},r),this}getClusterLeaves(p,r,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:r,offset:u},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=d.extend({},this.workerOptions),r=this._data;"string"==typeof r?(p.request=this.map._requestManager.transformRequest(d.exported.resolveURL(r),d.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new d.ErrorEvent(u));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x.resourceTiming=m.resourceTiming[this.id]),this.fire(new d.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,r){const u=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(u,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,x)=>(delete p.request,p.unloadVectorData(),p.aborted?r(null):m?r(m):(p.loadVectorData(x,this.map.painter,"reloadTile"===u),r(null))),void 0,"loadTile"===u)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pt{constructor(p,r,u,m){super(p,r,u,m),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,d.ResourceType.Source).url);d.getVideo(this.urls,(r,u)=>{this._loaded=!0,r?this.fire(new d.ErrorEvent(r)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(p,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pt,canvas:class extends pt{constructor(p,r,u,m){super(p,r,u,m),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(v=>"number"!=typeof v))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends d.Evented{constructor(p,r,u,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=r,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Nn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),d.extend(this,d.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:u,z:m}=p.canonical;return this._implementation.hasTile({x:r,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:u,y:m,z:x}=p.tileID.canonical,v=new d.window.AbortController,M=this._implementation.loadTile({x:u,y:m,z:x},{signal:v.signal});if(!M)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null);M.cancel=()=>v.abort(),p.request=M.then(function(A){return delete p.request,p.aborted?(p.state="unloaded",r(null)):A?(E=A)instanceof d.window.ImageData||E instanceof d.window.ImageBitmap||E instanceof d.window.HTMLCanvasElement?(this.loadTileData(p,A),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null));var E}.bind(this)).catch(A=>{20!==A.code&&(p.state="errored",r(A))})}loadTileData(p,r){Q.loadTileData(p,r,this._map.painter)}unloadTileData(p){Q.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:r,y:u,z:m}=p.tileID.canonical,x=this._implementation.prepareTile({x:r,y:u,z:m});return x?(this.loadTileData(p,x),p.state="loaded",x):null}unloadTile(p,r){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:u,y:m,z:x}=p.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:x})}r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}}},gt=function(p,r,u,m){const x=new ht[r.type](p,r,u,m);if(x.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${x.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Dt(p,r){const u=d.identity([]);return d.scale(u,u,[.5*p.width,.5*-p.height,1]),d.translate(u,u,[1,-1,0]),d.multiply(u,u,p.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(u)}function Yt(p,r,u,m,x,v,M,A=!1){const E=p.tilesIn(m,M,A);E.sort(re);const D=[];for(const R of E)D.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(r,u,p._state,R,x,v,Dt(p.transform,R.tile.tileID),A)});const I=function(R){const V={},Z={};for(const j of R){const H=j.queryResults,q=j.wrappedTileID,U=Z[q]=Z[q]||{};for(const J in H){const $=H[J],lt=U[J]=U[J]||{},st=V[J]=V[J]||[];for(const et of $)lt[et.featureIndex]||(lt[et.featureIndex]=!0,st.push(et))}}return V}(D);for(const R in I)I[R].forEach(V=>{const Z=V.feature,j=Z.layer;j&&"background"!==j.type&&"sky"!==j.type&&(Z.source=j.source,j["source-layer"]&&(Z.sourceLayer=j["source-layer"]),Z.state=void 0!==Z.id?p.getFeatureState(j["source-layer"],Z.id):{})});return I}function Ot(p,r){const u=p.getRenderableIds().map(v=>p.getTileByID(v)),m=[],x={};for(let v=0;v<u.length;v++){const M=u[v],A=M.tileID.canonical.key;x[A]||(x[A]=!0,M.querySourceFeatures(m,r))}return m}function re(p,r){const u=p.tileID,m=r.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function se(){return null!=ua.workerClass?new ua.workerClass:new d.window.Worker(ua.workerUrl)}const te="mapboxgl_preloaded_worker_pool";class oe{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<oe.workerCount;)this.workers.push(new se);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[te]}numActive(){return Object.keys(this.active).length}}let xe;function Ge(){return xe||(xe=new oe),xe}function Ye(p,r){const u={};for(const m in p)"ref"!==m&&(u[m]=p[m]);return d.refProperties.forEach(m=>{m in r&&(u[m]=r[m])}),u}function Ne(p){p=p.slice();const r=Object.create(null);for(let u=0;u<p.length;u++)r[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=Ye(p[u],r[p[u].ref]));return p}oe.workerCount=2;const ie={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ct(p,r,u){u.push({command:ie.addSource,args:[p,r[p]]})}function bn(p,r,u){r.push({command:ie.removeSource,args:[p]}),u[p]=!0}function gi(p,r,u,m){bn(p,u,m),Ct(p,r,u)}function Vr(p,r,u){let m;for(m in p[u])if(p[u].hasOwnProperty(m)&&"data"!==m&&!zt(p[u][m],r[u][m]))return!1;for(m in r[u])if(r[u].hasOwnProperty(m)&&"data"!==m&&!zt(p[u][m],r[u][m]))return!1;return!0}function Ls(p,r,u,m,x,v){let M;for(M in r=r||{},p=p||{})p.hasOwnProperty(M)&&(zt(p[M],r[M])||u.push({command:v,args:[m,M,r[M],x]}));for(M in r)r.hasOwnProperty(M)&&!p.hasOwnProperty(M)&&(zt(p[M],r[M])||u.push({command:v,args:[m,M,r[M],x]}))}function Un(p){return p.id}function Jl(p,r){return p[r.id]=r,p}class Bh{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=d.clamp(r,0,1);let u=1,m=this._distances[u];const x=r*this.paddedLength+this.padding;for(;m<x&&u<this._distances.length;)m=this._distances[++u];const v=u-1,M=this._distances[v],A=m-M,E=A>0?(x-M)/A:0;return this.points[v].mult(1-E).add(this.points[u].mult(E))}}class co{constructor(r,u,m){const x=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(u/m);for(let M=0;M<this.xCellCount*this.yCellCount;M++)x.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,m,x,v){this._forEachCell(u,m,x,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(v)}insertCircle(r,u,m,x){this._forEachCell(u-x,m-x,u+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(m),this.circles.push(x)}_insertBoxCell(r,u,m,x,v,M){this.boxCells[v].push(M)}_insertCircleCell(r,u,m,x,v,M){this.circleCells[v].push(M)}_query(r,u,m,x,v,M){if(m<0||r>this.width||x<0||u>this.height)return!v&&[];const A=[];if(r<=0&&u<=0&&this.width<=m&&this.height<=x){if(v)return!0;for(let E=0;E<this.boxKeys.length;E++)A.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const D=this.circles[3*E],I=this.circles[3*E+1],R=this.circles[3*E+2];A.push({key:this.circleKeys[E],x1:D-R,y1:I-R,x2:D+R,y2:I+R})}return M?A.filter(M):A}return this._forEachCell(r,u,m,x,this._queryCell,A,{hitTest:v,seenUids:{box:{},circle:{}}},M),v?A.length>0:A}_queryCircle(r,u,m,x,v){const M=r-m,A=r+m,E=u-m,D=u+m;if(A<0||M>this.width||D<0||E>this.height)return!x&&[];const I=[];return this._forEachCell(M,E,A,D,this._queryCellCircle,I,{hitTest:x,circle:{x:r,y:u,radius:m},seenUids:{box:{},circle:{}}},v),x?I.length>0:I}query(r,u,m,x,v){return this._query(r,u,m,x,!1,v)}hitTest(r,u,m,x,v){return this._query(r,u,m,x,!0,v)}hitTestCircle(r,u,m,x){return this._queryCircle(r,u,m,!0,x)}_queryCell(r,u,m,x,v,M,A,E){const D=A.seenUids,I=this.boxCells[v];if(null!==I){const V=this.bboxes;for(const Z of I)if(!D.box[Z]){D.box[Z]=!0;const j=4*Z;if(r<=V[j+2]&&u<=V[j+3]&&m>=V[j+0]&&x>=V[j+1]&&(!E||E(this.boxKeys[Z]))){if(A.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[Z],x1:V[j],y1:V[j+1],x2:V[j+2],y2:V[j+3]})}}}const R=this.circleCells[v];if(null!==R){const V=this.circles;for(const Z of R)if(!D.circle[Z]){D.circle[Z]=!0;const j=3*Z;if(this._circleAndRectCollide(V[j],V[j+1],V[j+2],r,u,m,x)&&(!E||E(this.circleKeys[Z]))){if(A.hitTest)return M.push(!0),!0;{const H=V[j],q=V[j+1],U=V[j+2];M.push({key:this.circleKeys[Z],x1:H-U,y1:q-U,x2:H+U,y2:q+U})}}}}}_queryCellCircle(r,u,m,x,v,M,A,E){const D=A.circle,I=A.seenUids,R=this.boxCells[v];if(null!==R){const Z=this.bboxes;for(const j of R)if(!I.box[j]){I.box[j]=!0;const H=4*j;if(this._circleAndRectCollide(D.x,D.y,D.radius,Z[H+0],Z[H+1],Z[H+2],Z[H+3])&&(!E||E(this.boxKeys[j])))return M.push(!0),!0}}const V=this.circleCells[v];if(null!==V){const Z=this.circles;for(const j of V)if(!I.circle[j]){I.circle[j]=!0;const H=3*j;if(this._circlesCollide(Z[H],Z[H+1],Z[H+2],D.x,D.y,D.radius)&&(!E||E(this.circleKeys[j])))return M.push(!0),!0}}}_forEachCell(r,u,m,x,v,M,A,E){const D=this._convertToXCellCoord(r),I=this._convertToYCellCoord(u),R=this._convertToXCellCoord(m),V=this._convertToYCellCoord(x);for(let Z=D;Z<=R;Z++)for(let j=I;j<=V;j++)if(v.call(this,r,u,m,x,this.xCellCount*j+Z,M,A,E))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,m,x,v,M){const A=x-r,E=v-u,D=m+M;return D*D>A*A+E*E}_circleAndRectCollide(r,u,m,x,v,M,A){const E=(M-x)/2,D=Math.abs(r-(x+E));if(D>E+m)return!1;const I=(A-v)/2,R=Math.abs(u-(v+I));if(R>I+m)return!1;if(D<=E||R<=I)return!0;const V=D-E,Z=R-I;return V*V+Z*Z<=m*m}}const Wt=Math.tan(85*Math.PI/180);function Me(p,r,u,m,x,v,M){const A=d.create();if(u)if("globe"===v.name){const E=d.calculateGlobeLabelMatrix(x,r);d.multiply(A,A,E)}else{const E=ro([],M);A[0]=E[0],A[1]=E[1],A[4]=E[2],A[5]=E[3],m||d.rotateZ(A,A,x.angle)}else d.multiply(A,x.labelPlaneMatrix,p);return A}function Ee(p,r,u,m,x,v,M){const A=Me(p,r,u,m,x,v,M);return"globe"===v.name&&u||(A[2]=A[6]=A[10]=A[14]=0),A}function Dn(p,r,u,m,x,v,M){if(u){if("globe"===v.name){const A=Me(p,r,u,m,x,v,M);return d.invert(A,A),d.multiply(A,p,A),A}{const A=d.clone(p),E=d.identity([]);return E[0]=M[0],E[1]=M[1],E[4]=M[2],E[5]=M[3],d.multiply(A,A,E),m||d.rotateZ(A,A,-x.angle),A}}return x.glCoordMatrix}function wn(p,r,u=0){const m=[p.x,p.y,u,1];u?d.transformMat4$1(m,m,r):un(m,m,r);const x=m[3];return{point:[m[0]/x,m[1]/x,m[2]/x],signedDistanceFromCamera:x}}function ve(p,r){const u=[p[0],p[1],p[2],1];d.transformMat4$1(u,u,r);const m=u[3];return{point:[u[0]/m,u[1]/m,u[2]/m],signedDistanceFromCamera:m}}function Ga(p,r){return Math.min(.5+p/r*.5,1.5)}function Ps(p,r){const u=p[0]/p[3],m=p[1]/p[3];return u>=-r[0]&&u<=r[0]&&m>=-r[1]&&m<=r[1]}function yr(p,r,u,m,x,v,M,A,E,D){const I=u.transform,R=m?p.textSizeData:p.iconSizeData,V=d.evaluateSizeForZoom(R,u.transform.zoom),Z="globe"===I.projection.name,j=[256/u.width*2+1,256/u.height*2+1],H=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;H.clear();let q=null;Z&&(q=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const U=p.lineVertexArray,J=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,$=u.transform.width/u.transform.height;let lt=!1;for(let st=0;st<J.length;st++){const et=J.get(st);if(et.writingMode!==d.WritingMode.vertical||lt||0!==st&&J.get(st-1).writingMode===d.WritingMode.horizontal||(lt=!0),(et.hidden||et.writingMode===d.WritingMode.vertical)&&!lt){uo(et.numGlyphs,H);continue}lt=!1;const at=new d.pointGeometry(et.tileAnchorX,et.tileAnchorY),rt=E?E(at):[0,0,0],dt=I.projection.projectTilePoint(at.x,at.y,D.canonical),_t=[dt.x+rt[0],dt.y+rt[1],dt.z+rt[2]],Lt=[..._t,1];if(d.transformMat4$1(Lt,Lt,r),!Ps(Lt,j)){uo(et.numGlyphs,H);continue}const mt=Ga(u.transform.cameraToCenterDistance,Lt[3]),At=d.evaluateSizeForFeature(R,V,et),kt=M?At/mt:At*mt,Gt=wn(new d.pointGeometry(_t[0],_t[1]),x,_t[2]);if(Gt.signedDistanceFromCamera<=0){uo(et.numGlyphs,H);continue}let wt={};const Rt=M?null:E,Tt=Kl(et,kt,!1,A,r,x,v,p.glyphOffsetArray,U,H,q,Gt.point,at,wt,$,Rt,I.projection,D,M);lt=Tt.useVertical,Rt&&Tt.needsFlipping&&(wt={}),(Tt.notEnoughRoom||lt||Tt.needsFlipping&&Kl(et,kt,!0,A,r,x,v,p.glyphOffsetArray,U,H,q,Gt.point,at,wt,$,Rt,I.projection,D,M).notEnoughRoom)&&uo(et.numGlyphs,H)}m?(p.text.dynamicLayoutVertexBuffer.updateData(H),q&&p.text.globeExtVertexBuffer.updateData(q)):(p.icon.dynamicLayoutVertexBuffer.updateData(H),q&&p.icon.globeExtVertexBuffer.updateData(q))}function Bi(p,r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H){const q=A.glyphStartIndex+A.numGlyphs,U=A.lineStartIndex,J=A.lineStartIndex+A.lineLength,$=r.getoffsetX(A.glyphStartIndex),lt=r.getoffsetX(q-1),st=Gr(p*$,u,m,x,v,M,A.segment,U,J,E,D,I,R,V,!0,Z,j,H);if(!st)return null;const et=Gr(p*lt,u,m,x,v,M,A.segment,U,J,E,D,I,R,V,!0,Z,j,H);return et?{first:st,last:et}:null}function di(p,r,u,m){return p.writingMode===d.WritingMode.horizontal&&Math.abs(u.y-r.y)>Math.abs(u.x-r.x)*m?{useVertical:!0}:p.writingMode===d.WritingMode.vertical?r.y<u.y?{needsFlipping:!0}:null:0!==p.flipState&&function(x,v,M){const A=(v.x-x.x)*M;return 0===A||Math.abs((v.y-x.y)/A)>Wt}(r,u,m)?1===p.flipState?{needsFlipping:!0}:null:r.x>u.x?{needsFlipping:!0}:null}function Kl(p,r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H,q,U,J){const $=r/24,lt=p.lineOffsetX*$,st=p.lineOffsetY*$;let et;if(p.numGlyphs>1){const at=p.glyphStartIndex+p.numGlyphs,rt=p.lineStartIndex,dt=p.lineStartIndex+p.lineLength,_t=Bi($,A,lt,st,u,R,V,p,E,v,Z,H,!1,q,U,J);if(!_t)return{notEnoughRoom:!0};const Lt=ve(_t.first.point,M).point,mt=ve(_t.last.point,M).point,At=new d.pointGeometry(Lt[0],Lt[1]),kt=new d.pointGeometry(mt[0],mt[1]);if(m&&!u){const Gt=di(p,At,kt,j);if(p.flipState=Gt&&Gt.needsFlipping?1:2,Gt)return Gt}et=[_t.first];for(let Gt=p.glyphStartIndex+1;Gt<at-1;Gt++)et.push(Gr($*A.getoffsetX(Gt),lt,st,u,R,V,p.segment,rt,dt,E,v,Z,H,!1,!1,q,U,J));et.push(_t.last)}else{if(m&&!u){const rt=wn(V,x).point,dt=p.lineStartIndex+p.segment+1,_t=new d.pointGeometry(E.getx(dt),E.gety(dt)),Lt=wn(_t,x),mt=Lt.signedDistanceFromCamera>0?Lt.point:Ql(V,_t,rt,1,x,void 0,q,U.canonical),At=di(p,new d.pointGeometry(rt[0],rt[1]),new d.pointGeometry(mt[0],mt[1]),j);if(p.flipState=At&&At.needsFlipping?1:2,At)return At}const at=Gr($*A.getoffsetX(p.glyphStartIndex),lt,st,u,R,V,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,E,v,Z,H,!1,!1,q,U,J);if(!at)return{notEnoughRoom:!0};et=[at]}if(I)for(const at of et)d.updateGlobeVertexNormal(I,D.length+0,at.up[0],at.up[1],at.up[2]),d.updateGlobeVertexNormal(I,D.length+1,at.up[0],at.up[1],at.up[2]),d.updateGlobeVertexNormal(I,D.length+2,at.up[0],at.up[1],at.up[2]),d.updateGlobeVertexNormal(I,D.length+3,at.up[0],at.up[1],at.up[2]),d.addDynamicAttributes(D,at.point[0],at.point[1],at.point[2],at.angle);else for(const at of et)d.addDynamicAttributes(D,at.point[0],at.point[1],at.point[2],at.angle);return{}}function Qn(p,r,u,m,x){const v=m.projectTilePoint(p.x,p.y,r);if(!x)return wn(v,u,v.z);const M=x(p);return wn(new d.pointGeometry(v.x+M[0],v.y+M[1]),u,v.z+M[2])}function Ql(p,r,u,m,x,v,M,A){const E=Qn(p.add(p.sub(r)._unit()),A,x,M,v).point,D=d.sub([],u,E);return d.scaleAndAdd([],u,D,m/d.length(D))}function Gr(p,r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H,q,U){const J=m?p-r:p+r;let $=J>0?1:-1,lt=0;m&&($*=-1,lt=Math.PI),$<0&&(lt+=Math.PI);let st=$>0?A+M:A+M+1,et=x,at=x,rt=0,dt=0;const _t=Math.abs(J),Lt=[],mt=[];let At=v;const kt=()=>{const Kt=st-$;return 0===rt?v:new d.pointGeometry(D.getx(Kt),D.gety(Kt))},Gt=()=>Ql(kt(),At,at,_t-rt+1,I,V,H,q.canonical);for(;rt+dt<=_t;){if(st+=$,st<A||st>=E)return null;if(at=et,Lt.push(et),Z&&mt.push(At||kt()),et=R[st],void 0===et){At=new d.pointGeometry(D.getx(st),D.gety(st));const Kt=Qn(At,q.canonical,I,H,V);et=Kt.signedDistanceFromCamera>0?R[st]=Kt.point:Gt()}else At=null;rt+=dt,dt=d.distance(at,et)}At=At||new d.pointGeometry(D.getx(st),D.gety(st));const wt=kt();j&&V&&(R[st]=et=void 0===R[st]?et:Gt(),dt=d.distance(at,et));const Rt=(_t-rt)/dt,Tt=At.sub(wt).mult(Rt)._add(wt),qt=d.sub([],et,at),Ut=d.scaleAndAdd([],at,qt,Rt);let Qt=[0,0,1],ne=qt[0],le=qt[1];if(U&&(Qt=H.upVector(q.canonical,Tt.x,Tt.y),0!==Qt[0]||0!==Qt[1]||1!==Qt[2])){const Kt=[1,0,0],fe=[0,1,0];Kt[0]=Qt[2],Kt[1]=0,Kt[2]=-Qt[0],d.cross(fe,Qt,Kt),d.normalize(Kt,Kt),d.normalize(fe,fe),ne=d.dot(qt,Kt),le=d.dot(qt,fe)}if(u){const Kt=d.cross([],Qt,qt);d.normalize(Kt,Kt),d.scaleAndAdd(Ut,Ut,Kt,u*$)}const Te=lt+Math.atan2(le,ne);return Lt.push(Ut),Z&&mt.push(Tt),{point:Ut,angle:Te,path:Lt,tilePath:mt,up:Qt}}const Na=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function uo(p,r){for(let u=0;u<p;u++){const m=r.length;r.resize(m+4),r.float32.set(Na,4*m)}}function un(p,r,u){const m=r[0],x=r[1];return p[0]=u[0]*m+u[4]*x+u[12],p[1]=u[1]*m+u[5]*x+u[13],p[3]=u[3]*m+u[7]*x+u[15],p}const We=100;class pu{constructor(r,u,m=new co(r.width+200,r.height+200,25),x=new co(r.width+200,r.height+200,25)){this.transform=r,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+We,this.screenBottomBoundary=r.height+We,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=u}placeCollisionBox(r,u,m,x,v,M,A,E){let D=m.projectedAnchorX,I=m.projectedAnchorY,R=m.projectedAnchorZ;const V=m.elevation,Z=m.tileID;if(V&&Z){const st=r.getProjection().upVector(Z.canonical,m.tileAnchorX,m.tileAnchorY),et=r.getProjection().upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=st[0]*V*et,I+=st[1]*V*et,R+=st[2]*V*et}const j=this.projectAndGetPerspectiveRatio(A,[D,I,R],m.tileID,"globe"===r.projection.name||!!V||this.transform.pitch>0,r.getProjection()),H=M*j.perspectiveRatio,q=(m.x1*u+x.x-m.padding)*H+j.point.x,U=(m.y1*u+x.y-m.padding)*H+j.point.y,J=(m.x2*u+x.x+m.padding)*H+j.point.x,$=(m.y2*u+x.y+m.padding)*H+j.point.y,lt=j.perspectiveRatio<=.55||j.occluded;return!this.isInsideGrid(q,U,J,$)||!v&&this.grid.hitTest(q,U,J,$,E)||lt?{box:[],offscreen:!1,occluded:j.occluded}:{box:[q,U,J,$],offscreen:this.isOffscreen(q,U,J,$),occluded:!1}}placeCollisionCircles(r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H){const q=[],U=this.transform.elevation,J=U?U.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,r.getProjection()):wt=>[0,0,0],$=new d.pointGeometry(m.tileAnchorX,m.tileAnchorY),lt=r.getProjection().projectTilePoint(m.tileAnchorX,m.tileAnchorY,H.canonical),st=J($),et=[lt.x+st[0],lt.y+st[1],lt.z+st[2]],at="globe"===r.projection.name,rt=this.projectAndGetPerspectiveRatio(A,[et[0],et[1],et[2]],H,at||!!U||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:dt}=rt,_t=(R?M/dt:M*dt)/d.ONE_EM,Lt=wn(new d.pointGeometry(et[0],et[1]),E,et[2]).point,mt=rt.signedDistanceFromCamera>0?Bi(_t,v,m.lineOffsetX*_t,m.lineOffsetY*_t,!1,Lt,$,m,x,E,{},U&&!R?J:null,R&&!!U,r.getProjection(),H,R):null;let At=!1,kt=!1,Gt=!0;if(mt&&!rt.occluded){const wt=.5*Z*dt+j,Rt=new d.pointGeometry(-100,-100),Tt=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),qt=new Bh,Ut=mt.first,Qt=mt.last;let ne=[];for(let Kt=Ut.path.length-1;Kt>=1;Kt--)ne.push(Ut.path[Kt]);for(let Kt=1;Kt<Qt.path.length;Kt++)ne.push(Qt.path[Kt]);const le=2.5*wt;if(D){const Kt=ne.map(U&&!at?(fe,Be)=>{const ai=J(Be<Ut.path.length-1?Ut.tilePath[Ut.path.length-1-Be]:Qt.tilePath[Be-Ut.path.length+2]);return fe[2]=ai[2],ve(fe,D)}:fe=>ve(fe,D));ne=Kt.some(fe=>fe.signedDistanceFromCamera<=0)?[]:Kt.map(fe=>fe.point)}let Te=[];if(ne.length>0){const Kt=ne.map(Ze=>new d.pointGeometry(Ze[0],Ze[1]));let fe=1/0,Be=-1/0,ai=1/0,xi=-1/0;for(let Ze=0;Ze<Kt.length;Ze++)fe=Math.min(fe,Kt[Ze].x),ai=Math.min(ai,Kt[Ze].y),Be=Math.max(Be,Kt[Ze].x),xi=Math.max(xi,Kt[Ze].y);Te=fe>=Rt.x&&Be<=Tt.x&&ai>=Rt.y&&xi<=Tt.y?[Kt]:Be<Rt.x||fe>Tt.x||xi<Rt.y||ai>Tt.y?[]:d.clipLine([Kt],Rt.x,Rt.y,Tt.x,Tt.y)}for(const Kt of Te){qt.reset(Kt,.25*wt);let fe=0;fe=qt.length<=.5*wt?1:Math.ceil(qt.paddedLength/le)+1;for(let Be=0;Be<fe;Be++){const ai=Be/Math.max(fe-1,1),xi=qt.lerp(ai),Ze=xi.x+We,Ni=xi.y+We;q.push(Ze,Ni,wt,0);const rr=Ze-wt,or=Ni-wt,ii=Ze+wt,fi=Ni+wt;if(Gt=Gt&&this.isOffscreen(rr,or,ii,fi),kt=kt||this.isInsideGrid(rr,or,ii,fi),!u&&this.grid.hitTestCircle(Ze,Ni,wt,V)&&(At=!0,!I))return{circles:[],offscreen:!1,collisionDetected:At,occluded:!1}}}}return{circles:!I&&At||!kt?[]:q,offscreen:Gt,collisionDetected:At,occluded:rt.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let m=1/0,x=1/0,v=-1/0,M=-1/0;for(const I of r){const R=new d.pointGeometry(I.x+We,I.y+We);m=Math.min(m,R.x),x=Math.min(x,R.y),v=Math.max(v,R.x),M=Math.max(M,R.y),u.push(R)}const A=this.grid.query(m,x,v,M).concat(this.ignoredGrid.query(m,x,v,M)),E={},D={};for(const I of A){const R=I.key;if(void 0===E[R.bucketInstanceId]&&(E[R.bucketInstanceId]={}),E[R.bucketInstanceId][R.featureIndex])continue;const V=[new d.pointGeometry(I.x1,I.y1),new d.pointGeometry(I.x2,I.y1),new d.pointGeometry(I.x2,I.y2),new d.pointGeometry(I.x1,I.y2)];d.polygonIntersectsPolygon(u,V)&&(E[R.bucketInstanceId][R.featureIndex]=!0,void 0===D[R.bucketInstanceId]&&(D[R.bucketInstanceId]=[]),D[R.bucketInstanceId].push(R.featureIndex))}return D}insertCollisionBox(r,u,m,x,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,m,x,v){const M=u?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:x,collisionGroupID:v};for(let E=0;E<r.length;E+=4)M.insertCircle(A,r[E],r[E+1],r[E+2])}projectAndGetPerspectiveRatio(r,u,m,x,v){const M=[u[0],u[1],u[2],1];let A=!1;if(u[2]||this.transform.pitch>0){d.transformMat4$1(M,M,r);const E="globe"===v.name;this.fogState&&m&&!E&&(A=function(D,I,R,V,Z,j){const H=j.calculateFogTileMatrix(Z),q=[I,R,V];return d.transformMat4(q,q,H),Gn(D,q,j.pitch,j._fov)}(this.fogState,u[0],u[1],u[2],m.toUnwrapped(),this.transform)>.9)}else un(M,M,r);return{point:new d.pointGeometry((M[0]/M[3]+1)/2*this.transform.width+We,(-M[1]/M[3]+1)/2*this.transform.height+We),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/M[3]*.5,1.5),signedDistanceFromCamera:M[3],occluded:x&&M[2]>M[3]||A}}isOffscreen(r,u,m,x){return m<We||r>=this.screenRightBoundary||x<We||u>this.screenBottomBoundary}isInsideGrid(r,u,m,x){return m>=0&&r<this.gridRightBoundary&&x>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const r=d.identity([]);return d.translate(r,r,[-100,-100,0]),r}}function Rs(p,r,u){const m=r.createTileMatrix(p,p.worldSize,u.toUnwrapped());return d.multiply(new Float32Array(16),p.projMatrix,m)}function en(p,r,u){if(r.projection.name===u.projection.name)return p.projMatrix;const m=u.clone();return m.setProjection(r.projection),Rs(m,r.getProjection(),p)}function hn(p,r,u){return r.name===u.projection.name?p.projMatrix:Rs(u,r,p)}class Ua{constructor(r,u,m,x){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):x&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class xr{constructor(r,u,m,x,v,M=!1){this.text=new Ua(r?r.text:null,u,m,v),this.icon=new Ua(r?r.icon:null,u,x,v),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wi{constructor(r,u,m,x=!1){this.text=r,this.icon=u,this.skipFade=m,this.clipped=x}}class zs{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class ja{constructor(r,u,m,x,v){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=v}}class Bs{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[r]}}function Vi(p,r,u,m,x){const{horizontalAlign:v,verticalAlign:M}=d.getAnchorAlignment(p),A=-(v-.5)*r,E=-(M-.5)*u,D=d.evaluateVariableOffset(p,m);return new d.pointGeometry(A+D[0]*x,E+D[1]*x)}function Wo(p,r,u,m,x){const v=new d.pointGeometry(p,r);return u&&v._rotate(m?x:-x),v}class tc{constructor(r,u,m,x,v){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new pu(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Bs(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,u,m,x){const v=m.getBucket(u),M=m.latestFeatureIndex;if(!v||!M||u.id!==v.layerIds[0])return;const A=v.layers[0].layout,E=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),I=m.tileSize/d.EXTENT,R=m.tileID.toUnwrapped();this.transform.setProjection(v.projection);const V=(Z=m.tileID,j=v.getProjection(),H=this.transform,j.name===this.projection?H.calculateProjMatrix(Z.toUnwrapped()):Rs(H,j,Z));var Z,j,H;const q="map"===A.get("text-pitch-alignment"),U="map"===A.get("text-rotation-alignment");u.compileFilter();const J=u.dynamicFilter(),$=u.dynamicFilterNeedsFeature(),lt=this.transform.calculatePixelsToTileUnitsMatrix(m),st=Ee(V,m.tileID.canonical,q,U,this.transform,v.getProjection(),lt);let et=null;if(q){const dt=Dn(V,m.tileID.canonical,q,U,this.transform,v.getProjection(),lt);et=d.multiply([],this.transform.labelPlaneMatrix,dt)}let at=null;J&&m.latestFeatureIndex&&(at={unwrappedTileID:R,dynamicFilter:J,dynamicFilterNeedsFeature:$,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new ja(v.bucketInstanceId,M,v.sourceLayerIndex,v.index,m.tileID);const rt={bucket:v,layout:A,posMatrix:V,textLabelPlaneMatrix:st,labelToScreenMatrix:et,clippingData:at,scale:D,textPixelRatio:I,holdingForFade:m.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(x)for(const dt of v.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:Lt,symbolInstanceEnd:mt}=dt;r.push({sortKey:_t,symbolInstanceStart:Lt,symbolInstanceEnd:mt,parameters:rt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:rt})}attemptAnchorPlacement(r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H,q,U,J){const $=[V.textOffset0,V.textOffset1],lt=Vi(r,m,x,$,v),st=this.collisionIndex.placeCollisionBox(j,v,u,Wo(lt.x,lt.y,M,A,this.transform.angle),R,E,D,I.predicate);if((!q||0!==this.collisionIndex.placeCollisionBox(j,j.getSymbolInstanceIconSize(J,this.transform.zoom,Z),q,Wo(lt.x,lt.y,M,A,this.transform.angle),R,E,D,I.predicate).box.length)&&st.box.length>0){let et;return this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(et=this.prevPlacement.variableOffsets[V.crossTileID].anchor),this.variableOffsets[V.crossTileID]={textOffset:$,width:m,height:x,anchor:r,textScale:v,prevAnchor:et},this.markUsedJustification(j,r,V,H),j.allowVerticalPlacement&&(this.markUsedOrientation(j,H,V),this.placedOrientations[V.crossTileID]=H),{shift:lt,placedGlyphBoxes:st}}}placeLayerBucketPart(r,u,m,x){const{bucket:v,layout:M,posMatrix:A,textLabelPlaneMatrix:E,labelToScreenMatrix:D,clippingData:I,textPixelRatio:R,holdingForFade:V,collisionBoxArray:Z,partiallyEvaluatedTextSize:j,partiallyEvaluatedIconSize:H,collisionGroup:q}=r.parameters,U=M.get("text-optional"),J=M.get("icon-optional"),$=M.get("text-allow-overlap"),lt=M.get("icon-allow-overlap"),st="map"===M.get("text-rotation-alignment"),et="map"===M.get("text-pitch-alignment"),at="none"!==M.get("icon-text-fit"),rt="viewport-y"===M.get("symbol-z-order");this.transform.setProjection(v.projection);let dt=$&&(lt||!v.hasIconData()||J),_t=lt&&($||!v.hasTextData()||U);!v.collisionArrays&&Z&&v.deserializeCollisionBoxes(Z),m&&x&&v.updateCollisionDebugBuffers(this.transform.zoom,Z);const Lt=(mt,At,kt)=>{if(I){const ii={zoom:this.transform.zoom,pitch:this.transform.pitch};let fi=null;if(I.dynamicFilterNeedsFeature){const Ae=this.retainedQueryData[v.bucketInstanceId];fi=I.featureIndex.loadFeature({featureIndex:mt.featureIndex,bucketIndex:Ae.bucketIndex,sourceLayerIndex:Ae.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(ii,fi,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new d.pointGeometry(mt.tileAnchorX,mt.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[mt.crossTileID]=new wi(!1,!1,!1,!0),void(u[mt.crossTileID]=!0)}if(u[mt.crossTileID])return;if(V)return void(this.placements[mt.crossTileID]=new wi(!1,!1,!1));let Gt=!1,wt=!1,Rt=!0,Tt=!1,qt=!1,Ut=null,Qt={box:null,offscreen:null,occluded:null},ne={box:null,offscreen:null,occluded:null},le=null,Te=null,Kt=null,fe=0,Be=0,ai=0;kt.textFeatureIndex?fe=kt.textFeatureIndex:mt.useRuntimeCollisionCircles&&(fe=mt.featureIndex),kt.verticalTextFeatureIndex&&(Be=kt.verticalTextFeatureIndex);const xi=ii=>{ii.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||ii.elevation)&&(ii.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,ii.tileAnchorX,ii.tileAnchorY):0)},Ze=kt.textBox;if(Ze){xi(Ze);const ii=Ae=>{let Ei=d.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Ae&&this.prevPlacement){const qi=this.prevPlacement.placedOrientations[mt.crossTileID];qi&&(this.placedOrientations[mt.crossTileID]=qi,Ei=qi,this.markUsedOrientation(v,Ei,mt))}return Ei},fi=(Ae,Ei)=>{if(v.allowVerticalPlacement&&mt.numVerticalGlyphVertices>0&&kt.verticalTextBox){for(const qi of v.writingModes)if(qi===d.WritingMode.vertical?(Qt=Ei(),ne=Qt):Qt=Ae(),Qt&&Qt.box&&Qt.box.length)break}else Qt=Ae()};if(M.get("text-variable-anchor")){let Ae=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[mt.crossTileID]){const Qe=this.prevPlacement.variableOffsets[mt.crossTileID];Ae.indexOf(Qe.anchor)>0&&(Ae=Ae.filter(nn=>nn!==Qe.anchor),Ae.unshift(Qe.anchor))}const Ei=(Qe,nn,Eo)=>{const rn=v.getSymbolInstanceTextSize(j,mt,this.transform.zoom,At),qr=(Qe.x2-Qe.x1)*rn+2*Qe.padding,Zr=(Qe.y2-Qe.y1)*rn+2*Qe.padding,To=at&&!lt?nn:null;To&&xi(To);let on={box:[],offscreen:!1,occluded:!1};const ko=$?2*Ae.length:Ae.length;for(let $r=0;$r<ko;++$r){const ha=this.attemptAnchorPlacement(Ae[$r%Ae.length],Qe,qr,Zr,rn,st,et,R,A,q,$r>=Ae.length,mt,At,v,Eo,To,j,H);if(ha&&(on=ha.placedGlyphBoxes,on&&on.box&&on.box.length)){Gt=!0,Ut=ha.shift;break}}return on};fi(()=>Ei(Ze,kt.iconBox,d.WritingMode.horizontal),()=>{const Qe=kt.verticalTextBox;return Qe&&xi(Qe),v.allowVerticalPlacement&&!(Qt&&Qt.box&&Qt.box.length)&&mt.numVerticalGlyphVertices>0&&Qe?Ei(Qe,kt.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Qt&&(Gt=Qt.box,Rt=Qt.offscreen,Tt=Qt.occluded);const qi=ii(Qt&&Qt.box);if(!Gt&&this.prevPlacement){const Qe=this.prevPlacement.variableOffsets[mt.crossTileID];Qe&&(this.variableOffsets[mt.crossTileID]=Qe,this.markUsedJustification(v,Qe.anchor,mt,qi))}}else{const Ae=(Ei,qi)=>{const Qe=v.getSymbolInstanceTextSize(j,mt,this.transform.zoom,At),nn=this.collisionIndex.placeCollisionBox(v,Qe,Ei,new d.pointGeometry(0,0),$,R,A,q.predicate);return nn&&nn.box&&nn.box.length&&(this.markUsedOrientation(v,qi,mt),this.placedOrientations[mt.crossTileID]=qi),nn};fi(()=>Ae(Ze,d.WritingMode.horizontal),()=>{const Ei=kt.verticalTextBox;return v.allowVerticalPlacement&&mt.numVerticalGlyphVertices>0&&Ei?(xi(Ei),Ae(Ei,d.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ii(Qt&&Qt.box&&Qt.box.length)}}if(le=Qt,Gt=le&&le.box&&le.box.length>0,Rt=le&&le.offscreen,Tt=le&&le.occluded,mt.useRuntimeCollisionCircles){const ii=v.text.placedSymbolArray.get(mt.centerJustifiedTextSymbolIndex>=0?mt.centerJustifiedTextSymbolIndex:mt.verticalPlacedTextSymbolIndex),fi=d.evaluateSizeForFeature(v.textSizeData,j,ii),Ae=M.get("text-padding");Te=this.collisionIndex.placeCollisionCircles(v,$,ii,v.lineVertexArray,v.glyphOffsetArray,fi,A,E,D,m,et,q.predicate,mt.collisionCircleDiameter*fi/d.ONE_EM,Ae,this.retainedQueryData[v.bucketInstanceId].tileID),Gt=$||Te.circles.length>0&&!Te.collisionDetected,Rt=Rt&&Te.offscreen,Tt=Te.occluded}if(kt.iconFeatureIndex&&(ai=kt.iconFeatureIndex),kt.iconBox){const ii=fi=>{xi(fi);const Ae=at&&Ut?Wo(Ut.x,Ut.y,st,et,this.transform.angle):new d.pointGeometry(0,0),Ei=v.getSymbolInstanceIconSize(H,this.transform.zoom,At);return this.collisionIndex.placeCollisionBox(v,Ei,fi,Ae,lt,R,A,q.predicate)};ne&&ne.box&&ne.box.length&&kt.verticalIconBox?(Kt=ii(kt.verticalIconBox),wt=Kt.box.length>0):(Kt=ii(kt.iconBox),wt=Kt.box.length>0),Rt=Rt&&Kt.offscreen,qt=Kt.occluded}const Ni=U||0===mt.numHorizontalGlyphVertices&&0===mt.numVerticalGlyphVertices,rr=J||0===mt.numIconVertices;if(Ni||rr?rr?Ni||(wt=wt&&Gt):Gt=wt&&Gt:wt=Gt=wt&&Gt,Gt&&le&&le.box&&this.collisionIndex.insertCollisionBox(le.box,M.get("text-ignore-placement"),v.bucketInstanceId,ne&&ne.box&&Be?Be:fe,q.ID),wt&&Kt&&this.collisionIndex.insertCollisionBox(Kt.box,M.get("icon-ignore-placement"),v.bucketInstanceId,ai,q.ID),Te&&(Gt&&this.collisionIndex.insertCollisionCircles(Te.circles,M.get("text-ignore-placement"),v.bucketInstanceId,fe,q.ID),m)){const ii=v.bucketInstanceId;let fi=this.collisionCircleArrays[ii];void 0===fi&&(fi=this.collisionCircleArrays[ii]=new zs);for(let Ae=0;Ae<Te.circles.length;Ae+=4)fi.circles.push(Te.circles[Ae+0]),fi.circles.push(Te.circles[Ae+1]),fi.circles.push(Te.circles[Ae+2]),fi.circles.push(Te.collisionDetected?1:0)}const or="globe"!==v.projection.name;dt=dt&&(or||!Tt),_t=_t&&(or||!qt),this.placements[mt.crossTileID]=new wi(Gt||dt,wt||_t,Rt||v.justReloaded),u[mt.crossTileID]=!0};if(rt){const mt=v.getSortedSymbolIndexes(this.transform.angle);for(let At=mt.length-1;At>=0;--At){const kt=mt[At];Lt(v.symbolInstances.get(kt),kt,v.collisionArrays[kt])}}else for(let mt=r.symbolInstanceStart;mt<r.symbolInstanceEnd;mt++)Lt(v.symbolInstances.get(mt),mt,v.collisionArrays[mt]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const mt=this.collisionCircleArrays[v.bucketInstanceId];d.invert(mt.invProjMatrix,A),mt.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,u,m,x){let v;v=x===d.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(u)];const M=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const A of M)A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=v>=0&&A!==v?0:m.crossTileID)}markUsedOrientation(r,u,m){const x=u===d.WritingMode.horizontal||u===d.WritingMode.horizontalOnly?u:0,v=u===d.WritingMode.vertical?u:0,M=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const A of M)r.text.placedSymbolArray.get(A).placedOrientation=x;m.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const x=u?u.symbolFadeChange(r):1,v=u?u.opacities:{},M=u?u.variableOffsets:{},A=u?u.placedOrientations:{};for(const E in this.placements){const D=this.placements[E],I=v[E];I?(this.opacities[E]=new xr(I,x,D.text,D.icon,null,D.clipped),m=m||D.text!==I.text.placed||D.icon!==I.icon.placed):(this.opacities[E]=new xr(null,x,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const E in v){const D=v[E];if(!this.opacities[E]){const I=new xr(D,x,!1,!1);I.isHidden()||(this.opacities[E]=I,m=m||D.text.placed||D.icon.placed)}}for(const E in M)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=M[E]);for(const E in A)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=A[E]);m?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u){const m={};for(const x of u){const v=x.getBucket(r);v&&x.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,m,x.collisionBoxArray)}}updateBucketOpacities(r,u,m){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const x=r.layers[0].layout,v=!!r.layers[0].dynamicFilter(),M=new xr(null,0,!1,!1,!0),A=x.get("text-allow-overlap"),E=x.get("icon-allow-overlap"),D=x.get("text-variable-anchor"),I="map"===x.get("text-rotation-alignment"),R="map"===x.get("text-pitch-alignment"),V="none"!==x.get("icon-text-fit"),Z=new xr(null,0,A&&(E||!r.hasIconData()||x.get("icon-optional")),E&&(A||!r.hasTextData()||x.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const j=(q,U,J)=>{for(let $=0;$<U/4;$++)q.opacityVertexArray.emplaceBack(J)};let H=0;for(let q=0;q<r.symbolInstances.length;q++){const U=r.symbolInstances.get(q),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:$,crossTileID:lt}=U;let st=this.opacities[lt];u[lt]?st=M:st||(st=Z,this.opacities[lt]=st),u[lt]=!0;const et=J>0||$>0,at=U.numIconVertices>0,rt=this.placedOrientations[U.crossTileID],dt=rt===d.WritingMode.vertical,_t=rt===d.WritingMode.horizontal||rt===d.WritingMode.horizontalOnly;if(!et&&!at||st.isHidden()||H++,et){const Lt=po(st.text);j(r.text,J,dt?Mn:Lt),j(r.text,$,_t?Mn:Lt);const mt=st.text.isHidden();[U.rightJustifiedTextSymbolIndex,U.centerJustifiedTextSymbolIndex,U.leftJustifiedTextSymbolIndex].forEach(Gt=>{Gt>=0&&(r.text.placedSymbolArray.get(Gt).hidden=mt||dt?1:0)}),U.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(U.verticalPlacedTextSymbolIndex).hidden=mt||_t?1:0);const At=this.variableOffsets[U.crossTileID];At&&this.markUsedJustification(r,At.anchor,U,rt);const kt=this.placedOrientations[U.crossTileID];kt&&(this.markUsedJustification(r,"left",U,kt),this.markUsedOrientation(r,kt,U))}if(at){const Lt=po(st.icon);U.placedIconSymbolIndex>=0&&(j(r.icon,U.numIconVertices,dt?Mn:Lt),r.icon.placedSymbolArray.get(U.placedIconSymbolIndex).hidden=st.icon.isHidden()),U.verticalPlacedIconSymbolIndex>=0&&(j(r.icon,U.numVerticalIconVertices,_t?Mn:Lt),r.icon.placedSymbolArray.get(U.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Lt=r.collisionArrays[q];if(Lt){let mt=new d.pointGeometry(0,0),At=!0;if(Lt.textBox||Lt.verticalTextBox){if(D){const Gt=this.variableOffsets[lt];Gt?(mt=Vi(Gt.anchor,Gt.width,Gt.height,Gt.textOffset,Gt.textScale),I&&mt._rotate(R?this.transform.angle:-this.transform.angle)):At=!1}v&&(At=!st.clipped),Lt.textBox&&Cn(r.textCollisionBox.collisionVertexArray,st.text.placed,!At||dt,mt.x,mt.y),Lt.verticalTextBox&&Cn(r.textCollisionBox.collisionVertexArray,st.text.placed,!At||_t,mt.x,mt.y)}const kt=At&&Boolean(!_t&&Lt.verticalIconBox);Lt.iconBox&&Cn(r.iconCollisionBox.collisionVertexArray,st.icon.placed,kt,V?mt.x:0,V?mt.y:0),Lt.verticalIconBox&&Cn(r.iconCollisionBox.collisionVertexArray,st.icon.placed,!kt,V?mt.x:0,V?mt.y:0)}}}if(r.fullyClipped=0===H,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const q=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=q.invProjMatrix,r.placementViewportMatrix=q.viewportMatrix,r.collisionCircleArray=q.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function Cn(p,r,u,m,x){p.emplaceBack(r?1:0,u?1:0,m||0,x||0),p.emplaceBack(r?1:0,u?1:0,m||0,x||0),p.emplaceBack(r?1:0,u?1:0,m||0,x||0),p.emplaceBack(r?1:0,u?1:0,m||0,x||0)}const Vs=Math.pow(2,25),Gs=Math.pow(2,24),ec=Math.pow(2,17),ic=Math.pow(2,16),ho=Math.pow(2,9),Vh=Math.pow(2,8),Xo=Math.pow(2,1);function po(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const r=p.placed?1:0,u=Math.floor(127*p.opacity);return u*Vs+r*Gs+u*ec+r*ic+u*ho+r*Vh+u*Xo+r}const Mn=0;class Ha{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,u,m,x,v){const M=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(M,x,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((A,E)=>A.sortKey-E.sortKey));this._currentPartIndex<M.length;){const A=M[this._currentPartIndex];if(u.placeLayerBucketPart(A,this._seenCrossTileIDs,m,0===A.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class tr{constructor(r,u,m,x,v,M,A,E){this.placement=new tc(r,v,M,A,E),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(r,u,m){const x=d.exported.now(),v=()=>{const M=d.exported.now()-x;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=u[r[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=A)&&(!M.maxzoom||M.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Ha(M)),this._inProgressLayer.continuePlacement(m[M.source],this.placement,this._showCollisionBoxes,M,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const qa=512/d.EXTENT/2;class Za{constructor(r,u,m){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let x=0;x<u.length;x++){const v=u.get(x),M=v.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,r)})}}getScaledCoordinates(r,u){const m=qa/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*d.EXTENT+r.tileAnchorX)*m),y:Math.floor((u.canonical.y*d.EXTENT+r.tileAnchorY)*m)}}findMatches(r,u,m){const x=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let v=0;v<r.length;v++){const M=r.get(v);if(M.crossTileID)continue;const A=this.indexedSymbolInstances[M.key];if(!A)continue;const E=this.getScaledCoordinates(M,u);for(const D of A)if(Math.abs(D.coord.x-E.x)<=x&&Math.abs(D.coord.y-E.y)<=x&&!m[D.crossTileID]){m[D.crossTileID]=!0,M.crossTileID=D.crossTileID;break}}}}class fu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const u=Math.round((r-this.lng)/360);if(0!==u)for(const m in this.indexes){const x=this.indexes[m],v={};for(const M in x){const A=x[M];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+u),v[A.tileID.key]=A}this.indexes[m]=v}this.lng=r}addBucket(r,u,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<u.symbolInstances.length;v++)u.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const x=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const M=this.indexes[v];if(Number(v)>r.overscaledZ)for(const A in M){const E=M[A];E.tileID.isChildOf(r)&&E.findMatches(u.symbolInstances,r,x)}else{const A=M[r.scaledTo(Number(v)).key];A&&A.findMatches(u.symbolInstances,r,x)}}for(let v=0;v<u.symbolInstances.length;v++){const M=u.symbolInstances.get(v);M.crossTileID||(M.crossTileID=m.generate(),x[M.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Za(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(const m in u.indexedSymbolInstances)for(const x of u.indexedSymbolInstances[m])delete this.usedCrossTileIDs[r][x.crossTileID]}removeStaleBuckets(r){let u=!1;for(const m in this.indexes){const x=this.indexes[m];for(const v in x)r[x[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[v]),delete x[v],u=!0)}return u}}class Ns{constructor(){this.layerIndexes={},this.crossTileIDs=new fu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,m,x){let v=this.layerIndexes[r.id];void 0===v&&(v=this.layerIndexes[r.id]=new Gh);let M=!1;const A={};"globe"!==x.name&&v.handleWrapJump(m);for(const E of u){const D=E.getBucket(r);D&&r.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(E.tileID,D,this.crossTileIDs)&&(M=!0),A[D.bucketInstanceId]=!0)}return v.removeStaleBuckets(A)&&(M=!0),M}pruneUnusedLayers(r){const u={};r.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const $a=(p,r)=>d.emitValidationErrors(p,r&&r.filter(u=>"source.canvas"!==u.identifier)),Ya=d.pick(ie,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Nh=d.pick(ie,["setCenter","setZoom","setBearing","setPitch"]),mu={version:8,layers:[],sources:{}},gu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class In extends d.Evented{constructor(r,u={}){super(),this.map=r,this.dispatcher=new zi(Ge(),this),this.imageManager=new Yn,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(r._requestManager,u.localFontFamily?d.LocalGlyphMode.all:u.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new Ns,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const m=this;this._rtlTextPluginCallback=In.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(v,M)=>{if(d.triggerPluginCompletionEvent(v),M&&M.every(A=>A))for(const A in m._sourceCaches){const E=m._sourceCaches[A],D=E.getSource().type;"vector"!==D&&"geojson"!==D||E.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const v=this.getSource(x.sourceId);if(v&&v.vectorLayerIds)for(const M in this._layers){const A=this._layers[M];A.source===v.id&&this._validateLayer(A)}})}loadURL(r,u={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof u.validate?u.validate:!d.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,u.accessToken);const x=this.map._requestManager.transformRequest(r,d.ResourceType.Style);this._request=d.getJSON(x,(v,M)=>{this._request=null,v?this.fire(new d.ErrorEvent(v)):M&&this._load(M,m)})}loadJSON(r,u={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(r,!1!==u.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(mu,!1)}_updateLayerCount(r,u){const m=u?1:-1;r.is3D()&&(this._num3DLayers+=m),"circle"===r.type&&(this._numCircleLayers+=m),"symbol"===r.type&&(this._numSymbolLayers+=m)}_load(r,u){if(u&&$a(this,d.validateStyle(r)))return;this._loaded=!0,this.stylesheet=d.clone$1(r),this._updateMapProjection();for(const x in r.sources)this.addSource(x,r.sources[x],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const m=Ne(this.stylesheet.layers);this._order=m.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of m)x=d.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ts(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(u,m,x){let v,M,A;const E=d.exported.devicePixelRatio>1?"@2x":"";let D=d.getJSON(m.transformRequest(m.normalizeSpriteURL(u,E,".json"),d.ResourceType.SpriteJSON),(V,Z)=>{D=null,A||(A=V,v=Z,R())}),I=d.getImage(m.transformRequest(m.normalizeSpriteURL(u,E,".png"),d.ResourceType.SpriteImage),(V,Z)=>{I=null,A||(A=V,M=Z,R())});function R(){if(A)x(A);else if(v&&M){const V=d.exported.getImageData(M),Z={};for(const j in v){const{width:H,height:q,x:U,y:J,sdf:$,pixelRatio:lt,stretchX:st,stretchY:et,content:at}=v[j],rt=new d.RGBAImage({width:H,height:q});d.RGBAImage.copy(V,rt,{x:U,y:J},{x:0,y:0},{width:H,height:q}),Z[j]={data:rt,pixelRatio:lt,sdf:$,stretchX:st,stretchY:et,content:at}}x(null,Z)}}return{cancel(){D&&(D.cancel(),D=null),I&&(I.cancel(),I=null)}}}(r,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new d.ErrorEvent(u));else if(m)for(const x in m)this.imageManager.addImage(x,m[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(r){const u=this.getSource(r.source);if(!u)return;const m=r.sourceLayer;m&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(m))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const u=[];for(const m of r){const x=this._layers[m];"custom"!==x.type&&u.push(x.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&gu[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const u=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(x.length||v.length)&&this._updateWorkerLayers(x,v);for(const M in this._updatedSources){const A=this._updatedSources[M];"reload"===A?this._reloadSource(M):"clear"===A&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const m={};for(const x in this._sourceCaches){const v=this._sourceCaches[x];m[x]=v.used,v.used=!1}for(const x of this._order){const v=this._layers[x];if(v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)){const A=this._getLayerSourceCache(v);A&&(A.used=!0)}const M=this.map.painter;if(M){const A=v.getProgramIds();if(!A)continue;const E=v.getProgramConfiguration(r.zoom);for(const D of A)M.useProgram(D,E)}}for(const x in m){const v=this._sourceCaches[x];m[x]!==v.used&&v.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),$a(this,d.validateStyle(r)))return!1;(r=d.clone$1(r)).layers=Ne(r.layers);const u=function(x,v){if(!x)return[{command:ie.setStyle,args:[v]}];let M=[];try{if(!zt(x.version,v.version))return[{command:ie.setStyle,args:[v]}];zt(x.center,v.center)||M.push({command:ie.setCenter,args:[v.center]}),zt(x.zoom,v.zoom)||M.push({command:ie.setZoom,args:[v.zoom]}),zt(x.bearing,v.bearing)||M.push({command:ie.setBearing,args:[v.bearing]}),zt(x.pitch,v.pitch)||M.push({command:ie.setPitch,args:[v.pitch]}),zt(x.sprite,v.sprite)||M.push({command:ie.setSprite,args:[v.sprite]}),zt(x.glyphs,v.glyphs)||M.push({command:ie.setGlyphs,args:[v.glyphs]}),zt(x.transition,v.transition)||M.push({command:ie.setTransition,args:[v.transition]}),zt(x.light,v.light)||M.push({command:ie.setLight,args:[v.light]}),zt(x.fog,v.fog)||M.push({command:ie.setFog,args:[v.fog]}),zt(x.projection,v.projection)||M.push({command:ie.setProjection,args:[v.projection]});const A={},E=[];!function(R,V,Z,j){let H;for(H in V=V||{},R=R||{})R.hasOwnProperty(H)&&(V.hasOwnProperty(H)||bn(H,Z,j));for(H in V)V.hasOwnProperty(H)&&(R.hasOwnProperty(H)?zt(R[H],V[H])||("geojson"===R[H].type&&"geojson"===V[H].type&&Vr(R,V,H)?Z.push({command:ie.setGeoJSONSourceData,args:[H,V[H].data]}):gi(H,V,Z,j)):Ct(H,V,Z))}(x.sources,v.sources,E,A);const D=[];x.layers&&x.layers.forEach(R=>{R.source&&A[R.source]?M.push({command:ie.removeLayer,args:[R.id]}):D.push(R)});let I=x.terrain;I&&A[I.source]&&(M.push({command:ie.setTerrain,args:[void 0]}),I=void 0),M=M.concat(E),zt(I,v.terrain)||M.push({command:ie.setTerrain,args:[v.terrain]}),function(R,V,Z){V=V||[];const j=(R=R||[]).map(Un),H=V.map(Un),q=R.reduce(Jl,{}),U=V.reduce(Jl,{}),J=j.slice(),$=Object.create(null);let lt,st,et,at,rt,dt,_t;for(lt=0,st=0;lt<j.length;lt++)et=j[lt],U.hasOwnProperty(et)?st++:(Z.push({command:ie.removeLayer,args:[et]}),J.splice(J.indexOf(et,st),1));for(lt=0,st=0;lt<H.length;lt++)et=H[H.length-1-lt],J[J.length-1-lt]!==et&&(q.hasOwnProperty(et)?(Z.push({command:ie.removeLayer,args:[et]}),J.splice(J.lastIndexOf(et,J.length-st),1)):st++,dt=J[J.length-lt],Z.push({command:ie.addLayer,args:[U[et],dt]}),J.splice(J.length-lt,0,et),$[et]=!0);for(lt=0;lt<H.length;lt++)if(et=H[lt],at=q[et],rt=U[et],!$[et]&&!zt(at,rt))if(zt(at.source,rt.source)&&zt(at["source-layer"],rt["source-layer"])&&zt(at.type,rt.type)){for(_t in Ls(at.layout,rt.layout,Z,et,null,ie.setLayoutProperty),Ls(at.paint,rt.paint,Z,et,null,ie.setPaintProperty),zt(at.filter,rt.filter)||Z.push({command:ie.setFilter,args:[et,rt.filter]}),zt(at.minzoom,rt.minzoom)&&zt(at.maxzoom,rt.maxzoom)||Z.push({command:ie.setLayerZoomRange,args:[et,rt.minzoom,rt.maxzoom]}),at)at.hasOwnProperty(_t)&&"layout"!==_t&&"paint"!==_t&&"filter"!==_t&&"metadata"!==_t&&"minzoom"!==_t&&"maxzoom"!==_t&&(0===_t.indexOf("paint.")?Ls(at[_t],rt[_t],Z,et,_t.slice(6),ie.setPaintProperty):zt(at[_t],rt[_t])||Z.push({command:ie.setLayerProperty,args:[et,_t,rt[_t]]}));for(_t in rt)rt.hasOwnProperty(_t)&&!at.hasOwnProperty(_t)&&"layout"!==_t&&"paint"!==_t&&"filter"!==_t&&"metadata"!==_t&&"minzoom"!==_t&&"maxzoom"!==_t&&(0===_t.indexOf("paint.")?Ls(at[_t],rt[_t],Z,et,_t.slice(6),ie.setPaintProperty):zt(at[_t],rt[_t])||Z.push({command:ie.setLayerProperty,args:[et,_t,rt[_t]]}))}else Z.push({command:ie.removeLayer,args:[et]}),dt=J[J.lastIndexOf(et)+1],Z.push({command:ie.addLayer,args:[rt,dt]})}(D,v.layers,M)}catch(A){console.warn("Unable to compute style diff:",A),M=[{command:ie.setStyle,args:[v]}]}return M}(this.serialize(),r).filter(x=>!(x.command in Nh));if(0===u.length)return!1;const m=u.filter(x=>!(x.command in Ya));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);return u.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,u){return this.getImage(r)?this.fire(new d.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,u),this._afterImageUpdated(r),this)}updateImage(r,u){this.imageManager.updateImage(r,u)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new d.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,u,m={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(d.validateSource,`sources.${r}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const x=gt(r,u,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:x.serialize(),sourceId:r}));const v=M=>{const A=(M?"symbol:":"other:")+r,E=this._sourceCaches[A]=new d.SourceCache(A,x,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[r]=E,E.style=this,E.onAdd(this.map)};v(!1),"vector"!==u.type&&"geojson"!==u.type||v(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const u=this.getSource(r);if(!u)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===r)return this.fire(new d.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new d.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(r);for(const x of m)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,u){this._checkLoaded(),this.getSource(r).setData(u),this._changed=!0}getSource(r){const u=this._getSourceCache(r);return u&&u.getSource()}addLayer(r,u,m={}){this._checkLoaded();const x=r.id;if(this.getLayer(x))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let v;if("custom"===r.type){if($a(this,d.validateCustomStyleLayer(r)))return;v=d.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(x,r.source),r=d.clone$1(r),r=d.extend(r,{source:x})),this._validate(d.validateLayer,`layers.${x}`,r,{arrayIndex:-1},m))return;v=d.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const M=u?this._order.indexOf(u):this._order.length;if(u&&-1===M)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(M,0,x),this._layerOrderChanged=!0,this._layers[x]=v;const A=this._getLayerSourceCache(v);if(this._removedLayers[x]&&v.source&&A&&"custom"!==v.type){const E=this._removedLayers[x];delete this._removedLayers[x],E.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",A.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,u){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===u)return;const m=this._order.indexOf(r);this._order.splice(m,1);const x=u?this._order.indexOf(u):this._order.length;u&&-1===x?this.fire(new d.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(x,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const u=this._layers[r];if(!u)return void this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=u,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const u in this._layers)if(this._layers[u].type===r)return!0;return!1}setLayerZoomRange(r,u,m){this._checkLoaded();const x=this.getLayer(r);x?x.minzoom===u&&x.maxzoom===m||(null!=u&&(x.minzoom=u),null!=m&&(x.maxzoom=m),this._updateLayer(x)):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,u,m={}){this._checkLoaded();const x=this.getLayer(r);if(x){if(!zt(x.filter,u))return null==u?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(d.validateFilter,`layers.${x.id}.filter`,u,{layerType:x.type},m)||(x.filter=d.clone$1(u),this._updateLayer(x)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const u=this.getLayer(r);return u&&d.clone$1(u.filter)}setLayoutProperty(r,u,m,x={}){this._checkLoaded();const v=this.getLayer(r);v?zt(v.getLayoutProperty(u),m)||(v.setLayoutProperty(u,m,x),this._updateLayer(v)):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,u){const m=this.getLayer(r);if(m)return m.getLayoutProperty(u);this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,u,m,x={}){this._checkLoaded();const v=this.getLayer(r);v?zt(v.getPaintProperty(u),m)||(v.setPaintProperty(u,m,x)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,u){const m=this.getLayer(r);return m&&m.getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();const m=r.source,x=r.sourceLayer,v=this.getSource(m);if(!v)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const M=v.type;if("geojson"===M&&x)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!x)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(m);for(const E of A)E.setFeatureState(x,r.id,u)}removeFeatureState(r,u){this._checkLoaded();const m=r.source,x=this.getSource(m);if(!x)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const v=x.type,M="vector"===v?r.sourceLayer:void 0;if("vector"===v&&!M)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(m);for(const E of A)E.removeFeatureState(M,r.id,u)}getFeatureState(r){this._checkLoaded();const u=r.source,m=r.sourceLayer,x=this.getSource(u);if(x){if("vector"!==x.type||m)return void 0===r.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(m,r.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();r[m.id]||(r[m.id]=m.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(r){this._updatedLayers[r.id]=!0;const u=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[r.source]="reload",u.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const u=M=>"fill-extrusion"===this._layers[M].type,m={},x=[];for(let M=this._order.length-1;M>=0;M--){const A=this._order[M];if(u(A)){m[A]=M;for(const E of r){const D=E[A];if(D)for(const I of D)x.push(I)}}}x.sort((M,A)=>A.intersectionZ-M.intersectionZ);const v=[];for(let M=this._order.length-1;M>=0;M--){const A=this._order[M];if(u(A))for(let E=x.length-1;E>=0;E--){const D=x[E].feature;if(m[D.layer.id]<M)break;v.push(D),x.pop()}else for(const E of r){const D=E[A];if(D)for(const I of D)v.push(I.feature)}}return v}queryRenderedFeatures(r,u,m){u&&u.filter&&this._validate(d.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const x={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of u.layers){const D=this._layers[E];if(!D)return this.fire(new d.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];x[D.source]=!0}}const v=[];u.availableImages=this._availableImages;const M=u&&u.layers?u.layers.some(E=>{const D=this.getLayer(E);return D&&D.is3D()}):this.has3DLayers(),A=cn.createFromScreenPoints(r,m);for(const E in this._sourceCaches){const D=this._sourceCaches[E].getSource().id;u.layers&&!x[D]||v.push(Yt(this._sourceCaches[E],this._layers,this._serializedLayers,A,u,m,M,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(E,D,I,R,V,Z,j){const H={},q=Z.queryRenderedSymbols(R),U=[];for(const J of Object.keys(q).map(Number))U.push(j[J]);U.sort(re);for(const J of U){const $=J.featureIndex.lookupSymbolFeatures(q[J.bucketInstanceId],D,J.bucketIndex,J.sourceLayerIndex,V.filter,V.layers,V.availableImages,E);for(const lt in $){const st=H[lt]=H[lt]||[],et=$[lt];et.sort((at,rt)=>{const dt=J.featureSortOrder;if(dt){const _t=dt.indexOf(at.featureIndex);return dt.indexOf(rt.featureIndex)-_t}return rt.featureIndex-at.featureIndex});for(const at of et)st.push(at)}}for(const J in H)H[J].forEach($=>{const lt=$.feature,st=I(E[J]).getFeatureState(lt.layer["source-layer"],lt.id);lt.source=lt.layer.source,lt.layer["source-layer"]&&(lt.sourceLayer=lt.layer["source-layer"]),lt.state=st});return H}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,u){u&&u.filter&&this._validate(d.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const m=this._getSourceCaches(r);let x=[];for(const v of m)x=x.concat(Ot(v,u));return x}addSourceType(r,u,m){return In.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(In.setSourceType(r,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:u.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(r,u={}){this._checkLoaded();const m=this.light.getLight();let x=!1;for(const M in r)if(!zt(r[M],m[M])){x=!0;break}if(!x)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,u),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,u=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof r.source){const m="terrain-dem-src";this.addSource(m,r.source),r=d.clone$1(r),r=d.extend(r,{source:m})}if(this._validate(d.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(r,u);else{const m=this.terrain,x=m.get();for(const v of Object.keys(d.spec.terrain))!r.hasOwnProperty(v)&&d.spec.terrain[v].default&&(r[v]=d.spec.terrain[v].default);for(const v in r)if(!zt(r[v],x[v])){m.set(r),this.stylesheet.terrain=r;const M=this._setTransitionParameters({duration:0});m.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const u=this.fog=new hi(r,this.map.transform);this.stylesheet.fog=r;const m=this._setTransitionParameters({duration:0});u.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,m=u.get();0===Object.keys(r).length&&u.set(r);for(const x in r)if(!zt(r[x],m[x])){u.set(r),this.stylesheet.fog=r;const v=this._setTransitionParameters({duration:0});u.updateTransitions(v);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:d.exported.now(),transition:d.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(m=>this.isLayerDraped(this._layers[m])),u=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...u)}_createTerrain(r,u){const m=this.terrain=new oo(r,u);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const r in this._layers){const u=this._layers[r];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const u=this._layers[r];"symbol"===u.type&&this._updateLayer(u)}}_validate(r,u,m,x,v={}){return(!v||!1!==v.validate)&&$a(this,r.call(d.validateStyle,d.extend({key:u,style:this.serialize(),value:m,styleSpec:d.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const u=this._getSourceCaches(r);for(const m of u)m.clearTiles()}_reloadSource(r){const u=this._getSourceCaches(r);for(const m of u)m.resume(),m.reload()}_updateSources(r){for(const u in this._sourceCaches)this._sourceCaches[u].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const u=this._sourceCaches[r];u.resume(),u.reload()}}_updatePlacement(r,u,m,x,v=!1){let M=!1,A=!1;const E={};for(const D of this._order){const I=this._layers[D];if("symbol"!==I.type)continue;if(!E[I.source]){const V=this._getLayerSourceCache(I);if(!V)continue;E[I.source]=V.getRenderableIds(!0).map(Z=>V.getTileByID(Z)).sort((Z,j)=>j.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(j.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(I,E[I.source],r.center.lng,r.projection);M=M||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),r.zoom))&&(this.pauseablePlacement=new tr(r,this._order,v,u,m,x,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),A=!0),M&&this.pauseablePlacement.placement.setStale()),A||M)for(const D of this._order){const I=this._layers[D];"symbol"===I.type&&this.placement.updateLayerOpacities(I,E[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,u,m){this.imageManager.getImages(u.icons,m),this._updateTilesForChangedImages();const x=v=>{v&&v.setDependencies(u.tileID.key,u.type,u.icons)};x(this._otherSourceCaches[u.source]),x(this._symbolSourceCaches[u.source])}getGlyphs(r,u,m){this.glyphManager.getGlyphs(u.stacks,m)}getResource(r,u,m){return d.makeRequest(u,m)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const u=[];return this._otherSourceCaches[r]&&u.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&u.push(this._symbolSourceCaches[r]),u}_isSourceCacheLoaded(r){const u=this._getSourceCaches(r);return 0===u.length?(this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}In.getSourceType=function(p){return ht[p]},In.setSourceType=function(p,r){ht[p]=r},In.registerForPluginStateChange=d.registerForPluginStateChange;var _u="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Us="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",nc="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Wa="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",fo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let er={},mo={};const vr=[];br(_u,vr),br(nc,vr),br(Wa,vr),br(fo,vr),er=Pe("",nc),mo=Pe(fo,Wa);const js=Pe("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Hs=_u,Xa="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Ja={background:Pe("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Pe("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Pe("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Pe("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pe("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Pe("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pe("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pe("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pe("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Pe("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Pe("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Pe("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Pe("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Pe("uniform lowp vec3 u_lightpos;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvoid main() {vec4 color=v_color;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Pe("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Pe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pe("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Pe("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Pe("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Pe("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Pe("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Pe("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Pe("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Pe("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Pe("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Pe("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Us),skyboxGradient:Pe("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Us),skyboxCapture:Pe("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pe("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Pe("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function br(p,r){const u=p.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of u)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const v of x)r.includes(v)||r.push(v)}}function Pe(p,r){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},v=[...vr];return br(p,v),br(r,v),{fragmentSource:p=p.replace(u,(M,A,E,D,I)=>(x[I]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${I}\nvarying ${E} ${D} ${I};\n#else\nuniform ${E} ${D} u_${I};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${I}\n    ${E} ${D} ${I} = u_${I};\n#endif\n`)),vertexSource:r=r.replace(u,(M,A,E,D,I)=>{const R="float"===D?"vec2":"vec4",V=I.match(/color/)?"color":R;return x[I]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${I}\nuniform lowp float u_${I}_t;\nattribute ${E} ${R} a_${I};\nvarying ${E} ${D} ${I};\n#else\nuniform ${E} ${D} u_${I};\n#endif\n`:"vec4"===V?`\n#ifndef HAS_UNIFORM_u_${I}\n    ${I} = a_${I};\n#else\n    ${E} ${D} ${I} = u_${I};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${I}\n    ${I} = unpack_mix_${V}(a_${I}, u_${I}_t);\n#else\n    ${E} ${D} ${I} = u_${I};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${I}\nuniform lowp float u_${I}_t;\nattribute ${E} ${R} a_${I};\n#else\nuniform ${E} ${D} u_${I};\n#endif\n`:"vec4"===V?`\n#ifndef HAS_UNIFORM_u_${I}\n    ${E} ${D} ${I} = a_${I};\n#else\n    ${E} ${D} ${I} = u_${I};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${I}\n    ${E} ${D} ${I} = unpack_mix_${V}(a_${I}, u_${I}_t);\n#else\n    ${E} ${D} ${I} = u_${I};\n#endif\n`}),staticAttributes:m,usedDefines:v}}class Ka{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,u,m,x,v,M,A){this.context=r;let E=this.boundPaintVertexBuffers.length!==x.length;for(let I=0;!E&&I<x.length;I++)this.boundPaintVertexBuffers[I]!==x[I]&&(E=!0);let D=this.boundDynamicVertexBuffers.length!==A.length;for(let I=0;!D&&I<A.length;I++)this.boundDynamicVertexBuffers[I]!==A[I]&&(D=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==m||E||D||this.boundIndexBuffer!==v||this.boundVertexOffset!==M)this.freshBind(u,m,x,v,M,A);else{r.bindVertexArrayOES.set(this.vao);for(const I of A)I&&I.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(r,u,m,x,v,M){let A;const E=r.numAttributes,D=this.context,I=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=M;else{A=D.currentNumAttributes||0;for(let R=E;R<A;R++)I.disableVertexAttribArray(R)}u.enableAttributes(I,r),u.bind(),u.setVertexAttribPointers(I,r,v);for(const R of m)R.enableAttributes(I,r),R.bind(),R.setVertexAttribPointers(I,r,v);for(const R of M)R&&(R.enableAttributes(I,r),R.bind(),R.setVertexAttribPointers(I,r,v));x&&x.bind(),D.currentNumAttributes=E}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Qa(p,r){const u=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new d.MercatorCoordinate(0,m/u).toLngLat().lat,new d.MercatorCoordinate(0,(m+1)/u).toLngLat().lat]}function rc(p,r,u,m,x,v,M){const A=p.context,E=A.gl,D=u.fbo;if(!D)return;p.prepareDrawTile();const I=p.useProgram("hillshade");A.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,D.colorAttachment.get());const R=((H,q,U,J)=>{const $=U.paint.get("hillshade-shadow-color"),lt=U.paint.get("hillshade-highlight-color"),st=U.paint.get("hillshade-accent-color");let et=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===U.paint.get("hillshade-illumination-anchor")&&(et-=H.transform.angle);const at=!H.options.moving;return{u_matrix:J||H.transform.calculateProjMatrix(q.tileID.toUnwrapped(),at),u_image:0,u_latrange:Qa(0,q.tileID),u_light:[U.paint.get("hillshade-exaggeration"),et],u_shadow:$,u_highlight:lt,u_accent:st}})(p,u,m,p.terrain?r.projMatrix:null);p.prepareDrawProgram(A,I,r.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:Z,tileBoundsSegments:j}=p.getTileBoundsBuffers(u);I.draw(A,E.TRIANGLES,x,v,M,d.CullFaceMode.disabled,R,m.id,V,Z,j)}function Oe(p,r,u){if(!r.needsDEMTextureUpload)return;const m=p.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(u.stride);const v=u.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new d.Texture(m,v,x.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Jo(p,r,u,m,x,v){const M=p.context,A=M.gl;if(!r.dem)return;const E=r.dem;if(M.activeTexture.set(A.TEXTURE1),Oe(p,r,E),!r.demTexture)return;r.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const D=E.dim;M.activeTexture.set(A.TEXTURE0);let I=r.fbo;if(!I){const j=new d.Texture(M,{width:D,height:D,data:null},A.RGBA);j.bind(A.LINEAR,A.CLAMP_TO_EDGE),I=r.fbo=M.createFramebuffer(D,D,!0),I.colorAttachment.set(j.texture)}M.bindFramebuffer.set(I.framebuffer),M.viewport.set([0,0,D,D]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:V,tileBoundsSegments:Z}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(M,A.TRIANGLES,m,x,v,d.CullFaceMode.disabled,((j,H)=>{const q=H.stride,U=d.create();return d.ortho(U,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(U,U,[0,-d.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[q,q],u_zoom:j.overscaledZ,u_unpack:H.unpackVector}})(r.tileID,E),u.id,R,V,Z),r.needsHillshadePrepare=!1}const Ko=p=>({u_matrix:new d.UniformMatrix4f(p),u_image0:new d.Uniform1i(p),u_skirt_height:new d.Uniform1f(p)}),oc=(p,r)=>({u_matrix:p,u_image0:0,u_skirt_height:r}),tl=(p,r,u,m,x,v,M,A,E,D,I,R,V,Z)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:u,u_zoom_transition:x,u_merc_center:v,u_image0:0,u_frustum_tl:M,u_frustum_tr:A,u_frustum_br:E,u_frustum_bl:D,u_globe_pos:I,u_globe_radius:R,u_viewport:V,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9)});function yu(p,r){return null!=p&&null!=r&&!(!p.hasData()||!r.hasData())&&null!=p.demTexture&&null!=r.demTexture&&p.tileID.key!==r.tileID.key}const go=new class{constructor(){this.operations={}}newMorphing(p,r,u,m,x){if(p in this.operations){const v=this.operations[p];v.to.tileID.key!==u.tileID.key&&(v.queued=u)}else this.operations[p]={startTime:m,phase:0,duration:x,from:r,to:u,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const u=this.operations[r];for(u.phase=(p-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},el={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Uh(p,r){const u=1<<p.z;return!r&&(0===p.x||p.x===u-1)||0===p.y||p.y===u-1}const xu=p=>({u_matrix:p});function qs(p,r,u,m,x){if(x>0){const v=d.exported.now(),M=(v-p.timeAdded)/x,A=r?(v-r.timeAdded)/x:-1,E=u.getSource(),D=m.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),I=!r||Math.abs(r.tileID.overscaledZ-D)>Math.abs(p.tileID.overscaledZ-D),R=I&&p.refreshedUponExpiration?1:d.clamp(I?M:1-A,0,1);return p.refreshedUponExpiration&&M>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class il extends d.SourceCache{constructor(r){const u={type:"raster-dem",maxzoom:r.transform.maxZoom},m=new zi(Ge(),null),x=gt("mock-dem",u,m,r.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,u){r.state="loaded",u(null)}}class vu extends d.SourceCache{constructor(r){const u=gt("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new zi(Ge(),null),r.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,u,m){if(r.freezeTileCoverage)return;this.transform=r;const x=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,M)=>{if(v[M.key]="",!this._tiles[M.key]){const A=new d.Tile(M,this._source.tileSize*M.overscaleFactor(),r.tileZoom);A.state="loaded",this._tiles[M.key]=A}return v},{});for(const v in this._tiles)v in x||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const u=this.proxyCachedFBO[r];if(void 0!==u){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sc extends d.OverscaledTileID{constructor(r,u,m){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class ac extends d.Elevation{constructor(r,u){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,v]=function(E){const D=new d.StructArrayLayout4i8,I=new d.StructArrayLayout3ui6,R=131;D.reserve(17161),I.reserve(33800);const V=d.EXTENT/128,Z=d.EXTENT+V/2,j=Z+V;for(let q=-V;q<j;q+=V)for(let U=-V;U<j;U+=V){const J=U<0||U>Z||q<0||q>Z?24575:0,$=d.clamp(Math.round(U),0,d.EXTENT),lt=d.clamp(Math.round(q),0,d.EXTENT);D.emplaceBack($+J,lt,$,lt)}const H=(q,U)=>{const J=U*R+q;I.emplaceBack(J+1,J,J+R),I.emplaceBack(J+R,J+R+1,J+1)};for(let q=1;q<129;q++)for(let U=1;U<129;U++)H(U,q);return[0,129].forEach(q=>{for(let U=0;U<130;U++)H(U,q),H(q,U)}),[D,I,32768]}(),M=r.context;this.gridBuffer=M.createVertexBuffer(m,d.boundsAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(x),this.gridSegments=d.SegmentVector.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,m.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vu(u.map),this.orthoMatrix=d.create(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const A=M.gl;this._overlapStencilMode=new d.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new il(u.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,u,m){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const x=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const v=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(u,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),u.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=u.getIds().map(E=>{const D=u.getTileByID(E).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(E,D){const I=D.transform.pointCoordinate(D.transform.getCameraPoint()),R=new d.pointGeometry(I.x,I.y);E.sort((V,Z)=>{if(Z.overscaledZ-V.overscaledZ)return Z.overscaledZ-V.overscaledZ;const j=new d.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),H=new d.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),q=R.mult(1<<V.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(j)-q.distSqr(H)})})(x,this.painter),this._previousZoom=m.zoom;const v=this.proxyToSource||{};this.proxyToSource={},x.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const E in M){const D=M[E];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,r[E],v),D.usedForTerrain))continue;const I=r[E];D.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[u.id]=x.map(E=>new sc(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const A={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const D=this.terrainTileForTile[E.key];if(!D)continue;const I=D.tileID.key;I in A||(this._visibleDemTiles.push(D),A[I]=I)}}_assignTerrainTiles(r){this._initializing||r.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const r=this.painter.context,u=r.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],v=x.dem;!v||x.demTexture&&!x.needsDEMTextureUpload||(r.activeTexture.set(u.TEXTURE1),Oe(this.painter,x,v))}}_prepareDemTileUniforms(r,u,m,x){if(!u||null==u.demTexture)return!1;const v=r.tileID.canonical,M=Math.pow(2,u.tileID.canonical.z-v.z),A=x||"";return m[`u_dem_tl${A}`]=[v.x*M%1,v.y*M%1],m[`u_dem_scale${A}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,u=r.gl;if(!this._emptyDepthBufferTexture){const m=new d.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new d.Texture(r,m,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const u=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const v=x.dem.tree.minimums[0];return v>0&&r++,m+v},0);return r?u/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,u=r.gl;r.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new d.RGBAImage({width:1,height:1},new Uint8Array(d.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(x,{premultiply:!1}):v=this._emptyDEMTexture=new d.Texture(r,x,u.RGBA,{premultiply:!1}),v}setupElevationDraw(r,u,m){const x=this.painter.context,v=x.gl,M=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();const E=this.painter.transform,D=E.projection,I=r.tileID.canonical;M.u_tile_tl_up=D.upVector(I,0,0),M.u_tile_tr_up=D.upVector(I,d.EXTENT,0),M.u_tile_br_up=D.upVector(I,d.EXTENT,d.EXTENT),M.u_tile_bl_up=D.upVector(I,0,d.EXTENT),M.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?d.GLOBE_METERS_TO_ECEF:D.upVectorScale(I,E.center.lat,E.worldSize).metersToTile;let R=null,V=null,Z=1;if(m&&m.morphing&&this._useVertexMorphing){const j=m.morphing.srcDemTile,H=m.morphing.dstDemTile;Z=m.morphing.phase,j&&H&&(this._prepareDemTileUniforms(r,j,M,"_prev")&&(V=j),this._prepareDemTileUniforms(r,H,M)&&(R=H))}if(V&&R?(x.activeTexture.set(v.TEXTURE2),R.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),x.activeTexture.set(v.TEXTURE4),V.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),M.u_dem_lerp=Z):(R=this.terrainTileForTile[r.tileID.key],x.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(r,R,M)?R.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),x.activeTexture.set(v.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&R){const j=(1<<R.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=j}m&&m.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(x,M)}renderToBackBuffer(r){const u=this.painter,m=this.painter.context;0!==r.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,v,M,A,E){if("globe"===x.transform.projection.name)!function(D,I,R,V,Z){const j=D.context,H=j.gl;let q,U;const J=D.options.showTerrainWireframe?2:0,$=D.transform,lt=d.globeUseCustomAntiAliasing(D,j,$),st=(Gt,wt)=>{if(U===Gt)return;const Rt=[el[Gt],"PROJECTION_GLOBE_VIEW"];lt&&Rt.push("CUSTOM_ANTIALIASING"),wt&&Rt.push(el[J]),q=D.useProgram("globeRaster",null,Rt),U=Gt},et=D.colorModeForRenderPass(),at=new d.DepthMode(H.LEQUAL,d.DepthMode.ReadWrite,D.depthRangeFor3D);go.update(Z);const rt=d.calculateGlobeMercatorMatrix($),dt=[d.mercatorXfromLng($.center.lng),d.mercatorYfromLat($.center.lat)],_t=J?[!1,!0]:[!1],Lt=D.globeSharedBuffers,mt=[$.width*d.exported.devicePixelRatio,$.height*d.exported.devicePixelRatio],At=Float32Array.from($.globeMatrix),kt={useDenormalizedUpVectorScale:!0};if(_t.forEach(Gt=>{U=-1;const wt=Gt?H.LINES:H.TRIANGLES;for(const Rt of V){const Tt=R.getTile(Rt),qt=d.StencilMode.disabled,Ut=I.prevTerrainTileForTile[Rt.key],Qt=I.terrainTileForTile[Rt.key];yu(Ut,Qt)&&go.newMorphing(Rt.key,Ut,Qt,Z,250),j.activeTexture.set(H.TEXTURE0),Tt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const ne=go.getMorphValuesForProxy(Rt.key),le=ne?1:0;ne&&d.extend$1(kt,{morphing:{srcDemTile:ne.from,dstDemTile:ne.to,phase:d.easeCubicInOut(ne.phase)}});const Te=d.tileCornersToBounds(Rt.canonical),Kt=d.getLatitudinalLod(Te.getCenter().lat),fe=d.getGridMatrix(Rt.canonical,Te,Kt),Be=d.globeNormalizeECEF(d.globeTileBounds(Rt.canonical)),ai=tl($.projMatrix,At,rt,Be,d.globeToMercatorTransition($.zoom),dt,$.frustumCorners.TL,$.frustumCorners.TR,$.frustumCorners.BR,$.frustumCorners.BL,$.globeCenterInViewSpace,$.globeRadius,mt,fe);if(st(le,Gt),I.setupElevationDraw(Tt,q,kt),D.prepareDrawProgram(j,q,Rt.toUnwrapped()),Lt){const[xi,Ze,Ni]=Gt?Lt.getWirefameBuffers(D.context,Kt):Lt.getGridBuffers(Kt);q.draw(j,wt,at,qt,et,d.CullFaceMode.backCCW,ai,"globe_raster",xi,Ze,Ni)}}}),Lt){const Gt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];lt&&Gt.push("CUSTOM_ANTIALIASING"),q=D.useProgram("globeRaster",null,Gt);for(const wt of V){const{x:Rt,y:Tt,z:qt}=wt.canonical,Ut=0===Tt,Qt=Tt===(1<<qt)-1,[ne,le,Te,Kt]=Lt.getPoleBuffers(qt);if(Kt&&(Ut||Qt)){const fe=R.getTile(wt);j.activeTexture.set(H.TEXTURE0),fe.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let Be=d.globePoleMatrixForTile(qt,Rt,$);const ai=d.globeNormalizeECEF(d.globeTileBounds(wt.canonical)),xi=(Ze,Ni)=>Ze.draw(j,H.TRIANGLES,at,d.StencilMode.disabled,et,d.CullFaceMode.disabled,tl($.projMatrix,Be,Be,ai,0,dt,$.frustumCorners.TL,$.frustumCorners.TR,$.frustumCorners.BR,$.frustumCorners.BL,$.globeCenterInViewSpace,$.globeRadius,mt),"globe_pole_raster",Ni,Te,Kt);I.setupElevationDraw(fe,q,kt),D.prepareDrawProgram(j,q,wt.toUnwrapped()),Ut&&xi(q,ne),Qt&&(Be=d.scale(d.create(),Be,[1,-1,1]),xi(q,le))}}}}(x,v,M,A,E);else{const D=x.context,I=D.gl;let R,V;const Z=x.options.showTerrainWireframe?2:0,j=($,lt)=>{if(V===$)return;const st=[el[$]];lt&&st.push(el[Z]),R=x.useProgram("terrainRaster",null,st),V=$},H=x.colorModeForRenderPass(),q=new d.DepthMode(I.LEQUAL,d.DepthMode.ReadWrite,x.depthRangeFor3D);go.update(E);const U=x.transform,J=6*Math.pow(1.5,22-U.zoom)*v.exaggeration();(Z?[!1,!0]:[!1]).forEach($=>{V=-1;const lt=$?I.LINES:I.TRIANGLES,[st,et]=$?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const at of A){const rt=M.getTile(at),dt=d.StencilMode.disabled,_t=v.prevTerrainTileForTile[at.key],Lt=v.terrainTileForTile[at.key];yu(_t,Lt)&&go.newMorphing(at.key,_t,Lt,E,250),D.activeTexture.set(I.TEXTURE0),rt.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const mt=go.getMorphValuesForProxy(at.key),At=mt?1:0;let kt;mt&&(kt={morphing:{srcDemTile:mt.from,dstDemTile:mt.to,phase:d.easeCubicInOut(mt.phase)}});const Gt=oc(at.projMatrix,Uh(at.canonical,U.renderWorldCopies)?J/10:J);j(At,$),v.setupElevationDraw(rt,R,kt),x.prepareDrawProgram(D,R,at.toUnwrapped()),R.draw(D,lt,q,dt,H,d.CullFaceMode.backCCW,Gt,"terrain_raster",v.gridBuffer,st,et)}})}}(u,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,x=this.proxySourceCache,v=this.proxiedCoords[x.id],M=this._drapedRenderBatches.shift(),A=[],E=u.style.order;let D=0;for(const I of v){const R=x.getTileByID(I.proxyTileKey),V=x.proxyCachedFBO[I.key]?x.proxyCachedFBO[I.key][r]:void 0,Z=void 0!==V?x.renderCache[V]:this.pool[D++],j=void 0!==V;if(R.texture=Z.tex,j&&!Z.dirty){A.push(R.tileID);continue}let H;m.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(m.clear({color:d.Color.transparent,stencil:0}),Z.dirty=!1);for(let q=M.start;q<=M.end;++q){const U=u.style._layers[E[q]];if(U.isHidden(u.transform.zoom))continue;const J=u.style._getLayerSourceCache(U),$=J?this.proxyToSource[I.key][J.id]:[I];if(!$)continue;const lt=$;m.viewport.set([0,0,Z.fb.width,Z.fb.height]),H!==(J?J.id:null)&&(this._setupStencil(Z,$,U,J),H=J?J.id:null),u.renderLayer(u,J,U,lt)}this.renderedToTile?(Z.dirty=!0,A.push(R.tileID)):j||--D,5===D&&(D=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),M.end+1}postRender(){}renderCacheEfficiency(r){const u=r.order.length;if(0===u)return{efficiency:100};let m,x=0,v=0,M=!1;for(let A=0;A<u;++A){const E=r._layers[r.order[A]];this._style.isLayerDraped(E)?(M&&++x,++v):M||(M=!0,m=E.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-x/v),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{r=Math.min(r,u.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,u,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const M=v.tileID,A=1<<M.overscaledZ,{x:E,y:D}=M.canonical,I=E/A,R=(E+1)/A,V=D/A,Z=(D+1)/A;return{minx:I,miny:V,maxx:R,maxy:Z,t:v.dem.tree.raycastRoot(I,V,R,Z,r,u,m),tile:v}});x.sort((v,M)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const v of x){if(null==v.t)return null;const M=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,u,m);if(null!=M)return M}return null}_createFBO(){const r=this.painter.context,u=r.gl,m=this.drapeBufferSize;r.activeTexture.set(u.TEXTURE0);const x=new d.Texture(r,{width:m[0],height:m[1],data:null},u.RGBA);x.bind(u.LINEAR,u.CLAMP_TO_EDGE);const v=r.createFramebuffer(m[0],m[1],!1);return v.colorAttachment.set(x.texture),v.depthAttachment=new P(r,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const u=this._style._layers[r],m=u.isHidden(this.painter.transform.zoom),x=u.getCrossfadeParameters(),v=!!x&&1!==x.t,M=u.hasTransition();return"custom"!==u.type&&!m&&(v||M)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof Q){r=!0;break}if(r)for(let u=0;u<this._style.order.length;++u){const m=this._style._layers[this._style.order[u]],x=m.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(m);if("raster"!==m.type||x||!v)continue;const M=m.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const E=this.proxyToSource[A.key][v.id];if(E)for(const D of E){const I=qs(v.getTile(D),v.findLoadedParent(D,0),v,this.painter.transform,M);(1!==I.opacity||0!==I.mix)&&this._clearRenderCacheForTile(v.id,D)}}}}_setupDrapedRenderBatches(){const r=this._style.order,u=r.length;if(0===u)return;const m=[];let x,v=0,M=this._style._layers[r[v]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++v<u;)M=this._style._layers[r[v]];for(;v<u;++v){const A=this._style._layers[r[v]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===x&&(x=v):void 0!==x&&(m.push({start:x,end:v-1}),x=void 0))}void 0!==x&&m.push({start:x,end:v-1}),this._drapedRenderBatches=m}_setupRenderCache(r){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const M=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let A=0;A<M.length;++A){const E=Object.values(M[A]);u.renderCachePool.push(...E)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let M=m.length-1;M>=0;M--){const A=m[M];if(u.getTileByID(A.key),void 0!==u.proxyCachedFBO[A.key]){const E=r[A.key],D=this.proxyToSource[A.key];let I=0;for(const R in D){const V=D[R],Z=E[R];if(!Z||Z.length!==V.length||V.some((j,H)=>j!==Z[H]||x[R]&&x[R].hasOwnProperty(j.key))){I=-1;break}++I}for(const R in u.proxyCachedFBO[A.key])u.renderCache[u.proxyCachedFBO[A.key][R]].dirty=I<0||I!==Object.values(E).length}}const v=[...this._drapedRenderBatches];v.sort((M,A)=>A.end-A.start-(M.end-M.start));for(const M of v)for(const A of m){if(u.proxyCachedFBO[A.key])continue;let E=u.renderCachePool.pop();void 0===E&&u.renderCache.length<50&&(E=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==E&&(u.proxyCachedFBO[A.key]={},u.proxyCachedFBO[A.key][M.start]=E,u.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(r,u,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,M=v.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let A;if(m.isTileClipped())A=u.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(r,u){const m=this.painter,x=this.painter.context,v=x.gl;m._tileClippingMaskIDs={},x.setColorMode(d.ColorMode.disabled),x.setDepthMode(d.DepthMode.disabled);const M=m.useProgram("clippingMask");for(const A of r){const E=m._tileClippingMaskIDs[A.key]=--u;M.draw(x,v.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:v.ALWAYS,mask:0},E,255,v.KEEP,v.KEEP,v.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,xu(A.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(r){const u=this.painter.transform;if(r.x<0||r.x>u.width||r.y<0||r.y>u.height)return null;const m=[r.x,r.y,1,1];d.transformMat4$1(m,m,u.pixelMatrixInverse),d.scale$1(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const x=u._camera.position,v=d.mercatorZfromAltitude(1,u.center.lat),M=[x[0],x[1],x[2]/v,0],A=d.subtract([],m.slice(0,3),M);d.normalize(A,A);const E=this.raycast(M,A,this._exaggeration);return null!==E&&E?(d.scaleAndAdd(M,M,A,E),M[3]=M[2],M[2]*=v,M):null}drawDepth(){const r=this.painter,u=r.context,m=this.proxySourceCache,x=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=u.gl,A=u.createFramebuffer(x,v,!0);u.activeTexture.set(M.TEXTURE0);const E=new d.Texture(u,{width:x,height:v,data:null},M.RGBA);E.bind(M.NEAREST,M.CLAMP_TO_EDGE),A.colorAttachment.set(E.texture);const D=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,x,v);A.depthAttachment.set(D),this._depthFBO=A,this._depthTexture=E}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,x,v]),function(M,A,E,D){if("globe"===M.transform.projection.name)return;const I=M.context,R=I.gl;I.clear({depth:1});const V=M.useProgram("terrainDepth"),Z=new d.DepthMode(R.LESS,d.DepthMode.ReadWrite,M.depthRangeFor3D);for(const j of D){const H=E.getTile(j),q=oc(j.projMatrix,0);A.setupElevationDraw(H,V),V.draw(I,R.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,q,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(r,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,u,m){if(r.getSource()instanceof pt)return this._setupProxiedCoordsForImageSource(r,u,m);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const x=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let A=0;A<v.length;A++){const E=v[A],D=this._findTileCoveringTileID(E,r);if(D){const I=this._createProxiedId(E,D,m[E.key]&&m[E.key][r.id]);x.push(I),this.proxyToSource[E.key][r.id]=[I]}}let M=!1;for(let A=0;A<u.length;A++){const E=r.getTile(u[A]);if(!E||!E.hasData())continue;const D=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==E.tileID.canonical.z){const I=this.proxyToSource[D.tileID.key][r.id],R=this._createProxiedId(D.tileID,E,m[D.tileID.key]&&m[D.tileID.key][r.id]);I?I.splice(I.length-1,0,R):this.proxyToSource[D.tileID.key][r.id]=[R],x.push(R),M=!0}}this._sourceTilesOverlap[r.id]=M}_setupProxiedCoordsForImageSource(r,u,m){if(!r.getSource().loaded())return;const x=this.proxiedCoords[r.id]=[],v=this.proxyCoords,M=r.getSource(),A=new d.pointGeometry(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),E=M.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((I,R)=>(I.min.x=Math.min(I.min.x,R.x-A.x),I.min.y=Math.min(I.min.y,R.y-A.y),I.max.x=Math.max(I.max.x,R.x-A.x),I.max.y=Math.max(I.max.y,R.y-A.y),I),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(I,R)=>{const V=I.wrap+I.canonical.x/(1<<I.canonical.z),Z=I.canonical.y/(1<<I.canonical.z),j=d.EXTENT/(1<<I.canonical.z),H=R.wrap+R.canonical.x/(1<<R.canonical.z),q=R.canonical.y/(1<<R.canonical.z);return V+j<H+E.min.x||V>H+E.max.x||Z+j<q+E.min.y||Z>q+E.max.y};for(let I=0;I<v.length;I++){const R=v[I];for(let V=0;V<u.length;V++){const Z=r.getTile(u[V]);if(!Z||!Z.hasData()||D(R,Z.tileID))continue;const j=this._createProxiedId(R,Z,m[R.key]&&m[R.key][r.id]),H=this.proxyToSource[R.key][r.id];H?H.push(j):this.proxyToSource[R.key][r.id]=[j],x.push(j)}}}_createProxiedId(r,u,m){let x=this.orthoMatrix;if(m){const v=m.find(M=>M.key===u.tileID.key);if(v)return v}if(u.tileID.key!==r.key){const v=r.canonical.z-u.tileID.canonical.z;let M,A,E;x=d.create();const D=u.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(M=d.EXTENT>>v,A=M*((u.tileID.canonical.x<<v)-r.canonical.x+D),E=M*((u.tileID.canonical.y<<v)-r.canonical.y)):(M=d.EXTENT<<-v,A=d.EXTENT*(u.tileID.canonical.x-(r.canonical.x+D<<-v)),E=d.EXTENT*(u.tileID.canonical.y-(r.canonical.y<<-v))),d.ortho(x,0,M,0,M,0,1),d.translate(x,x,[A,E,0])}return new sc(u.tileID,r.key,x)}_findTileCoveringTileID(r,u){let m=u.getTile(r);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[u.id],v=x[r.key];if(m=v?u.getTileByID(v):null,m&&m.hasData()||null===v)return m;let M=m?m.tileID:r,A=M.overscaledZ;const E=u.getSource().minzoom,D=[];if(!v){const R=u.getSource().maxzoom;if(r.canonical.z>=R){const V=r.canonical.z-R;u.getSource().reparseOverscaled?(A=Math.max(r.canonical.z+2,u.transform.tileZoom),M=new d.OverscaledTileID(A,r.wrap,R,r.canonical.x>>V,r.canonical.y>>V)):0!==V&&(A=R,M=new d.OverscaledTileID(A,r.wrap,R,r.canonical.x>>V,r.canonical.y>>V))}M.key!==r.key&&(D.push(M.key),m=u.getTile(M))}const I=R=>{D.forEach(V=>{x[V]=R}),D.length=0};for(A-=1;A>=E&&(!m||!m.hasData());A--){m&&I(m.tileID.key);const R=M.calculateScaledKey(A);if(m=u.getTileByID(R),m&&m.hasData())break;const V=x[R];if(null===V)break;void 0===V?D.push(R):m=u.getTileByID(V)}return I(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,u){let m=this._tilesDirty[r];m||(m=this._tilesDirty[r]={}),m[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(u){let m=0;const x=new d.StructArrayLayout2ui4,v=131;for(let M=1;M<129;M++){for(let A=1;A<129;A++)m=M*v+A,x.emplaceBack(m,m+1),x.emplaceBack(m,m+v),x.emplaceBack(m+1,m+v),128===M&&x.emplaceBack(m+v,m+v+1);x.emplaceBack(m+1,m+1+v)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class lc{static cacheKey(r,u,m,x){let v=`${u}${x?x.cacheKey:""}`;for(const M of m)r.usedDefines.includes(M)&&(v+=`/${M}`);return v}constructor(r,u,m,x,v,M){const A=r.gl;this.program=A.createProgram();const E=function(q){const U=[];for(let J=0;J<q.length;J++){if(null===q[J])continue;const $=q[J].split(" ");U.push($.pop())}return U}(m.staticAttributes),D=x?x.getBinderAttributes():[],I=E.concat(D);let R=x?x.defines():[];R=R.concat(M.map(q=>`#define ${q}`));const V=R.concat(r.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(Xa):Xa,Xa,Hs,js.fragmentSource,mo.fragmentSource,m.fragmentSource).join("\n"),Z=R.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Hs,js.vertexSource,mo.vertexSource,er.vertexSource,m.vertexSource).join("\n"),j=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(j,V),A.compileShader(j),A.attachShader(this.program,j);const H=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(H,Z),A.compileShader(H),A.attachShader(this.program,H),this.attributes={},this.numAttributes=I.length;for(let q=0;q<this.numAttributes;q++)I[q]&&(A.bindAttribLocation(this.program,q,I[q]),this.attributes[I[q]]=q);A.linkProgram(this.program),A.deleteShader(H),A.deleteShader(j),this.fixedUniforms=v(r),this.binderUniforms=x?x.getUniforms(r):[],-1!==M.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(q=r),u_dem_prev:new d.Uniform1i(q),u_dem_unpack:new d.Uniform4f(q),u_dem_tl:new d.Uniform2f(q),u_dem_scale:new d.Uniform1f(q),u_dem_tl_prev:new d.Uniform2f(q),u_dem_scale_prev:new d.Uniform1f(q),u_dem_size:new d.Uniform1f(q),u_dem_lerp:new d.Uniform1f(q),u_exaggeration:new d.Uniform1f(q),u_depth:new d.Uniform1i(q),u_depth_size_inv:new d.Uniform2f(q),u_meter_to_dem:new d.Uniform1f(q),u_label_plane_matrix_inv:new d.UniformMatrix4f(q),u_tile_tl_up:new d.Uniform3f(q),u_tile_tr_up:new d.Uniform3f(q),u_tile_br_up:new d.Uniform3f(q),u_tile_bl_up:new d.Uniform3f(q),u_tile_up_scale:new d.Uniform1f(q)}),-1!==M.indexOf("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new d.UniformMatrix4f(q),u_fog_range:new d.Uniform2f(q),u_fog_color:new d.Uniform4f(q),u_fog_horizon_blend:new d.Uniform1f(q),u_fog_temporal_offset:new d.Uniform1f(q),u_frustum_tl:new d.Uniform3f(q),u_frustum_tr:new d.Uniform3f(q),u_frustum_br:new d.Uniform3f(q),u_frustum_bl:new d.Uniform3f(q),u_globe_pos:new d.Uniform3f(q),u_globe_radius:new d.Uniform1f(q),u_globe_transition:new d.Uniform1f(q),u_is_globe:new d.Uniform1i(q),u_viewport:new d.Uniform2f(q)}))(r))}var q}setTerrainUniformValues(r,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in u)m[x].set(this.program,x,u[x])}}setFogUniformValues(r,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in u)m[x].set(this.program,x,u[x])}}draw(r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H){const q=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(x),r.setColorMode(v),r.setCullFace(M);for(const J of Object.keys(this.fixedUniforms))this.fixedUniforms[J].set(this.program,J,A[J]);j&&j.setUniforms(this.program,r,this.binderUniforms,V,{zoom:Z});const U={[q.LINES]:2,[q.TRIANGLES]:3,[q.LINE_STRIP]:1}[u];for(const J of R.get()){const $=J.vaos||(J.vaos={});($[E]||($[E]=new Ka)).bind(r,this,D,j?j.getPaintVertexBuffers():[],I,J.vertexOffset,H||[]),q.drawElements(u,J.primitiveLength*U,q.UNSIGNED_SHORT,J.primitiveOffset*U*2)}}}function jh(p,r,u){const m=1/Wn(u,1,r.transform.tileZoom),x=Math.pow(2,u.tileID.overscaledZ),v=u.tileSize*Math.pow(2,r.transform.tileZoom)/x,M=v*(u.tileID.canonical.x+u.tileID.wrap*x),A=v*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[m,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[M>>16,A>>16],u_pixel_coord_lower:[65535&M,65535&A]}}const nl=d.create(),Zs=(p,r,u,m,x,v,M,A,E,D,I)=>{const R=r.style.light,V=R.properties.get("position"),Z=[V.x,V.y,V.z],j=d.create$1();"viewport"===R.properties.get("anchor")&&(d.fromRotation(j,-r.transform.angle),d.transformMat3(Z,Z,j));const H=R.properties.get("color"),q=r.transform,U={u_matrix:p,u_lightpos:Z,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:v};return"globe"===q.projection.name&&(U.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],U.u_zoom_transition=E,U.u_inv_rot_matrix=I,U.u_merc_center=D,U.u_up_dir=q.projection.upVector(new d.CanonicalTileID(0,0,0),D[0]*d.EXTENT,D[1]*d.EXTENT),U.u_height_lift=A),U},ae=(p,r,u,m,x,v,M,A,E,D,I,R,V)=>{const Z=Zs(p,r,u,m,x,v,M,D,I,R,V),j={u_height_factor:-Math.pow(2,M.overscaledZ)/E.tileSize/8};return d.extend(Z,jh(A,r,E),j)},Qo=p=>({u_matrix:p}),jn=(p,r,u,m)=>d.extend(Qo(p),jh(u,r,m)),pi=(p,r)=>({u_matrix:p,u_world:r}),_o=(p,r,u,m,x)=>d.extend(jn(p,r,u,m),{u_world:x}),bu=d.create(),cc=(p,r,u,m,x,v)=>{const M=p.transform,A="globe"===M.projection.name;let E;if("map"===v.paint.get("circle-pitch-alignment"))if(A){const I=d.globePixelsToTileUnits(M.zoom,r.canonical)*M._pixelsPerMercatorPixel;E=Float32Array.from([I,0,0,I])}else E=M.calculatePixelsToTileUnitsMatrix(u);else E=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:p.translatePosMatrix(r.projMatrix,u,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=m,D.u_merc_center=x,D.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],D.u_zoom_transition=d.globeToMercatorTransition(M.zoom);const I=x[0]*d.EXTENT,R=x[1]*d.EXTENT;D.u_up_dir=M.projection.upVector(new d.CanonicalTileID(0,0,0),I,R)}return D},uc=p=>{const r=[];return"map"===p.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},$s=(p,r,u,m)=>{const x=d.EXTENT/u.tileSize;return{u_matrix:p,u_camera_to_center_distance:r.getCameraToCenterDistance(m),u_extrude_scale:[r.pixelsToGLUnits[0]/x,r.pixelsToGLUnits[1]/x]}},Nr=(p,r,u=1)=>({u_matrix:p,u_color:r,u_overlay:0,u_overlay_scale:u}),rl=d.create(),hc=(p,r,u,m,x,v,M)=>{const A=p.transform,E="globe"===A.projection.name,D=E?d.globePixelsToTileUnits(A.zoom,r.canonical)*A._pixelsPerMercatorPixel:Wn(u,1,v),I={u_matrix:r.projMatrix,u_extrude_scale:D,u_intensity:M,u_inv_rot_matrix:rl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){I.u_inv_rot_matrix=m,I.u_merc_center=x,I.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],I.u_zoom_transition=d.globeToMercatorTransition(A.zoom);const R=x[0]*d.EXTENT,V=x[1]*d.EXTENT;I.u_up_dir=A.projection.upVector(new d.CanonicalTileID(0,0,0),R,V)}return I},dn=(p,r,u,m,x,v,M,A)=>{const E=p.transform,D=E.calculatePixelsToTileUnitsMatrix(r),I={u_matrix:dc(p,r,u,x),u_pixels_to_tile_units:D,u_device_pixel_ratio:M,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:A};if(es(u)){const R=ts(r,p.transform);I.u_texsize=r.lineAtlasTexture.size,I.u_scale=[R,m.fromScale,m.toScale],I.u_mix=m.t}return I},yo=(p,r,u,m,x,v)=>{const M=p.transform,A=ts(r,M);return{u_matrix:dc(p,r,u,x),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:v,u_image:0,u_scale:[A,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ts(p,r){return 1/Wn(p,1,r.tileZoom)}function dc(p,r,u,m){return p.translatePosMatrix(m||r.tileID.projMatrix,r,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function es(p){const r=p.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const wu=(p,r,u,m,x,v)=>{return{u_matrix:p,u_tl_parent:r,u_scale_parent:u,u_fade_t:m.mix,u_opacity:m.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(A=x.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(M=x.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:ol(x.paint.get("raster-hue-rotate")),u_perspective_transform:v};var M,A};function ol(p){p*=Math.PI/180;const r=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}const Cu=d.create(),pc=(p,r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H)=>{const q=x.transform,U={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:q.width/q.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:M,u_coord_matrix:A,u_is_text:+E,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Cu,u_up_vector:[0,-1,0]};return"globe"===H.name&&(U.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],U.u_zoom_transition=R,U.u_inv_rot_matrix=Z,U.u_merc_center=V,U.u_camera_forward=q._camera.forward(),U.u_ecef_origin=d.globeECEFOrigin(q.globeMatrix,I.toUnwrapped()),U.u_tile_matrix=Float32Array.from(q.globeMatrix),U.u_up_vector=j),U},fc=(p,r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H,q)=>d.extend(pc(p,r,u,m,x,v,M,A,E,D,R,V,Z,j,H,q),{u_gamma_scale:m?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+I}),ei=(p,r,u,m,x,v,M,A,E,D,I,R,V,Z,j,H)=>d.extend(fc(p,r,u,m,x,v,M,A,!0,E,!0,I,R,V,Z,j,H),{u_texsize_icon:D,u_texture_icon:1}),Hh=(p,r,u)=>({u_matrix:p,u_opacity:r,u_color:u}),Mu=(p,r,u,m,x,v)=>d.extend(function(M,A,E,D){const I=E.imageManager.getPattern(M.from.toString()),R=E.imageManager.getPattern(M.to.toString()),{width:V,height:Z}=E.imageManager.getPixelSize(),j=Math.pow(2,D.tileID.overscaledZ),H=D.tileSize*Math.pow(2,E.transform.tileZoom)/j,q=H*(D.tileID.canonical.x+D.tileID.wrap*j),U=H*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[V,Z],u_mix:A.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Wn(D,1,E.transform.tileZoom),u_pixel_coord_upper:[q>>16,U>>16],u_pixel_coord_lower:[65535&q,65535&U]}}(m,v,u,x),{u_matrix:p,u_opacity:r}),Au={fillExtrusion:p=>({u_matrix:new d.UniformMatrix4f(p),u_lightpos:new d.Uniform3f(p),u_lightintensity:new d.Uniform1f(p),u_lightcolor:new d.Uniform3f(p),u_vertical_gradient:new d.Uniform1f(p),u_opacity:new d.Uniform1f(p),u_edge_radius:new d.Uniform1f(p),u_ao:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_up_dir:new d.Uniform3f(p),u_height_lift:new d.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_lightpos:new d.Uniform3f(p),u_lightintensity:new d.Uniform1f(p),u_lightcolor:new d.Uniform3f(p),u_vertical_gradient:new d.Uniform1f(p),u_height_factor:new d.Uniform1f(p),u_edge_radius:new d.Uniform1f(p),u_ao:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_up_dir:new d.Uniform3f(p),u_height_lift:new d.Uniform1f(p),u_image:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_pixel_coord_upper:new d.Uniform2f(p),u_pixel_coord_lower:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_fade:new d.Uniform1f(p),u_opacity:new d.Uniform1f(p)}),fill:p=>({u_matrix:new d.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_image:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_pixel_coord_upper:new d.Uniform2f(p),u_pixel_coord_lower:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_fade:new d.Uniform1f(p)}),fillOutline:p=>({u_matrix:new d.UniformMatrix4f(p),u_world:new d.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_world:new d.Uniform2f(p),u_image:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_pixel_coord_upper:new d.Uniform2f(p),u_pixel_coord_lower:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_fade:new d.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new d.Uniform1f(p),u_extrude_scale:new d.UniformMatrix2f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_up_dir:new d.Uniform3f(p)}),collisionBox:p=>({u_matrix:new d.UniformMatrix4f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_extrude_scale:new d.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new d.UniformMatrix4f(p),u_inv_matrix:new d.UniformMatrix4f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_viewport_size:new d.Uniform2f(p)}),debug:p=>({u_color:new d.UniformColor(p),u_matrix:new d.UniformMatrix4f(p),u_overlay:new d.Uniform1i(p),u_overlay_scale:new d.Uniform1f(p)}),clippingMask:p=>({u_matrix:new d.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new d.Uniform1f(p),u_intensity:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_up_dir:new d.Uniform3f(p)}),heatmapTexture:p=>({u_image:new d.Uniform1i(p),u_color_ramp:new d.Uniform1i(p),u_opacity:new d.Uniform1f(p)}),hillshade:p=>({u_matrix:new d.UniformMatrix4f(p),u_image:new d.Uniform1i(p),u_latrange:new d.Uniform2f(p),u_light:new d.Uniform2f(p),u_shadow:new d.UniformColor(p),u_highlight:new d.UniformColor(p),u_accent:new d.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new d.UniformMatrix4f(p),u_image:new d.Uniform1i(p),u_dimension:new d.Uniform2f(p),u_zoom:new d.Uniform1f(p),u_unpack:new d.Uniform4f(p)}),line:p=>({u_matrix:new d.UniformMatrix4f(p),u_pixels_to_tile_units:new d.UniformMatrix2f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_units_to_pixels:new d.Uniform2f(p),u_dash_image:new d.Uniform1i(p),u_gradient_image:new d.Uniform1i(p),u_image_height:new d.Uniform1f(p),u_texsize:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_mix:new d.Uniform1f(p),u_alpha_discard_threshold:new d.Uniform1f(p),u_trim_offset:new d.Uniform2f(p)}),linePattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_texsize:new d.Uniform2f(p),u_pixels_to_tile_units:new d.UniformMatrix2f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_image:new d.Uniform1i(p),u_units_to_pixels:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_fade:new d.Uniform1f(p),u_alpha_discard_threshold:new d.Uniform1f(p)}),raster:p=>({u_matrix:new d.UniformMatrix4f(p),u_tl_parent:new d.Uniform2f(p),u_scale_parent:new d.Uniform1f(p),u_fade_t:new d.Uniform1f(p),u_opacity:new d.Uniform1f(p),u_image0:new d.Uniform1i(p),u_image1:new d.Uniform1i(p),u_brightness_low:new d.Uniform1f(p),u_brightness_high:new d.Uniform1f(p),u_saturation_factor:new d.Uniform1f(p),u_contrast_factor:new d.Uniform1f(p),u_spin_weights:new d.Uniform3f(p),u_perspective_transform:new d.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new d.Uniform1i(p),u_is_size_feature_constant:new d.Uniform1i(p),u_size_t:new d.Uniform1f(p),u_size:new d.Uniform1f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_rotate_symbol:new d.Uniform1i(p),u_aspect_ratio:new d.Uniform1f(p),u_fade_change:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_label_plane_matrix:new d.UniformMatrix4f(p),u_coord_matrix:new d.UniformMatrix4f(p),u_is_text:new d.Uniform1i(p),u_pitch_with_map:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_camera_forward:new d.Uniform3f(p),u_tile_matrix:new d.UniformMatrix4f(p),u_up_vector:new d.Uniform3f(p),u_ecef_origin:new d.Uniform3f(p),u_texture:new d.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new d.Uniform1i(p),u_is_size_feature_constant:new d.Uniform1i(p),u_size_t:new d.Uniform1f(p),u_size:new d.Uniform1f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_rotate_symbol:new d.Uniform1i(p),u_aspect_ratio:new d.Uniform1f(p),u_fade_change:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_label_plane_matrix:new d.UniformMatrix4f(p),u_coord_matrix:new d.UniformMatrix4f(p),u_is_text:new d.Uniform1i(p),u_pitch_with_map:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_texture:new d.Uniform1i(p),u_gamma_scale:new d.Uniform1f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_camera_forward:new d.Uniform3f(p),u_tile_matrix:new d.UniformMatrix4f(p),u_up_vector:new d.Uniform3f(p),u_ecef_origin:new d.Uniform3f(p),u_is_halo:new d.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new d.Uniform1i(p),u_is_size_feature_constant:new d.Uniform1i(p),u_size_t:new d.Uniform1f(p),u_size:new d.Uniform1f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_rotate_symbol:new d.Uniform1i(p),u_aspect_ratio:new d.Uniform1f(p),u_fade_change:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_label_plane_matrix:new d.UniformMatrix4f(p),u_coord_matrix:new d.UniformMatrix4f(p),u_is_text:new d.Uniform1i(p),u_pitch_with_map:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_texsize_icon:new d.Uniform2f(p),u_texture:new d.Uniform1i(p),u_texture_icon:new d.Uniform1i(p),u_gamma_scale:new d.Uniform1f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_is_halo:new d.Uniform1i(p)}),background:p=>({u_matrix:new d.UniformMatrix4f(p),u_opacity:new d.Uniform1f(p),u_color:new d.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_opacity:new d.Uniform1f(p),u_image:new d.Uniform1i(p),u_pattern_tl_a:new d.Uniform2f(p),u_pattern_br_a:new d.Uniform2f(p),u_pattern_tl_b:new d.Uniform2f(p),u_pattern_br_b:new d.Uniform2f(p),u_texsize:new d.Uniform2f(p),u_mix:new d.Uniform1f(p),u_pattern_size_a:new d.Uniform2f(p),u_pattern_size_b:new d.Uniform2f(p),u_scale_a:new d.Uniform1f(p),u_scale_b:new d.Uniform1f(p),u_pixel_coord_upper:new d.Uniform2f(p),u_pixel_coord_lower:new d.Uniform2f(p),u_tile_units_to_pixels:new d.Uniform1f(p)}),terrainRaster:Ko,terrainDepth:Ko,skybox:p=>({u_matrix:new d.UniformMatrix4f(p),u_sun_direction:new d.Uniform3f(p),u_cubemap:new d.Uniform1i(p),u_opacity:new d.Uniform1f(p),u_temporal_offset:new d.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new d.UniformMatrix4f(p),u_color_ramp:new d.Uniform1i(p),u_center_direction:new d.Uniform3f(p),u_radius:new d.Uniform1f(p),u_opacity:new d.Uniform1f(p),u_temporal_offset:new d.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new d.UniformMatrix3f(p),u_sun_direction:new d.Uniform3f(p),u_sun_intensity:new d.Uniform1f(p),u_color_tint_r:new d.Uniform4f(p),u_color_tint_m:new d.Uniform4f(p),u_luminance:new d.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new d.UniformMatrix4f(p),u_globe_matrix:new d.UniformMatrix4f(p),u_normalize_matrix:new d.UniformMatrix4f(p),u_merc_matrix:new d.UniformMatrix4f(p),u_zoom_transition:new d.Uniform1f(p),u_merc_center:new d.Uniform2f(p),u_image0:new d.Uniform1i(p),u_grid_matrix:new d.UniformMatrix3f(p),u_frustum_tl:new d.Uniform3f(p),u_frustum_tr:new d.Uniform3f(p),u_frustum_br:new d.Uniform3f(p),u_frustum_bl:new d.Uniform3f(p),u_globe_pos:new d.Uniform3f(p),u_globe_radius:new d.Uniform1f(p),u_viewport:new d.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new d.Uniform3f(p),u_frustum_tr:new d.Uniform3f(p),u_frustum_br:new d.Uniform3f(p),u_frustum_bl:new d.Uniform3f(p),u_horizon:new d.Uniform1f(p),u_transition:new d.Uniform1f(p),u_fadeout_range:new d.Uniform1f(p),u_color:new d.Uniform4f(p),u_high_color:new d.Uniform4f(p),u_space_color:new d.Uniform4f(p),u_star_intensity:new d.Uniform1f(p),u_star_density:new d.Uniform1f(p),u_star_size:new d.Uniform1f(p),u_temporal_offset:new d.Uniform1f(p),u_horizon_angle:new d.Uniform1f(p),u_rotation_matrix:new d.UniformMatrix4f(p)})};let Ys;function mc(p,r,u,m,x,v,M){const A=p.context,E=A.gl,D=p.transform,I=p.useProgram("collisionBox"),R=[];let V=0,Z=0;for(let lt=0;lt<m.length;lt++){const st=m[lt],et=r.getTile(st),at=et.getBucket(u);if(!at)continue;const rt=en(st,at,D);let dt=rt;0===x[0]&&0===x[1]||(dt=p.translatePosMatrix(rt,et,x,v));const _t=M?at.textCollisionBox:at.iconCollisionBox,Lt=at.collisionCircleArray;if(Lt.length>0){const mt=d.create(),At=dt;d.mul(mt,at.placementInvProjMatrix,D.glCoordMatrix),d.mul(mt,mt,at.placementViewportMatrix),R.push({circleArray:Lt,circleOffset:Z,transform:At,invTransform:mt,projection:at.getProjection()}),V+=Lt.length/4,Z=V}_t&&(p.terrain&&p.terrain.setupElevationDraw(et,I),I.draw(A,E.LINES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,$s(dt,D,et,at.getProjection()),u.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,D.zoom,null,[_t.collisionVertexBuffer,_t.collisionVertexBufferExt]))}if(!M||!R.length)return;const j=p.useProgram("collisionCircle"),H=new d.StructArrayLayout2f1f2i16;H.resize(4*V),H._trim();let q=0;for(const lt of R)for(let st=0;st<lt.circleArray.length/4;st++){const et=4*st,at=lt.circleArray[et+0],rt=lt.circleArray[et+1],dt=lt.circleArray[et+2],_t=lt.circleArray[et+3];H.emplace(q++,at,rt,dt,_t,0),H.emplace(q++,at,rt,dt,_t,1),H.emplace(q++,at,rt,dt,_t,2),H.emplace(q++,at,rt,dt,_t,3)}(!Ys||Ys.length<2*V)&&(Ys=function(lt){const st=2*lt,et=new d.StructArrayLayout3ui6;et.resize(st),et._trim();for(let at=0;at<st;at++){const rt=6*at;et.uint16[rt+0]=4*at+0,et.uint16[rt+1]=4*at+1,et.uint16[rt+2]=4*at+2,et.uint16[rt+3]=4*at+2,et.uint16[rt+4]=4*at+3,et.uint16[rt+5]=4*at+0}return et}(V));const U=A.createIndexBuffer(Ys,!0),J=A.createVertexBuffer(H,d.collisionCircleLayout.members,!0);for(const lt of R){const st={u_matrix:lt.transform,u_inv_matrix:lt.invTransform,u_camera_to_center_distance:($=D).getCameraToCenterDistance(lt.projection),u_viewport_size:[$.width,$.height]};j.draw(A,E.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,st,u.id,J,U,d.SegmentVector.simpleSegment(0,2*lt.circleOffset,lt.circleArray.length,lt.circleArray.length/2),null,D.zoom)}var $;J.destroy(),U.destroy()}const gc=d.create();function sl(p,r,u,m,x,v){const{horizontalAlign:M,verticalAlign:A}=d.getAnchorAlignment(p),E=-(M-.5)*r,D=-(A-.5)*u,I=d.evaluateVariableOffset(p,m);return new d.pointGeometry((E/x+I[0])*v,(D/x+I[1])*v)}function Hn(p,r,u,m,x,v,M,A,E,D,I){const R=p.text.placedSymbolArray,V=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,j={},H=hn(A,p.getProjection(),v),q=v.elevation,U=p.getProjection().upVectorScale(A.canonical,v.center.lat,v.worldSize);V.clear();for(let J=0;J<R.length;J++){const $=R.get(J),lt=p.allowVerticalPlacement&&!$.placedOrientation,st=$.hidden||!$.crossTileID||lt?null:m[$.crossTileID];if(st){const et=new d.pointGeometry($.tileAnchorX,$.tileAnchorY),at=p.getProjection().upVector(A.canonical,et.x,et.y),rt=q?q.getAtTileOffset(A,et.x,et.y):0,dt=ve([$.projectedAnchorX+rt*at[0]*U.metersToTile,$.projectedAnchorY+rt*at[1]*U.metersToTile,$.projectedAnchorZ+rt*at[2]*U.metersToTile],u?H:M),_t=Ga(v.getCameraToCenterDistance(p.getProjection()),dt.signedDistanceFromCamera);let Lt=x.evaluateSizeForFeature(p.textSizeData,D,$)*_t/d.ONE_EM;u&&(Lt*=p.tilePixelRatio/E);const{width:mt,height:At,anchor:kt,textOffset:Gt,textScale:wt}=st,Rt=sl(kt,mt,At,Gt,wt,Lt);let Tt;if(u){const Ut=et.add(Rt),{x:Qt,y:ne,z:le}=p.getProjection().projectTilePoint(Ut.x,Ut.y,A.canonical);Tt=ve([Qt+rt*at[0]*U.metersToTile,ne+rt*at[1]*U.metersToTile,le+rt*at[2]*U.metersToTile],M).point}else{const Ut=r?Rt.rotate(-v.angle):Rt;Tt=[dt.point[0]+Ut.x,dt.point[1]+Ut.y,0]}const qt=p.allowVerticalPlacement&&$.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let Ut=0;Ut<$.numGlyphs;Ut++)d.addDynamicAttributes(V,Tt[0],Tt[1],Tt[2],qt);I&&$.associatedIconIndex>=0&&(j[$.associatedIconIndex]={shiftedAnchor:Tt,angle:qt})}else uo($.numGlyphs,V)}if(I){Z.clear();const J=p.icon.placedSymbolArray;for(let $=0;$<J.length;$++){const lt=J.get($);if(lt.hidden)uo(lt.numGlyphs,Z);else{const st=j[$];if(st)for(let et=0;et<lt.numGlyphs;et++)d.addDynamicAttributes(Z,st.shiftedAnchor[0],st.shiftedAnchor[1],st.shiftedAnchor[2],st.angle);else uo(lt.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData(V)}function Su(p,r,u){return u.iconsInText&&r?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function _c(p,r,u,m,x,v,M,A,E,D,I,R){const V=p.context,Z=V.gl,j=p.transform,H="map"===A,q="map"===E,U=H&&"point"!==u.layout.get("symbol-placement"),J=H&&!q&&!U,$=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let lt=!1;const st=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),et=[d.mercatorXfromLng(j.center.lng),d.mercatorYfromLat(j.center.lat)],at=u.layout.get("text-variable-anchor"),rt="globe"===j.projection.name,dt=[],_t=[0,-1,0];let Lt=_t;!rt&&!j.mercatorFromTransition||H||(Lt=function(mt){const At=mt._camera.getWorldToCamera(mt.worldSize,1),kt=d.multiply([],At,mt.globeMatrix);d.invert(kt,kt);const Gt=[0,0,0],wt=[0,1,0,0];return d.transformMat4$1(wt,wt,kt),Gt[0]=wt[0],Gt[1]=wt[1],Gt[2]=wt[2],d.normalize(Gt,Gt),Gt}(j));for(const mt of m){const At=r.getTile(mt),kt=At.getBucket(u);if(!kt||"mercator"===kt.projection.name&&rt)continue;const Gt=x?kt.text:kt.icon;if(!Gt||kt.fullyClipped||!Gt.segments.get().length)continue;const wt=Gt.programConfigurations.get(u.id),Rt=x||kt.sdfIcons,Tt=x?kt.textSizeData:kt.iconSizeData,qt=q||0!==j.pitch,Ut=d.evaluateSizeForZoom(Tt,j.zoom);let Qt,ne,le,Te,Kt=[0,0],fe=null;if(x){if(ne=At.glyphAtlasTexture,le=Z.LINEAR,Qt=At.glyphAtlasTexture.size,kt.iconsInText){Kt=At.imageAtlasTexture.size,fe=At.imageAtlasTexture;const on="composite"===Tt.kind||"camera"===Tt.kind;Te=qt||p.options.rotating||p.options.zooming||on?Z.LINEAR:Z.NEAREST}}else{const on=1!==u.layout.get("icon-size").constantOr(0)||kt.iconsNeedLinear;ne=At.imageAtlasTexture,le=Rt||p.options.rotating||p.options.zooming||on||qt?Z.LINEAR:Z.NEAREST,Qt=At.imageAtlasTexture.size}const Be="globe"===kt.projection.name,ai=Be?Lt:_t,xi=Be?d.globeToMercatorTransition(j.zoom):0,Ze=hn(mt,kt.getProjection(),j),Ni=j.calculatePixelsToTileUnitsMatrix(At),rr=Me(Ze,At.tileID.canonical,q,H,j,kt.getProjection(),Ni),or=p.terrain&&q&&U?d.invert(d.create(),rr):gc,ii=Dn(Ze,At.tileID.canonical,q,H,j,kt.getProjection(),Ni),fi=at&&kt.hasTextData(),Ae="none"!==u.layout.get("icon-text-fit")&&fi&&kt.hasIconData();if(U){const on=j.elevation,ko=on?on.getAtTileOffsetFunc(mt,j.center.lat,j.worldSize,kt.getProjection()):ha=>[0,0,0],$r=Ee(Ze,At.tileID.canonical,q,H,j,kt.getProjection(),Ni);yr(kt,Ze,p,x,$r,ii,q,D,ko,mt)}const Ei=U||x&&at||Ae,qi=p.translatePosMatrix(Ze,At,v,M),Qe=Ei?gc:rr,nn=p.translatePosMatrix(ii,At,v,M,!0),Eo=kt.getProjection().createInversionMatrix(j,mt.canonical),rn=[];p.terrain&&q&&rn.push("PITCH_WITH_MAP_TERRAIN"),Be&&rn.push("PROJECTION_GLOBE_VIEW"),Ei&&rn.push("PROJECTED_POS_ON_VIEWPORT");const qr=Rt&&0!==u.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let Zr;Zr=Rt?kt.iconsInText?ei(Tt.kind,Ut,J,q,p,qi,Qe,nn,Qt,Kt,mt,xi,et,Eo,ai,kt.getProjection()):fc(Tt.kind,Ut,J,q,p,qi,Qe,nn,x,Qt,!0,mt,xi,et,Eo,ai,kt.getProjection()):pc(Tt.kind,Ut,J,q,p,qi,Qe,nn,x,Qt,mt,xi,et,Eo,ai,kt.getProjection());const To={program:p.useProgram(Su(Rt,x,kt),wt,rn),buffers:Gt,uniformValues:Zr,atlasTexture:ne,atlasTextureIcon:fe,atlasInterpolation:le,atlasInterpolationIcon:Te,isSDF:Rt,hasHalo:qr,tile:At,labelPlaneMatrixInv:or};if($&&kt.canOverlap){lt=!0;const on=Gt.segments.get();for(const ko of on)dt.push({segments:new d.SegmentVector([ko]),sortKey:ko.sortKey,state:To})}else dt.push({segments:Gt.segments,sortKey:0,state:To})}lt&&dt.sort((mt,At)=>mt.sortKey-At.sortKey);for(const mt of dt){const At=mt.state;if(p.terrain&&p.terrain.setupElevationDraw(At.tile,At.program,{useDepthForOcclusion:!rt,labelPlaneMatrixInv:At.labelPlaneMatrixInv}),V.activeTexture.set(Z.TEXTURE0),At.atlasTexture.bind(At.atlasInterpolation,Z.CLAMP_TO_EDGE),At.atlasTextureIcon&&(V.activeTexture.set(Z.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),At.isSDF){const kt=At.uniformValues;At.hasHalo&&(kt.u_is_halo=1,yc(At.buffers,mt.segments,u,p,At.program,st,I,R,kt)),kt.u_is_halo=0}yc(At.buffers,mt.segments,u,p,At.program,st,I,R,At.uniformValues)}}function yc(p,r,u,m,x,v,M,A,E){const D=m.context,I=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];x.draw(D,D.gl.TRIANGLES,v,M,A,d.CullFaceMode.disabled,E,u.id,p.layoutVertexBuffer,p.indexBuffer,r,u.paint,m.transform.zoom,p.programConfigurations.get(u.id),I)}function al(p,r,u,m,x,v,M){const A=p.context.gl,E=u.paint.get("fill-pattern"),D=E&&E.constantOr(1),I=u.getCrossfadeParameters();let R,V,Z,j,H;M?(V=D&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=A.LINES):(V=D?"fillPattern":"fill",R=A.TRIANGLES);for(const q of m){const U=r.getTile(q);if(D&&!U.patternsLoaded())continue;const J=U.getBucket(u);if(!J)continue;p.prepareDrawTile();const $=J.programConfigurations.get(u.id),lt=p.useProgram(V,$);D&&(p.context.activeTexture.set(A.TEXTURE0),U.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),$.updatePaintBuffers(I));const st=E.constantOr(null);if(st&&U.imageAtlas){const at=U.imageAtlas,rt=at.patternPositions[st.to.toString()],dt=at.patternPositions[st.from.toString()];rt&&dt&&$.setConstantPatternPositions(rt,dt)}const et=p.translatePosMatrix(q.projMatrix,U,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(M){j=J.indexBuffer2,H=J.segments2;const at=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];Z="fillOutlinePattern"===V&&D?_o(et,p,I,U,at):pi(et,at)}else j=J.indexBuffer,H=J.segments,Z=D?jn(et,p,I,U):Qo(et);p.prepareDrawProgram(p.context,lt,q.toUnwrapped()),lt.draw(p.context,R,x,p.stencilModeForClipping(q),v,d.CullFaceMode.disabled,Z,u.id,J.layoutVertexBuffer,j,H,u.paint,p.transform.zoom,$)}}function wr(p,r,u,m,x,v,M){const A=p.context,E=A.gl,D=p.transform,I=u.paint.get("fill-extrusion-pattern"),R=I.constantOr(1),V=u.getCrossfadeParameters(),Z=u.paint.get("fill-extrusion-opacity"),j=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],H=u.layout.get("fill-extrusion-edge-radius"),q="globe"===D.projection.name?d.fillExtrusionHeightLift():0,U="globe"===D.projection.name,J=U?d.globeToMercatorTransition(D.zoom):0,$=[d.mercatorXfromLng(D.center.lng),d.mercatorYfromLat(D.center.lat)],lt=[];U&&(lt.push("PROJECTION_GLOBE_VIEW"),p.style.terrainSetForDrapingOnly()&&lt.push("TERRAIN")),j[0]>0&&lt.push("FAUX_AO");for(const st of m){const et=r.getTile(st),at=et.getBucket(u);if(!at||at.projection.name!==D.projection.name)continue;const rt=at.programConfigurations.get(u.id),dt=p.useProgram(R?"fillExtrusionPattern":"fillExtrusion",rt,lt);if(p.terrain){const wt=p.terrain;if(p.style.terrainSetForDrapingOnly())wt.setupElevationDraw(et,dt,{useMeterToDem:!0});else{if(!at.enableTerrain)continue;if(wt.setupElevationDraw(et,dt,{useMeterToDem:!0}),Ws(A,r,st,at,u,wt),!at.centroidVertexBuffer){const Rt=dt.attributes.a_centroid_pos;void 0!==Rt&&E.vertexAttrib2f(Rt,0,0)}}}R&&(p.context.activeTexture.set(E.TEXTURE0),et.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),rt.updatePaintBuffers(V));const _t=I.constantOr(null);if(_t&&et.imageAtlas){const wt=et.imageAtlas,Rt=wt.patternPositions[_t.to.toString()],Tt=wt.patternPositions[_t.from.toString()];Rt&&Tt&&rt.setConstantPatternPositions(Rt,Tt)}const Lt=p.translatePosMatrix(st.projMatrix,et,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),mt=D.projection.createInversionMatrix(D,st.canonical),At=u.paint.get("fill-extrusion-vertical-gradient"),kt=R?ae(Lt,p,At,Z,j,H,st,V,et,q,J,$,mt):Zs(Lt,p,At,Z,j,H,st,q,J,$,mt);p.prepareDrawProgram(A,dt,st.toUnwrapped());const Gt=[];p.terrain&&Gt.push(at.centroidVertexBuffer),U&&Gt.push(at.layoutVertexExtBuffer),dt.draw(A,A.gl.TRIANGLES,x,v,M,d.CullFaceMode.backCCW,kt,u.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,u.paint,p.transform.zoom,rt,Gt)}}function Ws(p,r,u,m,x,v){const M=[U=>{let J=U.canonical.x-1,$=U.wrap;return J<0&&(J=(1<<U.canonical.z)-1,$--),new d.OverscaledTileID(U.overscaledZ,$,U.canonical.z,J,U.canonical.y)},U=>{let J=U.canonical.x+1,$=U.wrap;return J===1<<U.canonical.z&&(J=0,$++),new d.OverscaledTileID(U.overscaledZ,$,U.canonical.z,J,U.canonical.y)},U=>new d.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(0===U.canonical.y?1<<U.canonical.z:U.canonical.y)-1),U=>new d.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],A=U=>{const J=r.getSource().minzoom,$=st=>{const et=r.getTileByID(st);if(et&&et.hasData())return et.getBucket(x)},lt=[0,-1,1];for(const st of lt){if(U.overscaledZ+st<J)continue;const et=$(U.calculateScaledKey(U.overscaledZ+st));if(et)return et}},E=[0,0,0],D=(U,J)=>(E[0]=Math.min(U.min.y,J.min.y),E[1]=Math.max(U.max.y,J.max.y),E[2]=d.EXTENT-J.min.x>U.max.x?J.min.x-d.EXTENT:U.max.x,E),I=(U,J)=>(E[0]=Math.min(U.min.x,J.min.x),E[1]=Math.max(U.max.x,J.max.x),E[2]=d.EXTENT-J.min.y>U.max.y?J.min.y-d.EXTENT:U.max.y,E),R=[(U,J)=>D(U,J),(U,J)=>D(J,U),(U,J)=>I(U,J),(U,J)=>I(J,U)],V=new d.pointGeometry(0,0);let Z,j,H;const q=(U,J,$,lt,st)=>{const et=[[lt?$:U,lt?U:$,0],[lt?$:J,lt?J:$,0]],at=st<0?d.EXTENT+st:st,rt=[lt?at:(U+J)/2,lt?(U+J)/2:at,0];return 0===$&&st<0||0!==$&&st>0?v.getForTilePoints(H,[rt],!0,j):et.push(rt),v.getForTilePoints(u,et,!0,Z),Math.max(et[0][2],et[1][2],rt[2])/v.exaggeration()};for(let U=0;U<4;U++){const J=(U<2?1:5)-U,$=m.borders[U];if(0===$.length)continue;const lt=H=M[U](u),st=A(lt);if(!(st&&st instanceof d.FillExtrusionBucket&&st.enableTerrain)||m.borderDoneWithNeighborZ[U]===st.canonical.z&&st.borderDoneWithNeighborZ[J]===m.canonical.z||(j=v.findDEMTileFor(lt),!j||!j.dem))continue;if(!Z){const dt=v.findDEMTileFor(u);if(!dt||!dt.dem)return;Z=dt}const et=st.borders[J];let at=0;const rt=st.borderDoneWithNeighborZ[J]!==m.canonical.z;if(m.canonical.z===st.canonical.z){for(let dt=0;dt<$.length;dt++){const _t=m.featuresOnBorder[$[dt]],Lt=_t.borders[U];let mt;for(;at<et.length&&(mt=st.featuresOnBorder[et[at]],!(mt.borders[J][1]>Lt[0]+3));)rt&&st.encodeCentroid(void 0,mt,!1),at++;if(mt&&at<et.length){const At=at;let kt=0;for(;!(mt.borders[J][0]>Lt[1]-3)&&(kt++,++at!==et.length);)mt=st.featuresOnBorder[et[at]];if(mt=st.featuresOnBorder[et[At]],_t.intersectsCount()>1||mt.intersectsCount()>1||1!==kt){1!==kt&&(at=At),m.encodeCentroid(void 0,_t,!1),rt&&st.encodeCentroid(void 0,mt,!1);continue}const Gt=R[U](_t,mt),wt=U%2?d.EXTENT-1:0;V.x=q(Gt[0],Math.min(d.EXTENT-1,Gt[1]),wt,U<2,Gt[2]),V.y=0,m.encodeCentroid(V,_t,!1),rt&&st.encodeCentroid(V,mt,!1)}else m.encodeCentroid(void 0,_t,!1)}m.borderDoneWithNeighborZ[U]=st.canonical.z,m.needsCentroidUpdate=!0,rt&&(st.borderDoneWithNeighborZ[J]=m.canonical.z,st.needsCentroidUpdate=!0)}else{for(const dt of $)m.encodeCentroid(void 0,m.featuresOnBorder[dt],!1);if(rt){for(const dt of et)st.encodeCentroid(void 0,st.featuresOnBorder[dt],!1);st.borderDoneWithNeighborZ[J]=m.canonical.z,st.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[U]=st.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(p)}const Eu=new d.Color(1,0,0,1),xo=new d.Color(0,1,0,1),ir=new d.Color(0,0,1,1),Tu=new d.Color(1,0,1,1),vo=new d.Color(0,1,1,1);function Re(p,r,u){const m=p.context,x=p.transform,v=m.gl,M="globe"===x.projection.name,A=M?["PROJECTION_GLOBE_VIEW"]:null;let E=u.projMatrix;if(M&&d.globeToMercatorTransition(x.zoom)>0){const _t=d.transitionTileAABBinECEF(u.canonical,x),Lt=d.globeDenormalizeECEF(_t);E=d.multiply(new Float32Array(16),x.globeMatrix,Lt),d.multiply(E,x.projMatrix,E)}const D=p.useProgram("debug",null,A),I=r.getTileByID(u.key);p.terrain&&p.terrain.setupElevationDraw(I,D);const R=d.DepthMode.disabled,V=d.StencilMode.disabled,Z=p.colorModeForRenderPass(),j="$debug";m.activeTexture.set(v.TEXTURE0),p.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),M?I._makeGlobeTileDebugBuffers(p.context,x):I._makeDebugTileBoundsBuffers(p.context,x.projection);const H=I._tileDebugBuffer||p.debugBuffer,q=I._tileDebugIndexBuffer||p.debugIndexBuffer,U=I._tileDebugSegments||p.debugSegments;D.draw(m,v.LINE_STRIP,R,V,Z,d.CullFaceMode.disabled,Nr(E,d.Color.red),j,H,q,U,null,null,null,[I._globeTileDebugBorderBuffer]);const J=I.latestRawTileData,$=Math.floor((J&&J.byteLength||0)/1024),lt=r.getTile(u).tileSize,st=512/Math.min(lt,512)*(u.overscaledZ/x.zoom)*.5;let et=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(et+=` => ${u.overscaledZ}`),et+=` ${$}kb`,function(_t,Lt){_t.initDebugOverlayCanvas();const mt=_t.debugOverlayCanvas,At=_t.context.gl,kt=_t.debugOverlayCanvas.getContext("2d");kt.clearRect(0,0,mt.width,mt.height),kt.shadowColor="white",kt.shadowBlur=2,kt.lineWidth=1.5,kt.strokeStyle="white",kt.textBaseline="top",kt.font="bold 36px Open Sans, sans-serif",kt.fillText(Lt,5,5),kt.strokeText(Lt,5,5),_t.debugOverlayTexture.update(mt),_t.debugOverlayTexture.bind(At.LINEAR,At.CLAMP_TO_EDGE)}(p,et);const at=I._tileDebugTextBuffer||p.debugBuffer,rt=I._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,dt=I._tileDebugTextSegments||p.debugSegments;D.draw(m,v.TRIANGLES,R,V,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,Nr(E,d.Color.transparent,st),j,at,rt,dt,null,null,null,[I._globeTileDebugTextBuffer])}function is(p,r,u,m){Xs(p,0,r+u/2,p.transform.width,u,m)}function ku(p,r,u,m){Xs(p,r-u/2,0,u,p.transform.height,m)}function Xs(p,r,u,m,x,v){const M=p.context,A=M.gl;A.enable(A.SCISSOR_TEST),A.scissor(r*d.exported.devicePixelRatio,u*d.exported.devicePixelRatio,m*d.exported.devicePixelRatio,x*d.exported.devicePixelRatio),M.clear({color:v}),A.disable(A.SCISSOR_TEST)}const Js=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:qh}=Js;function bo(p,r,u,m){p.emplaceBack(r,u,m)}class Ur{constructor(r){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,bo(this.vertexArray,-1,-1,1),bo(this.vertexArray,1,-1,1),bo(this.vertexArray,-1,1,1),bo(this.vertexArray,1,1,1),bo(this.vertexArray,-1,-1,-1),bo(this.vertexArray,1,-1,-1),bo(this.vertexArray,-1,1,-1),bo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,qh),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function ns(p,r,u,m,x,v){const M=p.gl,A=r.paint.get("sky-atmosphere-color"),E=r.paint.get("sky-atmosphere-halo-color"),D=r.paint.get("sky-atmosphere-sun-intensity"),I={u_matrix_3f:d.fromMat4(d.create$1(),m),u_sun_direction:x,u_sun_intensity:D,u_color_tint_r:[(j=A).r,j.g,j.b,j.a],u_color_tint_m:[(H=E).r,H.g,H.b,H.a],u_luminance:5e-5};var j,H;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),u.draw(p,M.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,I,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const ll=d.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class cl{constructor(r){const u=new d.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const m=new d.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(u,ll.members),this.indexBuffer=r.createIndexBuffer(m),this.segments=d.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const rs={symbol:function(p,r,u,m,x){if("translucent"!==p.renderPass)return;const v=d.StencilMode.disabled,M=p.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(A,E,D,I,R,V,Z){const j=E.transform,H="map"===R,q="map"===V;for(const U of A){const J=I.getTile(U),$=J.getBucket(D);if(!$||!$.text||!$.text.segments.get().length)continue;const lt=d.evaluateSizeForZoom($.textSizeData,j.zoom),st=hn(U,$.getProjection(),j),et=j.calculatePixelsToTileUnitsMatrix(J),at=Me(st,J.tileID.canonical,q,H,j,$.getProjection(),et),rt="none"!==D.layout.get("icon-text-fit")&&$.hasIconData();if(lt){const dt=Math.pow(2,j.zoom-J.tileID.overscaledZ);Hn($,H,q,Z,d.symbolSize,j,at,U,dt,lt,rt)}}}(m,p,u,r,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),x),0!==u.paint.get("icon-opacity").constantOr(1)&&_c(p,r,u,m,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),v,M),0!==u.paint.get("text-opacity").constantOr(1)&&_c(p,r,u,m,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),v,M),r.map.showCollisionBoxes&&(mc(p,r,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),mc(p,r,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,u,m){if("translucent"!==p.renderPass)return;const x=u.paint.get("circle-opacity"),v=u.paint.get("circle-stroke-width"),M=u.paint.get("circle-stroke-opacity"),A=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===v.constantOr(1)||0===M.constantOr(1)))return;const E=p.context,D=E.gl,I=p.transform,R=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),V=d.StencilMode.disabled,Z=p.colorModeForRenderPass(),j="globe"===I.projection.name,H=[d.mercatorXfromLng(I.center.lng),d.mercatorYfromLat(I.center.lat)],q=[];for(let J=0;J<m.length;J++){const $=m[J],lt=r.getTile($),st=lt.getBucket(u);if(!st||st.projection.name!==I.projection.name)continue;const et=st.programConfigurations.get(u.id),at=uc(u);j&&at.push("PROJECTION_GLOBE_VIEW");const rt=p.useProgram("circle",et,at),dt=st.layoutVertexBuffer,_t=st.globeExtVertexBuffer,Lt=st.indexBuffer,mt=I.projection.createInversionMatrix(I,$.canonical),At={programConfiguration:et,program:rt,layoutVertexBuffer:dt,globeExtVertexBuffer:_t,indexBuffer:Lt,uniformValues:cc(p,$,lt,mt,H,u),tile:lt};if(A){const kt=st.segments.get();for(const Gt of kt)q.push({segments:new d.SegmentVector([Gt]),sortKey:Gt.sortKey,state:At})}else q.push({segments:st.segments,sortKey:0,state:At})}A&&q.sort((J,$)=>J.sortKey-$.sortKey);const U={useDepthForOcclusion:!j};for(const J of q){const{programConfiguration:$,program:lt,layoutVertexBuffer:st,globeExtVertexBuffer:et,indexBuffer:at,uniformValues:rt,tile:dt}=J.state,_t=J.segments;p.terrain&&p.terrain.setupElevationDraw(dt,lt,U),p.prepareDrawProgram(E,lt,dt.tileID.toUnwrapped()),lt.draw(E,D.TRIANGLES,R,V,Z,d.CullFaceMode.disabled,rt,u.id,st,at,_t,u.paint,I.zoom,$,[et])}},heatmap:function(p,r,u,m){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const x=p.context,v=x.gl,M=d.StencilMode.disabled,A=new d.ColorMode([v.ONE,v.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(Z,j,H,q){const U=Z.gl,J=j.width*q,$=j.height*q;Z.activeTexture.set(U.TEXTURE1),Z.viewport.set([0,0,J,$]);let lt=H.heatmapFbo;if(!lt||lt&&(lt.width!==J||lt.height!==$)){lt&&lt.destroy();const st=U.createTexture();U.bindTexture(U.TEXTURE_2D,st),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),lt=H.heatmapFbo=Z.createFramebuffer(J,$,!1),function(et,at,rt,dt,_t,Lt){const mt=et.gl;mt.texImage2D(mt.TEXTURE_2D,0,mt.RGBA,_t,Lt,0,mt.RGBA,et.extRenderToTextureHalfFloat?et.extTextureHalfFloat.HALF_FLOAT_OES:mt.UNSIGNED_BYTE,null),dt.colorAttachment.set(rt)}(Z,0,st,lt,J,$)}else U.bindTexture(U.TEXTURE_2D,lt.colorAttachment.get()),Z.bindFramebuffer.set(lt.framebuffer)})(x,p,u,"globe"===p.transform.projection.name?.5:.25),x.clear({color:d.Color.transparent});const E=p.transform,D="globe"===E.projection.name,I=D?["PROJECTION_GLOBE_VIEW"]:null,R=D?d.CullFaceMode.frontCCW:d.CullFaceMode.disabled,V=[d.mercatorXfromLng(E.center.lng),d.mercatorYfromLat(E.center.lat)];for(let Z=0;Z<m.length;Z++){const j=m[Z];if(r.hasRenderableParent(j))continue;const H=r.getTile(j),q=H.getBucket(u);if(!q||q.projection.name!==E.projection.name)continue;const U=q.programConfigurations.get(u.id),J=p.useProgram("heatmap",U,I),{zoom:$}=p.transform;p.terrain&&p.terrain.setupElevationDraw(H,J),p.prepareDrawProgram(x,J,j.toUnwrapped());const lt=E.projection.createInversionMatrix(E,j.canonical);J.draw(x,v.TRIANGLES,d.DepthMode.disabled,M,A,R,hc(p,j,H,lt,V,$,u.paint.get("heatmap-intensity")),u.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,u.paint,p.transform.zoom,U,D?[q.globeExtVertexBuffer]:null)}x.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(x,v){const M=x.context,A=M.gl,E=v.heatmapFbo;if(!E)return;M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,E.colorAttachment.get()),M.activeTexture.set(A.TEXTURE1);let D=v.colorRampTexture;D||(D=v.colorRampTexture=new d.Texture(M,v.colorRamp,A.RGBA)),D.bind(A.LINEAR,A.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(M,A.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,x.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,v.paint,x.transform.zoom)}(p,u))},line:function(p,r,u,m){if("translucent"!==p.renderPass)return;const x=u.paint.get("line-opacity"),v=u.paint.get("line-width");if(0===x.constantOr(1)||0===v.constantOr(1))return;const M=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),A=p.colorModeForRenderPass(),E=p.terrain&&p.terrain.renderingToTexture?1:d.exported.devicePixelRatio,D=u.paint.get("line-dasharray"),I=D.constantOr(1),R=u.layout.get("line-cap"),V=u.paint.get("line-pattern"),Z=V.constantOr(1),j=u.paint.get("line-gradient"),H=u.getCrossfadeParameters(),q=Z?"linePattern":"line",U=p.context,J=U.gl,$=(st=>{const et=[];es(st)&&et.push("RENDER_LINE_DASH"),st.paint.get("line-gradient")&&et.push("RENDER_LINE_GRADIENT");const at=st.paint.get("line-trim-offset");0===at[0]&&0===at[1]||et.push("RENDER_LINE_TRIM_OFFSET");const rt=st.paint.get("line-pattern").constantOr(1),dt=1!==st.paint.get("line-opacity").constantOr(1);return!rt&&dt&&et.push("RENDER_LINE_ALPHA_DISCARD"),et})(u);let lt=$.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(lt=!1);for(const st of m){const et=r.getTile(st);if(Z&&!et.patternsLoaded())continue;const at=et.getBucket(u);if(!at)continue;p.prepareDrawTile();const rt=at.programConfigurations.get(u.id),dt=p.useProgram(q,rt,$),_t=V.constantOr(null);if(_t&&et.imageAtlas){const Tt=et.imageAtlas,qt=Tt.patternPositions[_t.to.toString()],Ut=Tt.patternPositions[_t.from.toString()];qt&&Ut&&rt.setConstantPatternPositions(qt,Ut)}const Lt=D.constantOr(null),mt=R.constantOr(null);if(!Z&&Lt&&mt&&et.lineAtlas){const Tt=et.lineAtlas,qt=Tt.getDash(Lt.to,mt),Ut=Tt.getDash(Lt.from,mt);qt&&Ut&&rt.setConstantPatternPositions(qt,Ut)}let[At,kt]=u.paint.get("line-trim-offset");("round"===mt||"square"===mt)&&At!==kt&&(0===At&&(At-=1),1===kt&&(kt+=1));const Gt=p.terrain?st.projMatrix:null,wt=Z?yo(p,et,u,H,Gt,E):dn(p,et,u,H,Gt,at.lineClipsArray.length,E,[At,kt]);if(j){const Tt=at.gradients[u.id];let qt=Tt.texture;if(u.gradientVersion!==Tt.version){let Ut=256;if(u.stepInterpolant){const Qt=r.getSource().maxzoom,ne=st.canonical.z===Qt?Math.ceil(1<<p.transform.maxZoom-st.canonical.z):1;Ut=d.clamp(d.nextPowerOfTwo(at.maxLineLength/d.EXTENT*1024*ne),256,U.maxTextureSize)}Tt.gradient=d.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Ut,image:Tt.gradient||void 0,clips:at.lineClipsArray}),Tt.texture?Tt.texture.update(Tt.gradient):Tt.texture=new d.Texture(U,Tt.gradient,J.RGBA),Tt.version=u.gradientVersion,qt=Tt.texture}U.activeTexture.set(J.TEXTURE1),qt.bind(u.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}I&&(U.activeTexture.set(J.TEXTURE0),et.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),rt.updatePaintBuffers(H)),Z&&(U.activeTexture.set(J.TEXTURE0),et.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),rt.updatePaintBuffers(H)),p.prepareDrawProgram(U,dt,st.toUnwrapped());const Rt=Tt=>{dt.draw(U,J.TRIANGLES,M,Tt,A,d.CullFaceMode.disabled,wt,u.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,u.paint,p.transform.zoom,rt,[at.layoutVertexBuffer2])};if(lt){const Tt=p.stencilModeForClipping(st).ref;0===Tt&&p.terrain&&U.clear({stencil:0});const qt={func:J.EQUAL,mask:255};wt.u_alpha_discard_threshold=.8,Rt(new d.StencilMode(qt,Tt,255,J.KEEP,J.KEEP,J.INVERT)),wt.u_alpha_discard_threshold=0,Rt(new d.StencilMode(qt,Tt,255,J.KEEP,J.KEEP,J.KEEP))}else Rt(p.stencilModeForClipping(st))}lt&&(p.resetStencilClippingMasks(),p.terrain&&U.clear({stencil:0}))},fill:function(p,r,u,m){const x=u.paint.get("fill-color"),v=u.paint.get("fill-opacity");if(0===v.constantOr(1))return;const M=p.colorModeForRenderPass(),A=u.paint.get("fill-pattern"),E=p.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===x.constantOr(d.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(p.renderPass===E){const D=p.depthModeForSublayer(1,"opaque"===p.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);al(p,r,u,m,D,M,!1)}if("translucent"===p.renderPass&&u.paint.get("fill-antialias")){const D=p.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);al(p,r,u,m,D,M,!0)}},"fill-extrusion":function(p,r,u,m){const x=u.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===p.renderPass){const v=new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==x||u.paint.get("fill-extrusion-pattern").constantOr(1))wr(p,r,u,m,v,d.StencilMode.disabled,d.ColorMode.disabled),wr(p,r,u,m,v,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const M=p.colorModeForRenderPass();wr(p,r,u,m,v,d.StencilMode.disabled,M)}}},hillshade:function(p,r,u,m){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const x=p.context,v=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),M=p.colorModeForRenderPass(),A=p.terrain&&p.terrain.renderingToTexture,[E,D]="translucent"!==p.renderPass||A?[{},m]:p.stencilConfigForOverlap(m);for(const I of D){const R=r.getTile(I);if(R.needsHillshadePrepare&&"offscreen"===p.renderPass)Jo(p,R,u,v,d.StencilMode.disabled,M);else if("translucent"===p.renderPass){const V=A&&p.terrain?p.terrain.stencilModeForRTTOverlap(I):E[I.overscaledZ];rc(p,I,R,u,v,V,M)}}x.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,u,m,x,v){if("translucent"!==p.renderPass||0===u.paint.get("raster-opacity")||!m.length)return;const M=p.context,A=M.gl,E=r.getSource(),D=p.useProgram("raster"),I=p.colorModeForRenderPass(),R=p.terrain&&p.terrain.renderingToTexture,[V,Z]=E instanceof pt||R?[{},m]:p.stencilConfigForOverlap(m),j=Z[Z.length-1].overscaledZ,H=!p.options.moving;for(const q of Z){const U=R?d.DepthMode.disabled:p.depthModeForSublayer(q.overscaledZ-j,1===u.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,A.LESS),J=q.toUnwrapped(),$=r.getTile(q);if(R&&(!$||!$.hasData()))continue;const lt=R?q.projMatrix:p.transform.calculateProjMatrix(J,H),st=p.terrain&&R?p.terrain.stencilModeForRTTOverlap(q):V[q.overscaledZ],et=v?0:u.paint.get("raster-fade-duration");$.registerFadeDuration(et);const at=r.findLoadedParent(q,0),rt=qs($,at,r,p.transform,et);let dt,_t;p.terrain&&p.terrain.prepareDrawTile();const Lt="nearest"===u.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;M.activeTexture.set(A.TEXTURE0),$.texture.bind(Lt,A.CLAMP_TO_EDGE),M.activeTexture.set(A.TEXTURE1),at?(at.texture.bind(Lt,A.CLAMP_TO_EDGE),dt=Math.pow(2,at.tileID.overscaledZ-$.tileID.overscaledZ),_t=[$.tileID.canonical.x*dt%1,$.tileID.canonical.y*dt%1]):$.texture.bind(Lt,A.CLAMP_TO_EDGE);const mt=wu(lt,_t||[0,0],dt||1,rt,u,E instanceof pt?E.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(M,D,J),E instanceof pt)E.boundsBuffer&&E.boundsSegments&&D.draw(M,A.TRIANGLES,U,d.StencilMode.disabled,I,d.CullFaceMode.disabled,mt,u.id,E.boundsBuffer,p.quadTriangleIndexBuffer,E.boundsSegments);else{const{tileBoundsBuffer:At,tileBoundsIndexBuffer:kt,tileBoundsSegments:Gt}=p.getTileBoundsBuffers($);D.draw(M,A.TRIANGLES,U,st,I,d.CullFaceMode.disabled,mt,u.id,At,kt,Gt)}}p.resetStencilClippingMasks()},background:function(p,r,u,m){const x=u.paint.get("background-color"),v=u.paint.get("background-opacity");if(0===v)return;const M=p.context,A=M.gl,E=p.transform,D=E.tileSize,I=u.paint.get("background-pattern");if(p.isPatternMissing(I))return;const R=!I&&1===x.a&&1===v&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==R)return;const V=d.StencilMode.disabled,Z=p.depthModeForSublayer(0,"opaque"===R?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),j=p.colorModeForRenderPass(),H=p.useProgram(I?"backgroundPattern":"background");let q,U=m;U||(q=p.getBackgroundTiles(),U=Object.values(q).map($=>$.tileID)),I&&(M.activeTexture.set(A.TEXTURE0),p.imageManager.bind(p.context));const J=u.getCrossfadeParameters();for(const $ of U){const lt=$.toUnwrapped(),st=m?$.projMatrix:p.transform.calculateProjMatrix(lt);p.prepareDrawTile();const et=r?r.getTile($):q?q[$.key]:new d.Tile($,D,E.zoom,p),at=I?Mu(st,v,p,I,{tileID:$,tileSize:D},J):Hh(st,v,x);p.prepareDrawProgram(M,H,lt);const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:dt,tileBoundsSegments:_t}=p.getTileBoundsBuffers(et);H.draw(M,A.TRIANGLES,Z,V,j,d.CullFaceMode.disabled,at,u.id,rt,dt,_t)}},sky:function(p,r,u){const m=p.transform,x="mercator"===m.projection.name||"globe"===m.projection.name?1:d.smoothstep(7,8,m.zoom),v=u.paint.get("sky-opacity")*x;if(0===v)return;const M=p.context,A=u.paint.get("sky-type"),E=new d.DepthMode(M.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),D=p.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===p.renderPass?u.needsSkyboxCapture(p)&&(function(I,R,V,Z){const j=I.context,H=j.gl;let q=R.skyboxFbo;if(!q){q=R.skyboxFbo=j.createFramebuffer(32,32,!1),R.skyboxGeometry=new Ur(j),R.skyboxTexture=j.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,R.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let lt=0;lt<6;++lt)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(q.framebuffer),j.viewport.set([0,0,32,32]);const U=R.getCenter(I,!0),J=I.useProgram("skyboxCapture"),$=new Float64Array(16);d.identity($),d.rotateY($,$,.5*-Math.PI),ns(j,R,J,$,U,0),d.identity($),d.rotateY($,$,.5*Math.PI),ns(j,R,J,$,U,1),d.identity($),d.rotateX($,$,.5*-Math.PI),ns(j,R,J,$,U,2),d.identity($),d.rotateX($,$,.5*Math.PI),ns(j,R,J,$,U,3),d.identity($),ns(j,R,J,$,U,4),d.identity($),d.rotateY($,$,Math.PI),ns(j,R,J,$,U,5),j.viewport.set([0,0,I.width,I.height])}(p,u),u.markSkyboxValid(p)):"sky"===p.renderPass&&function(I,R,V,Z,j){const H=I.context,q=H.gl,U=I.transform,J=I.useProgram("skybox");H.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,R.skyboxTexture);const $={u_matrix:U.skyboxMatrix,u_sun_direction:R.getCenter(I,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:j};I.prepareDrawProgram(H,J),J.draw(H,q.TRIANGLES,V,d.StencilMode.disabled,I.colorModeForRenderPass(),d.CullFaceMode.backCW,$,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(p,u,E,v,D):"gradient"===A&&"sky"===p.renderPass&&function(I,R,V,Z,j){const H=I.context,q=H.gl,U=I.transform,J=I.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Ur(H)),H.activeTexture.set(q.TEXTURE0);let $=R.colorRampTexture;$||($=R.colorRampTexture=new d.Texture(H,R.colorRamp,q.RGBA)),$.bind(q.LINEAR,q.CLAMP_TO_EDGE);const lt=(st=U.skyboxMatrix,et=R.getCenter(I,!1),at=R.paint.get("sky-gradient-radius"),rt=Z,dt=j,{u_matrix:st,u_color_ramp:0,u_center_direction:et,u_radius:d.degToRad(at),u_opacity:rt,u_temporal_offset:dt});var st,et,at,rt,dt;I.prepareDrawProgram(H,J),J.draw(H,q.TRIANGLES,V,d.StencilMode.disabled,I.colorModeForRenderPass(),d.CullFaceMode.backCW,lt,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(p,u,E,v,D)},debug:function(p,r,u){for(let m=0;m<u.length;m++)Re(p,r,u[m])},custom:function(p,r,u){const m=p.context,x=u.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const v=x.prerender;v&&(p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),v.call(x,m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),m.setStencilMode(d.StencilMode.disabled);const v="3d"===x.renderingMode?new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,d.DepthMode.ReadOnly);m.setDepthMode(v),x.render(m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState(),m.bindFramebuffer.set(null)}}};class Du{constructor(r,u){this.context=new W(r),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ns,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,u){const m=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ac(this,r));const x=this._terrain;this.transform.elevation=m?x:null,x.update(r,this.transform,u)}_updateFog(r){const u=r.fog;if(!u||"globe"===this.transform.projection.name||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=u.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const v=m+.78*(x-m);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,u){if(this.width=r*d.exported.devicePixelRatio,this.height=u*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const r=this.context,u=new d.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(d.EXTENT,0),u.emplaceBack(0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(u,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const m=new d.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(d.EXTENT,0),m.emplaceBack(0,d.EXTENT),m.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=r.createVertexBuffer(m,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const x=new d.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(x,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const v=new d.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(d.EXTENT,0,d.EXTENT,0),v.emplaceBack(0,d.EXTENT,0,d.EXTENT),v.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(v,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const M=new d.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(M);const A=new d.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])A.emplaceBack(D);this.debugIndexBuffer=r.createIndexBuffer(A),this.emptyTexture=new d.Texture(r,new d.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=d.create();const E=this.context.gl;this.stencilClearMode=new d.StencilMode({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(d.window.performance.now()),this.atmosphereBuffer=new cl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,u=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,u.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,xu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,u,m){if(!u||this.currentStencilSource===u.id||!r.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const E of m)if(void 0===this._tileClippingMaskIDs[E.key]){A=!0;break}if(!A)return}this.currentStencilSource=u.id;const x=this.context,v=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(d.ColorMode.disabled),x.setDepthMode(d.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of m){const E=u.getTile(A),D=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:R,tileBoundsSegments:V}=this.getTileBoundsBuffers(E);M.draw(x,v.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,xu(A.projMatrix),"$clipping",I,R,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,u=this.context.gl;return new d.StencilMode({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const u=this.context.gl;return new d.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(r){const u=this.context.gl,m=r.sort((M,A)=>A.overscaledZ-M.overscaledZ),x=m[m.length-1].overscaledZ,v=m[0].overscaledZ-x+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const M={};for(let A=0;A<v;A++)M[A+x]=new d.StencilMode({func:u.GEQUAL,mask:255},A+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=v,[M,m]}return[{[x]:d.StencilMode.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new d.ColorMode([r.CONSTANT_COLOR,r.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(r,u,m){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new d.DepthMode(m||this.context.gl.LEQUAL,u,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,u){this.style=r,this.options=u,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const m=this.style.order,x=this.style._sourceCaches;for(const E in x){const D=x[E];D.used&&D.prepare(this.context)}const v={},M={},A={};for(const E in x){const D=x[E];v[E]=D.getVisibleCoordinates(),M[E]=v[E].slice().reverse(),A[E]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<m.length;E++)if(this.style._layers[m[E]].is3D()){this.opaquePassCutoff=E;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.GlobeSharedBuffers(this.context)),d.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const E of m){const D=this.style._layers[E],I=r._getLayerSourceCache(D);if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const R=I?M[I.id]:void 0;("custom"===D.type||D.isSky()||R&&R.length)&&this.renderLayer(this,I,D,R)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(E);if(E.isSky())continue;const I=D?M[D.id]:void 0;this._renderTileClippingMasks(E,D,I),this.renderLayer(this,D,E,I)}if(this.style.fog&&this.transform.projection.supportsFog&&function(E,D){const I=E.context,R=I.gl,V=E.transform,Z=new d.DepthMode(R.LEQUAL,d.DepthMode.ReadOnly,[0,1]),j=E.useProgram("globeAtmosphere",null,"globe"===V.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),H=d.globeToMercatorTransition(V.zoom),q=D.properties.get("color").toArray01(),U=D.properties.get("high-color").toArray01(),J=D.properties.get("space-color").toArray01PremultipliedAlpha(),$=d.identity$1([]);d.rotateY$1($,$,-d.degToRad(V._center.lng)),d.rotateX$1($,$,d.degToRad(V._center.lat)),d.rotateZ$1($,$,V.angle),d.rotateX$1($,$,-V._pitch);const lt=d.fromQuat(new Float32Array(16),$),st=d.mapValue(D.properties.get("star-intensity"),0,1,0,.25),at=d.mapValue(D.properties.get("horizon-blend"),0,1,5e-4,.25),rt=d.globeUseCustomAntiAliasing(E,I,V)&&5e-4===at?V.worldSize/(2*Math.PI*1.025)-1:V.globeRadius,dt=E.frameCounter/1e3%1,_t=d.length(V.globeCenterInViewSpace),Lt=Math.sqrt(Math.pow(_t,2)-Math.pow(rt,2)),mt=Math.acos(Lt/_t),At={u_frustum_tl:V.frustumCorners.TL,u_frustum_tr:V.frustumCorners.TR,u_frustum_br:V.frustumCorners.BR,u_frustum_bl:V.frustumCorners.BL,u_horizon:V.frustumCorners.horizon,u_transition:H,u_fadeout_range:at,u_color:q,u_high_color:U,u_space_color:J,u_star_intensity:st,u_star_size:5*d.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:dt,u_horizon_angle:mt,u_rotation_matrix:lt};E.prepareDrawProgram(I,j);const kt=E.atmosphereBuffer;kt&&j.draw(I,R.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.alphaBlended,d.CullFaceMode.backCW,At,"skybox",kt.vertexBuffer,kt.indexBuffer,kt.segments)}(this,this.style.fog),this.renderPass="sky",(d.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const E=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(E);E.isSky()&&this.renderLayer(this,D,E,D?M[D.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const E=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(E);if(E.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(E)){if(E.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const I=D?("symbol"===E.type?A:M)[D.id]:void 0;this._renderTileClippingMasks(E,D,D?v[D.id]:void 0),this.renderLayer(this,D,E,I),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let E=null;d.values(this.style._layers).forEach(D=>{const I=r._getLayerSourceCache(D);I&&!D.isHidden(this.transform.zoom)&&(!E||E.getSource().maxzoom<I.getSource().maxzoom)&&(E=I)}),E&&this.options.showTileBoundaries&&rs.debug(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const D=E.transform.padding;is(E,E.transform.height-(D.top||0),3,Eu),is(E,D.bottom||0,3,xo),ku(E,D.left||0,3,ir),ku(E,E.transform.width-(D.right||0),3,Tu);const I=E.transform.centerPoint;var R,V,Z,j;Xs(R=E,(V=I.x)-1,(Z=E.transform.height-I.y)-10,2,20,j=vo),Xs(R,V-10,Z-1,20,2,j)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,u,m,x){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(m.type)||rs[m.type](r,u,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let m=this.gpuTimers[r.id];m||(m=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),m.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,u=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),r.beginQueryEXT(r.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const u={};for(const m in r){const x=r[m],v=this.context.extTimerQuery,M=v.getQueryObjectEXT(x.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(x.query),u[m]=M}return u}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let m=0;for(const x of r)m+=u.getQueryObjectEXT(x,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(x);return m}translatePosMatrix(r,u,m,x,v){if(!m[0]&&!m[1])return r;const M=v?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(M){const D=Math.sin(M),I=Math.cos(M);m=[m[0]*I-m[1]*D,m[0]*D+m[1]*I]}const A=[v?m[0]:Wn(u,m[0],this.transform.zoom),v?m[1]:Wn(u,m[1],this.transform.zoom),0],E=new Float32Array(16);return d.translate(E,r,A),E}saveTileTexture(r){const u=this._tileTextures[r.size[0]];u?u.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const u=this._tileTextures[r];return u&&u.length>0?u.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const u=this.imageManager.getPattern(r.from.toString()),m=this.imageManager.getPattern(r.to.toString());return!u||!m}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),u&&!r&&0!==u.getOpacity(this.transform.pitch)&&m.push("FOG"),r&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(r,u,m){this.cache=this.cache||{};const x=m||[],v=this.currentGlobalDefines().concat(x),M=lc.cacheKey(Ja[r],r,v,u);return this.cache[M]||(this.cache[M]=new lc(this.context,r,Ja[r],u,Au[r],v)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,u,m){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const v=x.getOpacity(this.transform.pitch),M=((A,E,D,I,R,V,Z,j,H,q,U)=>{const J=A.transform,$=E.properties.get("color").toArray01();$[3]=I;const lt=A.frameCounter/1e3%1;return{u_fog_matrix:D?J.calculateFogTileMatrix(D):A.identityMat,u_fog_range:E.getFovAdjustedRange(J._fov),u_fog_color:$,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:lt,u_frustum_tl:R,u_frustum_tr:V,u_frustum_br:Z,u_frustum_bl:j,u_globe_pos:H,u_globe_radius:q,u_viewport:U,u_globe_transition:d.globeToMercatorTransition(J.zoom),u_is_globe:+("globe"===J.projection.name)}})(this,x,m,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.exported.devicePixelRatio,this.transform.height*d.exported.devicePixelRatio]);u.setFogUniformValues(r,M)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,u=r.createTexture();return r.bindTexture(r.TEXTURE_2D,u),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)u[x.key]=r[x.key]||new d.Tile(x,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class ul{constructor(r=0,u=0,m=0,x=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=m,this.right=x}interpolate(r,u,m){return null!=u.top&&null!=r.top&&(this.top=d.number(r.top,u.top,m)),null!=u.bottom&&null!=r.bottom&&(this.bottom=d.number(r.bottom,u.bottom,m)),null!=u.left&&null!=r.left&&(this.left=d.number(r.left,u.left,m)),null!=u.right&&null!=r.right&&(this.right=d.number(r.right,u.right,m)),this}getCenter(r,u){const m=d.clamp((this.left+r-this.right)/2,0,r),x=d.clamp((this.top+u-this.bottom)/2,0,u);return new d.pointGeometry(m,x)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ul(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Iu(p,r){const u=d.getColumn(p,3);d.fromQuat(p,r),d.setColumn(p,3,u)}function Ks(p,r){const u=d.identity$1([]);return d.rotateZ$1(u,u,-r),d.rotateX$1(u,u,-p),u}function Qs(p,r){const u=[p[0],p[1],0],m=[r[0],r[1],0];if(d.length(u)>=1e-15){const M=d.normalize([],u);d.scale$2(m,M,d.dot(m,M)),r[0]=m[0],r[1]=m[1]}const x=d.cross([],r,p);if(d.len(x)<1e-15)return null;const v=Math.atan2(-x[1],x[0]);return Ks(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),v)}class $t{constructor(r,u){this.position=r,this.orientation=u}get position(){return this._position}set position(r){if(r){const u=r instanceof d.MercatorCoordinate?r:new d.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(u.x=d.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(r,u){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(r)):0,x=this.position,v=d.MercatorCoordinate.fromLngLat(r,m),M=[v.x-x.x,v.y-x.y,v.z-x.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Qs(M,u)}setPitchBearing(r,u){this.orientation=Ks(d.degToRad(r),d.degToRad(-u))}}class ze{constructor(r,u){this._transform=d.identity([]),this.orientation=u,this.position=r}get mercatorPosition(){const r=this.position;return new d.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=d.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var u;r&&d.setColumn(this._transform,3,[(u=r)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||d.identity$1([]),r&&Iu(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,u){this._orientation=Ks(r,u),Iu(this._transform,this._orientation)}forward(){const r=d.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=d.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=d.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,u){const m=new Float64Array(16);return d.invert(m,this.getWorldToCamera(r,u)),m}getWorldToCameraPosition(r,u,m){const x=this.position;d.scale$2(x,x,-r);const v=new Float64Array(16);return d.fromScaling(v,[m,m,m]),d.translate(v,v,x),v[10]*=u,v}getWorldToCamera(r,u){const m=new Float64Array(16),x=new Float64Array(4),v=this.position;return d.conjugate(x,this._orientation),d.scale$2(v,v,-r),d.fromQuat(m,x),d.translate(m,m,v),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(r,u,m,x){const v=new Float64Array(16);return d.perspective(v,r,u,m,x),v}getDistanceToElevation(r){const u=0===r?0:d.mercatorZfromAltitude(r,this.position[1]),m=this.forward();return(u-this.position[2])/m[2]}clone(){return new ze([...this.position],[...this.orientation])}}function vi(p,r){const u=os(p.projection,p.zoom,p.width,p.height),m=function(v,M,A,E,D){const I=new d.LngLat(A.lng-180*je,A.lat),R=new d.LngLat(A.lng+180*je,A.lat),V=v.project(I.lng,I.lat),Z=v.project(R.lng,R.lat),j=-Math.atan2(Z.y-V.y,Z.x-V.x),H=d.MercatorCoordinate.fromLngLat(A);H.y=d.clamp(H.y,-.999975,.999975);const q=H.toLngLat(),U=v.project(q.lng,q.lat),J=d.MercatorCoordinate.fromLngLat(q);J.x+=je;const $=J.toLngLat(),lt=v.project($.lng,$.lat),st=me(lt.x-U.x,lt.y-U.y,j),et=d.MercatorCoordinate.fromLngLat(q);et.y+=je;const at=et.toLngLat(),rt=v.project(at.lng,at.lat),dt=me(rt.x-U.x,rt.y-U.y,j),_t=Math.abs(st.x)/Math.abs(dt.y),Lt=d.identity([]);d.rotateZ(Lt,Lt,-j*(1-(D?0:E)));const mt=d.identity([]);return d.scale(mt,mt,[1,1-(1-_t)*E,1]),mt[4]=-dt.x/dt.y*E,d.rotateZ(mt,mt,j),d.multiply(mt,Lt,mt),mt}(p.projection,0,p.center,u,r),x=hl(p);return d.scale(m,m,[x,x,1]),m}function hl(p){const r=p.projection,u=os(p.projection,p.zoom,p.width,p.height),m=dl(r,p.center),x=dl(r,d.LngLat.convert(r.center));return Math.pow(2,m*u+(1-u)*x)}function os(p,r,u,m,x=1/0){const v=p.range;if(!v)return 0;const M=Math.min(x,Math.max(u,m)),A=Math.log(M/1024)/Math.LN2;return d.smoothstep(v[0]+A,v[1]+A,r)}const je=1/4e4;function dl(p,r){const u=d.clamp(r.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=new d.LngLat(r.lng-180*je,u),x=new d.LngLat(r.lng+180*je,u),v=p.project(m.lng,u),M=p.project(x.lng,u),A=d.MercatorCoordinate.fromLngLat(m),E=d.MercatorCoordinate.fromLngLat(x),D=M.x-v.x,I=M.y-v.y,R=E.x-A.x,V=E.y-A.y,Z=Math.sqrt((R*R+V*V)/(D*D+I*I));return Math.log(Z)/Math.LN2}function me(p,r,u){const m=Math.cos(u),x=Math.sin(u);return{x:p*m-r*x,y:p*x+r*m}}class Oi{constructor(r,u,m,x,v,M,A){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=r||0,this._maxZoom=u||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(M),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ul,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ze,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Oi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||u)&&this._updateCameraOnTerrain(),(r||u)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=d.getProjection(this.projectionOptions);const m=!zt(u,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=d.getProjection({name:"mercator"});const u=r!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const u=-r*Math.PI/180;var m,x,v,M,A,E,D,I,R,V;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(m=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),x=this.rotationMatrix,M=this.angle,A=(v=this.rotationMatrix)[0],E=v[1],D=v[2],I=v[3],R=Math.sin(M),V=Math.cos(M),x[0]=A*V+D*R,x[1]=E*V+I*R,x[2]=A*-R+D*V,x[3]=E*-R+I*V)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const u=d.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const u=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,v=0;for(let M=0;M<u.length;M++){const A=new d.pointGeometry(u[M][0]*this.width,m+u[M][1]*(this.height-m)),E=r.pointCoordinate(A);if(!E)continue;const D=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);x+=E[3]*D,v+=D}return 0===v?NaN:x/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,x=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),M=Math.max(x-m,v);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let m;m=r.z<this._camera.position[2]?[u.x,u.y,u.z]:[r.x,r.y,r.z];const x=d.length(d.sub([],this._camera.position,m));return d.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let u=!1;if(r.orientation&&!d.exactEquals(r.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(r.orientation)),r.position){const m=[r.position.x,r.position.y,r.position.z];d.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,u=new $t;return u.position=new d.MercatorCoordinate(r[0],r[1],r[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(r){if(!d.length$1(r))return!1;d.normalize$1(r,r);const u=d.transformQuat([],[0,0,-1],r),m=d.transformQuat([],[0,-1,0],r);if(m[2]<0)return!1;const x=Qs(u,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(r){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;r[2]=d.clamp(r[2],x/m,x/u),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,m){this._unmodified=!1,this._edgeInsets.interpolate(r,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const u=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(r){const u=[new d.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const m=this.pointCoordinate(new d.pointGeometry(0,0)),x=this.pointCoordinate(new d.pointGeometry(this.width,0)),v=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),M=this.pointCoordinate(new d.pointGeometry(0,this.height)),A=Math.floor(Math.min(m.x,x.x,v.x,M.x)),E=Math.floor(Math.max(m.x,x.x,v.x,M.x)),D=1;for(let I=A-D;I<=E+D;I++)0!==I&&u.push(new d.UnwrappedTileID(I,r))}return u}coveringTiles(r){let u=this.coveringZoomLevel(r);const m=u,x=this.elevation&&!r.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==r.minzoom&&u<r.minzoom)return[];void 0!==r.maxzoom&&u>r.maxzoom&&(u=r.maxzoom);const M=this.locationCoordinate(this.center),A=this.center.lat,E=1<<u,D=[E*M.x,E*M.y,0],I="globe"===this.projection.name,R=!I,V=d.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,R),Z=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=E*d.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),q=[E*Z.x,E*Z.y,H*(R?1:j)],U=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,$=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,lt=r.isTerrainDEM?-$:this._elevation?this._elevation.getMinElevationBelowMSL():0,st=this.projection.isReprojectedInTileSpace?hl(this):1,et=wt=>{const Tt=new d.MercatorCoordinate(wt.x+25e-6,wt.y,wt.z),qt=new d.MercatorCoordinate(wt.x,wt.y+25e-6,wt.z),Ut=wt.toLngLat(),Qt=Tt.toLngLat(),ne=qt.toLngLat(),le=this.locationCoordinate(Ut),Te=this.locationCoordinate(Qt),Kt=this.locationCoordinate(ne),fe=Math.hypot(Te.x-le.x,Te.y-le.y),Be=Math.hypot(Kt.x-le.x,Kt.y-le.y);return Math.sqrt(fe*Be)*st/25e-6},at=wt=>{const Rt=$,Tt=lt;return{aabb:d.tileAABB(this,E,0,0,0,wt,Tt,Rt,this.projection),zoom:0,x:0,y:0,minZ:Tt,maxZ:Rt,wrap:wt,fullyVisible:!1}},rt=[];let dt=[];const _t=u,Lt=r.reparseOverscaled?m:u,mt=wt=>wt*wt,At=mt((H-this._centerAltitude)*j),kt=wt=>{if(!this._elevation||!wt.tileID||!v)return;const Rt=this._elevation.getMinMaxForTile(wt.tileID),Tt=wt.aabb;Rt?(Tt.min[2]=Rt.min,Tt.max[2]=Rt.max,Tt.center[2]=(Tt.min[2]+Tt.max[2])/2):(wt.shouldSplit=Gt(wt),wt.shouldSplit||(Tt.min[2]=Tt.max[2]=Tt.center[2]=this._centerAltitude))},Gt=wt=>{if(wt.zoom<J)return!0;if(wt.zoom===_t)return!1;if(null!=wt.shouldSplit)return wt.shouldSplit;const Rt=wt.aabb.distanceX(q),Tt=wt.aabb.distanceY(q);let qt=At,Ut=1;if(I){qt=mt(wt.aabb.distanceZ(q));const ne=Math.pow(2,wt.zoom),le=d.latFromMercatorY((wt.y+1)/ne),Te=d.latFromMercatorY(wt.y/ne),Kt=Math.min(Math.max(A,le),Te),fe=d.circumferenceAtLatitude(Kt)/d.circumferenceAtLatitude(A);if(Ut=Kt===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,fe/this._mercatorScaleRatio),this.zoom<=d.GLOBE_ZOOM_THRESHOLD_MIN&&wt.zoom===_t-1&&fe>=.9)return!0}else if(x&&(qt=mt(wt.aabb.distanceZ(q)*j)),this.projection.isReprojectedInTileSpace&&m<=5){const ne=Math.pow(2,wt.zoom),le=et(new d.MercatorCoordinate((wt.x+.5)/ne,(wt.y+.5)/ne));Ut=le>.85?1:le}const Qt=Rt*Rt+Tt*Tt+qt;return Qt<mt((1<<_t-wt.zoom)*U*Ut*((ne,le)=>{if(le*mt(.707)<ne)return 1;const Te=Math.sqrt(le/ne);return Te/(1.4144271570014144+(Math.pow(1.1,Te-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(qt,At),Qt))};if(this.renderWorldCopies)for(let wt=1;wt<=3;wt++)rt.push(at(-wt)),rt.push(at(wt));for(rt.push(at(0));rt.length>0;){const wt=rt.pop(),Rt=wt.x,Tt=wt.y;let qt=wt.fullyVisible;if(!qt){const Ut=wt.aabb.intersects(V);if(0===Ut)continue;qt=2===Ut}if(wt.zoom!==_t&&Gt(wt))for(let Ut=0;Ut<4;Ut++){const Qt=(Rt<<1)+Ut%2,ne=(Tt<<1)+(Ut>>1),le={aabb:v?wt.aabb.quadrant(Ut):d.tileAABB(this,E,wt.zoom+1,Qt,ne,wt.wrap,wt.minZ,wt.maxZ,this.projection),zoom:wt.zoom+1,x:Qt,y:ne,wrap:wt.wrap,fullyVisible:qt,tileID:void 0,shouldSplit:void 0,minZ:wt.minZ,maxZ:wt.maxZ};x&&!I&&(le.tileID=new d.OverscaledTileID(wt.zoom+1===_t?Lt:wt.zoom+1,wt.wrap,wt.zoom+1,Qt,ne),kt(le)),rt.push(le)}else{const Ut=wt.zoom===_t?Lt:wt.zoom;if(r.minzoom&&r.minzoom>Ut)continue;const Qt=D[0]-(.5+Rt+(wt.wrap<<wt.zoom))*(1<<u-wt.zoom),ne=D[1]-.5-Tt,le=wt.tileID?wt.tileID:new d.OverscaledTileID(Ut,wt.wrap,wt.zoom,Rt,Tt);dt.push({tileID:le,distanceSq:Qt*Qt+ne*ne})}}if(this.fogCullDistSq){const wt=this.fogCullDistSq,Rt=this.horizonLineFromTop();dt=dt.filter(Tt=>{const qt=[0,0,0,1],Ut=[d.EXTENT,d.EXTENT,0,1],Qt=this.calculateFogTileMatrix(Tt.tileID.toUnwrapped());d.transformMat4$1(qt,qt,Qt),d.transformMat4$1(Ut,Ut,Qt);const ne=d.getAABBPointSquareDist(qt,Ut);if(0===ne)return!0;let le=!1;const Te=this._elevation;if(Te&&ne>wt&&0!==Rt){const Kt=this.calculateProjMatrix(Tt.tileID.toUnwrapped());let fe;r.isTerrainDEM||(fe=Te.getMinMaxForTile(Tt.tileID)),fe||(fe={min:lt,max:$});const Be=d.furthestTileCorner(this.rotation),ai=[Be[0]*d.EXTENT,Be[1]*d.EXTENT,fe.max];d.transformMat4(ai,ai,Kt),le=(1-ai[1])*this.height*.5<Rt}return ne<wt||le})}return dt.sort((wt,Rt)=>wt.distanceSq-Rt.distanceSq).map(wt=>wt.tileID)}resize(r,u){this.width=r,this.height=u,this.pixelsToGLUnits=[2/r,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const u=d.clamp(r.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=this.projection.project(r.lng,u);return new d.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,u){let m,x;const v=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;m=(u.x-v.x)/A,x=(u.y-v.y)/A}else{const A=this.pointCoordinate(u),E=this.pointCoordinate(v);m=A.x-E.x,x=A.y-E.y}const M=this.locationCoordinate(r);this.setLocation(new d.MercatorCoordinate(M.x-m,M.y-x))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,u){const m=u?d.mercatorZfromAltitude(u,r.lat):void 0,x=this.projection.project(r.lng,r.lat);return new d.MercatorCoordinate(x.x,x.y,m)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,u){const m=u??this._centerAltitude,x=[r.x,r.y,0,1],v=[r.x,r.y,1,1];d.transformMat4$1(x,x,this.pixelMatrixInverse),d.transformMat4$1(v,v,this.pixelMatrixInverse);const M=v[3];d.scale$1(x,x,1/x[3]),d.scale$1(v,v,1/M);const A=x[2],E=v[2];return{p0:x,p1:v,t:A===E?0:(m-A)/(E-A)}}screenPointToMercatorRay(r){const u=[r.x,r.y,0,1],m=[r.x,r.y,1,1];return d.transformMat4$1(u,u,this.pixelMatrixInverse),d.transformMat4$1(m,m,this.pixelMatrixInverse),d.scale$1(u,u,1/u[3]),d.scale$1(m,m,1/m[3]),u[2]=d.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,m[2]=d.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,d.scale$1(u,u,1/this.worldSize),d.scale$1(m,m,1/this.worldSize),new d.Ray([u[0],u[1],u[2]],d.normalize([],d.sub([],m,u)))}rayIntersectionCoordinate(r){const{p0:u,p1:m,t:x}=r,v=d.mercatorZfromAltitude(u[2],this._center.lat),M=d.mercatorZfromAltitude(m[2],this._center.lat);return new d.MercatorCoordinate(d.number(u[0],m[0],x)/this.worldSize,d.number(u[1],m[1],x)/this.worldSize,d.number(v,M,x))}pointCoordinate(r,u=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,u)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let u=this.projection.pointCoordinate3D(this,r.x,r.y);if(u)return new d.MercatorCoordinate(u[0],u[1],u[2]);let m=0,x=this.horizonLineFromTop();if(r.y>x)return this.pointCoordinate(r);const v=.02*x,M=r.clone();for(let A=0;A<10&&x-m>v;A++){M.y=d.number(m,x,.66);const E=this.projection.pointCoordinate3D(this,M.x,M.y);E?(x=M.y,u=E):m=M.y}return u?new d.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,x=[r.x*this.worldSize,r.y*this.worldSize,m+r.toAltitude(),1];return d.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new d.pointGeometry(x[0]/x[3],x[1]/x[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,u){const m=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),M=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(m,r),E=this.pointCoordinate(x,r);const D=this.pointCoordinate(v,u),I=this.pointCoordinate(M,u),R=(V,Z)=>(Z.y-V.y)/(Z.x-V.x);return A.y>1&&E.y>=0?A=new d.MercatorCoordinate((1-I.y)/R(I,A)+I.x,1):A.y<0&&E.y<=1&&(A=new d.MercatorCoordinate(-I.y/R(I,A)+I.x,0)),E.y>1&&A.y>=0?E=new d.MercatorCoordinate((1-D.y)/R(D,E)+D.x,1):E.y<0&&A.y<=1&&(E=new d.MercatorCoordinate(-D.y/R(D,E)+D.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(D))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const u=r.visibleDemTiles.reduce((m,x)=>{if(x.dem){const v=x.dem.tree;m.min=Math.min(m.min,v.minimums[0]),m.max=Math.max(m.max,v.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*r.exaggeration(),u.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return r?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,u){return this.projection.createTileMatrix(this,u,r)}calculateDistanceTileData(r){const u=r.key,m=this._distanceTileDataCache;if(m[u])return m[u];const x=r.canonical,v=1/this.height,M=this.cameraWorldSize/this.zoomScale(x.z),A=(x.x+Math.pow(2,x.z)*r.wrap)*M,E=x.y*M,D=this.point,I=this.angle,R=Math.sin(-I),V=-Math.cos(-I);return m[u]={bearing:[R,V],center:[(D.x-A)*v,(D.y-E)*v],scale:M/d.EXTENT*v},m[u]}calculateFogTileMatrix(r){const u=r.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const x=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return d.multiply(x,this.worldToFogMatrix,x),m[u]=new Float32Array(x),m[u]}calculateProjMatrix(r,u=!1){const m=r.key,x=u?this._alignedProjMatrixCache:this._projMatrixCache;if(x[m])return x[m];const v=this.calculatePosMatrix(r,this.worldSize);return d.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,v),x[m]=new Float32Array(v),x[m]}calculatePixelsToTileUnitsMatrix(r){const u=r.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const x=function(v,M){const{scale:A}=v.tileTransform,E=A*d.EXTENT/(v.tileSize*Math.pow(2,M.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return D=new Float32Array(4),V=(I=M.inverseAdjustmentMatrix)[1],Z=I[2],j=I[3],q=(R=[E,E])[1],D[0]=I[0]*(H=R[0]),D[1]=V*H,D[2]=Z*q,D[3]=j*q,D;var D,I,R,V,Z,j,H,q}(r,this);return m[u]=x,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const u=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),x=this._camera.forward(),v=d.mercatorZfromAltitude(1,this._center.lat);m[2]/=v,x[2]/=v,d.normalize(x,x);const M=r.raycast(m,x,r.exaggeration());if(M){const A=d.scaleAndAdd([],m,x,M),E=new d.MercatorCoordinate(A[0],A[1],d.mercatorZfromAltitude(A[2],d.latFromMercatorY(A[1]))),D=(E.z+d.length([E.x-m[0],E.y-m[1],E.z-m[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const u=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),x=r.getAtPointOrZero(new d.MercatorCoordinate(...m)),v=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),M=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(M<v){const A=this.locationCoordinate(this._center,this._centerAltitude),E=[A.x-m[0],A.y-m[1],A.z-m[2]],D=d.length(E);E[2]-=(v-M)/this._pixelsPerMercatorPixel;const I=d.length(E);if(0===I)return;d.scale$2(E,E,D/I*this._pixelsPerMercatorPixel),this._camera.position=[A.x-E[0],A.y-E[1],A.z*this._pixelsPerMercatorPixel-E[2]],this._camera.orientation=Qs(E,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const V=this.center;return V.lat=d.clamp(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(V.lng=d.clamp(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const u=this._unmodified,{x:m,y:x}=this.point;let v=0,M=m,A=x;const E=this.width/2,D=this.height/2,I=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(x-D<I&&(A=I+D),x+D>R&&(A=R-D),R-I<this.height&&(v=Math.max(v,this.height/(R-I)),A=(R+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,j=this.worldSize/2-(V+Z)/2;M=(m+j+this.worldSize)%this.worldSize-j,M-E<V&&(M=V+E),M+E>Z&&(M=Z-E),Z-V<this.width&&(v=Math.max(v,this.width/(Z-V)),M=(Z+V)/2)}M===m&&A===x||(this.center=this.unproject(new d.pointGeometry(M,A))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,u=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=d.mercatorZfromAltitude(1,this.center.lat)/d.mercatorZfromAltitude(1,d.GLOBE_SCALE_MATCH_LATITUDE));const m=os(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?u:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-r.x/this.width,v[9]=2*r.y/this.height;let M=d.mul([],v,x);if(this.projection.isReprojectedInTileSpace){const st=this.locationCoordinate(this.center),et=d.identity([]);d.translate(et,et,[st.x*this.worldSize,st.y*this.worldSize,0]),d.multiply(et,et,vi(this)),d.translate(et,et,[-st.x*this.worldSize,-st.y*this.worldSize,0]),d.multiply(M,M,et),this.inverseAdjustmentMatrix=function(at){const rt=vi(at,!0);return ro([],[rt[0],rt[1],rt[4],rt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale([],M,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=M,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const A=d.invert([],v);this.frustumCorners=d.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const E=new Float32Array(16);d.identity(E),d.scale(E,E,[1,-1,1]),d.rotateX(E,E,this._pitch),d.rotateZ(E,E,this.angle);const D=d.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),I=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-r.x/this.width,D[9]=2*(r.y+I)/this.height,this.skyboxMatrix=d.multiply(E,D,E);const R=this.point,V=R.x,Z=R.y,j=this.width%2/2,H=this.height%2/2,q=Math.cos(this.angle),U=Math.sin(this.angle),J=V-Math.round(V)+q*j+U*H,$=Z-Math.round(Z)+q*H+U*j,lt=new Float64Array(M);if(d.translate(lt,lt,[J>.5?J-1:J,$>.5?$-1:$,0]),this.alignedProjMatrix=lt,M=d.create(),d.scale(M,M,[this.width/2,-this.height/2,1]),d.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=d.create(),d.scale(M,M,[1,-1,1]),d.translate(M,M,[-1,-1,0]),d.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=d.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.calculateGlobeMatrix(this);const st=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.transformMat4(st,st,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,u=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,u];d.scale$2(v,v,x),d.scale$2(m,m,-1),d.multiply$2(m,m,v);const M=d.create();d.translate(M,M,m),d.scale(M,M,v),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,u,x)}_computeCameraPosition(r){const u=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-r/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*v,x.y/this.worldSize-m[1]*v,r/this.worldSize*this._centerAltitude-m[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=r[2];let x=1;m>0&&(x=Math.min((u-this._camera.position[2])/m,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,r,x),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),v=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),A=Math.max((r[2]-v)/Math.cos(m),M),E=this._zoomFromMercatorZ(A);d.scaleAndAdd(r,r,u,A),this._pitch=d.clamp(m,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(x,-Math.PI,Math.PI),this._setZoom(d.clamp(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,u){const m=Math.min(r.x,u.x),x=Math.max(r.x,u.x),v=Math.min(r.y,u.y),M=Math.max(r.y,u.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new d.pointGeometry(m,v),new d.pointGeometry(x,M),new d.pointGeometry(m,M),new d.pointGeometry(x,v)],E=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const I of A){const R=this.pointRayIntersection(I);if(R.t<0)return!0;const V=this.rayIntersectionCoordinate(R);if(V.x<E||V.y<0||V.x>D||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,u){const m=d.length(d.sub([],this._camera.position,r)),x=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const r=function(u,m){const x=[u[0],u[1],u[2],1];d.transformMat4$1(x,x,m);const v=Math.max(x[3],1e-6);return[x[0]/v,x[1]/v,x[2]/v,v]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,r))}}getCameraToCenterDistance(r){const u=os(r,this.zoom,this.width,this.height,1024),m=r.pixelSpaceConversion(this.center.lat,this.worldSize,u);return.5/Math.tan(.5*this._fov)*this.height*m}}function ta(p,r){let u=!1,m=null;const x=()=>{m=null,u&&(p(),m=setTimeout(x,r),u=!1)};return()=>(u=!0,m||x(),m)}class ea{constructor(r){this._hashName=r&&encodeURIComponent(r),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ta(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,d.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),d.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const u=Ci(r);if(this._hashName){const m=this._hashName;let x=!1;const v=d.window.location.hash.slice(1).split("&").map(M=>{const A=M.split("=")[0];return A===m?(x=!0,`${A}=${u}`):M}).filter(M=>M);return x||v.push(`${m}=${u}`),`#${v.join("&")}`}return`#${u}`}_getCurrentHash(){const r=d.window.location.hash.replace("#","");if(this._hashName){let u;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(m))){const m=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(u[3]||0):r.getBearing();return r.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,r)}}function Ci(p,r){const u=p.getCenter(),m=Math.round(100*p.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,x),M=Math.round(u.lng*v)/v,A=Math.round(u.lat*v)/v,E=p.getBearing(),D=p.getPitch();let I=r?`/${M}/${A}/${m}`:`${m}/${A}/${M}`;return(E||D)&&(I+="/"+Math.round(10*E)/10),D&&(I+=`/${Math.round(D)}`),I}const Gi={linearity:.3,easing:d.bezier(0,0,.3,1)},Yd=d.extend({deceleration:2500,maxSpeed:1400},Gi),ss=d.extend({deceleration:20,maxSpeed:1400},Gi),De=d.extend({deceleration:1e3,maxSpeed:360},Gi),pl=d.extend({deceleration:1e3,maxSpeed:90},Gi);class xc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,u=d.exported.now();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)u.zoom+=v.zoomDelta||0,u.bearing+=v.bearingDelta||0,u.pitch+=v.pitchDelta||0,v.panDelta&&u.pan._add(v.panDelta),v.around&&(u.around=v.around),v.pinchAround&&(u.pinchAround=v.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(u.pan.mag()){const v=ia(u.pan.mag(),m,d.extend({},Yd,r||{}));x.offset=u.pan.mult(v.amount/u.pan.mag()),x.center=this._map.transform.center,jr(x,v)}if(u.zoom){const v=ia(u.zoom,m,ss);x.zoom=this._map.transform.zoom+v.amount,jr(x,v)}if(u.bearing){const v=ia(u.bearing,m,De);x.bearing=this._map.transform.bearing+d.clamp(v.amount,-179,179),jr(x,v)}if(u.pitch){const v=ia(u.pitch,m,pl);x.pitch=this._map.transform.pitch+v.amount,jr(x,v)}if(x.zoom||x.bearing){const v=void 0===u.pinchAround?u.around:u.pinchAround;x.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function jr(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function ia(p,r,u){const{maxSpeed:m,linearity:x,deceleration:v}=u,M=d.clamp(p*x/(r/1e3),-m,m),A=Math.abs(M)/(v*x);return{easing:u.easing,duration:1e3*A,amount:M*(A/2)}}class Hi extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m,x={}){const v=ye(u.getCanvasContainer(),m),M=u.unproject(v);super(r,d.extend({point:v,lngLat:M,originalEvent:m},x)),this._defaultPrevented=!1,this.target=u}}class as extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m){const x="touchend"===r?m.changedTouches:m.touches,v=kn(u.getCanvasContainer(),x),M=v.map(E=>u.unproject(E)),A=v.reduce((E,D,I,R)=>E.add(D.div(R.length)),new d.pointGeometry(0,0));super(r,{points:v,point:A,lngLats:M,lngLat:u.unproject(A),originalEvent:m}),this._defaultPrevented=!1}}class Fu extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class Zh{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Fu(r.type,this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new Hi(r.type,this._map,r))}mouseup(r){this._map.fire(new Hi(r.type,this._map,r))}preclick(r){const u=d.extend({},r);u.type="preclick",this._map.fire(new Hi(u.type,this._map,u))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Hi(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Hi(r.type,this._map,r))}mouseover(r){this._map.fire(new Hi(r.type,this._map,r))}mouseout(r){this._map.fire(new Hi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new as(r.type,this._map,r))}touchmove(r){this._map.fire(new as(r.type,this._map,r))}touchend(r){this._map.fire(new as(r.type,this._map,r))}touchcancel(r){this._map.fire(new as(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ou{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Hi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Hi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lu{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&0===r.button&&(Oa(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;const m=u;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=m,this._box||(this._box=Se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(x.x,m.x),M=Math.max(x.x,m.x),A=Math.min(x.y,m.y),E=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${A}px)`,this._box.style.width=M-v+"px",this._box.style.height=E-A+"px")})}mouseupWindow(r,u){if(!this._active||0!==r.button)return;const m=this._startPos,x=u;if(this.reset(),No(),m.x!==x.x||m.y!==x.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Go(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new d.Event(r,{originalEvent:u}))}}function fl(p,r){const u={};for(let m=0;m<p.length;m++)u[p[m].identifier]=r[m];return u}class na{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const v=new d.pointGeometry(0,0);for(const M of x)v._add(M);return v.div(x.length)}(u),this.touches=fl(m,u)))}touchmove(r,u,m){if(this.aborted||!this.centroid)return;const x=fl(m,u);for(const v in this.touches){const M=this.touches[v],A=x[v];(!A||A.dist(M)>30)&&(this.aborted=!0)}}touchend(r,u,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class wo{constructor(r){this.singleTap=new na(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,u,m){this.singleTap.touchstart(r,u,m)}touchmove(r,u,m){this.singleTap.touchmove(r,u,m)}touchend(r,u,m){const x=this.singleTap.touchend(r,u,m);if(x){const v=r.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(x)<30;if(v&&M||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Pu{constructor(){this._zoomIn=new wo({numTouches:1,numTaps:2}),this._zoomOut=new wo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,m){this._zoomIn.touchstart(r,u,m),this._zoomOut.touchstart(r,u,m)}touchmove(r,u,m){this._zoomIn.touchmove(r,u,m),this._zoomOut.touchmove(r,u,m)}touchend(r,u,m){const x=this._zoomIn.touchend(r,u,m),v=this._zoomOut.touchend(r,u,m);return x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(x)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ru={0:1,2:2};class ls{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,u){return!1}_move(r,u){return{}}mousedown(r,u){if(this._lastPoint)return;const m=Fr(r);this._correctButton(r,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(r,u){const m=this._lastPoint;if(m)if(r.preventDefault(),null!=this._eventButton&&function(x,v){const M=Ru[v];return void 0===x.buttons||(x.buttons&M)!==M}(r,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}mouseupWindow(r){this._lastPoint&&Fr(r)===this._eventButton&&(this._moved&&No(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zu extends ls{mousedown(r,u){super.mousedown(r,u),this._lastPoint&&(this._active=!0)}_correctButton(r,u){return 0===u&&!r.ctrlKey}_move(r,u){return{around:u,panDelta:u.sub(r)}}}class Bu extends ls{_correctButton(r,u){return 0===u&&r.ctrlKey||2===u}_move(r,u){const m=.8*(u.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class Li extends ls{_correctButton(r,u){return 0===u&&r.ctrlKey||2===u}_move(r,u){const m=-.5*(u.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class $h{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(r,u,m){return this._calculateTransform(r,u,m)}touchmove(r,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!d.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,u,m)}}touchend(r,u,m){this._calculateTransform(r,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,m){m.length>0&&(this._active=!0);const x=fl(m,u),v=new d.pointGeometry(0,0),M=new d.pointGeometry(0,0);let A=0;for(const D in x){const I=x[D],R=this._touches[D];R&&(v._add(I),M._add(I.sub(R)),A++,x[D]=I)}if(this._touches=x,A<this._minTouches||!M.mag())return;const E=M.div(A);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ra{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,u,m){return{}}touchstart(r,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,m){const x=this._firstTwoTouches;if(!x)return;r.preventDefault();const[v,M]=x,A=ml(m,u,v),E=ml(m,u,M);if(!A||!E)return;const D=this._aroundCenter?null:A.add(E).div(2);return this._move([A,E],D,r)}touchend(r,u,m){if(!this._firstTwoTouches)return;const[x,v]=this._firstTwoTouches,M=ml(m,u,x),A=ml(m,u,v);M&&A||(this._active&&No(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ml(p,r,u){for(let m=0;m<p.length;m++)if(p[m].identifier===u)return r[m]}function Vu(p,r){return Math.log(p/r)/Math.LN2}class nr extends ra{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Vu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vu(this._distance,m),pinchAround:u}}}function gl(p,r){return 180*p.angleWith(r)/Math.PI}class Co extends ra{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:gl(this._vector,m),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const u=25/(Math.PI*this._minDiameter)*360,m=gl(r,this._startVector);return Math.abs(m)<u}}function Fn(p){return Math.abs(p.y)>Math.abs(p.x)}class _l extends ra{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Fn(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,m){const x=this._lastPoints;if(!x)return;const v=r[0].sub(x[0]),M=r[1].sub(x[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(v,M,m.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+M.y)/2*-.5})}gestureBeginsVertically(r,u,m){if(void 0!==this._valid)return this._valid;const x=r.mag()>=2,v=u.mag()>=2;if(!x&&!v)return;if(!x||!v)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const M=r.y>0==u.y>0;return Fn(r)&&Fn(u)&&M}}const Jt={panStep:100,bearingStep:15,pitchStep:10};class vc{constructor(){const r=Jt;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,m=0,x=0,v=0,M=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?x=1:(r.preventDefault(),M=-1);break;case 40:r.shiftKey?x=-1:(r.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:A=>{const E=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:bc,zoom:u?Math.round(E)+u*(r.shiftKey?2:1):E,bearing:A.getBearing()+m*this._bearingStep,pitch:A.getPitch()+x*this._pitchStep,offset:[-v*this._panStep,-M*this._panStep],center:A.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bc(p){return p*(2-p)}const oa=4.000244140625;class cs{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||d.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=r.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=d.exported.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==u&&u%oa==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(x*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=ye(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,u=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const E="wheel"===this._type&&Math.abs(this._delta)>oa?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&0!==D&&(D=1/D);const I=u(),R=Math.pow(2,I),V="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(V*D))),"wheel"===this._type&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:u(),x=this._startZoom,v=this._easing;let M,A=!1;if("wheel"===this._type&&x&&v){const E=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),D=v(E);M=d.number(x,m,D),E<1?this._frameId||(this._frameId=!0):A=!0}else M=m,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:M-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=d.ease;if(this._prevEase){const m=this._prevEase,x=(d.exported.now()-m.start)/m.duration,v=m.easing(x+.01)-m.easing(x),M=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-M*M);u=d.bezier(M,A,.25,1)}return this._prevEase={start:d.exported.now(),duration:r,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class wc{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,u){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pn{constructor(){this._tap=new wo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,u,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,u,m))}touchmove(r,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=u[0],v=x.y-this._swipePoint.y;return this._swipePoint=x,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,u,m)}touchend(r,u,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(r,u,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yh{constructor(r,u,m){this._el=r,this._mousePan=u,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mo{constructor(r,u,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class yl{constructor(r,u,m,x){this._el=r,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Hr=p=>p.zoom||p.drag||p.pitch||p.rotate;class xl extends d.Event{}class vl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,u){const m=d.sub([],u,r);this.radius=d.length(m[2]<0?d.div([],m,this.constants):[m[0],m[1],0])}projectRay(r){d.div(r,r,this.constants),d.normalize(r,r),d.mul$1(r,r,this.constants);const u=d.scale$2([],r,this.radius);if(u[2]>0){const m=d.scale$2([],[0,0,1],d.dot(u,[0,0,1])),x=d.scale$2([],d.normalize([],[u[0],u[1],0]),this.radius),v=d.add([],u,d.scale$2([],d.sub([],d.add([],x,m),u),2));u[0]=v[0],u[1]=v[1]}return u}}function qn(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Nu{constructor(r,u){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xc(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new vl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),d.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[x,v,M]of this._listeners)x.addEventListener(v,x===d.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[r,u,m]of this._listeners)r.removeEventListener(u,r===d.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new Zh(u,r));const x=u.boxZoom=new Lu(u,r);this._add("boxZoom",x);const v=new Pu,M=new Gu;u.doubleClickZoom=new wc(M,v),this._add("tapZoom",v),this._add("clickZoom",M);const A=new pn;this._add("tapDragZoom",A);const E=u.touchPitch=new _l(u);this._add("touchPitch",E);const D=new Bu(r),I=new Li(r);u.dragRotate=new Mo(r,D,I),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const R=new zu(r),V=new $h(u,r);u.dragPan=new Yh(m,R,V),this._add("mousePan",R),this._add("touchPan",V,["touchZoom","touchRotate"]);const Z=new Co,j=new nr;u.touchZoomRotate=new yl(m,j,Z,A),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ou(u));const H=u.scrollZoom=new cs(u,this);this._add("scrollZoom",H,["mousePan"]);const q=u.keyboard=new vc;this._add("keyboard",q);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[U]&&u[U].enable(r[U])}_add(r,u,m){this._handlers.push({handlerName:r,handler:u,allowed:m}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Hr(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,u,m){for(const x in r)if(x!==m&&(!u||u.indexOf(x)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const u=[];for(const m of r)this._el.contains(m.target)&&u.push(m);return u}handleEvent(r,u){this._updatingCamera=!0;const m="renderFrame"===r.type,x=m?void 0:r,v={needsRenderFrame:!1},M={},A={},E=r.touches?this._getMapTouches(r.touches):void 0,D=E?kn(this._el,E):m?void 0:ye(this._el,r);for(const{handlerName:V,handler:Z,allowed:j}of this._handlers){if(!Z.isEnabled())continue;let H;this._blockedByActive(A,j,V)?Z.reset():Z[u||r.type]&&(H=Z[u||r.type](r,D,E),this.mergeHandlerResult(v,M,H,V,x),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||Z.isActive())&&(A[V]=Z)}const I={};for(const V in this._previousActiveHandlers)A[V]||(I[V]=x);this._previousActiveHandlers=A,(Object.keys(I).length||qn(v))&&(this._changes.push([v,M,I]),this._triggerRenderFrame()),(Object.keys(A).length||qn(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=v;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(r,u,m,x,v){if(!m)return;d.extend(r,m);const M={handlerName:x,originalEvent:m.originalEvent||v};void 0!==m.zoomDelta&&(u.zoom=M),void 0!==m.panDelta&&(u.drag=M),void 0!==m.pitchDelta&&(u.pitch=M),void 0!==m.bearingDelta&&(u.rotate=M)}_applyChanges(){const r={},u={},m={};for(const[x,v,M]of this._changes)x.panDelta&&(r.panDelta=(r.panDelta||new d.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(r.around=x.around),void 0!==x.aroundCoord&&(r.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(r.pinchAround=x.pinchAround),x.noInertia&&(r.noInertia=x.noInertia),d.extend(u,v),d.extend(m,M);this._updateMapTransform(r,u,m),this._changes=[]}_updateMapTransform(r,u,m){const x=this._map,v=x.transform,M=J=>[J.x,J.y,J.z];if((J=>{const $=this._eventsInProgress.drag;return $&&!this._handlersById[$.handlerName].isActive()})()&&!qn(r)){const J=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",J!==v.zoom&&this._map._update(!0)}if(!qn(r))return void this._fireEvents(u,m,!0);let{panDelta:A,zoomDelta:E,bearingDelta:D,pitchDelta:I,around:R,aroundCoord:V,pinchAround:Z}=r;void 0!==Z&&(R=Z),(J=>u.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=M(v.pointCoordinate3D(R)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",x._stop(!0),R=R||x.transform.centerPoint,D&&(v.bearing+=D),I&&(v.pitch+=I),v._updateCameraState();const j=[0,0,0];if(A)if("mercator"===v.projection.name){const J=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(R).dir),$=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(R.sub(A)).dir);j[0]=$[0]-J[0],j[1]=$[1]-J[1]}else{const J=v.pointCoordinate(R);if("globe"===v.projection.name){A=A.rotate(-v.angle);const $=v._pixelsPerMercatorPixel/v.worldSize;j[0]=-A.x*d.mercatorScale(d.latFromMercatorY(J.y))*$,j[1]=-A.y*d.mercatorScale(v.center.lat)*$}else{const $=v.pointCoordinate(R.sub(A));J&&$&&(j[0]=$.x-J.x,j[1]=$.y-J.y)}}const H=v.zoom,q=[0,0,0];if(E){const J=M(V||v.pointCoordinate3D(R)),$={dir:d.normalize([],d.sub([],J,v._camera.position))};if($.dir[2]<0){const lt=v.zoomDeltaToMovement(J,E);d.scale$2(q,$.dir,lt)}}const U=d.add(j,j,q);v._translateCameraConstrained(U),E&&Math.abs(v.zoom-H)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,m,!0)}_fireEvents(r,u,m){const x=Hr(this._eventsInProgress),v=Hr(r),M={};for(const I in r){const{originalEvent:R}=r[I];this._eventsInProgress[I]||(M[`${I}start`]=R),this._eventsInProgress[I]=r[I]}!x&&v&&this._fireEvent("movestart",v.originalEvent);for(const I in M)this._fireEvent(I,M[I]);v&&this._fireEvent("move",v.originalEvent);for(const I in r){const{originalEvent:R}=r[I];this._fireEvent(I,R)}const A={};let E;for(const I in this._eventsInProgress){const{handlerName:R,originalEvent:V}=this._eventsInProgress[I];this._handlersById[R].isActive()||(delete this._eventsInProgress[I],E=u[R]||V,A[`${I}end`]=E)}for(const I in A)this._fireEvent(I,A[I]);const D=Hr(this._eventsInProgress);if(m&&(x||v)&&!D){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=V=>0!==V&&-this._bearingSnap<V&&V<this._bearingSnap;I?(R(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:E})):(this._map.fire(new d.Event("moveend",{originalEvent:E})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new d.Event(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new xl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Cc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Uu extends d.Evented{constructor(r,u){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=u.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}panBy(r,u,m){return r=d.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,d.extend({offset:r},u),m)}panTo(r,u,m){return this.easeTo(d.extend({center:r},u),m)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,m){return this.easeTo(d.extend({zoom:r},u),m)}zoomIn(r,u){return this.zoomTo(this.getZoom()+1,r,u),this}zoomOut(r,u){return this.zoomTo(this.getZoom()-1,r,u),this}getBearing(){return this.transform.bearing}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,m){return this.easeTo(d.extend({bearing:r},u),m)}resetNorth(r,u){return this.rotateTo(0,d.extend({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}cameraForBounds(r,u){"globe"===this.transform.projection.name&&d.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),r=d.LngLatBounds.convert(r);const m=u&&u.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),m,u)}_extendCameraOptions(r){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=d.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const m=r.padding;r.padding={top:m,bottom:m,right:m,left:m}}return r.padding=d.extend(u,r.padding),r}_cameraForBoxAndBearing(r,u,m,x){const v=this._extendCameraOptions(x),M=this.transform,A=M.padding,E=M.project(d.LngLat.convert(r)),D=M.project(d.LngLat.convert(u)),I=new d.pointGeometry(E.x,D.y),R=new d.pointGeometry(D.x,E.y),V=-d.degToRad(m),Z=E.rotate(V),j=D.rotate(V),H=I.rotate(V),q=R.rotate(V),U=new d.pointGeometry(Math.max(Z.x,j.x,H.x,q.x),Math.max(Z.y,j.y,H.y,q.y)),J=new d.pointGeometry(Math.min(Z.x,j.x,H.x,q.x),Math.min(Z.y,j.y,H.y,q.y)),$=U.sub(J),lt=(M.width-((A.left||0)+(A.right||0)+v.padding.left+v.padding.right))/$.x,st=(M.height-((A.top||0)+(A.bottom||0)+v.padding.top+v.padding.bottom))/$.y;if(st<0||lt<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const et=Math.min(M.scaleZoom(M.scale*Math.min(lt,st)),v.maxZoom),at="number"==typeof v.offset.x&&"number"==typeof v.offset.y?new d.pointGeometry(v.offset.x,v.offset.y):d.pointGeometry.convert(v.offset),rt=new d.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(m*Math.PI/180),dt=at.add(rt).mult(M.scale/M.zoomScale(et));return{center:M.unproject(E.add(D).div(2).sub(dt)),zoom:et,bearing:m}}_cameraForBox(r,u,m,x,v){const M=this._extendCameraOptions(v);m=m||0,x=x||0,r=d.LngLat.convert(r),u=d.LngLat.convert(u);const A=this.transform.clone();A.padding=M.padding;const E=this.getFreeCameraOptions(),D=new d.LngLat(.5*(r.lng+u.lng),.5*(r.lat+u.lat)),I=.5*(m+x);if(A._camera.position[2]<d.mercatorZfromAltitude(I,D.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");E.lookAtPoint(D),A.setFreeCameraOptions(E);const R=d.MercatorCoordinate.fromLngLat(r),V=d.MercatorCoordinate.fromLngLat(u),Z=A.pointRayIntersection(A.centerPoint,I),j=[(H=A.rayIntersectionCoordinate(Z)).x,H.y,H.z];var H;const q=A.screenPointToMercatorRay(A.centerPoint),U="globe"!==A.projection.name;let J,$=0;do{const lt=Math.floor(A.zoom),st=1<<lt,et=Math.min(st*R.x,st*V.x),at=Math.min(st*R.y,st*V.y),rt=Math.max(st*R.x,st*V.x),dt=Math.max(st*R.y,st*V.y),_t=new d.Aabb([et,at,m],[rt,dt,x]),Lt=d.Frustum.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,lt,U);if(2!==_t.intersects(Lt)){J&&(A._camera.position=d.scaleAndAdd([],A._camera.position,q.dir,-J),A._updateStateFromCamera());break}const mt=d.sub([],A._camera.position,j);J=.5*d.length(mt),A._camera.position=d.scaleAndAdd([],A._camera.position,q.dir,J);try{A._updateStateFromCamera()}catch{return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++$<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(r,u,m){return"globe"===this.transform.projection.name&&d.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(r,u),u,m)}_raycastElevationBox(r,u){const m=this.transform.elevation;if(!m)return;const x=new d.pointGeometry(r.x,u.y),v=new d.pointGeometry(u.x,r.y),M=m.pointCoordinate(r);if(!M)return;const A=m.pointCoordinate(u);if(!A)return;const E=m.pointCoordinate(x);if(!E)return;const D=m.pointCoordinate(v);if(!D)return;const I=new d.MercatorCoordinate(M[0],M[1]).toLngLat(),R=new d.MercatorCoordinate(A[0],A[1]).toLngLat(),V=new d.MercatorCoordinate(E[0],E[1]).toLngLat(),Z=new d.MercatorCoordinate(D[0],D[1]).toLngLat(),j=Math.min(I.lng,Math.min(R.lng,Math.min(V.lng,Z.lng))),H=Math.min(I.lat,Math.min(R.lat,Math.min(V.lat,Z.lat))),q=Math.max(I.lng,Math.max(R.lng,Math.max(V.lng,Z.lng))),U=Math.max(I.lat,Math.max(R.lat,Math.max(V.lat,Z.lat))),J=Math.min(M[3],Math.min(A[3],Math.min(E[3],D[3]))),$=Math.max(M[3],Math.max(A[3],Math.max(E[3],D[3])));return{minLngLat:new d.LngLat(j,H),maxLngLat:new d.LngLat(q,U),minAltitude:J,maxAltitude:$}}fitScreenCoordinates(r,u,m,x,v){let M,A,E,D;"globe"===this.transform.projection.name&&d.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const I=d.pointGeometry.convert(r),R=d.pointGeometry.convert(u),V=this._raycastElevationBox(I,R);if(V)M=V.minLngLat,A=V.maxLngLat,E=V.minAltitude,D=V.maxAltitude;else{if(this.transform.anyCornerOffEdge(I,R))return this;M=this.transform.pointLocation(I),A=this.transform.pointLocation(R)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(r)),this.transform.pointLocation(d.pointGeometry.convert(u)),m,x):this._cameraForBox(M,A,E,D,x),x,v)}_fitInternal(r,u,m){return r?(delete(u=d.extend(r,u)).padding,u.linear?this.easeTo(u,m):this.flyTo(u,m)):this}jumpTo(r,u){this.stop();const m=r.preloadOnly?this.transform.clone():this.transform;let x=!1,v=!1,M=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(x=!0,m.zoom=+r.zoom),void 0!==r.center&&(m.center=d.LngLat.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(v=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(M=!0,m.pitch=+r.pitch),null==r.padding||m.isPaddingEqual(r.padding)||(m.padding=r.padding),r.preloadOnly?(this._preloadTiles(m),this):(this.fire(new d.Event("movestart",u)).fire(new d.Event("move",u)),x&&this.fire(new d.Event("zoomstart",u)).fire(new d.Event("zoom",u)).fire(new d.Event("zoomend",u)),v&&this.fire(new d.Event("rotatestart",u)).fire(new d.Event("rotate",u)).fire(new d.Event("rotateend",u)),M&&this.fire(new d.Event("pitchstart",u)).fire(new d.Event("pitch",u)).fire(new d.Event("pitchend",u)),this.fire(new d.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.warnOnce(Cc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return d.warnOnce(Cc),this;this.stop();const x=m.zoom,v=m.pitch,M=m.bearing;m.setFreeCameraOptions(r);const A=x!==m.zoom,E=v!==m.pitch,D=M!==m.bearing;return this.fire(new d.Event("movestart",u)).fire(new d.Event("move",u)),A&&this.fire(new d.Event("zoomstart",u)).fire(new d.Event("zoom",u)).fire(new d.Event("zoomend",u)),D&&this.fire(new d.Event("rotatestart",u)).fire(new d.Event("rotate",u)).fire(new d.Event("rotateend",u)),E&&this.fire(new d.Event("pitchstart",u)).fire(new d.Event("pitch",u)).fire(new d.Event("pitchend",u)),this.fire(new d.Event("moveend",u)),this}easeTo(r,u){this._stop(!1,r.easeId),(!1===(r=d.extend({offset:[0,0],duration:500,easing:d.ease},r)).animate||!r.essential&&d.exported.prefersReducedMotion)&&(r.duration=0);const m=this.transform,x=this.getZoom(),v=this.getBearing(),M=this.getPitch(),A=this.getPadding(),E="zoom"in r?+r.zoom:x,D="bearing"in r?this._normalizeBearing(r.bearing,v):v,I="pitch"in r?+r.pitch:M,R="padding"in r?r.padding:m.padding,V=d.pointGeometry.convert(r.offset);let Z,j,H;if("globe"===m.projection.name){const dt=d.MercatorCoordinate.fromLngLat(m.center),_t=V.rotate(-m.angle);dt.x+=_t.x/m.worldSize,dt.y+=_t.y/m.worldSize;const Lt=dt.toLngLat(),mt=d.LngLat.convert(r.center||Lt);this._normalizeCenter(mt),Z=m.centerPoint.add(_t),j=new d.pointGeometry(dt.x,dt.y).mult(m.worldSize),H=new d.pointGeometry(d.mercatorXfromLng(mt.lng),d.mercatorYfromLat(mt.lat)).mult(m.worldSize).sub(j)}else{Z=m.centerPoint.add(V);const dt=m.pointLocation(Z),_t=d.LngLat.convert(r.center||dt);this._normalizeCenter(_t),j=m.project(dt),H=m.project(_t).sub(j)}const q=m.zoomScale(E-x);let U,J;r.around&&(U=d.LngLat.convert(r.around),J=m.locationPoint(U));const $=this._zooming||E!==x,lt=this._rotating||v!==D,st=this._pitching||I!==M,et=!m.isPaddingEqual(R),at=dt=>_t=>{if($&&(dt.zoom=d.number(x,E,_t)),lt&&(dt.bearing=d.number(v,D,_t)),st&&(dt.pitch=d.number(M,I,_t)),et&&(dt.interpolatePadding(A,R,_t),Z=dt.centerPoint.add(V)),U)dt.setLocationAtPoint(U,J);else{const Lt=dt.zoomScale(dt.zoom-x),mt=E>x?Math.min(2,q):Math.max(.5,q),At=Math.pow(mt,1-_t),kt=dt.unproject(j.add(H.mult(_t*At)).mult(Lt));dt.setLocationAtPoint(dt.renderWorldCopies?kt.wrap():kt,Z)}return r.preloadOnly||this._fireMoveEvents(u),dt};if(r.preloadOnly){const dt=this._emulate(at,r.duration,m);return this._preloadTiles(dt),this}const rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=$,this._rotating=lt,this._pitching=st,this._padding=et,this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,rt),this._ease(at(m),dt=>{m.recenterOnTerrain(),this._afterEase(u,dt)},r),this}_prepareEase(r,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||m.moving||this.fire(new d.Event("movestart",r)),this._zooming&&!m.zooming&&this.fire(new d.Event("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new d.Event("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new d.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new d.Event("move",r)),this._zooming&&this.fire(new d.Event("zoom",r)),this._rotating&&this.fire(new d.Event("rotate",r)),this._pitching&&this.fire(new d.Event("pitch",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new d.Event("zoomend",r)),x&&this.fire(new d.Event("rotateend",r)),v&&this.fire(new d.Event("pitchend",r)),this.fire(new d.Event("moveend",r))}flyTo(r,u){if(!r.essential&&d.exported.prefersReducedMotion){const qt=d.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qt,u)}this.stop(),r=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},r);const m=this.transform,x=this.getZoom(),v=this.getBearing(),M=this.getPitch(),A=this.getPadding(),E="zoom"in r?d.clamp(+r.zoom,m.minZoom,m.maxZoom):x,D="bearing"in r?this._normalizeBearing(r.bearing,v):v,I="pitch"in r?+r.pitch:M,R="padding"in r?r.padding:m.padding,V=m.zoomScale(E-x),Z=d.pointGeometry.convert(r.offset);let j=m.centerPoint.add(Z);const H=m.pointLocation(j),q=d.LngLat.convert(r.center||H);this._normalizeCenter(q);const U=m.project(H),J=m.project(q).sub(U);let $=r.curve;const lt=Math.max(m.width,m.height),st=lt/V,et=J.mag();if("minZoom"in r){const qt=d.clamp(Math.min(r.minZoom,x,E),m.minZoom,m.maxZoom),Ut=lt/m.zoomScale(qt-x);$=Math.sqrt(Ut/et*2)}const at=$*$;function rt(qt){const Ut=(st*st-lt*lt+(qt?-1:1)*at*at*et*et)/(2*(qt?st:lt)*at*et);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function dt(qt){return(Math.exp(qt)-Math.exp(-qt))/2}function _t(qt){return(Math.exp(qt)+Math.exp(-qt))/2}const Lt=rt(0);let mt=function(qt){return _t(Lt)/_t(Lt+$*qt)},At=function(qt){return lt*((_t(Lt)*(dt(Ut=Lt+$*qt)/_t(Ut))-dt(Lt))/at)/et;var Ut},kt=(rt(1)-Lt)/$;if(Math.abs(et)<1e-6||!isFinite(kt)){if(Math.abs(lt-st)<1e-6)return this.easeTo(r,u);const qt=st<lt?-1:1;kt=Math.abs(Math.log(st/lt))/$,At=function(){return 0},mt=function(Ut){return Math.exp(qt*$*Ut)}}r.duration="duration"in r?+r.duration:1e3*kt/("screenSpeed"in r?+r.screenSpeed/$:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Gt=v!==D,wt=I!==M,Rt=!m.isPaddingEqual(R),Tt=qt=>Ut=>{const Qt=Ut*kt,ne=1/mt(Qt);qt.zoom=1===Ut?E:x+qt.scaleZoom(ne),Gt&&(qt.bearing=d.number(v,D,Ut)),wt&&(qt.pitch=d.number(M,I,Ut)),Rt&&(qt.interpolatePadding(A,R,Ut),j=qt.centerPoint.add(Z));const le=1===Ut?q:qt.unproject(U.add(J.mult(At(Qt))).mult(ne));return qt.setLocationAtPoint(qt.renderWorldCopies?le.wrap():le,j),qt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(u),qt};if(r.preloadOnly){const qt=this._emulate(Tt,r.duration,m);return this._preloadTiles(qt),this}return this._zooming=!0,this._rotating=Gt,this._pitching=wt,this._padding=Rt,this._prepareEase(u,!1),this._ease(Tt(m),()=>this._afterEase(u),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,u,m){!1===m.animate||0===m.duration?(r(1),u()):(this._easeStart=d.exported.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,u){r=d.wrap(r,-180,180);const m=Math.abs(r-u);return Math.abs(r-360-u)<m&&(r-=360),Math.abs(r+360-u)<m&&(r+=360),r}_normalizeCenter(r){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const m=r.lng-u.center.lng;r.lng+=m>180?-360:m<-180?360:0}_emulate(r,u,m){const x=Math.ceil(15*u/1e3),v=[],M=r(m.clone());for(let A=0;A<=x;A++){const E=M(A/x);v.push(E.clone())}return v}}class Mc{constructor(r={}){this.options=r,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const u=this.options&&this.options.compact;return this._map=r,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Se("button","mapboxgl-ctrl-attrib-button",this._container),Se("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Se("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,u){const m=this._map._getUIString(`AttributionControl.${u}`);r.setAttribute("aria-label",m),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(r){const m=u.reduce((x,v,M)=>(v.value&&(x+=`${v.key}=${v.value}${M<u.length-1?"&":""}`),x),"?");r.href=`${d.config.FEEDBACK_URL}/${m}#${Ci(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const u=this._map.style._sourceCaches;for(const x in u){const v=u[x];if(v.used){const M=v.getSource();M.attribution&&r.indexOf(M.attribution)<0&&r.push(M.attribution)}}r.sort((x,v)=>x.length-v.length),r=r.filter((x,v)=>{for(let M=v+1;M<r.length;M++)if(r[M].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ju{constructor(){d.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Se("div","mapboxgl-ctrl");const u=Se("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const u in r){const m=r[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const u=r[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const x of m)if(x.id===r)return void(x.cancelled=!0)}run(r=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ao(p,r,u){if(p=new d.LngLat(p.lng,p.lat),r){const m=new d.LngLat(p.lng-360,p.lat),x=new d.LngLat(p.lng+360,p.lat),v=360*Math.ceil(Math.abs(p.lng-u.center.lng)/360),M=u.locationPoint(p).distSqr(r),A=r.x<0||r.y<0||r.x>u.width||r.y>u.height;u.locationPoint(m).distSqr(r)<M&&(A||Math.abs(m.lng-u.center.lng)<v)?p=m:u.locationPoint(x).distSqr(r)<M&&(A||Math.abs(x.lng-u.center.lng)<v)&&(p=x)}for(;Math.abs(p.lng-u.center.lng)>180;){const m=u.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}const sa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class aa extends d.Evented{constructor(r,u){if(super(),(r instanceof d.window.HTMLElement||u)&&(r=d.extend({element:r},u)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=d.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Se("div");const x=41,v=27,M=Ki("svg",{display:"block",height:x*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${x}`},this._element),A=Ki("radialGradient",{id:"shadowGradient"},Ki("defs",{},M));Ki("stop",{offset:"10%","stop-opacity":.4},A),Ki("stop",{offset:"100%","stop-opacity":.05},A),Ki("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Ki("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Ki("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Ki("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=d.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const m=this._element.classList;for(const x in sa)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=d.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const u=r.code,m=r.charCode||r.keyCode;"Space"!==u&&"Enter"!==u&&32!==m&&13!==m||this.togglePopup()}_onMapClick(r){const u=r.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map;if(!r)return!1;const u=r.unproject(this._pos),m=r.getFreeCameraOptions();if(!m.position)return!1;const x=m.position.toLngLat();return x.distanceTo(u)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const u=this._pos;if(!u||u.x<0||u.x>r.transform.width||u.y<0||u.y>r.transform.height)return void this._clearFadeTimer();const m=r.unproject(u);let x;r._showingGlobe()&&d.isLngLatBehindGlobe(r.transform,this._lngLat)?x=0:(x=1-r._queryFogOpacity(m),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(x*=.2)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${sa[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${u.x}px,${u.y}px)\n        `}_calculateXYTransform(){const r=this._pos,u=this._map,m=this.getPitchAlignment();if(!u||!r||"map"!==m)return"";if(!u._showingGlobe()){const E=u.getPitch();return E?`rotateX(${E}deg)`:""}const x=d.radToDeg(d.globeTiltAtLngLat(u.transform,this._lngLat)),v=r.sub(d.globeCenterToScreenPoint(u.transform)),M=Math.abs(v.x)+Math.abs(v.y);if(0===M)return"";const A=x/M;return`rotateX(${-v.y*A}deg) rotateY(${v.x*A}deg)`}_calculateZTransform(){const r=this._pos,u=this._map;if(!u||!r)return"";let m=0;const x=this.getRotationAlignment();if("map"===x)if(u._showingGlobe()){const v=u.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),M=u.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);m=d.radToDeg(Math.atan2(M.y,M.x))-90}else m=-u.getBearing();else if("horizon"===x){const v=d.smoothstep(4,6,u.getZoom()),M=d.globeCenterToScreenPoint(u.transform);M.y+=v*u.transform.height;const A=r.sub(M),E=d.radToDeg(Math.atan2(A.y,A.x));m=(E>90?E-270:E+90)*(1-v)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(r){d.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Ao(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===r?this._updateFrameId=d.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=d.pointGeometry.convert(r),this._update(),this}_onMove(r){const u=this._map;if(u){if(!this._isDragging){const m=this._clickTolerance||u._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(r){const u=this._map;u&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const u=this._map;return u&&(r?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Hu{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const u=d.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,u,m){this._start=this.getValue(u),this._end=r,this._startTime=u,this._endTime=u+m}}const qu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Wh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function la(p){p.parentNode&&p.parentNode.removeChild(p)}const Sc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ec{constructor(r,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Bu({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new Li({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(r,u){this.mouseRotate.mousedown(r,u),this.mousePitch&&this.mousePitch.mousedown(r,u),Oa()}move(r,u){const m=this.map,x=this.mouseRotate.mousemoveWindow(r,u),v=x&&x.bearingDelta;if(v&&m.setBearing(m.getBearing()+v),this.mousePitch){const M=this.mousePitch.mousemoveWindow(r,u),A=M&&M.pitchDelta;A&&m.setPitch(m.getPitch()+A)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Go(),d.window.removeEventListener("mousemove",this.mousemove),d.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(d.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),ye(this.element,r)),d.window.addEventListener("mousemove",this.mousemove),d.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,ye(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=kn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=kn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Zu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Tc={maxWidth:100,unit:"metric"};function kc(p,r,u){const m=So(r),x=m/r,v={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[u];this._map._requestDomTask(()=>{this._container.style.width=p*x+"px",this._container.innerHTML=`${m}&nbsp;${v}`})}function So(p){const r=Math.pow(10,`${Math.floor(p)}`.length-1);let u=p/r;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:function(m){const x=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*x)/x}(u),r*u}const Xh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Jh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ca(p=new d.pointGeometry(0,0),r="bottom"){if("number"==typeof p){const u=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new d.pointGeometry(0,p);case"top-left":return new d.pointGeometry(u,u);case"top-right":return new d.pointGeometry(-u,u);case"bottom":return new d.pointGeometry(0,-p);case"bottom-left":return new d.pointGeometry(u,-u);case"bottom-right":return new d.pointGeometry(-u,-u);case"left":return new d.pointGeometry(p,0);case"right":return new d.pointGeometry(-p,0)}return new d.pointGeometry(0,0)}return p instanceof d.pointGeometry||Array.isArray(p)?d.pointGeometry.convert(p):d.pointGeometry.convert(p[r]||[0,0])}const ua={version:d.version,supported:dr,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends Uu{constructor(p){if(null!=(p=d.extend({},Wh,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&d.isSafariWithAntialiasingBug(d.window)&&(p.antialias=!1,d.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Oi(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language="auto"===p.language?d.window.navigator.language:p.language,this._worldview=p.worldview,this._renderTaskQueue=new Ac,this._domRenderTaskQueue=new Ac,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},qu,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Hu(0),this._useExplicitProjection=!1,this._requestManager=new d.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=d.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof d.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&d.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Nu(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new ea("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new Mc({customAttribution:p.customAttribution})),this._logoControl=new ju,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new d.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new d.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(p,r){if(void 0===r&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[r];return-1!==r.indexOf("bottom")?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new d.Event("movestart",p)).fire(new d.Event("move",p)),this.fire(new d.Event("resize",p)),r&&this.fire(new d.Event("moveend",p)),this}getBounds(){return"globe"===this.transform.projection.name&&d.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(d.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getLanguage(){return this._language}setLanguage(p){if(this._language="auto"===p?d.window.navigator.language:p,this.style)for(const r in this.style._sourceCaches){const u=this.style._sourceCaches[r]._source;u._setLanguage&&u._setLanguage(this._language)}for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){if(this._worldview=p,this.style)for(const r in this.style._sourceCaches){const u=this.style._sourceCaches[r]._source;u._setWorldview&&u._setWorldview(p)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const p=this.transform,r=p.projection.name;let u;"globe"===r&&p.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),u=!0):"mercator"===r&&p.zoom<d.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;if(r="globe"===p.name&&this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0)}return this}project(p){return this.transform.locationPoint3D(d.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(d.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,r,u){if("mouseenter"===p||"mouseover"===p){let m=!1;const x=M=>{const A=r.filter(D=>this.getLayer(D)),E=A.length?this.queryRenderedFeatures(M.point,{layers:A}):[];E.length?m||(m=!0,u.call(this,new Hi(p,this,M.originalEvent,{features:E}))):m=!1},v=()=>{m=!1};return{layers:new Set(r),listener:u,delegates:{mousemove:x,mouseout:v}}}if("mouseleave"===p||"mouseout"===p){let m=!1;const x=M=>{const A=r.filter(E=>this.getLayer(E));(A.length?this.queryRenderedFeatures(M.point,{layers:A}):[]).length?m=!0:m&&(m=!1,u.call(this,new Hi(p,this,M.originalEvent)))},v=M=>{m&&(m=!1,u.call(this,new Hi(p,this,M.originalEvent)))};return{layers:new Set(r),listener:u,delegates:{mousemove:x,mouseout:v}}}{const m=x=>{const v=r.filter(A=>this.getLayer(A)),M=v.length?this.queryRenderedFeatures(x.point,{layers:v}):[];M.length&&(x.features=M,u.call(this,x),delete x.features)};return{layers:new Set(r),listener:u,delegates:{[p]:m}}}}on(p,r,u){if(void 0===u)return super.on(p,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(p,r,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(p,r,u){if(void 0===u)return super.once(p,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(p,r,u);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(p,r,u){if(void 0===u)return super.off(p,r);r=new Set(Array.isArray(r)?r:[r]);const m=(v,M)=>{if(v.size!==M.size)return!1;for(const A of v)if(!M.has(A))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[p]:void 0;return x&&(v=>{for(let M=0;M<v.length;M++){const A=v[M];if(A.listener===u&&m(A.layers,r)){for(const E in A.delegates)this.off(E,A.delegates[E]);return v.splice(M,1),this}}})(x),this}queryRenderedFeatures(p,r){return this.style?(void 0!==r||void 0===p||p instanceof d.pointGeometry||Array.isArray(p)||(r=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(p,r){return this.style.querySourceFeatures(p,r)}queryTerrainElevation(p,r){const u=this.transform.elevation;return u?(r=d.extend({},{exaggerated:!0},r),u.getAtPoint(d.MercatorCoordinate.fromLngLat(p),null,r.exaggerated)):null}setStyle(p,r){return!1!==(r=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(null==r)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new In(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new In(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,r){if("string"==typeof p){const u=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(u,d.ResourceType.Style);d.getJSON(m,(x,v)=>{x?this.fire(new d.ErrorEvent(x)):v&&this._updateDiff(v,r)})}else"object"==typeof p&&this._updateDiff(p,r)}_updateDiff(p,r){try{this.style.setState(p)&&this._update(!0)}catch(u){d.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(p,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.warnOnce("There is no style added to the map."),!1)}addSource(p,r){return this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const r in p){const u=p[r]._tiles;for(const m in u){const x=u[m];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(p,r,u){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,u)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,r,{pixelRatio:u=1,sdf:m=!1,stretchX:x,stretchY:v,content:M}={}){if(this._lazyInitEmptyStyle(),r instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&r instanceof d.window.ImageBitmap){const{width:A,height:E,data:D}=d.exported.getImageData(r);this.style.addImage(p,{data:new d.RGBAImage({width:A,height:E},D),pixelRatio:u,stretchX:x,stretchY:v,content:M,sdf:m,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:E}=r,D=r;this.style.addImage(p,{data:new d.RGBAImage({width:A,height:E},new Uint8Array(D.data)),pixelRatio:u,stretchX:x,stretchY:v,content:M,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,p)}}updateImage(p,r){const u=this.style.getImage(p);if(!u)return void this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&r instanceof d.window.ImageBitmap?d.exported.getImageData(r):r,{width:x,height:v}=m;void 0!==x&&void 0!==v?x===u.data.width&&v===u.data.height?(u.data.replace(m.data,!(r instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&r instanceof d.window.ImageBitmap)),this.style.updateImage(p,u)):this.fire(new d.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${v})\n                must be that same as the previous version of the image\n                (${u.data.width}, ${u.data.height})`))):this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,r){d.getImage(this._requestManager.transformRequest(p,d.ResourceType.Image),(u,m)=>{r(u,m instanceof d.window.HTMLImageElement?d.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(p,r){return this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)}moveLayer(p,r){return this.style.moveLayer(p,r),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,r,u){return this.style.setLayerZoomRange(p,r,u),this._update(!0)}setFilter(p,r,u={}){return this.style.setFilter(p,r,u),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,r,u,m={}){return this.style.setPaintProperty(p,r,u,m),this._update(!0)}getPaintProperty(p,r){return this.style.getPaintProperty(p,r)}setLayoutProperty(p,r,u,m={}){return this.style.setLayoutProperty(p,r,u,m),this._update(!0)}getLayoutProperty(p,r){return this.style.getLayoutProperty(p,r)}setLight(p,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(p),this.transform):0}setFeatureState(p,r){return this.style.setFeatureState(p,r),this._update()}removeFeatureState(p,r){return this.style.removeFeatureState(p,r),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let u,m,x,v=this._container;for(;v&&(!m||!x);){const M=d.window.getComputedStyle(v).transform;M&&"none"!==M&&(u=M.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(m=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(x=u[3])),v=v.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=x?Math.abs(r/x):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=Se("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Se("div","mapboxgl-canvas-container",p);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=Se("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Se("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=Se("div",`mapboxgl-ctrl-${x}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const u=d.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(p),this._canvas.height=u*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);-1!==r&&this._markers.splice(r,1)}_setupPainter(){const p=d.extend({},dr.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);r?(d.storeAuthState(r,!0),this.painter=new Du(r,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(r)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;const u=this.painter.context.extTimerQuery,m=d.exported.now();if(this.listens("gpu-timing-frame")&&(r=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let x=!1;const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,D=this.transform.pitch,I=d.exported.now();this.style.zoomHistory.update(E,I);const R=new d.EvaluationParameters(E,{now:I,fadeDuration:v,pitch:D,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),V=R.crossFadingFactor();1===V&&V===this._crossFadingFactor||(x=!0,this._crossFadingFactor=V),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):M=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const E=d.exported.now()-m;u.endQueryEXT(u.TIME_ELAPSED_EXT,r),setTimeout(()=>{const D=u.getQueryObjectEXT(r,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(r),this.fire(new d.Event("gpu-timing-frame",{cpuTime:E,gpuTime:D})),d.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:D}})},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(E);this.fire(new d.Event("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(E);this.fire(new d.Event("gpu-timing-deferred-render",{gpuTime:D}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(A||this._repaint)this.triggerRepaint();else{const E=!this.isMoving()&&this.loaded();if(E&&(M=this._updateAverageElevation(m,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,r=!1){const u=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const m=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const M=Math.abs(m-x);if(M>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(x),u(x);this._averageElevation.easeTo(x,p,300)}else if(M>1e-4)return this._averageElevation.jumpTo(x),u(x)}return!!this._averageElevation.isEasing(p)&&u(this._averageElevation.getValue(p))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===d.AUTH_ERR_MSG||401===p.status)){const r=this.painter.context.gl;d.storeAuthState(r,!1),this._logoControl instanceof ju&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function x(v){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,v,0);const M=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,M),M}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(x(p),r.canvasCopies.map(x),r.timeStamps)}_canvasPixelComparison(p,r,u){let m=u[1]-u[0];const x=p.length/4;for(let v=0;v<r.length;v++){const M=r[v];let A=0;for(let E=0;E<M.length;E+=4)M[E]===p[E]&&M[E+1]===p[E+1]&&M[E+2]===p[E+2]&&M[E+3]===p[E+3]&&(A+=1);m+=(u[v+2]-u[v+1])*(1-A/x)}return m}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),la(this._canvasContainer),la(this._controlContainer),la(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=d.exported.frame(r=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(r)}))}_preloadTiles(p){const r=this.style?Object.values(this.style._sourceCaches):[];return d.asyncAll(r,(u,m)=>u._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,r){d.setCacheLimits(p,r)}get version(){return d.version}},NavigationControl:class{constructor(p){this.options=d.extend({},Sc,p),this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:r}):u.resetNorth({},{originalEvent:r}))}),this._compassIcon=Se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),u=r===p.getMaxZoom(),m=r===p.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ec(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const u=Se("button",p,this._container);return u.type="button",u.addEventListener("click",r),u}_setButtonTitle(p,r){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",u),p.firstElementChild&&p.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends d.Evented{constructor(p){super(),this.options=d.extend({geolocation:d.window.navigator.geolocation},Zu,p),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ta(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(r=>{this._supportsGeolocation="denied"!==r.state,p(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,p(this._supportsGeolocation))}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),u=p.coords;return!!r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",p)),this._finish()}}_updateCamera(p){const r=new d.LngLat(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,m=this._map.getBearing(),x=d.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(u),x,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new d.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=d.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,u=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Se("button","mapboxgl-ctrl-geolocate",this._container),Se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Se("div","mapboxgl-user-location"),this._dotElement.appendChild(Se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new aa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new aa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientation),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mc,ScaleControl:class{constructor(p){this.options=d.extend({},Tc,p),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=kc.bind(this)),d.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,u=r._containerHeight/2,m=r._containerWidth/2-p/2,x=r.unproject([m,u]),v=r.unproject([m+p,u]),M=x.distanceTo(v);if("imperial"===this.options.unit){const A=3.2808*M;A>5280?this._setScale(p,A/5280,"mile"):this._setScale(p,A,"foot")}else"nautical"===this.options.unit?this._setScale(p,M/1852,"nautical-mile"):M>=1e3?this._setScale(p,M/1e3,"kilometer"):this._setScale(p,M,"meter")}_setScale(p,r,u){const m=So(r),x=m/r;this._map._requestDomTask(()=>{this._container.style.width=p*x+"px",this._container.innerHTML="nautical-mile"!==u?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:u}).format(m):`${m}&nbsp;nm`})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof d.window.HTMLElement?this._container=p.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=Se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Se("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(p){super(),this.options=d.extend(Object.create(Xh),p),d.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=d.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(d.window.document.createTextNode(p))}setHTML(p){const r=d.window.document.createDocumentFragment(),u=d.window.document.createElement("body");let m;for(u.innerHTML=p;m=u.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Se("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const u=this._closeButton=Se("button","mapboxgl-popup-close-button",r);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,u=this._container,m=this._pos;if(!r||!u||!m)return"bottom";const x=u.offsetWidth,v=u.offsetHeight,M=m.x<x/2,A=m.x>r.transform.width-x/2;if(m.y+p<v)return M?"top-left":A?"top-right":"top";if(m.y>r.transform.height-v){if(M)return"bottom-left";if(A)return"bottom-right"}return M?"left":A?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,u=this._content;if(!r||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=Se("div","mapboxgl-popup",r.getContainer()),this._tip=Se("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ao(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const x=this._pos=this._trackPointer&&p?p:r.project(this._lngLat),v=ca(this.options.offset),M=this._anchor=this._getAnchor(v.y),A=ca(this.options.offset,M),E=x.add(A).round();r._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${sa[M]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&r._showingGlobe()){const x=d.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Jh);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:aa,Style:In,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:$t,Evented:d.Evented,config:d.config,prewarm:function(){Ge().acquire(te)},clearPrewarmedResources:function(){const p=xe;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(te),xe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(p){d.config.ACCESS_TOKEN=p},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(p){d.config.API_URL=p},get workerCount(){return oe.workerCount},set workerCount(p){oe.workerCount=p},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){d.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){d.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return ua}),Nt}()}}]);