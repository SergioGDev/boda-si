(self.webpackChunkboda_si=self.webpackChunkboda_si||[]).push([[971],{4971:(jg,Sa,dt)=>{"use strict";dt.r(Sa),dt.d(Sa,{DashboardModule:()=>c0});var je=dt(6895),ur=dt(529),d=dt(4650),Be=(dt(5254),dt(6498)),hr=dt(6688),_i=dt(4850);dt(7830);let Wo=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({}),s})();const ql=new d.OlP("NgModelWithFormControlWarning");let Eh=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Wo]}),s})(),Xa=(()=>{class s{static withConfig(t){return{ngModule:s,providers:[{provide:ql,useValue:t.warnOnNgModelWithFormControl}]}}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Eh]}),s})();var at=dt(8929),Qo=dt(591),Nn=dt(6787),ci=dt(2198),mo=dt(2868);const Jl={provide:d.tb,useFactory:function pu(s,l){return()=>{if((0,je.NF)(l)){const t=Array.from(s.querySelectorAll(`[class*=${Ql}]`)),a=/\bflex-layout-.+?\b/g;t.forEach(_=>{_.classList.contains(`${Ql}ssr`)&&_.parentNode?_.parentNode.removeChild(_):_.className.replace(a,"")})}}},deps:[je.K0,d.Lbi],multi:!0},Ql="flex-layout-";let Hs=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({providers:[Jl]}),s})();class Rr{constructor(l=!1,t="all",a="",_="",M=0){this.matches=l,this.mediaQuery=t,this.mqAlias=a,this.suffix=_,this.priority=M,this.property=""}clone(){return new Rr(this.matches,this.mediaQuery,this.mqAlias,this.suffix)}}let Ja=(()=>{class s{constructor(){this.stylesheet=new Map}addStyleToElement(t,a,_){const M=this.stylesheet.get(t);M?M.set(a,_):this.stylesheet.set(t,new Map([[a,_]]))}clearStyles(){this.stylesheet.clear()}getStyleForElement(t,a){const _=this.stylesheet.get(t);let M="";if(_){const O=_.get(a);("number"==typeof O||"string"==typeof O)&&(M=O+"")}return M}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=(0,d.Yz7)({factory:function(){return new s},token:s,providedIn:"root"}),s})();const ec={addFlexToParent:!0,addOrientationBps:!1,disableDefaultBps:!1,disableVendorPrefixes:!1,serverLoaded:!1,useColumnBasisZero:!0,printWithBreakpoints:[],mediaTriggerAutoRestore:!0,ssrObserveBreakpoints:[]},dn=new d.OlP("Flex Layout token, config options for the library",{providedIn:"root",factory:()=>ec}),go=new d.OlP("FlexLayoutServerLoaded",{providedIn:"root",factory:()=>!1}),es=new d.OlP("Flex Layout token, collect all breakpoints into one provider",{providedIn:"root",factory:()=>null});function tc(s,l){return s=s?s.clone():new Rr,l&&(s.mqAlias=l.alias,s.mediaQuery=l.mediaQuery,s.suffix=l.suffix,s.priority=l.priority),s}const ts="inline",fu=["row","column","row-reverse","column-reverse"];function ic(s){if(s)switch(s.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":s="wrap-reverse";break;case"no":case"none":case"nowrap":s="nowrap";break;default:s="wrap"}return s}let ni=(()=>{class s{constructor(t,a,_,M){this.elementRef=t,this.styleBuilder=a,this.styler=_,this.marshal=M,this.DIRECTIVE_KEY="",this.inputs=[],this.mru={},this.destroySubject=new at.xQ,this.styleCache=new Map}get parentElement(){return this.elementRef.nativeElement.parentElement}get nativeElement(){return this.elementRef.nativeElement}get activatedValue(){return this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY)}set activatedValue(t){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,t,this.marshal.activatedAlias)}ngOnChanges(t){Object.keys(t).forEach(a=>{if(-1!==this.inputs.indexOf(a)){const _=a.split(".").slice(1).join(".");this.setValue(t[a].currentValue,_)}})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete(),this.marshal.releaseElement(this.nativeElement)}init(t=[]){this.marshal.init(this.elementRef.nativeElement,this.DIRECTIVE_KEY,this.updateWithValue.bind(this),this.clearStyles.bind(this),t)}addStyles(t,a){const _=this.styleBuilder,M=_.shouldCache;let O=this.styleCache.get(t);(!O||!M)&&(O=_.buildStyles(t,a),M&&this.styleCache.set(t,O)),this.mru=Object.assign({},O),this.applyStyleToElement(O),_.sideEffect(t,O,a)}clearStyles(){Object.keys(this.mru).forEach(t=>{this.mru[t]=""}),this.applyStyleToElement(this.mru),this.mru={}}triggerUpdate(){this.marshal.triggerUpdate(this.nativeElement,this.DIRECTIVE_KEY)}getFlexFlowDirection(t,a=!1){if(t){const[_,M]=this.styler.getFlowDirection(t);if(!M&&a){const O=function Qa(s){let[l,t,a]=function mu(s){s=s?s.toLowerCase():"";let[l,t,a]=s.split(" ");return fu.find(_=>_===l)||(l=fu[0]),t===ts&&(t=a!==ts?a:"",a=ts),[l,ic(t),!!a]}(s);return function nc(s,l=null,t=!1){return{display:t?"inline-flex":"flex","box-sizing":"border-box","flex-direction":s,"flex-wrap":l||null}}(l,t,a)}(_);this.styler.applyStyleToElements(O,[t])}return _.trim()}return"row"}hasWrap(t){return this.styler.hasWrap(t)}applyStyleToElement(t,a,_=this.nativeElement){this.styler.applyStyleToElement(_,t,a)}setValue(t,a){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,t,a)}updateWithValue(t){this.currentValue!==t&&(this.addStyles(t),this.currentValue=t)}}return s.\u0275fac=function(t){d.$Z()},s.\u0275dir=d.lG2({type:s,features:[d.TTD]}),s})();const Dh=[{alias:"xs",mediaQuery:"screen and (min-width: 0px) and (max-width: 599.98px)",priority:1e3},{alias:"sm",mediaQuery:"screen and (min-width: 600px) and (max-width: 959.98px)",priority:900},{alias:"md",mediaQuery:"screen and (min-width: 960px) and (max-width: 1279.98px)",priority:800},{alias:"lg",mediaQuery:"screen and (min-width: 1280px) and (max-width: 1919.98px)",priority:700},{alias:"xl",mediaQuery:"screen and (min-width: 1920px) and (max-width: 4999.98px)",priority:600},{alias:"lt-sm",overlapping:!0,mediaQuery:"screen and (max-width: 599.98px)",priority:950},{alias:"lt-md",overlapping:!0,mediaQuery:"screen and (max-width: 959.98px)",priority:850},{alias:"lt-lg",overlapping:!0,mediaQuery:"screen and (max-width: 1279.98px)",priority:750},{alias:"lt-xl",overlapping:!0,priority:650,mediaQuery:"screen and (max-width: 1919.98px)"},{alias:"gt-xs",overlapping:!0,mediaQuery:"screen and (min-width: 600px)",priority:-950},{alias:"gt-sm",overlapping:!0,mediaQuery:"screen and (min-width: 960px)",priority:-850},{alias:"gt-md",overlapping:!0,mediaQuery:"screen and (min-width: 1280px)",priority:-750},{alias:"gt-lg",overlapping:!0,mediaQuery:"screen and (min-width: 1920px)",priority:-650}],gu="(orientation: portrait) and (max-width: 599.98px)",_u="(orientation: landscape) and (max-width: 959.98px)",qs="(orientation: portrait) and (min-width: 600px) and (max-width: 839.98px)",rc="(orientation: landscape) and (min-width: 960px) and (max-width: 1279.98px)",oc="(orientation: portrait) and (min-width: 840px)",el="(orientation: landscape) and (min-width: 1280px)",Un={HANDSET:`${gu}, ${_u}`,TABLET:`${qs} , ${rc}`,WEB:`${oc}, ${el} `,HANDSET_PORTRAIT:`${gu}`,TABLET_PORTRAIT:`${qs} `,WEB_PORTRAIT:`${oc}`,HANDSET_LANDSCAPE:`${_u}`,TABLET_LANDSCAPE:`${rc}`,WEB_LANDSCAPE:`${el}`},yu=[{alias:"handset",priority:2e3,mediaQuery:Un.HANDSET},{alias:"handset.landscape",priority:2e3,mediaQuery:Un.HANDSET_LANDSCAPE},{alias:"handset.portrait",priority:2e3,mediaQuery:Un.HANDSET_PORTRAIT},{alias:"tablet",priority:2100,mediaQuery:Un.TABLET},{alias:"tablet.landscape",priority:2100,mediaQuery:Un.TABLET_LANDSCAPE},{alias:"tablet.portrait",priority:2100,mediaQuery:Un.TABLET_PORTRAIT},{alias:"web",priority:2200,mediaQuery:Un.WEB,overlapping:!0},{alias:"web.landscape",priority:2200,mediaQuery:Un.WEB_LANDSCAPE,overlapping:!0},{alias:"web.portrait",priority:2200,mediaQuery:Un.WEB_PORTRAIT,overlapping:!0}],ac=/(\.|-|_)/g;function tl(s){let l=s.length>0?s.charAt(0):"",t=s.length>1?s.slice(1):"";return l.toUpperCase()+t}function xu(s,l=[]){const t={};return s.forEach(a=>{t[a.alias]=a}),l.forEach(a=>{t[a.alias]?function sc(s,...l){if(null==s)throw TypeError("Cannot convert undefined or null to object");for(let t of l)if(null!=t)for(let a in t)t.hasOwnProperty(a)&&(s[a]=t[a])}(t[a.alias],a):t[a.alias]=a}),function $s(s){return s.forEach(l=>{l.suffix||(l.suffix=function br(s){return s.replace(ac,"|").split("|").map(tl).join("")}(l.alias),l.overlapping=!!l.overlapping)}),s}(Object.keys(t).map(a=>t[a]))}const _o=new d.OlP("Token (@angular/flex-layout) Breakpoints",{providedIn:"root",factory:()=>{const s=(0,d.f3M)(es),l=(0,d.f3M)(dn),t=[].concat.apply([],(s||[]).map(_=>Array.isArray(_)?_:[_]));return xu((l.disableDefaultBps?[]:Dh).concat(l.addOrientationBps?yu:[]),t)}});function Qn(s,l){return(l&&l.priority||0)-(s&&s.priority||0)}function vu(s,l){return(s.priority||0)-(l.priority||0)}let yo=(()=>{class s{constructor(t){this.findByMap=new Map,this.items=[...t].sort(vu)}findByAlias(t){return t?this.findWithPredicate(t,a=>a.alias==t):null}findByQuery(t){return this.findWithPredicate(t,a=>a.mediaQuery==t)}get overlappings(){return this.items.filter(t=>1==t.overlapping)}get aliases(){return this.items.map(t=>t.alias)}get suffixes(){return this.items.map(t=>t.suffix?t.suffix:"")}findWithPredicate(t,a){let _=this.findByMap.get(t);return _||(_=this.items.find(a)||null,this.findByMap.set(t,_)),_||null}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(_o))},s.\u0275prov=(0,d.Yz7)({factory:function(){return new s((0,d.LFG)(_o))},token:s,providedIn:"root"}),s})(),Rt=(()=>{class s{constructor(t,a,_){this._zone=t,this._platformId=a,this._document=_,this.source=new Qo.X(new Rr(!0)),this.registry=new Map,this.pendingRemoveListenerFns=[],this._observable$=this.source.asObservable()}get activations(){const t=[];return this.registry.forEach((a,_)=>{a.matches&&t.push(_)}),t}isActive(t){const a=this.registry.get(t);return a?a.matches:this.registerQuery(t).some(_=>_.matches)}observe(t,a=!1){if(t&&t.length){const _=this._observable$.pipe((0,ci.h)(O=>!a||t.indexOf(O.mediaQuery)>-1)),M=new Be.y(O=>{const q=this.registerQuery(t);if(q.length){const ce=q.pop();q.forEach(xe=>{O.next(xe)}),this.source.next(ce)}O.complete()});return(0,Nn.T)(M,_)}return this._observable$}registerQuery(t){const a=Array.isArray(t)?t:[t],_=[];return function bu(s,l){const t=s.filter(a=>!is[a]);if(t.length>0){const a=t.join(", ");try{const _=l.createElement("style");_.setAttribute("type","text/css"),_.styleSheet||_.appendChild(l.createTextNode(`\n/*\n  @angular/flex-layout - workaround for possible browser quirk with mediaQuery listeners\n  see http://bit.ly/2sd4HMP\n*/\n@media ${a} {.fx-query-test{ }}\n`)),l.head.appendChild(_),t.forEach(M=>is[M]=_)}catch(_){console.error(_)}}}(a,this._document),a.forEach(M=>{const O=ce=>{this._zone.run(()=>this.source.next(new Rr(ce.matches,M)))};let q=this.registry.get(M);q||(q=this.buildMQL(M),q.addListener(O),this.pendingRemoveListenerFns.push(()=>q.removeListener(O)),this.registry.set(M,q)),q.matches&&_.push(new Rr(!0,M))}),_}ngOnDestroy(){let t;for(;t=this.pendingRemoveListenerFns.pop();)t()}buildMQL(t){return function Zs(s,l){return l&&window.matchMedia("all").addListener?window.matchMedia(s):{matches:"all"===s||""===s,media:s,addListener:()=>{},removeListener:()=>{},onchange:null,addEventListener(){},removeEventListener(){},dispatchEvent:()=>!1}}(t,(0,je.NF)(this._platformId))}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(d.R0b),d.LFG(d.Lbi),d.LFG(je.K0))},s.\u0275prov=(0,d.Yz7)({factory:function(){return new s((0,d.LFG)(d.R0b),(0,d.LFG)(d.Lbi),(0,d.LFG)(je.K0))},token:s,providedIn:"root"}),s})();const is={},Pr="print",ns={alias:Pr,mediaQuery:Pr,priority:1e3};let il=(()=>{class s{constructor(t,a,_){this.breakpoints=t,this.layoutConfig=a,this._document=_,this.registeredBeforeAfterPrintHooks=!1,this.isPrintingBeforeAfterEvent=!1,this.beforePrintEventListeners=[],this.afterPrintEventListeners=[],this.isPrinting=!1,this.queue=new nl,this.deactivations=[]}withPrintQuery(t){return[...t,Pr]}isPrintEvent(t){return t.mediaQuery.startsWith(Pr)}get printAlias(){return this.layoutConfig.printWithBreakpoints||[]}get printBreakPoints(){return this.printAlias.map(t=>this.breakpoints.findByAlias(t)).filter(t=>null!==t)}getEventBreakpoints({mediaQuery:t}){const a=this.breakpoints.findByQuery(t);return(a?[...this.printBreakPoints,a]:this.printBreakPoints).sort(Qn)}updateEvent(t){let a=this.breakpoints.findByQuery(t.mediaQuery);return this.isPrintEvent(t)&&(a=this.getEventBreakpoints(t)[0],t.mediaQuery=a?a.mediaQuery:""),tc(t,a)}registerBeforeAfterPrintHooks(t){if(!this._document.defaultView||this.registeredBeforeAfterPrintHooks)return;this.registeredBeforeAfterPrintHooks=!0;const a=()=>{this.isPrinting||(this.isPrintingBeforeAfterEvent=!0,this.startPrinting(t,this.getEventBreakpoints(new Rr(!0,Pr))),t.updateStyles())},_=()=>{this.isPrintingBeforeAfterEvent=!1,this.isPrinting&&(this.stopPrinting(t),t.updateStyles())};this._document.defaultView.addEventListener("beforeprint",a),this._document.defaultView.addEventListener("afterprint",_),this.beforePrintEventListeners.push(a),this.afterPrintEventListeners.push(_)}interceptEvents(t){return this.registerBeforeAfterPrintHooks(t),a=>{this.isPrintEvent(a)?a.matches&&!this.isPrinting?(this.startPrinting(t,this.getEventBreakpoints(a)),t.updateStyles()):!a.matches&&this.isPrinting&&!this.isPrintingBeforeAfterEvent&&(this.stopPrinting(t),t.updateStyles()):this.collectActivations(a)}}blockPropagation(){return t=>!(this.isPrinting||this.isPrintEvent(t))}startPrinting(t,a){this.isPrinting=!0,t.activatedBreakpoints=this.queue.addPrintBreakpoints(a)}stopPrinting(t){t.activatedBreakpoints=this.deactivations,this.deactivations=[],this.queue.clear(),this.isPrinting=!1}collectActivations(t){if(!this.isPrinting||this.isPrintingBeforeAfterEvent)if(t.matches)this.isPrintingBeforeAfterEvent||(this.deactivations=[]);else{const a=this.breakpoints.findByQuery(t.mediaQuery);a&&(this.deactivations.push(a),this.deactivations.sort(Qn))}}ngOnDestroy(){this._document.defaultView&&(this.beforePrintEventListeners.forEach(t=>this._document.defaultView.removeEventListener("beforeprint",t)),this.afterPrintEventListeners.forEach(t=>this._document.defaultView.removeEventListener("afterprint",t)))}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(yo),d.LFG(dn),d.LFG(je.K0))},s.\u0275prov=(0,d.Yz7)({factory:function(){return new s((0,d.LFG)(yo),(0,d.LFG)(dn),(0,d.LFG)(je.K0))},token:s,providedIn:"root"}),s})();class nl{constructor(){this.printBreakpoints=[]}addPrintBreakpoints(l){return l.push(ns),l.sort(Qn),l.forEach(t=>this.addBreakpoint(t)),this.printBreakpoints}addBreakpoint(l){l&&void 0===this.printBreakpoints.find(a=>a.mediaQuery===l.mediaQuery)&&(this.printBreakpoints=function rs(s){return!!s&&s.mediaQuery.startsWith(Pr)}(l)?[l,...this.printBreakpoints]:[...this.printBreakpoints,l])}clear(){this.printBreakpoints=[]}}function Ye(s){for(let l in s){let t=s[l]||"";switch(l){case"display":s.display="flex"===t?["-webkit-flex","flex"]:"inline-flex"===t?["-webkit-inline-flex","inline-flex"]:t;break;case"align-items":case"align-self":case"align-content":case"flex":case"flex-basis":case"flex-flow":case"flex-grow":case"flex-shrink":case"flex-wrap":case"justify-content":s["-webkit-"+l]=t;break;case"flex-direction":t=t||"row",s["-webkit-flex-direction"]=t,s["flex-direction"]=t;break;case"order":s.order=s["-webkit-"+l]=isNaN(+t)?"0":t}}return s}let Pt=(()=>{class s{constructor(t,a,_,M){this._serverStylesheet=t,this._serverModuleLoaded=a,this._platformId=_,this.layoutConfig=M}applyStyleToElement(t,a,_=null){let M={};"string"==typeof a&&(M[a]=_,a=M),M=this.layoutConfig.disableVendorPrefixes?a:Ye(a),this._applyMultiValueStyleToElement(M,t)}applyStyleToElements(t,a=[]){const _=this.layoutConfig.disableVendorPrefixes?t:Ye(t);a.forEach(M=>{this._applyMultiValueStyleToElement(_,M)})}getFlowDirection(t){const a="flex-direction";let _=this.lookupStyle(t,a);return[_||"row",this.lookupInlineStyle(t,a)||(0,je.PM)(this._platformId)&&this._serverModuleLoaded?_:""]}hasWrap(t){return"wrap"===this.lookupStyle(t,"flex-wrap")}lookupAttributeValue(t,a){return t.getAttribute(a)||""}lookupInlineStyle(t,a){return(0,je.NF)(this._platformId)?t.style.getPropertyValue(a):this._getServerStyle(t,a)}lookupStyle(t,a,_=!1){let M="";return t&&((M=this.lookupInlineStyle(t,a))||((0,je.NF)(this._platformId)?_||(M=getComputedStyle(t).getPropertyValue(a)):this._serverModuleLoaded&&(M=this._serverStylesheet.getStyleForElement(t,a)))),M?M.trim():""}_applyMultiValueStyleToElement(t,a){Object.keys(t).sort().forEach(_=>{const M=t[_],O=Array.isArray(M)?M:[M];O.sort();for(let q of O)q=q?q+"":"",(0,je.NF)(this._platformId)||!this._serverModuleLoaded?(0,je.NF)(this._platformId)?a.style.setProperty(_,q):this._setServerStyle(a,_,q):this._serverStylesheet.addStyleToElement(a,_,q)})}_setServerStyle(t,a,_){a=a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();const M=this._readStyleAttribute(t);M[a]=_||"",this._writeStyleAttribute(t,M)}_getServerStyle(t,a){return this._readStyleAttribute(t)[a]||""}_readStyleAttribute(t){const a={},_=t.getAttribute("style");if(_){const M=_.split(/;+/g);for(let O=0;O<M.length;O++){const q=M[O].trim();if(q.length>0){const ce=q.indexOf(":");if(-1===ce)throw new Error(`Invalid CSS style: ${q}`);a[q.substr(0,ce).trim()]=q.substr(ce+1).trim()}}}return a}_writeStyleAttribute(t,a){let _="";for(const M in a)a[M]&&(_+=M+":"+a[M]+";");t.setAttribute("style",_)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(Ja),d.LFG(go),d.LFG(d.Lbi),d.LFG(dn))},s.\u0275prov=(0,d.Yz7)({factory:function(){return new s((0,d.LFG)(Ja),(0,d.LFG)(go),(0,d.LFG)(d.Lbi),(0,d.LFG)(dn))},token:s,providedIn:"root"}),s})();class vi{constructor(){this.shouldCache=!0}sideEffect(l,t,a){}}function ol(s,l="1",t="1"){let a=[l,t,s],_=s.indexOf("calc");if(_>0){a[2]=os(s.substring(_).trim());let M=s.substr(0,_).trim().split(" ");2==M.length&&(a[0]=M[0],a[1]=M[1])}else if(0==_)a[2]=os(s.trim());else{let M=s.split(" ");a=3===M.length?M:[l,t,s]}return a}function os(s){return s.replace(/[\s]/g,"").replace(/[\/\*\+\-]/g," $& ")}let Ht=(()=>{class s{constructor(t,a,_){this.matchMedia=t,this.breakpoints=a,this.hook=_,this.activatedBreakpoints=[],this.elementMap=new Map,this.elementKeyMap=new WeakMap,this.watcherMap=new WeakMap,this.updateMap=new WeakMap,this.clearMap=new WeakMap,this.subject=new at.xQ,this.observeActivations()}get activatedAlias(){return this.activatedBreakpoints[0]?this.activatedBreakpoints[0].alias:""}onMediaChange(t){const a=this.findByQuery(t.mediaQuery);a&&((t=tc(t,a)).matches&&-1===this.activatedBreakpoints.indexOf(a)?(this.activatedBreakpoints.push(a),this.activatedBreakpoints.sort(Qn),this.updateStyles()):!t.matches&&-1!==this.activatedBreakpoints.indexOf(a)&&(this.activatedBreakpoints.splice(this.activatedBreakpoints.indexOf(a),1),this.activatedBreakpoints.sort(Qn),this.updateStyles()))}init(t,a,_,M,O=[]){sl(this.updateMap,t,a,_),sl(this.clearMap,t,a,M),this.buildElementKeyMap(t,a),this.watchExtraTriggers(t,a,O)}getValue(t,a,_){const M=this.elementMap.get(t);if(M){const O=void 0!==_?M.get(_):this.getActivatedValues(M,a);if(O)return O.get(a)}}hasValue(t,a){const _=this.elementMap.get(t);if(_){const M=this.getActivatedValues(_,a);if(M)return void 0!==M.get(a)||!1}return!1}setValue(t,a,_,M){let O=this.elementMap.get(t);if(O){const ce=(O.get(M)||new Map).set(a,_);O.set(M,ce),this.elementMap.set(t,O)}else O=(new Map).set(M,(new Map).set(a,_)),this.elementMap.set(t,O);const q=this.getValue(t,a);void 0!==q&&this.updateElement(t,a,q)}trackValue(t,a){return this.subject.asObservable().pipe((0,ci.h)(_=>_.element===t&&_.key===a))}updateStyles(){this.elementMap.forEach((t,a)=>{const _=new Set(this.elementKeyMap.get(a));let M=this.getActivatedValues(t);M&&M.forEach((O,q)=>{this.updateElement(a,q,O),_.delete(q)}),_.forEach(O=>{if(M=this.getActivatedValues(t,O),M){const q=M.get(O);this.updateElement(a,O,q)}else this.clearElement(a,O)})})}clearElement(t,a){const _=this.clearMap.get(t);if(_){const M=_.get(a);M&&(M(),this.subject.next({element:t,key:a,value:""}))}}updateElement(t,a,_){const M=this.updateMap.get(t);if(M){const O=M.get(a);O&&(O(_),this.subject.next({element:t,key:a,value:_}))}}releaseElement(t){const a=this.watcherMap.get(t);a&&(a.forEach(M=>M.unsubscribe()),this.watcherMap.delete(t));const _=this.elementMap.get(t);_&&(_.forEach((M,O)=>_.delete(O)),this.elementMap.delete(t))}triggerUpdate(t,a){const _=this.elementMap.get(t);if(_){const M=this.getActivatedValues(_,a);M&&(a?this.updateElement(t,a,M.get(a)):M.forEach((O,q)=>this.updateElement(t,q,O)))}}buildElementKeyMap(t,a){let _=this.elementKeyMap.get(t);_||(_=new Set,this.elementKeyMap.set(t,_)),_.add(a)}watchExtraTriggers(t,a,_){if(_&&_.length){let M=this.watcherMap.get(t);if(M||(M=new Map,this.watcherMap.set(t,M)),!M.get(a)){const q=(0,Nn.T)(..._).subscribe(()=>{const ce=this.getValue(t,a);this.updateElement(t,a,ce)});M.set(a,q)}}}findByQuery(t){return this.breakpoints.findByQuery(t)}getActivatedValues(t,a){for(let M=0;M<this.activatedBreakpoints.length;M++){const q=t.get(this.activatedBreakpoints[M].alias);if(q&&(void 0===a||q.has(a)&&null!=q.get(a)))return q}const _=t.get("");return void 0===a||_&&_.has(a)?_:void 0}observeActivations(){const a=this.breakpoints.items.map(_=>_.mediaQuery);this.matchMedia.observe(this.hook.withPrintQuery(a)).pipe((0,mo.b)(this.hook.interceptEvents(this)),(0,ci.h)(this.hook.blockPropagation())).subscribe(this.onMediaChange.bind(this))}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(Rt),d.LFG(yo),d.LFG(il))},s.\u0275prov=(0,d.Yz7)({factory:function(){return new s((0,d.LFG)(Rt),(0,d.LFG)(yo),(0,d.LFG)(il))},token:s,providedIn:"root"}),s})();function sl(s,l,t,a){if(void 0!==a){let _=s.get(l);_||(_=new Map,s.set(l,_)),_.set(t,a)}}function lc(s){return Array.isArray(s)?s:[s]}function Ci(s){return null==s?"":"string"==typeof s?s:`${s}px`}function Ni(s){return s instanceof d.SBq?s.nativeElement:s}var ss=dt(1177);function Ft(s){return l=>l.lift(new al(s))}class al{constructor(l){this.notifier=l}call(l,t){const a=new cc(l),_=(0,ss.ft)(this.notifier,new ss.IY(a));return _&&!a.seenValue?(a.add(_),t.subscribe(a)):a}}class cc extends ss.Ds{constructor(l){super(l),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}var zr=dt(1481);let Su=(()=>{class s extends ni{constructor(t,a,_,M,O,q,ce){super(t,null,a,_),this.ngClassInstance=ce,this.DIRECTIVE_KEY="ngClass",this.ngClassInstance||(this.ngClassInstance=new je.mk(M,O,t,q)),this.init(),this.setValue("","")}set klass(t){this.ngClassInstance.klass=t,this.setValue(t,"")}updateWithValue(t){this.ngClassInstance.ngClass=t,this.ngClassInstance.ngDoCheck()}ngDoCheck(){this.ngClassInstance.ngDoCheck()}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(d.SBq),d.Y36(Pt),d.Y36(Ht),d.Y36(d.ZZ4),d.Y36(d.aQg),d.Y36(d.Qsj),d.Y36(je.mk,10))},s.\u0275dir=d.lG2({type:s,inputs:{klass:["class","klass"]},features:[d.qOj]}),s})();const ll=["ngClass","ngClass.xs","ngClass.sm","ngClass.md","ngClass.lg","ngClass.xl","ngClass.lt-sm","ngClass.lt-md","ngClass.lt-lg","ngClass.lt-xl","ngClass.gt-xs","ngClass.gt-sm","ngClass.gt-md","ngClass.gt-lg"];let ls=(()=>{class s extends Su{constructor(){super(...arguments),this.inputs=ll}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275dir=d.lG2({type:s,selectors:[["","ngClass",""],["","ngClass.xs",""],["","ngClass.sm",""],["","ngClass.md",""],["","ngClass.lg",""],["","ngClass.xl",""],["","ngClass.lt-sm",""],["","ngClass.lt-md",""],["","ngClass.lt-lg",""],["","ngClass.lt-xl",""],["","ngClass.gt-xs",""],["","ngClass.gt-sm",""],["","ngClass.gt-md",""],["","ngClass.gt-lg",""]],inputs:{ngClass:"ngClass","ngClass.xs":"ngClass.xs","ngClass.sm":"ngClass.sm","ngClass.md":"ngClass.md","ngClass.lg":"ngClass.lg","ngClass.xl":"ngClass.xl","ngClass.lt-sm":"ngClass.lt-sm","ngClass.lt-md":"ngClass.lt-md","ngClass.lt-lg":"ngClass.lt-lg","ngClass.lt-xl":"ngClass.lt-xl","ngClass.gt-xs":"ngClass.gt-xs","ngClass.gt-sm":"ngClass.gt-sm","ngClass.gt-md":"ngClass.gt-md","ngClass.gt-lg":"ngClass.gt-lg"},features:[d.qOj]}),s})(),Eu=(()=>{class s extends vi{buildStyles(t,a){return{display:"true"===t?a.display||(a.isServer?"initial":""):"none"}}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275prov=(0,d.Yz7)({factory:function(){return new s},token:s,providedIn:"root"}),s})(),Tu=(()=>{class s extends ni{constructor(t,a,_,M,O,q,ce){super(t,a,_,M),this.layoutConfig=O,this.platformId=q,this.serverModuleLoaded=ce,this.DIRECTIVE_KEY="show-hide",this.display="",this.hasLayout=!1,this.hasFlexChild=!1}ngAfterViewInit(){this.trackExtraTriggers();const t=Array.from(this.nativeElement.children);for(let _=0;_<t.length;_++)if(this.marshal.hasValue(t[_],"flex")){this.hasFlexChild=!0;break}cs.has(this.nativeElement)?this.display=cs.get(this.nativeElement):(this.display=this.getDisplayStyle(),cs.set(this.nativeElement,this.display)),this.init();const a=this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY,"");void 0===a||""===a?this.setValue(!0,""):this.triggerUpdate()}ngOnChanges(t){Object.keys(t).forEach(a=>{if(-1!==this.inputs.indexOf(a)){const _=a.split("."),M=_.slice(1).join("."),O=t[a].currentValue;let q=""===O||0!==O&&function ft(s){return null!=s&&"false"!=`${s}`}(O);"fxHide"===_[0]&&(q=!q),this.setValue(q,M)}})}trackExtraTriggers(){this.hasLayout=this.marshal.hasValue(this.nativeElement,"layout"),["layout","layout-align"].forEach(t=>{this.marshal.trackValue(this.nativeElement,t).pipe(Ft(this.destroySubject)).subscribe(this.triggerUpdate.bind(this))})}getDisplayStyle(){return this.hasLayout||this.hasFlexChild&&this.layoutConfig.addFlexToParent?"flex":this.styler.lookupStyle(this.nativeElement,"display",!0)}updateWithValue(t=!0){if(""===t)return;const a=(0,je.PM)(this.platformId);this.addStyles(t?"true":"false",{display:this.display,isServer:a}),a&&this.serverModuleLoaded&&this.nativeElement.style.setProperty("display",""),this.marshal.triggerUpdate(this.parentElement,"layout-gap")}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(d.SBq),d.Y36(Eu),d.Y36(Pt),d.Y36(Ht),d.Y36(dn),d.Y36(d.Lbi),d.Y36(go))},s.\u0275dir=d.lG2({type:s,features:[d.qOj,d.TTD]}),s})();const cs=new WeakMap,ku=["fxShow","fxShow.print","fxShow.xs","fxShow.sm","fxShow.md","fxShow.lg","fxShow.xl","fxShow.lt-sm","fxShow.lt-md","fxShow.lt-lg","fxShow.lt-xl","fxShow.gt-xs","fxShow.gt-sm","fxShow.gt-md","fxShow.gt-lg","fxHide","fxHide.print","fxHide.xs","fxHide.sm","fxHide.md","fxHide.lg","fxHide.xl","fxHide.lt-sm","fxHide.lt-md","fxHide.lt-lg","fxHide.lt-xl","fxHide.gt-xs","fxHide.gt-sm","fxHide.gt-md","fxHide.gt-lg"];let Pi=(()=>{class s extends Tu{constructor(){super(...arguments),this.inputs=ku}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275dir=d.lG2({type:s,selectors:[["","fxShow",""],["","fxShow.print",""],["","fxShow.xs",""],["","fxShow.sm",""],["","fxShow.md",""],["","fxShow.lg",""],["","fxShow.xl",""],["","fxShow.lt-sm",""],["","fxShow.lt-md",""],["","fxShow.lt-lg",""],["","fxShow.lt-xl",""],["","fxShow.gt-xs",""],["","fxShow.gt-sm",""],["","fxShow.gt-md",""],["","fxShow.gt-lg",""],["","fxHide",""],["","fxHide.print",""],["","fxHide.xs",""],["","fxHide.sm",""],["","fxHide.md",""],["","fxHide.lg",""],["","fxHide.xl",""],["","fxHide.lt-sm",""],["","fxHide.lt-md",""],["","fxHide.lt-lg",""],["","fxHide.lt-xl",""],["","fxHide.gt-xs",""],["","fxHide.gt-sm",""],["","fxHide.gt-md",""],["","fxHide.gt-lg",""]],inputs:{fxShow:"fxShow","fxShow.print":"fxShow.print","fxShow.xs":"fxShow.xs","fxShow.sm":"fxShow.sm","fxShow.md":"fxShow.md","fxShow.lg":"fxShow.lg","fxShow.xl":"fxShow.xl","fxShow.lt-sm":"fxShow.lt-sm","fxShow.lt-md":"fxShow.lt-md","fxShow.lt-lg":"fxShow.lt-lg","fxShow.lt-xl":"fxShow.lt-xl","fxShow.gt-xs":"fxShow.gt-xs","fxShow.gt-sm":"fxShow.gt-sm","fxShow.gt-md":"fxShow.gt-md","fxShow.gt-lg":"fxShow.gt-lg",fxHide:"fxHide","fxHide.print":"fxHide.print","fxHide.xs":"fxHide.xs","fxHide.sm":"fxHide.sm","fxHide.md":"fxHide.md","fxHide.lg":"fxHide.lg","fxHide.xl":"fxHide.xl","fxHide.lt-sm":"fxHide.lt-sm","fxHide.lt-md":"fxHide.lt-md","fxHide.lt-lg":"fxHide.lt-lg","fxHide.lt-xl":"fxHide.lt-xl","fxHide.gt-xs":"fxHide.gt-xs","fxHide.gt-sm":"fxHide.gt-sm","fxHide.gt-md":"fxHide.gt-md","fxHide.gt-lg":"fxHide.gt-lg"},features:[d.qOj]}),s})();class Oh{constructor(l,t,a=!0){this.key=l,this.value=t,this.key=a?l.replace(/['"]/g,"").trim():l.trim(),this.value=a?t.replace(/['"]/g,"").trim():t.trim(),this.value=this.value.replace(/;/,"")}}function ea(s){let l=typeof s;return"object"===l?s.constructor===Array?"array":s.constructor===Set?"set":"object":l}function ul(s){const[l,...t]=s.split(":");return new Oh(l,t.join(":"))}function vo(s,l){return l.key&&(s[l.key]=l.value),s}let Fn=(()=>{class s extends ni{constructor(t,a,_,M,O,q,ce,xe,He){super(t,null,a,_),this.sanitizer=M,this.ngStyleInstance=ce,this.DIRECTIVE_KEY="ngStyle",this.ngStyleInstance||(this.ngStyleInstance=new je.PC(t,O,q)),this.init();const ut=this.nativeElement.getAttribute("style")||"";this.fallbackStyles=this.buildStyleMap(ut),this.isServer=xe&&(0,je.PM)(He)}updateWithValue(t){const a=this.buildStyleMap(t);this.ngStyleInstance.ngStyle=Object.assign(Object.assign({},this.fallbackStyles),a),this.isServer&&this.applyStyleToElement(a),this.ngStyleInstance.ngDoCheck()}clearStyles(){this.ngStyleInstance.ngStyle=this.fallbackStyles,this.ngStyleInstance.ngDoCheck()}buildStyleMap(t){const a=_=>this.sanitizer.sanitize(d.q3G.STYLE,_)||"";if(t)switch(ea(t)){case"string":return hc(function cl(s,l=";"){return String(s).trim().split(l).map(t=>t.trim()).filter(t=>""!==t)}(t),a);case"array":return hc(t,a);default:return function er(s,l){let t=[];return"set"===ea(s)?s.forEach(a=>t.push(a)):Object.keys(s).forEach(a=>{t.push(`${a}:${s[a]}`)}),function Iu(s,l){return s.map(ul).filter(a=>!!a).map(a=>(l&&(a.value=l(a.value)),a)).reduce(vo,{})}(t,l)}(t,a)}return{}}ngDoCheck(){this.ngStyleInstance.ngDoCheck()}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(d.SBq),d.Y36(Pt),d.Y36(Ht),d.Y36(zr.H7),d.Y36(d.aQg),d.Y36(d.Qsj),d.Y36(je.PC,10),d.Y36(go),d.Y36(d.Lbi))},s.\u0275dir=d.lG2({type:s,features:[d.qOj]}),s})();const hl=["ngStyle","ngStyle.xs","ngStyle.sm","ngStyle.md","ngStyle.lg","ngStyle.xl","ngStyle.lt-sm","ngStyle.lt-md","ngStyle.lt-lg","ngStyle.lt-xl","ngStyle.gt-xs","ngStyle.gt-sm","ngStyle.gt-md","ngStyle.gt-lg"];let uc=(()=>{class s extends Fn{constructor(){super(...arguments),this.inputs=hl}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275dir=d.lG2({type:s,selectors:[["","ngStyle",""],["","ngStyle.xs",""],["","ngStyle.sm",""],["","ngStyle.md",""],["","ngStyle.lg",""],["","ngStyle.xl",""],["","ngStyle.lt-sm",""],["","ngStyle.lt-md",""],["","ngStyle.lt-lg",""],["","ngStyle.lt-xl",""],["","ngStyle.gt-xs",""],["","ngStyle.gt-sm",""],["","ngStyle.gt-md",""],["","ngStyle.gt-lg",""]],inputs:{ngStyle:"ngStyle","ngStyle.xs":"ngStyle.xs","ngStyle.sm":"ngStyle.sm","ngStyle.md":"ngStyle.md","ngStyle.lg":"ngStyle.lg","ngStyle.xl":"ngStyle.xl","ngStyle.lt-sm":"ngStyle.lt-sm","ngStyle.lt-md":"ngStyle.lt-md","ngStyle.lt-lg":"ngStyle.lt-lg","ngStyle.lt-xl":"ngStyle.lt-xl","ngStyle.gt-xs":"ngStyle.gt-xs","ngStyle.gt-sm":"ngStyle.gt-sm","ngStyle.gt-md":"ngStyle.gt-md","ngStyle.gt-lg":"ngStyle.gt-lg"},features:[d.qOj]}),s})();function hc(s,l){return s.map(ul).filter(a=>!!a).map(a=>(l&&(a.value=l(a.value)),a)).reduce(vo,{})}let us=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Hs]}),s})();const dc=new d.OlP("cdk-dir-doc",{providedIn:"root",factory:function Fu(){return(0,d.f3M)(je.K0)}});let pn=(()=>{class s{constructor(t){if(this.value="ltr",this.change=new d.vpe,t){const _=t.documentElement?t.documentElement.dir:null,M=(t.body?t.body.dir:null)||_;this.value="ltr"===M||"rtl"===M?M:"ltr"}}ngOnDestroy(){this.change.complete()}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(dc,8))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(dc,8))},token:s,providedIn:"root"}),s})(),bo=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({}),s})();const dl="inline",Br=["row","column","row-reverse","column-reverse"];function fl(s){s=s?s.toLowerCase():"";let[l,t,a]=s.split(" ");return Br.find(_=>_===l)||(l=Br[0]),t===dl&&(t=a!==dl?a:"",a=dl),[l,Ou(t),!!a]}function jn(s){let[l]=fl(s);return l.indexOf("row")>-1}function Ou(s){if(s)switch(s.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":s="wrap-reverse";break;case"no":case"none":case"nowrap":s="nowrap";break;default:s="wrap"}return s}let Lu=(()=>{class s extends vi{buildStyles(t){return function pl(s){let[l,t,a]=fl(s);return function pc(s,l=null,t=!1){return{display:t?"inline-flex":"flex","box-sizing":"border-box","flex-direction":s,"flex-wrap":l||null}}(l,t,a)}(t)}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275prov=(0,d.Yz7)({factory:function(){return new s},token:s,providedIn:"root"}),s})();const fc=["fxLayout","fxLayout.xs","fxLayout.sm","fxLayout.md","fxLayout.lg","fxLayout.xl","fxLayout.lt-sm","fxLayout.lt-md","fxLayout.lt-lg","fxLayout.lt-xl","fxLayout.gt-xs","fxLayout.gt-sm","fxLayout.gt-md","fxLayout.gt-lg"];let mc=(()=>{class s extends ni{constructor(t,a,_,M){super(t,_,a,M),this.DIRECTIVE_KEY="layout",this.styleCache=ia,this.init()}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(d.SBq),d.Y36(Pt),d.Y36(Lu),d.Y36(Ht))},s.\u0275dir=d.lG2({type:s,features:[d.qOj]}),s})(),hs=(()=>{class s extends mc{constructor(){super(...arguments),this.inputs=fc}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275dir=d.lG2({type:s,selectors:[["","fxLayout",""],["","fxLayout.xs",""],["","fxLayout.sm",""],["","fxLayout.md",""],["","fxLayout.lg",""],["","fxLayout.xl",""],["","fxLayout.lt-sm",""],["","fxLayout.lt-md",""],["","fxLayout.lt-lg",""],["","fxLayout.lt-xl",""],["","fxLayout.gt-xs",""],["","fxLayout.gt-sm",""],["","fxLayout.gt-md",""],["","fxLayout.gt-lg",""]],inputs:{fxLayout:"fxLayout","fxLayout.xs":"fxLayout.xs","fxLayout.sm":"fxLayout.sm","fxLayout.md":"fxLayout.md","fxLayout.lg":"fxLayout.lg","fxLayout.xl":"fxLayout.xl","fxLayout.lt-sm":"fxLayout.lt-sm","fxLayout.lt-md":"fxLayout.lt-md","fxLayout.lt-lg":"fxLayout.lt-lg","fxLayout.lt-xl":"fxLayout.lt-xl","fxLayout.gt-xs":"fxLayout.gt-xs","fxLayout.gt-sm":"fxLayout.gt-sm","fxLayout.gt-md":"fxLayout.gt-md","fxLayout.gt-lg":"fxLayout.gt-lg"},features:[d.qOj]}),s})();const ia=new Map;function p(s,...l){if(null==s)throw TypeError("Cannot convert undefined or null to object");for(let t of l)if(null!=t)for(let a in t)t.hasOwnProperty(a)&&(s[a]=t[a]);return s}let r=(()=>{class s extends vi{constructor(t){super(),this.layoutConfig=t}buildStyles(t,a){let[_,M,...O]=t.split(" "),q=O.join(" ");const ce=a.direction.indexOf("column")>-1?"column":"row",xe=jn(ce)?"max-width":"max-height",He=jn(ce)?"min-width":"min-height",ut=String(q).indexOf("calc")>-1,Ai=ut||"auto"===q,mn=String(q).indexOf("%")>-1&&!ut,Pn=String(q).indexOf("px")>-1||String(q).indexOf("rem")>-1||String(q).indexOf("em")>-1||String(q).indexOf("vw")>-1||String(q).indexOf("vh")>-1;let Qi=ut||Pn;_="0"==_?0:_,M="0"==M?0:M;const Aa=!_&&!M;let Fi={};const Ms={"max-width":null,"max-height":null,"min-width":null,"min-height":null};switch(q||""){case"":const Qr=!1!==this.layoutConfig.useColumnBasisZero;q="row"===ce?"0%":Qr?"0.000000001px":"auto";break;case"initial":case"nogrow":_=0,q="auto";break;case"grow":q="100%";break;case"noshrink":M=0,q="auto";break;case"auto":break;case"none":_=0,M=0,q="auto";break;default:!Qi&&!mn&&!isNaN(q)&&(q+="%"),"0%"===q&&(Qi=!0),"0px"===q&&(q="0%"),Fi=p(Ms,ut?{"flex-grow":_,"flex-shrink":M,"flex-basis":Qi?q:"100%"}:{flex:`${_} ${M} ${Qi?q:"100%"}`})}return Fi.flex||Fi["flex-grow"]||(Fi=p(Ms,ut?{"flex-grow":_,"flex-shrink":M,"flex-basis":q}:{flex:`${_} ${M} ${q}`})),"0%"!==q&&"0px"!==q&&"0.000000001px"!==q&&"auto"!==q&&(Fi[He]=Aa||Qi&&_?q:null,Fi[xe]=Aa||!Ai&&M?q:null),Fi[He]||Fi[xe]?a.hasWrap&&(Fi[ut?"flex-basis":"flex"]=Fi[xe]?ut?Fi[xe]:`${_} ${M} ${Fi[xe]}`:ut?Fi[He]:`${_} ${M} ${Fi[He]}`):Fi=p(Ms,ut?{"flex-grow":_,"flex-shrink":M,"flex-basis":q}:{flex:`${_} ${M} ${q}`}),p(Fi,{"box-sizing":"border-box"})}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(dn))},s.\u0275prov=(0,d.Yz7)({factory:function(){return new s((0,d.LFG)(dn))},token:s,providedIn:"root"}),s})();const c=["fxFlex","fxFlex.xs","fxFlex.sm","fxFlex.md","fxFlex.lg","fxFlex.xl","fxFlex.lt-sm","fxFlex.lt-md","fxFlex.lt-lg","fxFlex.lt-xl","fxFlex.gt-xs","fxFlex.gt-sm","fxFlex.gt-md","fxFlex.gt-lg"];let x=(()=>{class s extends ni{constructor(t,a,_,M,O){super(t,M,a,O),this.layoutConfig=_,this.marshal=O,this.DIRECTIVE_KEY="flex",this.direction=void 0,this.wrap=void 0,this.flexGrow="1",this.flexShrink="1",this.init()}get shrink(){return this.flexShrink}set shrink(t){this.flexShrink=t||"1",this.triggerReflow()}get grow(){return this.flexGrow}set grow(t){this.flexGrow=t||"1",this.triggerReflow()}ngOnInit(){this.parentElement&&(this.marshal.trackValue(this.parentElement,"layout").pipe(Ft(this.destroySubject)).subscribe(this.onLayoutChange.bind(this)),this.marshal.trackValue(this.nativeElement,"layout-align").pipe(Ft(this.destroySubject)).subscribe(this.triggerReflow.bind(this)))}onLayoutChange(t){const _=t.value.split(" ");this.direction=_[0],this.wrap=void 0!==_[1]&&"wrap"===_[1],this.triggerUpdate()}updateWithValue(t){void 0===this.direction&&(this.direction=this.getFlexFlowDirection(this.parentElement,!1!==this.layoutConfig.addFlexToParent)),void 0===this.wrap&&(this.wrap=this.hasWrap(this.parentElement));const _=this.direction,M=_.startsWith("row"),O=this.wrap;M&&O?this.styleCache=E:M&&!O?this.styleCache=C:!M&&O?this.styleCache=D:!M&&!O&&(this.styleCache=A);const ce=ol(String(t).replace(";",""),this.flexGrow,this.flexShrink);this.addStyles(ce.join(" "),{direction:_,hasWrap:O})}triggerReflow(){const t=this.activatedValue;if(void 0!==t){const a=ol(t+"",this.flexGrow,this.flexShrink);this.marshal.updateElement(this.nativeElement,this.DIRECTIVE_KEY,a.join(" "))}}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(d.SBq),d.Y36(Pt),d.Y36(dn),d.Y36(r),d.Y36(Ht))},s.\u0275dir=d.lG2({type:s,inputs:{shrink:["fxShrink","shrink"],grow:["fxGrow","grow"]},features:[d.qOj]}),s})(),v=(()=>{class s extends x{constructor(){super(...arguments),this.inputs=c}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275dir=d.lG2({type:s,selectors:[["","fxFlex",""],["","fxFlex.xs",""],["","fxFlex.sm",""],["","fxFlex.md",""],["","fxFlex.lg",""],["","fxFlex.xl",""],["","fxFlex.lt-sm",""],["","fxFlex.lt-md",""],["","fxFlex.lt-lg",""],["","fxFlex.lt-xl",""],["","fxFlex.gt-xs",""],["","fxFlex.gt-sm",""],["","fxFlex.gt-md",""],["","fxFlex.gt-lg",""]],inputs:{fxFlex:"fxFlex","fxFlex.xs":"fxFlex.xs","fxFlex.sm":"fxFlex.sm","fxFlex.md":"fxFlex.md","fxFlex.lg":"fxFlex.lg","fxFlex.xl":"fxFlex.xl","fxFlex.lt-sm":"fxFlex.lt-sm","fxFlex.lt-md":"fxFlex.lt-md","fxFlex.lt-lg":"fxFlex.lt-lg","fxFlex.lt-xl":"fxFlex.lt-xl","fxFlex.gt-xs":"fxFlex.gt-xs","fxFlex.gt-sm":"fxFlex.gt-sm","fxFlex.gt-md":"fxFlex.gt-md","fxFlex.gt-lg":"fxFlex.gt-lg"},features:[d.qOj]}),s})();const C=new Map,A=new Map,E=new Map,D=new Map;let $e=(()=>{class s extends vi{buildStyles(t,a){const _={},[M,O]=t.split(" ");switch(M){case"center":_["justify-content"]="center";break;case"space-around":_["justify-content"]="space-around";break;case"space-between":_["justify-content"]="space-between";break;case"space-evenly":_["justify-content"]="space-evenly";break;case"end":case"flex-end":_["justify-content"]="flex-end";break;default:_["justify-content"]="flex-start"}switch(O){case"start":case"flex-start":_["align-items"]=_["align-content"]="flex-start";break;case"center":_["align-items"]=_["align-content"]="center";break;case"end":case"flex-end":_["align-items"]=_["align-content"]="flex-end";break;case"space-between":_["align-content"]="space-between",_["align-items"]="stretch";break;case"space-around":_["align-content"]="space-around",_["align-items"]="stretch";break;case"baseline":_["align-content"]="stretch",_["align-items"]="baseline";break;default:_["align-items"]=_["align-content"]="stretch"}return p(_,{display:a.inline?"inline-flex":"flex","flex-direction":a.layout,"box-sizing":"border-box","max-width":"stretch"===O?jn(a.layout)?null:"100%":null,"max-height":"stretch"===O&&jn(a.layout)?"100%":null})}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275prov=(0,d.Yz7)({factory:function(){return new s},token:s,providedIn:"root"}),s})();const Ne=["fxLayoutAlign","fxLayoutAlign.xs","fxLayoutAlign.sm","fxLayoutAlign.md","fxLayoutAlign.lg","fxLayoutAlign.xl","fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg"];let nt=(()=>{class s extends ni{constructor(t,a,_,M){super(t,_,a,M),this.DIRECTIVE_KEY="layout-align",this.layout="row",this.inline=!1,this.init(),this.marshal.trackValue(this.nativeElement,"layout").pipe(Ft(this.destroySubject)).subscribe(this.onLayoutChange.bind(this))}updateWithValue(t){const a=this.layout||"row",_=this.inline;"row"===a&&_?this.styleCache=si:"row"!==a||_?"row-reverse"===a&&_?this.styleCache=Zt:"row-reverse"!==a||_?"column"===a&&_?this.styleCache=yi:"column"!==a||_?"column-reverse"===a&&_?this.styleCache=Ui:"column-reverse"===a&&!_&&(this.styleCache=zt):this.styleCache=Je:this.styleCache=pt:this.styleCache=Tt,this.addStyles(t,{layout:a,inline:_})}onLayoutChange(t){const a=t.value.split(" ");this.layout=a[0],this.inline=t.value.includes("inline"),Br.find(_=>_===this.layout)||(this.layout="row"),this.triggerUpdate()}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(d.SBq),d.Y36(Pt),d.Y36($e),d.Y36(Ht))},s.\u0275dir=d.lG2({type:s,features:[d.qOj]}),s})(),lt=(()=>{class s extends nt{constructor(){super(...arguments),this.inputs=Ne}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275dir=d.lG2({type:s,selectors:[["","fxLayoutAlign",""],["","fxLayoutAlign.xs",""],["","fxLayoutAlign.sm",""],["","fxLayoutAlign.md",""],["","fxLayoutAlign.lg",""],["","fxLayoutAlign.xl",""],["","fxLayoutAlign.lt-sm",""],["","fxLayoutAlign.lt-md",""],["","fxLayoutAlign.lt-lg",""],["","fxLayoutAlign.lt-xl",""],["","fxLayoutAlign.gt-xs",""],["","fxLayoutAlign.gt-sm",""],["","fxLayoutAlign.gt-md",""],["","fxLayoutAlign.gt-lg",""]],inputs:{fxLayoutAlign:"fxLayoutAlign","fxLayoutAlign.xs":"fxLayoutAlign.xs","fxLayoutAlign.sm":"fxLayoutAlign.sm","fxLayoutAlign.md":"fxLayoutAlign.md","fxLayoutAlign.lg":"fxLayoutAlign.lg","fxLayoutAlign.xl":"fxLayoutAlign.xl","fxLayoutAlign.lt-sm":"fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md":"fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg":"fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl":"fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs":"fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm":"fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md":"fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg":"fxLayoutAlign.gt-lg"},features:[d.qOj]}),s})();const Tt=new Map,Je=new Map,pt=new Map,zt=new Map,si=new Map,yi=new Map,Zt=new Map,Ui=new Map;let ir=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Hs,bo]}),s})(),yp=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Hs]}),s})(),vp=(()=>{class s{constructor(t,a){(0,je.PM)(a)&&!t&&console.warn("Warning: Flex Layout loaded on the server without FlexLayoutServerModule")}static withConfig(t,a=[]){return{ngModule:s,providers:t.serverLoaded?[{provide:dn,useValue:Object.assign(Object.assign({},ec),t)},{provide:es,useValue:a,multi:!0},{provide:go,useValue:!0}]:[{provide:dn,useValue:Object.assign(Object.assign({},ec),t)},{provide:es,useValue:a,multi:!0}]}}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(go),d.LFG(d.Lbi))},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[ir,us,yp,ir,us,yp]}),s})();var yl=dt(1400);let la=(()=>{class s{constructor(){}getOpcionesConfiguracion(){return[{text:"Ubicaciones",path:"/dashboard/ubicaciones",icono:"my_location"},{text:"Invitados",path:"/dashboard/distribucion-mesas",icono:"restaurant"}]}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();function bp(s,l){if(1&s){const t=d.EpF();d.TgZ(0,"li",7),d.NdJ("click",function(){d.CHM(t);const _=d.oxw();return d.KtG(_.comprimido=!_.comprimido)}),d.TgZ(1,"div",8)(2,"span",9),d._uU(3),d.qZA()(),d._UZ(4,"div",10),d.qZA()}if(2&s){const t=l.$implicit;d.Q6J("routerLink",t.path),d.xp6(3),d.hij(" ",t.text," ")}}const wp=function(s){return{abierto:s}},xl=function(s){return{comprimido:s}};let $u=(()=>{class s{constructor(t){this.enlacesService=t,this.enlaces=[],this.comprimido=!0}ngOnInit(){this.enlaces=this.enlacesService.getOpcionesConfiguracion()}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(la))},s.\u0275cmp=d.Xpm({type:s,selectors:[["app-menu-lateral"]],decls:9,vars:10,consts:[[1,"container"],[1,"boton-menu",3,"ngClass","click"],[1,"linea"],[1,"cortina",3,"ngClass"],[1,"sidebar",3,"ngClass"],["routerLinkActive","hovered",3,"routerLink","click",4,"ngFor","ngForOf"],[1,"content"],["routerLinkActive","hovered",3,"routerLink","click"],[1,"texto"],[1,"title"],[1,"tapa-title"]],template:function(t,a){1&t&&(d.TgZ(0,"div",0)(1,"div",1),d.NdJ("click",function(){return a.comprimido=!a.comprimido}),d._UZ(2,"div",2),d.qZA(),d._UZ(3,"div",3),d.TgZ(4,"div",4)(5,"ul"),d.YNc(6,bp,5,2,"li",5),d.qZA()(),d.TgZ(7,"div",6),d._UZ(8,"router-outlet"),d.qZA()()),2&t&&(d.xp6(1),d.Q6J("ngClass",d.VKq(4,wp,!a.comprimido)),d.xp6(2),d.Q6J("ngClass",d.VKq(6,wp,!a.comprimido)),d.xp6(1),d.Q6J("ngClass",d.VKq(8,xl,a.comprimido)),d.xp6(2),d.Q6J("ngForOf",a.enlaces))},dependencies:[je.mk,je.sg,yl.lC,yl.rH,yl.Od,ls],styles:['.sidebar[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;right:0;width:500px;background:var(--tono1);color:var(--tono6);box-shadow:-5px 0 10px 10px var(--tono1);font-family:Square Peg,cursive;transition:var(--tr-menu);transition-timing-function:ease;z-index:50}.sidebar.comprimido[_ngcontent-%COMP%]{width:0;box-shadow:-5px 0 10px 10px transparent;transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-timing-function:ease}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;margin-left:80px;padding:0}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:70px;font-size:38pt;color:var(--tono6);cursor:pointer;position:relative;text-shadow:1px 1px 3px var(--tono5);transition:.2s}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{padding-left:15px;text-shadow:-14px 1px 10px var(--tono5);transition:.2s;transition-property:padding-left,text-shadow}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child{margin-top:100px}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{z-index:5;opacity:1;transform:translateY(0);transition:var(--tr-texto-items);transition-delay:var(--trd-texto-items);transition-timing-function:ease;transition-property:opacity,transform}.sidebar.comprimido[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{z-index:5;opacity:0;font-size:0pt;transform:translateY(45px);transition:opacity var(--tr-texto-items) ease 0s,transform var(--tr-texto-items) ease 0s,font-size var(--tr-texto-items) ease var(--trd-texto-items)}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .tapa-title[_ngcontent-%COMP%]{width:100%;background:var(--tono1);height:0px;position:absolute;top:50px;z-index:10;transition:var(--tr-texto-items);transition-delay:var(--trd-texto-items);transition-timing-function:ease;transition-property:height}.sidebar.comprimido[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .tapa-title[_ngcontent-%COMP%]{width:100%;background:var(--tono1);height:100px;position:absolute;top:50px;z-index:10;transition:var(--tr-texto-items);transition-timing-function:ease;transition-property:height}.cortina[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;width:0px;z-index:1;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background-color:var(--tono5-transparente);transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-property:width;z-index:49}.cortina.abierto[_ngcontent-%COMP%]{width:100%;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);transition:var(--tr-menu);transition-property:width}.boton-menu[_ngcontent-%COMP%]{color:var(--tono1);padding:24px 20px 12px;width:26px;border-top-left-radius:30px;border-bottom-left-radius:30px;background-color:var(--tono3-transparente);cursor:pointer;position:fixed;right:0;top:calc(50% - 25px);transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-timing-function:ease;z-index:51}.boton-menu.abierto[_ngcontent-%COMP%]{transition:var(--tr-menu);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%], .boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after, .boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{display:block;width:100%;border-top:2px solid var(--tono1);margin:5px 0;transition:.4s;transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]{transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{content:"";position:relative;border-top:2px solid var(--tono1);bottom:15px;transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after{content:"";position:relative;border-top:2px solid var(--tono1);bottom:6px;transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{transform:rotate(45deg);bottom:6px;border-top:2px solid var(--tono6);transition:.4s;transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after{transform:rotate(-45deg);bottom:13px;border-top:2px solid var(--tono6);transition:.4s;transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]{border-top:2px solid transparent;transition:.4s;transition-timing-function:ease}.content[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;right:0;left:0}.container[_ngcontent-%COMP%]{height:100%}@media screen and (max-width: 599px){.sidebar[_ngcontent-%COMP%]{width:100%}}']}),s})();var ca=dt(7545),An=dt(4766);let ym=(()=>{class s{constructor(t){this.http=t,this.urlHeroes="api/heroe"}ngOnInit(){}obtenerListadoHeroes(){return this.http.get(`${An.N.backendUrl}/${this.urlHeroes}`)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(ur.eN))},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),Cp=(()=>{class s{constructor(t){this.http=t,this.urlMesa="api/mesa",this.urlMesas="api/mesas"}guardarMesa(t){return this.http.post(`${An.N.backendUrl}/${this.urlMesa}`,t)}guardarMesas(t){const a={headers:new ur.WM};return a.headers.append("Access-Control-Allow-Origin","*"),a.headers.append("Content-Type","application/json"),a.headers.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),this.http.post(`${An.N.backendUrl}/${this.urlMesa}`,t,a)}obtenerListadoMesas(){return this.http.get(`${An.N.backendUrl}/${this.urlMesa}`)}modificarMesa(t){return this.http.put(`${An.N.backendUrl}/${this.urlMesa}/${t._id}`,t)}eliminarMesa(t){return this.http.delete(`${An.N.backendUrl}/${this.urlMesa}/${t}`)}eliminarTodasLasMesas(){return this.http.delete(`${An.N.backendUrl}/${this.urlMesas}`)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(ur.eN))},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),Zu=(()=>{class s{constructor(t,a){this.http=t,this.mesasService=a,this.urlInvitado="api/invitado",this.urlInvitados="api/invitados",this.urlActualizarCategoria="api/actualizar-categoria"}obtenerListadoInvitados(){return this.http.get(`${An.N.backendUrl}/${this.urlInvitado}`)}guardarInvitado(t){return this.http.post(`${An.N.backendUrl}/${this.urlInvitado}`,t)}guardarInvitados(t){const a={headers:new ur.WM};return a.headers.append("Access-Control-Allow-Origin","*"),a.headers.append("Content-Type","application/json"),a.headers.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),this.http.post(`${An.N.backendUrl}/${this.urlInvitado}/`,t,a)}actualizarInvitado(t,a){return this.http.put(`${An.N.backendUrl}/${this.urlInvitado}/${a}`,t)}eliminarInvitado(t){return this.http.delete(`${An.N.backendUrl}/${this.urlInvitado}/${t}`)}eliminarTodosLosInvitados(){return this.mesasService.eliminarTodasLasMesas().pipe((0,ca.w)(()=>this.http.delete(`${An.N.backendUrl}/${this.urlInvitados}`)))}cambiarNombreCategoria(t,a){return this.http.post(`${An.N.backendUrl}/${this.urlActualizarCategoria}`,{nombreAntiguo:t,nombreNuevo:a})}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(ur.eN),d.LFG(Cp))},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),Cr=(()=>{class s{constructor(){this.vColocados=[],this.m=this.inicializarMapa()}inicializarMapa(){for(var a=[],_=0;_<20;_++){a[_]=[];for(var M=0;M<20;M++)a[_][M]={letra:" ",esHeroe:!1,coordenada:{x:_,y:M},orientaciones:[],color:{r:255,g:255,b:255}}}return this.m=a,this.vColocados=[],a}mostrarMapa(){let t="";t+="   - 0 - 1 - 2 - 3 - 4 - 5 - 6 - 7 - 8 - 9 - 0 - 11- 12- 13- 14- 20- 16- 17- 18- 19-\n",t+="   ---------------------------------------------------------------------------------\n";for(var a=0;a<this.m.length;a++){t+=a<10?`${a}  `:`${a} `;for(var _=0;_<this.m[a].length;_++)t+=`| ${this.m[a][_].letra?this.m[a][_].letra:" "} `;t+="|\n   ---------------------------------------------------------------------------------\n"}console.log(t)}getMapa(){return this.m}getVColocados(){return this.vColocados}rellenarHuecosVacios(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ";this.m.forEach(a=>{a.forEach(_=>{" "==_.letra&&(_.letra=t.charAt(this.getRandomInt(t.length)))})})}colocarNombre(t){var a=!1;return this.vColocados.forEach(_=>{if(!a&&_.prioridad===t.prioridad-1&&t.orientacion!==_.orientacion){const M=this.getCoincidencias(_,t);a=this.insertarNombreEnMapa(M,t)}}),a}colocarHeroe(t){const a={x:this.getRandomInt(20-t.texto.length),y:this.getRandomInt(5)+4};for(var _=a.x;_<a.x+t.texto.length;_++)this.m[_][a.y]=t.letras[_-a.x],t.letras[_-a.x].coordenada={x:_,y:a.y};this.vColocados.push(t)}getCoincidencias(t,a){let _=[];return t.letras.forEach(M=>{a.letras.forEach(O=>{M.letra===O.letra&&_.push({letra:M.letra,esHeroe:M.esHeroe||O.esHeroe,coordenada:M.coordenada,orientaciones:["V","H"],color:this.mezclarColores(t.color,a.color)})})}),_}insertarNombreEnMapa(t,a){let _=!1;return t.forEach(M=>{if(!_){var O=0,q=!1;do{a.letras[O].letra===M.letra?(q=!0,a.letras[O].coordenada=M.coordenada):O++}while(!q&&O<a.letras.length);if("V"===a.orientacion&&a.letras[O].coordenada.x-O>=0&&a.letras[O].coordenada.x-O+a.texto.length-1<20){const xe=a.letras[O].coordenada.x-O,He=xe+a.texto.length-1;console.log("Nombre:",a),console.log("i:",O,", xInicio:",xe,", xFin:",He);for(var ce=xe;ce<=He;ce++)a.letras[ce-xe].coordenada={x:ce,y:M.coordenada.y};if(this.puedoInsertarNombreEnMapa(a)){for(ce=xe;ce<=He;ce++)this.m[ce][M.coordenada.y]=ce===M.coordenada.x?M:a.letras[ce-xe];_=!0,this.vColocados.push(a)}}else if("H"===a.orientacion&&a.letras[O].coordenada.y-O>=0&&a.letras[O].coordenada.y-O+a.texto.length-1<20){const xe=a.letras[O].coordenada.y-O,He=xe+a.texto.length-1;for(ce=xe;ce<=He;ce++)a.letras[ce-xe].coordenada={x:M.coordenada.x,y:ce};if(this.puedoInsertarNombreEnMapa(a)){for(ce=xe;ce<=He;ce++)this.m[M.coordenada.x][ce]=ce===M.coordenada.y?M:a.letras[ce-xe];_=!0,this.vColocados.push(a)}}}}),_}obtenerNombre(t,a,_){const M={r:this.getRandomInt(256),g:this.getRandomInt(256),b:this.getRandomInt(256)},O=t.split("").map(q=>({letra:q.toUpperCase(),esHeroe:1===a,orientaciones:[_],color:M}));return{texto:t,prioridad:a,orientacion:_,letras:O,color:M}}puedoInsertarNombreEnMapa(t){const a=t.letras[0].coordenada,_=t.letras[t.texto.length-1].coordenada,M=t.orientacion,O="H"===M?a.y:a.x,q="H"===M?_.y:_.x;for(let ce=O;ce<=q;ce++){if("H"===M&&" "!==this.m[_.x][ce].letra&&this.m[_.x][ce].letra!=t.letras[ce-O].letra)return!1;if("V"===M&&" "!=this.m[ce][_.y].letra&&this.m[ce][_.y].letra!=t.letras[ce-O].letra)return!1}return!0}getMaximaPrioridadEnMapa(){let t=-1;return this.vColocados.forEach(a=>{t=a.prioridad>t?a.prioridad:t}),t}mezclarColores(t,a){return{r:(t.r+a.r)/2,g:(t.g+a.g)/2,b:(t.b+a.b)/2}}getRandomInt(t){return Math.floor(Math.random()*t)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();const Zh=function(s){return{"es-heroe":s}};function vl(s,l){if(1&s&&(d.TgZ(0,"div",5),d._uU(1),d.qZA()),2&s){const t=l.$implicit;d.Q6J("ngClass",d.VKq(2,Zh,t.esHeroe)),d.xp6(1),d.hij(" ",t.letra," ")}}function bc(s,l){if(1&s&&(d.TgZ(0,"div",3),d.YNc(1,vl,2,4,"div",4),d.qZA()),2&s){const t=l.$implicit;d.xp6(1),d.Q6J("ngForOf",t)}}function ha(s,l){if(1&s&&d._UZ(0,"div",6),2&s){const t=l.$implicit;d.Udp("top",30*t.letras[0].coordenada.x,"px")("left",30*t.letras[0].coordenada.y,"px")("width","V"===t.orientacion?30:30*t.letras.length,"px")("height","V"===t.orientacion?30*t.letras.length:30,"px")}}let Yh=(()=>{class s{constructor(t){this.sopaLetrasService=t,this.mapa=[],this.vColocados=[]}ngOnInit(){this.generarMapa()}generarMapa(){console.log("GENERAR MAPA"),this.sopaLetrasService.inicializarMapa();const t=this.sopaLetrasService.obtenerNombre(this.heroeSt,1,"V");this.sopaLetrasService.colocarHeroe(t);var a=2,_="H",M=0;do{this.vNombres.forEach(O=>{var q=this.sopaLetrasService.obtenerNombre(O,a,_);this.sopaLetrasService.colocarNombre(q)&&this.vNombres.splice(this.vNombres.indexOf(O),1)}),_="H"===_?"V":"H",a++,M++}while(this.vNombres.length>0&&M<30);this.sopaLetrasService.rellenarHuecosVacios(),this.mapa=this.sopaLetrasService.getMapa(),this.vColocados=this.sopaLetrasService.getVColocados(),this.vColocados.splice(this.vColocados.indexOf(t),1)}getColorString(t){return`rgba(${t.r}, ${t.g}, ${t.b}, 0.7)`}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(Cr))},s.\u0275cmp=d.Xpm({type:s,selectors:[["app-sopa-letras"]],inputs:{heroeSt:"heroeSt",vNombres:"vNombres"},decls:3,vars:2,consts:[[1,"container"],["class","fila","fxLayout","row",4,"ngFor","ngForOf"],["class","linea",3,"top","left","width","height",4,"ngFor","ngForOf"],["fxLayout","row",1,"fila"],["class","celda",3,"ngClass",4,"ngFor","ngForOf"],[1,"celda",3,"ngClass"],[1,"linea"]],template:function(t,a){1&t&&(d.TgZ(0,"div",0),d.YNc(1,bc,2,1,"div",1),d.YNc(2,ha,1,8,"div",2),d.qZA()),2&t&&(d.xp6(1),d.Q6J("ngForOf",a.mapa),d.xp6(1),d.Q6J("ngForOf",a.vColocados))},dependencies:[je.mk,je.sg,hs,ls],styles:[".celda[_ngcontent-%COMP%]{height:25px;width:30px;text-align:center;font-size:11pt;padding-top:5px;font-family:CustomFont,sans-serif}.es-heroe[_ngcontent-%COMP%]{background-color:#5e0000!important;color:#fff!important}.linea[_ngcontent-%COMP%]{position:absolute;border:2px solid red;border-radius:50%;box-shadow:1px 2px 3px #00000080}@font-face{font-family:CustomFont;src:url(GoboldRegular.b1cb2a30e235b7b0.otf);font-weight:400}"]}),s})(),Yu=(()=>{class s{constructor(){}ngOnInit(){}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=d.Xpm({type:s,selectors:[["app-spinner-carga"]],decls:1,vars:0,consts:[[1,"lds-hourglass"]],template:function(t,a){1&t&&d._UZ(0,"div",0)},styles:['.lds-hourglass[_ngcontent-%COMP%]{display:inline-block;position:relative;width:80px;height:80px}.lds-hourglass[_ngcontent-%COMP%]:after{content:" ";display:block;border-radius:50%;width:0;height:0;margin:8px;box-sizing:border-box;border:32px solid #fff;border-color:#fff transparent #fff transparent;animation:lds-hourglass 1.2s infinite}@keyframes lds-hourglass{0%{transform:rotate(0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}50%{transform:rotate(900deg);animation-timing-function:cubic-bezier(.215,.61,.355,1)}to{transform:rotate(1800deg)}}']}),s})();const Mp=["sopaDeLetras"];function Ap(s,l){1&s&&(d.TgZ(0,"div",9),d._UZ(1,"app-spinner-carga"),d.qZA())}function xm(s,l){if(1&s&&(d.TgZ(0,"div",20),d._uU(1),d.qZA()),2&s){const t=l.$implicit;d.xp6(1),d.hij(" ",t," ")}}const Wh=function(s){return{"background-image":s}};function Sp(s,l){if(1&s&&(d.TgZ(0,"div",12)(1,"div",13)(2,"div",14),d._UZ(3,"div",15),d.TgZ(4,"div",16),d._uU(5),d.qZA()(),d.TgZ(6,"div",17)(7,"div",18),d.YNc(8,xm,2,1,"div",19),d.qZA()()()()),2&s){const t=l.$implicit;d.xp6(2),d.Q6J("ngStyle",d.VKq(3,Wh,"url("+t.heroeSchema.pathImagen+")")),d.xp6(3),d.hij(" Mesa ",t.heroeSchema.nombre," "),d.xp6(3),d.Q6J("ngForOf",t.vInvitados)}}function wc(s,l){if(1&s&&(d.TgZ(0,"div",10),d.YNc(1,Sp,9,5,"div",11),d.qZA()),2&s){const t=d.oxw();d.xp6(1),d.Q6J("ngForOf",t.vMesas)}}function bl(s,l){if(1&s&&(d.TgZ(0,"div",26),d._uU(1),d.qZA()),2&s){const t=l.$implicit;d.xp6(1),d.hij(" ",t.nombre," ")}}function gs(s,l){if(1&s){const t=d.EpF();d.TgZ(0,"div",21)(1,"div",22)(2,"div",23),d.YNc(3,bl,2,1,"div",24),d.TgZ(4,"div",25),d.NdJ("click",function(){d.CHM(t);const _=d.oxw();return d.KtG(_.mostrandoListado=!1)}),d._uU(5," Cerrar listado "),d.qZA()()()()}if(2&s){const t=d.oxw();d.xp6(3),d.Q6J("ngForOf",t.vInvitadosMostrados)}}function Xh(s,l){if(1&s){const t=d.EpF();d.TgZ(0,"div",27)(1,"div"),d._UZ(2,"app-sopa-letras",28,29),d.qZA(),d.TgZ(4,"div",30)(5,"div",31),d.NdJ("click",function(){d.CHM(t);const _=d.oxw();return d.KtG(_.cerrarSopaDeLetras())}),d._uU(6," Cerrar sopa "),d.qZA()()()}if(2&s){const t=d.oxw();d.xp6(2),d.Q6J("heroeSt",t.heroeSr)("vNombres",t.vNombres)}}let Ep=(()=>{class s{constructor(t,a,_,M){this.heroesService=t,this.mesasService=a,this.invitadosService=_,this.sopaLetrasService=M,this.vInvitados=[],this.vMesas=[],this.vHeroes=[],this.mostrandoListado=!1,this.vInvitadosMostrados=[],this.vNombres=[],this.cargandoDatos=!1,this.mostrandoSopaLetras=!1,this.anchoPantalla=0}ngOnInit(){this.anchoPantalla=window.innerWidth,this.cargandoDatos=!0,this.heroesService.obtenerListadoHeroes().pipe((0,ca.w)(({data:t})=>(this.vHeroes=t,this.invitadosService.obtenerListadoInvitados())),(0,ca.w)(({data:t})=>(this.vInvitados=t,this.mesasService.obtenerListadoMesas()))).subscribe(({data:t})=>{this.vMesas=t,this.vMesas.forEach(a=>{a.heroeSchema=this.vHeroes.find(_=>_._id===a.heroe),a.vInvitados=[]}),this.vInvitados.forEach(a=>{a.mesaSchema=this.vMesas.find(_=>_._id===a.mesa),this.vMesas.find(_=>_._id===a.mesa)?.vInvitados?.push(a.nombre)}),console.log(this.vMesas),this.cargandoDatos=!1})}abrirListadoInvitados(t){const a=t.heroeSchema;this.vInvitadosMostrados=[],this.vInvitados.forEach(_=>{_.mesaSchema.heroe===a._id&&this.vInvitadosMostrados.push(_)}),this.vMesas.map(_=>_.mostrando=!1),t.mostrando=!0,this.mostrandoListado=!0}cerrarListadoInvitados(){this.mostrandoListado=!1,this.vMesas.map(t=>t.mostrando=!1)}mostrarSopaLetras(t){this.vInvitadosMostrados=[],this.vInvitados.forEach(a=>{a.mesaSchema.heroe===t._id&&(this.vInvitadosMostrados.push(a),this.vNombres.push(a.nombre.replace(" ","")))}),this.heroeSr=t.nombre,this.heroeSr=this.heroeSr.replace(" ",""),this.mostrandoSopaLetras=!0}cerrarSopaDeLetras(){this.vInvitadosMostrados=[],this.sopaLetrasService.inicializarMapa(),this.heroeSr="",this.mostrandoSopaLetras=!1}onResize(t){this.anchoPantalla=t.target.innerWidth}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(ym),d.Y36(Cp),d.Y36(Zu),d.Y36(Cr))},s.\u0275cmp=d.Xpm({type:s,selectors:[["app-distribucion-mesas"]],viewQuery:function(t,a){if(1&t&&d.Gf(Mp,5),2&t){let _;d.iGM(_=d.CRH())&&(a.sopaLetras=_.first)}},hostBindings:function(t,a){1&t&&d.NdJ("resize",function(M){return a.onResize(M)},!1,d.Jf7)},decls:11,vars:4,consts:[[1,"container"],[1,"titulo-distribucion-mesas"],[1,"cortina"],["fxLayoutAlign","center center",1,"texto-titulo"],["fxLayoutAlign","center","class","spinner-carga",4,"ngIf"],["fxLayout","row wrap","class","container-tarjetas","fxLayoutAlign","center",4,"ngIf"],[1,"fondo"],["class","dialog-listado-invitados",4,"ngIf"],["class","dialog-sopa-letras",4,"ngIf"],["fxLayoutAlign","center",1,"spinner-carga"],["fxLayout","row wrap","fxLayoutAlign","center",1,"container-tarjetas"],["class","content-tarjeta","fxFlex","30","fxFlex.sm","45","fxFlex.xs","90",4,"ngFor","ngForOf"],["fxFlex","30","fxFlex.sm","45","fxFlex.xs","90",1,"content-tarjeta"],[1,"tarjeta"],[1,"tarjeta-frente",3,"ngStyle"],[1,"borde-superior-nombre"],["fxLayoutAlign","center",1,"nombre-mesa"],[1,"tarjeta-reverso"],["fxLayout","column","fxLayoutAlign","center center",1,"tarjeta-reverso-container"],["class","item-invitado",4,"ngFor","ngForOf"],[1,"item-invitado"],[1,"dialog-listado-invitados"],[1,"listado-invitados"],["fxLayout","column","fxLayoutAlign","center center",1,"listado"],["class","invitado-item",4,"ngFor","ngForOf"],[1,"boton-cerrar-listado-invitados",3,"click"],[1,"invitado-item"],[1,"dialog-sopa-letras"],[3,"heroeSt","vNombres"],["sopaDeLetras",""],["fxLayoutAlign","center",1,"botonera-cerrar-sopa-letras"],[1,"boton",3,"click"]],template:function(t,a){1&t&&(d.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),d._uU(4," Distribuci\xf3n de invitados "),d.qZA()()(),d.YNc(5,Ap,2,0,"div",4),d.YNc(6,wc,2,1,"div",5),d.qZA(),d.TgZ(7,"div",6),d._UZ(8,"div",2),d.qZA(),d.YNc(9,gs,6,1,"div",7),d.YNc(10,Xh,7,2,"div",8)),2&t&&(d.xp6(5),d.Q6J("ngIf",0===a.vMesas.length),d.xp6(1),d.Q6J("ngIf",a.vMesas.length>0),d.xp6(3),d.Q6J("ngIf",a.mostrandoListado),d.xp6(1),d.Q6J("ngIf",a.mostrandoSopaLetras))},dependencies:[je.sg,je.O5,je.PC,hs,lt,v,uc,Yh,Yu],styles:['@import"https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap";@import"https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap";.titulo-distribucion-mesas[_ngcontent-%COMP%]{width:100%;height:250px;background-image:url(foto-parador-3.54ab84ff17beded3.webp);background-position:center center;background-size:cover;font-family:Square Peg,cursive}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#00000090}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{color:#fff;text-shadow:2px 2px 3px #ffffff80;font-size:60pt;width:100%;height:100%}.spinner-carga[_ngcontent-%COMP%]{padding-top:50px}.fondo[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;right:0;background-image:url(foto-parador-1.501f9ed644383b38.jpeg);background-size:cover;background-position:center center;z-index:-10}.fondo[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#361d42c0}.container-tarjetas[_ngcontent-%COMP%]{padding-top:50px;width:100%;max-width:1400px}.tarjeta[_ngcontent-%COMP%]{min-height:550px;margin:15px;box-shadow:3px 4px 4px var(--tono5-transparente);border-radius:5px;cursor:pointer;transition:.3s;position:relative}.nombre-mesa[_ngcontent-%COMP%]{margin-top:350px;padding-top:150px;height:200px;font-size:30pt;font-family:Square Peg,cursive;border-bottom-left-radius:5px;border-bottom-right-radius:5px;background:linear-gradient(to bottom,transparent,var(--transparente-2))}.tarjeta-frente[_ngcontent-%COMP%], .tarjeta-reverso[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;border-radius:5px}.tarjeta-frente[_ngcontent-%COMP%]{background-size:cover;background-position:center center;z-index:10;transition-delay:.1s}.tarjeta-reverso[_ngcontent-%COMP%]{transform:rotateY(180deg);z-index:-10;background-image:url(fondo-comic-vinnetas-color.7eb4ad1982ffb5f0.jpeg);background-size:cover;background-position:center center;transition-delay:.1s;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:5px}.tarjeta-reverso-container[_ngcontent-%COMP%], .listado[_ngcontent-%COMP%]{background-color:#fffe;border-radius:5px;box-shadow:2px 2px 4px #00000080;width:80%;height:90%}.content-tarjeta[_ngcontent-%COMP%]:hover   .tarjeta[_ngcontent-%COMP%]{transform:rotateY(180deg);transition:.3s}.content-tarjeta[_ngcontent-%COMP%]:hover   .tarjeta[_ngcontent-%COMP%]   .tarjeta-reverso[_ngcontent-%COMP%]{z-index:10;transition-delay:.1s}.content-tarjeta[_ngcontent-%COMP%]:hover   .tarjeta[_ngcontent-%COMP%]   .tarjeta-frente[_ngcontent-%COMP%]{z-index:-10;transition-delay:.1s}.item-invitado[_ngcontent-%COMP%]{color:#000;text-align:center;font-size:14pt;margin:8px 0;font-family:"Press Start 2P",cursive}.dialog-listado-invitados[_ngcontent-%COMP%]{z-index:30;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background-color:var(--tono5-transparente);position:fixed;top:0;bottom:0;left:0;right:0}.listado-invitados[_ngcontent-%COMP%]{width:400px;position:fixed;top:5%;bottom:5%;left:calc(50% - 200px);background-image:url(fondo-comic-vinnetas.1bc12bdaba77ae38.jpeg);background-size:cover;background-position:center center}.listado-invitados[_ngcontent-%COMP%] > .listado[_ngcontent-%COMP%]{position:relative;overflow-y:scroll;border-radius:5px;box-shadow:3px 4px 4px var(--tono5-transparente);padding-top:100px;padding-bottom:30px}.cerrar[_ngcontent-%COMP%]{position:fixed;top:0;right:0}.invitado-item[_ngcontent-%COMP%]{margin-top:30px;color:#fff;font-family:Square Peg,cursive;font-size:30pt;text-align:center}.boton-cerrar-listado-invitados[_ngcontent-%COMP%]{cursor:pointer;margin-top:50px;font-size:25pt;text-align:center;font-family:Square Peg,cursive}.dialog-sopa-letras[_ngcontent-%COMP%]{position:fixed;top:calc(45% - 300px);left:calc(50% - 300px)}.dialog-sopa-letras[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{z-index:5;background-color:#fff;border-radius:5px;box-shadow:3px 3px 3px var(--tono5-transparente)}.dialog-sopa-letras[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{border-bottom-right-radius:0!important;border-bottom-left-radius:0!important}.botonera-cerrar-sopa-letras[_ngcontent-%COMP%]{border-top-right-radius:0!important;border-top-left-radius:0!important}.botonera-cerrar-sopa-letras[_ngcontent-%COMP%]   .boton[_ngcontent-%COMP%]{margin:5px;padding:5px 20px;border:2px solid var(--tono5-transparente);background:var(--tono1);box-shadow:1px 2px 3px var(--tono1-transparente);border-radius:3px;color:var(--tono7);cursor:pointer;font-size:18pt;font-family:Square Peg,cursive}@media screen and (max-width: 595px){.listado-invitados[_ngcontent-%COMP%]{width:400px}.titulo-distribucion-mesas[_ngcontent-%COMP%]{height:300px}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{font-size:40pt}}@font-face{font-family:Avengers Font;src:url(AvengersFont.4131afb508e61ffa.otf)}','.card[_ngcontent-%COMP%]{width:420px;height:340px;margin:1em;perspective:1500px}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .8s cubic-bezier(.75,0,.85,1)}.more[_ngcontent-%COMP%]{display:none}.more[_ngcontent-%COMP%]:checked ~ .content[_ngcontent-%COMP%]{transform:rotateY(180deg)}.front[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;-webkit-backface-visibility:hidden;backface-visibility:hidden;transform-style:preserve-3d;border-radius:6px}.front[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{height:100%;display:grid;padding:1.5em;transform:translateZ(80px) scale(.94)}.front[_ngcontent-%COMP%]{background-color:#fff;background-size:cover;background-position:center center}.front[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;display:block;border-radius:6px;-webkit-backface-visibility:hidden;backface-visibility:hidden;background:linear-gradient(40deg,rgba(67,138,243,.7),rgba(255,242,166,.7))}.front[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{grid-template-rows:5fr 1fr 1fr 2fr 1fr;justify-items:center}.front[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{grid-row:2;margin-bottom:.3em;text-transform:uppercase;letter-spacing:3px;color:#fff;font-weight:500;text-shadow:0 0 6px rgba(0,0,0,.1)}.front[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{grid-row:3;color:#fffc;font-size:14px;display:flex;flex-flow:row nowrap}.front[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin:0 1px}.back[_ngcontent-%COMP%]{transform:rotateY(180deg);background-color:#fff;border:2px solid rgb(240,240,240)}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;color:#355cc9;grid-row:3}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]:not(:first-of-type):before{content:"";position:absolute;left:-.9em;height:18px;width:1px;background-color:#ccc}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:2em;font-weight:700}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]:before{background:linear-gradient(40deg,#355cc9,rgb(67,138,243));-webkit-text-fill-color:transparent;-webkit-background-clip:text}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2em}.icon[_ngcontent-%COMP%]{margin-left:.3em}.icon[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;margin-top:-.25em;font-size:.8em;font-weight:600;white-space:nowrap}.back[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{grid-row:5;grid-column:1/-1;font-size:.86em;border-radius:5px;font-weight:600;line-height:1.4em;overflow:auto;color:#355cc9;padding-right:10px}.back[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-weight:600;color:#355cc9;grid-row:1;font-size:.86em}.back[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{grid-column:1/3;justify-self:left}.back[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{grid-column:3/-1;justify-self:right}.back[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{grid-column:1/-1;justify-self:center}.back[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{grid-template-rows:1fr 2fr 1fr 2fr 14fr 1fr 1fr;grid-template-columns:repeat(4,auto);grid-column-gap:.8em;justify-items:center}.button[_ngcontent-%COMP%]{grid-row:-1;text-transform:uppercase;letter-spacing:1px;font-weight:600;cursor:pointer;display:block;padding:0 1.5em;height:3em;line-height:2.9em;min-width:3em;background-color:transparent;border:solid 2px #fff;color:#fff;border-radius:4px;text-align:center;left:50%;-webkit-backface-visibility:hidden;backface-visibility:hidden;transition:.3s ease-in-out;text-shadow:0 0 6px rgba(0,0,0,.3)}.button[_ngcontent-%COMP%]:hover{background-color:#fff;box-shadow:0 0 50px #00000080;text-shadow:none;color:#355cc9}.button.return[_ngcontent-%COMP%]{line-height:3em;color:#355cc9;border-color:#355cc9;text-shadow:none}.button.return[_ngcontent-%COMP%]:hover{background-color:#355cc9;color:#fff;box-shadow:none}[_ngcontent-%COMP%]::-webkit-scrollbar{width:5px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:lighten(#355cc9,20%)}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#355cc9}']}),s})();var Do=dt(9898),Kh=dt(3963);const Wu=[{path:"",component:$u,children:[{path:"distribucion-mesas",component:Ep},{path:"ubicaciones",component:(()=>{class s{constructor(){this.centerIglesia=[-6.07987967275465,40.06193837264466],this.centerParador=[-6.094094531103214,40.02918737941208],this.zoomParador=16,this.zoomIglesia=15,this.containerIglesia="mapaIglesia",this.containerParador="mapaParador",this.containerParador2="mapaParador2",this.ubicacionIglesia="https://www.google.com/maps/place/Santuario+de+Nuestra+Se%C3%B1ora+del+Puerto/@40.0618776,-6.0818982,17z/data=!3m1!4b1!4m5!3m4!1s0xd3e160f40a550fb:0xe88a4d3fd88ddc91!8m2!3d40.0619512!4d-6.0798938",this.ubicacionParador="https://www.google.com/maps/place/Parador+de+Plasencia/@40.0291874,-6.0962725,17z/data=!3m1!4b1!4m8!3m7!1s0xd3e164b9c9b1465:0x44caa32733429e63!5m2!4m1!1i2!8m2!3d40.0291874!4d-6.0940838"}ngOnInit(){window.scroll({top:0,left:0})}ngAfterViewInit(){Do.accessToken=Kh.N.mapboxToken;var t=new Do.Map({container:this.containerIglesia,style:"mapbox://styles/mapbox/streets-v11",center:this.centerIglesia,zoom:this.zoomIglesia,scrollZoom:!1});(new Do.Marker).setLngLat(this.centerIglesia).addTo(t);var _=new Do.Map({container:this.containerParador,style:"mapbox://styles/mapbox/streets-v11",center:this.centerParador,zoom:this.zoomParador,scrollZoom:!1});(new Do.Marker).setLngLat(this.centerParador).addTo(_),new Do.Map({container:this.containerParador2,style:"mapbox://styles/mapbox/streets-v11",center:this.centerParador,zoom:this.zoomParador,scrollZoom:!1}),(new Do.Marker).setLngLat(this.centerParador).addTo(_)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=d.Xpm({type:s,selectors:[["app-ubicaciones"]],decls:27,vars:2,consts:[[1,"container-ubicaciones"],[1,"titulo-ubicaciones"],[1,"cortina"],["fxLayoutAlign","center center",1,"texto-titulo"],["fxLayout","row wrap"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"descripcion","iglesia"],["fxLayout","column","fxLayoutAlign","center center",1,"cortina"],[1,"linea-texto"],["target","_blank",1,"como-llegar",3,"href"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"ubicacion-iglesia"],["id","mapaIglesia",1,"mapa"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100","fxShow.sm","false","fxShow.xs","false","fxShow","true",1,"ubicacion-parador"],["id","mapaParador",1,"mapa"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"descripcion","parador"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100","fxShow.sm","true","fxShow.xs","true","fxShow","false",1,"ubicacion-parador"],["id","mapaParador2",1,"mapa"]],template:function(t,a){1&t&&(d.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),d._uU(4," Ubicaciones del enlace "),d.qZA()()(),d.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),d._uU(9," Santuario Virgen del Puerto "),d.qZA(),d.TgZ(10,"div",7),d._uU(11," Hora: 12.30 "),d.qZA(),d.TgZ(12,"a",8),d._uU(13," C\xf3mo llegar "),d.qZA()()(),d.TgZ(14,"div",9),d._UZ(15,"div",10),d.qZA()(),d.TgZ(16,"div",4)(17,"div",11),d._UZ(18,"div",12),d.qZA(),d.TgZ(19,"div",13)(20,"div",6)(21,"div",7),d._uU(22," Parador de Plasencia "),d.qZA(),d.TgZ(23,"a",8),d._uU(24," C\xf3mo llegar "),d.qZA()()(),d.TgZ(25,"div",14),d._UZ(26,"div",15),d.qZA()()()),2&t&&(d.xp6(12),d.Q6J("href",a.ubicacionIglesia,d.LSH),d.xp6(11),d.Q6J("href",a.ubicacionParador,d.LSH))},dependencies:[hs,lt,v,Pi],styles:[".titulo-ubicaciones[_ngcontent-%COMP%]{width:100%;height:400px;background-image:url(foto-parador-2.f0d5aaf8d1f80569.jpeg);background-position:center center;background-size:cover;font-family:Square Peg,cursive}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#00000090}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{color:#fff;text-shadow:2px 2px 3px #ffffff80;font-size:60pt;width:100%;height:100%}.ubicacion-iglesia[_ngcontent-%COMP%], .ubicacion-parador[_ngcontent-%COMP%], .descripcion[_ngcontent-%COMP%]{height:500px}#mapaIglesia[_ngcontent-%COMP%], #mapaParador[_ngcontent-%COMP%], #mapaParador2[_ngcontent-%COMP%]{width:100%;height:100%}.descripcion.iglesia[_ngcontent-%COMP%]{background-image:url(santuario-puerto-1.632d610674907cb1.jpeg);background-position:center center;background-size:cover;z-index:10;box-shadow:2px 2px 4px #00000050}.descripcion.parador[_ngcontent-%COMP%]{background-image:url(foto-parador-1.501f9ed644383b38.jpeg);background-position:center center;background-size:cover;z-index:9;box-shadow:-2px -1px 4px #00000050}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{font-family:Dancing Script,cursive;font-size:20pt;background-color:#ffffffc0;width:100%;height:100%}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .linea-texto[_ngcontent-%COMP%]{margin:15px 0}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .como-llegar[_ngcontent-%COMP%]{margin:30px 0;border:1px solid var(--tono1);padding:15px 40px;cursor:pointer;box-shadow:2px 2px 4px #00000050;border-radius:2px;text-decoration:none;color:#000;transition:.3s}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .como-llegar[_ngcontent-%COMP%]:hover{background-color:var(--tono5-transparente);border:1px solid var(--tono1);color:var(--tono1);transform:translateY(-3px) scale(1.02);transition:.3s}@media (max-width: 595px){.ubicacion-iglesia[_ngcontent-%COMP%], .ubicacion-parador[_ngcontent-%COMP%], .titulo-ubicaciones[_ngcontent-%COMP%]{height:300px}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{font-size:40pt}}"]}),s})()},{path:"**",redirectTo:"ubicaciones"}]}];let fn=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[yl.Bz.forChild(Wu),yl.Bz]}),s})();var ki=dt(2654),or=dt(1086);var fd=dt(3489),md=dt(353),On=dt(2986);class Wi{constructor(l){this.total=l}call(l,t){return t.subscribe(new Yr(l,this.total))}}class Yr extends fd.L{constructor(l,t){super(l),this.total=t,this.count=0}_next(l){++this.count>this.total&&this.destination.next(l)}}var Ml=dt(5778);let Al;try{Al=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Al=!1}let Ec,Ut,uh,Yt=(()=>{class s{constructor(t){this._platformId=t,this.isBrowser=this._platformId?(0,je.NF)(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Al)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(d.Lbi))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(d.Lbi))},token:s,providedIn:"root"}),s})(),Sl=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({}),s})();function Tc(s){return function Vp(){if(null==Ec&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Ec=!0}))}finally{Ec=Ec||!1}return Ec}()?s:!!s.capture}function ch(){if(null==Ut){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Ut=!1,Ut;if("scrollBehavior"in document.documentElement.style)Ut=!0;else{const s=Element.prototype.scrollTo;Ut=!!s&&!/\{\s*\[native code\]\s*\}/.test(s.toString())}}return Ut}function kc(){let s=typeof document<"u"&&document?document.activeElement:null;for(;s&&s.shadowRoot;){const l=s.shadowRoot.activeElement;if(l===s)break;s=l}return s}function pa(s){return s.composedPath?s.composedPath()[0]:s.target}function _d(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}let yd=(()=>{class s{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=d.Yz7({factory:function(){return new s},token:s,providedIn:"root"}),s})(),xd=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({providers:[yd]}),s})(),$p=(()=>{class s{constructor(t){this._platform=t}isDisabled(t){return t.hasAttribute("disabled")}isVisible(t){return function Yp(s){return!!(s.offsetWidth||s.offsetHeight||"function"==typeof s.getClientRects&&s.getClientRects().length)}(t)&&"visible"===getComputedStyle(t).visibility}isTabbable(t){if(!this._platform.isBrowser)return!1;const a=function Zp(s){try{return s.frameElement}catch{return null}}(function Qp(s){return s.ownerDocument&&s.ownerDocument.defaultView||window}(t));if(a&&(-1===Kp(a)||!this.isVisible(a)))return!1;let _=t.nodeName.toLowerCase(),M=Kp(t);return t.hasAttribute("contenteditable")?-1!==M:!("iframe"===_||"object"===_||this._platform.WEBKIT&&this._platform.IOS&&!function Jp(s){let l=s.nodeName.toLowerCase(),t="input"===l&&s.type;return"text"===t||"password"===t||"select"===l||"textarea"===l}(t))&&("audio"===_?!!t.hasAttribute("controls")&&-1!==M:"video"===_?-1!==M&&(null!==M||this._platform.FIREFOX||t.hasAttribute("controls")):t.tabIndex>=0)}isFocusable(t,a){return function Fo(s){return!function Wp(s){return function wd(s){return"input"==s.nodeName.toLowerCase()}(s)&&"hidden"==s.type}(s)&&(function tg(s){let l=s.nodeName.toLowerCase();return"input"===l||"select"===l||"button"===l||"textarea"===l}(s)||function Xp(s){return function Cd(s){return"a"==s.nodeName.toLowerCase()}(s)&&s.hasAttribute("href")}(s)||s.hasAttribute("contenteditable")||Md(s))}(t)&&!this.isDisabled(t)&&(a?.ignoreVisibility||this.isVisible(t))}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(Yt))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(Yt))},token:s,providedIn:"root"}),s})();function Md(s){if(!s.hasAttribute("tabindex")||void 0===s.tabIndex)return!1;let l=s.getAttribute("tabindex");return"-32768"!=l&&!(!l||isNaN(parseInt(l,10)))}function Kp(s){if(!Md(s))return null;const l=parseInt(s.getAttribute("tabindex")||"",10);return isNaN(l)?-1:l}class ef{constructor(l,t,a,_,M=!1){this._element=l,this._checker=t,this._ngZone=a,this._document=_,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,M||this.attachAnchors()}get enabled(){return this._enabled}set enabled(l){this._enabled=l,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(l,this._startAnchor),this._toggleAnchorTabIndex(l,this._endAnchor))}destroy(){const l=this._startAnchor,t=this._endAnchor;l&&(l.removeEventListener("focus",this.startAnchorListener),l.parentNode&&l.parentNode.removeChild(l)),t&&(t.removeEventListener("focus",this.endAnchorListener),t.parentNode&&t.parentNode.removeChild(t)),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(l){return new Promise(t=>{this._executeOnStable(()=>t(this.focusInitialElement(l)))})}focusFirstTabbableElementWhenReady(l){return new Promise(t=>{this._executeOnStable(()=>t(this.focusFirstTabbableElement(l)))})}focusLastTabbableElementWhenReady(l){return new Promise(t=>{this._executeOnStable(()=>t(this.focusLastTabbableElement(l)))})}_getRegionBoundary(l){let t=this._element.querySelectorAll(`[cdk-focus-region-${l}], [cdkFocusRegion${l}], [cdk-focus-${l}]`);for(let a=0;a<t.length;a++)t[a].hasAttribute(`cdk-focus-${l}`)?console.warn(`Found use of deprecated attribute 'cdk-focus-${l}', use 'cdkFocusRegion${l}' instead. The deprecated attribute will be removed in 8.0.0.`,t[a]):t[a].hasAttribute(`cdk-focus-region-${l}`)&&console.warn(`Found use of deprecated attribute 'cdk-focus-region-${l}', use 'cdkFocusRegion${l}' instead. The deprecated attribute will be removed in 8.0.0.`,t[a]);return"start"==l?t.length?t[0]:this._getFirstTabbableElement(this._element):t.length?t[t.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(l){const t=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(t){if(t.hasAttribute("cdk-focus-initial")&&console.warn("Found use of deprecated attribute 'cdk-focus-initial', use 'cdkFocusInitial' instead. The deprecated attribute will be removed in 8.0.0",t),!this._checker.isFocusable(t)){const a=this._getFirstTabbableElement(t);return a?.focus(l),!!a}return t.focus(l),!0}return this.focusFirstTabbableElement(l)}focusFirstTabbableElement(l){const t=this._getRegionBoundary("start");return t&&t.focus(l),!!t}focusLastTabbableElement(l){const t=this._getRegionBoundary("end");return t&&t.focus(l),!!t}hasAttached(){return this._hasAttached}_getFirstTabbableElement(l){if(this._checker.isFocusable(l)&&this._checker.isTabbable(l))return l;let t=l.children||l.childNodes;for(let a=0;a<t.length;a++){let _=t[a].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(t[a]):null;if(_)return _}return null}_getLastTabbableElement(l){if(this._checker.isFocusable(l)&&this._checker.isTabbable(l))return l;let t=l.children||l.childNodes;for(let a=t.length-1;a>=0;a--){let _=t[a].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(t[a]):null;if(_)return _}return null}_createAnchor(){const l=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,l),l.classList.add("cdk-visually-hidden"),l.classList.add("cdk-focus-trap-anchor"),l.setAttribute("aria-hidden","true"),l}_toggleAnchorTabIndex(l,t){l?t.setAttribute("tabindex","0"):t.removeAttribute("tabindex")}toggleAnchors(l){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(l,this._startAnchor),this._toggleAnchorTabIndex(l,this._endAnchor))}_executeOnStable(l){this._ngZone.isStable?l():this._ngZone.onStable.pipe((0,On.q)(1)).subscribe(l)}}let hh=(()=>{class s{constructor(t,a,_){this._checker=t,this._ngZone=a,this._document=_}create(t,a=!1){return new ef(t,this._checker,this._ngZone,this._document,a)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG($p),d.LFG(d.R0b),d.LFG(je.K0))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG($p),d.LFG(d.R0b),d.LFG(je.K0))},token:s,providedIn:"root"}),s})();typeof Element<"u"&&Element;const Sd=new d.OlP("cdk-input-modality-detector-options"),dh={ignoreKeys:[18,17,224,91,16]},Ol=Tc({passive:!0,capture:!0});let af=(()=>{class s{constructor(t,a,_,M){this._platform=t,this._mostRecentTarget=null,this._modality=new Qo.X(null),this._lastTouchMs=0,this._onKeydown=O=>{var q,ce;null!==(ce=null===(q=this._options)||void 0===q?void 0:q.ignoreKeys)&&void 0!==ce&&ce.some(xe=>xe===O.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=pa(O))},this._onMousedown=O=>{Date.now()-this._lastTouchMs<650||(this._modality.next(function Ad(s){return 0===s.offsetX&&0===s.offsetY}(O)?"keyboard":"mouse"),this._mostRecentTarget=pa(O))},this._onTouchstart=O=>{!function Lc(s){const l=s.touches&&s.touches[0]||s.changedTouches&&s.changedTouches[0];return!(!l||-1!==l.identifier||null!=l.radiusX&&1!==l.radiusX||null!=l.radiusY&&1!==l.radiusY)}(O)?(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=pa(O)):this._modality.next("keyboard")},this._options=Object.assign(Object.assign({},dh),M),this.modalityDetected=this._modality.pipe(function Jm(s){return l=>l.lift(new Wi(s))}(1)),this.modalityChanged=this.modalityDetected.pipe((0,Ml.x)()),t.isBrowser&&a.runOutsideAngular(()=>{_.addEventListener("keydown",this._onKeydown,Ol),_.addEventListener("mousedown",this._onMousedown,Ol),_.addEventListener("touchstart",this._onTouchstart,Ol)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Ol),document.removeEventListener("mousedown",this._onMousedown,Ol),document.removeEventListener("touchstart",this._onTouchstart,Ol))}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(Yt),d.LFG(d.R0b),d.LFG(je.K0),d.LFG(Sd,8))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(Yt),d.LFG(d.R0b),d.LFG(je.K0),d.LFG(Sd,8))},token:s,providedIn:"root"}),s})();const hf=new d.OlP("cdk-focus-monitor-default-options"),Pc=Tc({passive:!0,capture:!0});let ma=(()=>{class s{constructor(t,a,_,M,O){this._ngZone=t,this._platform=a,this._inputModalityDetector=_,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new at.xQ,this._rootNodeFocusAndBlurListener=q=>{const ce=pa(q),xe="focus"===q.type?this._onFocus:this._onBlur;for(let He=ce;He;He=He.parentElement)xe.call(this,q,He)},this._document=M,this._detectionMode=O?.detectionMode||0}monitor(t,a=!1){const _=Ni(t);if(!this._platform.isBrowser||1!==_.nodeType)return(0,or.of)(null);const M=function Dl(s){if(function Io(){if(null==uh){const s=typeof document<"u"?document.head:null;uh=!(!s||!s.createShadowRoot&&!s.attachShadow)}return uh}()){const l=s.getRootNode?s.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&l instanceof ShadowRoot)return l}return null}(_)||this._getDocument(),O=this._elementInfo.get(_);if(O)return a&&(O.checkChildren=!0),O.subject;const q={checkChildren:a,subject:new at.xQ,rootNode:M};return this._elementInfo.set(_,q),this._registerGlobalListeners(q),q.subject}stopMonitoring(t){const a=Ni(t),_=this._elementInfo.get(a);_&&(_.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(_))}focusVia(t,a,_){const M=Ni(t);M===this._getDocument().activeElement?this._getClosestElementsInfo(M).forEach(([q,ce])=>this._originChanged(q,a,ce)):(this._setOrigin(a),"function"==typeof M.focus&&M.focus(_))}ngOnDestroy(){this._elementInfo.forEach((t,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_toggleClass(t,a,_){_?t.classList.add(a):t.classList.remove(a)}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,a){this._toggleClass(t,"cdk-focused",!!a),this._toggleClass(t,"cdk-touch-focused","touch"===a),this._toggleClass(t,"cdk-keyboard-focused","keyboard"===a),this._toggleClass(t,"cdk-mouse-focused","mouse"===a),this._toggleClass(t,"cdk-program-focused","program"===a)}_setOrigin(t,a=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&a,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,a){const _=this._elementInfo.get(a),M=pa(t);!_||!_.checkChildren&&a!==M||this._originChanged(a,this._getFocusOrigin(M),_)}_onBlur(t,a){const _=this._elementInfo.get(a);!_||_.checkChildren&&t.relatedTarget instanceof Node&&a.contains(t.relatedTarget)||(this._setClasses(a),this._emitOrigin(_.subject,null))}_emitOrigin(t,a){this._ngZone.run(()=>t.next(a))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const a=t.rootNode,_=this._rootNodeFocusListenerCount.get(a)||0;_||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,Pc),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,Pc)}),this._rootNodeFocusListenerCount.set(a,_+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Ft(this._stopInputModalityDetector)).subscribe(M=>{this._setOrigin(M,!0)}))}_removeGlobalListeners(t){const a=t.rootNode;if(this._rootNodeFocusListenerCount.has(a)){const _=this._rootNodeFocusListenerCount.get(a);_>1?this._rootNodeFocusListenerCount.set(a,_-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Pc),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Pc),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,a,_){this._setClasses(t,a),this._emitOrigin(_.subject,a),this._lastFocusOrigin=a}_getClosestElementsInfo(t){const a=[];return this._elementInfo.forEach((_,M)=>{(M===t||_.checkChildren&&M.contains(t))&&a.push([M,_])}),a}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(d.R0b),d.LFG(Yt),d.LFG(af),d.LFG(je.K0,8),d.LFG(hf,8))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(d.R0b),d.LFG(Yt),d.LFG(af),d.LFG(je.K0,8),d.LFG(hf,8))},token:s,providedIn:"root"}),s})();const pf="cdk-high-contrast-black-on-white",Oo="cdk-high-contrast-white-on-black",ph="cdk-high-contrast-active";let Ed=(()=>{class s{constructor(t,a){this._platform=t,this._document=a}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const a=this._document.defaultView||window,_=a&&a.getComputedStyle?a.getComputedStyle(t):null,M=(_&&_.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(t),M){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(ph),t.remove(pf),t.remove(Oo),this._hasCheckedHighContrastMode=!0;const a=this.getHighContrastMode();1===a?(t.add(ph),t.add(pf)):2===a&&(t.add(ph),t.add(Oo))}}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(Yt),d.LFG(je.K0))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(Yt),d.LFG(je.K0))},token:s,providedIn:"root"}),s})();const fh=new d.GfV("12.2.13");var ar=dt(1059);const lr=new d.GfV("12.2.13"),_f=new d.OlP("mat-sanity-checks",{providedIn:"root",factory:function sg(){return!0}});let Xr,Wt=(()=>{class s{constructor(t,a,_){this._hasDoneGlobalChecks=!1,this._document=_,t._applyBodyHighContrastModeCssClasses(),this._sanityChecks=a,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!(!(0,d.X6Q)()||_d())&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}_checkDoctypeIsDefined(){this._checkIsEnabled("doctype")&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checkIsEnabled("theme")||!this._document.body||"function"!=typeof getComputedStyle)return;const t=this._document.createElement("div");t.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(t);const a=getComputedStyle(t);a&&"none"!==a.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(t)}_checkCdkVersionMatch(){this._checkIsEnabled("version")&&lr.full!==fh.full&&console.warn("The Angular Material version ("+lr.full+") does not match the Angular CDK version ("+fh.full+").\nPlease ensure the versions of these two packages exactly match.")}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(Ed),d.LFG(_f,8),d.LFG(je.K0))},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[bo,bo]}),s})();try{Xr=typeof Intl<"u"}catch{Xr=!1}let Kr=(()=>{class s{isErrorState(t,a){return!!(t&&t.invalid&&(t.touched||a&&a.submitted))}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=d.Yz7({factory:function(){return new s},token:s,providedIn:"root"}),s})(),vs=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Wt,Wt]}),s})(),gh=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Wt,Sl,Wt]}),s})(),Pd=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Wt]}),s})(),Nd=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[gh,je.ez,Wt,Pd]}),s})(),xh=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[gh,Wt,Wt]}),s})(),Ff=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Wt,Wt]}),s})(),Cs=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({}),s})(),Pf=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[gh,Wt,xd,Cs,Wt,Cs]}),s})();var zf=dt(7043);function Vo(s,l,t,a){return(0,zf.m)(t)&&(a=t,t=void 0),a?Vo(s,l,t).pipe((0,_i.U)(_=>(0,hr.k)(_)?a(..._):a(_))):new Be.y(_=>{Yd(s,l,function M(O){_.next(arguments.length>1?Array.prototype.slice.call(arguments):O)},_,t)})}function Yd(s,l,t,a,_){let M;if(function Vf(s){return s&&"function"==typeof s.addEventListener&&"function"==typeof s.removeEventListener}(s)){const O=s;s.addEventListener(l,t,_),M=()=>O.removeEventListener(l,t,_)}else if(function Tg(s){return s&&"function"==typeof s.on&&"function"==typeof s.off}(s)){const O=s;s.on(l,t),M=()=>O.off(l,t)}else if(function Bf(s){return s&&"function"==typeof s.addListener&&"function"==typeof s.removeListener}(s)){const O=s;s.addListener(l,t),M=()=>O.removeListener(l,t)}else{if(!s||!s.length)throw new TypeError("Invalid event target");for(let O=0,q=s.length;O<q;O++)Yd(s[O],l,t,a,_)}a.add(M)}var kg=dt(6686),Gf=dt(2268);new class Nf extends Gf.v{flush(l){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let a,_=-1,M=t.length;l=l||t.shift();do{if(a=l.execute(l.state,l.delay))break}while(++_<M&&(l=t.shift()));if(this.active=!1,a){for(;++_<M&&(l=t.shift());)l.unsubscribe();throw a}}}(class Wd extends kg.o{constructor(l,t){super(l,t),this.scheduler=l,this.work=t}requestAsyncId(l,t,a=0){return null!==a&&a>0?super.requestAsyncId(l,t,a):(l.actions.push(this),l.scheduled||(l.scheduled=requestAnimationFrame(()=>l.flush(null))))}recycleAsyncId(l,t,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(l,t,a);0===l.actions.length&&(cancelAnimationFrame(t),l.scheduled=void 0)}});dt(8139);class f{constructor(l){this.durationSelector=l}call(l,t){return t.subscribe(new g(l,this.durationSelector))}}class g extends ss.Ds{constructor(l,t){super(l),this.durationSelector=t,this.hasValue=!1}_next(l){if(this.value=l,this.hasValue=!0,!this.throttled){let t;try{const{durationSelector:_}=this;t=_(l)}catch(_){return this.destination.error(_)}const a=(0,ss.ft)(t,new ss.IY(this));!a||a.closed?this.clearThrottle():this.add(this.throttled=a)}}clearThrottle(){const{value:l,hasValue:t,throttled:a}=this;a&&(this.remove(a),this.throttled=void 0,a.unsubscribe()),t&&(this.value=void 0,this.hasValue=!1,this.destination.next(l))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}var y=dt(4241),b=dt(2866);function S(s){const{index:l,period:t,subscriber:a}=s;if(a.next(l),!a.closed){if(-1===t)return a.complete();s.index=l+1,this.schedule(s,t)}}function T(s,l=md.P){return function u(s){return function(t){return t.lift(new f(s))}}(()=>function w(s=0,l,t){let a=-1;return(0,y.k)(l)?a=Number(l)<1?1:Number(l):(0,b.K)(l)&&(t=l),(0,b.K)(t)||(t=md.P),new Be.y(_=>{const M=(0,y.k)(s)?s:+s-t.now();return t.schedule(S,M,{index:0,period:a,subscriber:_})})}(s,l))}dt(519),dt(341),dt(2102),dt(5279),dt(5283);let Ve=(()=>{class s{constructor(t,a,_){this._ngZone=t,this._platform=a,this._scrolled=new at.xQ,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=_}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const a=this.scrollContainers.get(t);a&&(a.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new Be.y(a=>{this._globalSubscription||this._addGlobalListener();const _=t>0?this._scrolled.pipe(T(t)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{_.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,or.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(t,a){const _=this.getAncestorScrollContainers(t);return this.scrolled(a).pipe((0,ci.h)(M=>!M||_.indexOf(M)>-1))}getAncestorScrollContainers(t){const a=[];return this.scrollContainers.forEach((_,M)=>{this._scrollableContainsElement(M,t)&&a.push(M)}),a}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,a){let _=Ni(a),M=t.getElementRef().nativeElement;do{if(_==M)return!0}while(_=_.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>Vo(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(d.R0b),d.LFG(Yt),d.LFG(je.K0,8))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(d.R0b),d.LFG(Yt),d.LFG(je.K0,8))},token:s,providedIn:"root"}),s})(),qe=(()=>{class s{constructor(t,a,_){this._platform=t,this._change=new at.xQ,this._changeListener=M=>{this._change.next(M)},this._document=_,a.runOutsideAngular(()=>{if(t.isBrowser){const M=this._getWindow();M.addEventListener("resize",this._changeListener),M.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:a,height:_}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+_,right:t.left+a,height:_,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,a=this._getWindow(),_=t.documentElement,M=_.getBoundingClientRect();return{top:-M.top||t.body.scrollTop||a.scrollY||_.scrollTop||0,left:-M.left||t.body.scrollLeft||a.scrollX||_.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(T(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(Yt),d.LFG(d.R0b),d.LFG(je.K0,8))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(Yt),d.LFG(d.R0b),d.LFG(je.K0,8))},token:s,providedIn:"root"}),s})(),$t=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({}),s})(),Xt=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[bo,Sl,$t,bo,$t]}),s})();class fi{attach(l){return this._attachedHost=l,l.attach(this)}detach(){let l=this._attachedHost;null!=l&&(this._attachedHost=null,l.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(l){this._attachedHost=l}}class ji extends fi{constructor(l,t,a,_){super(),this.component=l,this.viewContainerRef=t,this.injector=a,this.componentFactoryResolver=_}}class Bt extends fi{constructor(l,t,a){super(),this.templateRef=l,this.viewContainerRef=t,this.context=a}get origin(){return this.templateRef.elementRef}attach(l,t=this.context){return this.context=t,super.attach(l)}detach(){return this.context=void 0,super.detach()}}class mi extends fi{constructor(l){super(),this.element=l instanceof d.SBq?l.nativeElement:l}}class Hi{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(l){return l instanceof ji?(this._attachedPortal=l,this.attachComponentPortal(l)):l instanceof Bt?(this._attachedPortal=l,this.attachTemplatePortal(l)):this.attachDomPortal&&l instanceof mi?(this._attachedPortal=l,this.attachDomPortal(l)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(l){this._disposeFn=l}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Mi extends Hi{constructor(l,t,a,_,M){super(),this.outletElement=l,this._componentFactoryResolver=t,this._appRef=a,this._defaultInjector=_,this.attachDomPortal=O=>{const q=O.element,ce=this._document.createComment("dom-portal");q.parentNode.insertBefore(ce,q),this.outletElement.appendChild(q),this._attachedPortal=O,super.setDisposeFn(()=>{ce.parentNode&&ce.parentNode.replaceChild(q,ce)})},this._document=M}attachComponentPortal(l){const a=(l.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(l.component);let _;return l.viewContainerRef?(_=l.viewContainerRef.createComponent(a,l.viewContainerRef.length,l.injector||l.viewContainerRef.injector),this.setDisposeFn(()=>_.destroy())):(_=a.create(l.injector||this._defaultInjector),this._appRef.attachView(_.hostView),this.setDisposeFn(()=>{this._appRef.detachView(_.hostView),_.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(_)),this._attachedPortal=l,_}attachTemplatePortal(l){let t=l.viewContainerRef,a=t.createEmbeddedView(l.templateRef,l.context);return a.rootNodes.forEach(_=>this.outletElement.appendChild(_)),a.detectChanges(),this.setDisposeFn(()=>{let _=t.indexOf(a);-1!==_&&t.remove(_)}),this._attachedPortal=l,a}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(l){return l.hostView.rootNodes[0]}}let Ii=(()=>{class s extends Hi{constructor(t,a,_){super(),this._componentFactoryResolver=t,this._viewContainerRef=a,this._isInitialized=!1,this.attached=new d.vpe,this.attachDomPortal=M=>{const O=M.element,q=this._document.createComment("dom-portal");M.setAttachedHost(this),O.parentNode.insertBefore(q,O),this._getRootNode().appendChild(O),this._attachedPortal=M,super.setDisposeFn(()=>{q.parentNode&&q.parentNode.replaceChild(O,q)})},this._document=_}get portal(){return this._attachedPortal}set portal(t){this.hasAttached()&&!t&&!this._isInitialized||(this.hasAttached()&&super.detach(),t&&super.attach(t),this._attachedPortal=t)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(t){t.setAttachedHost(this);const a=null!=t.viewContainerRef?t.viewContainerRef:this._viewContainerRef,M=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component),O=a.createComponent(M,a.length,t.injector||a.injector);return a!==this._viewContainerRef&&this._getRootNode().appendChild(O.hostView.rootNodes[0]),super.setDisposeFn(()=>O.destroy()),this._attachedPortal=t,this._attachedRef=O,this.attached.emit(O),O}attachTemplatePortal(t){t.setAttachedHost(this);const a=this._viewContainerRef.createEmbeddedView(t.templateRef,t.context);return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=t,this._attachedRef=a,this.attached.emit(a),a}_getRootNode(){const t=this._viewContainerRef.element.nativeElement;return t.nodeType===t.ELEMENT_NODE?t:t.parentNode}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(d._Vd),d.Y36(d.s_b),d.Y36(je.K0))},s.\u0275dir=d.lG2({type:s,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[d.qOj]}),s})(),Ar=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({}),s})();dt(4290);const zl=ch();class Uf{constructor(l,t){this._viewportRuler=l,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const l=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=l.style.left||"",this._previousHTMLStyles.top=l.style.top||"",l.style.left=Ci(-this._previousScrollPosition.left),l.style.top=Ci(-this._previousScrollPosition.top),l.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const l=this._document.documentElement,a=l.style,_=this._document.body.style,M=a.scrollBehavior||"",O=_.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,l.classList.remove("cdk-global-scrollblock"),zl&&(a.scrollBehavior=_.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),zl&&(a.scrollBehavior=M,_.scrollBehavior=O)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,a=this._viewportRuler.getViewportSize();return t.scrollHeight>a.height||t.scrollWidth>a.width}}class jf{constructor(l,t,a,_){this._scrollDispatcher=l,this._ngZone=t,this._viewportRuler=a,this._config=_,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(l){this._overlayRef=l}enable(){if(this._scrollSubscription)return;const l=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=l.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=l.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class bh{enable(){}disable(){}attach(){}}function Kc(s,l){return l.some(t=>s.bottom<t.top||s.top>t.bottom||s.right<t.left||s.left>t.right)}function Sr(s,l){return l.some(t=>s.top<t.top||s.bottom>t.bottom||s.left<t.left||s.right>t.right)}class Hf{constructor(l,t,a,_){this._scrollDispatcher=l,this._viewportRuler=t,this._ngZone=a,this._config=_,this._scrollSubscription=null}attach(l){this._overlayRef=l}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:_}=this._viewportRuler.getViewportSize();Kc(t,[{width:a,height:_,bottom:_,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let wa=(()=>{class s{constructor(t,a,_,M){this._scrollDispatcher=t,this._viewportRuler=a,this._ngZone=_,this.noop=()=>new bh,this.close=O=>new jf(this._scrollDispatcher,this._ngZone,this._viewportRuler,O),this.block=()=>new Uf(this._viewportRuler,this._document),this.reposition=O=>new Hf(this._scrollDispatcher,this._viewportRuler,this._ngZone,O),this._document=M}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(Ve),d.LFG(qe),d.LFG(d.R0b),d.LFG(je.K0))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(Ve),d.LFG(qe),d.LFG(d.R0b),d.LFG(je.K0))},token:s,providedIn:"root"}),s})();class Jc{constructor(l){if(this.scrollStrategy=new bh,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,l){const t=Object.keys(l);for(const a of t)void 0!==l[a]&&(this[a]=l[a])}}}class Xd{constructor(l,t,a,_,M){this.offsetX=a,this.offsetY=_,this.panelClass=M,this.originX=l.originX,this.originY=l.originY,this.overlayX=t.overlayX,this.overlayY=t.overlayY}}class Kd{constructor(l,t){this.connectionPair=l,this.scrollableViewProperties=t}}let Tn=(()=>{class s{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const a=this._attachedOverlays.indexOf(t);a>-1&&this._attachedOverlays.splice(a,1),0===this._attachedOverlays.length&&this.detach()}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(je.K0))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(je.K0))},token:s,providedIn:"root"}),s})(),Qc=(()=>{class s extends Tn{constructor(t){super(t),this._keydownListener=a=>{const _=this._attachedOverlays;for(let M=_.length-1;M>-1;M--)if(_[M]._keydownEvents.observers.length>0){_[M]._keydownEvents.next(a);break}}}add(t){super.add(t),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(je.K0))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(je.K0))},token:s,providedIn:"root"}),s})(),Jd=(()=>{class s extends Tn{constructor(t,a){super(t),this._platform=a,this._cursorStyleIsSet=!1,this._pointerDownListener=_=>{this._pointerDownEventTarget=pa(_)},this._clickListener=_=>{const M=pa(_),O="click"===_.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:M;this._pointerDownEventTarget=null;const q=this._attachedOverlays.slice();for(let ce=q.length-1;ce>-1;ce--){const xe=q[ce];if(!(xe._outsidePointerEvents.observers.length<1)&&xe.hasAttached()){if(xe.overlayElement.contains(M)||xe.overlayElement.contains(O))break;xe._outsidePointerEvents.next(_)}}}}add(t){if(super.add(t),!this._isAttached){const a=this._document.body;a.addEventListener("pointerdown",this._pointerDownListener,!0),a.addEventListener("click",this._clickListener,!0),a.addEventListener("auxclick",this._clickListener,!0),a.addEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(je.K0),d.LFG(Yt))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(je.K0),d.LFG(Yt))},token:s,providedIn:"root"}),s})(),Bl=(()=>{class s{constructor(t,a){this._platform=a,this._document=t}ngOnDestroy(){const t=this._containerElement;t&&t.parentNode&&t.parentNode.removeChild(t)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||_d()){const _=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let M=0;M<_.length;M++)_[M].parentNode.removeChild(_[M])}const a=this._document.createElement("div");a.classList.add(t),_d()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(je.K0),d.LFG(Yt))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(je.K0),d.LFG(Yt))},token:s,providedIn:"root"}),s})();class Ma{constructor(l,t,a,_,M,O,q,ce,xe){this._portalOutlet=l,this._host=t,this._pane=a,this._config=_,this._ngZone=M,this._keyboardDispatcher=O,this._document=q,this._location=ce,this._outsideClickDispatcher=xe,this._backdropElement=null,this._backdropClick=new at.xQ,this._attachments=new at.xQ,this._detachments=new at.xQ,this._locationChanges=ki.w.EMPTY,this._backdropClickHandler=He=>this._backdropClick.next(He),this._keydownEvents=new at.xQ,this._outsidePointerEvents=new at.xQ,_.scrollStrategy&&(this._scrollStrategy=_.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=_.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(l){let t=this._portalOutlet.attach(l);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,On.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const l=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),l}dispose(){const l=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,l&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(l){l!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=l,this.hasAttached()&&(l.attach(this),this.updatePosition()))}updateSize(l){this._config=Object.assign(Object.assign({},this._config),l),this._updateElementSize()}setDirection(l){this._config=Object.assign(Object.assign({},this._config),{direction:l}),this._updateElementDirection()}addPanelClass(l){this._pane&&this._toggleClasses(this._pane,l,!0)}removePanelClass(l){this._pane&&this._toggleClasses(this._pane,l,!1)}getDirection(){const l=this._config.direction;return l?"string"==typeof l?l:l.value:"ltr"}updateScrollStrategy(l){l!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=l,this.hasAttached()&&(l.attach(this),l.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const l=this._pane.style;l.width=Ci(this._config.width),l.height=Ci(this._config.height),l.minWidth=Ci(this._config.minWidth),l.minHeight=Ci(this._config.minHeight),l.maxWidth=Ci(this._config.maxWidth),l.maxHeight=Ci(this._config.maxHeight)}_togglePointerEvents(l){this._pane.style.pointerEvents=l?"":"none"}_attachBackdrop(){const l="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(l)})}):this._backdropElement.classList.add(l)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const l=this._backdropElement;if(!l)return;let t;const a=()=>{l&&(l.removeEventListener("click",this._backdropClickHandler),l.removeEventListener("transitionend",a),this._disposeBackdrop(l)),this._config.backdropClass&&this._toggleClasses(l,this._config.backdropClass,!1),clearTimeout(t)};l.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{l.addEventListener("transitionend",a)}),l.style.pointerEvents="none",t=this._ngZone.runOutsideAngular(()=>setTimeout(a,500))}_toggleClasses(l,t,a){const _=l.classList;lc(t).forEach(M=>{M&&(a?_.add(M):_.remove(M))})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const l=this._ngZone.onStable.pipe(Ft((0,Nn.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),l.unsubscribe())})})}_disposeScrollStrategy(){const l=this._scrollStrategy;l&&(l.disable(),l.detach&&l.detach())}_disposeBackdrop(l){l&&(l.parentNode&&l.parentNode.removeChild(l),this._backdropElement===l&&(this._backdropElement=null))}}const B_="cdk-overlay-connected-position-bounding-box",Oy=/([A-Za-z%]+)$/;class V_{constructor(l,t,a,_,M){this._viewportRuler=t,this._document=a,this._platform=_,this._overlayContainer=M,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new at.xQ,this._resizeSubscription=ki.w.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(l)}get positions(){return this._preferredPositions}attach(l){this._validatePositions(),l.hostElement.classList.add(B_),this._overlayRef=l,this._boundingBox=l.hostElement,this._pane=l.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const l=this._originRect,t=this._overlayRect,a=this._viewportRect,_=[];let M;for(let O of this._preferredPositions){let q=this._getOriginPoint(l,O),ce=this._getOverlayPoint(q,t,O),xe=this._getOverlayFit(ce,t,a,O);if(xe.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(O,q);this._canFitWithFlexibleDimensions(xe,ce,a)?_.push({position:O,origin:q,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(q,O)}):(!M||M.overlayFit.visibleArea<xe.visibleArea)&&(M={overlayFit:xe,overlayPoint:ce,originPoint:q,position:O,overlayRect:t})}if(_.length){let O=null,q=-1;for(const ce of _){const xe=ce.boundingBoxRect.width*ce.boundingBoxRect.height*(ce.position.weight||1);xe>q&&(q=xe,O=ce)}return this._isPushed=!1,void this._applyPosition(O.position,O.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(M.position,M.originPoint);this._applyPosition(M.position,M.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&eu(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(B_),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const l=this._lastPosition||this._preferredPositions[0],t=this._getOriginPoint(this._originRect,l);this._applyPosition(l,t)}}withScrollableContainers(l){return this._scrollables=l,this}withPositions(l){return this._preferredPositions=l,-1===l.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(l){return this._viewportMargin=l,this}withFlexibleDimensions(l=!0){return this._hasFlexibleDimensions=l,this}withGrowAfterOpen(l=!0){return this._growAfterOpen=l,this}withPush(l=!0){return this._canPush=l,this}withLockedPosition(l=!0){return this._positionLocked=l,this}setOrigin(l){return this._origin=l,this}withDefaultOffsetX(l){return this._offsetX=l,this}withDefaultOffsetY(l){return this._offsetY=l,this}withTransformOriginOn(l){return this._transformOriginSelector=l,this}_getOriginPoint(l,t){let a,_;if("center"==t.originX)a=l.left+l.width/2;else{const M=this._isRtl()?l.right:l.left,O=this._isRtl()?l.left:l.right;a="start"==t.originX?M:O}return _="center"==t.originY?l.top+l.height/2:"top"==t.originY?l.top:l.bottom,{x:a,y:_}}_getOverlayPoint(l,t,a){let _,M;return _="center"==a.overlayX?-t.width/2:"start"===a.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,M="center"==a.overlayY?-t.height/2:"top"==a.overlayY?0:-t.height,{x:l.x+_,y:l.y+M}}_getOverlayFit(l,t,a,_){const M=N_(t);let{x:O,y:q}=l,ce=this._getOffset(_,"x"),xe=this._getOffset(_,"y");ce&&(O+=ce),xe&&(q+=xe);let Ai=0-q,mn=q+M.height-a.height,Pn=this._subtractOverflows(M.width,0-O,O+M.width-a.width),Qi=this._subtractOverflows(M.height,Ai,mn),Aa=Pn*Qi;return{visibleArea:Aa,isCompletelyWithinViewport:M.width*M.height===Aa,fitsInViewportVertically:Qi===M.height,fitsInViewportHorizontally:Pn==M.width}}_canFitWithFlexibleDimensions(l,t,a){if(this._hasFlexibleDimensions){const _=a.bottom-t.y,M=a.right-t.x,O=G_(this._overlayRef.getConfig().minHeight),q=G_(this._overlayRef.getConfig().minWidth),xe=l.fitsInViewportHorizontally||null!=q&&q<=M;return(l.fitsInViewportVertically||null!=O&&O<=_)&&xe}return!1}_pushOverlayOnScreen(l,t,a){if(this._previousPushAmount&&this._positionLocked)return{x:l.x+this._previousPushAmount.x,y:l.y+this._previousPushAmount.y};const _=N_(t),M=this._viewportRect,O=Math.max(l.x+_.width-M.width,0),q=Math.max(l.y+_.height-M.height,0),ce=Math.max(M.top-a.top-l.y,0),xe=Math.max(M.left-a.left-l.x,0);let He=0,ut=0;return He=_.width<=M.width?xe||-O:l.x<this._viewportMargin?M.left-a.left-l.x:0,ut=_.height<=M.height?ce||-q:l.y<this._viewportMargin?M.top-a.top-l.y:0,this._previousPushAmount={x:He,y:ut},{x:l.x+He,y:l.y+ut}}_applyPosition(l,t){if(this._setTransformOrigin(l),this._setOverlayElementStyles(t,l),this._setBoundingBoxStyles(t,l),l.panelClass&&this._addPanelClasses(l.panelClass),this._lastPosition=l,this._positionChanges.observers.length){const a=this._getScrollVisibility(),_=new Kd(l,a);this._positionChanges.next(_)}this._isInitialRender=!1}_setTransformOrigin(l){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let a,_=l.overlayY;a="center"===l.overlayX?"center":this._isRtl()?"start"===l.overlayX?"right":"left":"start"===l.overlayX?"left":"right";for(let M=0;M<t.length;M++)t[M].style.transformOrigin=`${a} ${_}`}_calculateBoundingBoxRect(l,t){const a=this._viewportRect,_=this._isRtl();let M,O,q,He,ut,Ai;if("top"===t.overlayY)O=l.y,M=a.height-O+this._viewportMargin;else if("bottom"===t.overlayY)q=a.height-l.y+2*this._viewportMargin,M=a.height-q+this._viewportMargin;else{const mn=Math.min(a.bottom-l.y+a.top,l.y),Pn=this._lastBoundingBoxSize.height;M=2*mn,O=l.y-mn,M>Pn&&!this._isInitialRender&&!this._growAfterOpen&&(O=l.y-Pn/2)}if("end"===t.overlayX&&!_||"start"===t.overlayX&&_)Ai=a.width-l.x+this._viewportMargin,He=l.x-this._viewportMargin;else if("start"===t.overlayX&&!_||"end"===t.overlayX&&_)ut=l.x,He=a.right-l.x;else{const mn=Math.min(a.right-l.x+a.left,l.x),Pn=this._lastBoundingBoxSize.width;He=2*mn,ut=l.x-mn,He>Pn&&!this._isInitialRender&&!this._growAfterOpen&&(ut=l.x-Pn/2)}return{top:O,left:ut,bottom:q,right:Ai,width:He,height:M}}_setBoundingBoxStyles(l,t){const a=this._calculateBoundingBoxRect(l,t);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));const _={};if(this._hasExactPosition())_.top=_.left="0",_.bottom=_.right=_.maxHeight=_.maxWidth="",_.width=_.height="100%";else{const M=this._overlayRef.getConfig().maxHeight,O=this._overlayRef.getConfig().maxWidth;_.height=Ci(a.height),_.top=Ci(a.top),_.bottom=Ci(a.bottom),_.width=Ci(a.width),_.left=Ci(a.left),_.right=Ci(a.right),_.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",_.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",M&&(_.maxHeight=Ci(M)),O&&(_.maxWidth=Ci(O))}this._lastBoundingBoxSize=a,eu(this._boundingBox.style,_)}_resetBoundingBoxStyles(){eu(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){eu(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(l,t){const a={},_=this._hasExactPosition(),M=this._hasFlexibleDimensions,O=this._overlayRef.getConfig();if(_){const He=this._viewportRuler.getViewportScrollPosition();eu(a,this._getExactOverlayY(t,l,He)),eu(a,this._getExactOverlayX(t,l,He))}else a.position="static";let q="",ce=this._getOffset(t,"x"),xe=this._getOffset(t,"y");ce&&(q+=`translateX(${ce}px) `),xe&&(q+=`translateY(${xe}px)`),a.transform=q.trim(),O.maxHeight&&(_?a.maxHeight=Ci(O.maxHeight):M&&(a.maxHeight="")),O.maxWidth&&(_?a.maxWidth=Ci(O.maxWidth):M&&(a.maxWidth="")),eu(this._pane.style,a)}_getExactOverlayY(l,t,a){let _={top:"",bottom:""},M=this._getOverlayPoint(t,this._overlayRect,l);this._isPushed&&(M=this._pushOverlayOnScreen(M,this._overlayRect,a));let O=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return M.y-=O,"bottom"===l.overlayY?_.bottom=this._document.documentElement.clientHeight-(M.y+this._overlayRect.height)+"px":_.top=Ci(M.y),_}_getExactOverlayX(l,t,a){let O,_={left:"",right:""},M=this._getOverlayPoint(t,this._overlayRect,l);return this._isPushed&&(M=this._pushOverlayOnScreen(M,this._overlayRect,a)),O=this._isRtl()?"end"===l.overlayX?"left":"right":"end"===l.overlayX?"right":"left","right"===O?_.right=this._document.documentElement.clientWidth-(M.x+this._overlayRect.width)+"px":_.left=Ci(M.x),_}_getScrollVisibility(){const l=this._getOriginRect(),t=this._pane.getBoundingClientRect(),a=this._scrollables.map(_=>_.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:Sr(l,a),isOriginOutsideView:Kc(l,a),isOverlayClipped:Sr(t,a),isOverlayOutsideView:Kc(t,a)}}_subtractOverflows(l,...t){return t.reduce((a,_)=>a-Math.max(_,0),l)}_getNarrowedViewportRect(){const l=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+l-this._viewportMargin,bottom:a.top+t-this._viewportMargin,width:l-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(l,t){return"x"===t?l.offsetX??this._offsetX:l.offsetY??this._offsetY}_validatePositions(){}_addPanelClasses(l){this._pane&&lc(l).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(l=>{this._pane.classList.remove(l)}),this._appliedPanelClasses=[])}_getOriginRect(){const l=this._origin;if(l instanceof d.SBq)return l.nativeElement.getBoundingClientRect();if(l instanceof Element)return l.getBoundingClientRect();const t=l.width||0,a=l.height||0;return{top:l.y,bottom:l.y+a,left:l.x,right:l.x+t,height:a,width:t}}}function eu(s,l){for(let t in l)l.hasOwnProperty(t)&&(s[t]=l[t]);return s}function G_(s){if("number"!=typeof s&&null!=s){const[l,t]=s.split(Oy);return t&&"px"!==t?null:parseFloat(l)}return s||null}function N_(s){return{top:Math.floor(s.top),right:Math.floor(s.right),bottom:Math.floor(s.bottom),left:Math.floor(s.left),width:Math.floor(s.width),height:Math.floor(s.height)}}class Ly{constructor(l,t,a,_,M,O,q){this._preferredPositions=[],this._positionStrategy=new V_(a,_,M,O,q).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(l,t),this.onPositionChange=this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(l){this._overlayRef=l,this._positionStrategy.attach(l),this._direction&&(l.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(l){this._positionStrategy.withScrollableContainers(l)}withFallbackPosition(l,t,a,_){const M=new Xd(l,t,a,_);return this._preferredPositions.push(M),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(l){return this._overlayRef?this._overlayRef.setDirection(l):this._direction=l,this}withOffsetX(l){return this._positionStrategy.withDefaultOffsetX(l),this}withOffsetY(l){return this._positionStrategy.withDefaultOffsetY(l),this}withLockedPosition(l){return this._positionStrategy.withLockedPosition(l),this}withPositions(l){return this._preferredPositions=l.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(l){return this._positionStrategy.setOrigin(l),this}}const U_="cdk-global-overlay-wrapper";class Ry{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(l){const t=l.getConfig();this._overlayRef=l,this._width&&!t.width&&l.updateSize({width:this._width}),this._height&&!t.height&&l.updateSize({height:this._height}),l.hostElement.classList.add(U_),this._isDisposed=!1}top(l=""){return this._bottomOffset="",this._topOffset=l,this._alignItems="flex-start",this}left(l=""){return this._rightOffset="",this._leftOffset=l,this._justifyContent="flex-start",this}bottom(l=""){return this._topOffset="",this._bottomOffset=l,this._alignItems="flex-end",this}right(l=""){return this._leftOffset="",this._rightOffset=l,this._justifyContent="flex-end",this}width(l=""){return this._overlayRef?this._overlayRef.updateSize({width:l}):this._width=l,this}height(l=""){return this._overlayRef?this._overlayRef.updateSize({height:l}):this._height=l,this}centerHorizontally(l=""){return this.left(l),this._justifyContent="center",this}centerVertically(l=""){return this.top(l),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const l=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:_,height:M,maxWidth:O,maxHeight:q}=a,ce=!("100%"!==_&&"100vw"!==_||O&&"100%"!==O&&"100vw"!==O),xe=!("100%"!==M&&"100vh"!==M||q&&"100%"!==q&&"100vh"!==q);l.position=this._cssPosition,l.marginLeft=ce?"0":this._leftOffset,l.marginTop=xe?"0":this._topOffset,l.marginBottom=this._bottomOffset,l.marginRight=this._rightOffset,ce?t.justifyContent="flex-start":"center"===this._justifyContent?t.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?t.justifyContent="flex-end":"flex-end"===this._justifyContent&&(t.justifyContent="flex-start"):t.justifyContent=this._justifyContent,t.alignItems=xe?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const l=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,a=t.style;t.classList.remove(U_),a.justifyContent=a.alignItems=l.marginTop=l.marginBottom=l.marginLeft=l.marginRight=l.position="",this._overlayRef=null,this._isDisposed=!0}}let Py=(()=>{class s{constructor(t,a,_,M){this._viewportRuler=t,this._document=a,this._platform=_,this._overlayContainer=M}global(){return new Ry}connectedTo(t,a,_){return new Ly(a,_,t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}flexibleConnectedTo(t){return new V_(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(qe),d.LFG(je.K0),d.LFG(Yt),d.LFG(Bl))},s.\u0275prov=d.Yz7({factory:function(){return new s(d.LFG(qe),d.LFG(je.K0),d.LFG(Yt),d.LFG(Bl))},token:s,providedIn:"root"}),s})(),zy=0,tu=(()=>{class s{constructor(t,a,_,M,O,q,ce,xe,He,ut,Ai){this.scrollStrategies=t,this._overlayContainer=a,this._componentFactoryResolver=_,this._positionBuilder=M,this._keyboardDispatcher=O,this._injector=q,this._ngZone=ce,this._document=xe,this._directionality=He,this._location=ut,this._outsideClickDispatcher=Ai}create(t){const a=this._createHostElement(),_=this._createPaneElement(a),M=this._createPortalOutlet(_),O=new Jc(t);return O.direction=O.direction||this._directionality.value,new Ma(M,a,_,O,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(t){const a=this._document.createElement("div");return a.id="cdk-overlay-"+zy++,a.classList.add("cdk-overlay-pane"),t.appendChild(a),a}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(d.z2F)),new Mi(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(wa),d.LFG(Bl),d.LFG(d._Vd),d.LFG(Py),d.LFG(Qc),d.LFG(d.zs3),d.LFG(d.R0b),d.LFG(je.K0),d.LFG(pn),d.LFG(je.Ye),d.LFG(Jd))},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac}),s})();const Ny={provide:new d.OlP("cdk-connected-overlay-scroll-strategy"),deps:[tu],useFactory:function Gy(s){return()=>s.scrollStrategies.reposition()}};let Ig=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({providers:[tu,Ny],imports:[bo,Ar,Xt,Xt]}),s})();var q_=dt(8514),_t=dt(7340);function Uy(s,l){}class Fg{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.closeOnNavigation=!0}}const jy={dialogContainer:(0,_t.X$)("dialogContainer",[(0,_t.SB)("void, exit",(0,_t.oB)({opacity:0,transform:"scale(0.7)"})),(0,_t.SB)("enter",(0,_t.oB)({transform:"none"})),(0,_t.eR)("* => enter",(0,_t.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,_t.oB)({transform:"none",opacity:1}))),(0,_t.eR)("* => void, * => exit",(0,_t.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,_t.oB)({opacity:0})))])};let Hy=(()=>{class s extends Hi{constructor(t,a,_,M,O,q){super(),this._elementRef=t,this._focusTrapFactory=a,this._changeDetectorRef=_,this._config=O,this._focusMonitor=q,this._animationStateChanged=new d.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=ce=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(ce)),this._ariaLabelledBy=O.ariaLabelledBy||null,this._document=M}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}attachComponentPortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(t)}_recaptureFocus(){this._containsFocus()||(!this._config.autoFocus||!this._focusTrap.focusInitialElement())&&this._elementRef.nativeElement.focus()}_trapFocus(){this._config.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){const t=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&t&&"function"==typeof t.focus){const a=kc(),_=this._elementRef.nativeElement;(!a||a===this._document.body||a===_||_.contains(a))&&(this._focusMonitor?(this._focusMonitor.focusVia(t,this._closeInteractionType),this._closeInteractionType=null):t.focus())}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=kc())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const t=this._elementRef.nativeElement,a=kc();return t===a||t.contains(a)}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(d.SBq),d.Y36(hh),d.Y36(d.sBO),d.Y36(je.K0,8),d.Y36(Fg),d.Y36(ma))},s.\u0275dir=d.lG2({type:s,viewQuery:function(t,a){if(1&t&&d.Gf(Ii,7),2&t){let _;d.iGM(_=d.CRH())&&(a._portalOutlet=_.first)}},features:[d.qOj]}),s})(),qy=(()=>{class s extends Hy{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:t,totalTime:a}){"enter"===t?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:a})):"exit"===t&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:a}))}_onAnimationStart({toState:t,totalTime:a}){"enter"===t?this._animationStateChanged.next({state:"opening",totalTime:a}):("exit"===t||"void"===t)&&this._animationStateChanged.next({state:"closing",totalTime:a})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return s.\u0275fac=function(){let l;return function(a){return(l||(l=d.n5z(s)))(a||s)}}(),s.\u0275cmp=d.Xpm({type:s,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(t,a){1&t&&d.WFA("@dialogContainer.start",function(M){return a._onAnimationStart(M)})("@dialogContainer.done",function(M){return a._onAnimationDone(M)}),2&t&&(d.Ikx("id",a._id),d.uIk("role",a._config.role)("aria-labelledby",a._config.ariaLabel?null:a._ariaLabelledBy)("aria-label",a._config.ariaLabel)("aria-describedby",a._config.ariaDescribedBy||null),d.d8E("@dialogContainer",a._state))},features:[d.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,a){1&t&&d.YNc(0,Uy,0,0,"ng-template",0)},dependencies:[Ii],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[jy.dialogContainer]}}),s})(),$y=0;class Og{constructor(l,t,a="mat-dialog-"+$y++){this._overlayRef=l,this._containerInstance=t,this.id=a,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new at.xQ,this._afterClosed=new at.xQ,this._beforeClosed=new at.xQ,this._state=0,t._id=a,t._animationStateChanged.pipe((0,ci.h)(_=>"opened"===_.state),(0,On.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),t._animationStateChanged.pipe((0,ci.h)(_=>"closed"===_.state),(0,On.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),l.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),l.keydownEvents().pipe((0,ci.h)(_=>27===_.keyCode&&!this.disableClose&&!function Zr(s,...l){return l.length?l.some(t=>s[t]):s.altKey||s.shiftKey||s.ctrlKey||s.metaKey}(_))).subscribe(_=>{_.preventDefault(),Lg(this,"keyboard")}),l.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():Lg(this,"mouse")})}close(l){this._result=l,this._containerInstance._animationStateChanged.pipe((0,ci.h)(t=>"closing"===t.state),(0,On.q)(1)).subscribe(t=>{this._beforeClosed.next(l),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(l){let t=this._getPositionStrategy();return l&&(l.left||l.right)?l.left?t.left(l.left):t.right(l.right):t.centerHorizontally(),l&&(l.top||l.bottom)?l.top?t.top(l.top):t.bottom(l.bottom):t.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(l="",t=""){return this._overlayRef.updateSize({width:l,height:t}),this._overlayRef.updatePosition(),this}addPanelClass(l){return this._overlayRef.addPanelClass(l),this}removePanelClass(l){return this._overlayRef.removePanelClass(l),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function Lg(s,l,t){return void 0!==s._containerInstance&&(s._containerInstance._closeInteractionType=l),s.close(t)}const Zy=new d.OlP("MatDialogData"),Yy=new d.OlP("mat-dialog-default-options"),$_=new d.OlP("mat-dialog-scroll-strategy"),Xy={provide:$_,deps:[tu],useFactory:function Wy(s){return()=>s.scrollStrategies.block()}};let Ky=(()=>{class s{constructor(t,a,_,M,O,q,ce,xe,He){this._overlay=t,this._injector=a,this._defaultOptions=_,this._parentDialog=M,this._overlayContainer=O,this._dialogRefConstructor=ce,this._dialogContainerType=xe,this._dialogDataToken=He,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new at.xQ,this._afterOpenedAtThisLevel=new at.xQ,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,q_.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,ar.O)(void 0))),this._scrollStrategy=q}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(t,a){a=function Jy(s,l){return Object.assign(Object.assign({},l),s)}(a,this._defaultOptions||new Fg),a.id&&this.getDialogById(a.id);const _=this._createOverlay(a),M=this._attachDialogContainer(_,a),O=this._attachDialogContent(t,M,_,a);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(O),O.afterClosed().subscribe(()=>this._removeOpenDialog(O)),this.afterOpened.next(O),M._initializeWithAttachedContent(),O}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(a=>a.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(t){const a=this._getOverlayConfig(t);return this._overlay.create(a)}_getOverlayConfig(t){const a=new Jc({positionStrategy:this._overlay.position().global(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(a.backdropClass=t.backdropClass),a}_attachDialogContainer(t,a){const M=d.zs3.create({parent:a&&a.viewContainerRef&&a.viewContainerRef.injector||this._injector,providers:[{provide:Fg,useValue:a}]}),O=new ji(this._dialogContainerType,a.viewContainerRef,M,a.componentFactoryResolver);return t.attach(O).instance}_attachDialogContent(t,a,_,M){const O=new this._dialogRefConstructor(_,a,M.id);if(t instanceof d.Rgc)a.attachTemplatePortal(new Bt(t,null,{$implicit:M.data,dialogRef:O}));else{const q=this._createInjector(M,O,a),ce=a.attachComponentPortal(new ji(t,M.viewContainerRef,q));O.componentInstance=ce.instance}return O.updateSize(M.width,M.height).updatePosition(M.position),O}_createInjector(t,a,_){const M=t&&t.viewContainerRef&&t.viewContainerRef.injector,O=[{provide:this._dialogContainerType,useValue:_},{provide:this._dialogDataToken,useValue:t.data},{provide:this._dialogRefConstructor,useValue:a}];return t.direction&&(!M||!M.get(pn,null,d.XFs.Optional))&&O.push({provide:pn,useValue:{value:t.direction,change:(0,or.of)()}}),d.zs3.create({parent:M||this._injector,providers:O})}_removeOpenDialog(t){const a=this.openDialogs.indexOf(t);a>-1&&(this.openDialogs.splice(a,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((_,M)=>{_?M.setAttribute("aria-hidden",_):M.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const t=this._overlayContainer.getContainerElement();if(t.parentElement){const a=t.parentElement.children;for(let _=a.length-1;_>-1;_--){let M=a[_];M!==t&&"SCRIPT"!==M.nodeName&&"STYLE"!==M.nodeName&&!M.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(M,M.getAttribute("aria-hidden")),M.setAttribute("aria-hidden","true"))}}}_closeDialogs(t){let a=t.length;for(;a--;)t[a].close()}}return s.\u0275fac=function(t){return new(t||s)(d.Y36(tu),d.Y36(d.zs3),d.Y36(void 0),d.Y36(void 0),d.Y36(Bl),d.Y36(void 0),d.Y36(d.DyG),d.Y36(d.DyG),d.Y36(d.OlP))},s.\u0275dir=d.lG2({type:s}),s})(),Rg=(()=>{class s extends Ky{constructor(t,a,_,M,O,q,ce){super(t,a,M,q,ce,O,Og,qy,Zy)}}return s.\u0275fac=function(t){return new(t||s)(d.LFG(tu),d.LFG(d.zs3),d.LFG(je.Ye,8),d.LFG(Yy,8),d.LFG($_),d.LFG(s,12),d.LFG(Bl))},s.\u0275prov=d.Yz7({token:s,factory:s.\u0275fac}),s})(),Y_=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({providers:[Rg,Xy],imports:[Ig,Ar,Wt,Wt]}),s})();dt(1737),dt(7221),dt(537),dt(2474);let fx=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Wt,Wt]}),s})(),mx=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Wt,Wt]}),s})(),Tx=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[vs,gh,Wt,Pd,je.ez,vs,Wt,Pd,mx]}),s})(),Vx=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[vs,Wt,vs,Wt]}),s})(),Gg=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[je.ez,Wt,xd,Wt]}),s})();const Cv={provide:new d.OlP("mat-select-scroll-strategy"),deps:[tu],useFactory:function bv(s){return()=>s.scrollStrategies.reposition()}};let Ev=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({providers:[Cv],imports:[je.ez,Ig,Nd,Wt,$t,Gg,Nd,Wt]}),s})();dt(7604);let Gv=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[je.ez,Wt,Sl,$t,$t,Wt]}),s})(),qv=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Wt,Wt]}),s})();dt(8896);let Dy=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Sl]}),s})(),Jv=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({providers:[Kr],imports:[Dy,Gg,Wt,Dy,Gg]}),s})(),s0=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[Ig,Ar,je.ez,xh,Wt,Wt]}),s})(),l0=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[xh,Ff,Y_,Vx,fx,Tx,Gv,qv,Y_,Ev,Pf,Jv,s0]}),s})(),c0=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.oAB({type:s}),s.\u0275inj=d.cJS({imports:[je.ez,fn,l0,Xa,ur.JF,vp]}),s})()},9898:function(jg){jg.exports=function(){"use strict";var Sa,dt,je;function ur(h,Be){if(Sa)if(dt){var hr="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Sa+")(sharedChunk); ("+dt+")(sharedChunk); self.onerror = null;",_i={};Sa(_i),je=Be(_i),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(je.workerUrl=window.URL.createObjectURL(new Blob([hr],{type:"text/javascript"})))}else dt=Be;else Sa=Be}return ur(0,function(h){var Be=typeof self<"u"?self:{},hr=_i;function _i(n,e,i,o){this.cx=3*n,this.bx=3*(i-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=o,this.p2x=i,this.p2y=o}_i.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},_i.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},_i.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},_i.prototype.solveCurveX=function(n,e){var i,o,u,f,g;for(void 0===e&&(e=1e-6),u=n,g=0;g<8;g++){if(f=this.sampleCurveX(u)-n,Math.abs(f)<e)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=f/y}if((u=n)<(i=0))return i;if(u>(o=1))return o;for(;i<o;){if(f=this.sampleCurveX(u),Math.abs(f-n)<e)return u;n>f?i=u:o=u,u=.5*(o-i)+i}return u},_i.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var Ue=St;function St(n,e){this.x=n,this.y=e}St.prototype={clone:function(){return new St(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(n,e){var i=Math.cos(n),o=Math.sin(n),u=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},St.convert=function(n){return n instanceof St?n:Array.isArray(n)?new St(n[0],n[1]):n};const en=Math.PI/180,zn=180/Math.PI;function mt(n){return n*en}function oi(n){return n*zn}const Ea=[[0,0],[1,0],[1,1],[0,1]];function Go(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function eo(n,e,i,o){const u=new hr(n,e,i,o);return function(f){return u.solve(f)}}const No=eo(.25,.1,.25,1);function yt(n,e,i){return Math.min(i,Math.max(e,n))}function kn(n,e,i){return(i=yt((i-n)/(e-n),0,1))*i*(3-2*i)}function Er(n,e,i){const o=i-e,u=((n-e)%o+o)%o+e;return u===e?i:u}function tn(n,e,i){if(!n.length)return i(null,[]);let o=n.length;const u=new Array(n.length);let f=null;n.forEach((g,y)=>{e(g,(b,w)=>{b&&(f=b),u[y]=w,0==--o&&i(f,u)})})}function to(n){const e=[];for(const i in n)e.push(n[i]);return e}function Gt(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let $n=1;function Uo(){return $n++}function As(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Ss(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Es(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function dr(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function io(n,e){return-1!==n.indexOf(e,n.length-e.length)}function Bn(n,e,i){const o={};for(const u in n)o[u]=e.call(i||this,n[u],u,n);return o}function Tr(n,e,i){const o={};for(const u in n)e.call(i||this,n[u],u,n)&&(o[u]=n[u]);return o}function gn(n){return Array.isArray(n)?n.map(gn):"object"==typeof n&&n?Bn(n,gn):n}const jo={};function ai(n){jo[n]||(typeof console<"u"&&console.warn(n),jo[n]=!0)}function Bi(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Zn(n){let e=0;for(let i,o,u=0,f=n.length,g=f-1;u<f;g=u++)i=n[u],o=n[g],e+=(o.x-i.x)*(i.y+o.y);return e}function cn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Yn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,u,f)=>{const g=u||f;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let pr=null;function no(n){if(null==pr){const e=n.navigator?n.navigator.userAgent:null;pr=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return pr}function Ho(n){try{const e=Be[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Vn(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Ts=Be.performance;function fr(n){const e=n?n.url.toString():void 0;return Ts.getEntriesByName(e)}let Dt,Wn,mr,_n;const yn={now:()=>void 0!==mr?mr:Be.performance.now(),setNow(n){mr=n},restoreNow(){mr=void 0},frame(n){const e=Be.requestAnimationFrame(n);return{cancel:()=>Be.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:o}=n;_n||(_n=Be.document.createElement("canvas"));const u=_n.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return(i>_n.width||o>_n.height)&&(_n.width=i,_n.height=o),u.clearRect(-e,-e,i+2*e,o+2*e),u.drawImage(n,0,0,i,o),u.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:n=>(Dt||(Dt=Be.document.createElement("a")),Dt.href=n,Dt.href),get devicePixelRatio(){return Be.devicePixelRatio},get prefersReducedMotion(){return!!Be.matchMedia&&(null==Wn&&(Wn=Be.matchMedia("(prefers-reduced-motion: reduce)")),Wn.matches)}};let ro;const kt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ro){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ro=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{ro=n}}return ro},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},bi={supported:!1,testSupport:function(n){!qo&&Xn&&(ks?Ds(n):Oi=n)}};let Oi,Xn,qo=!1,ks=!1;function Ds(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Xn),n.isContextLost())return;bi.supported=!0}catch{}n.deleteTexture(e),qo=!0}Be.document&&(Xn=Be.document.createElement("img"),Xn.onload=function(){Oi&&Ds(Oi),Oi=null,ks=!0},Xn.onerror=function(){qo=!0,Oi=null},Xn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Is="01",nn="NO_ACCESS_TOKEN";function xn(n){return 0===n.indexOf("mapbox:")}function oo(n){return kt.API_URL_REGEX.test(n)}const $o=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function vn(n){const e=n.match($o);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Dr(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function Vl(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Be.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ta{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Vl(kt.ACCESS_TOKEN);let o="";return o=i&&i.u?Be.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):kt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=Ho("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const u=Be.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const f=Be.localStorage.getItem(o);f&&(this.anonId=f)}catch{ai("Unable to read from LocalStorage")}}saveEventData(){const e=Ho("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{Be.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&Be.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{ai("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,o,u){if(!kt.EVENTS_URL)return;const f=vn(kt.EVENTS_URL);f.params.push(`access_token=${u||kt.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.10.0",skuId:Is,userId:this.anonId},y=i?Gt(g,i):g,b={url:Dr(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=De(b,w=>{this.pendingRequest=null,o(w),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const ka=new class extends Ta{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){kt.EVENTS_URL&&kt.ACCESS_TOKEN&&Array.isArray(n)&&n.some(i=>xn(i)||oo(i))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Vl(kt.ACCESS_TOKEN),i=e?e.u:kt.ACCESS_TOKEN;let o=i!==this.eventData.tokenU;Es(this.anonId)||(this.anonId=As(),o=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;o=o||y>=1||y<-1||f.getDate()!==g.getDate()}else o=!0;o?this.postEvent(u,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},n):this.processRequests()}},Da=ka.postTurnstileEvent.bind(ka),Ia=new class extends Ta{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,i,o){this.skuToken=e,this.errorCb=o,kt.EVENTS_URL&&(i||kt.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(nn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Es(this.anonId)||(this.anonId=As()),this.postEvent(i,{skuToken:this.skuToken},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},n))}},Gl=Ia.postMapLoadEvent.bind(Ia),Fa=new class extends Ta{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,i,o){if(!kt.API_URL||!kt.SESSION_PATH)return;const u=vn(kt.API_URL+kt.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${o||kt.ACCESS_TOKEN||""}`);const f={url:Dr(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=We(f,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(o)})}getSessionAPI(n,e,i,o){this.skuToken=e,this.errorCb=o,kt.SESSION_PATH&&kt.API_URL&&(i||kt.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},i):this.errorCb(new Error(nn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},n)}},Oa=Fa.getSessionAPI.bind(Fa),Ir=new Set;let gr,Zo=500,Yo=50,Li={};function Fr(n){const e=z(n);let i,o;e&&e.forEach(f=>{const g=f.split("=");"language"===g[0]?i=g[1]:"worldview"===g[0]&&(o=g[1])});let u="mapbox-tiles";return i&&(u+=`-${i}`),o&&(u+=`-${o}`),u}function Y(){try{return Be.caches}catch{}}function R(n){const e=Y();e&&!Li[n]&&(Li[n]=e.open(n))}function z(n){const e=n.indexOf("?");return e>0?n.slice(e+1).split("&"):[]}function W(n){const e=n.indexOf("?");if(e<0)return n;const i=z(n).filter(o=>{const u=o.split("=");return"language"===u[0]||"worldview"===u[0]});return i.length?`${n.slice(0,e)}?${i.join("&")}`:n.slice(0,e)}let Q=1/0;const ue={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ue);class fe extends Error{constructor(e,i,o){401===i&&oo(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pe=cn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Be.location.protocol?Be.parent:Be).location.href,he=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(pe())&&!/^\w+:/.test(i))){if(Be.fetch&&Be.Request&&Be.AbortController&&Be.Request.prototype.hasOwnProperty("signal"))return function(o,u){const f=new Be.AbortController,g=new Be.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:pe(),signal:f.signal});let y=!1,b=!1;const w=(S=g.url).indexOf("sku=")>0&&oo(S);var S;"json"===o.type&&g.headers.set("Accept","application/json");const T=(F,L,B)=>{if(b)return;if(F&&"SecurityError"!==F.message&&ai(F),L&&B)return k(L);const G=Date.now();Be.fetch(g).then(X=>{if(X.ok){const ie=w?X.clone():null;return k(X,ie,G)}return u(new fe(X.statusText,X.status,o.url))}).catch(X=>{20!==X.code&&u(new Error(X.message))})},k=(F,L,B)=>{("arrayBuffer"===o.type?F.arrayBuffer():"json"===o.type?F.json():F.text()).then(G=>{b||(L&&B&&function(X,ie,J){const ee=Fr(X.url);if(R(ee),!Li[ee])return;const le={status:ie.status,statusText:ie.statusText,headers:new Be.Headers};ie.headers.forEach((ye,Me)=>le.headers.set(Me,ye));const ne=Yn(ie.headers.get("Cache-Control")||"");if(ne["no-store"])return;ne["max-age"]&&le.headers.set("Expires",new Date(J+1e3*ne["max-age"]).toUTCString());const ve=le.headers.get("Expires");ve&&(new Date(ve).getTime()-J<42e4||function(ye,Me){if(void 0===gr)try{new Response(new ReadableStream),gr=!0}catch{gr=!1}gr?Me(ye.body):ye.blob().then(Me)}(ie,ye=>{const Me=new Be.Response(ye,le);R(ee),Li[ee]&&Li[ee].then(ze=>ze.put(W(X.url),Me)).catch(ze=>ai(ze.message))}))}(g,L,B),y=!0,u(null,G,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(G=>{b||u(new Error(G.message))})};return w?function(F,L){const B=Fr(F.url);if(R(B),!Li[B])return L(null);const G=W(F.url);Li[B].then(X=>{X.match(G).then(ie=>{const J=function(ee){if(!ee)return!1;const le=new Date(ee.headers.get("Expires")||0),ne=Yn(ee.headers.get("Cache-Control")||"");return le>Date.now()&&!ne["no-cache"]}(ie);X.delete(G),J&&X.put(G,ie.clone()),L(null,ie,J)}).catch(L)}).catch(L)}(g,T):T(null,null),{cancel:()=>{b=!0,y||f.abort()}}}(n,e);if(cn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(o,u){const f=new Be.XMLHttpRequest;f.open(o.method||"GET",o.url,!0),"arrayBuffer"===o.type&&(f.responseType="arraybuffer");for(const g in o.headers)f.setRequestHeader(g,o.headers[g]);return"json"===o.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===o.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===o.type)try{g=JSON.parse(f.response)}catch(y){return u(y)}u(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new fe(f.statusText,f.status,o.url))},f.send(o.body),{cancel:()=>f.abort()}}(n,e)},ge=function(n,e){return he(Gt(n,{type:"arrayBuffer"}),e)},De=function(n,e){return he(Gt(n,{method:"POST"}),e)},We=function(n,e){return he(Gt(n,{method:"GET"}),e)};function Oe(n){const e=Be.document.createElement("a");return e.href=n,e.protocol===Be.document.location.protocol&&e.host===Be.document.location.host}const rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let st,et;st=[],et=0;const ot=function(n,e){if(bi.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),et>=kt.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return st.push(f),f}et++;let i=!1;const o=()=>{if(!i)for(i=!0,et--;st.length&&et<kt.MAX_PARALLEL_IMAGE_REQUESTS;){const f=st.shift(),{requestParameters:g,callback:y,cancelled:b}=f;b||(f.cancel=ot(g,y).cancel)}},u=ge(n,(f,g,y,b)=>{o(),f?e(f):g&&(Be.createImageBitmap?function(w,S){const T=new Be.Blob([new Uint8Array(w)],{type:"image/png"});Be.createImageBitmap(T).then(k=>{S(null,k)}).catch(k=>{S(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(w,S)=>e(w,S,y,b)):function(w,S){const T=new Be.Image,k=Be.URL;T.onload=()=>{S(null,T),k.revokeObjectURL(T.src),T.onload=null,Be.requestAnimationFrame(()=>{T.src=rt})},T.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Be.Blob([new Uint8Array(w)],{type:"image/png"});T.src=w.byteLength?k.createObjectURL(F):rt}(g,(w,S)=>e(w,S,y,b)))});return{cancel:()=>{u.cancel(),o()}}};function xt(n,e,i){i[n]&&-1!==i[n].indexOf(e)||(i[n]=i[n]||[],i[n].push(e))}function Nt(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);-1!==o&&i[n].splice(o,1)}}class Kt{constructor(e,i={}){Gt(this,i),this.type=e}}class jt extends Kt{constructor(e,i={}){super("error",Gt({error:e},i))}}class tt{on(e,i){return this._listeners=this._listeners||{},xt(e,i,this._listeners),this}off(e,i){return Nt(e,i,this._listeners),Nt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},xt(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){"string"==typeof e&&(e=new Kt(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of f)Nt(o,y,this._oneTimeListeners),y.call(this,e);const g=this._eventedParent;g&&(Gt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof jt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Ce=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function bn(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}function pi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Or(n){if(Array.isArray(n))return n.map(Or);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Or(n[i]);return e}return pi(n)}class Fs extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Gn=Fs;class Nl{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new Nl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Ch=Nl;const so={kind:"null"},Xe={kind:"number"},Mt={kind:"string"},Et={kind:"boolean"},Dn={kind:"color"},wn={kind:"object"},vt={kind:"value"},La={kind:"collator"},Os={kind:"formatted"},_r={kind:"resolvedImage"};function Vi(n,e){return{kind:"array",itemType:n,N:e}}function li(n){if("array"===n.kind){const e=li(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const Ul=[so,Xe,Mt,Et,Dn,Os,wn,Vi(vt),_r];function ao(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ao(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const i of Ul)if(!ao(i,e))return null}return`Expected ${li(n)} but found ${li(e)} instead.`}function jl(n,e){return e.some(i=>i.kind===n.kind)}function Lr(n,e){return e.some(i=>"null"===i?null===n:"array"===i?Array.isArray(n):"object"===i?n&&!Array.isArray(n)&&"object"==typeof n:i===typeof n)}function Ra(n){var e={exports:{}};return n(e,e.exports),e.exports}var lo=Ra(function(n,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(y){return(y=Math.round(y))<0?0:y>255?255:y}function u(y){return o("%"===y[y.length-1]?parseFloat(y)/100*255:parseInt(y))}function f(y){return(b="%"===y[y.length-1]?parseFloat(y)/100:parseFloat(y))<0?0:b>1?1:b;var b}function g(y,b,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?y+(b-y)*w*6:2*w<1?b:3*w<2?y+(b-y)*(2/3-w)*6:y}try{e.parseCSSColor=function(y){var b,w=y.replace(/ /g,"").toLowerCase();if(w in i)return i[w].slice();if("#"===w[0])return 4===w.length?(b=parseInt(w.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===w.length&&(b=parseInt(w.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var S=w.indexOf("("),T=w.indexOf(")");if(-1!==S&&T+1===w.length){var k=w.substr(0,S),F=w.substr(S+1,T-(S+1)).split(","),L=1;switch(k){case"rgba":if(4!==F.length)return null;L=f(F.pop());case"rgb":return 3!==F.length?null:[u(F[0]),u(F[1]),u(F[2]),L];case"hsla":if(4!==F.length)return null;L=f(F.pop());case"hsl":if(3!==F.length)return null;var B=(parseFloat(F[0])%360+360)%360/360,G=f(F[1]),X=f(F[2]),ie=X<=.5?X*(G+1):X+G-X*G,J=2*X-ie;return[o(255*g(J,ie,B+1/3)),o(255*g(J,ie,B)),o(255*g(J,ie,B-1/3)),L];default:return null}}return null}}catch{}});class un{constructor(e,i,o,u=1){this.r=e,this.g=i,this.b=o,this.a=u}static parse(e){if(!e)return;if(e instanceof un)return e;if("string"!=typeof e)return;const i=lo.parseCSSColor(e);return i?new un(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,o,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${u})`}toArray(){const{r:e,g:i,b:o,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*i/u,255*o/u,u]}toArray01(){const{r:e,g:i,b:o,a:u}=this;return 0===u?[0,0,0,0]:[e/u,i/u,o/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:u}=this;return[e,i,o,u]}}un.black=new un(0,0,0,1),un.white=new un(1,1,1,1),un.transparent=new un(0,0,0,0),un.red=new un(1,0,0,1),un.blue=new un(0,0,1,1);var Jt=un;class ru{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ls{constructor(e,i,o,u,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=f}}class rn{constructor(e){this.sections=e}static fromString(e){return new rn([new Ls(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof rn?e:rn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(o)}return e}}class hn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new hn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Pa(n,e,i,o){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===o||"number"==typeof o&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof o?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yr(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof Jt||n instanceof ru||n instanceof rn||n instanceof hn)return!0;if(Array.isArray(n)){for(const e of n)if(!yr(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!yr(n[e]))return!1;return!0}return!1}function wi(n){if(null===n)return so;if("string"==typeof n)return Mt;if("boolean"==typeof n)return Et;if("number"==typeof n)return Xe;if(n instanceof Jt)return Dn;if(n instanceof ru)return La;if(n instanceof rn)return Os;if(n instanceof hn)return _r;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const u=wi(o);if(i){if(i===u)continue;i=vt;break}i=u}return Vi(i||vt,e)}return wn}function Rs(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof Jt||n instanceof rn||n instanceof hn?n.toString():JSON.stringify(n)}class za{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!yr(e[1]))return i.error("invalid value");const o=e[1];let u=wi(o);const f=i.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new za(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Jt?["rgba"].concat(this.value.toArray()):this.value instanceof rn?this.value.serialize():this.value}}var Ps=za,Gi=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const Wo={string:Mt,number:Xe,boolean:Et,object:wn};class Hl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const f=e[0];if("array"===f){let y,b;if(e.length>2){const w=e[1];if("string"!=typeof w||!(w in Wo)||"object"===w)return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Wo[w],u++}else y=vt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}o=Vi(y,b)}else o=Wo[f];const g=[];for(;u<e.length;u++){const y=i.parse(e[u],u,vt);if(!y)return null;g.push(y)}return new Hl(o,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!ao(this.type,wi(o)))return o;if(i===this.args.length-1)throw new Gi(`Expected value to be of type ${li(this.type)}, but found ${li(wi(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const o=e.itemType;if("string"===o.kind||"number"===o.kind||"boolean"===o.kind){i.push(o.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(o=>o.serialize()))}}var Cn=Hl;class zs{constructor(e){this.type=Os,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&"object"==typeof o)return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let g=1;g<=e.length-1;++g){const y=e[g];if(f&&"object"==typeof y&&!Array.isArray(y)){f=!1;let b=null;if(y["font-scale"]&&(b=i.parse(y["font-scale"],1,Xe),!b))return null;let w=null;if(y["text-font"]&&(w=i.parse(y["text-font"],1,Vi(Mt)),!w))return null;let S=null;if(y["text-color"]&&(S=i.parse(y["text-color"],1,Dn),!S))return null;const T=u[u.length-1];T.scale=b,T.font=w,T.textColor=S}else{const b=i.parse(e[g],1,vt);if(!b)return null;const w=b.type.kind;if("string"!==w&&"value"!==w&&"null"!==w&&"resolvedImage"!==w)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new zs(u)}evaluate(e){return new rn(this.sections.map(i=>{const o=i.content.evaluate(e);return wi(o)===_r?new Ls("",o,null,null,null):new Ls(Rs(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Bs{constructor(e){this.type=_r,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Mt);return o?new Bs(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=hn.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ql={"to-boolean":Et,"to-color":Dn,"to-number":Xe,"to-string":Mt};class $l{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(("to-boolean"===o||"to-string"===o)&&2!==e.length)return i.error("Expected one argument.");const u=ql[o],f=[];for(let g=1;g<e.length;g++){const y=i.parse(e[g],g,vt);if(!y)return null;f.push(y)}return new $l(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof Jt)return i;if("string"==typeof i){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Pa(i[0],i[1],i[2],i[3]),!o))return new Jt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Gi(o||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const o of this.args){if(i=o.evaluate(e),null===i)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Gi(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?rn.fromString(Rs(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?hn.fromString(Rs(this.args[0].evaluate(e))):Rs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new zs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Bs(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var co=$l;const Mh=["Unknown","Point","LineString","Polygon"];var Xo=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Mh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-n[0])+this.featureDistanceData.bearing[1]*(o*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Jt.parse(n)),e}};class uo{constructor(e,i,o,u){this.name=e,this.type=i,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],u=uo.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=g.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let b=null;for(const[w,S]of y){b=new vr(i.registry,i.path,null,i.scope);const T=[];let k=!1;for(let F=1;F<e.length;F++){const L=e[F],B=Array.isArray(w)?w[F-1]:w.type,G=b.parse(L,1+T.length,B);if(!G){k=!0;break}T.push(G)}if(!k)if(Array.isArray(w)&&w.length!==T.length)b.error(`Expected ${w.length} arguments, but found ${T.length} instead.`);else{for(let F=0;F<T.length;F++){const L=Array.isArray(w)?w[F]:w.type,B=T[F];b.concat(F+1).checkSubtype(L,B.type)}if(0===b.errors.length)return new uo(o,f,S,T)}}if(1===y.length)i.errors.push(...b.errors);else{const w=(y.length?y:g).map(([T])=>{return k=T,Array.isArray(k)?`(${k.map(li).join(", ")})`:`(${li(k.type)}...)`;var k}).join(" | "),S=[];for(let T=1;T<e.length;T++){const k=i.parse(e[T],1+S.length);if(!k)return null;S.push(li(k.type))}i.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(e,i){uo.definitions=i;for(const o in i)e[o]=uo}}var Mn=uo;class Ba{constructor(e,i,o){this.type=La,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const o=e[1];if("object"!=typeof o||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=i.parse(void 0!==o["case-sensitive"]&&o["case-sensitive"],1,Et);if(!u)return null;const f=i.parse(void 0!==o["diacritic-sensitive"]&&o["diacritic-sensitive"],1,Et);if(!f)return null;let g=null;return o.locale&&(g=i.parse(o.locale,1,Mt),!g)?null:new Ba(u,f,g)}evaluate(e){return new ru(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Kn=8192;function Va(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Ga(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function ou(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Kn),Math.round(o*u*Kn)]}function Ah(n,e,i){const o=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],g=n[1]-i[1];return o*g-f*u==0&&o*f<=0&&u*g<=0}function Vs(n,e){let i=!1;for(let g=0,y=e.length;g<y;g++){const b=e[g];for(let w=0,S=b.length;w<S-1;w++){if(Ah(n,b[w],b[w+1]))return!1;(u=b[w])[1]>(o=n)[1]!=(f=b[w+1])[1]>o[1]&&o[0]<(f[0]-u[0])*(o[1]-u[1])/(f[1]-u[1])+u[0]&&(i=!i)}}var o,u,f;return i}function Na(n,e){for(let i=0;i<e.length;i++)if(Vs(n,e[i]))return!0;return!1}function Ua(n,e,i,o){const u=o[0]-i[0],f=o[1]-i[1],g=(n[0]-i[0])*f-u*(n[1]-i[1]),y=(e[0]-i[0])*f-u*(e[1]-i[1]);return g>0&&y<0||g<0&&y>0}function Sh(n,e,i){for(const w of i)for(let S=0;S<w.length-1;++S)if((y=[(g=w[S+1])[0]-(f=w[S])[0],g[1]-f[1]])[0]*(b=[(u=e)[0]-(o=n)[0],u[1]-o[1]])[1]-y[1]*b[0]!=0&&Ua(o,u,f,g)&&Ua(f,g,o,u))return!0;var o,u,f,g,y,b;return!1}function su(n,e){for(let i=0;i<n.length;++i)if(!Vs(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Sh(n[i],n[i+1],e))return!1;return!0}function au(n,e){for(let i=0;i<e.length;i++)if(su(n,e[i]))return!0;return!1}function In(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=[];for(let g=0;g<n[u].length;g++){const y=ou(n[u][g],i);Va(e,y),f.push(y)}o.push(f)}return o}function lu(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=In(n[u],e,i);o.push(f)}return o}function Gs(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const u=.5*o;let f=n[0]-i[0]>u?-o:i[0]-n[0]>u?o:0;0===f&&(f=n[0]-i[2]>u?-o:i[2]-n[0]>u?o:0),n[0]+=f}Va(e,n)}function Zl(n,e,i,o){const u=Math.pow(2,o.z)*Kn,f=[o.x*Kn,o.y*Kn],g=[];if(!n)return g;for(const y of n)for(const b of y){const w=[b.x+f[0],b.y+f[1]];Gs(w,e,i,u),g.push(w)}return g}function ja(n,e,i,o){const u=Math.pow(2,o.z)*Kn,f=[o.x*Kn,o.y*Kn],g=[];if(!n)return g;for(const b of n){const w=[];for(const S of b){const T=[S.x+f[0],S.y+f[1]];Va(e,T),w.push(T)}g.push(w)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of g)for(const w of b)Gs(w,e,i,u)}var y;return g}class ho{constructor(e,i){this.type=Et,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(yr(e[1])){const o=e[1];if("FeatureCollection"===o.type)for(let u=0;u<o.features.length;++u){const f=o.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new ho(o,o.features[u].geometry)}else if("Feature"===o.type){const u=o.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new ho(o,o.geometry)}else if("Polygon"===o.type||"MultiPolygon"===o.type)return new ho(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if("Polygon"===o.type){const y=In(o.coordinates,f,g),b=Zl(i.geometry(),u,f,g);if(!Ga(u,f))return!1;for(const w of b)if(!Vs(w,y))return!1}if("MultiPolygon"===o.type){const y=lu(o.coordinates,f,g),b=Zl(i.geometry(),u,f,g);if(!Ga(u,f))return!1;for(const w of b)if(!Na(w,y))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if("Polygon"===o.type){const y=In(o.coordinates,f,g),b=ja(i.geometry(),u,f,g);if(!Ga(u,f))return!1;for(const w of b)if(!su(w,y))return!1}if("MultiPolygon"===o.type){const y=lu(o.coordinates,f,g),b=ja(i.geometry(),u,f,g);if(!Ga(u,f))return!1;for(const w of b)if(!au(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Jn=ho;function po(n){if(n instanceof Mn&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Jn)return!1;let e=!0;return n.eachChild(i=>{e&&!po(i)&&(e=!1)}),e}function xr(n){if(n instanceof Mn&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(i=>{e&&!xr(i)&&(e=!1)}),e}function Ns(n,e){if(n instanceof Mn&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(o=>{i&&!Ns(o,e)&&(i=!1)}),i}class Us{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Us(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ha=Us;class qa{constructor(e,i=[],o,u=new Ch,f=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=f,this.expectedType=o}parse(e,i,o,u,f={}){return i?this.concat(i,o,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function o(u,f,g){return"assert"===g?new Cn(f,[u]):"coerce"===g?new co(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,b=g.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==b.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(y,b))return null}else g=o(g,y,i.typeAnnotation||"coerce");else g=o(g,y,i.typeAnnotation||"assert")}if(!(g instanceof Ps)&&"resolvedImage"!==g.type.kind&&Lt(g)){const y=new Xo;try{g=new Ps(g.type,g.evaluate(y))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const u="number"==typeof e?this.path.concat(e):this.path,f=o?this.scope.concat(o):this.scope;return new qa(this.registry,u,i||null,f,this.errors)}error(e,...i){const o=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new Gn(o,e))}checkSubtype(e,i){const o=ao(e,i);return o&&this.error(o),o}}var vr=qa;function Lt(n){if(n instanceof Ha)return Lt(n.boundExpression);if(n instanceof Mn&&"error"===n.name||n instanceof Ba||n instanceof Jn)return!1;const e=n instanceof co||n instanceof Cn;let i=!0;return n.eachChild(o=>{i=e?i&&Lt(o):i&&o instanceof Ps}),!!i&&po(n)&&Ns(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function $a(n,e){const i=n.length-1;let o,u,f=0,g=i,y=0;for(;f<=g;)if(y=Math.floor((f+g)/2),o=n[y],u=n[y+1],o<=e){if(y===i||e<u)return y;f=y+1}else{if(!(o>e))throw new Gi("Input is not a number.");g=y-1}return 0}class Za{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Xe);if(!o)return null;const u=[];let f=null;i.expectedType&&"value"!==i.expectedType.kind&&(f=i.expectedType);for(let g=1;g<e.length;g+=2){const y=1===g?-1/0:e[g],b=e[g+1],w=g,S=g+1;if("number"!=typeof y)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const T=i.parse(b,S,f);if(!T)return null;f=f||T.type,u.push([y,T])}return new Za(f,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(1===i.length)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;return u>=i[f-1]?o[f-1].evaluate(e):o[$a(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Yl=Za;function It(n,e,i){return n*(1-i)+e*i}function Ko(n,e,i){return n.map((o,u)=>It(o,e[u],i))}var Jo=Object.freeze({__proto__:null,number:It,color:function(n,e,i){return new Jt(It(n.r,e.r,i),It(n.g,e.g,i),It(n.b,e.b,i),It(n.a,e.a,i))},array:Ko});const cu=4/29,fo=6/29,Wa=3*fo*fo,Eh=Math.PI/180,uu=180/Math.PI;function Xa(n){return n>.008856451679035631?Math.pow(n,1/3):n/Wa+cu}function Xl(n){return n>fo?n*n*n:Wa*(n-cu)}function hu(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Kl(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Th(n){const e=Kl(n.r),i=Kl(n.g),o=Kl(n.b),u=Xa((.4124564*e+.3575761*i+.1804375*o)/.95047),f=Xa((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Xa((.0193339*e+.119192*i+.9503041*o)/1.08883)),alpha:n.a}}function du(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,o=isNaN(n.b)?e:e-n.b/200;return e=1*Xl(e),i=.95047*Xl(i),o=1.08883*Xl(o),new Jt(hu(3.2404542*i-1.5371385*e-.4985314*o),hu(-.969266*i+1.8760108*e+.041556*o),hu(.0556434*i-.2040259*e+1.0572252*o),n.alpha)}function kh(n,e,i){const o=e-n;return n+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ka={forward:Th,reverse:du,interpolate:function(n,e,i){return{l:It(n.l,e.l,i),a:It(n.a,e.a,i),b:It(n.b,e.b,i),alpha:It(n.alpha,e.alpha,i)}}},js={forward:function(n){const{l:e,a:i,b:o}=Th(n),u=Math.atan2(o,i)*uu;return{h:u<0?u+360:u,c:Math.sqrt(i*i+o*o),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Eh,i=n.c;return du({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:kh(n.h,e.h,i),c:It(n.c,e.c,i),l:It(n.l,e.l,i),alpha:It(n.alpha,e.alpha,i)}}};var at=Object.freeze({__proto__:null,lab:Ka,hcl:js});class Qo{constructor(e,i,o,u,f){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[g,y]of f)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(e,i,o,u){let f=0;if("exponential"===e.name)f=Nn(i,e.base,o,u);else if("linear"===e.name)f=Nn(i,1,o,u);else if("cubic-bezier"===e.name){const g=e.controlPoints;f=new hr(g[0],g[1],g[2],g[3]).solve(Nn(i,1,o,u))}return f}static parse(e,i){let[o,u,f,...g]=e;if(!Array.isArray(u)||0===u.length)return i.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const w=u[1];if("number"!=typeof w)return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:w}}else{if("cubic-bezier"!==u[0])return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const w=u.slice(1);if(4!==w.length||w.some(S=>"number"!=typeof S||S<0||S>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Xe),!f)return null;const y=[];let b=null;"interpolate-hcl"===o||"interpolate-lab"===o?b=Dn:i.expectedType&&"value"!==i.expectedType.kind&&(b=i.expectedType);for(let w=0;w<g.length;w+=2){const S=g[w],T=g[w+1],k=w+3,F=w+4;if("number"!=typeof S)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=S)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const L=i.parse(T,F,b);if(!L)return null;b=b||L.type,y.push([S,L])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new Qo(b,o,u,f,y):i.error(`Type ${li(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(1===i.length)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;if(u>=i[f-1])return o[f-1].evaluate(e);const g=$a(i,u),y=Qo.interpolationFactor(this.interpolation,u,i[g],i[g+1]),b=o[g].evaluate(e),w=o[g+1].evaluate(e);return"interpolate"===this.operator?Jo[this.type.kind.toLowerCase()](b,w,y):"interpolate-hcl"===this.operator?js.reverse(js.interpolate(js.forward(b),js.forward(w),y)):Ka.reverse(Ka.interpolate(Ka.forward(b),Ka.forward(w),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Nn(n,e,i,o){const u=o-i,f=n-i;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var ci=Qo;class mo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const u=i.expectedType;u&&"value"!==u.kind&&(o=u);const f=[];for(const y of e.slice(1)){const b=i.parse(y,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,f.push(b)}const g=u&&f.some(y=>ao(u,y.type));return new mo(g?vt:o,f)}evaluate(e){let i,o=null,u=0;for(const f of this.args){if(u++,o=f.evaluate(e),o&&o instanceof hn&&!o.available&&(i||(i=o),o=null,u===this.args.length))return i;if(null!==o)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var pu=mo;class Jl{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if("string"!=typeof g)return i.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(e[f+1],f+1);if(!y)return null;o.push([g,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new Jl(o,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}var Ql=Jl;class Hs{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Xe),u=i.parse(e[2],2,Vi(i.expectedType||vt));return o&&u?new Hs(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Gi(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Gi(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Gi(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Rr=Hs;class Ja{constructor(e,i){this.type=Et,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,vt),u=i.parse(e[2],2,vt);return o&&u?jl(o.type,[Et,Mt,Xe,so,vt])?new Ja(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${li(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(null==o)return!1;if(!Lr(i,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${li(wi(i))} instead.`);if(!Lr(o,["string","array"]))throw new Gi(`Expected second argument to be of type array or string, but found ${li(wi(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ec=Ja;class dn{constructor(e,i,o){this.type=Xe,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,vt),u=i.parse(e[2],2,vt);if(!o||!u)return null;if(!jl(o.type,[Et,Mt,Xe,so,vt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${li(o.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Xe);return f?new dn(o,u,f):null}return new dn(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Lr(i,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${li(wi(i))} instead.`);if(!Lr(o,["string","array"]))throw new Gi(`Expected second argument to be of type array or string, but found ${li(wi(o))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return o.indexOf(i,u)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var go=dn;class es{constructor(e,i,o,u,f,g){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=f,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&"value"!==i.expectedType.kind&&(u=i.expectedType);const f={},g=[];for(let w=2;w<e.length-1;w+=2){let S=e[w];const T=e[w+1];Array.isArray(S)||(S=[S]);const k=i.concat(w);if(0===S.length)return k.error("Expected at least one branch label.");for(const L of S){if("number"!=typeof L&&"string"!=typeof L)return k.error("Branch labels must be numbers or strings.");if("number"==typeof L&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof L&&Math.floor(L)!==L)return k.error("Numeric branch labels must be integer values.");if(o){if(k.checkSubtype(o,wi(L)))return null}else o=wi(L);if(void 0!==f[String(L)])return k.error("Branch labels must be unique.");f[String(L)]=g.length}const F=i.parse(T,w,u);if(!F)return null;u=u||F.type,g.push(F)}const y=i.parse(e[1],1,vt);if(!y)return null;const b=i.parse(e[e.length-1],e.length-1,u);return b?"value"!==y.type.kind&&i.concat(1).checkSubtype(o,y.type)?null:new es(o,u,y,f,g,b):null}evaluate(e){const i=this.input.evaluate(e);return(wi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],u={};for(const g of i){const y=u[this.cases[g]];void 0===y?(u[this.cases[g]]=o.length,o.push([this.cases[g],[g]])):o[y][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,y]of o)e.push(1===y.length?f(y[0]):y.map(f)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var tc=es;class ts{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&"value"!==i.expectedType.kind&&(o=i.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const y=i.parse(e[g],g,Et);if(!y)return null;const b=i.parse(e[g+1],g+1,o);if(!b)return null;u.push([y,b]),o=o||b.type}const f=i.parse(e[e.length-1],e.length-1,o);return f?new ts(o,u,f):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var fu=ts;class Qa{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,vt),u=i.parse(e[2],2,Xe);if(!o||!u)return null;if(!jl(o.type,[Vi(vt),Mt,vt]))return i.error(`Expected first argument to be of type array or string, but found ${li(o.type)} instead`);if(4===e.length){const f=i.parse(e[3],3,Xe);return f?new Qa(o.type,o,u,f):null}return new Qa(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Lr(i,["string","array"]))throw new Gi(`Expected first argument to be of type array or string, but found ${li(wi(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(o,u)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var mu=Qa;function ic(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function nc(n,e,i,o){return 0===o.compare(e,i)}function ni(n,e,i){const o="=="!==n&&"!="!==n;return class Fy{constructor(f,g,y){this.type=Et,this.lhs=f,this.rhs=g,this.collator=y,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const y=f[0];let b=g.parse(f[1],1,vt);if(!b)return null;if(!ic(y,b.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${li(b.type)}'.`);let w=g.parse(f[2],2,vt);if(!w)return null;if(!ic(y,w.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${li(w.type)}'.`);if(b.type.kind!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return g.error(`Cannot compare types '${li(b.type)}' and '${li(w.type)}'.`);o&&("value"===b.type.kind&&"value"!==w.type.kind?b=new Cn(w.type,[b]):"value"!==b.type.kind&&"value"===w.type.kind&&(w=new Cn(b.type,[w])));let S=null;if(4===f.length){if("string"!==b.type.kind&&"string"!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return g.error("Cannot use collator to compare non-string types.");if(S=g.parse(f[3],3,La),!S)return null}return new Fy(b,w,S)}evaluate(f){const g=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const b=wi(g),w=wi(y);if(b.kind!==w.kind||"string"!==b.kind&&"number"!==b.kind)throw new Gi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=wi(g),w=wi(y);if("string"!==b.kind||"string"!==w.kind)return e(f,g,y)}return this.collator?i(f,g,y,this.collator.evaluate(f)):e(f,g,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const Dh=ni("==",function(n,e,i){return e===i},nc),gu=ni("!=",function(n,e,i){return e!==i},function(n,e,i,o){return!nc(0,e,i,o)}),_u=ni("<",function(n,e,i){return e<i},function(n,e,i,o){return o.compare(e,i)<0}),qs=ni(">",function(n,e,i){return e>i},function(n,e,i,o){return o.compare(e,i)>0}),rc=ni("<=",function(n,e,i){return e<=i},function(n,e,i,o){return o.compare(e,i)<=0}),oc=ni(">=",function(n,e,i){return e>=i},function(n,e,i,o){return o.compare(e,i)>=0});class el{constructor(e,i,o,u,f,g){this.type=Mt,this.number=e,this.locale=i,this.currency=o,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Xe);if(!o)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,Mt),!f))return null;let g=null;if(u.currency&&(g=i.parse(u.currency,1,Mt),!g))return null;let y=null;if(u.unit&&(y=i.parse(u.unit,1,Mt),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=i.parse(u["min-fraction-digits"],1,Xe),!b))return null;let w=null;return u["max-fraction-digits"]&&(w=i.parse(u["max-fraction-digits"],1,Xe),!w)?null:new el(o,f,g,y,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Un{constructor(e){this.type=Xe,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?"array"!==o.type.kind&&"string"!==o.type.kind&&"value"!==o.type.kind?i.error(`Expected argument of type string or array, but found ${li(o.type)} instead.`):new Un(o):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new Gi(`Expected value to be of type string or array, but found ${li(wi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const yu={"==":Dh,"!=":gu,">":qs,"<":_u,">=":oc,"<=":rc,array:Cn,at:Rr,boolean:Cn,case:fu,coalesce:pu,collator:Ba,format:zs,image:Bs,in:ec,"index-of":go,interpolate:ci,"interpolate-hcl":ci,"interpolate-lab":ci,length:Un,let:Ql,literal:Ps,match:tc,number:Cn,"number-format":el,object:Cn,slice:mu,step:Yl,string:Cn,"to-boolean":co,"to-color":co,"to-number":co,"to-string":co,var:Ha,within:Jn};function sc(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const f=u?u.evaluate(n):1,g=Pa(e,i,o,f);if(g)throw new Gi(g);return new Jt(e/255*f,i/255*f,o/255*f,f)}function ac(n,e){return n in e}function tl(n,e){const i=e[n];return void 0===i?null:i}function br(n){return{type:n}}Mn.register(yu,{error:[{kind:"error"},[Mt],(n,[e])=>{throw new Gi(e.evaluate(n))}],typeof:[Mt,[vt],(n,[e])=>li(wi(e.evaluate(n)))],"to-rgba":[Vi(Xe,4),[Dn],(n,[e])=>e.evaluate(n).toArray()],rgb:[Dn,[Xe,Xe,Xe],sc],rgba:[Dn,[Xe,Xe,Xe,Xe],sc],has:{type:Et,overloads:[[[Mt],(n,[e])=>ac(e.evaluate(n),n.properties())],[[Mt,wn],(n,[e,i])=>ac(e.evaluate(n),i.evaluate(n))]]},get:{type:vt,overloads:[[[Mt],(n,[e])=>tl(e.evaluate(n),n.properties())],[[Mt,wn],(n,[e,i])=>tl(e.evaluate(n),i.evaluate(n))]]},"feature-state":[vt,[Mt],(n,[e])=>tl(e.evaluate(n),n.featureState||{})],properties:[wn,[],n=>n.properties()],"geometry-type":[Mt,[],n=>n.geometryType()],id:[vt,[],n=>n.id()],zoom:[Xe,[],n=>n.globals.zoom],pitch:[Xe,[],n=>n.globals.pitch||0],"distance-from-center":[Xe,[],n=>n.distanceFromCenter()],"heatmap-density":[Xe,[],n=>n.globals.heatmapDensity||0],"line-progress":[Xe,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Xe,[],n=>n.globals.skyRadialProgress||0],accumulated:[vt,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Xe,br(Xe),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[Xe,br(Xe),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:Xe,overloads:[[[Xe,Xe],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Xe],(n,[e])=>-e.evaluate(n)]]},"/":[Xe,[Xe,Xe],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Xe,[Xe,Xe],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Xe,[Xe],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Xe,[Xe],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Xe,[Xe],(n,[e])=>Math.log(e.evaluate(n))],log2:[Xe,[Xe],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Xe,[Xe],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Xe,[Xe],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Xe,[Xe],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Xe,[Xe],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Xe,[Xe],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Xe,[Xe],(n,[e])=>Math.atan(e.evaluate(n))],min:[Xe,br(Xe),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Xe,br(Xe),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Xe,[Xe],(n,[e])=>Math.abs(e.evaluate(n))],round:[Xe,[Xe],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Xe,[Xe],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Xe,[Xe],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Et,[Mt,vt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Et,[vt],(n,[e])=>n.id()===e.value],"filter-type-==":[Et,[Mt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Et,[Mt,vt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Et,[vt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Et,[Mt,vt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Et,[vt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Et,[Mt,vt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Et,[vt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Et,[Mt,vt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Et,[vt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Et,[vt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Et,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Et,[Vi(Mt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Et,[Vi(vt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Et,[Mt,Vi(vt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Et,[Mt,Vi(vt)],(n,[e,i])=>function(o,u,f,g){for(;f<=g;){const y=f+g>>1;if(u[y]===o)return!0;u[y]>o?g=y-1:f=y+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Et,overloads:[[[Et,Et],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[br(Et),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Et,overloads:[[[Et,Et],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[br(Et),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Et,[Et],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Et,[Mt],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Mt,[Mt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Mt,[Mt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Mt,br(vt),(n,e)=>e.map(i=>Rs(i.evaluate(n))).join("")],"resolved-locale":[Mt,[La],(n,[e])=>e.evaluate(n).resolvedLocale()]});var $s=yu;function xu(n){return{result:"success",value:n}}function _o(n){return{result:"error",value:n}}function Qn(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function vu(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function yo(n){return!!n.expression&&n.expression.interpolated}function Rt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function is(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function bu(n){return n}function Zs(n,e){const i="color"===e.type,o=n.stops&&"object"==typeof n.stops[0][0],u=o||!(o||void 0!==n.property),f=n.type||(yo(e)?"exponential":"interval");if(i&&((n=bn({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],Jt.parse(w[1])])),n.default=Jt.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!at[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,y,b;if("exponential"===f)g=Pr;else if("interval"===f)g=xo;else if("categorical"===f){g=Ih,y=Object.create(null);for(const w of n.stops)y[w[0]]=w[1];b=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=ns}if(o){const w={},S=[];for(let F=0;F<n.stops.length;F++){const L=n.stops[F],B=L[0].zoom;void 0===w[B]&&(w[B]={zoom:B,type:n.type,property:n.property,default:n.default,stops:[]},S.push(B)),w[B].stops.push([L[0].value,L[1]])}const T=[];for(const F of S)T.push([w[F].zoom,Zs(w[F],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:ci.interpolationFactor.bind(void 0,k),zoomStops:T.map(F=>F[0]),evaluate:({zoom:F},L)=>Pr({stops:T,base:n.base},e,F).evaluate(F,L)}}if(u){const w="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:ci.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(S=>S[0]),evaluate:({zoom:S})=>g(n,e,S,y,b)}}return{kind:"source",evaluate(w,S){const T=S&&S.properties?S.properties[n.property]:void 0;return void 0===T?Ys(n.default,e.default):g(n,e,T,y,b)}}}function Ys(n,e,i){return void 0!==n?n:void 0!==e?e:void 0!==i?i:void 0}function Ih(n,e,i,o,u){return Ys(typeof i===u?o[i]:void 0,n.default,e.default)}function xo(n,e,i){if("number"!==Rt(i))return Ys(n.default,e.default);const o=n.stops.length;if(1===o||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const u=$a(n.stops.map(f=>f[0]),i);return n.stops[u][1]}function Pr(n,e,i){const o=void 0!==n.base?n.base:1;if("number"!==Rt(i))return Ys(n.default,e.default);const u=n.stops.length;if(1===u||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=$a(n.stops.map(S=>S[0]),i),g=function(S,T,k,F){const L=F-k,B=S-k;return 0===L?0:1===T?B/L:(Math.pow(T,B)-1)/(Math.pow(T,L)-1)}(i,o,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],b=n.stops[f+1][1];let w=Jo[e.type]||bu;if(n.colorSpace&&"rgb"!==n.colorSpace){const S=at[n.colorSpace];w=(T,k)=>S.reverse(S.interpolate(S.forward(T),S.forward(k),g))}return"function"==typeof y.evaluate?{evaluate(...S){const T=y.evaluate.apply(void 0,S),k=b.evaluate.apply(void 0,S);if(void 0!==T&&void 0!==k)return w(T,k,g)}}:w(y,b,g)}function ns(n,e,i){return"color"===e.type?i=Jt.parse(i):"formatted"===e.type?i=rn.fromString(i.toString()):"resolvedImage"===e.type?i=hn.fromString(i.toString()):Rt(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Ys(i,n.default,e.default)}class il{constructor(e,i){var o;this.expression=e,this._warningHistory={},this._evaluator=new Xo,this._defaultValue=i?"color"===(o=i).type&&(is(o.default)||Array.isArray(o.default))?new Jt(0,0,0,0):"color"===o.type?Jt.parse(o.default)||null:void 0===o.default?null:o.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,o,u,f,g,y,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,f,g,y,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(null==w||"number"==typeof w&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Gi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function nl(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in $s}function rs(n,e){const i=new vr($s,[],e?function(u){const f={color:Dn,string:Mt,number:Xe,enum:Mt,boolean:Et,formatted:Os,resolvedImage:_r};return"array"===u.type?Vi(f[u.value]||vt,u.length):f[u.type]}(e):void 0),o=i.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return o?xu(new il(o,e)):_o(i.errors)}class wu{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!xr(i.expression)}evaluateWithoutErrorHandling(e,i,o,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,g)}evaluate(e,i,o,u,f,g){return this._styleExpression.evaluate(e,i,o,u,f,g)}}class rl{constructor(e,i,o,u){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent="camera"!==e&&!xr(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,o,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,g)}evaluate(e,i,o,u,f,g){return this._styleExpression.evaluate(e,i,o,u,f,g)}interpolationFactor(e,i,o){return this.interpolationType?ci.interpolationFactor(this.interpolationType,e,i,o):0}}function Cu(n,e){if("error"===(n=rs(n,e)).result)return n;const i=n.value.expression,o=po(i);if(!o&&!Qn(e))return _o([new Gn("","data expressions not supported")]);const u=Ns(i,["zoom","pitch","distance-from-center"]);if(!u&&!vu(e))return _o([new Gn("","zoom expressions not supported")]);const f=Xs(i);return f||u?f instanceof Gn?_o([f]):f instanceof ci&&!yo(e)?_o([new Gn("",'"interpolate" expressions cannot be used with this property')]):xu(f?new rl(o?"camera":"composite",n.value,f.labels,f instanceof ci?f.interpolation:void 0):new wu(o?"constant":"source",n.value)):_o([new Gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ws{constructor(e,i){this._parameters=e,this._specification=i,bn(this,Zs(this._parameters,this._specification))}static deserialize(e){return new Ws(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Xs(n){let e=null;if(n instanceof Ql)e=Xs(n.result);else if(n instanceof pu){for(const i of n.args)if(e=Xs(i),e)break}else(n instanceof Yl||n instanceof ci)&&n.input instanceof Mn&&"zoom"===n.input.name&&(e=n);return e instanceof Gn||n.eachChild(i=>{const o=Xs(i);o instanceof Gn?e=o:!e&&o?e=new Gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Gn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Ye{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),null!=i&&i.__line__&&(this.line=i.__line__)}}function Pt(n){const e=n.key,i=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,g=n.styleSpec;let y=[];const b=Rt(i);if("object"!==b)return[new Ye(e,i,`object expected, ${b} found`)];for(const w in i){const S=w.split(".")[0],T=o[S]||o["*"];let k;u[S]?k=u[S]:o[S]?k=Pi:u["*"]?k=u["*"]:o["*"]&&(k=Pi),k?y=y.concat(k({key:(e&&`${e}.`)+w,value:i[w],valueSpec:T,style:f,styleSpec:g,object:i,objectKey:w},i)):y.push(new Ye(e,i[w],`unknown property "${w}"`))}for(const w in o)u[w]||o[w].required&&void 0===o[w].default&&void 0===i[w]&&y.push(new Ye(e,i,`missing required property "${w}"`));return y}function vi(n){const e=n.value,i=n.valueSpec,o=n.style,u=n.styleSpec,f=n.key,g=n.arrayElementValidator||Pi;if("array"!==Rt(e))return[new Ye(f,e,`array expected, ${Rt(e)} found`)];if(i.length&&e.length!==i.length)return[new Ye(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Ye(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let y={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(y.function=i.function),"object"===Rt(i.value)&&(y=i.value);let b=[];for(let w=0;w<e.length;w++)b=b.concat(g({array:e,arrayIndex:w,value:e[w],valueSpec:y,style:o,styleSpec:u,key:`${f}[${w}]`}));return b}function ol(n){const e=n.key,i=n.value,o=n.valueSpec;let u=Rt(i);if("number"===u&&i!=i&&(u="NaN"),"number"!==u)return[new Ye(e,i,`number expected, ${u} found`)];if("minimum"in o){let f=o.minimum;if("array"===Rt(o.minimum)&&(f=o.minimum[n.arrayIndex]),i<f)return[new Ye(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in o){let f=o.maximum;if("array"===Rt(o.maximum)&&(f=o.maximum[n.arrayIndex]),i>f)return[new Ye(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function os(n){const e=n.valueSpec,i=pi(n.value.type);let o,u,f,g={};const y="categorical"!==i&&void 0===n.value.property,b=!y,w="array"===Rt(n.value.stops)&&"array"===Rt(n.value.stops[0])&&"object"===Rt(n.value.stops[0][0]),S=Pt({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(F){if("identity"===i)return[new Ye(F.key,F.value,'identity function may not have a "stops" property')];let L=[];const B=F.value;return L=L.concat(vi({key:F.key,value:B,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:T})),"array"===Rt(B)&&0===B.length&&L.push(new Ye(F.key,B,"array must have at least one stop")),L},default:function(F){return Pi({key:F.key,value:F.value,valueSpec:e,style:F.style,styleSpec:F.styleSpec})}}});return"identity"===i&&y&&S.push(new Ye(n.key,n.value,'missing required property "property"')),"identity"===i||n.value.stops||S.push(new Ye(n.key,n.value,'missing required property "stops"')),"exponential"===i&&n.valueSpec.expression&&!yo(n.valueSpec)&&S.push(new Ye(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!Qn(n.valueSpec)?S.push(new Ye(n.key,n.value,"property functions not supported")):y&&!vu(n.valueSpec)&&S.push(new Ye(n.key,n.value,"zoom functions not supported"))),"categorical"!==i&&!w||void 0!==n.value.property||S.push(new Ye(n.key,n.value,'"property" property is required')),S;function T(F){let L=[];const B=F.value,G=F.key;if("array"!==Rt(B))return[new Ye(G,B,`array expected, ${Rt(B)} found`)];if(2!==B.length)return[new Ye(G,B,`array length 2 expected, length ${B.length} found`)];if(w){if("object"!==Rt(B[0]))return[new Ye(G,B,`object expected, ${Rt(B[0])} found`)];if(void 0===B[0].zoom)return[new Ye(G,B,"object stop key must have zoom")];if(void 0===B[0].value)return[new Ye(G,B,"object stop key must have value")];const X=pi(B[0].zoom);if("number"!=typeof X)return[new Ye(G,B[0].zoom,"stop zoom values must be numbers")];if(f&&f>X)return[new Ye(G,B[0].zoom,"stop zoom values must appear in ascending order")];X!==f&&(f=X,u=void 0,g={}),L=L.concat(Pt({key:`${G}[0]`,value:B[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:ol,value:k}}))}else L=L.concat(k({key:`${G}[0]`,value:B[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},B));return nl(Or(B[1]))?L.concat([new Ye(`${G}[1]`,B[1],"expressions are not allowed in function stops.")]):L.concat(Pi({key:`${G}[1]`,value:B[1],valueSpec:e,style:F.style,styleSpec:F.styleSpec}))}function k(F,L){const B=Rt(F.value),G=pi(F.value),X=null!==F.value?F.value:L;if(o){if(B!==o)return[new Ye(F.key,X,`${B} stop domain type must match previous stop domain type ${o}`)]}else o=B;if("number"!==B&&"string"!==B&&"boolean"!==B&&"number"!=typeof G&&"string"!=typeof G&&"boolean"!=typeof G)return[new Ye(F.key,X,"stop domain value must be a number, string, or boolean")];if("number"!==B&&"categorical"!==i){let ie=`number expected, ${B} found`;return Qn(e)&&void 0===i&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(F.key,X,ie)]}return"categorical"!==i||"number"!==B||"number"==typeof G&&isFinite(G)&&Math.floor(G)===G?"categorical"!==i&&"number"===B&&"number"==typeof G&&"number"==typeof u&&void 0!==u&&G<u?[new Ye(F.key,X,"stop domain values must appear in ascending order")]:(u=G,"categorical"===i&&G in g?[new Ye(F.key,X,"stop domain values must be unique")]:(g[G]=!0,[])):[new Ye(F.key,X,`integer expected, found ${String(G)}`)]}}function Ht(n){const e=("property"===n.expressionContext?Cu:rs)(Or(n.value),n.valueSpec);if("error"===e.result)return e.value.map(o=>new Ye(`${n.key}${o.key}`,n.value,o.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!i.outputDefined())return[new Ye(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!xr(i))return[new Ye(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return sl(i,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Ns(i,["zoom","feature-state"]))return[new Ye(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!po(i))return[new Ye(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sl(n,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)i.delete(u);if(0===i.size)return[];const o=[];return n instanceof Mn&&i.has(n.name)?[new Ye(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{o.push(...sl(u,e))}),o)}function ft(n){const e=n.key,i=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?-1===o.values.indexOf(pi(i))&&u.push(new Ye(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(o.values).indexOf(pi(i))&&u.push(new Ye(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function Ri(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Ri(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ks(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ri(n)||(n=al(n));const i=n;let o=!0;try{o=function(w){if(!Ni(w))return w;let S=Or(w);return Ci(S),S=lc(S),S}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const u=Ce[`filter_${e}`],f=rs(o,u);let g=null;if("error"===f.result)throw new Error(f.value.map(w=>`${w.key}: ${w.message}`).join(", "));g=(w,S,T)=>f.value.evaluate(w,S,{},T);let y=null,b=null;if(o!==i){const w=rs(i,u);if("error"===w.result)throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,T,k,F,L)=>w.value.evaluate(S,T,{},k,void 0,void 0,F,L),b=!po(w.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:Ft(o),needFeature:!!b}}function lc(n){if(!Array.isArray(n))return n;const e=function(i){if(ep.has(i[0]))for(let o=1;o<i.length;o++)if(Ni(i[o]))return!0;return i}(n);return!0===e?e:e.map(i=>lc(i))}function Ci(n){let e=!1;const i=[];if("case"===n[0]){for(let o=1;o<n.length-1;o+=2)e=e||Ni(n[o]),i.push(n[o+1]);i.push(n[n.length-1])}else if("match"===n[0]){e=e||Ni(n[1]);for(let o=2;o<n.length-1;o+=2)i.push(n[o+1]);i.push(n[n.length-1])}else if("step"===n[0]){e=e||Ni(n[1]);for(let o=1;o<n.length-1;o+=2)i.push(n[o+1])}e&&(n.length=0,n.push("any",...i));for(let o=1;o<n.length;o++)Ci(n[o])}function Ni(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<n.length;i++)if(Ni(n[i]))return!0;return!1}const ep=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ss(n,e){return n<e?-1:n>e?1:0}function Ft(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(Ft(n[e]))return!0;return!1}function al(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?cc(n[1],n[2],"=="):"!="===e?qi(cc(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?cc(n[1],n[2],e):"any"===e?(i=n.slice(1),["any"].concat(i.map(al))):"all"===e?["all"].concat(n.slice(1).map(al)):"none"===e?["all"].concat(n.slice(1).map(al).map(qi)):"in"===e?zr(n[1],n.slice(2)):"!in"===e?qi(zr(n[1],n.slice(2))):"has"===e?Js(n[1]):"!has"===e?qi(Js(n[1])):"within"!==e||n;var i}function cc(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function zr(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(ss)]]:["filter-in-small",n,["literal",e]]}}function Js(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function qi(n){return["!",n]}function as(n){return Ri(Or(n.value))?Ht(bn({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Mu(n)}function Mu(n){const e=n.value,i=n.key;if("array"!==Rt(e))return[new Ye(i,e,`array expected, ${Rt(e)} found`)];const o=n.styleSpec;let u,f=[];if(e.length<1)return[new Ye(i,e,"filter array must have at least 1 element")];switch(f=f.concat(ft({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),pi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===pi(e[1])&&f.push(new Ye(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new Ye(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Rt(e[1]),"string"!==u&&f.push(new Ye(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=Rt(e[g]),"$type"===pi(e[1])?f=f.concat(ft({key:`${i}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new Ye(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(Mu({key:`${i}[${g}]`,value:e[g],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Rt(e[1]),2!==e.length?f.push(new Ye(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new Ye(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=Rt(e[1]),2!==e.length?f.push(new Ye(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new Ye(`${i}[1]`,e[1],`object expected, ${u} found`))}return f}function Fh(n,e){const i=n.key,o=n.style,u=n.styleSpec,f=n.value,g=n.objectKey,y=u[`${e}_${n.layerType}`];if(!y)return[];const b=g.match(/^(.*)-transition$/);if("paint"===e&&b&&y[b[1]]&&y[b[1]].transition)return Pi({key:i,value:f,valueSpec:u.transition,style:o,styleSpec:u});const w=n.valueSpec||y[g];if(!w)return[new Ye(i,f,`unknown property "${g}"`)];let S;if("string"===Rt(f)&&Qn(w)&&!w.tokens&&(S=/^{([^}]+)}$/.exec(f)))return[new Ye(i,f,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const T=[];return"symbol"===n.layerType&&("text-field"===g&&o&&!o.glyphs&&T.push(new Ye(i,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&is(Or(f))&&"identity"===pi(f.type)&&T.push(new Ye(i,f,'"text-font" does not support identity functions'))),T.concat(Pi({key:n.key,value:f,valueSpec:w,style:o,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:g}))}function Au(n){return Fh(n,"paint")}function Su(n){return Fh(n,"layout")}function ll(n){let e=[];const i=n.value,o=n.key,u=n.style,f=n.styleSpec;i.type||i.ref||e.push(new Ye(o,i,'either "type" or "ref" is required'));let g=pi(i.type);const y=pi(i.ref);if(i.id){const b=pi(i.id);for(let w=0;w<n.arrayIndex;w++){const S=u.layers[w];pi(S.id)===b&&e.push(new Ye(o,i.id,`duplicate layer id "${i.id}", previously used at line ${S.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in i&&e.push(new Ye(o,i[w],`"${w}" is prohibited for ref layers`))}),u.layers.forEach(w=>{pi(w.id)===y&&(b=w)}),b?b.ref?e.push(new Ye(o,i.ref,"ref cannot reference another ref layer")):g=pi(b.type):"string"==typeof y&&e.push(new Ye(o,i.ref,`ref layer "${y}" not found`))}else if("background"!==g&&"sky"!==g)if(i.source){const b=u.sources&&u.sources[i.source],w=b&&pi(b.type);b?"vector"===w&&"raster"===g?e.push(new Ye(o,i.source,`layer "${i.id}" requires a raster source`)):"raster"===w&&"raster"!==g?e.push(new Ye(o,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==w||i["source-layer"]?"raster-dem"===w&&"hillshade"!==g?e.push(new Ye(o,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===w&&b.lineMetrics||e.push(new Ye(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ye(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Ye(o,i.source,`source "${i.source}" not found`))}else e.push(new Ye(o,i,'missing required property "source"'));return e=e.concat(Pt({key:o,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pi({key:`${o}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:i,objectKey:"type"}),filter:b=>as(bn({layerType:g},b)),layout:b=>Pt({layer:i,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Su(bn({layerType:g},w))}}),paint:b=>Pt({layer:i,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Au(bn({layerType:g},w))}})}})),e}function Qs(n){const e=n.value,i=n.key,o=Rt(e);return"string"!==o?[new Ye(i,e,`string expected, ${o} found`)]:[]}const ls={promoteId:function({key:n,value:e}){if("string"===Rt(e))return Qs({key:n,value:e});{const i=[];for(const o in e)i.push(...Qs({key:`${n}.${o}`,value:e[o]}));return i}}};function Eu(n){const e=n.value,i=n.key,o=n.styleSpec,u=n.style;if(!e.type)return[new Ye(i,e,'"type" is required')];const f=pi(e.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=Pt({key:i,value:e,valueSpec:o[`source_${f.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:ls}),g;case"geojson":if(g=Pt({key:i,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,objectElementValidators:ls}),e.cluster)for(const y in e.clusterProperties){const[b,w]=e.clusterProperties[y],S="string"==typeof b?[b,["accumulated"],["get",y]]:b;g.push(...Ht({key:`${i}.${y}.map`,value:w,expressionContext:"cluster-map"})),g.push(...Ht({key:`${i}.${y}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return g;case"video":return Pt({key:i,value:e,valueSpec:o.source_video,style:u,styleSpec:o});case"image":return Pt({key:i,value:e,valueSpec:o.source_image,style:u,styleSpec:o});case"canvas":return[new Ye(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ft({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:o})}}function Tu(n){const e=n.value,i=n.styleSpec,o=i.light,u=n.style;let f=[];const g=Rt(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new Ye("light",e,`object expected, ${g} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&o[b[1]]&&o[b[1]].transition?Pi({key:y,value:e[y],valueSpec:i.transition,style:u,styleSpec:i}):o[y]?Pi({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new Ye(y,e[y],`unknown property "${y}"`)])}return f}function cs(n){const e=n.value,i=n.key,o=n.style,u=n.styleSpec,f=u.terrain;let g=[];const y=Rt(e);if(void 0===e)return g;if("object"!==y)return g=g.concat([new Ye("terrain",e,`object expected, ${y} found`)]),g;for(const b in e){const w=b.match(/^(.*)-transition$/);g=g.concat(w&&f[w[1]]&&f[w[1]].transition?Pi({key:b,value:e[b],valueSpec:u.transition,style:o,styleSpec:u}):f[b]?Pi({key:b,value:e[b],valueSpec:f[b],style:o,styleSpec:u}):[new Ye(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=o.sources&&o.sources[e.source],w=b&&pi(b.type);b?"raster-dem"!==w&&g.push(new Ye(i,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):g.push(new Ye(i,e.source,`source "${e.source}" not found`))}else g.push(new Ye(i,e,'terrain is missing required property "source"'));return g}function ku(n){const e=n.value,i=n.style,o=n.styleSpec,u=o.fog;let f=[];const g=Rt(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new Ye("fog",e,`object expected, ${g} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&u[b[1]]&&u[b[1]].transition?Pi({key:y,value:e[y],valueSpec:o.transition,style:i,styleSpec:o}):u[y]?Pi({key:y,value:e[y],valueSpec:u[y],style:i,styleSpec:o}):[new Ye(y,e[y],`unknown property "${y}"`)])}return f}const Du={"*":()=>[],array:vi,boolean:function(n){const e=n.value,i=n.key,o=Rt(e);return"boolean"!==o?[new Ye(i,e,`boolean expected, ${o} found`)]:[]},number:ol,color:function(n){const e=n.key,i=n.value,o=Rt(i);return"string"!==o?[new Ye(e,i,`color expected, ${o} found`)]:null===lo.parseCSSColor(i)?[new Ye(e,i,`color expected, "${i}" found`)]:[]},enum:ft,filter:as,function:os,layer:ll,object:Pt,source:Eu,light:Tu,terrain:cs,fog:ku,string:Qs,formatted:function(n){return 0===Qs(n).length?[]:Ht(n)},resolvedImage:function(n){return 0===Qs(n).length?[]:Ht(n)},projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,u=n.style;let f=[];const g=Rt(e);if("object"===g)for(const y in e)f=f.concat(Pi({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}));else"string"!==g&&(f=f.concat([new Ye("projection",e,`object or string expected, ${g} found`)]));return f}};function Pi(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return i.expression&&is(pi(e))?os(n):i.expression&&nl(Or(e))?Ht(n):i.type&&Du[i.type]?Du[i.type](n):Pt(bn({},n,{valueSpec:i.type?o[i.type]:i}))}function Oh(n){const e=n.value,i=n.key,o=Qs(n);return o.length||(-1===e.indexOf("{fontstack}")&&o.push(new Ye(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&o.push(new Ye(i,e,'"glyphs" url must include a "{range}" token'))),o}function ea(n,e=Ce){return er(Pi({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Oh,"*":()=>[]}}))}const cl=n=>er(Au(n)),Iu=n=>er(Su(n));function er(n){return n.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function ul(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new jt(new Error(o.message))),i=!0;return i}var vo=Fn;function Fn(n,e,i){var o=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var f=0;f<this.d*this.d;f++){var g=u[3+f],y=u[3+f+1];o.push(g===y?null:u.subarray(g,y))}var b=u[3+o.length+1];this.keys=u.subarray(u[3+o.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var w=0;w<this.d*this.d;w++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=i,this.scale=e/n,this.uid=0;var S=i/e*n;this.min=-S,this.max=n+S}Fn.prototype.insert=function(n,e,i,o,u){this._forEachCell(e,i,o,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u)},Fn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fn.prototype._insertCell=function(n,e,i,o,u,f){this.cells[u].push(f)},Fn.prototype.query=function(n,e,i,o,u){var f=this.min,g=this.max;if(n<=f&&e<=f&&g<=i&&g<=o&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,i,o,this._queryCell,y,{},u),y},Fn.prototype._queryCell=function(n,e,i,o,u,f,g,y){var b=this.cells[u];if(null!==b)for(var w=this.keys,S=this.bboxes,T=0;T<b.length;T++){var k=b[T];if(void 0===g[k]){var F=4*k;(y?y(S[F+0],S[F+1],S[F+2],S[F+3]):n<=S[F+2]&&e<=S[F+3]&&i>=S[F+0]&&o>=S[F+1])?(g[k]=!0,f.push(w[k])):g[k]=!1}}},Fn.prototype._forEachCell=function(n,e,i,o,u,f,g,y){for(var b=this._convertToCellCoord(n),w=this._convertToCellCoord(e),S=this._convertToCellCoord(i),T=this._convertToCellCoord(o),k=b;k<=S;k++)for(var F=w;F<=T;F++){var L=this.d*F+k;if((!y||y(this._convertFromCellCoord(k),this._convertFromCellCoord(F),this._convertFromCellCoord(k+1),this._convertFromCellCoord(F+1)))&&u.call(this,n,e,i,o,L,f,g,y))return}},Fn.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Fn.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Fn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,g=0;g<n.length;g++){var y=n[g];u[3+g]=f,u.set(y,f),f+=y.length}return u[3+n.length]=f,u.set(this.keys,f),u[3+n.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const hl={};function Ke(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),hl[e]={klass:n,omit:i.omit||[]}}Ke(Object,"Object"),vo.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.push(i),{buffer:i}},vo.deserialize=function(n){return new vo(n.buffer)},Object.defineProperty(vo,"name",{value:"Grid"}),Ke(vo,"Grid"),Ke(Jt,"Color"),Ke(Error,"Error"),Ke(fe,"AJAXError"),Ke(hn,"ResolvedImage"),Ke(Ws,"StylePropertyFunction"),Ke(il,"StyleExpression",{omit:["_evaluator"]}),Ke(rl,"ZoomDependentExpression"),Ke(wu,"ZoomConstantExpression"),Ke(Mn,"CompoundExpression",{omit:["_evaluate"]});for(const n in $s)hl[$s[n]._classRegistryKey]||Ke($s[n],`Expression${n}`);function uc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function hc(n){return Be.ImageBitmap&&n instanceof Be.ImageBitmap}function ta(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(uc(n)||hc(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const i=n;return e&&e.push(i.buffer),i}if(n instanceof Be.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const o of n)i.push(ta(o,e));return i}if("object"==typeof n){const i=n.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const u=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const f in n)n.hasOwnProperty(f)&&(hl[o].omit.indexOf(f)>=0||(u[f]=ta(n[f],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==o&&(u.$name=o),u}throw new Error("can't serialize object of type "+typeof n)}function us(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||uc(n)||hc(n)||ArrayBuffer.isView(n)||n instanceof Be.ImageData)return n;if(Array.isArray(n))return n.map(us);if("object"==typeof n){const e=n.$name||"Object",{klass:i}=hl[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const u of Object.keys(n))"$name"!==u&&(o[u]=us(n[u]));return o}throw new Error("can't deserialize object of type "+typeof n)}class dc{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const Fu=n=>n>=1536&&n<=1791,pn=n=>n>=1872&&n<=1919,Lh=n=>n>=2208&&n<=2303,bo=n=>n>=11904&&n<=12031,dl=n=>n>=12032&&n<=12255,Br=n=>n>=12272&&n<=12287,pl=n=>n>=12288&&n<=12351,fl=n=>n>=12352&&n<=12447,jn=n=>n>=12448&&n<=12543,Ou=n=>n>=12544&&n<=12591,pc=n=>n>=12704&&n<=12735,Lu=n=>n>=12736&&n<=12783,fc=n=>n>=12784&&n<=12799,Ru=n=>n>=12800&&n<=13055,mc=n=>n>=13056&&n<=13311,hs=n=>n>=13312&&n<=19903,ia=n=>n>=19968&&n<=40959,na=n=>n>=40960&&n<=42127,Pu=n=>n>=42128&&n<=42191,zu=n=>n>=44032&&n<=55215,Rh=n=>n>=63744&&n<=64255,ra=n=>n>=64336&&n<=65023,Bu=n=>n>=65040&&n<=65055,gc=n=>n>=65072&&n<=65103,Vu=n=>n>=65104&&n<=65135,_c=n=>n>=65136&&n<=65279,yc=n=>n>=65280&&n<=65519;function wo(n){for(const e of n)if(oa(e.charCodeAt(0)))return!0;return!1}function Ph(n){for(const e of n)if(!zh(e.charCodeAt(0)))return!1;return!0}function zh(n){return!(Fu(n)||pn(n)||Lh(n)||ra(n)||_c(n))}function oa(n){return!(746!==n&&747!==n&&(n<4352||!(pc(n)||Ou(n)||gc(n)&&!(n>=65097&&n<=65103)||Rh(n)||mc(n)||bo(n)||Lu(n)||!(!pl(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||hs(n)||ia(n)||Ru(n)||(e=n,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||zu(n)||fl(n)||Br(n)||(e=>e>=12688&&e<=12703)(n)||dl(n)||fc(n)||jn(n)&&12540!==n||!(!yc(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!Vu(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||Bu(n)||(e=>e>=19904&&e<=19967)(n)||na(n)||Pu(n))));var e}function sa(n){return!(oa(n)||(e=n,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||pl(e)||jn(e)||(i=>i>=57344&&i<=63743)(e)||gc(e)||Vu(e)||yc(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function p(n){return n>=1424&&n<=2303||ra(n)||_c(n)}function r(n,e){return!(!e&&p(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(i=n,i>=6016&&i<=6143));var i}function c(n){for(const e of n)if(p(e.charCodeAt(0)))return!0;return!1}const m="deferred",x="loading",v="loaded";let C=null,A="unavailable",E=null;const D=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(A="error"),C&&C(n)};function I(){P.fire(new Kt("pluginStateChange",{pluginStatus:A,pluginURL:E}))}const P=new tt,V=function(){return A},$=function(){if(A!==m||!E)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");A=x,I(),E&&ge({url:E},n=>{n?D(n):(A=v,I())})},U={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>A===v||null!=U.applyArabicShaping,isLoading:()=>A===x,setState(n){A=n.pluginStatus,E=n.pluginURL},isParsed:()=>null!=U.applyArabicShaping&&null!=U.processBidirectionalText&&null!=U.processStyledBidirectionalText,getPluginURL:()=>E};class j{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dc,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,o){for(const u of i)if(!r(u.charCodeAt(0),o))return!1;return!0}(e,U.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}class H{constructor(e,i){this.property=e,this.value=i,this.expression=function(o,u){if(is(o))return new Ws(o,u);if(nl(o)){const f=Cu(o,u);if("error"===f.result)throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=o;return"string"==typeof o&&"color"===u.type&&(f=Jt.parse(o)),{kind:"constant",evaluate:()=>f}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class N{constructor(e){this.property=e,this.value=new H(e,void 0)}transitioned(e,i){return new Z(this.property,this.value,i,Gt({},e.transition,this.transition),e.now)}untransitioned(){return new Z(this.property,this.value,null,{},0)}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return gn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new N(this._values[e].property)),this._values[e].value=new H(this._values[e].property,null===i?void 0:gn(i))}getTransition(e){return gn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new N(this._values[e].property)),this._values[e].transition=gn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);void 0!==o&&(e[i]=o);const u=this.getTransition(i);void 0!==u&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const o=new ae(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new ae(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Z{constructor(e,i,o,u,f){const g=u.delay||0,y=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+g,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,o),g=this.prior;if(g){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return g.possiblyEvaluate(e,i,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,o),f,Go(y))}}return f}}class ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new se(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class oe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return gn(this._values[e].value)}setValue(e,i){this._values[e]=new H(this._values[e].property,null===i?void 0:gn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);void 0!==o&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new se(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}}class te{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class re{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const u=Jo[this.specification.type];return u?u(e,i,o):e}}class de{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new te(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new te(this,{kind:"constant",value:void 0},e.parameters);const u=Jo[this.specification.type];return u?new te(this,{kind:"constant",value:u(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,u,f,g){return"constant"===e.kind?e.value:e.evaluate(i,o,u,f,g)}}class _e extends de{possiblyEvaluate(e,i,o,u){if(void 0===e.value)return new te(this,{kind:"constant",value:void 0},i);if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},o,u),g="resolvedImage"===e.property.specification.type&&"string"!=typeof f?f.name:f,y=this._calculate(g,g,g,i);return new te(this,{kind:"constant",value:y},i)}if("camera"===e.expression.kind){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new te(this,{kind:"constant",value:f},i)}return new te(this,e.expression,i)}evaluate(e,i,o,u,f,g){if("source"===e.kind){const y=e.evaluate(i,o,u,f,g);return this._calculate(y,y,y,i)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,u),e.evaluate({zoom:Math.floor(i.zoom)},o,u),e.evaluate({zoom:Math.floor(i.zoom)+1},o,u),i):e.value}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i,other:o}:{from:o,to:i,other:e}}interpolate(e){return e}}class Le{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){if(void 0!==e.value){if("constant"===e.expression.kind){const f=e.expression.evaluate(i,null,{},o,u);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new j(Math.floor(i.zoom-1),i)),e.expression.evaluate(new j(Math.floor(i.zoom),i)),e.expression.evaluate(new j(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class me{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class Ae{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new j(0,{});for(const o in e){const u=e[o];u.specification.overridable&&this.overridableProperties.push(o);const f=this.defaultPropertyValues[o]=new H(u,void 0),g=this.defaultTransitionablePropertyValues[o]=new N(u);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=f.possiblyEvaluate(i)}}}function ke(n,e){return 256*(n=yt(Math.floor(n),0,255))+yt(Math.floor(e),0,255)}Ke(de,"DataDrivenProperty"),Ke(re,"DataConstantProperty"),Ke(_e,"CrossFadedDataDrivenProperty"),Ke(Le,"CrossFadedProperty"),Ke(me,"ColorRampProperty");const Ge={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class be{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Te(n,e=1){let i=0,o=0;return{members:n.map(u=>{const f=Ge[u.type].BYTES_PER_ELEMENT,g=i=$e(i,Math.max(e,f)),y=u.components||1;return o=Math.max(o,f),i+=f*y,{name:u.name,type:u.type,components:y,offset:g}}),size:$e(i,Math.max(o,e)),alignment:e}}function $e(n,e){return Math.ceil(n/e)*e}class Ne extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}Ne.prototype.bytesPerElement=4,Ke(Ne,"StructArrayLayout2i4");class Qe extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=u,e}}Qe.prototype.bytesPerElement=6,Ke(Qe,"StructArrayLayout3i6");class nt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=u,this.int16[g+3]=f,e}}nt.prototype.bytesPerElement=8,Ke(nt,"StructArrayLayout4i8");class lt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,u,f,g,y)}emplace(e,i,o,u,f,g,y,b){const w=6*e,S=12*e,T=3*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.uint8[S+4]=u,this.uint8[S+5]=f,this.uint8[S+6]=g,this.uint8[S+7]=y,this.float32[T+2]=b,e}}lt.prototype.bytesPerElement=12,Ke(lt,"StructArrayLayout2i4ub1f12");class Tt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=u,this.float32[g+3]=f,e}}Tt.prototype.bytesPerElement=16,Ke(Tt,"StructArrayLayout4f16");class Je extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g,y,b,w,S){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,u,f,g,y,b,w,S)}emplace(e,i,o,u,f,g,y,b,w,S,T){const k=10*e;return this.uint16[k+0]=i,this.uint16[k+1]=o,this.uint16[k+2]=u,this.uint16[k+3]=f,this.uint16[k+4]=g,this.uint16[k+5]=y,this.uint16[k+6]=b,this.uint16[k+7]=w,this.uint16[k+8]=S,this.uint16[k+9]=T,e}}Je.prototype.bytesPerElement=20,Ke(Je,"StructArrayLayout10ui20");class pt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g,y,b){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,u,f,g,y,b)}emplace(e,i,o,u,f,g,y,b,w){const S=8*e;return this.uint16[S+0]=i,this.uint16[S+1]=o,this.uint16[S+2]=u,this.uint16[S+3]=f,this.uint16[S+4]=g,this.uint16[S+5]=y,this.uint16[S+6]=b,this.uint16[S+7]=w,e}}pt.prototype.bytesPerElement=16,Ke(pt,"StructArrayLayout8ui16");class zt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,g)}emplace(e,i,o,u,f,g,y){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=u,this.int16[b+3]=f,this.int16[b+4]=g,this.int16[b+5]=y,e}}zt.prototype.bytesPerElement=12,Ke(zt,"StructArrayLayout6i12");class si extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g,y,b,w,S,T,k){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,o,u,f,g,y,b,w,S,T,k)}emplace(e,i,o,u,f,g,y,b,w,S,T,k,F){const L=12*e;return this.int16[L+0]=i,this.int16[L+1]=o,this.int16[L+2]=u,this.int16[L+3]=f,this.uint16[L+4]=g,this.uint16[L+5]=y,this.uint16[L+6]=b,this.uint16[L+7]=w,this.int16[L+8]=S,this.int16[L+9]=T,this.int16[L+10]=k,this.int16[L+11]=F,e}}si.prototype.bytesPerElement=24,Ke(si,"StructArrayLayout4i4ui4i24");class yi extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,g)}emplace(e,i,o,u,f,g,y){const b=10*e,w=5*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=u,this.float32[w+2]=f,this.float32[w+3]=g,this.float32[w+4]=y,e}}yi.prototype.bytesPerElement=20,Ke(yi,"StructArrayLayout3i3f20");class Zt extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Zt.prototype.bytesPerElement=4,Ke(Zt,"StructArrayLayout1ul4");class Ui extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g,y,b,w,S,T,k,F){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,o,u,f,g,y,b,w,S,T,k,F)}emplace(e,i,o,u,f,g,y,b,w,S,T,k,F,L){const B=20*e,G=10*e;return this.int16[B+0]=i,this.int16[B+1]=o,this.int16[B+2]=u,this.int16[B+3]=f,this.int16[B+4]=g,this.float32[G+3]=y,this.float32[G+4]=b,this.float32[G+5]=w,this.float32[G+6]=S,this.int16[B+14]=T,this.uint32[G+8]=k,this.uint16[B+18]=F,this.uint16[B+19]=L,e}}Ui.prototype.bytesPerElement=40,Ke(Ui,"StructArrayLayout5i4f1i1ul2ui40");class tr extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,u,f,g,y)}emplace(e,i,o,u,f,g,y,b){const w=8*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+4]=f,this.int16[w+5]=g,this.int16[w+6]=y,this.int16[w+7]=b,e}}tr.prototype.bytesPerElement=16,Ke(tr,"StructArrayLayout3i2i2i16");class ir extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,u,f)}emplace(e,i,o,u,f,g){const y=4*e,b=8*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[b+6]=f,this.int16[b+7]=g,e}}ir.prototype.bytesPerElement=16,Ke(ir,"StructArrayLayout2f1f2i16");class ri extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const g=12*e,y=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=o,this.float32[y+1]=u,this.float32[y+2]=f,e}}ri.prototype.bytesPerElement=12,Ke(ri,"StructArrayLayout2ub2f12");class ui extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}ui.prototype.bytesPerElement=12,Ke(ui,"StructArrayLayout3f12");class At extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=u,e}}At.prototype.bytesPerElement=6,Ke(At,"StructArrayLayout3ui6");class Si extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g,y,b,w,S,T,k,F,L,B,G,X,ie,J,ee,le){const ne=this.length;return this.resize(ne+1),this.emplace(ne,e,i,o,u,f,g,y,b,w,S,T,k,F,L,B,G,X,ie,J,ee,le)}emplace(e,i,o,u,f,g,y,b,w,S,T,k,F,L,B,G,X,ie,J,ee,le,ne){const ve=30*e,ye=15*e,Me=60*e;return this.int16[ve+0]=i,this.int16[ve+1]=o,this.int16[ve+2]=u,this.float32[ye+2]=f,this.float32[ye+3]=g,this.uint16[ve+8]=y,this.uint16[ve+9]=b,this.uint32[ye+5]=w,this.uint32[ye+6]=S,this.uint32[ye+7]=T,this.uint16[ve+16]=k,this.uint16[ve+17]=F,this.uint16[ve+18]=L,this.float32[ye+10]=B,this.float32[ye+11]=G,this.uint8[Me+48]=X,this.uint8[Me+49]=ie,this.uint8[Me+50]=J,this.uint32[ye+13]=ee,this.int16[ve+28]=le,this.uint8[Me+58]=ne,e}}Si.prototype.bytesPerElement=60,Ke(Si,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class $i extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,g,y,b,w,S,T,k,F,L,B,G,X,ie,J,ee,le,ne,ve,ye,Me,ze,we,Ee,Ie,Se){const Re=this.length;return this.resize(Re+1),this.emplace(Re,e,i,o,u,f,g,y,b,w,S,T,k,F,L,B,G,X,ie,J,ee,le,ne,ve,ye,Me,ze,we,Ee,Ie,Se)}emplace(e,i,o,u,f,g,y,b,w,S,T,k,F,L,B,G,X,ie,J,ee,le,ne,ve,ye,Me,ze,we,Ee,Ie,Se,Re){const Fe=38*e,Ze=19*e;return this.int16[Fe+0]=i,this.int16[Fe+1]=o,this.int16[Fe+2]=u,this.float32[Ze+2]=f,this.float32[Ze+3]=g,this.int16[Fe+8]=y,this.int16[Fe+9]=b,this.int16[Fe+10]=w,this.int16[Fe+11]=S,this.int16[Fe+12]=T,this.int16[Fe+13]=k,this.uint16[Fe+14]=F,this.uint16[Fe+15]=L,this.uint16[Fe+16]=B,this.uint16[Fe+17]=G,this.uint16[Fe+18]=X,this.uint16[Fe+19]=ie,this.uint16[Fe+20]=J,this.uint16[Fe+21]=ee,this.uint16[Fe+22]=le,this.uint16[Fe+23]=ne,this.uint16[Fe+24]=ve,this.uint16[Fe+25]=ye,this.uint16[Fe+26]=Me,this.uint16[Fe+27]=ze,this.uint16[Fe+28]=we,this.uint32[Ze+15]=Ee,this.float32[Ze+16]=Ie,this.float32[Ze+17]=Se,this.float32[Ze+18]=Re,e}}$i.prototype.bytesPerElement=76,Ke($i,"StructArrayLayout3i2f6i15ui1ul3f76");class ti extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ti.prototype.bytesPerElement=4,Ke(ti,"StructArrayLayout1f4");class on extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,u,f)}emplace(e,i,o,u,f,g){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=u,this.float32[y+3]=f,this.float32[y+4]=g,e}}on.prototype.bytesPerElement=20,Ke(on,"StructArrayLayout5f20");class Co extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=o,this.uint16[g+3]=u,this.uint16[g+4]=f,e}}Co.prototype.bytesPerElement=12,Ke(Co,"StructArrayLayout1ul3ui12");class sn extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}sn.prototype.bytesPerElement=4,Ke(sn,"StructArrayLayout2ui4");class Vr extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Vr.prototype.bytesPerElement=2,Ke(Vr,"StructArrayLayout1ui2");class Gr extends Pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}Gr.prototype.bytesPerElement=8,Ke(Gr,"StructArrayLayout2f8");class Mo extends be{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Mo.prototype.size=12;class an extends zt{get(e){return new Mo(this,e)}}Ke(an,"FillExtrusionExtArray");class Ao extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ao.prototype.size=40;class Nr extends Ui{get(e){return new Ao(this,e)}}Ke(Nr,"CollisionBoxArray");class aa extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}aa.prototype.size=60;class Kf extends Si{get(e){return new aa(this,e)}}Ke(Kf,"PlacedSymbolArray");class tp extends be{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}tp.prototype.size=76;class ip extends $i{get(e){return new tp(this,e)}}Ke(ip,"SymbolInstanceArray");class Bh extends ti{getoffsetX(e){return this.float32[1*e+0]}}Ke(Bh,"GlyphOffsetArray");class Vh extends Qe{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ke(Vh,"SymbolLineVertexArray");class np extends be{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}np.prototype.size=12;class rp extends Co{get(e){return new np(this,e)}}Ke(rp,"FeatureIndexArray");class op extends be{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}op.prototype.size=4;class sp extends sn{get(e){return new op(this,e)}}Ke(sp,"FillExtrusionCentroidArray");class ap extends be{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ap.prototype.size=12;class Jf extends zt{get(e){return new ap(this,e)}}Ke(Jf,"CircleGlobeExtArray");const Qf=Te([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),em=Te([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var lp=Ra(function(n){n.exports=function(e,i){var o,u,f,g,y,b,w,S;for(u=e.length-(o=3&e.length),f=i,y=3432918353,b=461845907,S=0;S<u;)w=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,f=27492+(65535&(g=5*(65535&(f=(f^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(w=0,o){case 3:w^=(255&e.charCodeAt(S+2))<<16;case 2:w^=(255&e.charCodeAt(S+1))<<8;case 1:f^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(S)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),tm=Ra(function(n){n.exports=function(e,i){for(var o,u=e.length,f=i^u,g=0;u>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(g)|(255&e.charCodeAt(++g))<<8|(255&e.charCodeAt(++g))<<16|(255&e.charCodeAt(++g))<<24))+((1540483477*(o>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),u-=4,++g;switch(u){case 3:f^=(255&e.charCodeAt(g+2))<<16;case 2:f^=(255&e.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),xc=lp,im=tm;xc.murmur3=lp,xc.murmur2=im;class Gu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(nm(e)),this.positions.push(i,o,u)}getPositions(e){const i=nm(e);let o=0,u=this.ids.length-1;for(;o<u;){const g=o+u>>1;this.ids[g]>=i?u=g:o=g+1}const f=[];for(;this.ids[o]===i;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Gh(o,u,0,o.length-1),i&&i.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const i=new Gu;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function nm(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:xc(String(n))}function Gh(n,e,i,o){for(;i<o;){const u=n[i+o>>1];let f=i-1,g=o+1;for(;;){do{f++}while(n[f]<u);do{g--}while(n[g]>u);if(f>=g)break;Nu(n,f,g),Nu(e,3*f,3*g),Nu(e,3*f+1,3*g+1),Nu(e,3*f+2,3*g+2)}g-i<o-g?(Gh(n,e,i,g),i=g+1):(Gh(n,e,g+1,o),o=g)}}function Nu(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}Ke(Gu,"FeaturePositionMap");class So{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Uu extends So{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class cp extends So{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class up extends So{constructor(e){super(e),this.current=Jt.transparent}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const rm=new Float32Array(16),om=new Float32Array(9),Hg=new Float32Array(4);function Nh(n){return[ke(255*n.r,255*n.g),ke(255*n.b,255*n.a)]}class vc{constructor(e,i,o){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=o}setUniform(e,i,o,u,f){i.set(e,f,u.constantOr(this.value))}getBinding(e,i){return"color"===this.type?new up(e):new Uu(e)}}class ml{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,o,u,f){const g="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;g&&i.set(e,f,g)}getBinding(e,i){return"u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?new cp(e):new Uu(e)}}class Eo{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===o?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,o,u,f,g){const y=this.paintVertexArray.length,b=this.expression.evaluate(new j(0),i,{},f,u,g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,i,o,u,f){const g=this.expression.evaluate({zoom:0},o,u,void 0,f);this._setPaintValue(e,i,g)}_setPaintValue(e,i,o){if("color"===this.type){const u=Nh(o);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wr{constructor(e,i,o,u,f,g){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===o?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,o,u,f,g){const y=this.expression.evaluate(new j(this.zoom),i,{},f,u,g),b=this.expression.evaluate(new j(this.zoom+1),i,{},f,u,g),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,b)}updatePaintArray(e,i,o,u,f){const g=this.expression.evaluate({zoom:this.zoom},o,u,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},o,u,void 0,f);this._setPaintValue(e,i,g,y)}_setPaintValue(e,i,o,u){if("color"===this.type){const f=Nh(o),g=Nh(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,u,f){const g=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,y=yt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(e,f,y)}getBinding(e,i){return new Uu(e)}}class ds{constructor(e,i,o,u,f,g,y){this.expression=e,this.type=o,this.useIntegerZoom=u,this.zoom=f,this.layerId=y,this.paintVertexAttributes=("array"===o?em:Qf).members;for(let b=0;b<i.length;++b);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(e,i,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,u,f,g){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(e,i,o,u){if(!u||!o)return;const{min:f,mid:g,max:y}=o,b=u[f],w=u[g],S=u[y];if(b&&w&&S)for(let T=e;T<i;T++)this._setPaintValue(this.zoomInPaintVertexArray,T,w,b),this._setPaintValue(this.zoomOutPaintVertexArray,T,w,S)}_setPaintValue(e,i,o,u){e.emplace(i,o.tl[0],o.tl[1],o.br[0],o.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],o.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ps{constructor(e,i,o=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!o(f))continue;const g=e.paint.get(f);if(!(g instanceof te&&Qn(g.property.specification)))continue;const y=am(f,e.type),b=g.value,w=g.property.specification.type,S=g.property.useIntegerZoom,T=g.property.specification["property-type"],k="cross-faded"===T||"cross-faded-data-driven"===T,F="line-dasharray"===String(f)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==b.kind||F)if("source"===b.kind||F||k){const L=hp(f,w,"source");this.binders[f]=k?new ds(b,y,w,S,i,L,e.id):new Eo(b,y,w,L),u.push(`/a_${f}`)}else{const L=hp(f,w,"composite");this.binders[f]=new wr(b,y,w,S,i,L),u.push(`/z_${f}`)}else this.binders[f]=k?new ml(b.value,y):new vc(b.value,y,w),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Eo||i instanceof wr?i.maxValue:0}populatePaintArrays(e,i,o,u,f,g){for(const y in this.binders){const b=this.binders[y];(b instanceof Eo||b instanceof wr||b instanceof ds)&&b.populatePaintArray(e,i,o,u,f,g)}}setConstantPatternPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof ml&&u.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,o,u,f,g){let y=!1;for(const b in e){const w=i.getPositions(b);for(const S of w){const T=o.feature(S.index);for(const k in this.binders){const F=this.binders[k];if((F instanceof Eo||F instanceof wr||F instanceof ds)&&!0===F.expression.isStateDependent){const L=u.paint.get(k);F.expression=L.value,F.updatePaintArray(S.start,S.end,T,e[b],f,g),y=!0}}}}return y}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof vc||o instanceof ml)&&e.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Eo||o instanceof wr||o instanceof ds)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof vc||o instanceof ml||o instanceof wr)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof vc||u instanceof ml||u instanceof wr)for(const f of u.uniformNames)i.push({name:f,property:o,binding:u.getBinding(e,f)})}return i}setUniforms(e,i,o,u,f){for(const{name:g,property:y,binding:b}of o)this.binders[y].setUniform(e,b,f,u.get(y),g)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof ds){const u=2===e.fromScale?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Eo||o instanceof wr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Eo||o instanceof wr||o instanceof ds)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Eo||i instanceof wr||i instanceof ds)&&i.destroy()}}}class gl{constructor(e,i,o=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new ps(u,i,o);this.needsUpload=!1,this._featureMap=new Gu,this._bufferOffset=0}populatePaintArrays(e,i,o,u,f,g,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,i,u,f,g,y);void 0!==i.id&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u,f){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const sm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function am(n,e){return sm[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const lm={"line-pattern":{source:Je,composite:Je},"fill-pattern":{source:Je,composite:Je},"fill-extrusion-pattern":{source:Je,composite:Je},"line-dasharray":{source:pt,composite:pt}},cm={color:{source:Gr,composite:Tt},number:{source:ti,composite:Gr}};function hp(n,e,i){const o=lm[n];return o&&o[i]||cm[e][i]}Ke(vc,"ConstantBinder"),Ke(ml,"CrossFadedConstantBinder"),Ke(Eo,"SourceExpressionBinder"),Ke(ds,"CrossFadedCompositeBinder"),Ke(wr,"CompositeExpressionBinder"),Ke(ps,"ProgramConfiguration",{omit:["_buffers"]}),Ke(gl,"ProgramConfigurationSet");const ju="-transition";class Ur extends tt{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new oe(i.layout)),i.paint)){this._transitionablePaint=new K(i.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,o={}){null!=i&&this._validate(Iu,`layers.${this.id}.layout.${e}`,e,i,o)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return io(e,ju)?this._transitionablePaint.getTransition(e.slice(0,-ju.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(null!=i&&this._validate(cl,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(io(e,ju))return this._transitionablePaint.setTransition(e.slice(0,-ju.length),i||void 0),!1;{const u=this._transitionablePaint._values[e],f="cross-faded-data-driven"===u.property.specification["property-type"],g=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(e,y,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Tr(e,(i,o)=>!(void 0===i||"layout"===o&&!Object.keys(i).length||"paint"===o&&!Object.keys(i).length))}_validate(e,i,o,u,f={}){return(!f||!1!==f.validate)&&ul(this,e.call(ea,{key:i,layerType:this.type,objectKey:o,value:u,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof te&&Qn(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ks(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const um=Te([{name:"a_pos",components:2,type:"Int16"}],4),hm=Te([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ei{constructor(e=[]){this.segments=e}prepareSegment(e,i,o,u){let f=this.segments[this.segments.length-1];return e>Ei.MAX_VERTEX_ARRAY_LENGTH&&ai(`Max vertices per segment is ${Ei.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Ei.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new Ei([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}Ei.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ke(Ei,"SegmentVector");var ct=8192;class fs{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof qt?new qt(e.lng,e.lat):qt.convert(e),this}setSouthWest(e){return this._sw=e instanceof qt?new qt(e.lng,e.lat):qt.convert(e),this}extend(e){const i=this._sw,o=this._ne;let u,f;if(e instanceof qt)u=e,f=e;else{if(!(e instanceof fs))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(fs.convert(e)):this.extend(qt.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||o?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),o.lng=Math.max(f.lng,o.lng),o.lat=Math.max(f.lat,o.lat)):(this._sw=new qt(u.lng,u.lat),this._ne=new qt(f.lng,f.lat)),this}getCenter(){return new qt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qt(this.getWest(),this.getNorth())}getSouthEast(){return new qt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=qt.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&u}static convert(e){return!e||e instanceof fs?e:new fs(e)}}const Uh=6371008.8;class qt{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qt(Er(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return Uh*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new fs(new qt(this.lng-o,this.lat-i),new qt(this.lng+o,this.lat+i))}static convert(e){if(e instanceof qt)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new qt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new qt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const dp=2*Math.PI*Uh;function pp(n){return dp*Math.cos(n*Math.PI/180)}function jr(n){return(180+n)/360}function To(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function nr(n,e){return n/pp(e)}function rr(n){return 360*n-180}function Zi(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function fp(n,e){return n*pp(Zi(e))}const Hr=85.051129;function dm(n){return 1/Math.cos(n*Math.PI/180)}class _l{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=qt.convert(e);return new _l(jr(o.lng),To(o.lat),nr(i,o.lat))}toLngLat(){return new qt(rr(this.x),Zi(this.y))}toAltitude(){return fp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/dp*dm(Zi(this.y))}}function jh(n,e,i,o,u,f,g,y,b){const w=(e+o)/2,S=(i+u)/2,T=new Ue(w,S);y(T),function(k,F,L,B,G,X){const ie=L-G,J=B-X;return Math.abs((B-F)*ie-(L-k)*J)/Math.hypot(ie,J)}(T.x,T.y,f.x,f.y,g.x,g.y)>=b?(jh(n,e,i,w,S,f,T,y,b),jh(n,w,S,o,u,T,g,y,b)):n.push(g)}function mp(n,e,i){let o=n[0],u=o.x,f=o.y;e(o);const g=[o];for(let y=1;y<n.length;y++){const b=n[y],{x:w,y:S}=b;e(b),jh(g,u,f,w,S,o,b,e,i),u=w,f=S,o=b}return g}function Hh(n,e,i,o,u){if(u(e,i)){const f=e.add(i).mult(.5);o(f),Hh(n,e,f,o,u),Hh(n,f,i,o,u)}else n.push(i)}function pm(n,e,i){let o=n[0];e(o);const u=[o];for(let f=1;f<n.length;f++){const g=n[f];e(g),Hh(u,o,g,e,i),o=g}return u}const qh=Math.pow(2,14)-1,fm=-qh-1;function mm(n,e){const i=Math.round(n.x*e),o=Math.round(n.y*e);return n.x=yt(i,fm,qh),n.y=yt(o,fm,qh),(i<n.x||i>n.x+1||o<n.y||o>n.y+1)&&ai("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function ko(n,e,i){const o=n.loadGeometry(),u=n.extent,f=ct/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:y,x:b,y:w,projection:S}=i,T=k=>{const F=rr((e.x+k.x/u)/g),L=Zi((e.y+k.y/u)/g),B=S.project(F,L);k.x=(B.x*y-b)*u,k.y=(B.y*y-w)*u};for(let k=0;k<o.length;k++)if(1!==n.type)o[k]=mp(o[k],T,1);else{const F=[];for(const L of o[k])L.x<0||L.x>=u||L.y<0||L.y>=u||(T(L),F.push(L));o[k]=F}}for(const g of o)for(const y of g)mm(y,f);return o}function ms(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?ko(n):[]}}function Hu(n,e,i,o,u){n.emplaceBack(2*e+(o+1)/2,2*i+(u+1)/2)}function qu(n,e,i){n.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class $h{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ne,this.indexArray=new At,this.segments=new Ei,this.programConfigurations=new gl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,u){const f=this.layers[0],g=[];let y=null;"circle"===f.type&&(y=f.layout.get("circle-sort-key"));for(const{feature:w,id:S,index:T,sourceLayerIndex:k}of e){const F=this.layers[0]._featureFilter.needGeometry,L=ms(w,F);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),L,o))continue;const B=y?y.evaluate(L,{},o):void 0,G={id:S,properties:w.properties,type:w.type,sourceLayerIndex:k,index:T,geometry:F?L.geometry:ko(w,o,u),patterns:{},sortKey:B};g.push(G)}y&&g.sort((w,S)=>w.sortKey-S.sortKey);let b=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new Jf,b=u.projection);for(const w of g){const{geometry:S,index:T,sourceLayerIndex:k}=w,F=e[T].feature;this.addFeature(w,S,T,i.availableImages,o,b),i.featureIndex.insert(F,S,T,k,this.index)}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,um.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,u,f,g){for(const y of i)for(const b of y){const w=b.x,S=b.y;if(w<0||w>=ct||S<0||S>=ct)continue;if(g){const F=g.projectTilePoint(w,S,f),L=g.upVector(f,w,S),B=this.globeExtVertexArray;qu(B,F,L),qu(B,F,L),qu(B,F,L),qu(B,F,L)}const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=T.vertexLength;Hu(this.layoutVertexArray,w,S,-1,-1),Hu(this.layoutVertexArray,w,S,1,-1),Hu(this.layoutVertexArray,w,S,1,1),Hu(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},u,f)}}function gp(n,e){for(let i=0;i<n.length;i++)if(la(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(la(n,e[i]))return!0;return!!_p(n,e)}function gm(n,e,i){return!!la(n,e)||!!xp(e,n,i)}function _m(n,e){if(1===n.length)return yl(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(la(n,o[u]))return!0}for(let i=0;i<n.length;i++)if(yl(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(_p(n,e[i]))return!0;return!1}function qg(n,e,i){if(n.length>1){if(_p(n,e))return!0;for(let o=0;o<e.length;o++)if(xp(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(xp(n[o],e,i))return!0;return!1}function _p(n,e){if(0===n.length||0===e.length)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if(yp(o,u,e[f],e[f+1]))return!0}return!1}function yp(n,e,i,o){return Bi(n,i,o)!==Bi(e,i,o)&&Bi(n,e,i)!==Bi(n,e,o)}function xp(n,e,i){const o=i*i;if(1===e.length)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(vp(n,e[u-1],e[u])<o)return!0;return!1}function vp(n,e,i){const o=e.distSqr(i);if(0===o)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function yl(n,e){let i,o,u,f=!1;for(let g=0;g<n.length;g++){i=n[g];for(let y=0,b=i.length-1;y<i.length;b=y++)o=i[y],u=i[b],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function la(n,e){let i=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const f=n[o],g=n[u];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(i=!i)}return i}function bp(n,e,i,o,u){for(const g of n)if(e<=g.x&&i<=g.y&&o>=g.x&&u>=g.y)return!0;const f=[new Ue(e,i),new Ue(e,u),new Ue(o,u),new Ue(o,i)];if(n.length>2)for(const g of f)if(la(n,g))return!0;for(let g=0;g<n.length-1;g++)if(wp(n[g],n[g+1],f))return!0;return!1}function wp(n,e,i){const o=i[0],u=i[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const f=Bi(n,e,i[0]);return f!==Bi(n,e,i[1])||f!==Bi(n,e,i[2])||f!==Bi(n,e,i[3])}function xl(n,e,i){const o=e.paint.get(n).value;return"constant"===o.kind?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function $u(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function ca(n,e,i,o,u){if(!e[0]&&!e[1])return n;const f=Ue.convert(e)._mult(u);"viewport"===i&&f._rotate(-o);const g=[];for(let y=0;y<n.length;y++)g.push(n[y].sub(f));return g}function An(n,e,i,o){const u=Ue.convert(n)._mult(o);return"viewport"===e&&u._rotate(-i),u}Ke($h,"CircleBucket",{omit:["layers"]});const ym=new Ae({"circle-sort-key":new de(Ce.layout_circle["circle-sort-key"])});var Cp={paint:new Ae({"circle-radius":new de(Ce.paint_circle["circle-radius"]),"circle-color":new de(Ce.paint_circle["circle-color"]),"circle-blur":new de(Ce.paint_circle["circle-blur"]),"circle-opacity":new de(Ce.paint_circle["circle-opacity"]),"circle-translate":new re(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new re(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new re(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new re(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new de(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new de(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new de(Ce.paint_circle["circle-stroke-opacity"])}),layout:ym},Zu=1e-6,Yi=typeof Float32Array<"u"?Float32Array:Array;function ua(){var n=new Yi(9);return Yi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Cr(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Zh(n,e){var i=e[0],o=e[1],u=e[2],f=e[3],g=e[4],y=e[5],b=e[6],w=e[7],S=e[8],T=e[9],k=e[10],F=e[11],L=e[12],B=e[13],G=e[14],X=e[15],ie=i*y-o*g,J=i*b-u*g,ee=i*w-f*g,le=o*b-u*y,ne=o*w-f*y,ve=u*w-f*b,ye=S*B-T*L,Me=S*G-k*L,ze=S*X-F*L,we=T*G-k*B,Ee=T*X-F*B,Ie=k*X-F*G,Se=ie*Ie-J*Ee+ee*we+le*ze-ne*Me+ve*ye;return Se?(n[0]=(y*Ie-b*Ee+w*we)*(Se=1/Se),n[1]=(u*Ee-o*Ie-f*we)*Se,n[2]=(B*ve-G*ne+X*le)*Se,n[3]=(k*ne-T*ve-F*le)*Se,n[4]=(b*ze-g*Ie-w*Me)*Se,n[5]=(i*Ie-u*ze+f*Me)*Se,n[6]=(G*ee-L*ve-X*J)*Se,n[7]=(S*ve-k*ee+F*J)*Se,n[8]=(g*Ee-y*ze+w*ye)*Se,n[9]=(o*ze-i*Ee-f*ye)*Se,n[10]=(L*ne-B*ee+X*ie)*Se,n[11]=(T*ee-S*ne-F*ie)*Se,n[12]=(y*Me-g*we-b*ye)*Se,n[13]=(i*we-o*Me+u*ye)*Se,n[14]=(B*J-L*le-G*ie)*Se,n[15]=(S*le-T*J+k*ie)*Se,n):null}function vl(n,e,i){var o=e[0],u=e[1],f=e[2],g=e[3],y=e[4],b=e[5],w=e[6],S=e[7],T=e[8],k=e[9],F=e[10],L=e[11],B=e[12],G=e[13],X=e[14],ie=e[15],J=i[0],ee=i[1],le=i[2],ne=i[3];return n[0]=J*o+ee*y+le*T+ne*B,n[1]=J*u+ee*b+le*k+ne*G,n[2]=J*f+ee*w+le*F+ne*X,n[3]=J*g+ee*S+le*L+ne*ie,n[4]=(J=i[4])*o+(ee=i[5])*y+(le=i[6])*T+(ne=i[7])*B,n[5]=J*u+ee*b+le*k+ne*G,n[6]=J*f+ee*w+le*F+ne*X,n[7]=J*g+ee*S+le*L+ne*ie,n[8]=(J=i[8])*o+(ee=i[9])*y+(le=i[10])*T+(ne=i[11])*B,n[9]=J*u+ee*b+le*k+ne*G,n[10]=J*f+ee*w+le*F+ne*X,n[11]=J*g+ee*S+le*L+ne*ie,n[12]=(J=i[12])*o+(ee=i[13])*y+(le=i[14])*T+(ne=i[15])*B,n[13]=J*u+ee*b+le*k+ne*G,n[14]=J*f+ee*w+le*F+ne*X,n[15]=J*g+ee*S+le*L+ne*ie,n}function bc(n,e,i){var o,u,f,g,y,b,w,S,T,k,F,L,B=i[0],G=i[1],X=i[2];return e===n?(n[12]=e[0]*B+e[4]*G+e[8]*X+e[12],n[13]=e[1]*B+e[5]*G+e[9]*X+e[13],n[14]=e[2]*B+e[6]*G+e[10]*X+e[14],n[15]=e[3]*B+e[7]*G+e[11]*X+e[15]):(u=e[1],f=e[2],g=e[3],y=e[4],b=e[5],w=e[6],S=e[7],T=e[8],k=e[9],F=e[10],L=e[11],n[0]=o=e[0],n[1]=u,n[2]=f,n[3]=g,n[4]=y,n[5]=b,n[6]=w,n[7]=S,n[8]=T,n[9]=k,n[10]=F,n[11]=L,n[12]=o*B+y*G+T*X+e[12],n[13]=u*B+b*G+k*X+e[13],n[14]=f*B+w*G+F*X+e[14],n[15]=g*B+S*G+L*X+e[15]),n}function ha(n,e,i){var o=i[0],u=i[1],f=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Yh(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[4],g=e[5],y=e[6],b=e[7],w=e[8],S=e[9],T=e[10],k=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+w*o,n[5]=g*u+S*o,n[6]=y*u+T*o,n[7]=b*u+k*o,n[8]=w*u-f*o,n[9]=S*u-g*o,n[10]=T*u-y*o,n[11]=k*u-b*o,n}function Yu(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],g=e[1],y=e[2],b=e[3],w=e[8],S=e[9],T=e[10],k=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-w*o,n[1]=g*u-S*o,n[2]=y*u-T*o,n[3]=b*u-k*o,n[8]=f*o+w*u,n[9]=g*o+S*u,n[10]=y*o+T*u,n[11]=b*o+k*u,n}function Mp(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ap(n,e,i){var o,u,f,g=i[0],y=i[1],b=i[2],w=Math.hypot(g,y,b);return w<Zu?null:(g*=w=1/w,y*=w,b*=w,o=Math.sin(e),u=Math.cos(e),n[0]=g*g*(f=1-u)+u,n[1]=y*g*f+b*o,n[2]=b*g*f-y*o,n[3]=0,n[4]=g*y*f-b*o,n[5]=y*y*f+u,n[6]=b*y*f+g*o,n[7]=0,n[8]=g*b*f+y*o,n[9]=y*b*f-g*o,n[10]=b*b*f+u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var xm=vl;function Wh(){var n=new Yi(3);return Yi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Sp(n){var e=new Yi(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function wc(n){return Math.hypot(n[0],n[1],n[2])}function bl(n,e,i){var o=new Yi(3);return o[0]=n,o[1]=e,o[2]=i,o}function gs(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Xh(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Ep(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Do(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Kh(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function qr(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Wu(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n}function fn(n,e){var i=e[0],o=e[1],u=e[2],f=i*i+o*o+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function ki(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function or(n,e,i){var o=e[0],u=e[1],f=e[2],g=i[0],y=i[1],b=i[2];return n[0]=u*b-f*y,n[1]=f*g-o*b,n[2]=o*y-u*g,n}function zi(n,e,i){var o=e[0],u=e[1],f=e[2],g=i[3]*o+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*o+i[4]*u+i[8]*f+i[12])/(g=g||1),n[1]=(i[1]*o+i[5]*u+i[9]*f+i[13])/g,n[2]=(i[2]*o+i[6]*u+i[10]*f+i[14])/g,n}function vm(n,e,i){var o=i[0],u=i[1],f=i[2],g=e[0],y=e[1],b=e[2],w=u*b-f*y,S=f*g-o*b,T=o*y-u*g,k=u*T-f*S,F=f*w-o*T,L=o*S-u*w,B=2*i[3];return S*=B,T*=B,F*=2,L*=2,n[0]=g+(w*=B)+(k*=2),n[1]=y+S+F,n[2]=b+T+L,n}var Cc,$r=Xh,Xu=Ep,bm=wc;function Tp(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function da(n,e,i){var o=e[0],u=e[1],f=e[2],g=e[3];return n[0]=i[0]*o+i[4]*u+i[8]*f+i[12]*g,n[1]=i[1]*o+i[5]*u+i[9]*f+i[13]*g,n[2]=i[2]*o+i[6]*u+i[10]*f+i[14]*g,n[3]=i[3]*o+i[7]*u+i[11]*f+i[15]*g,n}function wm(){var n=new Yi(4);return Yi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Cm(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Ku(n,e,i){i*=.5;var o=e[0],u=e[1],f=e[2],g=e[3],y=Math.sin(i),b=Math.cos(i);return n[0]=o*b+g*y,n[1]=u*b+f*y,n[2]=f*b-u*y,n[3]=g*b-o*y,n}function Mc(n,e,i){i*=.5;var o=e[0],u=e[1],f=e[2],g=e[3],y=Math.sin(i),b=Math.cos(i);return n[0]=o*b-f*y,n[1]=u*b+g*y,n[2]=f*b+o*y,n[3]=g*b-u*y,n}Wh(),Cc=new Yi(4),Yi!=Float32Array&&(Cc[0]=0,Cc[1]=0,Cc[2]=0,Cc[3]=0),Wh(),bl(1,0,0),bl(0,1,0),wm(),wm(),ua();class kp{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const u=ki(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return o[0]=this.pos[0]+this.dir[0]*f,o[1]=this.pos[1]+this.dir[1]*f,o[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,o){if(B=(F=this.pos)[0],G=F[1],X=F[2],ie=(L=e)[0],J=L[1],ee=L[2],Math.abs(B-ie)<=Zu*Math.max(1,Math.abs(B),Math.abs(ie))&&Math.abs(G-J)<=Zu*Math.max(1,Math.abs(G),Math.abs(J))&&Math.abs(X-ee)<=Zu*Math.max(1,Math.abs(X),Math.abs(ee))||0===i)return o[0]=o[1]=o[2]=0,!1;var F,L,B,G,X,ie,J,ee;const[u,f,g]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],S=u*u+f*f+g*g,T=2*(y*u+b*f+w*g),k=T*T-4*S*(y*y+b*b+w*w-i*i);if(k<0){const F=Math.max(-T/2,0),L=y+u*F,B=b+f*F,G=w+g*F,X=Math.hypot(L,B,G);return o[0]=L*i/X,o[1]=B*i/X,o[2]=G*i/X,!1}{const F=(-T-Math.sqrt(k))/(2*S);if(F<0){const L=Math.hypot(y,b,w);return o[0]=y*i/L,o[1]=b*i/L,o[2]=w*i/L,!1}return o[0]=y+u*F,o[1]=b+f*F,o[2]=w+g*F,!0}}}class Dp{constructor(e,i,o,u,f){this.TL=e,this.TR=i,this.BR=o,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,i,o){const u=[-1,1,1],f=[1,1,1],g=[1,-1,1],y=[-1,-1,1],b=zi(u,u,e),w=zi(f,f,e),S=zi(g,g,e),T=zi(y,y,e);return new Dp(b,w,S,T,i/o)}}class Jh{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,o,u){const f=Math.pow(2,o),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const w=da([],b,e),S=1/w[3]/i*f;return(T=w)[0]=(k=w)[0]*(F=[S,S,u?1/w[3]:S,S])[0],T[1]=k[1]*F[1],T[2]=k[2]*F[2],T[3]=k[3]*F[3],T;var T,k,F}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const w=fn([],or([],$r([],g[b[0]],g[b[1]]),$r([],g[b[2]],g[b[1]]))),S=-ki(w,g[b[1]]);return w.concat(S)});return new Jh(g,y)}}class Sn{static fromPoints(e){const i=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],o=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const u of e)i[0]=Math.min(i[0],u[0]),i[1]=Math.min(i[1],u[1]),i[2]=Math.min(i[2],u[2]),o[0]=Math.max(o[0],u[0]),o[1]=Math.max(o[1],u[1]),o[2]=Math.max(o[2],u[2]);return new Sn(i,o)}constructor(e,i){this.min=e,this.max=i,this.center=qr([],gs([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Sp(this.min),u=Sp(this.max);for(let f=0;f<i.length;f++)o[f]=i[f]?this.min[f]:this.center[f],u[f]=i[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Sn(o,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let o=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let g=0;for(let y=0;y<i.length;y++)g+=ki(f,i[y])+f[3]>=0;if(0===g)return 0;g!==i.length&&(o=!1)}if(o)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][u]-this.min[u];f=Math.min(f,b),g=Math.max(g,b)}if(g<0||f>this.max[u]-this.min[u])return 0}return 1}}function Qh(n,e,i,o,u,f,g,y,b){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(b*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,S=i.projection.upVectorScale(w,i.center.lat,i.worldSize).metersToTile;for(const T of e)for(const k of T){const F=k.add(y),L=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(F.x,F.y,!0):0,B=i.projection.projectTilePoint(F.x,F.y,w);if(L>0){const J=i.projection.upVector(w,F.x,F.y);B.x+=J[0]*S*L,B.y+=J[1]*S*L,B.z+=J[2]*S*L}const G=f?F:Ju(B.x,B.y,B.z,o),X=f?n.tilespaceRays.map(J=>$g(J,L)):n.queryGeometry.screenGeometry,ie=da([],[B.x,B.y,B.z,1],o);if(!g&&f?b*=ie[3]/i.cameraToCenterDistance:g&&!f&&(b*=i.cameraToCenterDistance/ie[3]),f){const J=Zi((k.y/ct+w.y)/(1<<w.z));b/=i.projection.pixelsPerMeter(J,1)/nr(1,J)}if(gm(X,G,b))return!0}return!1}function Ju(n,e,i,o){const u=da([],[n,e,i,1],o);return new Ue(u[0]/u[3],u[1]/u[3])}const ed=bl(0,0,0),Qu=bl(0,0,1);function $g(n,e){const i=Wh();return ed[2]=e,n.intersectsPlane(ed,Qu,i),new Ue(i[0],i[1])}class Mm extends $h{}function Am(n,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=u,n}function Sm(n,e,i){const{width:o,height:u}=e;o===n.width&&u===n.height||(td(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,o),height:Math.min(n.height,u)},i),n.width=o,n.height=u,n.data=e.data)}function td(n,e,i,o,u,f){if(0===u.width||0===u.height)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,y=e.data;for(let b=0;b<u.height;b++){const w=((i.y+b)*n.width+i.x)*f,S=((o.y+b)*e.width+o.x)*f;for(let T=0;T<u.width*f;T++)y[S+T]=g[w+T]}return e}Ke(Mm,"HeatmapBucket",{omit:["layers"]});class _s{constructor(e,i){Am(this,e,1,i)}resize(e){Sm(this,new _s(e),1)}clone(){return new _s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){td(e,i,o,u,f,1)}}class Hn{constructor(e,i){Am(this,e,4,i)}resize(e){Sm(this,new Hn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Hn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){td(e,i,o,u,f,4)}}Ke(_s,"AlphaImage"),Ke(Hn,"RGBAImage");var Zg={paint:new Ae({"heatmap-radius":new de(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new de(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new re(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new me(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new re(Ce.paint_heatmap["heatmap-opacity"])})};function Ip(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new Hn({width:i,height:o}),f=(g,y,b)=>{e[n.evaluationKey]=b;const w=n.expression.evaluate(e);u.data[g+y+0]=Math.floor(255*w.r/w.a),u.data[g+y+1]=Math.floor(255*w.g/w.a),u.data[g+y+2]=Math.floor(255*w.b/w.a),u.data[g+y+3]=Math.floor(255*w.a)};if(n.clips)for(let g=0,y=0;g<o;++g,y+=4*i)for(let b=0,w=0;b<i;b++,w+=4){const S=b/(i-1),{start:T,end:k}=n.clips[g];f(y,w,T*(1-S)+k*S)}else for(let g=0,y=0;g<i;g++,y+=4)f(0,y,g/(i-1));return u}var Yg={paint:new Ae({"hillshade-illumination-direction":new re(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new re(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new re(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new re(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new re(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new re(Ce.paint_hillshade["hillshade-accent-color"])})};const Wg=Te([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xg}=Wg;var id=nd,Em=nd;function nd(n,e,i){i=i||2;var o,u,f,g,y,b,w,S=e&&e.length,T=S?e[0]*i:n.length,k=Tm(n,0,T,i,!0),F=[];if(!k||k.next===k.prev)return F;if(S&&(k=function(B,G,X,ie){var J,ee,le,ne=[];for(J=0,ee=G.length;J<ee;J++)(le=Tm(B,G[J]*ie,J<ee-1?G[J+1]*ie:B.length,ie,!1))===le.next&&(le.steiner=!0),ne.push(n_(le));for(ne.sort(e_),J=0;J<ne.length;J++)X=t_(ne[J],X);return X}(n,e,k,i)),n.length>80*i){o=f=n[0],u=g=n[1];for(var L=i;L<T;L+=i)(y=n[L])<o&&(o=y),(b=n[L+1])<u&&(u=b),y>f&&(f=y),b>g&&(g=b);w=0!==(w=Math.max(f-o,g-u))?32767/w:0}return eh(k,F,i,o,u,w,0),F}function Tm(n,e,i,o,u){var f,g;if(u===Lp(n,e,i,o)>0)for(f=e;f<i;f+=o)g=Im(f,n[f],n[f+1],g);else for(f=i-o;f>=e;f-=o)g=Im(f,n[f],n[f+1],g);return g&&od(g,g.next)&&(ih(g),g=g.next),g}function wl(n,e){if(!n)return n;e||(e=n);var i,o=n;do{if(i=!1,o.steiner||!od(o,o.next)&&0!==Ti(o.prev,o,o.next))o=o.next;else{if(ih(o),(o=e=o.prev)===o.next)break;i=!0}}while(i||o!==e);return e}function eh(n,e,i,o,u,f,g){if(n){!g&&f&&function(S,T,k,F){var L=S;do{0===L.z&&(L.z=Fp(L.x,L.y,T,k,F)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next}while(L!==S);L.prevZ.nextZ=null,L.prevZ=null,function(B){var G,X,ie,J,ee,le,ne,ve,ye=1;do{for(X=B,B=null,ee=null,le=0;X;){for(le++,ie=X,ne=0,G=0;G<ye&&(ne++,ie=ie.nextZ);G++);for(ve=ye;ne>0||ve>0&&ie;)0!==ne&&(0===ve||!ie||X.z<=ie.z)?(J=X,X=X.nextZ,ne--):(J=ie,ie=ie.nextZ,ve--),ee?ee.nextZ=J:B=J,J.prevZ=ee,ee=J;X=ie}ee.nextZ=null,ye*=2}while(le>1)}(L)}(n,o,u,f);for(var y,b,w=n;n.prev!==n.next;)if(y=n.prev,b=n.next,f?Kg(n,o,u,f):rd(n))e.push(y.i/i|0),e.push(n.i/i|0),e.push(b.i/i|0),ih(n),n=b.next,w=b.next;else if((n=b)===w){g?1===g?eh(n=Jg(wl(n),e,i),e,i,o,u,f,2):2===g&&Qg(n,e,i,o,u,f):eh(wl(n),e,i,o,u,f,1);break}}}function rd(n){var e=n.prev,i=n,o=n.next;if(Ti(e,i,o)>=0)return!1;for(var u=e.x,f=i.x,g=o.x,y=e.y,b=i.y,w=o.y,S=u<f?u<g?u:g:f<g?f:g,T=y<b?y<w?y:w:b<w?b:w,k=u>f?u>g?u:g:f>g?f:g,F=y>b?y>w?y:w:b>w?b:w,L=o.next;L!==e;){if(L.x>=S&&L.x<=k&&L.y>=T&&L.y<=F&&Ac(u,y,f,b,g,w,L.x,L.y)&&Ti(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function Kg(n,e,i,o){var u=n.prev,f=n,g=n.next;if(Ti(u,f,g)>=0)return!1;for(var y=u.x,b=f.x,w=g.x,S=u.y,T=f.y,k=g.y,F=y<b?y<w?y:w:b<w?b:w,L=S<T?S<k?S:k:T<k?T:k,B=y>b?y>w?y:w:b>w?b:w,G=S>T?S>k?S:k:T>k?T:k,X=Fp(F,L,e,i,o),ie=Fp(B,G,e,i,o),J=n.prevZ,ee=n.nextZ;J&&J.z>=X&&ee&&ee.z<=ie;){if(J.x>=F&&J.x<=B&&J.y>=L&&J.y<=G&&J!==u&&J!==g&&Ac(y,S,b,T,w,k,J.x,J.y)&&Ti(J.prev,J,J.next)>=0||(J=J.prevZ,ee.x>=F&&ee.x<=B&&ee.y>=L&&ee.y<=G&&ee!==u&&ee!==g&&Ac(y,S,b,T,w,k,ee.x,ee.y)&&Ti(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;J&&J.z>=X;){if(J.x>=F&&J.x<=B&&J.y>=L&&J.y<=G&&J!==u&&J!==g&&Ac(y,S,b,T,w,k,J.x,J.y)&&Ti(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;ee&&ee.z<=ie;){if(ee.x>=F&&ee.x<=B&&ee.y>=L&&ee.y<=G&&ee!==u&&ee!==g&&Ac(y,S,b,T,w,k,ee.x,ee.y)&&Ti(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Jg(n,e,i){var o=n;do{var u=o.prev,f=o.next.next;!od(u,f)&&km(u,o,o.next,f)&&th(u,f)&&th(f,u)&&(e.push(u.i/i|0),e.push(o.i/i|0),e.push(f.i/i|0),ih(o),ih(o.next),o=n=f),o=o.next}while(o!==n);return wl(o)}function Qg(n,e,i,o,u,f){var g=n;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&r_(g,y)){var b=Dm(g,y);return g=wl(g,g.next),b=wl(b,b.next),eh(g,e,i,o,u,f,0),void eh(b,e,i,o,u,f,0)}y=y.next}g=g.next}while(g!==n)}function e_(n,e){return n.x-e.x}function t_(n,e){var i=function(u,f){var g,y=f,b=u.x,w=u.y,S=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var T=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(T<=b&&T>S&&(S=T,g=y.x<y.next.x?y:y.next,T===b))return g}y=y.next}while(y!==f);if(!g)return null;var k,F=g,L=g.x,B=g.y,G=1/0;y=g;do{b>=y.x&&y.x>=L&&b!==y.x&&Ac(w<B?b:S,w,L,B,w<B?S:b,w,y.x,y.y)&&(k=Math.abs(w-y.y)/(b-y.x),th(y,u)&&(k<G||k===G&&(y.x>g.x||y.x===g.x&&i_(g,y)))&&(g=y,G=k)),y=y.next}while(y!==F);return g}(n,e);if(!i)return e;var o=Dm(i,n);return wl(o,o.next),wl(i,i.next)}function i_(n,e){return Ti(n.prev,n,e.prev)<0&&Ti(e.next,n,n.next)<0}function Fp(n,e,i,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function n_(n){var e=n,i=n;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==n);return i}function Ac(n,e,i,o,u,f,g,y){return(u-g)*(e-y)>=(n-g)*(f-y)&&(n-g)*(o-y)>=(i-g)*(e-y)&&(i-g)*(f-y)>=(u-g)*(o-y)}function r_(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,o){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&km(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1}(n,e)&&(th(n,e)&&th(e,n)&&function(i,o){var u=i,f=!1,g=(i.x+o.x)/2,y=(i.y+o.y)/2;do{u.y>y!=u.next.y>y&&u.next.y!==u.y&&g<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==i);return f}(n,e)&&(Ti(n.prev,n,e.prev)||Ti(n,e.prev,e))||od(n,e)&&Ti(n.prev,n,n.next)>0&&Ti(e.prev,e,e.next)>0)}function Ti(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function od(n,e){return n.x===e.x&&n.y===e.y}function km(n,e,i,o){var u=ad(Ti(n,e,i)),f=ad(Ti(n,e,o)),g=ad(Ti(i,o,n)),y=ad(Ti(i,o,e));return u!==f&&g!==y||!(0!==u||!sd(n,i,e))||!(0!==f||!sd(n,o,e))||!(0!==g||!sd(i,n,o))||!(0!==y||!sd(i,e,o))}function sd(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function ad(n){return n>0?1:n<0?-1:0}function th(n,e){return Ti(n.prev,n,n.next)<0?Ti(n,e,n.next)>=0&&Ti(n,n.prev,e)>=0:Ti(n,e,n.prev)<0||Ti(n,n.next,e)<0}function Dm(n,e){var i=new Op(n.i,n.x,n.y),o=new Op(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,o.next=i,i.prev=o,f.next=o,o.prev=f,o}function Im(n,e,i,o){var u=new Op(n,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function ih(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Op(n,e,i){this.i=n,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lp(n,e,i,o){for(var u=0,f=e,g=i-o;f<i;f+=o)u+=(n[g]-n[f])*(n[f+1]+n[g+1]),g=f;return u}function o_(n,e,i,o,u){Fm(n,e,i||0,o||n.length-1,u||Om)}function Fm(n,e,i,o,u){for(;o>i;){if(o-i>600){var f=o-i+1,g=e-i+1,y=Math.log(f),b=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*b*(f-b)/f)*(g-f/2<0?-1:1);Fm(n,e,Math.max(i,Math.floor(e-g*b/f+w)),Math.min(o,Math.floor(e+(f-g)*b/f+w)),u)}var S=n[e],T=i,k=o;for(nh(n,i,e),u(n[o],S)>0&&nh(n,i,o);T<k;){for(nh(n,T,k),T++,k--;u(n[T],S)<0;)T++;for(;u(n[k],S)>0;)k--}0===u(n[i],S)?nh(n,i,k):nh(n,++k,o),k<=e&&(i=k+1),e<=k&&(o=k-1)}}function nh(n,e,i){var o=n[e];n[e]=n[i],n[i]=o}function Om(n,e){return n<e?-1:n>e?1:0}function ld(n,e){const i=n.length;if(i<=1)return[n];const o=[];let u,f;for(let g=0;g<i;g++){const y=Zn(n[g]);0!==y&&(n[g].area=Math.abs(y),void 0===f&&(f=y<0),f===y<0?(u&&o.push(u),u=[n[g]]):u.push(n[g]))}if(u&&o.push(u),e>1)for(let g=0;g<o.length;g++)o[g].length<=e||(o_(o[g],e,1,o[g].length-1,s_),o[g]=o[g].slice(0,e));return o}function s_(n,e){return e.area-n.area}function Rp(n,e,i){const o=i.patternDependencies;let u=!1;for(const f of e){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(u=!0);const y=g.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Pp(n,e,i,o,u){const f=u.patternDependencies;for(const g of e){const y=g.paint.get(`${n}-pattern`).value;if("constant"!==y.kind){let b=y.evaluate({zoom:o-1},i,{},u.availableImages),w=y.evaluate({zoom:o},i,{},u.availableImages),S=y.evaluate({zoom:o+1},i,{},u.availableImages);b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,S=S&&S.name?S.name:S,f[b]=!0,f[w]=!0,f[S]=!0,i.patterns[g.id]={min:b,mid:w,max:S}}}return i}nd.deviation=function(n,e,i,o){var u=e&&e.length,f=Math.abs(Lp(n,0,u?e[0]*i:n.length,i));if(u)for(var g=0,y=e.length;g<y;g++)f-=Math.abs(Lp(n,e[g]*i,g<y-1?e[g+1]*i:n.length,i));var b=0;for(g=0;g<o.length;g+=3){var w=o[g]*i,S=o[g+1]*i,T=o[g+2]*i;b+=Math.abs((n[w]-n[T])*(n[S+1]-n[w+1])-(n[w]-n[S])*(n[T+1]-n[w+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)},nd.flatten=function(n){for(var e=n[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,u=0;u<n.length;u++){for(var f=0;f<n[u].length;f++)for(var g=0;g<e;g++)i.vertices.push(n[u][f][g]);u>0&&i.holes.push(o+=n[u-1].length)}return i},id.default=Em;class cd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ne,this.indexArray=new At,this.indexArray2=new sn,this.programConfigurations=new gl(e.layers,e.zoom),this.segments=new Ei,this.segments2=new Ei,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,o,u){this.hasPattern=Rp("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:y,id:b,index:w,sourceLayerIndex:S}of e){const T=this.layers[0]._featureFilter.needGeometry,k=ms(y,T);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),k,o))continue;const F=f?f.evaluate(k,{},o,i.availableImages):void 0,L={id:b,properties:y.properties,type:y.type,sourceLayerIndex:S,index:w,geometry:T?k.geometry:ko(y,o,u),patterns:{},sortKey:F};g.push(L)}f&&g.sort((y,b)=>y.sortKey-b.sortKey);for(const y of g){const{geometry:b,index:w,sourceLayerIndex:S}=y;if(this.hasPattern){const T=Pp("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(T)}else this.addFeature(y,b,w,o,{},i.availableImages);i.featureIndex.insert(e[w].feature,b,w,S,this.index)}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o,u)}addFeatures(e,i,o,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,f,g=[]){for(const y of ld(i,500)){let b=0;for(const L of y)b+=L.length;const w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),S=w.vertexLength,T=[],k=[];for(const L of y){if(0===L.length)continue;L!==y[0]&&k.push(T.length/2);const B=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),G=B.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(G+L.length-1,G),T.push(L[0].x),T.push(L[0].y);for(let X=1;X<L.length;X++)this.layoutVertexArray.emplaceBack(L[X].x,L[X].y),this.indexArray2.emplaceBack(G+X-1,G+X),T.push(L[X].x),T.push(L[X].y);B.vertexLength+=L.length,B.primitiveLength+=L.length}const F=id(T,k);for(let L=0;L<F.length;L+=3)this.indexArray.emplaceBack(S+F[L],S+F[L+1],S+F[L+2]);w.vertexLength+=b,w.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,g,u)}}Ke(cd,"FillBucket",{omit:["layers","patternFeatures"]});const a_=new Ae({"fill-sort-key":new de(Ce.layout_fill["fill-sort-key"])});var l_={paint:new Ae({"fill-antialias":new re(Ce.paint_fill["fill-antialias"]),"fill-opacity":new de(Ce.paint_fill["fill-opacity"]),"fill-color":new de(Ce.paint_fill["fill-color"]),"fill-outline-color":new de(Ce.paint_fill["fill-outline-color"]),"fill-translate":new re(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new re(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new _e(Ce.paint_fill["fill-pattern"])}),layout:a_};const c_=Te([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),u_=Te([{name:"a_centroid_pos",components:2,type:"Uint16"}]),h_=Te([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:d_}=c_;var Lm=Sc;function Sc(n,e,i,o,u){this.properties={},this.extent=i,this.type=0,this._pbf=n,this._geometry=-1,this._keys=o,this._values=u,n.readFields(p_,this,e)}function p_(n,e,i){1==n?e.id=i.readVarint():2==n?function(o,u){for(var f=o.readVarint()+o.pos;o.pos<f;){var g=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[g]=y}}(i,e):3==n?e.type=i.readVarint():4==n&&(e._geometry=i.pos)}function f_(n){for(var e,i,o=0,u=0,f=n.length,g=f-1;u<f;g=u++)o+=((i=n[g]).x-(e=n[u]).x)*(e.y+i.y);return o}Sc.types=["Unknown","Point","LineString","Polygon"],Sc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,i=n.readVarint()+n.pos,o=1,u=0,f=0,g=0,y=[];n.pos<i;){if(u<=0){var b=n.readVarint();o=7&b,u=b>>3}if(u--,1===o||2===o)f+=n.readSVarint(),g+=n.readSVarint(),1===o&&(e&&y.push(e),e=[]),e.push(new Ue(f,g));else{if(7!==o)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Sc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,i=1,o=0,u=0,f=0,g=1/0,y=-1/0,b=1/0,w=-1/0;n.pos<e;){if(o<=0){var S=n.readVarint();i=7&S,o=S>>3}if(o--,1===i||2===i)(u+=n.readSVarint())<g&&(g=u),u>y&&(y=u),(f+=n.readSVarint())<b&&(b=f),f>w&&(w=f);else if(7!==i)throw new Error("unknown command "+i)}return[g,b,y,w]},Sc.prototype.toGeoJSON=function(n,e,i){var o,u,f=this.extent*Math.pow(2,i),g=this.extent*n,y=this.extent*e,b=this.loadGeometry(),w=Sc.types[this.type];function S(F){for(var L=0;L<F.length;L++){var B=F[L];F[L]=[360*(B.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(o=0;o<b.length;o++)T[o]=b[o][0];S(b=T);break;case 2:for(o=0;o<b.length;o++)S(b[o]);break;case 3:for(b=function(F){var L=F.length;if(L<=1)return[F];for(var B,G,X=[],ie=0;ie<L;ie++){var J=f_(F[ie]);0!==J&&(void 0===G&&(G=J<0),G===J<0?(B&&X.push(B),B=[F[ie]]):B.push(F[ie]))}return B&&X.push(B),X}(b),o=0;o<b.length;o++)for(u=0;u<b[o].length;u++)S(b[o][u])}1===b.length?b=b[0]:w="Multi"+w;var k={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(k.id=this.id),k};var Rm=Pm;function Pm(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(m_,this,e),this.length=this._features.length}function m_(n,e,i){15===n?e.version=i.readVarint():1===n?e.name=i.readString():5===n?e.extent=i.readVarint():2===n?e._features.push(i.pos):3===n?e._keys.push(i.readString()):4===n&&e._values.push(function(o){for(var u=null,f=o.readVarint()+o.pos;o.pos<f;){var g=o.readVarint()>>3;u=1===g?o.readString():2===g?o.readFloat():3===g?o.readDouble():4===g?o.readVarint64():5===g?o.readVarint():6===g?o.readSVarint():7===g?o.readBoolean():null}return u}(i))}function g_(n,e,i){if(3===n){var o=new Rm(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}Pm.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new Lm(this._pbf,e,this.extent,this._keys,this._values)};var Cl={VectorTile:function(n,e){this.layers=n.readFields(g_,{},e)},VectorTileFeature:Lm,VectorTileLayer:Rm};function ud(n,e,i,o){const u=[],f=0===o?(g,y,b,w,S,T)=>{g.push(new Ue(T,b+(T-y)/(w-y)*(S-b)))}:(g,y,b,w,S,T)=>{g.push(new Ue(y+(T-b)/(S-b)*(w-y),T))};for(const g of n){const y=[];for(const b of g){if(b.length<=2)continue;const w=[];for(let k=0;k<b.length-1;k++){const F=b[k].x,L=b[k].y,B=b[k+1].x,G=b[k+1].y,X=0===o?F:L,ie=0===o?B:G;X<e?ie>e&&f(w,F,L,B,G,e):X>i?ie<i&&f(w,F,L,B,G,i):w.push(b[k]),ie<e&&X>=e&&f(w,F,L,B,G,e),ie>i&&X<=i&&f(w,F,L,B,G,i)}let S=b[b.length-1];const T=0===o?S.x:S.y;T>=e&&T<=i&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),y.push(w))}y.length&&u.push(y)}return u}const __=Cl.VectorTileFeature.types,y_=Math.pow(2,13);function rh(n,e,i,o,u,f,g,y){n.emplaceBack((e<<1)+g,(i<<1)+f,(Math.floor(o*y_)<<1)+u,Math.round(y))}function oh(n,e,i){n.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class zm{constructor(){this.acc=new Ue(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ue(e.x,e.y),this.max=new Ue(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const o=this.min,u=this.max;e.x<o.x?o.x=e.x:e.x>u.x&&(u.x=e.x),e.y<o.y?o.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===ct)&&e.x===i.x)!=((0===e.y||e.y===ct)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,It(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>ct!=e.x>ct&&this.addBorderIntersection(1,It(i.y,e.y,(ct-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,It(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>ct!=e.y>ct&&this.addBorderIntersection(3,It(i.x,e.x,(ct-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=0===e.x?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=0===e.y?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((i,o)=>i+o.edges,0);return 0!==e?this.acc.div(e)._round():new Ue(0,0)}span(){return new Ue(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class sh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new nt,this.centroidVertexArray=new sp,this.indexArray=new At,this.programConfigurations=new gl(e.layers,e.zoom),this.segments=new Ei,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,o,u){this.features=[],this.hasPattern=Rp("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/ct/(1<<f.z)}(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:g,index:y,sourceLayerIndex:b}of e){const w=this.layers[0]._featureFilter.needGeometry,S=ms(f,w);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),S,o))continue;const T={id:g,sourceLayerIndex:b,index:y,geometry:w?S.geometry:ko(f,o,u),properties:f.properties,type:f.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(Pp("fill-extrusion",this.layers,T,this.zoom,i)):this.addFeature(T,T.geometry,y,o,{},i.availableImages,u),i.featureIndex.insert(f,T.geometry,y,b,this.index,k)}this.sortBorders()}addFeatures(e,i,o,u,f){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,i,o,u,f)}this.sortBorders()}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,h_.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,u_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u,f,g,y){const b=[new Ue(0,0),new Ue(ct,ct)],w=y.projection,S="globe"===w.name,T=this.enableTerrain&&!S?new zm:null,k="Polygon"===__[e.type];S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new an);const F=ld(i,500);for(let X=F.length-1;X>=0;X--){const ie=F[X];(0===ie.length||(L=ie[0]).every(J=>J.x<=0)||L.every(J=>J.x>=ct)||L.every(J=>J.y<=0)||L.every(J=>J.y>=ct))&&F.splice(X,1)}var L;let B;if(S)B=Hm(F,b,u);else{B=[];for(const X of F)B.push({polygon:X,bounds:b})}const G=k?this.edgeRadius:0;for(const{polygon:X,bounds:ie}of B){let J=0,ee=0;for(const ne of X)k&&!ne[0].equals(ne[ne.length-1])&&ne.push(ne[0]),ee+=k?ne.length-1:ne.length;const le=this.segments.prepareSegment((k?5:4)*ee,this.layoutVertexArray,this.indexArray);if(k){const ne=[],ve=[];J=le.vertexLength;for(const Me of X){let ze,we;Me.length&&Me!==X[0]&&ve.push(ne.length/2),ze=Me[1].sub(Me[0])._perp()._unit();for(let Ee=1;Ee<Me.length;Ee++){const Ie=Me[Ee],Se=Me[Ee===Me.length-1?1:Ee+1];let{x:Re,y:Fe}=Ie;if(G){we=Se.sub(Ie)._perp()._unit();const Ze=ze.add(we)._unit(),gt=G*Math.min(4,1/(ze.x*Ze.x+ze.y*Ze.y));Re+=gt*Ze.x,Fe+=gt*Ze.y,ze=we}rh(this.layoutVertexArray,Re,Fe,0,0,1,1,0),le.vertexLength++,ne.push(Ie.x,Ie.y),S&&oh(this.layoutVertexExtArray,w.projectTilePoint(Re,Fe,u),w.upVector(u,Re,Fe))}}const ye=id(ne,ve);for(let Me=0;Me<ye.length;Me+=3)this.indexArray.emplaceBack(J+ye[Me],J+ye[Me+2],J+ye[Me+1]),le.primitiveLength++}for(const ne of X){T&&ne.length&&T.startRing(ne[0]);let ve,ye,Me,ze=ne.length>4&&Nm(ne[ne.length-2],ne[0],ne[1]),we=G?x_(ne[ne.length-2],ne[0],ne[1],G):0;ye=ne[1].sub(ne[0])._perp()._unit();for(let Ee=1,Ie=0;Ee<ne.length;Ee++){let Se=ne[Ee-1],Re=ne[Ee];const Fe=ne[Ee===ne.length-1?1:Ee+1];if(T&&k&&T.currentPolyCount.top++,Gm(Re,Se,ie)){G&&(ye=Fe.sub(Re)._perp()._unit());continue}T&&T.append(Re,Se);const Ze=Re.sub(Se)._perp(),gt=Ze.x/(Math.abs(Ze.x)+Math.abs(Ze.y)),wt=Ze.y>0?1:0,it=Se.dist(Re);if(Ie+it>32768&&(Ie=0),G){Me=Fe.sub(Re)._perp()._unit();let qe=Vm(Se,Re,Fe,Bm(ye,Me),G);isNaN(qe)&&(qe=0);const ii=Re.sub(Se)._unit();Se=Se.add(ii.mult(we))._round(),Re=Re.add(ii.mult(-qe))._round(),we=qe,ye=Me}const Ve=le.vertexLength,bt=ne.length>4&&Nm(Se,Re,Fe);let ht=Um(Ie,ze,!0);if(rh(this.layoutVertexArray,Se.x,Se.y,gt,wt,0,0,ht),rh(this.layoutVertexArray,Se.x,Se.y,gt,wt,0,1,ht),Ie+=it,ht=Um(Ie,bt,!1),ze=bt,rh(this.layoutVertexArray,Re.x,Re.y,gt,wt,0,0,ht),rh(this.layoutVertexArray,Re.x,Re.y,gt,wt,0,1,ht),le.vertexLength+=4,this.indexArray.emplaceBack(Ve+0,Ve+1,Ve+2),this.indexArray.emplaceBack(Ve+1,Ve+3,Ve+2),le.primitiveLength+=2,G){const qe=J+(1===Ee?ne.length-2:Ee-2),ii=1===Ee?J:qe+1;if(this.indexArray.emplaceBack(Ve+1,qe,Ve+3),this.indexArray.emplaceBack(qe,ii,Ve+3),le.primitiveLength+=2,void 0===ve&&(ve=Ve),!Gm(Fe,ne[Ee],ie)){const Qt=Ee===ne.length-1?ve:le.vertexLength;this.indexArray.emplaceBack(Ve+2,Ve+3,Qt),this.indexArray.emplaceBack(Ve+3,Qt+1,Qt),this.indexArray.emplaceBack(Ve+3,ii,Qt+1),le.primitiveLength+=3}}if(S){const qe=this.layoutVertexExtArray,ii=w.projectTilePoint(Se.x,Se.y,u),Qt=w.projectTilePoint(Re.x,Re.y,u),hi=w.upVector(u,Se.x,Se.y),Ct=w.upVector(u,Re.x,Re.y);oh(qe,ii,hi),oh(qe,ii,hi),oh(qe,Qt,Ct),oh(qe,Qt,Ct)}}k&&(J+=ne.length-1)}}if(T&&T.polyCount.length>0){if(T.borders){T.vertexArrayOffset=this.centroidVertexArray.length;const X=T.borders,ie=this.featuresOnBorder.push(T)-1;for(let J=0;J<4;J++)X[J][0]!==Number.MAX_VALUE&&this.borders[J].push(ie)}this.encodeCentroid(T.borders?void 0:T.centroid(),T)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,g,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,i,o=!0){let u,f;if(e)if(0!==e.y){const y=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+o;let g=o?this.centroidVertexArray.length:i.vertexArrayOffset;for(const y of i.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(g++,u,f);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,u,f)}}}function Bm(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function x_(n,e,i,o){const u=e.sub(n)._perp()._unit(),f=i.sub(e)._perp()._unit();return Vm(n,e,i,Bm(u,f),o)}function Vm(n,e,i,o,u){const f=Math.sqrt(1-o*o);return Math.min(n.dist(e)/3,e.dist(i)/3,u*f/o)}function Gm(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function Nm(n,e,i){if(n.x<0||n.x>=ct||e.x<0||e.x>=ct||i.x<0||i.x>=ct)return!1;const o=i.sub(e),u=o.perp(),f=n.sub(e);return(o.x*f.x+o.y*f.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function Um(n,e,i){const o=e?2|n:-3&n;return i?1|o:-2&o}function jm(){const n=Math.PI/32,e=Math.tan(n),i=Uh;return i*Math.sqrt(1+2*e*e)-i}function Hm(n,e,i){const o=1<<i.z,u=rr(i.x/o),f=rr((i.x+1)/o),g=Zi(i.y/o),y=Zi((i.y+1)/o);return function(b,w,S,T,k=0,F){const L=[];if(!b.length||!S||!T)return L;const B=(ne,ve)=>{for(const ye of ne)L.push({polygon:ye,bounds:ve})},G=Math.ceil(Math.log2(S)),X=Math.ceil(Math.log2(T)),ie=G-X,J=[];for(let ne=0;ne<Math.abs(ie);ne++)J.push(ie>0?0:1);for(let ne=0;ne<Math.min(G,X);ne++)J.push(0),J.push(1);let ee=b;if(ee=ud(ee,w[0].y-k,w[1].y+k,1),ee=ud(ee,w[0].x-k,w[1].x+k,0),!ee.length)return L;const le=[];for(J.length?le.push({polygons:ee,bounds:w,depth:0}):B(ee,w);le.length;){const ne=le.pop(),ve=ne.depth,ye=J[ve],Me=ne.bounds[0],ze=ne.bounds[1],we=0===ye?Me.x:Me.y,Ee=0===ye?ze.x:ze.y,Ie=F?F(ye,we,Ee):.5*(we+Ee),Se=ud(ne.polygons,we-k,Ie+k,ye),Re=ud(ne.polygons,Ie-k,Ee+k,ye);if(Se.length){const Fe=[Me,new Ue(0===ye?Ie:ze.x,1===ye?Ie:ze.y)];J.length>ve+1?le.push({polygons:Se,bounds:Fe,depth:ve+1}):B(Se,Fe)}if(Re.length){const Fe=[new Ue(0===ye?Ie:Me.x,1===ye?Ie:Me.y),ze];J.length>ve+1?le.push({polygons:Re,bounds:Fe,depth:ve+1}):B(Re,Fe)}}return L}(n,e,Math.ceil((f-u)/11.25),Math.ceil((g-y)/11.25),1,(b,w,S)=>{if(0===b)return.5*(w+S);{const T=Zi((i.y+w/ct)/o);return(To(.5*(Zi((i.y+S/ct)/o)+T))*o-i.y)*ct}})}Ke(sh,"FillExtrusionBucket",{omit:["layers","features"]}),Ke(zm,"PartMetadata");const v_=new Ae({"fill-extrusion-edge-radius":new re(Ce["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var b_={paint:new Ae({"fill-extrusion-opacity":new re(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new de(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new re(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new re(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _e(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new de(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new de(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new re(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new re(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new re(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:v_};function qm(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class hd{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=ah(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=(g=this.y,y=this.z,b=qm(256*(f=this.x),256*(g=Math.pow(2,y)-g-1),y),w=qm(256*(f+1),256*(g+1),y),b[0]+","+b[1]+","+w[0]+","+w[1]),u=function(f,g,y){let b,w="";for(let S=f;S>0;S--)b=1<<S-1,w+=(g&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);var f,g,y,b,w;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class $m{constructor(e,i){this.wrap=e,this.canonical=i,this.key=ah(e,i.z,i.z,i.x,i.y)}}class En{constructor(e,i,o,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new hd(o,+u,+f),this.key=0===i&&e===o?this.canonical.key:ah(i,e,o,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new En(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new En(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return ah(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return ah(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new En(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new En(i,this.wrap,i,o,u),new En(i,this.wrap,i,o+1,u),new En(i,this.wrap,i,o,u+1),new En(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new En(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new En(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $m(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ah(n,e,i,o,u){const f=1<<Math.min(i,22);let g=f*(u%f)+o%f;return n&&i<22&&(g+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}function lh(n,e){return n.x*e.x+n.y*e.y}function Zm(n,e){if(1===n.length){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],g=n[0],y=u.sub(o),b=f.sub(o),w=g.sub(o),S=lh(y,y),T=lh(y,b),k=lh(b,b),F=lh(w,y),L=lh(w,b),B=S*k-T*T,G=(k*F-T*L)/B,X=(S*L-T*F)/B,ie=o.z*(1-G-X)+u.z*G+f.z*X;if(isFinite(ie))return ie}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function dd(n){const e=new Ue(n[0],n[1]);return e.z=n[2],e}function Ym(n,e,i,o,u,f,g,y){const b=g*u.getElevationAt(n,e,!0,!0),w=0!==f[0],S=w?0===f[1]?g*(f[0]/7-450):g*function(T,k,F){const L=Math.floor(k[0]/8),B=Math.floor(k[1]/8),G=10*(k[0]-8*L),X=10*(k[1]-8*B),ie=T.getElevationAt(L,B,!0,!0),J=T.getMeterToDEM(F),ee=Math.floor(.5*(G*J-1)),le=Math.floor(.5*(X*J-1)),ne=T.tileCoordToPixel(L,B),ve=2*ee+1,ye=2*le+1,Me=(gt=ve,wt=ye,[(Re=T).getElevationAtPixel(Fe=ne.x-ee,Ze=ne.y-le,!0),Re.getElevationAtPixel(Fe+wt,Ze,!0),Re.getElevationAtPixel(Fe,Ze+wt,!0),Re.getElevationAtPixel(Fe+gt,Ze+wt,!0)]),ze=Math.abs(Me[0]-Me[1]),we=Math.abs(Me[2]-Me[3]),Ee=Math.abs(Me[0]-Me[2])+Math.abs(Me[1]-Me[3]),Ie=Math.min(.25,.5*J*(ze+we)/ve),Se=Math.min(.25,.5*J*Ee/ye);var Re,Fe,Ze,gt,wt;return ie+Math.max(Ie*G,Se*X)}(u,f,y):b;return{base:b+(0===i)?-1:i,top:w?Math.max(S+o,b+i+2):b+o}}Ke(hd,"CanonicalTileID"),Ke(En,"OverscaledTileID",{omit:["projMatrix"]});const w_=Te([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:C_}=w_,M_=Te([{name:"a_packed",components:4,type:"Float32"}]),{members:A_}=M_,S_=Cl.VectorTileFeature.types,E_=Math.cos(Math.PI/180*37.5);class pd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new lt,this.layoutVertexArray2=new Tt,this.indexArray=new At,this.programConfigurations=new gl(e.layers,e.zoom),this.segments=new Ei,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,u){this.hasPattern=Rp("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:S,id:T,index:k,sourceLayerIndex:F}of e){const L=this.layers[0]._featureFilter.needGeometry,B=ms(S,L);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),B,o))continue;const G=f?f.evaluate(B,{},o):void 0,X={id:T,properties:S.properties,type:S.type,sourceLayerIndex:F,index:k,geometry:L?B.geometry:ko(S,o,u),patterns:{},sortKey:G};g.push(X)}f&&g.sort((S,T)=>S.sortKey-T.sortKey);const{lineAtlas:y,featureIndex:b}=i,w=this.addConstantDashes(y);for(const S of g){const{geometry:T,index:k,sourceLayerIndex:F}=S;if(w&&this.addFeatureDashes(S,y),this.hasPattern){const L=Pp("line",this.layers,S,this.zoom,i);this.patternFeatures.push(L)}else this.addFeature(S,T,k,o,y.positions,i.availableImages);b.insert(e[k].feature,T,k,F,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const u=o.paint.get("line-dasharray").value,f=o.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)i=!0;else{const g=f.value,y=u.value;if(!y)continue;e.addDash(y.from,g),e.addDash(y.to,g),y.other&&e.addDash(y.other,g)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let y,b,w,S,T,k;if("constant"===f.kind){const G=f.value;if(!G)continue;y=G.other||G.to,b=G.to,w=G.from}else y=f.evaluate({zoom:o-1},e),b=f.evaluate({zoom:o},e),w=f.evaluate({zoom:o+1},e);"constant"===g.kind?S=T=k=g.value:(S=g.evaluate({zoom:o-1},e),T=g.evaluate({zoom:o},e),k=g.evaluate({zoom:o+1},e)),i.addDash(y,S),i.addDash(b,T),i.addDash(w,k);const F=i.getKey(y,S),L=i.getKey(b,T),B=i.getKey(w,k);e.patterns[u.id]={min:F,mid:L,max:B}}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o,u)}addFeatures(e,i,o,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,A_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,C_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,f,g){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),S=y.get("line-miter-limit"),T=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const k of i)this.addLine(k,e,b,w,S,T);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,g,u)}addLine(e,i,o,u,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<e.length-1;X++)this.totalDistance+=e[X].dist(e[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y="Polygon"===S_[i.type];let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(y?3:2))return;"bevel"===o&&(f=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,T=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let k,F,L,B,G;this.e1=this.e2=-1,y&&(k=e[b-2],G=e[w].sub(k)._unit()._perp());for(let X=w;X<b;X++){if(L=X===b-1?y?e[w+1]:void 0:e[X+1],L&&e[X].equals(L))continue;G&&(B=G),k&&(F=k),k=e[X],G=L?L.sub(k)._unit()._perp():B,B=B||G;let ie=B.add(G);0===ie.x&&0===ie.y||ie._unit();const J=B.x*G.x+B.y*G.y,ee=ie.x*G.x+ie.y*G.y,le=0!==ee?1/ee:1/0,ne=2*Math.sqrt(2-2*ee),ve=ee<E_&&F&&L,ye=B.x*G.y-B.y*G.x>0;if(ve&&X>w){const we=k.dist(F);if(we>2*S){const Ee=k.sub(k.sub(F)._mult(S/we)._round());this.updateDistance(F,Ee),this.addCurrentVertex(Ee,B,0,0,T),F=Ee}}const Me=F&&L;let ze=Me?o:y?"butt":u;if(Me&&"round"===ze&&(le<g?ze="miter":le<=2&&(ze="fakeround")),"miter"===ze&&le>f&&(ze="bevel"),"bevel"===ze&&(le>2&&(ze="flipbevel"),le<f&&(ze="miter")),F&&this.updateDistance(F,k),"miter"===ze)ie._mult(le),this.addCurrentVertex(k,ie,0,0,T);else if("flipbevel"===ze){if(le>100)ie=G.mult(-1);else{const we=le*B.add(G).mag()/B.sub(G).mag();ie._perp()._mult(we*(ye?-1:1))}this.addCurrentVertex(k,ie,0,0,T),this.addCurrentVertex(k,ie.mult(-1),0,0,T)}else if("bevel"===ze||"fakeround"===ze){const we=-Math.sqrt(le*le-1),Ee=ye?we:0,Ie=ye?0:we;if(F&&this.addCurrentVertex(k,B,Ee,Ie,T),"fakeround"===ze){const Se=Math.round(180*ne/Math.PI/20);for(let Re=1;Re<Se;Re++){let Fe=Re/Se;if(.5!==Fe){const gt=Fe-.5;Fe+=Fe*gt*(Fe-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*gt*gt+(.848013+J*(.215638*J-1.06021)))}const Ze=G.sub(B)._mult(Fe)._add(B)._unit()._mult(ye?-1:1);this.addHalfVertex(k,Ze.x,Ze.y,!1,ye,0,T)}}L&&this.addCurrentVertex(k,G,-Ee,-Ie,T)}else if("butt"===ze)this.addCurrentVertex(k,ie,0,0,T);else if("square"===ze){const we=F?1:-1;F||this.addCurrentVertex(k,ie,we,we,T),this.addCurrentVertex(k,ie,0,0,T),F&&this.addCurrentVertex(k,ie,we,we,T)}else"round"===ze&&(F&&(this.addCurrentVertex(k,B,0,0,T),this.addCurrentVertex(k,B,1,1,T,!0)),L&&(this.addCurrentVertex(k,G,-1,-1,T,!0),this.addCurrentVertex(k,G,0,0,T)));if(ve&&X<b-1){const we=k.dist(L);if(we>2*S){const Ee=k.add(L.sub(k)._mult(S/we)._round());this.updateDistance(k,Ee),this.addCurrentVertex(Ee,G,0,0,T),k=Ee}}}}addCurrentVertex(e,i,o,u,f,g=!1){const y=i.y*u-i.x,b=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,g,!1,o,f),this.addHalfVertex(e,y,b,g,!0,-u,f)}addHalfVertex({x:e,y:i},o,u,f,g,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(0===y?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),g?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Ke(pd,"LineBucket",{omit:["layers","patternFeatures"]});const T_=new Ae({"line-cap":new de(Ce.layout_line["line-cap"]),"line-join":new de(Ce.layout_line["line-join"]),"line-miter-limit":new re(Ce.layout_line["line-miter-limit"]),"line-round-limit":new re(Ce.layout_line["line-round-limit"]),"line-sort-key":new de(Ce.layout_line["line-sort-key"])});var zp={paint:new Ae({"line-opacity":new de(Ce.paint_line["line-opacity"]),"line-color":new de(Ce.paint_line["line-color"]),"line-translate":new re(Ce.paint_line["line-translate"]),"line-translate-anchor":new re(Ce.paint_line["line-translate-anchor"]),"line-width":new de(Ce.paint_line["line-width"]),"line-gap-width":new de(Ce.paint_line["line-gap-width"]),"line-offset":new de(Ce.paint_line["line-offset"]),"line-blur":new de(Ce.paint_line["line-blur"]),"line-dasharray":new _e(Ce.paint_line["line-dasharray"]),"line-pattern":new _e(Ce.paint_line["line-pattern"]),"line-gradient":new me(Ce.paint_line["line-gradient"]),"line-trim-offset":new re(Ce.paint_line["line-trim-offset"])}),layout:T_};const Zr=new class extends de{possiblyEvaluate(n,e){return e=new j(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,i,o){return e=Gt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,i,o)}}(zp.paint.properties["line-width"].specification);function fd(n,e){return e>0?e+2*n:n}Zr.useIntegerZoom=!0;const md=Te([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gd=Te([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Wm=Te([{name:"a_projected_pos",components:4,type:"Float32"}],4);Te([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xm=Te([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Km=Te([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const On=Te([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Jm=Te([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Te([{name:"triangle",components:3,type:"Uint16"}]),Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Te([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Te([{type:"Float32",name:"offsetX"}]),Te([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Yr=128;function Ml(n,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new j(n+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let f=0;for(;f<o.length&&o[f]<=n;)f++;f=Math.max(0,f-1);let g=f;for(;g<o.length&&o[g]<n+1;)g++;g=Math.min(o.length-1,g);const y=o[f],b=o[g];return"composite"===i.kind?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:i.evaluate(new j(y)),maxSize:i.evaluate(new j(b)),interpolationType:u}}}function Al(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return"source"===n.kind?o/Yr:"composite"===n.kind?It(o/Yr,u/Yr,i):e}function Yt(n,e){let i=0,o=0;if("constant"===n.kind)o=n.layoutSize;else if("source"!==n.kind){const{interpolationType:u,minZoom:f,maxZoom:g}=n,y=u?yt(ci.interpolationFactor(u,e,f,g),0,1):0;"camera"===n.kind?o=It(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:o}}var Sl=Object.freeze({__proto__:null,getSizeData:Ml,evaluateSizeForFeature:Al,evaluateSizeForZoom:Yt,SIZE_PACK_FACTOR:Yr});function El(n,e,i){return n.sections.forEach(o=>{o.text=function(u,f,g){const y=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===y?u=u.toLocaleUpperCase():"lowercase"===y&&(u=u.toLocaleLowerCase()),U.applyArabicShaping&&(u=U.applyArabicShaping(u)),u}(o.text,e,i)}),n}const Tl={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Bp(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function Ec(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Vp=function(n,e,i,o,u){var f,g,y=8*u-o-1,b=(1<<y)-1,w=b>>1,S=-7,T=i?u-1:0,k=i?-1:1,F=n[e+T];for(T+=k,f=F&(1<<-S)-1,F>>=-S,S+=y;S>0;f=256*f+n[e+T],T+=k,S-=8);for(g=f&(1<<-S)-1,f>>=-S,S+=o;S>0;g=256*g+n[e+T],T+=k,S-=8);if(0===f)f=1-w;else{if(f===b)return g?NaN:1/0*(F?-1:1);g+=Math.pow(2,o),f-=w}return(F?-1:1)*g*Math.pow(2,f-o)},Tc=function(n,e,i,o,u,f){var g,y,b,w=8*f-u-1,S=(1<<w)-1,T=S>>1,k=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,F=o?0:f-1,L=o?1:-1,B=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,g=S):(g=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-g))<1&&(g--,b*=2),(e+=g+T>=1?k/b:k*Math.pow(2,1-T))*b>=2&&(g++,b/=2),g+T>=S?(y=0,g=S):g+T>=1?(y=(e*b-1)*Math.pow(2,u),g+=T):(y=e*Math.pow(2,T-1)*Math.pow(2,u),g=0));u>=8;n[i+F]=255&y,F+=L,y/=256,u-=8);for(g=g<<u|y,w+=u;w>0;n[i+F]=255&g,F+=L,g/=256,w-=8);n[i+F-L]|=128*B},ys=Ut;function Ut(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Ut.Varint=0,Ut.Fixed64=1,Ut.Bytes=2,Ut.Fixed32=5;var ch=4294967296,kl=1/ch,uh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Io(n){return n.type===Ut.Bytes?n.readVarint()+n.pos:n.pos+1}function kc(n,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var u=i.pos-1;u>=n;u--)i.buf[u+o]=i.buf[u]}function pa(n,e){for(var i=0;i<n.length;i++)e.writeVarint(n[i])}function _d(n,e){for(var i=0;i<n.length;i++)e.writeSVarint(n[i])}function yd(n,e){for(var i=0;i<n.length;i++)e.writeFloat(n[i])}function Gp(n,e){for(var i=0;i<n.length;i++)e.writeDouble(n[i])}function Np(n,e){for(var i=0;i<n.length;i++)e.writeBoolean(n[i])}function xd(n,e){for(var i=0;i<n.length;i++)e.writeFixed32(n[i])}function Up(n,e){for(var i=0;i<n.length;i++)e.writeSFixed32(n[i])}function k_(n,e){for(var i=0;i<n.length;i++)e.writeFixed64(n[i])}function D_(n,e){for(var i=0;i<n.length;i++)e.writeSFixed64(n[i])}function Dc(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function Ic(n,e,i){n[i]=e,n[i+1]=e>>>8,n[i+2]=e>>>16,n[i+3]=e>>>24}function jp(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function I_(n,e,i){e.glyphs=[],1===n&&i.readMessage(Qm,e)}function Qm(n,e,i){if(3===n){const{id:o,bitmap:u,width:f,height:g,left:y,top:b,advance:w}=i.readMessage(F_,{});e.glyphs.push({id:o,bitmap:new _s({width:f+6,height:g+6},u),metrics:{width:f,height:g,left:y,top:b,advance:w}})}else 4===n?e.ascender=i.readSVarint():5===n&&(e.descender=i.readSVarint())}function F_(n,e,i){1===n?e.id=i.readVarint():2===n?e.bitmap=i.readBytes():3===n?e.width=i.readVarint():4===n?e.height=i.readVarint():5===n?e.left=i.readSVarint():6===n?e.top=i.readSVarint():7===n&&(e.advance=i.readVarint())}function Hp(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,y)=>y.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const g of n)for(let y=o.length-1;y>=0;y--){const b=o[y];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,f=Math.max(f,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===b.w&&g.h===b.h){const w=o.pop();y<o.length&&(o[y]=w)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(o.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}Ut.prototype={destroy:function(){this.buf=null},readFields:function(n,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),u=o>>3,f=this.pos;this.type=7&o,n(u,e,this),this.pos===f&&this.skip(o)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Dc(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=jp(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Dc(this.buf,this.pos)+Dc(this.buf,this.pos+4)*ch;return this.pos+=8,n},readSFixed64:function(){var n=Dc(this.buf,this.pos)+jp(this.buf,this.pos+4)*ch;return this.pos+=8,n},readFloat:function(){var n=Vp(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Vp(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(u,f,g){var y,b,w=g.buf;if(y=(112&(b=w[g.pos++]))>>4,b<128||(y|=(127&(b=w[g.pos++]))<<3,b<128)||(y|=(127&(b=w[g.pos++]))<<10,b<128)||(y|=(127&(b=w[g.pos++]))<<17,b<128)||(y|=(127&(b=w[g.pos++]))<<24,b<128)||(y|=(1&(b=w[g.pos++]))<<31,b<128))return function Dl(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(u,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&uh?uh.decode(this.buf.subarray(e,n)):function(i,o,u){for(var f="",g=o;g<u;){var y,b,w,S=i[g],T=null,k=S>239?4:S>223?3:S>191?2:1;if(g+k>u)break;1===k?S<128&&(T=S):2===k?128==(192&(y=i[g+1]))&&(T=(31&S)<<6|63&y)<=127&&(T=null):3===k?(b=i[g+2],128==(192&(y=i[g+1]))&&128==(192&b)&&((T=(15&S)<<12|(63&y)<<6|63&b)<=2047||T>=55296&&T<=57343)&&(T=null)):4===k&&(b=i[g+2],w=i[g+3],128==(192&(y=i[g+1]))&&128==(192&b)&&128==(192&w)&&((T=(15&S)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||T>=1114112)&&(T=null)),null===T?(T=65533,k=1):T>65535&&(T-=65536,f+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),f+=String.fromCharCode(T),g+=k}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Ut.Bytes)return n.push(this.readVarint(e));var i=Io(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Ut.Bytes)return n.push(this.readSVarint());var e=Io(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Ut.Bytes)return n.push(this.readBoolean());var e=Io(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Ut.Bytes)return n.push(this.readFloat());var e=Io(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Ut.Bytes)return n.push(this.readDouble());var e=Io(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Ut.Bytes)return n.push(this.readFixed32());var e=Io(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Ut.Bytes)return n.push(this.readSFixed32());var e=Io(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Ut.Bytes)return n.push(this.readFixed64());var e=Io(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Ut.Bytes)return n.push(this.readSFixed64());var e=Io(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Ut.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ut.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ut.Fixed32)this.pos+=4;else{if(e!==Ut.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Ic(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Ic(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Ic(this.buf,-1&n,this.pos),Ic(this.buf,Math.floor(n*kl),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Ic(this.buf,-1&n,this.pos),Ic(this.buf,Math.floor(n*kl),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,i){var o,u,f,y;if(e>=0?(o=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),f=o,(y=i).buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7),function(f,g){var y=(7&f)<<4;g.buf[g.pos++]|=y|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(u,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(o,u,f){for(var g,y,b=0;b<u.length;b++){if((g=u.charCodeAt(b))>55295&&g<57344){if(!y){g>56319||b+1===u.length?(o[f++]=239,o[f++]=191,o[f++]=189):y=g;continue}if(g<56320){o[f++]=239,o[f++]=191,o[f++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(o[f++]=239,o[f++]=191,o[f++]=189,y=null);g<128?o[f++]=g:(g<2048?o[f++]=g>>6|192:(g<65536?o[f++]=g>>12|224:(o[f++]=g>>18|240,o[f++]=g>>12&63|128),o[f++]=g>>6&63|128),o[f++]=63&g|128)}return f}(this.buf,n,this.pos);var i=this.pos-e;i>=128&&kc(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(n){this.realloc(4),Tc(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Tc(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=n[i]},writeRawMessage:function(n,e){this.pos++;var i=this.pos;n(e,this);var o=this.pos-i;o>=128&&kc(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(n,e,i){this.writeTag(n,Ut.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,pa,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,_d,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,Np,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,yd,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Gp,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,xd,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,Up,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,k_,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,D_,e)},writeBytesField:function(n,e){this.writeTag(n,Ut.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Ut.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Ut.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Ut.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Ut.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Ut.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Ut.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Ut.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Ut.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Ut.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class qp{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:f,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=g,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class eg{constructor(e,i){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,o,f),this.addImages(i,u,f);const{w:g,h:y}=Hp(f),b=new Hn({width:g||1,height:y||1});for(const w in e){const S=e[w],T=o[w].paddedRect;Hn.copy(S.data,b,{x:0,y:0},{x:T.x+1,y:T.y+1},S.data)}for(const w in i){const S=i[w],T=u[w].paddedRect,k=T.x+1,F=T.y+1,L=S.data.width,B=S.data.height;Hn.copy(S.data,b,{x:0,y:0},{x:k,y:F},S.data),Hn.copy(S.data,b,{x:0,y:B-1},{x:k,y:F-1},{width:L,height:1}),Hn.copy(S.data,b,{x:0,y:0},{x:k,y:F+B},{width:L,height:1}),Hn.copy(S.data,b,{x:L-1,y:0},{x:k-1,y:F},{width:1,height:B}),Hn.copy(S.data,b,{x:0,y:0},{x:k+L,y:F},{width:1,height:B})}this.image=b,this.iconPositions=o,this.patternPositions=u}addImages(e,i,o){for(const u in e){const f=e[u],g={x:0,y:0,w:f.data.width+2,h:f.data.height+2};o.push(g),i[u]=new qp(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;o.update(i.data,void 0,{x:u,y:f})}}Ke(qp,"ImagePosition"),Ke(eg,"ImageAtlas");const sr={horizontal:1,vertical:2,horizontalOnly:3};class Il{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const o=new Il;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Il;return i.imageName=e,i}}class Fl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new Fl;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,o){let u="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,y=i.charCodeAt(f-1)||null;u+=!o&&(g&&sa(g)&&!Tl[i[f+1]]||y&&sa(y)&&!Tl[i[f-1]])||!Tl[i[f]]?i[f]:Tl[i[f]]}return u}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&bd[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&bd[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Fl;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Il.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(o)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void ai("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Il.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ai("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vd(n,e,i,o,u,f,g,y,b,w,S,T,k,F,L,B){const G=Fl.fromFeature(n,u);let X;T===sr.vertical&&G.verticalizePunctuation(k);const{processBidirectionalText:ie,processStyledBidirectionalText:J}=U;if(ie&&1===G.sections.length){X=[];const ne=ie(G.toString(),wd(G,w,f,e,o,F,L));for(const ve of ne){const ye=new Fl;ye.text=ve,ye.sections=G.sections;for(let Me=0;Me<ve.length;Me++)ye.sectionIndex.push(0);X.push(ye)}}else if(J){X=[];const ne=J(G.text,G.sectionIndex,wd(G,w,f,e,o,F,L));for(const ve of ne){const ye=new Fl;ye.text=ve[0],ye.sectionIndex=ve[1],ye.sections=G.sections,X.push(ye)}}else X=function(ne,ve){const ye=[],Me=ne.text;let ze=0;for(const we of ve)ye.push(ne.substring(ze,we)),ze=we;return ze<Me.length&&ye.push(ne.substring(ze,Me.length)),ye}(G,wd(G,w,f,e,o,F,L));const ee=[],le={positionedLines:ee,text:G.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ne,ve,ye,Me,ze,we,Ee,Ie,Se,Re,Fe,Ze){let gt=0,wt=0,it=0;const Ve="right"===Ie?1:"left"===Ie?0:.5;let bt=!1;for(const Ct of ze){const Vt=Ct.getSections();for(const $t of Vt){if($t.imageName)continue;const Xt=ve[$t.fontStack];if(Xt&&(bt=void 0!==Xt.ascender&&void 0!==Xt.descender,!bt))break}if(!bt)break}let ht=0;for(const Ct of ze){Ct.trim();const Vt=Ct.getMaxScale(),$t=24*(Vt-1),Xt={positionedGlyphs:[],lineOffset:0};ne.positionedLines[ht]=Xt;const ei=Xt.positionedGlyphs;let di=0;if(!Ct.length()){wt+=we,++ht;continue}let xi=0,Xi=0;for(let Ot=0;Ot<Ct.length();Ot++){const fi=Ct.getSection(Ot),ji=Ct.getSectionIndex(Ot),Bt=Ct.getCharCode(Ot);let mi=fi.scale,Hi=null,gi=null,Mi=null,Ki=24,Di=0;const ln=!(Se===sr.horizontal||!Fe&&!oa(Bt)||Fe&&(bd[Bt]||(qe=Bt,Fu(qe)||pn(qe)||Lh(qe)||ra(qe)||_c(qe))));if(fi.imageName){const Ii=Me[fi.imageName];if(!Ii)continue;Mi=fi.imageName,ne.iconsInText=ne.iconsInText||!0,gi=Ii.paddedRect;const Ji=Ii.displaySize;mi=24*mi/Ze,Hi={width:Ji[0],height:Ji[1],left:1,top:-3,advance:ln?Ji[1]:Ji[0],localGlyph:!1},Di=bt?-Hi.height*mi:24*Vt-17-Ji[1]*mi,Ki=Hi.advance;const Ar=(ln?Ji[0]:Ji[1])*mi-24*Vt;Ar>0&&Ar>di&&(di=Ar)}else{const Ii=ye[fi.fontStack];if(!Ii)continue;Ii[Bt]&&(gi=Ii[Bt]);const Ji=ve[fi.fontStack];if(!Ji)continue;const Ar=Ji.glyphs[Bt];if(!Ar)continue;if(Hi=Ar.metrics,Ki=8203!==Bt?24:0,bt){const Wc=void 0!==Ji.ascender?Math.abs(Ji.ascender):0,Xc=void 0!==Ji.descender?Math.abs(Ji.descender):0,zl=(Wc+Xc)*mi;xi<zl&&(xi=zl,Xi=(Wc-Xc)/2*mi),Di=-Wc*mi}else Di=24*(Vt-mi)-17}ln?(ne.verticalizable=!0,ei.push({glyph:Bt,imageName:Mi,x:gt,y:wt+Di,vertical:ln,scale:mi,localGlyph:Hi.localGlyph,fontStack:fi.fontStack,sectionIndex:ji,metrics:Hi,rect:gi}),gt+=Ki*mi+Re):(ei.push({glyph:Bt,imageName:Mi,x:gt,y:wt+Di,vertical:ln,scale:mi,localGlyph:Hi.localGlyph,fontStack:fi.fontStack,sectionIndex:ji,metrics:Hi,rect:gi}),gt+=Hi.advance*mi+Re)}0!==ei.length&&(it=Math.max(gt-Re,it),bt?Md(ei,Ve,di,Xi,we*Vt/2):Md(ei,Ve,di,0,we/2)),gt=0;const Rn=we*Vt+di;Xt.lineOffset=Math.max(di,$t),wt+=Rn,++ht}var qe;const ii=wt,{horizontalAlign:Qt,verticalAlign:hi}=Cd(Ee);(function(Ct,Vt,$t,Xt,ei,di){const xi=(Vt-$t)*ei,Xi=-di*Xt;for(const Rn of Ct)for(const Ot of Rn.positionedGlyphs)Ot.x+=xi,Ot.y+=Xi})(ne.positionedLines,Ve,Qt,hi,it,ii),ne.top+=-hi*ii,ne.bottom=ne.top+ii,ne.left+=-Qt*it,ne.right=ne.left+it,ne.hasBaseline=bt}(le,e,i,o,X,g,y,b,T,w,k,B),!function(ne){for(const ve of ne)if(0!==ve.positionedGlyphs.length)return!1;return!0}(ee)&&le}const bd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$p={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Zp(n,e,i,o,u,f){if(e.imageName){const g=o[e.imageName];return g?g.displaySize[0]*e.scale*24/f+u:0}{const g=i[e.fontStack],y=g&&g.glyphs[n];return y?y.metrics.advance*e.scale+u:0}}function Yp(n,e,i,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(i)*i}function tg(n,e,i){let o=0;return 10===n&&(o-=1e4),i&&(o+=150),40!==n&&65288!==n||(o+=50),41!==e&&65289!==e||(o+=50),o}function Wp(n,e,i,o,u,f){let g=null,y=Yp(e,i,u,f);for(const b of o){const w=Yp(e-b.x,i,u,f)+b.badness;w<=y&&(g=b,y=w)}return{index:n,x:e,priorBreak:g,badness:y}}function Xp(n){return n?Xp(n.priorBreak).concat(n.index):[]}function wd(n,e,i,o,u,f,g){if("point"!==f)return[];if(!n)return[];const y=[],b=function(k,F,L,B,G,X){let ie=0;for(let J=0;J<k.length();J++){const ee=k.getSection(J);ie+=Zp(k.getCharCode(J),ee,B,G,F,X)}return ie/Math.max(1,Math.ceil(ie/L))}(n,e,i,o,u,g),w=n.text.indexOf("\u200b")>=0;let S=0;for(let k=0;k<n.length();k++){const F=n.getSection(k),L=n.getCharCode(k);if(bd[L]||(S+=Zp(L,F,o,u,e,g)),k<n.length()-1){const B=!((T=L)<11904||!(pc(T)||Ou(T)||gc(T)||Rh(T)||mc(T)||bo(T)||Lu(T)||pl(T)||hs(T)||ia(T)||Ru(T)||yc(T)||fl(T)||Br(T)||dl(T)||fc(T)||jn(T)||Bu(T)||Pu(T)||na(T)));($p[L]||B||F.imageName)&&y.push(Wp(k+1,S,b,y,tg(L,n.getCharCode(k+1),B&&w),!1))}}var T;return Xp(Wp(n.length(),S,b,y,0,!0))}function Cd(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Md(n,e,i,o,u){if(!(e||i||o||u))return;const f=n.length-1,g=n[f],y=(g.x+g.metrics.advance*g.scale)*e;for(let b=0;b<=f;b++)n[b].x-=y,n[b].y+=i+o+u}function Kp(n,e,i){const{horizontalAlign:o,verticalAlign:u}=Cd(i),f=e[0]-n.displaySize[0]*o,g=e[1]-n.displaySize[1]*u;return{image:n,top:g,bottom:g+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Jp(n,e,i,o,u,f){const g=n.image;let y;if(g.content){const G=g.content,X=g.pixelRatio||1;y=[G[0]/X,G[1]/X,g.displaySize[0]-G[2]/X,g.displaySize[1]-G[3]/X]}const b=e.left*f,w=e.right*f;let S,T,k,F;"width"===i||"both"===i?(F=u[0]+b-o[3],T=u[0]+w+o[1]):(F=u[0]+(b+w-g.displaySize[0])/2,T=F+g.displaySize[0]);const L=e.top*f,B=e.bottom*f;return"height"===i||"both"===i?(S=u[1]+L-o[0],k=u[1]+B+o[2]):(S=u[1]+(L+B-g.displaySize[1])/2,k=S+g.displaySize[1]),{image:g,top:S,right:T,bottom:k,left:F,collisionPadding:y}}class Fo extends Ue{constructor(e,i,o,u,f){super(e,i),this.angle=u,this.z=o,void 0!==f&&(this.segment=f)}clone(){return new Fo(this.x,this.y,this.z,this.angle,this.segment)}}function Qp(n,e,i,o,u){if(void 0===e.segment)return!0;let f=e,g=e.segment+1,y=0;for(;y>-i/2;){if(g--,g<0)return!1;y-=n[g].dist(f),f=n[g]}y+=n[g].dist(n[g+1]),g++;const b=[];let w=0;for(;y<i/2;){const S=n[g],T=n[g+1];if(!T)return!1;let k=n[g-1].angleTo(S)-S.angleTo(T);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:k}),w+=k;y-b[0].distance>o;)w-=b.shift().angleDelta;if(w>u)return!1;g++,y+=S.dist(T)}return!0}function ef(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function hh(n,e,i){return n?.6*e*i:0}function ig(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function O_(n,e,i,o,u,f){const g=hh(i,u,f),y=ig(i,o)*f;let b=0;const w=ef(n)/2;for(let S=0;S<n.length-1;S++){const T=n[S],k=n[S+1],F=T.dist(k);if(b+F>w){const L=(w-b)/F,B=It(T.x,k.x,L),G=It(T.y,k.y,L),X=new Fo(B,G,0,k.angleTo(T),S);return!g||Qp(n,X,y,g,e)?X:void 0}b+=F}}function L_(n,e,i,o,u,f,g,y,b){const w=hh(o,f,g),S=ig(o,u),T=S*g,k=0===n[0].x||n[0].x===b||0===n[0].y||n[0].y===b;return e-T<e/4&&(e=T+e/4),tf(n,k?e/2*y%e:(S/2+2*f)*g*y%e,e,w,i,T,k,!1,b)}function tf(n,e,i,o,u,f,g,y,b){const w=f/2,S=ef(n);let T=0,k=e-i,F=[];for(let L=0;L<n.length-1;L++){const B=n[L],G=n[L+1],X=B.dist(G),ie=G.angleTo(B);for(;k+i<T+X;){k+=i;const J=(k-T)/X,ee=It(B.x,G.x,J),le=It(B.y,G.y,J);if(ee>=0&&ee<b&&le>=0&&le<b&&k-w>=0&&k+w<=S){const ne=new Fo(ee,le,0,ie,L);ne._round(),o&&!Qp(n,ne,f,o,u)||F.push(ne)}}T+=X}return y||F.length||g||(F=tf(n,T/2,i,o,u,f,g,!0,b)),F}function nf(n,e,i,o,u){const f=[];for(let g=0;g<n.length;g++){const y=n[g];let b;for(let w=0;w<y.length-1;w++){let S=y[w],T=y[w+1];S.x<e&&T.x<e||(S.x<e?S=new Ue(e,S.y+(e-S.x)/(T.x-S.x)*(T.y-S.y))._round():T.x<e&&(T=new Ue(e,S.y+(e-S.x)/(T.x-S.x)*(T.y-S.y))._round()),S.y<i&&T.y<i||(S.y<i?S=new Ue(S.x+(i-S.y)/(T.y-S.y)*(T.x-S.x),i)._round():T.y<i&&(T=new Ue(S.x+(i-S.y)/(T.y-S.y)*(T.x-S.x),i)._round()),S.x>=o&&T.x>=o||(S.x>=o?S=new Ue(o,S.y+(o-S.x)/(T.x-S.x)*(T.y-S.y))._round():T.x>=o&&(T=new Ue(o,S.y+(o-S.x)/(T.x-S.x)*(T.y-S.y))._round()),S.y>=u&&T.y>=u||(S.y>=u?S=new Ue(S.x+(u-S.y)/(T.y-S.y)*(T.x-S.x),u)._round():T.y>=u&&(T=new Ue(S.x+(u-S.y)/(T.y-S.y)*(T.x-S.x),u)._round()),b&&S.equals(b[b.length-1])||(b=[S],f.push(b)),b.push(T)))))}}return f}Ke(Fo,"Anchor");const Fc=1e20;function rf(n,e,i,o,u,f,g,y,b){for(let w=e;w<e+o;w++)ng(n,i*f+w,f,u,g,y,b);for(let w=i;w<i+u;w++)ng(n,w*f+e,1,o,g,y,b)}function ng(n,e,i,o,u,f,g){f[0]=0,g[0]=-Fc,g[1]=Fc,u[0]=n[e];for(let y=1,b=0,w=0;y<o;y++){u[y]=n[e+y*i];const S=y*y;do{const T=f[b];w=(u[y]-u[T]+S-T*T)/(y-T)/2}while(w<=g[b]&&--b>-1);b++,f[b]=y,g[b]=w,g[b+1]=Fc}for(let y=0,b=0;y<o;y++){for(;g[b+1]<y;)b++;const w=f[b],S=y-w;n[e+y*i]=u[w]+S*S}}const sf={none:0,ideographs:1,all:2};class Oc{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const o=[];for(const u in e)for(const f of e[u])o.push({stack:u,id:f});tn(o,({stack:u,id:f},g)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[f];if(void 0!==b)return void g(null,{stack:u,id:f,glyph:b});if(b=this._tinySDF(y,u,f),b)return y.glyphs[f]=b,void g(null,{stack:u,id:f,glyph:b});const w=Math.floor(f/256);if(256*w>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void g(null,{stack:u,id:f,glyph:b});let S=y.requests[w];S||(S=y.requests[w]=[],Oc.loadGlyphRange(u,w,this.url,this.requestManager,(T,k)=>{if(k){y.ascender=k.ascender,y.descender=k.descender;for(const F in k.glyphs)this._doesCharSupportLocalGlyph(+F)||(y.glyphs[+F]=k.glyphs[+F]);y.ranges[w]=!0}for(const F of S)F(T,k);delete y.requests[w]})),S.push((T,k)=>{T?g(T):k&&g(null,{stack:u,id:f,glyph:k.glyphs[f]||null})})},(u,f)=>{if(u)i(u);else if(f){const g={};for(const{stack:y,id:b,glyph:w}of f)void 0===g[y]&&(g[y]={}),void 0===g[y].glyphs&&(g[y].glyphs={}),g[y].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==sf.none&&(this.localGlyphMode===sf.all?!!this.localFontFamily:!!this.localFontFamily&&(ia(e)||zu(e)||fl(e)||jn(e)||pl(e)))}_tinySDF(e,i,o){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(o))return;let f=e.tinySDF;if(!f){let B="400";/bold/i.test(i)?B="900":/medium/i.test(i)?B="500":/light/i.test(i)&&(B="200"),f=e.tinySDF=new Oc.TinySDF({fontFamily:u,fontWeight:B,fontSize:48,buffer:6,radius:16}),f.fontWeight=B}if(this.localGlyphs[f.fontWeight][o])return this.localGlyphs[f.fontWeight][o];const g=String.fromCharCode(o),{data:y,width:b,height:w,glyphWidth:S,glyphHeight:T,glyphLeft:k,glyphTop:F,glyphAdvance:L}=f.draw(g);return this.localGlyphs[f.fontWeight][o]={id:o,bitmap:new _s({width:b,height:w},y),metrics:{width:S/2,height:T/2,left:k/2,top:F/2-27,advance:L/2,localGlyph:!0}}}}function Ad(n,e,i,o){const u=[],f=n.image,g=f.pixelRatio,y=f.paddedRect.w-2,b=f.paddedRect.h-2,w=n.right-n.left,S=n.bottom-n.top,T=f.stretchX||[[0,y]],k=f.stretchY||[[0,b]],F=(we,Ee)=>we+Ee[1]-Ee[0],L=T.reduce(F,0),B=k.reduce(F,0),G=y-L,X=b-B;let ie=0,J=L,ee=0,le=B,ne=0,ve=G,ye=0,Me=X;if(f.content&&o){const we=f.content;ie=Lc(T,0,we[0]),ee=Lc(k,0,we[1]),J=Lc(T,we[0],we[2]),le=Lc(k,we[1],we[3]),ne=we[0]-ie,ye=we[1]-ee,ve=we[2]-we[0]-J,Me=we[3]-we[1]-le}const ze=(we,Ee,Ie,Se)=>{const Re=dh(we.stretch-ie,J,w,n.left),Fe=Rc(we.fixed-ne,ve,we.stretch,L),Ze=dh(Ee.stretch-ee,le,S,n.top),gt=Rc(Ee.fixed-ye,Me,Ee.stretch,B),wt=dh(Ie.stretch-ie,J,w,n.left),it=Rc(Ie.fixed-ne,ve,Ie.stretch,L),Ve=dh(Se.stretch-ee,le,S,n.top),bt=Rc(Se.fixed-ye,Me,Se.stretch,B),ht=new Ue(Re,Ze),qe=new Ue(wt,Ze),ii=new Ue(wt,Ve),Qt=new Ue(Re,Ve),hi=new Ue(Fe/g,gt/g),Ct=new Ue(it/g,bt/g),Vt=e*Math.PI/180;if(Vt){const ei=Math.sin(Vt),di=Math.cos(Vt),xi=[di,-ei,ei,di];ht._matMult(xi),qe._matMult(xi),Qt._matMult(xi),ii._matMult(xi)}const $t=we.stretch+we.fixed,Xt=Ee.stretch+Ee.fixed;return{tl:ht,tr:qe,bl:Qt,br:ii,tex:{x:f.paddedRect.x+1+$t,y:f.paddedRect.y+1+Xt,w:Ie.stretch+Ie.fixed-$t,h:Se.stretch+Se.fixed-Xt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hi,pixelOffsetBR:Ct,minFontScaleX:ve/g/w,minFontScaleY:Me/g/S,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const we=Sd(T,G,L),Ee=Sd(k,X,B);for(let Ie=0;Ie<we.length-1;Ie++){const Se=we[Ie],Re=we[Ie+1];for(let Fe=0;Fe<Ee.length-1;Fe++)u.push(ze(Se,Ee[Fe],Re,Ee[Fe+1]))}}else u.push(ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return u}function Lc(n,e,i){let o=0;for(const u of n)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function Sd(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[u,f]of n){const g=o[o.length-1];o.push({fixed:u-g.stretch,stretch:g.stretch}),o.push({fixed:u-g.stretch,stretch:g.stretch+(f-u)})}return o.push({fixed:e+1,stretch:i}),o}function dh(n,e,i,o){return n/e*i+o}function Rc(n,e,i,o){return n-e*i/o}function Ol(n,e,i,o){const u=e+n.positionedLines[o].lineOffset;return 0===o?i+u/2:i+(u+(e+n.positionedLines[o-1].lineOffset))/2}Oc.loadGlyphRange=function(n,e,i,o,u){const f=256*e,g=f+255,y=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${f}-${g}`),ue.Glyphs);ge(y,(b,w)=>{if(b)u(b);else if(w){const S={},T=new ys(w).readFields(I_,{});for(const k of T.glyphs)S[k.id]=k;u(null,{glyphs:S,ascender:T.ascender,descender:T.descender})}})},Oc.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const y=this.size=n+4*e,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${g} ${f} ${n}px ${u}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(n),g=Math.ceil(i),y=Math.min(this.size-this.buffer,Math.ceil(f-u)),b=Math.min(this.size-this.buffer,g+Math.ceil(o)),w=y+2*this.buffer,S=b+2*this.buffer,T=Math.max(w*S,0),k=new Uint8ClampedArray(T),F={data:k,width:w,height:S,glyphWidth:y,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(0===y||0===b)return F;const{ctx:L,buffer:B,gridInner:G,gridOuter:X}=this;L.clearRect(B,B,y,b),L.fillText(n,B,B+g);const ie=L.getImageData(B,B,y,b);X.fill(Fc,0,T),G.fill(0,0,T);for(let J=0;J<b;J++)for(let ee=0;ee<y;ee++){const le=ie.data[4*(J*y+ee)+3]/255;if(0===le)continue;const ne=(J+B)*w+ee+B;if(1===le)X[ne]=0,G[ne]=Fc;else{const ve=.5-le;X[ne]=ve>0?ve*ve:0,G[ne]=ve<0?ve*ve:0}}rf(X,0,0,w,S,w,this.f,this.v,this.z),rf(G,B,B,y,b,w,this.f,this.v,this.z);for(let J=0;J<T;J++){const ee=Math.sqrt(X[J])-Math.sqrt(G[J]);k[J]=Math.round(255-255*(ee/this.radius+this.cutoff))}return F}};class af{constructor(e=[],i=lf){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const f=e-1>>1,g=i[f];if(o(u,g)>=0)break;i[e]=g,e=f}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,f=i[e];for(;e<u;){let g=1+(e<<1),y=i[g];const b=g+1;if(b<this.length&&o(i[b],y)<0&&(g=b,y=i[b]),o(y,f)>=0)break;i[e]=y,e=g}i[e]=f}}function lf(n,e){return n<e?-1:n>e?1:0}function rg(n,e=1,i=!1){let o=1/0,u=1/0,f=-1/0,g=-1/0;const y=n[0];for(let F=0;F<y.length;F++){const L=y[F];(!F||L.x<o)&&(o=L.x),(!F||L.y<u)&&(u=L.y),(!F||L.x>f)&&(f=L.x),(!F||L.y>g)&&(g=L.y)}const b=Math.min(f-o,g-u);let w=b/2;const S=new af([],cf);if(0===b)return new Ue(o,u);for(let F=o;F<f;F+=b)for(let L=u;L<g;L+=b)S.push(new fa(F+w,L+w,w,n));let T=function(F){let L=0,B=0,G=0;const X=F[0];for(let ie=0,J=X.length,ee=J-1;ie<J;ee=ie++){const le=X[ie],ne=X[ee],ve=le.x*ne.y-ne.x*le.y;B+=(le.x+ne.x)*ve,G+=(le.y+ne.y)*ve,L+=3*ve}return new fa(B/L,G/L,0,F)}(n),k=S.length;for(;S.length;){const F=S.pop();(F.d>T.d||!T.d)&&(T=F,i&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,k)),F.max-T.d<=e||(w=F.h/2,S.push(new fa(F.p.x-w,F.p.y-w,w,n)),S.push(new fa(F.p.x+w,F.p.y-w,w,n)),S.push(new fa(F.p.x-w,F.p.y+w,w,n)),S.push(new fa(F.p.x+w,F.p.y+w,w,n)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${T.d}`)),T.p}function cf(n,e){return e.max-n.max}function fa(n,e,i,o){this.p=new Ue(n,e),this.h=i,this.d=function(u,f){let g=!1,y=1/0;for(let b=0;b<f.length;b++){const w=f[b];for(let S=0,T=w.length,k=T-1;S<T;k=S++){const F=w[S],L=w[k];F.y>u.y!=L.y>u.y&&u.x<(L.x-F.x)*(u.y-F.y)/(L.y-F.y)+F.x&&(g=!g),y=Math.min(y,vp(u,F,L))}}return(g?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const uf=Number.POSITIVE_INFINITY,hf=Math.sqrt(2);function Pc(n,e){return e[1]!==uf?function(i,o,u){let f=0,g=0;switch(o=Math.abs(o),u=Math.abs(u),i){case"top-right":case"top-left":case"top":g=u-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-u}switch(i){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,g]}(n,e[0],e[1]):function(i,o){let u=0,f=0;o<0&&(o=0);const g=o/hf;switch(i){case"top-right":case"top-left":f=g-7;break;case"bottom-right":case"bottom-left":f=7-g;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(i){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=o;break;case"right":u=-o}return[u,f]}(n,e[0])}function ma(n,e,i,o,u,f,g,y,b,w){n.createArrays(),n.tilePixelRatio=ct/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const S=n.layers[0].layout,T=n.layers[0]._unevaluatedLayout._values,k={};if("composite"===n.textSizeData.kind){const{minZoom:B,maxZoom:G}=n.textSizeData;k.compositeTextSizes=[T["text-size"].possiblyEvaluate(new j(B),y),T["text-size"].possiblyEvaluate(new j(G),y)]}if("composite"===n.iconSizeData.kind){const{minZoom:B,maxZoom:G}=n.iconSizeData;k.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new j(B),y),T["icon-size"].possiblyEvaluate(new j(G),y)]}k.layoutTextSize=T["text-size"].possiblyEvaluate(new j(b+1),y),k.layoutIconSize=T["icon-size"].possiblyEvaluate(new j(b+1),y),k.textMaxSize=T["text-size"].possiblyEvaluate(new j(18),y);const F="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),L=S.get("text-size");for(const B of n.features){const G=S.get("text-font").evaluate(B,{},y).join(","),X=L.evaluate(B,{},y),ie=k.layoutTextSize.evaluate(B,{},y),J=(k.layoutIconSize.evaluate(B,{},y),{horizontal:{},vertical:void 0}),ee=B.text;let le,ne=[0,0];if(ee){const Me=ee.toString(),ze=24*S.get("text-letter-spacing").evaluate(B,{},y),we=24*S.get("text-line-height").evaluate(B,{},y),Ee=Ph(Me)?ze:0,Ie=S.get("text-anchor").evaluate(B,{},y),Se=S.get("text-variable-anchor");if(!Se){const it=S.get("text-radial-offset").evaluate(B,{},y);ne=it?Pc(Ie,[24*it,uf]):S.get("text-offset").evaluate(B,{},y).map(Ve=>24*Ve)}let Re=F?"center":S.get("text-justify").evaluate(B,{},y);const Fe=S.get("symbol-placement"),Ze="point"===Fe,gt="point"===Fe?24*S.get("text-max-width").evaluate(B,{},y):0,wt=it=>{n.allowVerticalPlacement&&wo(Me)&&(J.vertical=vd(ee,e,i,u,G,gt,we,Ie,it,Ee,ne,sr.vertical,!0,Fe,ie,X))};if(!F&&Se){const it="auto"===Re?Se.map(bt=>df(bt)):[Re];let Ve=!1;for(let bt=0;bt<it.length;bt++){const ht=it[bt];if(!J.horizontal[ht])if(Ve)J.horizontal[ht]=J.horizontal[0];else{const qe=vd(ee,e,i,u,G,gt,we,"center",ht,Ee,ne,sr.horizontal,!1,Fe,ie,X);qe&&(J.horizontal[ht]=qe,Ve=1===qe.positionedLines.length)}}wt("left")}else{if("auto"===Re&&(Re=df(Ie)),Ze||S.get("text-writing-mode").indexOf("horizontal")>=0||!wo(Me)){const it=vd(ee,e,i,u,G,gt,we,Ie,Re,Ee,ne,sr.horizontal,!1,Fe,ie,X);it&&(J.horizontal[Re]=it)}wt("point"===Fe?"left":Re)}}let ve=!1;if(B.icon&&B.icon.name){const Me=o[B.icon.name];Me&&(le=Kp(u[B.icon.name],S.get("icon-offset").evaluate(B,{},y),S.get("icon-anchor").evaluate(B,{},y)),ve=Me.sdf,void 0===n.sdfIcons?n.sdfIcons=Me.sdf:n.sdfIcons!==Me.sdf&&ai("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Me.pixelRatio!==n.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const ye=Ed(J.horizontal)||J.vertical;n.iconsInText||(n.iconsInText=!!ye&&ye.iconsInText),(ye||le)&&pf(n,B,J,le,o,k,ie,0,ne,ve,g,y,w)}f&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)}function df(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pf(n,e,i,o,u,f,g,y,b,w,S,T,k){let F=f.textMaxSize.evaluate(e,{},T);void 0===F&&(F=g);const L=n.layers[0].layout,B=L.get("icon-offset").evaluate(e,{},T),G=Ed(i.horizontal)||i.vertical,X="globe"===k.name,ie=g/24,J=n.tilePixelRatio*F/24,ee=(Ee=n.overscaling,n.zoom>18&&Ee>2&&(Ee>>=1),Math.max(ct/(512*Ee),1)*L.get("symbol-spacing")),le=L.get("text-padding")*n.tilePixelRatio,ne=L.get("icon-padding")*n.tilePixelRatio,ve=mt(L.get("text-max-angle")),ye="map"===L.get("text-rotation-alignment")&&"point"!==L.get("symbol-placement"),Me="map"===L.get("icon-rotation-alignment")&&"point"!==L.get("symbol-placement"),ze=L.get("symbol-placement"),we=ee/2;var Ee;const Ie=L.get("icon-text-fit");let Se;o&&"none"!==Ie&&(n.allowVerticalPlacement&&i.vertical&&(Se=Jp(o,i.vertical,Ie,L.get("icon-text-fit-padding"),B,ie)),G&&(o=Jp(o,G,Ie,L.get("icon-text-fit-padding"),B,ie)));const Re=(Fe,Ze,gt)=>{if(Ze.x<0||Ze.x>=ct||Ze.y<0||Ze.y>=ct)return;let wt=null;if(X){const{x:it,y:Ve,z:bt}=k.projectTilePoint(Ze.x,Ze.y,gt);wt={anchor:new Fo(it,Ve,bt,0,void 0),up:k.upVector(gt,Ze.x,Ze.y)}}!function(it,Ve,bt,ht,qe,ii,Qt,hi,Ct,Vt,$t,Xt,ei,di,xi,Xi,Rn,Ot,fi,ji,Bt,mi,Hi,gi,Mi){const Ki=it.addToLineVertexArray(Ve,ht);let Di,ln,Ii,Ji,Ar,Wc,Xc,zl=0,Uf=0,Dg=0,jf=0,bh=-1,Kc=-1;const Sr={};let Hf=xc("");const wa=bt?bt.anchor:Ve;let Jc=0,Xd=0;if(void 0===Ct._unevaluatedLayout.getValue("text-radial-offset")?[Jc,Xd]=Ct.layout.get("text-offset").evaluate(Bt,{},Mi).map(qn=>24*qn):(Jc=24*Ct.layout.get("text-radial-offset").evaluate(Bt,{},Mi),Xd=uf),it.allowVerticalPlacement&&qe.vertical){const qn=qe.vertical;if(xi)Wc=fh(qn),hi&&(Xc=fh(hi));else{const Tn=Ct.layout.get("text-rotate").evaluate(Bt,{},Mi)+90;Ii=Td(Vt,wa,Ve,$t,Xt,ei,qn,di,Tn,Xi),hi&&(Ji=Td(Vt,wa,Ve,$t,Xt,ei,hi,Ot,Tn))}}if(ii){const qn=Ct.layout.get("icon-rotate").evaluate(Bt,{},Mi),Tn="none"!==Ct.layout.get("icon-text-fit"),Qc=Ad(ii,qn,Hi,Tn),Jd=hi?Ad(hi,qn,Hi,Tn):void 0;ln=Td(Vt,wa,Ve,$t,Xt,ei,ii,Ot,qn),zl=4*Qc.length;const Bl=it.iconSizeData;let Ma=null;"source"===Bl.kind?(Ma=[Yr*Ct.layout.get("icon-size").evaluate(Bt,{},Mi)],Ma[0]>Oo&&ai(`${it.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Bl.kind&&(Ma=[Yr*mi.compositeIconSizes[0].evaluate(Bt,{},Mi),Yr*mi.compositeIconSizes[1].evaluate(Bt,{},Mi)],(Ma[0]>Oo||Ma[1]>Oo)&&ai(`${it.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),it.addSymbols(it.icon,Qc,Ma,ji,fi,Bt,!1,bt,Ve,Ki.lineStartIndex,Ki.lineLength,-1,gi,Mi),bh=it.icon.placedSymbolArray.length-1,Jd&&(Uf=4*Jd.length,it.addSymbols(it.icon,Jd,Ma,ji,fi,Bt,sr.vertical,bt,Ve,Ki.lineStartIndex,Ki.lineLength,-1,gi,Mi),Kc=it.icon.placedSymbolArray.length-1)}for(const qn in qe.horizontal){const Tn=qe.horizontal[qn];Di||(Hf=xc(Tn.text),xi?Ar=fh(Tn):Di=Td(Vt,wa,Ve,$t,Xt,ei,Tn,di,Ct.layout.get("text-rotate").evaluate(Bt,{},Mi),Xi));const Qc=1===Tn.positionedLines.length;if(Dg+=ph(it,bt,Ve,Tn,Qt,Ct,xi,Bt,Xi,Ki,qe.vertical?sr.horizontal:sr.horizontalOnly,Qc?Object.keys(qe.horizontal):[qn],Sr,bh,mi,gi,Mi),Qc)break}qe.vertical&&(jf+=ph(it,bt,Ve,qe.vertical,Qt,Ct,xi,Bt,Xi,Ki,sr.vertical,["vertical"],Sr,Kc,mi,gi,Mi));let Ca=-1;const Kd=(qn,Tn)=>qn?Math.max(qn,Tn):Tn;Ca=Kd(Ar,Ca),Ca=Kd(Wc,Ca),Ca=Kd(Xc,Ca);const z_=Ca>-1?1:0;it.glyphOffsetArray.length>=bs.MAX_GLYPHS&&ai("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Bt.sortKey&&it.addToSortKeyRanges(it.symbolInstances.length,Bt.sortKey),it.symbolInstances.emplaceBack(wa.x,wa.y,wa.z,Ve.x,Ve.y,Sr.right>=0?Sr.right:-1,Sr.center>=0?Sr.center:-1,Sr.left>=0?Sr.left:-1,Sr.vertical>=0?Sr.vertical:-1,bh,Kc,Hf,void 0!==Di?Di:it.collisionBoxArray.length,void 0!==Di?Di+1:it.collisionBoxArray.length,void 0!==Ii?Ii:it.collisionBoxArray.length,void 0!==Ii?Ii+1:it.collisionBoxArray.length,void 0!==ln?ln:it.collisionBoxArray.length,void 0!==ln?ln+1:it.collisionBoxArray.length,Ji||it.collisionBoxArray.length,Ji?Ji+1:it.collisionBoxArray.length,$t,Dg,jf,zl,Uf,z_,0,Jc,Xd,Ca)}(n,Ze,wt,Fe,i,o,u,Se,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,le,ye,b,0,ne,Me,B,e,f,w,S,T)};if("line"===ze)for(const Fe of nf(e.geometry,0,0,ct,ct)){const Ze=L_(Fe,ee,ve,i.vertical||G,o,24,J,n.overscaling,ct);for(const gt of Ze){const wt=G;wt&&ar(n,wt.text,we,gt)||Re(Fe,gt,T)}}else if("line-center"===ze){for(const Fe of e.geometry)if(Fe.length>1){const Ze=O_(Fe,ve,i.vertical||G,o,24,J);Ze&&Re(Fe,Ze,T)}}else if("Polygon"===e.type)for(const Fe of ld(e.geometry,0)){const Ze=rg(Fe,16);Re(Fe[0],new Fo(Ze.x,Ze.y,0,0,void 0),T)}else if("LineString"===e.type)for(const Fe of e.geometry)Re(Fe,new Fo(Fe[0].x,Fe[0].y,0,0,void 0),T);else if("Point"===e.type)for(const Fe of e.geometry)for(const Ze of Fe)Re([Ze],new Fo(Ze.x,Ze.y,0,0,void 0),T)}const Oo=32640;function ph(n,e,i,o,u,f,g,y,b,w,S,T,k,F,L,B,G){const X=function(ee,le,ne,ve,ye,Me,ze,we){const Ee=[];if(0===le.positionedLines.length)return Ee;const Ie=ve.layout.get("text-rotate").evaluate(Me,{})*Math.PI/180,Se=function(wt){const it=wt[0],Ve=wt[1],bt=it*Ve;return bt>0?[it,-Ve]:bt<0?[-it,Ve]:0===it?[Ve,it]:[Ve,-it]}(ne);let Re=Math.abs(le.top-le.bottom);for(const wt of le.positionedLines)Re-=wt.lineOffset;const Fe=le.positionedLines.length,Ze=Re/Fe;let gt=le.top-ne[1];for(let wt=0;wt<Fe;++wt){const it=le.positionedLines[wt];gt=Ol(le,Ze,gt,wt);for(const Ve of it.positionedGlyphs){if(!Ve.rect)continue;const bt=Ve.rect||{};let ht=4,qe=!0,ii=1,Qt=0;if(Ve.imageName){const gi=ze[Ve.imageName];if(!gi)continue;if(gi.sdf){ai("SDF images are not supported in formatted text and will be ignored.");continue}qe=!1,ii=gi.pixelRatio,ht=1/ii}const hi=(ye||we)&&Ve.vertical,Ct=Ve.metrics.advance*Ve.scale/2,Vt=Ve.metrics,$t=Ve.rect;if(null===$t)continue;we&&le.verticalizable&&(Qt=Ve.imageName?Ct-Ve.metrics.width*Ve.scale/2:0);const Xt=ye?[Ve.x+Ct,Ve.y]:[0,0];let ei=[0,0],di=[0,0],xi=!1;ye||(hi?(di=[Ve.x+Ct+Se[0],Ve.y+Se[1]-Qt],xi=!0):ei=[Ve.x+Ct+ne[0],Ve.y+ne[1]-Qt]);const Xi=$t.w*Ve.scale/(ii*(Ve.localGlyph?2:1)),Rn=$t.h*Ve.scale/(ii*(Ve.localGlyph?2:1));let Ot,fi,ji,Bt;if(hi){const gi=Ve.y-gt,Mi=new Ue(-Ct,Ct-gi),Ki=-Math.PI/2,Di=new Ue(...di);Ot=new Ue(-Ct+ei[0],ei[1]),Ot._rotateAround(Ki,Mi)._add(Di),Ot.x+=-gi+Ct,Ot.y-=(Vt.left-ht)*Ve.scale;const ln=Ve.imageName?Vt.advance*Ve.scale:24*Ve.scale,Ii=String.fromCharCode(Ve.glyph);Bp(Ii)?Ot.x+=(1-ht)*Ve.scale:Ec(Ii)?Ot.x+=ln-Vt.height*Ve.scale+(-ht-1)*Ve.scale:Ot.x+=Ve.imageName||Vt.width+2*ht===$t.w&&Vt.height+2*ht===$t.h?(ln-Rn)/2:(ln-(Vt.height+2*ht)*Ve.scale)/2,fi=new Ue(Ot.x,Ot.y-Xi),ji=new Ue(Ot.x+Rn,Ot.y),Bt=new Ue(Ot.x+Rn,Ot.y-Xi)}else{const gi=(Vt.left-ht)*Ve.scale-Ct+ei[0],Mi=(-Vt.top-ht)*Ve.scale+ei[1],Ki=gi+Xi,Di=Mi+Rn;Ot=new Ue(gi,Mi),fi=new Ue(Ki,Mi),ji=new Ue(gi,Di),Bt=new Ue(Ki,Di)}if(Ie){let gi;gi=ye?new Ue(0,0):xi?new Ue(Se[0],Se[1]):new Ue(ne[0],ne[1]),Ot._rotateAround(Ie,gi),fi._rotateAround(Ie,gi),ji._rotateAround(Ie,gi),Bt._rotateAround(Ie,gi)}const mi=new Ue(0,0),Hi=new Ue(0,0);Ee.push({tl:Ot,tr:fi,bl:ji,br:Bt,tex:bt,writingMode:le.writingMode,glyphOffset:Xt,sectionIndex:Ve.sectionIndex,isSDF:qe,pixelOffsetTL:mi,pixelOffsetBR:Hi,minFontScaleX:0,minFontScaleY:0})}}return Ee}(0,o,b,f,g,y,u,n.allowVerticalPlacement),ie=n.textSizeData;let J=null;"source"===ie.kind?(J=[Yr*f.layout.get("text-size").evaluate(y,{},G)],J[0]>Oo&&ai(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ie.kind&&(J=[Yr*L.compositeTextSizes[0].evaluate(y,{},G),Yr*L.compositeTextSizes[1].evaluate(y,{},G)],(J[0]>Oo||J[1]>Oo)&&ai(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,X,J,b,g,y,S,e,i,w.lineStartIndex,w.lineLength,F,B,G);for(const ee of T)k[ee]=n.text.placedSymbolArray.length-1;return 4*X.length}function Ed(n){for(const e in n)return n[e];return null}function Td(n,e,i,o,u,f,g,y,b,w){let S=g.top,T=g.bottom,k=g.left,F=g.right;const L=g.collisionPadding;if(L&&(k-=L[0],S-=L[1],F+=L[2],T+=L[3]),b){const B=new Ue(k,S),G=new Ue(F,S),X=new Ue(k,T),ie=new Ue(F,T),J=mt(b);let ee=new Ue(0,0);w&&(ee=new Ue(w[0],w[1])),B._rotateAround(J,ee),G._rotateAround(J,ee),X._rotateAround(J,ee),ie._rotateAround(J,ee),k=Math.min(B.x,G.x,X.x,ie.x),F=Math.max(B.x,G.x,X.x,ie.x),S=Math.min(B.y,G.y,X.y,ie.y),T=Math.max(B.y,G.y,X.y,ie.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,k,S,F,T,y,o,u,f),n.length-1}function fh(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function ar(n,e,i,o){const u=n.compareText;if(e in u){const f=u[e];for(let g=f.length-1;g>=0;g--)if(o.dist(f[g])<i)return!0}else u[e]=[];return u[e].push(o),!1}const og=Te([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ff}=og,mf=Te([{name:"a_pos_3",components:3,type:"Int16"}]);var zc=Te([{name:"a_pos",type:"Int16",components:2}]);const Lo=ct/Math.PI/2,gf=2*nr(1,0)*Lo*Math.PI,Bc=[64,32,16],Wr=-Lo,lr=Lo,sg=[new Sn([Wr,Wr,Wr],[lr,lr,lr]),new Sn([Wr,Wr,Wr],[0,0,lr]),new Sn([0,Wr,Wr],[lr,0,lr]),new Sn([Wr,0,Wr],[0,lr,lr]),new Sn([0,0,Wr],[lr,lr,lr])];function _f(n,e,i,o=!0){const u=qr([],n._camera.position,n.worldSize),f=[e,i,1,1];da(f,f,n.pixelMatrixInverse),Tp(f,f,1/f[3]);const g=fn([],$r([],f,u)),y=n.globeMatrix,b=[y[12],y[13],y[14]],w=$r([],b,u),S=wc(w),T=fn([],w),k=n.worldSize/(2*Math.PI),F=ki(T,g),L=Math.asin(k/S);if(L<Math.acos(F)){if(!o)return null;const ze=[],we=[];qr(ze,g,S/F),fn(we,$r(we,ze,w)),fn(g,gs(g,w,qr(g,we,Math.tan(L)*S)))}const B=[];new kp(u,g).closestPointOnSphere(b,k,B);const G=fn([],Vn(y,0)),X=fn([],Vn(y,1)),ie=fn([],Vn(y,2)),J=ki(G,B),ee=ki(X,B),le=ki(ie,B),ne=oi(Math.asin(-ee/k));let ve=oi(Math.atan2(J,le));ve=n.center.lng+function(ze,we){const Ee=(we-ze+180)%360-180;return Ee<-180?Ee+360:Ee}(n.center.lng,ve);const ye=jr(ve),Me=yt(To(ne),0,1);return new _l(ye,Me)}class Wt{constructor(e,i,o){this.a=$r([],e,o),this.b=$r([],i,o),this.center=o;const u=fn([],this.a),f=fn([],this.b);this.angle=Math.acos(ki(u,f))}}function ga(n,e){if(0===n.angle)return null;let i;return i=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(o,u,f,g){const y=Math.sin(f);return o*(Math.sin((1-g)*f)/y)+u*(Math.sin(g*f)/y)}(n.a[e],n.b[e],n.angle,yt(i,0,1))+n.center[e]}function Ln(n){if(n.z<=1)return sg[n.z+2*n.y+n.x];const e=Id(Dd(n));return Sn.fromPoints(e)}function xs(n,e){const i=Nc(e.zoom);if(0===i)return Ln(n);const o=Dd(n),u=Id(o),f=jr(o.getWest())*e.worldSize,g=jr(o.getEast())*e.worldSize,y=To(o.getNorth())*e.worldSize,b=To(o.getSouth())*e.worldSize,w=[f,y,0],S=[g,y,0],T=[f,b,0],k=[g,b,0],F=Zh([],e.globeMatrix);return zi(w,w,F),zi(S,S,F),zi(T,T,F),zi(k,k,F),u[0]=Ko(u[0],T,i),u[1]=Ko(u[1],k,i),u[2]=Ko(u[2],S,i),u[3]=Ko(u[3],w,i),Sn.fromPoints(u)}function kd(n,e,i,o,u){for(const f of i)zi(f,f,o),qr(f,f,u),Do(n,n,f),Kh(e,e,f)}function Dd({x:n,y:e,z:i}){const o=1/(1<<i),u=new qt(rr(n*o),Zi((e+1)*o)),f=new qt(rr((n+1)*o),Zi(e*o));return new fs(u,f)}function Id(n){const e=mt(n.getNorth()),i=mt(n.getSouth()),o=Math.cos(e),u=Math.cos(i),f=Math.sin(e),g=Math.sin(i),y=n.getWest(),b=n.getEast();return[Ll(u,g,y),Ll(u,g,b),Ll(o,f,b),Ll(o,f,y)]}function Ll(n,e,i,o=Lo){return i=mt(i),[n*Math.sin(i)*o,-e*o,n*Math.cos(i)*o]}function Vc(n,e,i){return Ll(Math.cos(mt(n)),Math.sin(mt(n)),e,i)}function Gc(n,e,i,o){const u=1<<i.z,f=(n/ct+i.x)/u;return Vc(Zi((e/ct+i.y)/u),rr(f),o)}function Xr({min:n,max:e}){return 16383/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const xf=new Float64Array(16);function mh(n){const e=Xr(n),i=Mp(xf,[e,e,e]);return bc(i,i,((o=[])[0]=-(u=n.min)[0],o[1]=-u[1],o[2]=-u[2],o));var o,u}function Fd(n){const e=(o=n.min,(i=xf)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i);var i,o;const u=1/Xr(n);return ha(e,e,[u,u,u])}function vf(n,e,i,o,u){const f=function(b){const w=ct/(2*Math.PI);return b/(2*Math.PI)/w}(i),g=[n,e,-i/(2*Math.PI)],y=Cr(new Float64Array(16));return bc(y,y,g),ha(y,y,[f,f,f]),Yh(y,y,mt(-u)),Yu(y,y,mt(-o)),y}function Nc(n){return kn(5,6,n)}function Uc(n,e){const i=Vc(e.lat,e.lng);return f=(o=Xh([],function(F){const L=Vc(F._center.lat,F._center.lng);let B=or([],bl(0,1,0),L);const G=Ap([],-F.angle,L);B=zi(B,B,G),Ap(G,-F._pitch,B);const X=fn([],L);return qr(X,X,F.cameraToCenterDistance/F.pixelsPerMeter*gf),zi(X,X,G),gs([],L,X)}(n),i))[0],g=o[1],y=o[2],b=(u=i)[0],w=u[1],S=u[2],k=(T=Math.sqrt(f*f+g*g+y*y)*Math.sqrt(b*b+w*w+S*S))&&ki(o,u)/T,Math.acos(Math.min(Math.max(k,-1),1));var o,u,f,g,y,b,w,S,T,k}const bf=mt(85),ag=Math.cos(bf),lg=Math.sin(bf);function wf(n,e){const i=n.fovAboveCenter,o=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,u=(n._camera.position[2]*n.worldSize-o)/Math.cos(n._pitch),f=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01)),g=Math.sin(n._pitch)*f+u;return Math.min(1.01*g,u*(1/n._horizonShift))}function Rl(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),o=n.x*i,u=(n.x+1)*i,f=n.y*i,g=(n.y+1)*i,y=rr(o),b=rr(u),w=Zi(f),S=Zi(g),T=e.project(y,w),k=e.project(b,w),F=e.project(b,S),L=e.project(y,S);let B=Math.min(T.x,k.x,F.x,L.x),G=Math.min(T.y,k.y,F.y,L.y),X=Math.max(T.x,k.x,F.x,L.x),ie=Math.max(T.y,k.y,F.y,L.y);const J=i/16;function ee(ne,ve,ye,Me,ze,we){const Ee=(ye+ze)/2,Ie=(Me+we)/2,Se=e.project(rr(Ee),Zi(Ie)),Re=Math.max(0,B-Se.x,G-Se.y,Se.x-X,Se.y-ie);B=Math.min(B,Se.x),X=Math.max(X,Se.x),G=Math.min(G,Se.y),ie=Math.max(ie,Se.y),Re>J&&(ee(ne,Se,ye,Me,Ee,Ie),ee(Se,ve,Ee,Ie,ze,we))}ee(T,k,o,f,u,f),ee(k,F,u,f,u,g),ee(F,L,u,g,o,g),ee(L,T,o,g,o,f),B-=J,G-=J,X+=J,ie+=J;const le=1/Math.max(X-B,ie-G);return{scale:le,x:B*le,y:G*le,x2:X*le,y2:ie*le,projection:e}}const R_=Cr(new Float32Array(16));class Kr{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new qt(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return nr(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return wf(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,u){const f=e.horizonLineFromTop(!1),g=new Ue(i,Math.max(f,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,u))}pointCoordinate3D(e,i,o){const u=new Ue(i,o);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return R_}createTileMatrix(e,i,o){let u,f,g;const y=o.canonical,b=Cr(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Rl(y,this);u=1,f=w.x+o.wrap*w.scale,g=w.y,ha(b,b,[u/w.scale,u/w.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*o.wrap)*u,g=y.y*u;return bc(b,b,[f,g,0]),ha(b,b,[u/ct,u/ct,1]),b}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class Od extends Kr{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(mt(i));this.n=(u+Math.sin(mt(o)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:u,r0:f}=this,g=mt(e-this.center[0]),y=mt(i),b=Math.sqrt(u-2*o*Math.sin(y))/o;return{x:b*Math.sin(g*o),y:b*Math.cos(g*o)-f,z:0}}unproject(e,i){const{n:o,c:u,r0:f}=this,g=f+i;let y=Math.atan2(e,Math.abs(g))*Math.sign(g);g*o<0&&(y-=Math.PI*Math.sign(e)*Math.sign(g));const b=mt(this.center[0])*o;y=Er(y,-Math.PI-b,Math.PI-b);const w=oi(y/o)+this.center[0],S=Math.asin(yt((u-(e*e+g*g)*o*o)/(2*o),-1,1)),T=yt(oi(S),-85.051129,Hr);return new qt(w,T)}}const _a=1.340264,Ro=-.081106,vs=893e-6,jc=.003796,Hc=Math.sqrt(3)/2;class cg extends Kr{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Hc*Math.sin(i)),u=o*o,f=u*u*u;return{x:.5*(e*Math.cos(o)/(Hc*(_a+3*Ro*u+f*(7*vs+9*jc*u)))/Math.PI+.5),y:1-.5*(o*(_a+Ro*u+f*(vs+jc*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,u=o*o,f=u*u*u;for(let S,T,k,F=0;F<12&&(T=o*(_a+Ro*u+f*(vs+jc*u))-i,k=_a+3*Ro*u+f*(7*vs+9*jc*u),S=T/k,o=yt(o-S,-Math.PI/3,Math.PI/3),u=o*o,f=u*u*u,!(Math.abs(S)<1e-12));++F);const g=Hc*e*(_a+3*Ro*u+f*(7*vs+9*jc*u))/Math.cos(o),y=Math.asin(Math.sin(o)/Hc),b=yt(180*g/Math.PI,-180,180),w=yt(180*y/Math.PI,-85.051129,Hr);return new qt(b,w)}}class Ld extends Kr{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),u=yt(360*(.5-i),-85.051129,Hr);return new qt(o,u)}}const ya=Math.PI/2;function qc(n){return Math.tan((ya+n)/2)}class ug extends Kr{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30],u=mt(i),f=mt(o),g=Math.cos(u);this.n=u===f?Math.sin(u):Math.log(g/Math.cos(f))/Math.log(qc(f)/qc(u)),this.f=g*Math.pow(qc(u),this.n)/this.n}project(e,i){i=mt(i),e=mt(e-this.center[0]);const o=1e-6,{n:u,f}=this;f>0?i<-ya+o&&(i=-ya+o):i>ya-o&&(i=ya-o);const g=f/Math.pow(qc(i),u),y=g*Math.sin(u*e),b=f-g*Math.cos(u*e);return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,i=(2*(1-i)-.5)*Math.PI;const{n:o,f:u}=this,f=u-i,g=Math.sign(f),y=Math.sign(o)*Math.sqrt(e*e+f*f);let b=Math.atan2(e,Math.abs(f))*g;f*o<0&&(b-=Math.PI*Math.sign(e)*g);const w=yt(oi(b/o)+this.center[0],-180,180),S=yt(oi(2*Math.atan(Math.pow(u/y,1/o))-ya),-85.051129,Hr);return new qt(w,S)}}class Cf extends Kr{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:jr(e),y:To(i),z:0}}unproject(e,i){const o=rr(e),u=Zi(i);return new qt(o,u)}}const Mf=mt(Hr);class hg extends Kr{project(e,i){const o=(i=mt(i))*i,u=o*o;return{x:.5*((e=mt(e))*(.8707-.131979*o+u*(u*(.003971*o-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+u*(.028874*o-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,u=25,f=0,g=o*o;do{g=o*o;const w=g*g;f=(o*(1.007226+g*(.015085+w*(.028874*g-.044475-.005916*w)))-i)/(1.007226+g*(.045255+w*(.259866*g-.311325-.005916*11*w))),o=yt(o-f,-Mf,Mf)}while(Math.abs(f)>1e-6&&--u>0);g=o*o;const y=yt(oi(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=oi(o);return new qt(y,b)}}const Po=mt(Hr);class gh extends Kr{project(e,i){i=mt(i),e=mt(e);const o=Math.cos(i),u=2/Math.PI,f=Math.acos(o*Math.cos(e/2)),g=Math.sin(f)/f,y=.5*(e*u+2*o*Math.sin(e/2)/g)||0,b=.5*(i+Math.sin(i)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,f=25;const g=1e-6;let y=0,b=0;do{const w=Math.cos(u),S=Math.sin(u),T=2*S*w,k=S*S,F=w*w,L=Math.cos(o/2),B=Math.sin(o/2),G=2*L*B,X=B*B,ie=1-F*L*L,J=ie?1/ie:0,ee=ie?Math.acos(w*L)*Math.sqrt(1/ie):0,le=.5*(2*ee*w*B+2*o/Math.PI)-e,ne=.5*(ee*S+u)-i,ve=.5*J*(F*X+ee*w*L*k)+1/Math.PI,ye=J*(G*T/4-ee*S*B),Me=.125*J*(T*B-ee*S*F*G),ze=.5*J*(k*L+ee*X*w)+.5,we=ye*Me-ze*ve;y=(ne*ye-le*ze)/we,b=(le*Me-ne*ve)/we,o=yt(o-y,-Math.PI,Math.PI),u=yt(u-b,-Po,Po)}while((Math.abs(y)>g||Math.abs(b)>g)&&--f>0);return new qt(oi(o),oi(u))}}class Rd extends Kr{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(mt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:u}=this;return{x:mt(e)*u*o+.5,y:-Math.sin(mt(i))/u*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:u}=this,f=-(i-.5)/o,g=yt(oi((e-.5)/o)/u,-180,180),y=Math.asin(yt(f*u,-1,1)),b=yt(oi(y),-85.051129,Hr);return new qt(g,b)}}class Pd extends Cf{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,i,o){const u=Gc(e,i,o);return zi(u,u,mh(Ln(o))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){const o=Vc(i.lat,i.lng),u=fn([],o),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Wu(o,o,u,nr(1,0)*ct*f);const g=Cr(new Float64Array(16));return vl(g,e.pixelMatrix,e.globeMatrix),zi(o,o,g),new Ue(o[0],o[1])}pixelsPerMeter(e,i){return nr(1,0)*i}pixelSpaceConversion(e,i,o){const u=It(nr(1,45)*i,nr(1,e)*i,o);return this.pixelsPerMeter(e,i)/u}createTileMatrix(e,i,o){const u=Fd(Ln(o.canonical));return vl(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:o}=e,u=mh(Ln(i));return Yu(u,u,mt(o.lng)),Yh(u,u,mt(o.lat)),ha(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,o,u){return _f(e,i,o,!0)||new _l(0,0)}pointCoordinate3D(e,i,o){const u=this.pointCoordinate(e,i,o,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!_f(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,f){const g=u.cameraToCenterDistance,y=u._centerAltitude*f,b=u._camera,w=u._camera.forward(),S=gs([],qr([],w,-g),[0,0,y]),T=u.worldSize/(2*Math.PI),k=[0,0,-T],F=u.width/u.height,L=Math.tan(u.fovAboveCenter),B=qr([],b.up(),L),G=qr([],b.right(),L*F),X=fn([],gs([],gs([],w,B),G)),ie=[];let J;if(new kp(S,X).closestPointOnSphere(k,T,ie)){const ee=gs([],ie,k),le=$r([],ee,S);J=Math.cos(u.fovAboveCenter)*wc(le)}else{const ee=$r([],S,k),le=$r([],k,S);fn(le,le);const ne=wc(ee)-T;J=Math.sqrt(ne*(ne+2*T));const ve=Math.acos(J/(T+ne))-Math.acos(ki(w,le));J*=Math.cos(ve)}return 1.01*J}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Nc(e.zoom);if(o>0){const u=wf(e,nr(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return It(i,u+f*(1-Math.cos(g)),Math.pow(o,10))}return i}upVector(e,i,o){return Gc(i,o,e,1)}upVectorScale(e){return{metersToTile:gf*Xr(Ln(e))}}}function _h(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Cf(n);case"equirectangular":return new Ld(n);case"naturalEarth":return new hg(n);case"equalEarth":return new cg(n);case"winkelTripel":return new gh(n);case"albers":return i?new Rd(n):new Od(n);case"lambertConformalConic":return i?new Rd(n):new ug(n);case"globe":return new Pd(n)}throw new Error(`Invalid projection name: ${n.name}`)}const dg=Cl.VectorTileFeature.types,pg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $c(n,e,i,o,u,f,g,y,b,w,S,T,k){const F=y?Math.min(Oo,Math.round(y[0])):0,L=y?Math.min(Oo,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),f,g,(F<<1)+(b?1:0),L,16*w,16*S,256*T,256*k)}function Pl(n,e,i,o,u,f,g){n.emplaceBack(e,i,o,u,f,g)}function zd(n,e,i,o,u){n.emplaceBack(e,i,o,u),n.emplaceBack(e,i,o,u),n.emplaceBack(e,i,o,u),n.emplaceBack(e,i,o,u)}function fg(n){for(const e of n.sections)if(c(e.text))return!0;return!1}class Bd{constructor(e){this.layoutVertexArray=new si,this.indexArray=new At,this.programConfigurations=e,this.segments=new Ei,this.dynamicLayoutVertexArray=new Tt,this.opacityVertexArray=new Zt,this.placedSymbolArray=new Kf,this.globeExtVertexArray=new yi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,md.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Wm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,pg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,gd.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ke(Bd,"SymbolBuffers");class Vd{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Ei,this.collisionVertexArray=new ri,this.collisionVertexArrayExt=new ui}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Km.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ke(Vd,"CollisionBuffers");class bs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Cr([]),this.placementViewportMatrix=Cr([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ml(this.zoom,i["text-size"]),this.iconSizeData=Ml(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(g=>sr[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Bd(new gl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Bd(new gl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Bh,this.lineVertexArray=new Vh,this.symbolInstances=new ip}calculateGlyphDependencies(e,i,o,u,f){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,u&&f){const y=Tl[e.charAt(g)];y&&(i[y.charCodeAt(0)]=!0)}}populate(e,i,o,u){const f=this.layers[0],g=f.layout,y="globe"===this.projection.name,b=g.get("text-font"),w=g.get("text-field"),S=g.get("icon-image"),T=("constant"!==w.value.kind||w.value.value instanceof rn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),k="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,F=g.get("symbol-sort-key");if(this.features=[],!T&&!k)return;const L=i.iconDependencies,B=i.glyphDependencies,G=i.availableImages,X=new j(this.zoom);for(const{feature:ie,id:J,index:ee,sourceLayerIndex:le}of e){const ne=f._featureFilter.needGeometry,ve=ms(ie,ne);if(!f._featureFilter.filter(X,ve,o))continue;if(ne||(ve.geometry=ko(ie,o,u)),y&&1!==ie.type&&o.z<=5){const we=ve.geometry,Ee=.98078528056;for(let Ie=0;Ie<we.length;Ie++)we[Ie]=pm(we[Ie],Se=>Se,(Se,Re)=>ki(Gc(Se.x,Se.y,o,1),Gc(Re.x,Re.y,o,1))<Ee)}let ye,Me;if(T){const we=f.getValueAndResolveTokens("text-field",ve,o,G),Ee=rn.factory(we);fg(Ee)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===V()||this.hasRTLText&&U.isParsed())&&(ye=El(Ee,f,ve))}if(k){const we=f.getValueAndResolveTokens("icon-image",ve,o,G);Me=we instanceof hn?we:hn.fromString(we)}if(!ye&&!Me)continue;const ze=this.sortFeaturesByKey?F.evaluate(ve,{},o):void 0;if(this.features.push({id:J,text:ye,icon:Me,index:ee,sourceLayerIndex:le,geometry:ve.geometry,properties:ie.properties,type:dg[ie.type],sortKey:ze}),Me&&(L[Me.name]=!0),ye){const we=b.evaluate(ve,{},o).join(","),Ee="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sr.vertical)>=0;for(const Ie of ye.sections)if(Ie.image)L[Ie.image.name]=!0;else{const Se=wo(ye.toString()),Re=Ie.fontStack||we,Fe=B[Re]=B[Re]||{};this.calculateGlyphDependencies(Ie.text,Fe,Ee,this.allowVerticalPlacement,Se)}}}"line"===g.get("symbol-placement")&&(this.features=function(ie){const J={},ee={},le=[];let ne=0;function ve(we){le.push(ie[we]),ne++}function ye(we,Ee,Ie){const Se=ee[we];return delete ee[we],ee[Ee]=Se,le[Se].geometry[0].pop(),le[Se].geometry[0]=le[Se].geometry[0].concat(Ie[0]),Se}function Me(we,Ee,Ie){const Se=J[Ee];return delete J[Ee],J[we]=Se,le[Se].geometry[0].shift(),le[Se].geometry[0]=Ie[0].concat(le[Se].geometry[0]),Se}function ze(we,Ee,Ie){const Se=Ie?Ee[0][Ee[0].length-1]:Ee[0][0];return`${we}:${Se.x}:${Se.y}`}for(let we=0;we<ie.length;we++){const Ee=ie[we],Ie=Ee.geometry,Se=Ee.text?Ee.text.toString():null;if(!Se){ve(we);continue}const Re=ze(Se,Ie),Fe=ze(Se,Ie,!0);if(Re in ee&&Fe in J&&ee[Re]!==J[Fe]){const Ze=Me(Re,Fe,Ie),gt=ye(Re,Fe,le[Ze].geometry);delete J[Re],delete ee[Fe],ee[ze(Se,le[gt].geometry,!0)]=gt,le[Ze].geometry=null}else Re in ee?ye(Re,Fe,Ie):Fe in J?Me(Re,Fe,Ie):(ve(we),J[Re]=ne-1,ee[Fe]=ne-1)}return le.filter(we=>we.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,J)=>ie.sortKey-J.sortKey)}update(e,i,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,o,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,o,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_h(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length,u=e.segment;if(void 0!==u){let f=e.dist(i[u+1]),g=e.dist(i[u]);const y={};for(let b=u+1;b<i.length;b++)y[b]={x:i[b].x,y:i[b].y,tileUnitDistanceFromAnchor:f},b<i.length-1&&(f+=i[b+1].dist(i[b]));for(let b=u||0;b>=0;b--)y[b]={x:i[b].x,y:i[b].y,tileUnitDistanceFromAnchor:g},b>0&&(g+=i[b-1].dist(i[b]));for(let b=0;b<i.length;b++){const w=y[b];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,f,g,y,b,w,S,T,k,F,L){const B=e.indexArray,G=e.layoutVertexArray,X=e.globeExtVertexArray,ie=e.segments.prepareSegment(4*i.length,G,B,this.canOverlap?g.sortKey:void 0),J=this.glyphOffsetArray.length,ee=ie.vertexLength,le=this.allowVerticalPlacement&&y===sr.vertical?Math.PI/2:0,ne=g.text&&g.text.sections;for(let ye=0;ye<i.length;ye++){const{tl:Me,tr:ze,bl:we,br:Ee,tex:Ie,pixelOffsetTL:Se,pixelOffsetBR:Re,minFontScaleX:Fe,minFontScaleY:Ze,glyphOffset:gt,isSDF:wt,sectionIndex:it}=i[ye],Ve=ie.vertexLength,bt=gt[1];if($c(G,w.x,w.y,Me.x,bt+Me.y,Ie.x,Ie.y,o,wt,Se.x,Se.y,Fe,Ze),$c(G,w.x,w.y,ze.x,bt+ze.y,Ie.x+Ie.w,Ie.y,o,wt,Re.x,Se.y,Fe,Ze),$c(G,w.x,w.y,we.x,bt+we.y,Ie.x,Ie.y+Ie.h,o,wt,Se.x,Re.y,Fe,Ze),$c(G,w.x,w.y,Ee.x,bt+Ee.y,Ie.x+Ie.w,Ie.y+Ie.h,o,wt,Re.x,Re.y,Fe,Ze),b){const ht=b.anchor,qe=b.up;Pl(X,ht.x,ht.y,ht.z,qe[0],qe[1],qe[2]),Pl(X,ht.x,ht.y,ht.z,qe[0],qe[1],qe[2]),Pl(X,ht.x,ht.y,ht.z,qe[0],qe[1],qe[2]),Pl(X,ht.x,ht.y,ht.z,qe[0],qe[1],qe[2]),zd(e.dynamicLayoutVertexArray,ht.x,ht.y,ht.z,le)}else zd(e.dynamicLayoutVertexArray,w.x,w.y,w.z,le);B.emplaceBack(Ve,Ve+1,Ve+2),B.emplaceBack(Ve+1,Ve+2,Ve+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),ye!==i.length-1&&it===i[ye+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,g,g.index,{},F,L,ne&&ne[it])}const ve=b?b.anchor:w;e.placedSymbolArray.emplaceBack(ve.x,ve.y,ve.z,w.x,w.y,J,this.glyphOffsetArray.length-J,ee,S,T,w.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,k,0)}_commitLayoutVertex(e,i,o,u,f,g,y){e.emplaceBack(i,o,u,f,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,o,u,f,g,y){const b=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),w=b.vertexLength,S=y.tileAnchorX,T=y.tileAnchorY;for(let F=0;F<4;F++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,u,f,g,S,T,new Ue(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,u,f,g,S,T,new Ue(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,u,f,g,S,T,new Ue(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,u,f,g,S,T,new Ue(e.x1,e.y2)),b.vertexLength+=4;const k=o.indexArray;k.emplaceBack(w,w+1),k.emplaceBack(w+1,w+2),k.emplaceBack(w+2,w+3),k.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,u,f,g){for(let y=u;y<f;y++){const b=o.get(y),w=this.getSymbolInstanceTextSize(e,g,i,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,o,u,f,g){for(let y=u;y<f;y++){const b=o.get(y),w=this.getSymbolInstanceIconSize(e,i,y);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vd(tr,On.members,sn),this.iconCollisionBox=new Vd(tr,On.members,sn);const o=Yt(this.iconSizeData,e),u=Yt(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(o,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(o,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,o,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),g=Al(this.textSizeData,e,f)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,o){const u=this.icon.placedSymbolArray.get(o),f=Al(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,o){e.emplaceBack(i,-o,-o),e.emplaceBack(i,o,-o),e.emplaceBack(i,o,o),e.emplaceBack(i,-o,o)}_updateTextDebugCollisionBoxes(e,i,o,u,f,g){for(let y=u;y<f;y++){const b=o.get(y),w=this.getSymbolInstanceTextSize(e,g,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(e,i,o,u,f){for(let g=u;g<f;g++){const y=o.get(g),b=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=Yt(this.iconSizeData,e),u=Yt(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(o,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,u,f,g,y,b,w){const S={};for(let T=i;T<o;T++){const k=e.get(T);S.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.textFeatureIndex=k.featureIndex;break}for(let T=u;T<f;T++){const k=e.get(T);S.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalTextFeatureIndex=k.featureIndex;break}for(let T=g;T<y;T++){const k=e.get(T);S.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.iconFeatureIndex=k.featureIndex;break}for(let T=b;T<w;T++){const k=e.get(T);S.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalIconFeatureIndex=k.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],f=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(i*b.tileAnchorX+o*b.tileAnchorY)),f.push(b.featureIndex)}return g.sort((y,b)=>u[y]-u[b]||f[b]-f[y]),g}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,f,g)=>{u>=0&&g.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ke(bs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),bs.MAX_GLYPHS=65535,bs.addDynamicAttributes=zd;const Af=new Ae({"symbol-placement":new re(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new re(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new re(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new de(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new re(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new re(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new re(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new re(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new re(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new de(Ce.layout_symbol["icon-size"]),"icon-text-fit":new re(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new re(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new de(Ce.layout_symbol["icon-image"]),"icon-rotate":new de(Ce.layout_symbol["icon-rotate"]),"icon-padding":new re(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new re(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new de(Ce.layout_symbol["icon-offset"]),"icon-anchor":new de(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new re(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new re(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new re(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new de(Ce.layout_symbol["text-field"]),"text-font":new de(Ce.layout_symbol["text-font"]),"text-size":new de(Ce.layout_symbol["text-size"]),"text-max-width":new de(Ce.layout_symbol["text-max-width"]),"text-line-height":new de(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new de(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new de(Ce.layout_symbol["text-justify"]),"text-radial-offset":new de(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new re(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new de(Ce.layout_symbol["text-anchor"]),"text-max-angle":new re(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new re(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new de(Ce.layout_symbol["text-rotate"]),"text-padding":new re(Ce.layout_symbol["text-padding"]),"text-keep-upright":new re(Ce.layout_symbol["text-keep-upright"]),"text-transform":new de(Ce.layout_symbol["text-transform"]),"text-offset":new de(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new re(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new re(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new re(Ce.layout_symbol["text-optional"])});var Gd={paint:new Ae({"icon-opacity":new de(Ce.paint_symbol["icon-opacity"]),"icon-color":new de(Ce.paint_symbol["icon-color"]),"icon-halo-color":new de(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new de(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new de(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new re(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new re(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new de(Ce.paint_symbol["text-opacity"]),"text-color":new de(Ce.paint_symbol["text-color"],{runtimeType:Dn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new de(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new de(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new de(Ce.paint_symbol["text-halo-blur"]),"text-translate":new re(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new re(Ce.paint_symbol["text-translate-anchor"])}),layout:Af};class Nd{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:so,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ke(Nd,"FormatSectionOverride",{omit:["defaultValue"]});class Zc extends Ur{constructor(e){super(e,Gd)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,u){const f=this.layout.get(e).evaluate(i,{},o,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||nl(g.value)||!f?f:(y=i.properties,f.replace(/{([^{}]+)}/g,(w,S)=>S in y?String(y[S]):""));var y}createBucket(e){return new bs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Gd.paint.overridableProperties){if(!Zc.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Nd(i),u=new il(o,i.property.specification);let f=null;f="constant"===i.value.kind||"source"===i.value.kind?new wu("source",u):new rl("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new te(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Zc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=Gd.paint.properties[i];let f=!1;const g=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(f=!0)};if("constant"===o.value.kind&&o.value.value instanceof rn)g(o.value.value.sections);else if("source"===o.value.kind){const y=w=>{f||(w instanceof Ps&&wi(w.value)===Os?g(w.value.sections):w instanceof zs?g(w.sections):w.eachChild(y))},b=o.value;b._styleExpression&&y(b._styleExpression.expression)}return f}getProgramConfiguration(e){return new ps(this,e)}}var Sf={paint:new Ae({"background-color":new re(Ce.paint_background["background-color"]),"background-pattern":new Le(Ce.paint_background["background-pattern"]),"background-opacity":new re(Ce.paint_background["background-opacity"])})},Ef={paint:new Ae({"raster-opacity":new re(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new re(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new re(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new re(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new re(Ce.paint_raster["raster-saturation"]),"raster-contrast":new re(Ce.paint_raster["raster-contrast"]),"raster-resampling":new re(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new re(Ce.paint_raster["raster-fade-duration"])})};class mg extends Ur{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var gg={paint:new Ae({"sky-type":new re(Ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new re(Ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new re(Ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new re(Ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new re(Ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new me(Ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new re(Ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new re(Ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new re(Ce.paint_sky["sky-opacity"])})};function Ud(n,e,i){const o=[0,0,1],u=Cm([]);return Mc(u,u,i?-mt(n)+Math.PI:mt(n)),Ku(u,u,-mt(e)),vm(o,o,u),fn(o,o)}const Tf={circle:class extends Ur{constructor(n){super(n,Cp)}createBucket(n){return new $h(n)}queryRadius(n){const e=n;return xl("circle-radius",this,e)+xl("circle-stroke-width",this,e)+$u(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,o,u,f,g,y){const b=An(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Qh(n,o,f,g,y,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new ps(this,n)}},heatmap:class extends Ur{createBucket(n){return new Mm(n)}constructor(n){super(n,Zg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ip({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return xl("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,o,u,f,g,y){const b=this.paint.get("heatmap-radius").evaluate(e,i);return Qh(n,o,f,g,y,!0,!0,new Ue(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new ps(this,n)}},hillshade:class extends Ur{constructor(n){super(n,Yg)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ur{constructor(n){super(n,l_)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(n){return new ps(this,n)}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new cd(n)}queryRadius(){return $u(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,o,u,f){return!n.queryGeometry.isAboveHorizon&&_m(ca(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Ur{constructor(n){super(n,b_)}createBucket(n){return new sh(n)}queryRadius(){return $u(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new ps(this,n)}queryIntersectsFeature(n,e,i,o,u,f,g,y,b){const w=An(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,i),T=this.paint.get("fill-extrusion-base").evaluate(e,i),k=[0,0],F=y&&f.elevation,L=f.elevation?f.elevation.exaggeration():1,B=n.tile.getBucket(this);if(F&&B instanceof sh){const ie=B.centroidVertexArray,J=b+1;if(J<ie.length){const ee=ie.get(J);k[0]=ee.a_centroid_pos0,k[1]=ee.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;"globe"===f.projection.name&&(o=Hm([o],[new Ue(0,0),new Ue(ct,ct)],n.tileID.canonical).map(ie=>ie.polygon).flat());const G=(J=o,ee=T,le=S,ne=w,ve=g,ye=F?y:null,Me=k,ze=L,we=f.center.lat,"globe"===(ie=f).projection.name?function(Ie,Se,Re,Fe,Ze,gt,wt,it,Ve,bt,ht){const qe=[],ii=[],Qt=Ie.projection.upVectorScale(ht,Ie.center.lat,Ie.worldSize).metersToTile,hi=[0,0,0,1],Ct=[0,0,0,1],Vt=(Xt,ei,di,xi)=>{Xt[0]=ei,Xt[1]=di,Xt[2]=xi,Xt[3]=1},$t=jm();Re>0&&(Re+=$t),Fe+=$t;for(const Xt of Se){const ei=[],di=[];for(const xi of Xt){const Xi=xi.x+Ze.x,Rn=xi.y+Ze.y,Ot=Ie.projection.projectTilePoint(Xi,Rn,ht),fi=Ie.projection.upVector(ht,xi.x,xi.y);let ji=Re,Bt=Fe;if(wt){const mi=Ym(Xi,Rn,Re,Fe,wt,it,Ve,bt);ji+=mi.base,Bt+=mi.top}0!==Re?Vt(hi,Ot.x+fi[0]*Qt*ji,Ot.y+fi[1]*Qt*ji,Ot.z+fi[2]*Qt*ji):Vt(hi,Ot.x,Ot.y,Ot.z),Vt(Ct,Ot.x+fi[0]*Qt*Bt,Ot.y+fi[1]*Qt*Bt,Ot.z+fi[2]*Qt*Bt),zi(hi,hi,gt),zi(Ct,Ct,gt),ei.push(dd(hi)),di.push(dd(Ct))}qe.push(ei),ii.push(di)}return[qe,ii]}(ie,J,ee,le,ne,ve,ye,Me,ze,we,n.tileID.canonical):ye?function(Ie,Se,Re,Fe,Ze,gt,wt,it,Ve){const bt=[],ht=[],qe=[0,0,0,1];for(const ii of Ie){const Qt=[],hi=[];for(const Ct of ii){const Vt=Ct.x+Fe.x,$t=Ct.y+Fe.y,Xt=Ym(Vt,$t,Se,Re,gt,wt,it,Ve);qe[0]=Vt,qe[1]=$t,qe[2]=Xt.base,qe[3]=1,da(qe,qe,Ze),qe[3]=Math.max(qe[3],1e-5);const ei=dd([qe[0]/qe[3],qe[1]/qe[3],qe[2]/qe[3]]);qe[0]=Vt,qe[1]=$t,qe[2]=Xt.top,qe[3]=1,da(qe,qe,Ze),qe[3]=Math.max(qe[3],1e-5);const di=dd([qe[0]/qe[3],qe[1]/qe[3],qe[2]/qe[3]]);Qt.push(ei),hi.push(di)}bt.push(Qt),ht.push(hi)}return[bt,ht]}(J,ee,le,ne,ve,ye,Me,ze,we):function(Ie,Se,Re,Fe,Ze){const gt=[],wt=[],it=Ze[8]*Se,Ve=Ze[9]*Se,bt=Ze[10]*Se,ht=Ze[11]*Se,qe=Ze[8]*Re,ii=Ze[9]*Re,Qt=Ze[10]*Re,hi=Ze[11]*Re;for(const Ct of Ie){const Vt=[],$t=[];for(const Xt of Ct){const ei=Xt.x+Fe.x,di=Xt.y+Fe.y,xi=Ze[0]*ei+Ze[4]*di+Ze[12],Xi=Ze[1]*ei+Ze[5]*di+Ze[13],Rn=Ze[2]*ei+Ze[6]*di+Ze[14],Ot=Ze[3]*ei+Ze[7]*di+Ze[15],fi=xi+it,ji=Xi+Ve,Bt=Rn+bt,mi=Math.max(Ot+ht,1e-5),Hi=xi+qe,gi=Xi+ii,Mi=Rn+Qt,Ki=Math.max(Ot+hi,1e-5),Di=new Ue(fi/mi,ji/mi);Di.z=Bt/mi,Vt.push(Di);const ln=new Ue(Hi/Ki,gi/Ki);ln.z=Mi/Ki,$t.push(ln)}gt.push(Vt),wt.push($t)}return[gt,wt]}(J,ee,le,ne,ve)),X=n.queryGeometry;var ie,J,ee,le,ne,ve,ye,Me,ze,we;return function(ie,J,ee){let le=1/0;_m(ee,J)&&(le=Zm(ee,J[0]));for(let ne=0;ne<J.length;ne++){const ve=J[ne],ye=ie[ne];for(let Me=0;Me<ve.length-1;Me++){const ze=ve[Me],we=[ze,ve[Me+1],ye[Me+1],ye[Me],ze];gp(ee,we)&&(le=Math.min(le,Zm(ee,we)))}}return le!==1/0&&le}(G[0],G[1],X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Ur{constructor(n){super(n,zp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Yl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=Zr.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new pd(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new ps(this,n)}queryRadius(n){const e=n,i=fd(xl("line-width",this,e),xl("line-gap-width",this,e)),o=xl("line-offset",this,e);return i/2+Math.abs(o)+$u(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,o,u,f){if(n.queryGeometry.isAboveHorizon)return!1;const g=ca(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*fd(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(o=function(w,S){const T=[],k=new Ue(0,0);for(let F=0;F<w.length;F++){const L=w[F],B=[];for(let G=0;G<L.length;G++){const X=L[G-1],ie=L[G],J=L[G+1],ee=0===G?k:ie.sub(X)._unit()._perp(),le=G===L.length-1?k:J.sub(ie)._unit()._perp(),ne=ee._add(le)._unit();ne._mult(1/(ne.x*le.x+ne.y*le.y)),B.push(ne._mult(S)._add(ie))}T.push(B)}return T}(o,b*n.pixelToTileUnitsFactor)),function(w,S,T){for(let k=0;k<S.length;k++){const F=S[k];if(w.length>=3)for(let L=0;L<F.length;L++)if(la(w,F[L]))return!0;if(qg(w,F,T))return!0}return!1}(g,o,y)}isTileClipped(){return!0}},symbol:Zc,background:class extends Ur{constructor(n){super(n,Sf)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ur{constructor(n){super(n,Ef)}getProgramIds(){return["raster"]}},sky:class extends Ur{constructor(n){super(n,gg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ip({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const o=this.paint.get("sky-atmosphere-sun"),u=!o,f=n.style.light,g=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&ai("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Ud(g.azimuthal,90-g.polar,e):Ud(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return Ud(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class yh{constructor(e,i,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,o){const{width:u,height:f}=e,{context:g}=this,{gl:y}=g,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:S,ImageData:T,ImageBitmap:k}=Be;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||!1!==i.premultiply)),o||this.size&&this.size[0]===u&&this.size[1]===f){const{x:F,y:L}=o||{x:0,y:0};e instanceof b||e instanceof w||e instanceof S||e instanceof T||k&&e instanceof k?y.texSubImage2D(y.TEXTURE_2D,0,F,L,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,F,L,u,f,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof b||e instanceof w||e instanceof S||e instanceof T||k&&e instanceof k?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,u,f,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,i){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class xh{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new _s({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Ss(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const u=[];let f=e.length%2==1?-e[e.length-1]*o:0,g=e[0]*o,y=!0;u.push({left:f,right:g,isDash:y,zeroLength:0===e[0]});let b=e[0];for(let w=1;w<e.length;w++){y=!y;const S=e[w];f=b*o,b+=S,g=b*o,u.push({left:f,right:g,isDash:y,zeroLength:0===S})}return u}addRoundDash(e,i,o){const u=i/2;for(let f=-o;f<=o;f++){const g=this.width*(this.nextRow+o+f);let y=0,b=e[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++y]);const S=Math.abs(w-b.left),T=Math.abs(w-b.right),k=Math.min(S,T);let F;const L=f/o*(u+1);if(b.isDash){const B=u-Math.abs(L);F=Math.sqrt(k*k+B*B)}else F=u-Math.sqrt(k*k+L*L);this.image.data[g+w]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const w=e[b],S=e[b+1];w.zeroLength?e.splice(b,1):S&&S.isDash===w.isDash&&(S.left=w.left,e.splice(b,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const f=this.width*this.nextRow;let g=0,y=e[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++g]);const w=Math.abs(b-y.left),S=Math.abs(b-y.right),T=Math.min(w,S);this.image.data[f+b]=Math.max(0,Math.min(255,(y.isDash?T:-T)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const u="round"===i,f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return ai("LineAtlas out of space"),null;0===e.length&&e.push(1);let y=0;for(let S=0;S<e.length;S++)e[S]<0&&(ai("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),y+=e[S];if(0!==y){const S=this.width/y,T=this.getDashRanges(e,this.width,S);u?this.addRoundDash(T,S,f):this.addRegularDash(T,"square"===i?.5*S:0)}const b=this.nextRow+f;this.nextRow+=g;const w={tl:[b,f],br:[y,0]};return this.positions[o]=w,w}}Ke(xh,"LineAtlas");class _g{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class yg{constructor(){this.tasks={},this.taskQueue=[],dr(["process"],this),this.invoker=new _g(this.process),this.nextId=0}add(e,i){const o=this.nextId++,u=function({type:f,isSymbolTile:g,zoom:y}){return y=y||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-y:"maybePrepare"===f&&g?400-y:500:200-y:100-y}(i);if(0===u){cn();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:i,priority:u,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){cn();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(null===e)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class kf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const xg=["tile","layer","source","sourceLayer","state"];class Df{constructor(e,i,o,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const i of xg)void 0!==this[i]&&(e[i]=this[i]);return e}}const xa=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,i=0,o=0,u=0,f=0,g=0,y=0;for(1&e?u=f=g=32:i=o=y=32;(e>>=1)>1;){const w=i+u>>1,S=o+f>>1;1&e?(u=i,f=o,i=g,o=y):(i=u,o=f,u=g,f=y),g=w,y=S}const b=4*n;xa[b+0]=i,xa[b+1]=o,xa[b+2]=u,xa[b+3]=f}const Bo=new Uint16Array(2178),va=new Uint8Array(1089),jd=new Uint16Array(1089);function vg(n){return 0===n?-.03125:32===n?.03125:0}var bg=Te([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const wg={type:2,extent:ct,loadGeometry:()=>[[new Ue(0,0),new Ue(8193,0),new Ue(8193,8193),new Ue(0,8193),new Ue(0,0)]]};class If{constructor(e,i,o,u,f){this.tileID=e,this.uid=Uo(),this.uses=0,this.tileSize=i,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<yn.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Rl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const g={};if(!f)return g;for(const y of u){const b=y.layerIds.map(w=>f.getLayer(w)).filter(Boolean);if(0!==b.length){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(S=>S.id===w)[0]));for(const w of b)g[w.id]=y}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof bs){if(this.hasSymbolBuckets=!0,!o)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof bs&&f.hasRTLText){this.hasRTLText=!0,U.isLoading()||U.isLoaded()||"deferred"!==V()||$();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Nr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const u=this.buckets[o];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new yh(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new yh(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new yh(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,o,u,f,g,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:g,params:f,tileTransform:this.tileTransform},e,i,o):{}}querySourceFeatures(e,i){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const u=o.loadVTLayers(),f=i?i.sourceLayer:"",g=u._geojsonTileLayer||u[f];if(!g)return;const y=Ks(i&&i.filter),{z:b,x:w,y:S}=this.tileID.canonical,T={z:b,x:w,y:S};for(let k=0;k<g.length;k++){const F=g.feature(k);if(y.needGeometry){const G=ms(F,!0);if(!y.filter(new j(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!y.filter(new j(this.tileID.overscaledZ),F))continue;const L=o.getId(F,f),B=new Df(F,b,w,S,L);B.tile=T,e.push(B)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const o=Yn(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let u=!1;if(this.expirationTime>o)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const f=this.expirationTime-i;f?this.expirationTime=o+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const o=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const g=this.buckets[f],y=g.layers[0].sourceLayer||"_geojsonTileLayer",b=o[y],w=e[y];if(!b||!w||0===Object.keys(w).length)continue;if(g.update(w,b,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof pd||g instanceof cd){const T=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&T&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(T.id,this.tileID)}const S=i&&i.style&&i.style.getLayer(f);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<yn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=yn.now()+e}setTexture(e,i){const o=i.context,u=o.gl;this.texture=i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new yh(o,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax))}setDependencies(e,i){const o={};for(const u of i)o[u]=!0;this.dependencies[e]=o}hasDependency(e,i){for(const o of e){const u=this.dependencies[o];if(u)for(const f of i)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const o=ko(wg,this.tileID.canonical,this.tileTransform)[0],u=new Ne,f=new Vr;for(let g=0;g<o.length;g++){const{x:y,y:b}=o[g];u.emplaceBack(y,b),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,zc.members),this._tileDebugSegments=Ei.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const o=ko(wg,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const g=function(y,b){const w=Rl(y,b),S=Math.pow(2,y.z);for(let G=0;G<33;G++)for(let X=0;X<33;X++){const ie=rr((y.x+(X+vg(X))/32)/S),J=Zi((y.y+(G+vg(G))/32)/S),ee=b.project(ie,J),le=33*G+X;Bo[2*le+0]=Math.round((ee.x*w.scale-w.x)*ct),Bo[2*le+1]=Math.round((ee.y*w.scale-w.y)*ct)}va.fill(0),jd.fill(0);for(let G=2045;G>=0;G--){const X=4*G,ie=xa[X+0],J=xa[X+1],ee=xa[X+2],le=xa[X+3],ne=ie+ee>>1,ve=J+le>>1,ye=ne+ve-J,Me=ve+ie-ne,ze=33*J+ie,we=33*le+ee,Ee=33*ve+ne,Ie=Math.hypot((Bo[2*ze+0]+Bo[2*we+0])/2-Bo[2*Ee+0],(Bo[2*ze+1]+Bo[2*we+1])/2-Bo[2*Ee+1])>=16;if(va[Ee]=va[Ee]||(Ie?1:0),G<1022){const Se=33*(J+Me>>1)+(ie+ye>>1),Re=33*(le+Me>>1)+(ee+ye>>1);va[Ee]=va[Ee]||va[Se]||va[Re]}}const T=new nt,k=new At;let F=0;function L(G,X){const ie=33*X+G;return 0===jd[ie]&&(T.emplaceBack(Bo[2*ie+0],Bo[2*ie+1],G*ct/32,X*ct/32),jd[ie]=++F),jd[ie]-1}function B(G,X,ie,J,ee,le){const ne=G+ie>>1,ve=X+J>>1;if(Math.abs(G-ee)+Math.abs(X-le)>1&&va[33*ve+ne])B(ee,le,G,X,ne,ve),B(ie,J,ee,le,ne,ve);else{const ye=L(G,X),Me=L(ie,J),ze=L(ee,le);k.emplaceBack(ye,Me,ze)}}return B(0,0,32,32,32,0),B(32,32,0,0,0,32),{vertices:T,indices:k}}(this.tileID.canonical,i);u=g.vertices,f=g.indices}else{u=new nt,f=new At;for(const{x:y,y:b}of o)u.emplaceBack(y,b,0,0);const g=id(u.int16,void 0,4);for(let y=0;y<g.length;y+=3)f.emplaceBack(g[y],g[y+1],g[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,bg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=Ei.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,i){const o=i.projection;if(!o||"globe"!==o.name||i.freezeTileCoverage)return;const u=this.tileID.canonical,f=mh(xs(u,i)),g=Nc(i.zoom);let y;g>0&&(y=Zh(new Float64Array(16),i.globeMatrix));const b=(u.x+.5)/(1<<u.z)-jr(i.center.lng);let w=0;b>.5?w=-1:b<-.5&&(w=1),this._makeGlobeTileDebugBorderBuffer(e,u,i,f,y,g,w),this._makeGlobeTileDebugTextBuffer(e,u,i,f,y,g,w)}_globePoint(e,i,o,u,f,g,y,b){let w=Gc(e,i,o);if(g){const S=1<<o.z,T=[((e/ct+o.x)/S+b)*u,(i/ct+o.y)/S*u,0];zi(T,T,g),w=Ko(w,T,y)}return zi(w,w,f)}_makeGlobeTileDebugBorderBuffer(e,i,o,u,f,g,y){const b=new Ne,w=new Vr,S=new Qe,T=(F,L,B,G,X)=>{const ie=(B-F)/(X-1),J=(G-L)/(X-1),ee=b.length;for(let le=0;le<X;le++){const ne=F+le*ie,ve=L+le*J;b.emplaceBack(ne,ve);const ye=this._globePoint(ne,ve,i,o.worldSize,u,f,g,y);S.emplaceBack(ye[0],ye[1],ye[2]),w.emplaceBack(ee+le)}},k=ct;T(0,0,k,0,16),T(k,0,k,k,16),T(k,k,0,k,16),T(0,k,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(b,zc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,mf.members),this._tileDebugSegments=Ei.simpleSegment(0,0,b.length,w.length)}_makeGlobeTileDebugTextBuffer(e,i,o,u,f,g,y){const b=new Ne,w=new At,S=new Qe,T=25;w.reserve(32),b.reserve(T),S.reserve(T);const k=(F,L)=>T*F+L;for(let F=0;F<T;F++){const L=2048*F;for(let B=0;B<T;B++){const G=2048*B;b.emplaceBack(G,L);const X=this._globePoint(G,L,i,o.worldSize,u,f,g,y);S.emplaceBack(X[0],X[1],X[2])}}for(let F=0;F<4;F++)for(let L=0;L<4;L++){const B=k(F,L),G=k(F,L+1),X=k(F+1,L),ie=k(F+1,L+1);w.emplaceBack(B,G,X),w.emplaceBack(X,G,ie)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(b,zc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,mf.members),this._tileDebugTextSegments=Ei.simpleSegment(0,0,T,32)}}class P_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,o){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Gt(this.stateChanges[e][u],o),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])o[f]||(this.deletedStates[e][u][f]=null)}else for(const f in o)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,i,o){if(null===this.deletedStates[e])return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&void 0!==i)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][o]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][u])for(o in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][o]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const o=String(i),u=Gt({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(null===f)return{};for(const g in f)delete u[g]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const o={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),Gt(this.state[u][g],this.stateChanges[u][g]),f[g]=this.state[u][g];o[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const g in this.state[u])f[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(null===this.deletedStates[u][g])this.state[u][g]={};else for(const y of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][y];f[g]=this.state[u][g]}o[u]=o[u]||{},Gt(o[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(o).length)for(const u in e)e[u].setFeatureState(o,i)}}class Cg{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Mg(n,e,i,o){let u=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(o[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const y=1/o[g];let b=(n[g]-i[g])*y,w=(e[g]-i[g])*y;if(b>w){const S=b;b=w,w=S}if(b>u&&(u=b),w<f&&(f=w),u>f)return null}return u}function Ag(n,e,i,o,u,f,g,y,b,w,S){const T=o-n,k=u-e,F=f-i,L=g-n,B=y-e,G=b-i,X=S[1]*G-S[2]*B,ie=S[2]*L-S[0]*G,J=S[0]*B-S[1]*L,ee=T*X+k*ie+F*J;if(Math.abs(ee)<1e-15)return null;const le=1/ee,ne=w[0]-n,ve=w[1]-e,ye=w[2]-i,Me=(ne*X+ve*ie+ye*J)*le;if(Me<0||Me>1)return null;const ze=ve*F-ye*k,we=ye*T-ne*F,Ee=ne*k-ve*T,Ie=(S[0]*ze+S[1]*we+S[2]*Ee)*le;return Ie<0||Me+Ie>1?null:(L*ze+B*we+G*Ee)*le}function Sg(n,e,i){return(n-e)/(i-e)}function Ff(n,e,i,o,u,f,g,y,b){const w=1<<i,S=f-o,T=g-u,k=(n+1)/w*S+o,F=(e+0)/w*T+u,L=(e+1)/w*T+u;y[0]=(n+0)/w*S+o,y[1]=F,b[0]=k,b[1]=L}class Of{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const g=Math.ceil(Math.log2(f.dim/8)),y=[];let b=Math.ceil(Math.pow(2,g));const w=1/b,S=(F,L,B,G,X)=>{const ie=G?1:0,J=(F+1)*B-ie,ee=L*B,le=(L+1)*B-ie;X[0]=F*B,X[1]=ee,X[2]=J,X[3]=le};let T=new Cg(b);const k=[];for(let F=0;F<b*b;F++){S(F%b,Math.floor(F/b),w,!1,k);const L=ws(k[0],k[1],f),B=ws(k[2],k[1],f),G=ws(k[2],k[3],f),X=ws(k[0],k[3],f);T.minimums.push(Math.min(L,B,G,X)),T.maximums.push(Math.max(L,B,G,X)),T.leaves.push(1)}for(y.push(T),b/=2;b>=1;b/=2){const F=y[y.length-1];T=new Cg(b);for(let L=0;L<b*b;L++){S(L%b,Math.floor(L/b),2,!0,k);const B=F.getElevation(k[0],k[1]),G=F.getElevation(k[2],k[1]),X=F.getElevation(k[2],k[3]),ie=F.getElevation(k[0],k[3]),J=F.isLeaf(k[0],k[1]),ee=F.isLeaf(k[2],k[1]),le=F.isLeaf(k[2],k[3]),ne=F.isLeaf(k[0],k[3]),ve=Math.min(B.min,G.min,X.min,ie.min),ye=Math.max(B.max,G.max,X.max,ie.max),Me=J&&ee&&le&&ne;T.maximums.push(ye),T.minimums.push(ve),T.leaves.push(ye-ve<=5&&Me?1:0)}y.push(T)}return y}(this.dem),o=i.length-1,u=i[o];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,u,f,g,y=1){return Mg([e,i,-100],[o,u,this.maximums[0]*y],f,g)}raycast(e,i,o,u,f,g,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,o,u,f,g,y);if(null==b)return null;const w=[],S=[],T=[],k=[],F=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:L,t:B,nodex:G,nodey:X,depth:ie}=F.pop();if(this.leaves[L]){Ff(G,X,ie,e,i,o,u,T,k);const ee=1<<ie,le=(G+0)/ee,ne=(G+1)/ee,ve=(X+0)/ee,ye=(X+1)/ee,Me=ws(le,ve,this.dem)*y,ze=ws(ne,ve,this.dem)*y,we=ws(ne,ye,this.dem)*y,Ee=ws(le,ye,this.dem)*y,Ie=Ag(T[0],T[1],Me,k[0],T[1],ze,k[0],k[1],we,f,g),Se=Ag(k[0],k[1],we,T[0],k[1],Ee,T[0],T[1],Me,f,g),Re=Math.min(null!==Ie?Ie:Number.MAX_VALUE,null!==Se?Se:Number.MAX_VALUE);if(Re!==Number.MAX_VALUE)return Re;{const Fe=Wu([],f,g,B);if(Lf(Me,ze,Ee,we,Sg(Fe[0],T[0],k[0]),Sg(Fe[1],T[1],k[1]))>=Fe[2])return B}continue}let J=0;for(let ee=0;ee<this._siblingOffset.length;ee++){Ff((G<<1)+this._siblingOffset[ee][0],(X<<1)+this._siblingOffset[ee][1],ie+1,e,i,o,u,T,k),T[2]=-100,k[2]=this.maximums[this.childOffsets[L]+ee]*y;const le=Mg(T,k,f,g);if(null!=le){const ne=le;w[ee]=ne;let ve=!1;for(let ye=0;ye<J&&!ve;ye++)ne>=w[S[ye]]&&(S.splice(ye,0,ee),ve=!0);ve||(S[J]=ee),J++}}for(let ee=0;ee<J;ee++){const le=S[ee];F.push({idx:this.childOffsets[L]+le,t:w[le],nodex:(G<<1)+this._siblingOffset[le][0],nodey:(X<<1)+this._siblingOffset[le][1],depth:ie+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,u,f){if(1===e[u].isLeaf(i,o))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=u-1,y=e[g];let b=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){const T=2*i+this._siblingOffset[S][0],k=2*o+this._siblingOffset[S][1],F=y.getElevation(T,k),L=y.isLeaf(T,k),B=this._addNode(F.min,F.max,L);L&&(b|=1<<S),w||(w=B)}for(let S=0;S<this._siblingOffset.length;S++)b&1<<S||this._construct(e,2*i+this._siblingOffset[S][0],2*o+this._siblingOffset[S][1],g,w+S)}}function Lf(n,e,i,o,u,f){return It(It(n,i,f),It(e,o,f),u)}function ws(n,e,i){const o=i.dim,u=yt(n*o-.5,0,o-1),f=yt(e*o-.5,0,o-1),g=Math.floor(u),y=Math.floor(f),b=Math.min(g+1,o-1),w=Math.min(y+1,o-1);return Lf(i.get(g,y),i.get(b,y),i.get(g,w),i.get(b,w),u-g,f-y)}const Rf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Yc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,u=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&"mapbox"!==o&&"terrarium"!==o)return ai(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,y=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=o||"mapbox",this.borderReady=u,!u){for(let b=0;b<g;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(g,b)]=y[this._idx(g-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,g)]=y[this._idx(b,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Of(this)}get(e,i,o=!1){o&&(e=yt(e,-1,this.dim),i=yt(i,-1,this.dim));const u=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return Rf[e]}get unpackVector(){return Rf[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,o){return(256*e*256+256*i+o)/10-1e4}_unpackTerrarium(e,i,o){return 256*e+i+o/256-32768}static pack(e,i){const o=[0,0,0,0],u=Yc.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return o[2]=f%256,f=Math.floor(f/256),o[1]=f%256,f=Math.floor(f/256),o[0]=f,o}getPixels(){return new Hn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,g=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:g=y-1;break;case 1:y=g+1}const b=-i*this.dim,w=-o*this.dim;for(let S=g;S<y;S++)for(let T=u;T<f;T++){const k=4*this._idx(T,S),F=4*this._idx(T+b,S+w);this.pixels[k+0]=e.pixels[F+0],this.pixels[k+1]=e.pixels[F+1],this.pixels[k+2]=e.pixels[F+2],this.pixels[k+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ke(Yc,"DEMData"),Ke(Of,"DemMinMaxQuadTree",{omit:["dem"]});class Eg{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,o){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:i,timeout:void 0};if(void 0!==o&&(f.timeout=setTimeout(()=>{this.remove(e,f)},o)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const o=e.wrapped().key,u=void 0===i?0:this.data[o].indexOf(i),f=this.data[o][u];return this.data[o].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[o].length&&delete this.data[o],this.onRemove(f.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const o in this.data)for(const u of this.data[o])e(u.value)||i.push(u);for(const o of i)this.remove(o.value.tileID,o)}}class ba{constructor(e,i,o){this.func=e,this.mask=i,this.range=o}}ba.ReadOnly=!1,ba.ReadWrite=!0,ba.disabled=new ba(519,ba.ReadOnly,[0,1]);class qd{constructor(e,i,o,u,f,g){this.test=e,this.ref=i,this.mask=o,this.fail=u,this.depthFail=f,this.pass=g}}qd.disabled=new qd({func:519,mask:0},0,0,7680,7680,7680);class Jr{constructor(e,i,o){this.blendFunction=e,this.blendColor=i,this.mask=o}}Jr.Replace=[1,0],Jr.disabled=new Jr(Jr.Replace,Jt.transparent,[!1,!1,!1,!1]),Jr.unblended=new Jr(Jr.Replace,Jt.transparent,[!0,!0,!0,!0]),Jr.alphaBlended=new Jr([1,771],Jt.transparent,[!0,!0,!0,!0]);class Mr{constructor(e,i,o){this.enable=e,this.mode=i,this.frontFace=o}}Mr.disabled=new Mr(!1,1029,2305),Mr.backCCW=new Mr(!0,1029,2305),Mr.backCW=new Mr(!0,1029,2304),Mr.frontCW=new Mr(!0,1028,2304),Mr.frontCCW=new Mr(!0,1028,2305);class Cs extends tt{constructor(e,i,o){super(),this.id=e,this._onlySymbols=o,i.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new Eg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new P_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const i in this._tiles){const o=this._tiles[i];this._source.prepareTile(o)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,o.tileID),o.upload(e),o.prepare(this.map.style.imageManager)}else for(const i in this._tiles){const o=this._tiles[i];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return to(this._tiles).map(e=>e.tileID).sort(Pf).map(e=>e.key)}getRenderableIds(e){const i=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&i.push(this._tiles[o]);return e?i.sort((o,u)=>{const f=o.tileID,g=u.tileID,y=new Ue(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new Ue(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||b.y-y.y||b.x-y.x}).map(o=>o.tileID.key):i.map(o=>o.tileID).sort(Pf).map(o=>o.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const o=this._tiles[e];o&&("loading"!==o.state&&(o.state=i),this._loadTile(o,this._tileLoaded.bind(this,o,e,i)))}_tileLoaded(e,i,o,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new jt(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=yn.now(),"expired"===o&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Kt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const f=i[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const g=this.getTileByID(f);o(e,g),o(g,e)}}function o(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-u.tileID.canonical.x;const y=f.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),w=f.tileID.key;0===g&&0===y||Math.abs(y)>1||(Math.abs(g)>1&&(1===Math.abs(g+b)?g+=b:1===Math.abs(g-b)&&(g-=b)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,g,y),u.neighboringTiles&&u.neighboringTiles[w]&&(u.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,o,u){for(const f in this._tiles){let g=this._tiles[f];if(u[f]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>o)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const w=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[w.key],g&&g.hasData()&&(y=w)}let b=y;for(;b.overscaledZ>i;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[y.key]=y;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=i?o:null}for(let o=e.overscaledZ-1;o>=i;o--){const u=e.scaledTo(o),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const o=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,f=Math.floor(o*u*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const o={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),o[f.tileID.key]=f}this._tiles=o;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let u;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new En(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[];const f=this._updateRetainedTiles(u);if(zf(this._source.type)&&0!==u.length){const y={},b={},w=Object.keys(f);for(const T of w){const k=f[T],F=this._tiles[T];if(!F||F.fadeEndTime&&F.fadeEndTime<=yn.now())continue;const L=this.findLoadedParent(k,Math.max(k.overscaledZ-Cs.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),y[L.tileID.key]=L.tileID),b[T]=k}const S=u[u.length-1].overscaledZ;for(const T in this._tiles){const k=this._tiles[T];if(f[T]||!k.hasData())continue;let F=k.tileID;for(;F.overscaledZ>S;){F=F.scaledTo(F.overscaledZ-1);const L=this._tiles[F.key];if(L&&L.hasData()&&b[F.key]){f[T]=k.tileID;break}}}for(const T in y)f[T]||(this._coveredTiles[T]=!0,f[T]=y[T])}for(const y in f)this._tiles[y].clearFadeHold();const g=function(y,b){const w=[];for(const S in y)S in b||w.push(S);return w}(this._tiles,f);for(const y of g){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const o={},u=e.reduce((w,S)=>Math.min(w,S.overscaledZ),1/0),f=e[0].overscaledZ,g=Math.max(f-Cs.maxOverzooming,this._source.minzoom),y=Math.max(f+Cs.maxUnderzooming,this._source.minzoom),b={};for(const w of e){const S=this._addTile(w);i[w.key]=w,S.hasData()||u<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,u,y,i);for(const w of e){let S=this._tiles[w.key];if(S.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const k=w.children(this._source.maxzoom)[0],F=this.getTile(k);if(F&&F.hasData()){i[k.key]=k;continue}}else{const k=w.children(this._source.maxzoom);if(i[k[0].key]&&i[k[1].key]&&i[k[2].key]&&i[k[3].key])continue}let T=S.wasRequested();for(let k=w.overscaledZ-1;k>=g;--k){const F=w.scaledTo(k);if(o[F.key]||(o[F.key]=!0,S=this.getTile(F),!S&&T&&(S=this._addTile(F)),S&&(i[F.key]=F,T=S.wasRequested(),S.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let o,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){o=this._loadedParentTiles[u.key];break}i.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(o=this._getLoadedTile(f),o)break;u=f}for(const f of i)this._loadedParentTiles[f]=o}}_addTile(e){let i=this._tiles[e.key];if(i)return this._source.prepareTile&&this._source.prepareTile(i),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const o=Boolean(i);if(!o){const u=this.map?this.map.painter:null;i=new If(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._source.prepareTile&&this._source.prepareTile(i)||this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,o||this._source.fire(new Kt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=i.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,o){const u=[],f=this.transform;if(!f)return u;const g="globe"===f.projection.name,y=jr(f.center.lng);for(const b in this._tiles){const w=this._tiles[b];if(o&&w.clearQueryDebugViz(),w.holdingForFade())continue;let S;if(g){const T=w.tileID.canonical;if(0===T.z){const k=[Math.abs(yt(y,...vh(T,-1))-y),Math.abs(yt(y,...vh(T,1))-y)];S=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(yt(y,...vh(T,-1))-y),Math.abs(yt(y,...vh(T,0))-y),Math.abs(yt(y,...vh(T,1))-y)];S=[k.indexOf(Math.min(...k))-1]}}else S=[0];for(const T of S){const k=e.containsTile(w,f,i,T);k&&u.push(k)}}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of i)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(zf(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=yn.now())return!0}return!1}setFeatureState(e,i,o){this._state.updateState(e=e||"_geojsonTileLayer",i,o)}removeFeatureState(e,i,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,o)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,o){const u=this._tiles[e];u&&u.setDependencies(i,o)}reloadTilesForDependencies(e,i){for(const o in this._tiles)this._tiles[o].hasDependency(e,i)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,i))}_preloadTiles(e,i){const o=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,g=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of u){const b=y.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of b)o.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}tn(Array.from(o.values()),(y,b)=>{const w=new If(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,S=>{"raster-dem"===this._source.type&&w.dem&&this._backfillDEM(w),b(S,w)})},i)}}function Pf(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function zf(n){return"raster"===n||"image"===n||"video"===n}function vh(n,e){const i=1<<n.z;return[n.x/i+e,(n.x+1)/i+e]}Cs.maxOverzooming=10,Cs.maxUnderzooming=3;class Vo{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const u=o||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,g=u.tileID,y=1<<i.canonical.z-g.canonical.z;return new Vo(u,u.tileSize/ct/y,[(i.canonical.x/y-g.canonical.x)*f.dim,(i.canonical.y/y-g.canonical.y)*f.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(o);return new Ue(u,f)}getElevationAt(e,i,o,u){const f=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],y=Math.floor(f),b=Math.floor(g),w=this._dem;return u=!!u,o?It(It(w.get(y,b,u),w.get(y,b+1,u),g-b),It(w.get(y+1,b,u),w.get(y+1,b+1,u),g-b),f-y):w.get(y,b,u)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*nr(1,e)*this._dem.stride}}class Yd{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new vo(ct,16,0),this.featureIndexArray=new rp,this.promoteId=i}insert(e,i,o,u,f,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f,g);const b=this.grid;for(let w=0;w<i.length;w++){const S=i[w],T=[1/0,1/0,-1/0,-1/0];for(let k=0;k<S.length;k++){const F=S[k];T[0]=Math.min(T[0],F.x),T[1]=Math.min(T[1],F.y),T[2]=Math.max(T[2],F.x),T[3]=Math.max(T[3],F.y)}T[0]<ct&&T[1]<ct&&T[2]>=0&&T[3]>=0&&b.insert(y,T[0],T[1],T[2],T[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Cl.VectorTile(new ys(this.rawTileData)).layers,this.sourceLayerCoder=new kf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,o,u){this.loadVTLayers();const f=e.params||{},g=Ks(f.filter),y=e.tileResult,b=e.transform,w=y.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(L,B,G,X)=>bp(y.bufferedTilespaceGeometry,L,B,G,X));S.sort(Tg);let T=null;b.elevation&&S.length>0&&(T=Vo.create(b.elevation,this.tileID));const k={};let F;for(let L=0;L<S.length;L++){const B=S[L];if(B===F)continue;F=B;const G=this.featureIndexArray.get(B);let X=null;this.loadMatchingFeature(k,G,g,f.layers,f.availableImages,i,o,u,(ie,J,ee,le=0)=>(X||(X=ko(ie,this.tileID.canonical,e.tileTransform)),J.queryIntersectsFeature(y,ie,ee,X,this.z,e.transform,e.pixelPosMatrix,T,le)))}return k}loadMatchingFeature(e,i,o,u,f,g,y,b,w){const{featureIndex:S,bucketIndex:T,sourceLayerIndex:k,layoutVertexArrayOffset:F}=i,L=this.bucketLayerIDs[T];if(u&&!function(ie,J){for(let ee=0;ee<ie.length;ee++)if(J.indexOf(ie[ee])>=0)return!0;return!1}(u,L))return;const B=this.sourceLayerCoder.decode(k),G=this.vtLayers[B].feature(S);if(o.needGeometry){const ie=ms(G,!0);if(!o.filter(new j(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!o.filter(new j(this.tileID.overscaledZ),G))return;const X=this.getId(G,B);for(let ie=0;ie<L.length;ie++){const J=L[ie];if(u&&u.indexOf(J)<0)continue;const ee=g[J];if(!ee)continue;let le={};void 0!==X&&b&&(le=b.getState(ee.sourceLayer||"_geojsonTileLayer",X));const ne=Gt({},y[J]);ne.paint=Bf(ne.paint,ee.paint,G,le,f),ne.layout=Bf(ne.layout,ee.layout,G,le,f);const ve=!w||w(G,ee,le,F);if(!ve)continue;const ye=new Df(G,this.z,this.x,this.y,X);ye.layer=ne;let Me=e[J];void 0===Me&&(Me=e[J]=[]),Me.push({featureIndex:S,feature:ye,intersectionZ:ve})}}lookupSymbolFeatures(e,i,o,u,f,g,y,b){const w={};this.loadVTLayers();const S=Ks(f);for(const T of e)this.loadMatchingFeature(w,{bucketIndex:o,sourceLayerIndex:u,featureIndex:T,layoutVertexArrayOffset:0},S,g,y,b,i);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(o),f=this.vtFeatures[u];if(f[i])return f[i];const g=this.vtLayers[u].feature(i);return f[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;return this.promoteId&&(o=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[i]],"boolean"==typeof o&&(o=Number(o))),o}}function Bf(n,e,i,o,u){return Bn(n,(f,g)=>{const y=e instanceof se?e.get(g):null;return y&&y.evaluate?y.evaluate(i,o,u):y})}function Tg(n,e){return e-n}Ke(Yd,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Vf{constructor(e){const i={},o=[];for(const y in e){const b=e[y],w=i[y]={};for(const S in b.glyphs){const T=b.glyphs[+S];if(!T||0===T.bitmap.width||0===T.bitmap.height)continue;const k=T.metrics.localGlyph?2:1,F={x:0,y:0,w:T.bitmap.width+2*k,h:T.bitmap.height+2*k};o.push(F),w[S]=F}}const{w:u,h:f}=Hp(o),g=new _s({width:u||1,height:f||1});for(const y in e){const b=e[y];for(const w in b.glyphs){const S=b.glyphs[+w];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const T=i[y][w],k=S.metrics.localGlyph?2:1;_s.copy(S.bitmap,g,{x:0,y:0},{x:T.x+k,y:T.y+k},S.bitmap)}}this.image=g,this.positions=i}}Ke(Vf,"GlyphAtlas");class kg{constructor(e){this.tileID=new En(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Rl(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,o,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new Nr;const g=new kf(Object.keys(e.layers).sort()),y=new Yd(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},w=new xh(256,256),S={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:o},T=i.familiesBySource[this.source];for(const le in T){const ne=e.layers[le];if(!ne)continue;let ve=!1,ye=!1;for(const we of T[le])"symbol"===we[0].type?ve=!0:ye=!0;if(!0===this.isSymbolTile&&!ve||!1===this.isSymbolTile&&!ye)continue;1===ne.version&&ai(`Vector tile source "${this.source}" layer "${le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Me=g.encode(le),ze=[];for(let we=0;we<ne.length;we++){const Ee=ne.feature(we),Ie=y.getId(Ee,le);ze.push({feature:Ee,id:Ie,index:we,sourceLayerIndex:Me})}for(const we of T[le]){const Ee=we[0];void 0!==this.isSymbolTile&&"symbol"===Ee.type!==this.isSymbolTile||Ee.minzoom&&this.zoom<Math.floor(Ee.minzoom)||Ee.maxzoom&&this.zoom>=Ee.maxzoom||"none"!==Ee.visibility&&(Wd(we,this.zoom,o),(b[Ee.id]=Ee.createBucket({index:y.bucketLayerIDs.length,layers:we,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Me,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:o})).populate(ze,S,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(we.map(Ie=>Ie.id)))}}let k,F,L,B;w.trim();const G={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},X=Bn(S.glyphDependencies,le=>Object.keys(le).map(Number));Object.keys(X).length?u.send("getGlyphs",{uid:this.uid,stacks:X},(le,ne)=>{k||(k=le,F=ne,ee.call(this))},void 0,!1,G):F={};const ie=Object.keys(S.iconDependencies);ie.length?u.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(le,ne)=>{k||(k=le,L=ne,ee.call(this))},void 0,!1,G):L={};const J=Object.keys(S.patternDependencies);function ee(){if(k)return f(k);if(F&&L&&B){const le=new Vf(F),ne=new eg(L,B);for(const ve in b){const ye=b[ve];ye instanceof bs?(Wd(ye.layers,this.zoom,o),ma(ye,F,le.positions,L,ne.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection)):ye.hasPattern&&(ye instanceof pd||ye instanceof cd||ye instanceof sh)&&(Wd(ye.layers,this.zoom,o),ye.addFeatures(S,this.tileID.canonical,ne.patternPositions,o,this.tileTransform))}this.status="done",f(null,{buckets:to(b).filter(ve=>!ve.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:le.image,lineAtlas:w,imageAtlas:ne,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?le.positions:null})}}J.length?u.send("getImages",{icons:J,source:this.source,tileID:this.tileID,type:"patterns"},(le,ne)=>{k||(k=le,B=ne,ee.call(this))},void 0,!1,G):B={},ee.call(this)}}function Wd(n,e,i){const o=new j(e);for(const u of n)u.recalculate(o,i)}class Gf{constructor(e){this.entries={},this.scheduler=e}request(e,i,o,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[g,y]=f.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},i):u(g,y),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=o((g,y)=>{f.result=[g,y];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,y)},i):b(g,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Nf(n,e,i){const o=JSON.stringify(n.request);return n.data&&(this.deduped.entries[o]={result:[null,n.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const f=ge(n.request,(g,y,b,w)=>{g?u(g):y&&u(null,{vectorTile:i?void 0:new Cl.VectorTile(new ys(y)),rawData:y,cacheControl:b,expires:w})});return()=>{f.cancel(),u()}},e)}h.ARRAY_TYPE=Yi,h.AUTH_ERR_MSG=nn,h.Aabb=Sn,h.Actor=class{constructor(n,e,i){this.target=n,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},dr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=cn()?n:Be,this.scheduler=new yg}send(n,e,i,o,u=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[g]=i);const y=no(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:n,hasCallback:!!i,targetMapId:o,mustQueue:u,sourceMapId:this.mapId,data:ta(e,y)},y),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(n){const e=n.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const o=this.cancelCallbacks[i];delete this.cancelCallbacks[i],o&&o.cancel()}else if(e.mustQueue||cn()){const o=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),o&&o.metadata||{type:"message"})}else this.processTask(i,e)}processTask(n,e){if("<response>"===e.type){const i=this.callbacks[n];delete this.callbacks[n],i&&(e.error?i(us(e.error)):i(null,us(e.data)))}else{const i=no(this.globalScope)?void 0:[],o=e.hasCallback?(f,g)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?ta(f):null,data:ta(g,i)},i)}:f=>{},u=us(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,o);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.CanonicalTileID=hd,h.Color=Jt,h.ColorMode=Jr,h.CullFaceMode=Mr,h.DEMData=Yc,h.DataConstantProperty=re,h.DedupedRequest=Gf,h.DepthMode=ba,h.EXTENT=ct,h.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,u=Math.floor(n.x),f=Math.floor((n.x-u)*o),g=Math.floor(n.y*o),y=this.findDEMTileFor(new En(i,u,i,f,g));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){null==e&&(e=null);const o=this._source();if(!o||n.y<0||n.y>1)return e;const u=o.getSource().maxzoom,f=1<<u,g=Math.floor(n.x),y=n.x-g,b=new En(u,g,u,Math.floor(y*f),Math.floor(n.y*f)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;const S=w.dem,T=1<<w.tileID.canonical.z,k=(y*T-w.tileID.canonical.x)*S.dim,F=(n.y*T-w.tileID.canonical.y)*S.dim,L=Math.floor(k),B=Math.floor(F);return(i?this.exaggeration():1)*It(It(S.get(L,B),S.get(L,B+1),F-B),It(S.get(L+1,B),S.get(L+1,B+1),F-B),k-L)}getAtTileOffset(n,e,i){const o=1<<n.canonical.z;return this.getAtPointOrZero(new _l(n.wrap+(n.canonical.x+e/ct)/o,(n.canonical.y+i/ct)/o))}getAtTileOffsetFunc(n,e,i,o){return u=>{const f=this.getAtTileOffset(n,u.x,u.y),g=o.upVector(n.canonical,u.x,u.y);return qr(g,g,f*o.upVectorScale(n.canonical,e,i).metersToTile),g}}getForTilePoints(n,e,i,o){const u=Vo.create(this,n,o);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(n){const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,u=1<<n.canonical.z-o.canonical.z;let f=n.canonical.x/u-o.canonical.x,g=n.canonical.y/u-o.canonical.y,y=0;for(let b=0;b<n.canonical.z-o.canonical.z&&!i.leaves[y];b++){f*=2,g*=2;const w=2*Math.floor(g)+Math.floor(f);y=i.childOffsets[y]+w,f%=1,g%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},h.ErrorEvent=jt,h.EvaluationParameters=j,h.Event=Kt,h.Evented=tt,h.FillExtrusionBucket=sh,h.Frustum=Jh,h.FrustumCorners=Dp,h.GLOBE_METERS_TO_ECEF=gf,h.GLOBE_RADIUS=Lo,h.GLOBE_SCALE_MATCH_LATITUDE=45,h.GLOBE_ZOOM_THRESHOLD_MAX=6,h.GLOBE_ZOOM_THRESHOLD_MIN=5,h.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const e=new Ne,i=new At,o=65;for(let u=0;u<o;u++)for(let f=0;f<o;f++)e.emplaceBack(f,u);this._gridSegments=[];for(let u=0,f=0;u<Bc.length;u++){const g=Bc[u];for(let b=0;b<g;b++)for(let w=0;w<64;w++){const S=b*o+w;i.emplaceBack(S+1,S,S+o),i.emplaceBack(S+o,S+o+1,S+1)}const y=64*g*2;this._gridSegments.push(Ei.simpleSegment(0,f,(g+1)*o,y)),f+=y}this._gridBuffer=n.createVertexBuffer(e,zc.members),this._gridIndexBuffer=n.createIndexBuffer(i,!0)}_createPoles(n){const e=new At;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new on,o=new on;this._poleSegments=[];for(let u=0,f=0;u<5;u++){const g=360/(1<<u);i.emplaceBack(0,-Lo,0,.5,0),o.emplaceBack(0,-Lo,0,.5,1);for(let y=0;y<=64;y++){const b=y/64,w=It(0,g,b),[S,T,k]=Ll(ag,lg,w,Lo);i.emplaceBack(S,T,k,b,0),o.emplaceBack(S,T,k,b,1)}this._poleSegments.push(Ei.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,ff,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(o,ff,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const i=new sn,o=64,u=o+1;this._wireframeSegments=[];for(let f=0,g=0;f<Bc.length;f++){const y=Bc[f];for(let w=0;w<y;w++)for(let S=0;S<o;S++){const T=w*u+S;i.emplaceBack(T,T+1),i.emplaceBack(T,T+u),i.emplaceBack(T,T+u+1)}const b=y*o*3;this._wireframeSegments.push(Ei.simpleSegment(0,g,(y+1)*u,b)),g+=b}this._wireframeIndexBuffer=n.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},h.GlyphManager=Oc,h.ImagePosition=qp,h.LineAtlas=xh,h.LngLat=qt,h.LngLatBounds=fs,h.LocalGlyphMode=sf,h.MAX_MERCATOR_LATITUDE=Hr,h.MercatorCoordinate=_l,h.ONE_EM=24,h.OverscaledTileID=En,h.Properties=Ae,h.RGBAImage=Hn,h.Ray=kp,h.RequestManager=class{constructor(n,e,i){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Is,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!xn(n))return n;const i=vn(n);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!xn(n))return n;const i=vn(n);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(n,e,i,o){if(!xn(n))return n;const u=vn(n);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),o&&u.params.push(`worldview=${o}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(n,e,i,o){const u=vn(n);return xn(n)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||o)):(u.path+=`${e}${i}`,Dr(u))}normalizeTileURL(n,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!xn(n))return n;const o=vn(n);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==o.authority&&512===i?"@2x":""}${bi.supported?".webp":"$1"}`),"raster"===o.authority?o.path=`/${kt.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${kt.TILE_URL_VERSION}${o.path}`);const u=this._customAccessToken||function(f){for(const g of f){const y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(o.params)||kt.ACCESS_TOKEN;return kt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,u)}canonicalizeTileURL(n,e){const i=vn(n);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return n;let o="mapbox://";i.path.match(/^\/raster\/v1\//)?o+=`raster/${i.path.replace(`/${kt.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${i.path.replace(`/${kt.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(o+=`?${u.join("&")}`),o}canonicalizeTileset(n,e){const i=!!e&&xn(e),o=[];for(const u of n.tiles||[])oo(u)?o.push(this.canonicalizeTileURL(u,i)):o.push(u);return o}_makeAPIURL(n,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=vn(kt.API_URL);if(n.protocol=o.protocol,n.authority=o.authority,"http"===n.protocol){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if("/"!==o.path&&(n.path=`${o.path}${n.path}`),!kt.REQUIRE_ACCESS_TOKEN)return Dr(n);if(e=e||kt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return n.params=n.params.filter(u=>-1===u.indexOf("access_token")),n.params.push(`access_token=${e||""}`),Dr(n)}},h.ResourceType=ue,h.SegmentVector=Ei,h.SourceCache=Cs,h.StencilMode=qd,h.StructArrayLayout1ui2=Vr,h.StructArrayLayout2f1f2i16=ir,h.StructArrayLayout2i4=Ne,h.StructArrayLayout2ui4=sn,h.StructArrayLayout3f12=ui,h.StructArrayLayout3ui6=At,h.StructArrayLayout4i8=nt,h.StructArrayLayout5f20=on,h.Texture=yh,h.Tile=If,h.Transitionable=K,h.Uniform1f=Uu,h.Uniform1i=class extends So{constructor(n){super(n),this.current=0}set(n,e,i){this.fetchUniformLocation(n,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},h.Uniform2f=class extends So{constructor(n){super(n),this.current=[0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},h.Uniform3f=class extends So{constructor(n){super(n),this.current=[0,0,0]}set(n,e,i){this.fetchUniformLocation(n,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},h.Uniform4f=cp,h.UniformColor=up,h.UniformMatrix2f=class extends So{constructor(n){super(n),this.current=Hg}set(n,e,i){if(this.fetchUniformLocation(n,e))for(let o=0;o<4;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},h.UniformMatrix3f=class extends So{constructor(n){super(n),this.current=om}set(n,e,i){if(this.fetchUniformLocation(n,e))for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},h.UniformMatrix4f=class extends So{constructor(n){super(n),this.current=rm}set(n,e,i){if(this.fetchUniformLocation(n,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let o=1;o<16;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},h.UnwrappedTileID=$m,h.ValidationError=Ye,h.VectorTileWorkerSource=class extends tt{constructor(n,e,i,o,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||Nf,this.loading={},this.loaded={},this.deduped=new Gf(n.scheduler),this.isSpriteLoaded=o,this.scheduler=n.scheduler}loadTile(n,e){const i=n.uid,o=n&&n.request,u=o&&o.collectResourceTiming,f=this.loading[i]=new kg(n);f.abort=this.loadVectorData(n,(g,y)=>{const b=!this.loading[i];if(delete this.loading[i],b||g||!y)return f.status="done",b||(this.loaded[i]=f),e(g);const w=y.rawData,S={};y.expires&&(S.expires=y.expires),y.cacheControl&&(S.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new Cl.VectorTile(new ys(w));const T=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,F)=>{if(k||!F)return e(k);const L={};if(u){const B=fr(o);B.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,Gt({rawTileData:w.slice(0)},F,S,L))})};this.isSpriteLoaded?T():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(T,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):T()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(n,e){const i=this.loaded,o=n.uid,u=this;if(i&&i[o]){const f=i[o];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain,f.projection=n.projection,f.tileTransform=Rl(n.tileID.canonical,n.projection);const g=(y,b)=>{const w=f.reloadCallback;w&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,w)),e(y,b)};"parsing"===f.status?f.reloadCallback=g:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(n,e){const i=n.uid,o=this.loading[i];o&&(o.abort&&o.abort(),delete this.loading[i]),e()}removeTile(n,e){const i=this.loaded,o=n.uid;i&&i[o]&&delete i[o],e()}},h.WritingMode=sr,h.ZoomHistory=dc,h.add=gs,h.addDynamicAttributes=zd,h.adjoint=function(n,e){var i=e[0],o=e[1],u=e[2],f=e[3],g=e[4],y=e[5],b=e[6],w=e[7],S=e[8];return n[0]=g*S-y*w,n[1]=u*w-o*S,n[2]=o*y-u*g,n[3]=y*b-f*S,n[4]=i*S-u*b,n[5]=u*f-i*y,n[6]=f*w-g*b,n[7]=o*b-i*w,n[8]=i*g-o*f,n},h.asyncAll=tn,h.bezier=eo,h.bindAll=dr,h.boundsAttributes=bg,h.bufferConvexPolygon=function(n,e){const i=[];for(let o=0;o<n.length;o++){const u=Er(o-1,-1,n.length-1),f=Er(o+1,-1,n.length-1),g=n[o],y=n[f],b=n[u].sub(g).unit(),w=y.sub(g).unit(),S=w.angleWithSep(b.x,b.y),T=b.add(w).unit().mult(-1*e/Math.sin(S/2));i.push(g.add(T))}return i},h.cacheEntryPossiblyAdded=function(n){Q++,Q>Yo&&(n.getActor().send("enforceCacheSizeLimit",Zo),Q=0)},h.calculateGlobeLabelMatrix=function(n,e){const{x:i,y:o}=n.point,u=vf(i,o,n.worldSize/n._pixelsPerMercatorPixel,0,0);return vl(u,u,Fd(Ln(e)))},h.calculateGlobeMatrix=function(n){const{x:e,y:i}=n.point,{lng:o,lat:u}=n._center;return vf(e,i,n.worldSize,o,u)},h.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,i=e/nr(1,n.center.lat),o=Cr(new Float64Array(16));return bc(o,o,[n.point.x,n.point.y,0]),ha(o,o,[i,i,e]),Float32Array.from(o)},h.circumferenceAtLatitude=pp,h.clamp=yt,h.clearTileCache=function(n){const e=Y(),i=[];for(const o in Li)e&&i.push(e.delete(o)),delete Li[o];n&&Promise.all(i).catch(n).then(()=>n())},h.clipLine=nf,h.clone=function(n){var e=new Yi(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},h.clone$1=gn,h.collisionCircleLayout=Jm,h.config=kt,h.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},h.create=function(){var n=new Yi(16);return Yi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},h.create$1=ua,h.createExpression=rs,h.createLayout=Te,h.createStyleLayer=function(n){return"custom"===n.type?new mg(n):new Tf[n.type](n)},h.cross=or,h.degToRad=mt,h.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},h.div=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},h.dot=ki,h.ease=No,h.easeCubicInOut=Go,h.emitValidationErrors=ul,h.endsWith=io,h.enforceCacheSizeLimit=function(n){for(const e in Li)R(e),Li[e].then(i=>{i.keys().then(o=>{for(let u=0;u<o.length-n;u++)i.delete(o[u])})})},h.evaluateSizeForFeature=Al,h.evaluateSizeForZoom=Yt,h.evaluateVariableOffset=Pc,h.evented=P,h.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},h.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},h.exported=yn,h.exported$1=bi,h.extend=Gt,h.extend$1=bn,h.fillExtrusionHeightLift=jm,h.filterObject=Tr,h.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},h.fromQuat=function(n,e){var i=e[0],o=e[1],u=e[2],f=e[3],g=i+i,y=o+o,b=u+u,w=i*g,S=o*g,T=o*y,k=u*g,F=u*y,L=u*b,B=f*g,G=f*y,X=f*b;return n[0]=1-T-L,n[1]=S+X,n[2]=k-G,n[3]=0,n[4]=S-X,n[5]=1-w-L,n[6]=F+B,n[7]=0,n[8]=k+G,n[9]=F-B,n[10]=1-w-T,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},h.fromRotation=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},h.fromScaling=Mp,h.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Ea[e]},h.getAABBPointSquareDist=function(n,e,i){let o=0;for(let u=0;u<2;++u){const f=i?i[u]:0;n[u]>f&&(o+=(n[u]-f)*(n[u]-f)),e[u]<f&&(o+=(f-e[u])*(f-e[u]))}return o},h.getAnchorAlignment=Cd,h.getAnchorJustification=df,h.getBounds=function(n){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return{min:new Ue(e,i),max:new Ue(o,u)}},h.getColumn=Vn,h.getGridMatrix=function(n,e,i){const o=e.getNorth(),u=e.getSouth(),f=e.getWest(),g=.015625;return[0,(e.getEast()-f)*g,1<<n.z,(u-o)/Bc[i],0,n.y,o,f,g]},h.getImage=ot,h.getJSON=function(n,e){return he(Gt(n,{type:"json"}),e)},h.getLatitudinalLod=function(n){const e=80.051129;n=yt(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(mt(n))),3);return Math.round(i*(Bc.length-1))},h.getMapSessionAPI=Oa,h.getPerformanceMeasurement=fr,h.getProjection=_h,h.getRTLTextPluginStatus=V,h.getReferrer=pe,h.getTilePoint=function(n,{x:e,y:i},o=0){return new Ue(((e-o)*n.scale-n.x)*ct,(i*n.scale-n.y)*ct)},h.getTileVec3=function(n,e,i=0){return bl(((e.x-i)*n.scale-n.x)*ct,(e.y*n.scale-n.y)*ct,fp(e.z,e.y))},h.getVideo=function(n,e){const i=Be.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<n.length;o++){const u=Be.document.createElement("source");Oe(n[o])||(i.crossOrigin="Anonymous"),u.src=n[o],i.appendChild(u)}return{cancel:()=>{}}},h.globeCenterToScreenPoint=function(n){const e=[0,0,0],i=Cr(new Float64Array(16));return vl(i,n.pixelMatrix,n.globeMatrix),zi(e,e,i),new Ue(e[0],e[1])},h.globeDenormalizeECEF=Fd,h.globeECEFOrigin=function(n,e){const i=[0,0,0];return zi(i,i,mh(Ln(e.canonical))),zi(i,i,n),i},h.globeNormalizeECEF=mh,h.globePixelsToTileUnits=function(n,e){return ct/(512*Math.pow(2,n))*Xr(Ln(e))},h.globePoleMatrixForTile=function(n,e,i){const o=Cr(new Float64Array(16)),u=(e/(1<<n)-.5)*Math.PI*2;return Yu(o,i.globeMatrix,u),Float32Array.from(o)},h.globeTileBounds=Ln,h.globeTiltAtLngLat=Uc,h.globeToMercatorTransition=Nc,h.globeUseCustomAntiAliasing=function(n,e,i){const o=Nc(i.zoom),u=n.style.map._antialias,f=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===o&&!u&&!g&&f},h.identity=Cr,h.identity$1=Cm,h.invert=Zh,h.isFullscreen=function(){return!!Be.document.fullscreenElement||!!Be.document.webkitFullscreenElement},h.isLngLatBehindGlobe=function(n,e){return Uc(n,e)>Math.PI/2*1.01},h.isMapAuthenticated=function(n){return Ir.has(n)},h.isMapboxURL=xn,h.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!no(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},h.latFromMercatorY=Zi,h.len=bm,h.length=wc,h.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},h.loadVectorTile=Nf,h.makeRequest=he,h.mapValue=function(n,e,i,o,u){return yt((n-e)/(i-e)*(u-o)+o,o,u)},h.mercatorScale=dm,h.mercatorXfromLng=jr,h.mercatorYfromLat=To,h.mercatorZfromAltitude=nr,h.mul=xm,h.mul$1=Xu,h.multiply=vl,h.multiply$1=function(n,e,i){var o=e[0],u=e[1],f=e[2],g=e[3],y=e[4],b=e[5],w=e[6],S=e[7],T=e[8],k=i[0],F=i[1],L=i[2],B=i[3],G=i[4],X=i[5],ie=i[6],J=i[7],ee=i[8];return n[0]=k*o+F*g+L*w,n[1]=k*u+F*y+L*S,n[2]=k*f+F*b+L*T,n[3]=B*o+G*g+X*w,n[4]=B*u+G*y+X*S,n[5]=B*f+G*b+X*T,n[6]=ie*o+J*g+ee*w,n[7]=ie*u+J*y+ee*S,n[8]=ie*f+J*b+ee*T,n},h.multiply$2=Ep,h.nextPowerOfTwo=Ss,h.normalize=fn,h.normalize$1=function(n,e){var i=e[0],o=e[1],u=e[2],f=e[3],g=i*i+o*o+u*u+f*f;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=o*g,n[2]=u*g,n[3]=f*g,n},h.number=It,h.ortho=function(n,e,i,o,u,f,g){var y=1/(e-i),b=1/(o-u),w=1/(f-g);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(e+i)*y,n[13]=(u+o)*b,n[14]=(g+f)*w,n[15]=1,n},h.pbf=ys,h.perspective=function(n,e,i,o,u){var f,g=1/Math.tan(e/2);return n[0]=g/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=u&&u!==1/0?(n[10]=(u+o)*(f=1/(o-u)),n[14]=2*u*o*f):(n[10]=-1,n[14]=-2*o),n},h.pick=function(n,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(i[u]=n[u])}return i},h.plugin=U,h.pointGeometry=Ue,h.polygonContainsPoint=la,h.polygonIntersectsBox=bp,h.polygonIntersectsPolygon=gp,h.polygonizeBounds=function(n,e,i=0,o=!0){const u=new Ue(i,i),f=n.sub(u),g=e.add(u),y=[f,new Ue(g.x,f.y),g,new Ue(f.x,g.y)];return o&&y.push(f.clone()),y},h.posAttributes=zc,h.postMapLoadEvent=Gl,h.postTurnstileEvent=Da,h.potpack=Hp,h.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},h.radToDeg=oi,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.registerForPluginStateChange=function(n){return n({pluginStatus:A,pluginURL:E}),P.on("pluginStateChange",n),n},h.removeAuthState=function(n){Ir.delete(n)},h.renderColorRamp=Ip,h.resample=mp,h.rotateX=Yh,h.rotateX$1=Ku,h.rotateY=Yu,h.rotateY$1=Mc,h.rotateZ=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],g=e[1],y=e[2],b=e[3],w=e[4],S=e[5],T=e[6],k=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+w*o,n[1]=g*u+S*o,n[2]=y*u+T*o,n[3]=b*u+k*o,n[4]=w*u-f*o,n[5]=S*u-g*o,n[6]=T*u-y*o,n[7]=k*u-b*o,n},h.rotateZ$1=function(n,e,i){i*=.5;var o=e[0],u=e[1],f=e[2],g=e[3],y=Math.sin(i),b=Math.cos(i);return n[0]=o*b+u*y,n[1]=u*b-o*y,n[2]=f*b+g*y,n[3]=g*b-f*y,n},h.scale=ha,h.scale$1=Tp,h.scale$2=qr,h.scaleAndAdd=Wu,h.setCacheLimits=function(n,e){Zo=n,Yo=e},h.setColumn=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},h.setRTLTextPlugin=function(n,e,i=!1){if(A===m||A===x||A===v)throw new Error("setRTLTextPlugin cannot be called multiple times.");E=yn.resolveURL(n),A=m,C=e,I(),i||$()},h.smoothstep=kn,h.spec=Ce,h.storeAuthState=function(n,e){e?Ir.add(n):Ir.delete(n)},h.sub=$r,h.subtract=Xh,h.symbolSize=Sl,h.tileAABB=function(n,e,i,o,u,f,g,y,b){if("globe"===b.name)return function yf(n,e,i){const o=e/n.worldSize,u=Number.MAX_VALUE,f=[-u,-u,-u],g=[u,u,u],y=n.globeMatrix;if(i.z<=1)return kd(g,f,Ln(i).getCorners(),y,o),new Sn(g,f);const b=Dd(i),w=Id(b);if(kd(g,f,w,y,o),b.contains(n.center)){f[2]=0;const ve=n.point,ye=[ve.x*o,ve.y*o,0];return Do(g,g,ye),Kh(f,f,ye),new Sn(g,f)}const S=[y[12]*o,y[13]*o,y[14]*o],T=b.getCenter(),k=yt(n.center.lat,-85.051129,Hr),F=yt(T.lat,-85.051129,Hr),L=jr(n.center.lng),B=To(k);let G=L-jr(T.lng);const X=B-To(F);G>.5?G-=1:G<-.5&&(G+=1);let ie=0;Math.abs(G)>Math.abs(X)?ie=G>=0?1:3:(ie=X>=0?0:2,Wu(S,S,[y[4]*o,y[5]*o,y[6]*o],-Math.sin(mt(X>=0?b.getSouth():b.getNorth()))*Lo));const J=w[ie],ee=w[(ie+1)%4],le=new Wt(J,ee,S),ne=[ga(le,0)||J[0],ga(le,1)||J[1],ga(le,2)||J[2]];return g[2]=Math.min(J[2],ee[2]),Do(g,g,ne),Kh(f,f,ne),new Sn(g,f)}(n,e,new hd(i,o,u));const w=Rl({z:i,x:o,y:u},b);return new Sn([(f+w.x/w.scale)*e,e*(w.y/w.scale),g],[(f+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},h.tileCornersToBounds=Dd,h.tileTransform=Rl,h.transformMat3=function(n,e,i){var o=e[0],u=e[1],f=e[2];return n[0]=o*i[0]+u*i[3]+f*i[6],n[1]=o*i[1]+u*i[4]+f*i[7],n[2]=o*i[2]+u*i[5]+f*i[8],n},h.transformMat4=zi,h.transformMat4$1=da,h.transformQuat=vm,h.transitionTileAABBinECEF=xs,h.translate=bc,h.transpose=function(n,e){if(n===e){var i=e[1],o=e[2],u=e[5];n[1]=e[3],n[2]=e[6],n[3]=i,n[5]=e[7],n[6]=o,n[7]=u}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},h.triggerPluginCompletionEvent=D,h.uniqueId=Uo,h.updateGlobeVertexNormal=function(n,e,i,o,u){const f=5*e+2;n.float32[f+0]=i,n.float32[f+1]=o,n.float32[f+2]=u},h.validateCustomStyleLayer=function(n){const e=[],i=n.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},h.validateFilter=n=>er(as(n)),h.validateFog=n=>er(ku(n)),h.validateLayer=n=>er(ll(n)),h.validateLight=n=>er(Tu(n)),h.validateSource=n=>er(Eu(n)),h.validateStyle=ea,h.validateTerrain=n=>er(cs(n)),h.values=to,h.vectorTile=Cl,h.version="2.10.0",h.warnOnce=ai,h.window=Be,h.wrap=Er}),ur(0,function(h){function Be(Y){if("number"==typeof Y||"boolean"==typeof Y||"string"==typeof Y||null==Y)return JSON.stringify(Y);if(Array.isArray(Y)){let z="[";for(const W of Y)z+=`${Be(W)},`;return`${z}]`}let R="{";for(const z of Object.keys(Y).sort())R+=`${z}:${Be(Y[z])},`;return`${R}}`}function hr(Y){let R="";for(const z of h.refProperties)R+=`/${Be(Y[z])}`;return R}class _i{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,z){for(const Q of R)this._layerConfigs[Q.id]=Q,(this._layers[Q.id]=h.createStyleLayer(Q)).compileFilter(),this.keyCache[Q.id]&&delete this.keyCache[Q.id];for(const Q of z)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const W=function(Q,ue){const fe={};for(let he=0;he<Q.length;he++){const ge=ue&&ue[Q[he].id]||hr(Q[he]);ue&&(ue[Q[he].id]=ge);let De=fe[ge];De||(De=fe[ge]=[]),De.push(Q[he])}const pe=[];for(const he in fe)pe.push(fe[he]);return pe}(h.values(this._layerConfigs),this.keyCache);for(const Q of W){const ue=Q.map(We=>this._layers[We.id]),fe=ue[0];if("none"===fe.visibility)continue;const pe=fe.source||"";let he=this.familiesBySource[pe];he||(he=this.familiesBySource[pe]={});const ge=fe.sourceLayer||"_geojsonTileLayer";let De=he[ge];De||(De=he[ge]=[]),De.push(ue)}}}class Ue{loadTile(R,z){const{uid:W,encoding:Q,rawImageData:ue,padding:fe,buildQuadTree:pe}=R,he=h.window.ImageBitmap&&ue instanceof h.window.ImageBitmap?this.getImageData(ue,fe):ue;z(null,new h.DEMData(W,he,Q,fe<1,pe))}getImageData(R,z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const W=this.offscreenCanvasContext.getImageData(-z,-z,R.width+2*z,R.height+2*z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),W}}var St=function Y(R,z){var W,Q=R&&R.type;if("FeatureCollection"===Q)for(W=0;W<R.features.length;W++)Y(R.features[W],z);else if("GeometryCollection"===Q)for(W=0;W<R.geometries.length;W++)Y(R.geometries[W],z);else if("Feature"===Q)Y(R.geometry,z);else if("Polygon"===Q)en(R.coordinates,z);else if("MultiPolygon"===Q)for(W=0;W<R.coordinates.length;W++)en(R.coordinates[W],z);return R};function en(Y,R){if(0!==Y.length){zn(Y[0],R);for(var z=1;z<Y.length;z++)zn(Y[z],!R)}}function zn(Y,R){for(var z=0,W=0,Q=0,ue=Y.length,fe=ue-1;Q<ue;fe=Q++){var pe=(Y[Q][0]-Y[fe][0])*(Y[fe][1]+Y[Q][1]),he=z+pe;W+=Math.abs(z)>=Math.abs(pe)?z-he+pe:pe-he+z,z=he}z+W>=0!=!!R&&Y.reverse()}const mt=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class oi{constructor(R){this._feature=R,this.extent=h.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(1===this._feature.type){const R=[];for(const z of this._feature.geometry)R.push([new h.pointGeometry(z[0],z[1])]);return R}{const R=[];for(const z of this._feature.geometry){const W=[];for(const Q of z)W.push(new h.pointGeometry(Q[0],Q[1]));R.push(W)}return R}}toGeoJSON(R,z,W){return mt.call(this,R,z,W)}}class Ea{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=R.length,this._features=R}feature(R){return new oi(this._features[R])}}var Go=h.vectorTile.VectorTileFeature,eo=No;function No(Y,R){this.options=R||{},this.features=Y,this.length=Y.length}function yt(Y,R){this.id="number"==typeof Y.id?Y.id:void 0,this.type=Y.type,this.rawGeometry=1===Y.type?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=R||4096}No.prototype.feature=function(Y){return new yt(this.features[Y],this.options.extent)},yt.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var R=0;R<Y.length;R++){for(var z=Y[R],W=[],Q=0;Q<z.length;Q++)W.push(new h.pointGeometry(z[Q][0],z[Q][1]));this.geometry.push(W)}return this.geometry},yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,R=1/0,z=-1/0,W=1/0,Q=-1/0,ue=0;ue<Y.length;ue++)for(var fe=Y[ue],pe=0;pe<fe.length;pe++){var he=fe[pe];R=Math.min(R,he.x),z=Math.max(z,he.x),W=Math.min(W,he.y),Q=Math.max(Q,he.y)}return[R,W,z,Q]},yt.prototype.toGeoJSON=Go.prototype.toGeoJSON;var kn=tn,Er=eo;function tn(Y){var R=new h.pbf;return function(z,W){for(var Q in z.layers)W.writeMessage(3,to,z.layers[Q])}(Y,R),R.finish()}function to(Y,R){var z;R.writeVarintField(15,Y.version||1),R.writeStringField(1,Y.name||""),R.writeVarintField(5,Y.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<Y.length;z++)W.feature=Y.feature(z),R.writeMessage(2,Gt,W);var Q=W.keys;for(z=0;z<Q.length;z++)R.writeStringField(3,Q[z]);var ue=W.values;for(z=0;z<ue.length;z++)R.writeMessage(4,Es,ue[z])}function Gt(Y,R){var z=Y.feature;void 0!==z.id&&R.writeVarintField(1,z.id),R.writeMessage(2,$n,Y),R.writeVarintField(3,z.type),R.writeMessage(4,Ss,z)}function $n(Y,R){var z=Y.feature,W=Y.keys,Q=Y.values,ue=Y.keycache,fe=Y.valuecache;for(var pe in z.properties){var he=z.properties[pe],ge=ue[pe];if(null!==he){void 0===ge&&(W.push(pe),ue[pe]=ge=W.length-1),R.writeVarint(ge);var De=typeof he;"string"!==De&&"boolean"!==De&&"number"!==De&&(he=JSON.stringify(he));var We=De+":"+he,Oe=fe[We];void 0===Oe&&(Q.push(he),fe[We]=Oe=Q.length-1),R.writeVarint(Oe)}}}function Uo(Y,R){return(R<<3)+(7&Y)}function As(Y){return Y<<1^Y>>31}function Ss(Y,R){for(var z=Y.loadGeometry(),W=Y.type,Q=0,ue=0,fe=z.length,pe=0;pe<fe;pe++){var he=z[pe],ge=1;1===W&&(ge=he.length),R.writeVarint(Uo(1,ge));for(var De=3===W?he.length-1:he.length,We=0;We<De;We++){1===We&&1!==W&&R.writeVarint(Uo(2,De-1));var Oe=he[We].x-Q,rt=he[We].y-ue;R.writeVarint(As(Oe)),R.writeVarint(As(rt)),Q+=Oe,ue+=rt}3===W&&R.writeVarint(Uo(7,1))}}function Es(Y,R){var z=typeof Y;"string"===z?R.writeStringField(1,Y):"boolean"===z?R.writeBooleanField(7,Y):"number"===z&&(Y%1!=0?R.writeDoubleField(3,Y):Y<0?R.writeSVarintField(6,Y):R.writeVarintField(5,Y))}function dr(Y,R,z,W,Q,ue){if(Q-W<=z)return;const fe=W+Q>>1;io(Y,R,fe,W,Q,ue%2),dr(Y,R,z,W,fe-1,ue+1),dr(Y,R,z,fe+1,Q,ue+1)}function io(Y,R,z,W,Q,ue){for(;Q>W;){if(Q-W>600){const ge=Q-W+1,De=z-W+1,We=Math.log(ge),Oe=.5*Math.exp(2*We/3),rt=.5*Math.sqrt(We*Oe*(ge-Oe)/ge)*(De-ge/2<0?-1:1);io(Y,R,z,Math.max(W,Math.floor(z-De*Oe/ge+rt)),Math.min(Q,Math.floor(z+(ge-De)*Oe/ge+rt)),ue)}const fe=R[2*z+ue];let pe=W,he=Q;for(Bn(Y,R,W,z),R[2*Q+ue]>fe&&Bn(Y,R,W,Q);pe<he;){for(Bn(Y,R,pe,he),pe++,he--;R[2*pe+ue]<fe;)pe++;for(;R[2*he+ue]>fe;)he--}R[2*W+ue]===fe?Bn(Y,R,W,he):(he++,Bn(Y,R,he,Q)),he<=z&&(W=he+1),z<=he&&(Q=he-1)}}function Bn(Y,R,z,W){Tr(Y,z,W),Tr(R,2*z,2*W),Tr(R,2*z+1,2*W+1)}function Tr(Y,R,z){const W=Y[R];Y[R]=Y[z],Y[z]=W}function gn(Y,R,z,W){const Q=Y-z,ue=R-W;return Q*Q+ue*ue}kn.fromVectorTileJs=tn,kn.fromGeojsonVt=function(Y,R){R=R||{};var z={};for(var W in Y)z[W]=new eo(Y[W].features,R),z[W].name=W,z[W].version=R.version,z[W].extent=R.extent;return tn({layers:z})},kn.GeoJSONWrapper=Er;const jo=Y=>Y[0],ai=Y=>Y[1];class Bi{constructor(R,z=jo,W=ai,Q=64,ue=Float64Array){this.nodeSize=Q,this.points=R;const fe=R.length<65536?Uint16Array:Uint32Array,pe=this.ids=new fe(R.length),he=this.coords=new ue(2*R.length);for(let ge=0;ge<R.length;ge++)pe[ge]=ge,he[2*ge]=z(R[ge]),he[2*ge+1]=W(R[ge]);dr(pe,he,Q,0,pe.length-1,0)}range(R,z,W,Q){return function(ue,fe,pe,he,ge,De,We){const Oe=[0,ue.length-1,0],rt=[];let st,et;for(;Oe.length;){const ot=Oe.pop(),xt=Oe.pop(),Nt=Oe.pop();if(xt-Nt<=We){for(let tt=Nt;tt<=xt;tt++)st=fe[2*tt],et=fe[2*tt+1],st>=pe&&st<=ge&&et>=he&&et<=De&&rt.push(ue[tt]);continue}const Kt=Math.floor((Nt+xt)/2);st=fe[2*Kt],et=fe[2*Kt+1],st>=pe&&st<=ge&&et>=he&&et<=De&&rt.push(ue[Kt]);const jt=(ot+1)%2;(0===ot?pe<=st:he<=et)&&(Oe.push(Nt),Oe.push(Kt-1),Oe.push(jt)),(0===ot?ge>=st:De>=et)&&(Oe.push(Kt+1),Oe.push(xt),Oe.push(jt))}return rt}(this.ids,this.coords,R,z,W,Q,this.nodeSize)}within(R,z,W){return function(Q,ue,fe,pe,he,ge){const De=[0,Q.length-1,0],We=[],Oe=he*he;for(;De.length;){const rt=De.pop(),st=De.pop(),et=De.pop();if(st-et<=ge){for(let jt=et;jt<=st;jt++)gn(ue[2*jt],ue[2*jt+1],fe,pe)<=Oe&&We.push(Q[jt]);continue}const ot=Math.floor((et+st)/2),xt=ue[2*ot],Nt=ue[2*ot+1];gn(xt,Nt,fe,pe)<=Oe&&We.push(Q[ot]);const Kt=(rt+1)%2;(0===rt?fe-he<=xt:pe-he<=Nt)&&(De.push(et),De.push(ot-1),De.push(Kt)),(0===rt?fe+he>=xt:pe+he>=Nt)&&(De.push(ot+1),De.push(st),De.push(Kt))}return We}(this.ids,this.coords,R,z,W,this.nodeSize)}}const Zn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},cn=Math.fround||(Yn=new Float32Array(1),Y=>(Yn[0]=+Y,Yn[0]));var Yn;class pr{constructor(R){this.options=Wn(Object.create(Zn),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:z,minZoom:W,maxZoom:Q,nodeSize:ue}=this.options;z&&console.time("total time");const fe=`prepare ${R.length} points`;z&&console.time(fe),this.points=R;let pe=[];for(let he=0;he<R.length;he++)R[he].geometry&&pe.push(Ho(R[he],he));this.trees[Q+1]=new Bi(pe,mr,_n,ue,Float32Array),z&&console.timeEnd(fe);for(let he=Q;he>=W;he--){const ge=+Date.now();pe=this._cluster(pe,he),this.trees[he]=new Bi(pe,mr,_n,ue,Float32Array),z&&console.log("z%d: %d clusters in %dms",he,pe.length,+Date.now()-ge)}return z&&console.timeEnd("total time"),this}getClusters(R,z){let W=((R[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,R[1]));let ue=180===R[2]?180:((R[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)W=-180,ue=180;else if(W>ue){const De=this.getClusters([W,Q,180,fe],z),We=this.getClusters([-180,Q,ue,fe],z);return De.concat(We)}const pe=this.trees[this._limitZoom(z)],he=pe.range(fr(W),kr(fe),fr(ue),kr(Q)),ge=[];for(const De of he){const We=pe.points[De];ge.push(We.numPoints?Vn(We):this.points[We.index])}return ge}getChildren(R){const z=this._getOriginId(R),W=this._getOriginZoom(R),Q="No cluster with the specified id.",ue=this.trees[W];if(!ue)throw new Error(Q);const fe=ue.points[z];if(!fe)throw new Error(Q);const pe=this.options.radius/(this.options.extent*Math.pow(2,W-1)),he=ue.within(fe.x,fe.y,pe),ge=[];for(const De of he){const We=ue.points[De];We.parentId===R&&ge.push(We.numPoints?Vn(We):this.points[We.index])}if(0===ge.length)throw new Error(Q);return ge}getLeaves(R,z,W){const Q=[];return this._appendLeaves(Q,R,z=z||10,W=W||0,0),Q}getTile(R,z,W){const Q=this.trees[this._limitZoom(R)],ue=Math.pow(2,R),{extent:fe,radius:pe}=this.options,he=pe/fe,ge=(W-he)/ue,De=(W+1+he)/ue,We={features:[]};return this._addTileFeatures(Q.range((z-he)/ue,ge,(z+1+he)/ue,De),Q.points,z,W,ue,We),0===z&&this._addTileFeatures(Q.range(1-he/ue,ge,1,De),Q.points,ue,W,ue,We),z===ue-1&&this._addTileFeatures(Q.range(0,ge,he/ue,De),Q.points,-1,W,ue,We),We.features.length?We:null}getClusterExpansionZoom(R){let z=this._getOriginZoom(R)-1;for(;z<=this.options.maxZoom;){const W=this.getChildren(R);if(z++,1!==W.length)break;R=W[0].properties.cluster_id}return z}_appendLeaves(R,z,W,Q,ue){const fe=this.getChildren(z);for(const pe of fe){const he=pe.properties;if(he&&he.cluster?ue+he.point_count<=Q?ue+=he.point_count:ue=this._appendLeaves(R,he.cluster_id,W,Q,ue):ue<Q?ue++:R.push(pe),R.length===W)break}return ue}_addTileFeatures(R,z,W,Q,ue,fe){for(const pe of R){const he=z[pe],ge=he.numPoints;let De,We,Oe;if(ge)De=Ts(he),We=he.x,Oe=he.y;else{const et=this.points[he.index];De=et.properties,We=fr(et.geometry.coordinates[0]),Oe=kr(et.geometry.coordinates[1])}const rt={type:1,geometry:[[Math.round(this.options.extent*(We*ue-W)),Math.round(this.options.extent*(Oe*ue-Q))]],tags:De};let st;ge?st=he.id:this.options.generateId?st=he.index:this.points[he.index].id&&(st=this.points[he.index].id),void 0!==st&&(rt.id=st),fe.features.push(rt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(+R,this.options.maxZoom+1))}_cluster(R,z){const W=[],{radius:Q,extent:ue,reduce:fe,minPoints:pe}=this.options,he=Q/(ue*Math.pow(2,z));for(let ge=0;ge<R.length;ge++){const De=R[ge];if(De.zoom<=z)continue;De.zoom=z;const We=this.trees[z+1],Oe=We.within(De.x,De.y,he),rt=De.numPoints||1;let st=rt;for(const et of Oe){const ot=We.points[et];ot.zoom>z&&(st+=ot.numPoints||1)}if(st>rt&&st>=pe){let et=De.x*rt,ot=De.y*rt,xt=fe&&rt>1?this._map(De,!0):null;const Nt=(ge<<5)+(z+1)+this.points.length;for(const Kt of Oe){const jt=We.points[Kt];if(jt.zoom<=z)continue;jt.zoom=z;const tt=jt.numPoints||1;et+=jt.x*tt,ot+=jt.y*tt,jt.parentId=Nt,fe&&(xt||(xt=this._map(De,!0)),fe(xt,this._map(jt)))}De.parentId=Nt,W.push(no(et/st,ot/st,Nt,st,xt))}else if(W.push(De),st>1)for(const et of Oe){const ot=We.points[et];ot.zoom<=z||(ot.zoom=z,W.push(ot))}}return W}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,z){if(R.numPoints)return z?Wn({},R.properties):R.properties;const W=this.points[R.index].properties,Q=this.options.map(W);return z&&Q===W?Wn({},Q):Q}}function no(Y,R,z,W,Q){return{x:cn(Y),y:cn(R),zoom:1/0,id:z,parentId:-1,numPoints:W,properties:Q}}function Ho(Y,R){const[z,W]=Y.geometry.coordinates;return{x:cn(fr(z)),y:cn(kr(W)),zoom:1/0,index:R,parentId:-1}}function Vn(Y){return{type:"Feature",id:Y.id,properties:Ts(Y),geometry:{type:"Point",coordinates:[(R=Y.x,360*(R-.5)),Dt(Y.y)]}};var R}function Ts(Y){const R=Y.numPoints,z=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return Wn(Wn({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:R,point_count_abbreviated:z})}function fr(Y){return Y/360+.5}function kr(Y){const R=Math.sin(Y*Math.PI/180),z=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return z<0?0:z>1?1:z}function Dt(Y){const R=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function Wn(Y,R){for(const z in R)Y[z]=R[z];return Y}function mr(Y){return Y.x}function _n(Y){return Y.y}function yn(Y,R,z,W){for(var Q,ue=W,fe=z-R>>1,pe=z-R,he=Y[R],ge=Y[R+1],De=Y[z],We=Y[z+1],Oe=R+3;Oe<z;Oe+=3){var rt=ro(Y[Oe],Y[Oe+1],he,ge,De,We);if(rt>ue)Q=Oe,ue=rt;else if(rt===ue){var st=Math.abs(Oe-fe);st<pe&&(Q=Oe,pe=st)}}ue>W&&(Q-R>3&&yn(Y,R,Q,W),Y[Q+2]=ue,z-Q>3&&yn(Y,Q,z,W))}function ro(Y,R,z,W,Q,ue){var fe=Q-z,pe=ue-W;if(0!==fe||0!==pe){var he=((Y-z)*fe+(R-W)*pe)/(fe*fe+pe*pe);he>1?(z=Q,W=ue):he>0&&(z+=fe*he,W+=pe*he)}return(fe=Y-z)*fe+(pe=R-W)*pe}function kt(Y,R,z,W){var Q={id:void 0===Y?null:Y,type:R,geometry:z,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ue){var fe=ue.geometry,pe=ue.type;if("Point"===pe||"MultiPoint"===pe||"LineString"===pe)bi(ue,fe);else if("Polygon"===pe||"MultiLineString"===pe)for(var he=0;he<fe.length;he++)bi(ue,fe[he]);else if("MultiPolygon"===pe)for(he=0;he<fe.length;he++)for(var ge=0;ge<fe[he].length;ge++)bi(ue,fe[he][ge])}(Q),Q}function bi(Y,R){for(var z=0;z<R.length;z+=3)Y.minX=Math.min(Y.minX,R[z]),Y.minY=Math.min(Y.minY,R[z+1]),Y.maxX=Math.max(Y.maxX,R[z]),Y.maxY=Math.max(Y.maxY,R[z+1])}function Oi(Y,R,z,W){if(R.geometry){var Q=R.geometry.coordinates,ue=R.geometry.type,fe=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),pe=[],he=R.id;if(z.promoteId?he=R.properties[z.promoteId]:z.generateId&&(he=W||0),"Point"===ue)Xn(Q,pe);else if("MultiPoint"===ue)for(var ge=0;ge<Q.length;ge++)Xn(Q[ge],pe);else if("LineString"===ue)qo(Q,pe,fe,!1);else if("MultiLineString"===ue){if(z.lineMetrics){for(ge=0;ge<Q.length;ge++)qo(Q[ge],pe=[],fe,!1),Y.push(kt(he,"LineString",pe,R.properties));return}ks(Q,pe,fe,!1)}else if("Polygon"===ue)ks(Q,pe,fe,!0);else{if("MultiPolygon"!==ue){if("GeometryCollection"===ue){for(ge=0;ge<R.geometry.geometries.length;ge++)Oi(Y,{id:he,geometry:R.geometry.geometries[ge],properties:R.properties},z,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<Q.length;ge++){var De=[];ks(Q[ge],De,fe,!0),pe.push(De)}}Y.push(kt(he,ue,pe,R.properties))}}function Xn(Y,R){R.push(Ds(Y[0])),R.push(Is(Y[1])),R.push(0)}function qo(Y,R,z,W){for(var Q,ue,fe=0,pe=0;pe<Y.length;pe++){var he=Ds(Y[pe][0]),ge=Is(Y[pe][1]);R.push(he),R.push(ge),R.push(0),pe>0&&(fe+=W?(Q*ge-he*ue)/2:Math.sqrt(Math.pow(he-Q,2)+Math.pow(ge-ue,2))),Q=he,ue=ge}var De=R.length-3;R[2]=1,yn(R,0,De,z),R[De+2]=1,R.size=Math.abs(fe),R.start=0,R.end=R.size}function ks(Y,R,z,W){for(var Q=0;Q<Y.length;Q++){var ue=[];qo(Y[Q],ue,z,W),R.push(ue)}}function Ds(Y){return Y/360+.5}function Is(Y){var R=Math.sin(Y*Math.PI/180),z=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return z<0?0:z>1?1:z}function nn(Y,R,z,W,Q,ue,fe,pe){if(W/=R,ue>=(z/=R)&&fe<W)return Y;if(fe<z||ue>=W)return null;for(var he=[],ge=0;ge<Y.length;ge++){var De=Y[ge],We=De.geometry,Oe=De.type,rt=0===Q?De.minX:De.minY,st=0===Q?De.maxX:De.maxY;if(rt>=z&&st<W)he.push(De);else if(!(st<z||rt>=W)){var et=[];if("Point"===Oe||"MultiPoint"===Oe)xn(We,et,z,W,Q);else if("LineString"===Oe)oo(We,et,z,W,Q,!1,pe.lineMetrics);else if("MultiLineString"===Oe)vn(We,et,z,W,Q,!1);else if("Polygon"===Oe)vn(We,et,z,W,Q,!0);else if("MultiPolygon"===Oe)for(var ot=0;ot<We.length;ot++){var xt=[];vn(We[ot],xt,z,W,Q,!0),xt.length&&et.push(xt)}if(et.length){if(pe.lineMetrics&&"LineString"===Oe){for(ot=0;ot<et.length;ot++)he.push(kt(De.id,Oe,et[ot],De.tags));continue}"LineString"!==Oe&&"MultiLineString"!==Oe||(1===et.length?(Oe="LineString",et=et[0]):Oe="MultiLineString"),"Point"!==Oe&&"MultiPoint"!==Oe||(Oe=3===et.length?"Point":"MultiPoint"),he.push(kt(De.id,Oe,et,De.tags))}}}return he.length?he:null}function xn(Y,R,z,W,Q){for(var ue=0;ue<Y.length;ue+=3){var fe=Y[ue+Q];fe>=z&&fe<=W&&(R.push(Y[ue]),R.push(Y[ue+1]),R.push(Y[ue+2]))}}function oo(Y,R,z,W,Q,ue,fe){for(var pe,he,ge=$o(Y),De=0===Q?Vl:Ta,We=Y.start,Oe=0;Oe<Y.length-3;Oe+=3){var rt=Y[Oe],st=Y[Oe+1],et=Y[Oe+2],ot=Y[Oe+3],xt=Y[Oe+4],Nt=0===Q?rt:st,Kt=0===Q?ot:xt,jt=!1;fe&&(pe=Math.sqrt(Math.pow(rt-ot,2)+Math.pow(st-xt,2))),Nt<z?Kt>z&&(he=De(ge,rt,st,ot,xt,z),fe&&(ge.start=We+pe*he)):Nt>W?Kt<W&&(he=De(ge,rt,st,ot,xt,W),fe&&(ge.start=We+pe*he)):Dr(ge,rt,st,et),Kt<z&&Nt>=z&&(he=De(ge,rt,st,ot,xt,z),jt=!0),Kt>W&&Nt<=W&&(he=De(ge,rt,st,ot,xt,W),jt=!0),!ue&&jt&&(fe&&(ge.end=We+pe*he),R.push(ge),ge=$o(Y)),fe&&(We+=pe)}var tt=Y.length-3;rt=Y[tt],st=Y[tt+1],et=Y[tt+2],(Nt=0===Q?rt:st)>=z&&Nt<=W&&Dr(ge,rt,st,et),tt=ge.length-3,ue&&tt>=3&&(ge[tt]!==ge[0]||ge[tt+1]!==ge[1])&&Dr(ge,ge[0],ge[1],ge[2]),ge.length&&R.push(ge)}function $o(Y){var R=[];return R.size=Y.size,R.start=Y.start,R.end=Y.end,R}function vn(Y,R,z,W,Q,ue){for(var fe=0;fe<Y.length;fe++)oo(Y[fe],R,z,W,Q,ue,!1)}function Dr(Y,R,z,W){Y.push(R),Y.push(z),Y.push(W)}function Vl(Y,R,z,W,Q,ue){var fe=(ue-R)/(W-R);return Y.push(ue),Y.push(z+(Q-z)*fe),Y.push(1),fe}function Ta(Y,R,z,W,Q,ue){var fe=(ue-z)/(Q-z);return Y.push(R+(W-R)*fe),Y.push(ue),Y.push(1),fe}function ka(Y,R){for(var z=[],W=0;W<Y.length;W++){var Q,ue=Y[W],fe=ue.type;if("Point"===fe||"MultiPoint"===fe||"LineString"===fe)Q=Da(ue.geometry,R);else if("MultiLineString"===fe||"Polygon"===fe){Q=[];for(var pe=0;pe<ue.geometry.length;pe++)Q.push(Da(ue.geometry[pe],R))}else if("MultiPolygon"===fe)for(Q=[],pe=0;pe<ue.geometry.length;pe++){for(var he=[],ge=0;ge<ue.geometry[pe].length;ge++)he.push(Da(ue.geometry[pe][ge],R));Q.push(he)}z.push(kt(ue.id,fe,Q,ue.tags))}return z}function Da(Y,R){var z=[];z.size=Y.size,void 0!==Y.start&&(z.start=Y.start,z.end=Y.end);for(var W=0;W<Y.length;W+=3)z.push(Y[W]+R,Y[W+1],Y[W+2]);return z}function Ia(Y,R){if(Y.transformed)return Y;var z,W,Q,ue=1<<Y.z,fe=Y.x,pe=Y.y;for(z=0;z<Y.features.length;z++){var he=Y.features[z],ge=he.geometry,De=he.type;if(he.geometry=[],1===De)for(W=0;W<ge.length;W+=2)he.geometry.push(Gl(ge[W],ge[W+1],R,ue,fe,pe));else for(W=0;W<ge.length;W++){var We=[];for(Q=0;Q<ge[W].length;Q+=2)We.push(Gl(ge[W][Q],ge[W][Q+1],R,ue,fe,pe));he.geometry.push(We)}}return Y.transformed=!0,Y}function Gl(Y,R,z,W,Q,ue){return[Math.round(z*(Y*W-Q)),Math.round(z*(R*W-ue))]}function Fa(Y,R,z,W,Q){for(var ue=R===Q.maxZoom?0:Q.tolerance/((1<<R)*Q.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:W,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<Y.length;pe++){fe.numFeatures++,Oa(fe,Y[pe],ue,Q);var he=Y[pe].minX,ge=Y[pe].minY,De=Y[pe].maxX,We=Y[pe].maxY;he<fe.minX&&(fe.minX=he),ge<fe.minY&&(fe.minY=ge),De>fe.maxX&&(fe.maxX=De),We>fe.maxY&&(fe.maxY=We)}return fe}function Oa(Y,R,z,W){var Q=R.geometry,ue=R.type,fe=[];if("Point"===ue||"MultiPoint"===ue)for(var pe=0;pe<Q.length;pe+=3)fe.push(Q[pe]),fe.push(Q[pe+1]),Y.numPoints++,Y.numSimplified++;else if("LineString"===ue)Ir(fe,Q,Y,z,!1,!1);else if("MultiLineString"===ue||"Polygon"===ue)for(pe=0;pe<Q.length;pe++)Ir(fe,Q[pe],Y,z,"Polygon"===ue,0===pe);else if("MultiPolygon"===ue)for(var he=0;he<Q.length;he++){var ge=Q[he];for(pe=0;pe<ge.length;pe++)Ir(fe,ge[pe],Y,z,!0,0===pe)}if(fe.length){var De=R.tags||null;if("LineString"===ue&&W.lineMetrics){for(var We in De={},R.tags)De[We]=R.tags[We];De.mapbox_clip_start=Q.start/Q.size,De.mapbox_clip_end=Q.end/Q.size}var Oe={geometry:fe,type:"Polygon"===ue||"MultiPolygon"===ue?3:"LineString"===ue||"MultiLineString"===ue?2:1,tags:De};null!==R.id&&(Oe.id=R.id),Y.features.push(Oe)}}function Ir(Y,R,z,W,Q,ue){var fe=W*W;if(W>0&&R.size<(Q?fe:W))z.numPoints+=R.length/3;else{for(var pe=[],he=0;he<R.length;he+=3)(0===W||R[he+2]>fe)&&(z.numSimplified++,pe.push(R[he]),pe.push(R[he+1])),z.numPoints++;Q&&function(ge,De){for(var We=0,Oe=0,rt=ge.length,st=rt-2;Oe<rt;st=Oe,Oe+=2)We+=(ge[Oe]-ge[st])*(ge[Oe+1]+ge[st+1]);if(We>0===De)for(Oe=0,rt=ge.length;Oe<rt/2;Oe+=2){var et=ge[Oe],ot=ge[Oe+1];ge[Oe]=ge[rt-2-Oe],ge[Oe+1]=ge[rt-1-Oe],ge[rt-2-Oe]=et,ge[rt-1-Oe]=ot}}(pe,ue),Y.push(pe)}}function gr(Y,R){var z=(R=this.options=function(Q,ue){for(var fe in ue)Q[fe]=ue[fe];return Q}(Object.create(this.options),R)).debug;if(z&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var Q,ue,fe,pe,he,ge,W=function(Q,ue){var fe=[];if("FeatureCollection"===Q.type)for(var pe=0;pe<Q.features.length;pe++)Oi(fe,Q.features[pe],ue,pe);else Oi(fe,"Feature"===Q.type?Q:{geometry:Q},ue);return fe}(Y,R);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Q=W,ue=R,fe=ue.buffer/ue.extent,pe=Q,he=nn(Q,1,-1-fe,fe,0,-1,2,ue),ge=nn(Q,1,1-fe,2+fe,0,-1,2,ue),(he||ge)&&(pe=nn(Q,1,-fe,1+fe,0,-1,2,ue)||[],he&&(pe=ka(he,1).concat(pe)),ge&&(pe=pe.concat(ka(ge,-1)))),W=pe).length&&this.splitTile(W,0,0,0),z&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zo(Y,R,z){return 32*((1<<Y)*z+R)+Y}function Yo(Y,R){const z=Y.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const W=this._geoJSONIndex.getTile(z.z,z.x,z.y);if(!W)return R(null,null);const Q=new Ea(W.features);let ue=kn(Q);0===ue.byteOffset&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),R(null,{vectorTile:Q,rawData:ue.buffer})}gr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gr.prototype.splitTile=function(Y,R,z,W,Q,ue,fe){for(var pe=[Y,R,z,W],he=this.options,ge=he.debug;pe.length;){W=pe.pop(),z=pe.pop(),R=pe.pop(),Y=pe.pop();var De=1<<R,We=Zo(R,z,W),Oe=this.tiles[We];if(!Oe&&(ge>1&&console.time("creation"),Oe=this.tiles[We]=Fa(Y,R,z,W,he),this.tileCoords.push({z:R,x:z,y:W}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,z,W,Oe.numFeatures,Oe.numPoints,Oe.numSimplified),console.timeEnd("creation"));var rt="z"+R;this.stats[rt]=(this.stats[rt]||0)+1,this.total++}if(Oe.source=Y,Q){if(R===he.maxZoom||R===Q)continue;var st=1<<Q-R;if(z!==Math.floor(ue/st)||W!==Math.floor(fe/st))continue}else if(R===he.indexMaxZoom||Oe.numPoints<=he.indexMaxPoints)continue;if(Oe.source=null,0!==Y.length){ge>1&&console.time("clipping");var et,ot,xt,Nt,Kt,jt,tt=.5*he.buffer/he.extent,Ce=.5-tt,bn=.5+tt,pi=1+tt;et=ot=xt=Nt=null,Kt=nn(Y,De,z-tt,z+bn,0,Oe.minX,Oe.maxX,he),jt=nn(Y,De,z+Ce,z+pi,0,Oe.minX,Oe.maxX,he),Y=null,Kt&&(et=nn(Kt,De,W-tt,W+bn,1,Oe.minY,Oe.maxY,he),ot=nn(Kt,De,W+Ce,W+pi,1,Oe.minY,Oe.maxY,he),Kt=null),jt&&(xt=nn(jt,De,W-tt,W+bn,1,Oe.minY,Oe.maxY,he),Nt=nn(jt,De,W+Ce,W+pi,1,Oe.minY,Oe.maxY,he),jt=null),ge>1&&console.timeEnd("clipping"),pe.push(et||[],R+1,2*z,2*W),pe.push(ot||[],R+1,2*z,2*W+1),pe.push(xt||[],R+1,2*z+1,2*W),pe.push(Nt||[],R+1,2*z+1,2*W+1)}}},gr.prototype.getTile=function(Y,R,z){var W=this.options,Q=W.extent,ue=W.debug;if(Y<0||Y>24)return null;var fe=1<<Y,pe=Zo(Y,R=(R%fe+fe)%fe,z);if(this.tiles[pe])return Ia(this.tiles[pe],Q);ue>1&&console.log("drilling down to z%d-%d-%d",Y,R,z);for(var he,ge=Y,De=R,We=z;!he&&ge>0;)ge--,De=Math.floor(De/2),We=Math.floor(We/2),he=this.tiles[Zo(ge,De,We)];return he&&he.source?(ue>1&&console.log("found parent tile z%d-%d-%d",ge,De,We),ue>1&&console.time("drilling down"),this.splitTile(he.source,ge,De,We,Y,R,z),ue>1&&console.timeEnd("drilling down"),this.tiles[pe]?Ia(this.tiles[pe],Q):null):null};class Li extends h.VectorTileWorkerSource{constructor(R,z,W,Q,ue){super(R,z,W,Q,Yo),ue&&(this.loadGeoJSON=ue)}loadData(R,z){const W=R&&R.request,Q=W&&W.collectResourceTiming;this.loadGeoJSON(R,(ue,fe)=>{if(ue||!fe)return z(ue);if("object"!=typeof fe)return z(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{St(fe,!0);try{if(R.filter){const he=h.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===he.result)throw new Error(he.value.map(De=>`${De.key}: ${De.message}`).join(", "));const ge=fe.features.filter(De=>he.value.evaluate({zoom:0},De));fe={type:"FeatureCollection",features:ge}}this._geoJSONIndex=R.cluster?new pr(function({superclusterOptions:he,clusterProperties:ge}){if(!ge||!he)return he;const De={},We={},Oe={accumulated:null,zoom:0},rt={properties:null},st=Object.keys(ge);for(const et of st){const[ot,xt]=ge[et],Nt=h.createExpression(xt),Kt=h.createExpression("string"==typeof ot?[ot,["accumulated"],["get",et]]:ot);De[et]=Nt.value,We[et]=Kt.value}return he.map=et=>{rt.properties=et;const ot={};for(const xt of st)ot[xt]=De[xt].evaluate(Oe,rt);return ot},he.reduce=(et,ot)=>{rt.properties=ot;for(const xt of st)Oe.accumulated=et[xt],et[xt]=We[xt].evaluate(Oe,rt)},he}(R)).load(fe.features):new gr(he=fe,R.geojsonVtOptions)}catch(he){return z(he)}this.loaded={};const pe={};if(Q){const he=h.getPerformanceMeasurement(W);he&&(pe.resourceTiming={},pe.resourceTiming[R.source]=JSON.parse(JSON.stringify(he)))}z(null,pe)}var he})}reloadTile(R,z){const W=this.loaded;return W&&W[R.uid]?super.reloadTile(R,z):this.loadTile(R,z)}loadGeoJSON(R,z){if(R.request)h.getJSON(R.request,z);else{if("string"!=typeof R.data)return z(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));try{return z(null,JSON.parse(R.data))}catch{return z(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(R,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(W){z(W)}}getClusterChildren(R,z){try{z(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(W){z(W)}}getClusterLeaves(R,z){try{z(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(W){z(W)}}}class Fr{constructor(R){this.self=R,this.actor=new h.Actor(R,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=h.getProjection({name:"mercator"}),this.workerSourceTypes={vector:h.VectorTileWorkerSource,geojson:Li},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(z,W)=>{if(this.workerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.workerSourceTypes[z]=W},this.self.registerRTLTextPlugin=z=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=z.applyArabicShaping,h.plugin.processBidirectionalText=z.processBidirectionalText,h.plugin.processStyledBidirectionalText=z.processStyledBidirectionalText}}clearCaches(R,z,W){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R],W()}checkIfReady(R,z,W){W()}setReferrer(R,z){this.referrer=z}spriteLoaded(R,z){this.isSpriteLoaded[R]=z;for(const W in this.workerSources[R]){const Q=this.workerSources[R][W];for(const ue in Q)Q[ue]instanceof h.VectorTileWorkerSource&&(Q[ue].isSpriteLoaded=z,Q[ue].fire(new h.Event("isSpriteLoaded")))}}setImages(R,z,W){this.availableImages[R]=z;for(const Q in this.workerSources[R]){const ue=this.workerSources[R][Q];for(const fe in ue)ue[fe].availableImages=z}W()}enableTerrain(R,z,W){this.terrain=z,W()}setProjection(R,z){this.projections[R]=h.getProjection(z)}setLayers(R,z,W){this.getLayerIndex(R).replace(z),W()}updateLayers(R,z,W){this.getLayerIndex(R).update(z.layers,z.removedIds),W()}loadTile(R,z,W){const Q=this.enableTerrain?h.extend({enableTerrain:this.terrain},z):z;Q.projection=this.projections[R]||this.defaultProjection,this.getWorkerSource(R,z.type,z.source).loadTile(Q,W)}loadDEMTile(R,z,W){const Q=this.enableTerrain?h.extend({buildQuadTree:this.terrain},z):z;this.getDEMWorkerSource(R,z.source).loadTile(Q,W)}reloadTile(R,z,W){const Q=this.enableTerrain?h.extend({enableTerrain:this.terrain},z):z;Q.projection=this.projections[R]||this.defaultProjection,this.getWorkerSource(R,z.type,z.source).reloadTile(Q,W)}abortTile(R,z,W){this.getWorkerSource(R,z.type,z.source).abortTile(z,W)}removeTile(R,z,W){this.getWorkerSource(R,z.type,z.source).removeTile(z,W)}removeSource(R,z,W){if(!this.workerSources[R]||!this.workerSources[R][z.type]||!this.workerSources[R][z.type][z.source])return;const Q=this.workerSources[R][z.type][z.source];delete this.workerSources[R][z.type][z.source],void 0!==Q.removeSource?Q.removeSource(z,W):W()}loadWorkerSource(R,z,W){try{this.self.importScripts(z.url),W()}catch(Q){W(Q.toString())}}syncRTLPluginState(R,z,W){try{h.plugin.setState(z);const Q=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&null!=Q){this.self.importScripts(Q);const ue=h.plugin.isParsed();W(ue?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),ue)}}catch(Q){W(Q.toString())}}getAvailableImages(R){let z=this.availableImages[R];return z||(z=[]),z}getLayerIndex(R){let z=this.layerIndexes[R];return z||(z=this.layerIndexes[R]=new _i),z}getWorkerSource(R,z,W){return this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][z]||(this.workerSources[R][z]={}),this.workerSources[R][z][W]||(this.workerSources[R][z][W]=new this.workerSourceTypes[z]({send:(Q,ue,fe,pe,he,ge)=>{this.actor.send(Q,ue,fe,R,he,ge)},scheduler:this.actor.scheduler},this.getLayerIndex(R),this.getAvailableImages(R),this.isSpriteLoaded[R])),this.workerSources[R][z][W]}getDEMWorkerSource(R,z){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][z]||(this.demWorkerSources[R][z]=new Ue),this.demWorkerSources[R][z]}enforceCacheSizeLimit(R,z){h.enforceCacheSizeLimit(z)}getWorkerPerformanceMetrics(R,z,W){W(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Fr(self)),Fr}),ur(0,function(h){function Be(p,r){if(Array.isArray(p)){if(!Array.isArray(r)||p.length!==r.length)return!1;for(let c=0;c<p.length;c++)if(!Be(p[c],r[c]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==r){if("object"!=typeof r||Object.keys(p).length!==Object.keys(r).length)return!1;for(const c in p)if(!Be(p[c],r[c]))return!1;return!0}return p===r}var hr=_i;function _i(p){return r=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,x,v=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(v);try{x=new Worker(C),m=!0}catch{m=!1}return x&&x.terminate(),URL.revokeObjectURL(C),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var x=m.getContext("2d");if(!x)return!1;var v=x.getImageData(0,0,1,1);return v&&v.width===m.width}()||(void 0===Ue[c=r&&r.failIfMajorPerformanceCaveat]&&(Ue[c]=function(m){var x,C,A,E,v=(C=m,A=document.createElement("canvas"),(E=Object.create(_i.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,A.getContext("webgl",E)||A.getContext("experimental-webgl",E));if(!v)return!1;try{x=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!x||v.isContextLost())&&(v.shaderSource(x,"void main() {}"),v.compileShader(x),!0===v.getShaderParameter(x,v.COMPILE_STATUS))}(c)),!Ue[c]||document.documentMode));var r,c}var Ue={};function St(p,r,c){const m=h.window.document.createElement(p);return void 0!==r&&(m.className=r),c&&c.appendChild(m),m}function en(p,r,c){const m=h.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const x of Object.keys(r))m.setAttributeNS(null,x,r[x]);return c&&c.appendChild(m),m}_i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const zn=h.window.document&&h.window.document.documentElement.style,mt=zn&&void 0!==zn.userSelect?"userSelect":"WebkitUserSelect";let oi;function Ea(){zn&&mt&&(oi=zn[mt],zn[mt]="none")}function Go(){zn&&mt&&(zn[mt]=oi)}function eo(p){p.preventDefault(),p.stopPropagation(),h.window.removeEventListener("click",eo,!0)}function No(){h.window.addEventListener("click",eo,!0),h.window.setTimeout(()=>{h.window.removeEventListener("click",eo,!0)},0)}function yt(p,r){const c=p.getBoundingClientRect();return tn(p,c,r)}function kn(p,r){const c=p.getBoundingClientRect(),m=[];for(let x=0;x<r.length;x++)m.push(tn(p,c,r[x]));return m}function Er(p){return void 0!==h.window.InstallTrigger&&2===p.button&&p.ctrlKey&&h.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function tn(p,r,c){const m=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new h.pointGeometry((c.clientX-r.left)*m,(c.clientY-r.top)*m)}function to(p,r){var c=r[0],m=r[1],x=r[2],v=r[3],C=c*v-x*m;return C?(p[0]=v*(C=1/C),p[1]=-m*C,p[2]=-x*C,p[3]=c*C,p):null}function Gt(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class $n extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,c){this._validate(r,c)&&(this.images[r]=c)}_validate(r,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new h.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,c){if(!r)return!0;let m=0;for(const x of r){if(x[0]<m||x[1]<x[0]||c<x[1])return!1;m=x[1]}return!0}_validateContent(r,c){return!(r&&(4!==r.length||r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,c){c.version=this.images[r].version+1,this.images[r]=c,this.updatedImages[r]=!0}removeImage(r){const c=this.images[r];delete this.images[r],delete this.patterns[r],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,c){let m=!0;if(!this.isLoaded())for(const x of r)this.images[x]||(m=!1);this.isLoaded()||m?this._notify(r,c):this.requestors.push({ids:r,callback:c})}_notify(r,c){const m={};for(const x of r){this.images[x]||this.fire(new h.Event("styleimagemissing",{id:x}));const v=this.images[x];v?m[x]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:h.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:r,height:c}=this.atlasImage;return{width:r,height:c}}getPattern(r){const c=this.patterns[r],m=this.getImage(r);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const x={w:m.data.width+2,h:m.data.height+2,x:0,y:0},v=new h.ImagePosition(x,m);this.patterns[r]={bin:x,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const c=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.Texture(r,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:c,h:m}=h.potpack(r),x=this.atlasImage;x.resize({width:c||1,height:m||1});for(const v in this.patterns){const{bin:C}=this.patterns[v],A=C.x+1,E=C.y+1,D=this.images[v].data,I=D.width,P=D.height;h.RGBAImage.copy(D,x,{x:0,y:0},{x:A,y:E},{width:I,height:P}),h.RGBAImage.copy(D,x,{x:0,y:P-1},{x:A,y:E-1},{width:I,height:1}),h.RGBAImage.copy(D,x,{x:0,y:0},{x:A,y:E+P},{width:I,height:1}),h.RGBAImage.copy(D,x,{x:I-1,y:0},{x:A-1,y:E},{width:1,height:P}),h.RGBAImage.copy(D,x,{x:0,y:0},{x:A+I,y:E},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const c of r){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];Gt(m)&&this.updateImage(c,m)}}}const Uo=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(p,r){return function([c,m,x]){const v=h.degToRad(m+90),C=h.degToRad(x);return{x:c*Math.cos(v)*Math.sin(C),y:c*Math.sin(v)*Math.sin(C),z:c*Math.cos(C),azimuthal:m,polar:x}}(p.expression.evaluate(r))}interpolate(p,r,c){return{x:h.number(p.x,r.x,c),y:h.number(p.y,r.y,c),z:h.number(p.z,r.z,c),azimuthal:h.number(p.azimuthal,r.azimuthal,c),polar:h.number(p.polar,r.polar,c)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),As="-transition";class Ss extends h.Evented{constructor(r){super(),this._transitionable=new h.Transitionable(Uo),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c={}){if(!this._validate(h.validateLight,r,c))for(const m in r){const x=r[m];h.endsWith(m,As)?this._transitionable.setTransition(m.slice(0,-As.length),x):this._transitionable.setValue(m,x)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,m){return(!m||!1!==m.validate)&&h.emitValidationErrors(this,r.call(h.validateStyle,h.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}const Es=new h.Properties({source:new h.DataConstantProperty(h.spec.terrain.source),exaggeration:new h.DataConstantProperty(h.spec.terrain.exaggeration)}),dr="-transition";class io extends h.Evented{constructor(r,c){super(),this._transitionable=new h.Transitionable(Es),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(r){for(const c in r){const m=r[c];h.endsWith(c,dr)?this._transitionable.setTransition(c.slice(0,-dr.length),m):this._transitionable.setValue(c,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Bn(p,r,c,m){const x=h.smoothstep(45,65,c),[v,C]=Tr(p,m),A=h.length(r);let E=1-Math.min(1,Math.exp((A-v)/(C-v)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*x*p.alpha}function Tr(p,r){const c=.5/Math.tan(.5*r);return[p.range[0]+c,p.range[1]+c]}const gn=new h.Properties({range:new h.DataConstantProperty(h.spec.fog.range),color:new h.DataConstantProperty(h.spec.fog.color),"high-color":new h.DataConstantProperty(h.spec.fog["high-color"]),"space-color":new h.DataConstantProperty(h.spec.fog["space-color"]),"horizon-blend":new h.DataConstantProperty(h.spec.fog["horizon-blend"]),"star-intensity":new h.DataConstantProperty(h.spec.fog["star-intensity"])}),jo="-transition";class ai extends h.Evented{constructor(r,c){super(),this._transitionable=new h.Transitionable(gn),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const r=this._transform,c="globe"===r.projection.name,m=h.globeToMercatorTransition(r.zoom),x=this.properties.get("range"),v=[.5,3];return{range:c?[h.number(v[0],x[0],m),h.number(v[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c={}){if(!this._validate(h.validateFog,r,c)){for(const m of Object.keys(h.spec.fog))r&&void 0===r[m]&&(r[m]=h.spec.fog[m].default);for(const m in r){const x=r[m];h.endsWith(m,jo)?this._transitionable.setTransition(m.slice(0,-jo.length),x):this._transitionable.setValue(m,x)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:h.smoothstep(45,65,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(m,x,v){const C=h.MercatorCoordinate.fromLngLat(x),A=v.elevation?v.elevation.getAtPointOrZero(C):0,E=[C.x,C.y,A];return h.transformMat4(E,E,v.mercatorFogMatrix),Bn(m,E,v.pitch,v._fov)}(this.state,r,c):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Tr(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,m){return(!m||!1!==m.validate)&&h.emitValidationErrors(this,r.call(h.validateStyle,h.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class Bi{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const m=this.workerPool.acquire(this.id);for(let x=0;x<m.length;x++){const v=new Bi.Actor(m[x],c,this.id);v.name=`Worker ${x}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,m){h.asyncAll(this.actors,(x,v)=>{x.send(r,c,v)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Zn(p,r,c){return r*(h.EXTENT/(p.tileSize*Math.pow(2,c-p.tileID.overscaledZ)))}Bi.Actor=h.Actor;class cn{constructor(r,c,m,x){this.screenBounds=r,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(r,c){let m,x;if(r instanceof h.pointGeometry||"number"==typeof r[0]){const v=h.pointGeometry.convert(r);m=[h.pointGeometry.convert(r)],x=c.isPointAboveHorizon(v)}else{const v=h.pointGeometry.convert(r[0]),C=h.pointGeometry.convert(r[1]);m=[v,C],x=h.polygonizeBounds(v,C).every(A=>c.isPointAboveHorizon(A))}return new cn(m,c.getCameraPoint(),x,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return h.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],x=h.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),h.bufferConvexPolygon(x,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],x=h.polygonizeBounds(c,m,r),v=this.cameraPoint.clone();switch(3*((v.y>c.y)+(v.y>m.y))+((v.x>c.x)+(v.x>m.x))){case 0:x[0]=v,x[4]=v.clone();break;case 1:x.splice(1,0,v);break;case 2:x[1]=v;break;case 3:x.splice(4,0,v);break;case 5:x.splice(2,0,v);break;case 6:x[3]=v;break;case 7:x.splice(3,0,v);break;case 8:x[2]=v}return x}containsTile(r,c,m,x=0){const v=r.queryPadding/c._pixelsPerMercatorPixel+1,C=m?this._bufferedCameraMercator(v,c):this._bufferedScreenMercator(v,c);let A=r.tileID.wrap+(C.unwrapped?x:0);const E=C.polygon.map(H=>h.getTilePoint(r.tileTransform,H,A));if(!h.polygonIntersectsBox(E,0,0,h.EXTENT,h.EXTENT))return;A=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const D=this.screenGeometryMercator.polygon.map(H=>h.getTileVec3(r.tileTransform,H,A)),I=D.map(H=>new h.pointGeometry(H[0],H[1])),P=c.getFreeCameraOptions().position||new h.MercatorCoordinate(0,0,0),V=h.getTileVec3(r.tileTransform,P,A),$=D.map(H=>{const N=h.sub(H,H,V);return h.normalize(N,N),new h.Ray(V,N)}),U=Zn(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:$,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(j=h.getBounds(E),j.min.x=h.clamp(j.min.x,0,h.EXTENT),j.min.y=h.clamp(j.min.y,0,h.EXTENT),j.max.x=h.clamp(j.max.x,0,h.EXTENT),j.max.y=h.clamp(j.max.y,0,h.EXTENT),j),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:U};var j}_bufferedScreenMercator(r,c){const m=no(r);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(r,c){const m=no(r);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(r,c){const m=function(v,C){const A=h.multiply([],C.pixelMatrix,C.globeMatrix),E=[0,-h.GLOBE_RADIUS,0,1],D=[0,h.GLOBE_RADIUS,0,1],I=[0,0,0,1];h.transformMat4$1(E,E,A),h.transformMat4$1(D,D,A),h.transformMat4$1(I,I,A);const P=new h.pointGeometry(E[0]/E[3],E[1]/E[3]),V=new h.pointGeometry(D[0]/D[3],D[1]/D[3]),$=h.polygonContainsPoint(v,P)&&E[3]<I[3],U=h.polygonContainsPoint(v,V)&&D[3]<I[3];if(!$&&!U)return null;const j=function(se,re,de){for(let _e=1;_e<se.length;_e++){const Le=pr(re.pointCoordinate3D(se[_e-1]).x),me=pr(re.pointCoordinate3D(se[_e]).x);if(de<0){if(Le<me)return{idx:_e,t:-Le/(me-1-Le)}}else if(me<Le)return{idx:_e,t:(1-Le)/(me+1-Le)}}return null}(v,C,$?-1:1);if(!j)return null;const{idx:H,t:N}=j;let K=H>1?Yn(v.slice(0,H),C):[],Z=H<v.length?Yn(v.slice(H),C):[];K=K.map(se=>new h.pointGeometry(pr(se.x),se.y)),Z=Z.map(se=>new h.pointGeometry(pr(se.x),se.y));const ae=[...K];0===ae.length&&ae.push(Z[Z.length-1]);const oe=h.number(ae[ae.length-1].y,(0===Z.length?K[0]:Z[0]).y,N);let te;return te=$?[new h.pointGeometry(0,oe),new h.pointGeometry(0,0),new h.pointGeometry(1,0),new h.pointGeometry(1,oe)]:[new h.pointGeometry(1,oe),new h.pointGeometry(1,1),new h.pointGeometry(0,1),new h.pointGeometry(0,oe)],ae.push(...te),0===Z.length?ae.push(K[0]):ae.push(...Z),{polygon:ae.map(se=>new h.MercatorCoordinate(se.x,se.y)),unwrapped:!1}}(r,c);if(m)return m;const x=function(v,C){let A=!1,E=-1/0,D=0;for(let P=0;P<v.length-1;P++)v[P].x>E&&(E=v[P].x,D=P);for(let P=0;P<v.length-1;P++){const V=(D+P)%(v.length-1),$=v[V],U=v[V+1];Math.abs($.x-U.x)>.5&&($.x<U.x?($.x+=1,0===V&&(v[v.length-1].x+=1)):(U.x+=1,V+1===v.length-1&&(v[0].x+=1)),A=!0)}const I=h.mercatorXfromLng(C.center.lng);return A&&I<Math.abs(I-1)&&v.forEach(P=>{P.x-=1}),{polygon:v,unwrapped:A}}(Yn(r,c).map(v=>new h.pointGeometry(pr(v.x),v.y)),c);return{polygon:x.polygon.map(v=>new h.MercatorCoordinate(v.x,v.y)),unwrapped:x.unwrapped}}}function Yn(p,r){return h.resample(p,c=>{const m=r.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function pr(p){return p<0?1+p%1:p%1}function no(p){return 100*p|0}function Ho(p,r,c,m,x){const v=function(C,A){if(C)return x(C);if(A){const E=h.pick(h.extend(A,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(E.vectorLayers=A.vector_layers,E.vectorLayerIds=E.vectorLayers.map(D=>D.id)),A.language_options&&(E.languageOptions=A.language_options),A.language&&A.language[A.id]&&(E.language=A.language[A.id]),A.worldview_options&&(E.worldviewOptions=A.worldview_options),A.worldview?E.worldview=A.worldview[A.id]:A.worldview_default&&(E.worldview=A.worldview_default),E.tiles=r.canonicalizeTileset(E,p.url),x(null,E)}};return p.url?h.getJSON(r.transformRequest(r.normalizeSourceURL(p.url,null,c,m),h.ResourceType.Source),v):h.exported.frame(()=>v(null,p))}class Vn{constructor(r,c,m){this.bounds=h.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const c=Math.pow(2,r.z),m=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*c),x=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*c),v=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*c),C=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*c);return r.x>=m&&r.x<v&&r.y>=x&&r.y<C}}class Ts{constructor(r,c,m){this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kr{constructor(r,c,m,x){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let m=0;m<this.attributes.length;m++){const x=c.attributes[this.attributes[m].name];void 0!==x&&r.enableVertexAttribArray(x)}}setVertexAttribPointers(r,c,m){for(let x=0;x<this.attributes.length;x++){const v=this.attributes[x],C=c.attributes[v.name];void 0!==C&&r.vertexAttribPointer(C,v.components,r[fr[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wn extends Dt{getDefault(){return h.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class mr extends Dt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class _n extends Dt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class yn extends Dt{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ro extends Dt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class kt extends Dt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class bi extends Dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Oi extends Dt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Xn extends Dt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class qo extends Dt{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class ks extends Dt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ds extends Dt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Is extends Dt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class nn extends Dt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class xn extends Dt{getDefault(){return h.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class oo extends Dt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class $o extends Dt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class vn extends Dt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Dr extends Dt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Vl extends Dt{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Ta extends Dt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class ka extends Dt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Da extends Dt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Ia extends Dt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Gl extends Dt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Fa extends Dt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Oa extends Dt{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ir extends Dt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class gr extends Dt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Zo extends Dt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Yo extends Dt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Li extends Dt{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class Fr extends Li{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Y extends Li{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class R extends Y{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class z{constructor(r,c,m,x){this.context=r,this.width=c,this.height=m;const v=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Fr(r,v),x&&(this.depthAttachment=new Y(r,v))}destroy(){const r=this.context.gl,c=this.colorAttachment.get();if(c&&r.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class W{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Wn(this),this.clearDepth=new mr(this),this.clearStencil=new _n(this),this.colorMask=new yn(this),this.depthMask=new ro(this),this.stencilMask=new kt(this),this.stencilFunc=new bi(this),this.stencilOp=new Oi(this),this.stencilTest=new Xn(this),this.depthRange=new qo(this),this.depthTest=new ks(this),this.depthFunc=new Ds(this),this.blend=new Is(this),this.blendFunc=new nn(this),this.blendColor=new xn(this),this.blendEquation=new oo(this),this.cullFace=new $o(this),this.cullFaceSide=new vn(this),this.frontFace=new Dr(this),this.program=new Vl(this),this.activeTexture=new Ta(this),this.viewport=new ka(this),this.bindFramebuffer=new Da(this),this.bindRenderbuffer=new Ia(this),this.bindTexture=new Gl(this),this.bindVertexBuffer=new Fa(this),this.bindElementBuffer=new Oa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ir(this),this.pixelStoreUnpack=new gr(this),this.pixelStoreUnpackPremultiplyAlpha=new Zo(this),this.pixelStoreUnpackFlipY=new Yo(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c){return new Ts(this,r,c)}createVertexBuffer(r,c,m){return new kr(this,r,c,m)}createRenderbuffer(r,c,m){const x=this.gl,v=x.createRenderbuffer();return this.bindRenderbuffer.set(v),x.renderbufferStorage(x.RENDERBUFFER,r,c,m),this.bindRenderbuffer.set(null),v}createFramebuffer(r,c,m){return new z(this,r,c,m)}clear({color:r,depth:c,stencil:m}){const x=this.gl;let v=0;r&&(v|=x.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(v|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(v|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(v)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Be(r.blendFunction,h.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Q extends h.Evented{constructor(r,c,m,x){super(),this.id=r,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},c),h.extend(this,h.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ho(this._options,this.map._requestManager,null,null,(r,c)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new h.ErrorEvent(r)):c&&(h.extend(this,c),c.bounds&&(this.tileBounds=new Vn(c.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(c.tiles),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const m=h.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);r.request=h.getImage(this.map._requestManager.transformRequest(x,h.ResourceType.Tile),(v,C,A,E)=>(delete r.request,r.aborted?(r.state="unloaded",c(null)):v?(r.state="errored",c(v)):C?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:A,expires:E}),r.setTexture(C,this.map.painter),r.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(r,c,m){r.setTexture(c,m)}static unloadTileData(r,c){r.texture&&c.saveTileTexture(r.texture)}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c()}unloadTile(r,c){r.texture&&this.map.painter.saveTileTexture(r.texture),c()}hasTransition(){return!1}}let ue;function fe(p,r,c,m,x,v,C,A){const E=[p,c,x,r,m,v,1,1,1],D=[C,A,1],I=h.adjoint([],E),[P,V,$]=h.transformMat3(D,D,h.transpose(I,I));return h.multiply$1(E,[P,0,0,0,V,0,0,0,$],E)}class pe extends h.Evented{constructor(r,c,m,x){super(),this.id=r,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=c}load(r,c){this._loaded=c||!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(m,x)=>{if(this._loaded=!0,m)this.fire(new h.ErrorEvent(m));else if(x){const{HTMLImageElement:v}=h.window;this.image=x instanceof v?h.exported.getImageData(x):x,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const c=r.map(h.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let x=1/0,v=1/0,C=-1/0,A=-1/0;for(const P of m)x=Math.min(x,P.x),v=Math.min(v,P.y),C=Math.max(C,P.x),A=Math.max(A,P.y);const E=Math.max(C-x,A-v),D=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),I=Math.pow(2,D);return new h.CanonicalTileID(D,Math.floor((x+C)/2*I),Math.floor((v+A)/2*I))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const E in this.tiles){const D=this.tiles[E];"loaded"!==D.state&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const c=h.tileTransform(this.tileID,this.map.transform.projection),[m,x,v,C]=this.coordinates.map(E=>{const D=c.projection.project(E[0],E[1]);return h.getTilePoint(c,D)._round()});this.perspectiveTransform=function(E,D,I,P,V,$,U,j,H,N){const K=fe(0,0,E,0,0,D,E,D),Z=fe(I,P,V,$,U,j,H,N);return h.multiply$1(Z,h.adjoint(K,K),Z),[Z[6]/Z[8]*E/h.EXTENT,Z[7]/Z[8]*D/h.EXTENT]}(this.width,this.height,m.x,m.y,x.x,x.y,C.x,C.y,v.x,v.y);const A=this._boundsArray=new h.StructArrayLayout4i8;A.emplaceBack(m.x,m.y,0,0),A.emplaceBack(x.x,x.y,h.EXTENT,0),A.emplaceBack(C.x,C.y,0,h.EXTENT),A.emplaceBack(v.x,v.y,h.EXTENT,h.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(A,h.boundsAttributes.members),this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,c=r.gl;this.texture?this.texture.update(this.image):(this.texture=new h.Texture(r,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,c){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},c(null)):(r.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const he={vector:class extends h.Evented{constructor(p,r,c,m){if(super(),this.id=p,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(r,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new h.DedupedRequest}load(p){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"}));const r=this.language||this.map._language,c=this.worldview||this.map._worldview;this._tileJSONRequest=Ho(this._options,this.map._requestManager,r,c,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,m?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${r}`),c&&2!==c.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new h.ErrorEvent(m))):x&&(h.extend(this,x),x.bounds&&(this.tileBounds=new Vn(x.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.load(()=>{const r=this.map.style._getSourceCaches(this.id);for(const c of r)c.clearTiles()})}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}_setLanguage(p){return p===this.language||this.setSourceProperty(()=>{this.language=p}),this}_setWorldview(p){return p===this.worldview?this:this.worldviewOptions&&p&&!this.worldviewOptions[p]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${p}".`),this):(this.setSourceProperty(()=>{this.worldview=p}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(p,r){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,h.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=r:p.request=p.actor.send("reloadTile",m,x.bind(this));else if(p.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",m,x.bind(this),void 0,!0);else{const v=h.loadVectorTile.call({deduped:this._deduped},m,(C,A)=>{C||!A?x.call(this,C):(m.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},p.actor&&p.actor.send("loadTile",m,x.bind(this),void 0,!0))},!0);p.request={cancel:v}}function x(v,C){return delete p.request,p.aborted?r(null):v&&404!==v.status?r(v):(C&&C.resourceTiming&&(p.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&p.setExpiryData(C),p.loadVectorData(C,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Q,"raster-dem":class extends Q{constructor(p,r,c,m){super(p,r,c,m),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,v){x&&(p.state="errored",r(x)),v&&(p.dem=v,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=h.getImage(this.map._requestManager.transformRequest(c,h.ResourceType.Tile),function(x,v,C,A){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(x)p.state="errored",r(x);else if(v){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:C,expires:A});const E=h.window.ImageBitmap&&v instanceof h.window.ImageBitmap&&(null==ue&&(ue=h.window.OffscreenCanvas&&new h.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof h.window.createImageBitmap),ue),D=1-(v.width-h.prevPowerOfTwo(v.width))/2;D<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const I=E?v:h.exported.getImageData(v,D),P={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:D};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",P,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const r=p.canonical,c=Math.pow(2,r.z),m=(r.x-1+c)%c,x=0===r.x?p.wrap-1:p.wrap,v=(r.x+1+c)%c,C=r.x+1===c?p.wrap+1:p.wrap,A={};return A[new h.OverscaledTileID(p.overscaledZ,x,r.z,m,r.y).key]={backfilled:!1},A[new h.OverscaledTileID(p.overscaledZ,C,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(A[new h.OverscaledTileID(p.overscaledZ,x,r.z,m,r.y-1).key]={backfilled:!1},A[new h.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new h.OverscaledTileID(p.overscaledZ,C,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<c&&(A[new h.OverscaledTileID(p.overscaledZ,x,r.z,m,r.y+1).key]={backfilled:!1},A[new h.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new h.OverscaledTileID(p.overscaledZ,C,r.z,v,r.y+1).key]={backfilled:!1}),A}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends h.Evented{constructor(p,r,c,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=r.data,this._options=h.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const x=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*x,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*x,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:h.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*x,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},r),this}getClusterLeaves(p,r,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:r,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=h.extend({},this.workerOptions),r=this._data;"string"==typeof r?(p.request=this.map._requestManager.transformRequest(h.exported.resolveURL(r),h.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new h.ErrorEvent(c));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x.resourceTiming=m.resourceTiming[this.id]),this.fire(new h.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,r){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(c,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,x)=>(delete p.request,p.unloadVectorData(),p.aborted?r(null):m?r(m):(p.loadVectorData(x,this.map.painter,"reloadTile"===c),r(null))),void 0,"loadTile"===c)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pe{constructor(p,r,c,m){super(p,r,c,m),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,h.ResourceType.Source).url);h.getVideo(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new h.ErrorEvent(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new h.Texture(p,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pe,canvas:class extends pe{constructor(p,r,c,m){super(p,r,c,m),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(v=>"number"!=typeof v))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof h.window.HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof h.window.HTMLCanvasElement?this.options.canvas:h.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends h.Evented{constructor(p,r,c,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new h.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new h.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),h.extend(this,h.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return h.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:c,z:m}=p.canonical;return this._implementation.hasTile({x:r,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:c,y:m,z:x}=p.tileID.canonical,v=new h.window.AbortController,C=this._implementation.loadTile({x:c,y:m,z:x},{signal:v.signal});if(!C)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null);C.cancel=()=>v.abort(),p.request=C.then(function(A){return delete p.request,p.aborted?(p.state="unloaded",r(null)):A?(E=A)instanceof h.window.ImageData||E instanceof h.window.ImageBitmap||E instanceof h.window.HTMLCanvasElement?(this.loadTileData(p,A),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null));var E}.bind(this)).catch(A=>{20!==A.code&&(p.state="errored",r(A))})}loadTileData(p,r){Q.loadTileData(p,r,this._map.painter)}unloadTileData(p){Q.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:r,y:c,z:m}=p.tileID.canonical,x=this._implementation.prepareTile({x:r,y:c,z:m});return x?(this.loadTileData(p,x),p.state="loaded",x):null}unloadTile(p,r){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:c,y:m,z:x}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:x})}r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ge=function(p,r,c,m){const x=new he[r.type](p,r,c,m);if(x.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${x.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],x),x};function De(p,r){const c=h.identity([]);return h.scale(c,c,[.5*p.width,.5*-p.height,1]),h.translate(c,c,[1,-1,0]),h.multiply(c,c,p.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(c)}function We(p,r,c,m,x,v,C,A=!1){const E=p.tilesIn(m,C,A);E.sort(rt);const D=[];for(const P of E)D.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(r,c,p._state,P,x,v,De(p.transform,P.tile.tileID),A)});const I=function(P){const V={},$={};for(const U of P){const j=U.queryResults,H=U.wrappedTileID,N=$[H]=$[H]||{};for(const K in j){const Z=j[K],ae=N[K]=N[K]||{},oe=V[K]=V[K]||[];for(const te of Z)ae[te.featureIndex]||(ae[te.featureIndex]=!0,oe.push(te))}}return V}(D);for(const P in I)I[P].forEach(V=>{const $=V.feature,U=$.layer;U&&"background"!==U.type&&"sky"!==U.type&&($.source=U.source,U["source-layer"]&&($.sourceLayer=U["source-layer"]),$.state=void 0!==$.id?p.getFeatureState(U["source-layer"],$.id):{})});return I}function Oe(p,r){const c=p.getRenderableIds().map(v=>p.getTileByID(v)),m=[],x={};for(let v=0;v<c.length;v++){const C=c[v],A=C.tileID.canonical.key;x[A]||(x[A]=!0,C.querySourceFeatures(m,r))}return m}function rt(p,r){const c=p.tileID,m=r.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function st(){return null!=sa.workerClass?new sa.workerClass:new h.window.Worker(sa.workerUrl)}const et="mapboxgl_preloaded_worker_pool";class ot{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<ot.workerCount;)this.workers.push(new st);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[et]}numActive(){return Object.keys(this.active).length}}let xt;function Nt(){return xt||(xt=new ot),xt}function Kt(p,r){const c={};for(const m in p)"ref"!==m&&(c[m]=p[m]);return h.refProperties.forEach(m=>{m in r&&(c[m]=r[m])}),c}function jt(p){p=p.slice();const r=Object.create(null);for(let c=0;c<p.length;c++)r[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Kt(p[c],r[p[c].ref]));return p}ot.workerCount=2;const tt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ce(p,r,c){c.push({command:tt.addSource,args:[p,r[p]]})}function bn(p,r,c){r.push({command:tt.removeSource,args:[p]}),c[p]=!0}function pi(p,r,c,m){bn(p,c,m),Ce(p,r,c)}function Or(p,r,c){let m;for(m in p[c])if(p[c].hasOwnProperty(m)&&"data"!==m&&!Be(p[c][m],r[c][m]))return!1;for(m in r[c])if(r[c].hasOwnProperty(m)&&"data"!==m&&!Be(p[c][m],r[c][m]))return!1;return!0}function Fs(p,r,c,m,x,v){let C;for(C in r=r||{},p=p||{})p.hasOwnProperty(C)&&(Be(p[C],r[C])||c.push({command:v,args:[m,C,r[C],x]}));for(C in r)r.hasOwnProperty(C)&&!p.hasOwnProperty(C)&&(Be(p[C],r[C])||c.push({command:v,args:[m,C,r[C],x]}))}function Gn(p){return p.id}function Nl(p,r){return p[r.id]=r,p}class Ch{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=h.clamp(r,0,1);let c=1,m=this._distances[c];const x=r*this.paddedLength+this.padding;for(;m<x&&c<this._distances.length;)m=this._distances[++c];const v=c-1,C=this._distances[v],A=m-C,E=A>0?(x-C)/A:0;return this.points[v].mult(1-E).add(this.points[c].mult(E))}}class so{constructor(r,c,m){const x=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(c/m);for(let C=0;C<this.xCellCount*this.yCellCount;C++)x.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,m,x,v){this._forEachCell(c,m,x,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(v)}insertCircle(r,c,m,x){this._forEachCell(c-x,m-x,c+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(m),this.circles.push(x)}_insertBoxCell(r,c,m,x,v,C){this.boxCells[v].push(C)}_insertCircleCell(r,c,m,x,v,C){this.circleCells[v].push(C)}_query(r,c,m,x,v,C){if(m<0||r>this.width||x<0||c>this.height)return!v&&[];const A=[];if(r<=0&&c<=0&&this.width<=m&&this.height<=x){if(v)return!0;for(let E=0;E<this.boxKeys.length;E++)A.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const D=this.circles[3*E],I=this.circles[3*E+1],P=this.circles[3*E+2];A.push({key:this.circleKeys[E],x1:D-P,y1:I-P,x2:D+P,y2:I+P})}return C?A.filter(C):A}return this._forEachCell(r,c,m,x,this._queryCell,A,{hitTest:v,seenUids:{box:{},circle:{}}},C),v?A.length>0:A}_queryCircle(r,c,m,x,v){const C=r-m,A=r+m,E=c-m,D=c+m;if(A<0||C>this.width||D<0||E>this.height)return!x&&[];const I=[];return this._forEachCell(C,E,A,D,this._queryCellCircle,I,{hitTest:x,circle:{x:r,y:c,radius:m},seenUids:{box:{},circle:{}}},v),x?I.length>0:I}query(r,c,m,x,v){return this._query(r,c,m,x,!1,v)}hitTest(r,c,m,x,v){return this._query(r,c,m,x,!0,v)}hitTestCircle(r,c,m,x){return this._queryCircle(r,c,m,!0,x)}_queryCell(r,c,m,x,v,C,A,E){const D=A.seenUids,I=this.boxCells[v];if(null!==I){const V=this.bboxes;for(const $ of I)if(!D.box[$]){D.box[$]=!0;const U=4*$;if(r<=V[U+2]&&c<=V[U+3]&&m>=V[U+0]&&x>=V[U+1]&&(!E||E(this.boxKeys[$]))){if(A.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[$],x1:V[U],y1:V[U+1],x2:V[U+2],y2:V[U+3]})}}}const P=this.circleCells[v];if(null!==P){const V=this.circles;for(const $ of P)if(!D.circle[$]){D.circle[$]=!0;const U=3*$;if(this._circleAndRectCollide(V[U],V[U+1],V[U+2],r,c,m,x)&&(!E||E(this.circleKeys[$]))){if(A.hitTest)return C.push(!0),!0;{const j=V[U],H=V[U+1],N=V[U+2];C.push({key:this.circleKeys[$],x1:j-N,y1:H-N,x2:j+N,y2:H+N})}}}}}_queryCellCircle(r,c,m,x,v,C,A,E){const D=A.circle,I=A.seenUids,P=this.boxCells[v];if(null!==P){const $=this.bboxes;for(const U of P)if(!I.box[U]){I.box[U]=!0;const j=4*U;if(this._circleAndRectCollide(D.x,D.y,D.radius,$[j+0],$[j+1],$[j+2],$[j+3])&&(!E||E(this.boxKeys[U])))return C.push(!0),!0}}const V=this.circleCells[v];if(null!==V){const $=this.circles;for(const U of V)if(!I.circle[U]){I.circle[U]=!0;const j=3*U;if(this._circlesCollide($[j],$[j+1],$[j+2],D.x,D.y,D.radius)&&(!E||E(this.circleKeys[U])))return C.push(!0),!0}}}_forEachCell(r,c,m,x,v,C,A,E){const D=this._convertToXCellCoord(r),I=this._convertToYCellCoord(c),P=this._convertToXCellCoord(m),V=this._convertToYCellCoord(x);for(let $=D;$<=P;$++)for(let U=I;U<=V;U++)if(v.call(this,r,c,m,x,this.xCellCount*U+$,C,A,E))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,m,x,v,C){const A=x-r,E=v-c,D=m+C;return D*D>A*A+E*E}_circleAndRectCollide(r,c,m,x,v,C,A){const E=(C-x)/2,D=Math.abs(r-(x+E));if(D>E+m)return!1;const I=(A-v)/2,P=Math.abs(c-(v+I));if(P>I+m)return!1;if(D<=E||P<=I)return!0;const V=D-E,$=P-I;return V*V+$*$<=m*m}}const Xe=Math.tan(85*Math.PI/180);function Mt(p,r,c,m,x,v,C){const A=h.create();if(c)if("globe"===v.name){const E=h.calculateGlobeLabelMatrix(x,r);h.multiply(A,A,E)}else{const E=to([],C);A[0]=E[0],A[1]=E[1],A[4]=E[2],A[5]=E[3],m||h.rotateZ(A,A,x.angle)}else h.multiply(A,x.labelPlaneMatrix,p);return A}function Et(p,r,c,m,x,v,C){const A=Mt(p,r,c,m,x,v,C);return"globe"===v.name&&c||(A[2]=A[6]=A[10]=A[14]=0),A}function Dn(p,r,c,m,x,v,C){if(c){if("globe"===v.name){const A=Mt(p,r,c,m,x,v,C);return h.invert(A,A),h.multiply(A,p,A),A}{const A=h.clone(p),E=h.identity([]);return E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3],h.multiply(A,A,E),m||h.rotateZ(A,A,-x.angle),A}}return x.glCoordMatrix}function wn(p,r,c=0){const m=[p.x,p.y,c,1];c?h.transformMat4$1(m,m,r):un(m,m,r);const x=m[3];return{point:[m[0]/x,m[1]/x,m[2]/x],signedDistanceFromCamera:x}}function vt(p,r){const c=[p[0],p[1],p[2],1];h.transformMat4$1(c,c,r);const m=c[3];return{point:[c[0]/m,c[1]/m,c[2]/m],signedDistanceFromCamera:m}}function La(p,r){return Math.min(.5+p/r*.5,1.5)}function Os(p,r){const c=p[0]/p[3],m=p[1]/p[3];return c>=-r[0]&&c<=r[0]&&m>=-r[1]&&m<=r[1]}function _r(p,r,c,m,x,v,C,A,E,D){const I=c.transform,P=m?p.textSizeData:p.iconSizeData,V=h.evaluateSizeForZoom(P,c.transform.zoom),$="globe"===I.projection.name,U=[256/c.width*2+1,256/c.height*2+1],j=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;j.clear();let H=null;$&&(H=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const N=p.lineVertexArray,K=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,Z=c.transform.width/c.transform.height;let ae=!1;for(let oe=0;oe<K.length;oe++){const te=K.get(oe);if(te.writingMode!==h.WritingMode.vertical||ae||0!==oe&&K.get(oe-1).writingMode===h.WritingMode.horizontal||(ae=!0),(te.hidden||te.writingMode===h.WritingMode.vertical)&&!ae){lo(te.numGlyphs,j);continue}ae=!1;const se=new h.pointGeometry(te.tileAnchorX,te.tileAnchorY),re=E?E(se):[0,0,0],de=I.projection.projectTilePoint(se.x,se.y,D.canonical),_e=[de.x+re[0],de.y+re[1],de.z+re[2]],Le=[..._e,1];if(h.transformMat4$1(Le,Le,r),!Os(Le,U)){lo(te.numGlyphs,j);continue}const me=La(c.transform.cameraToCenterDistance,Le[3]),Ae=h.evaluateSizeForFeature(P,V,te),ke=C?Ae/me:Ae*me,Ge=wn(new h.pointGeometry(_e[0],_e[1]),x,_e[2]);if(Ge.signedDistanceFromCamera<=0){lo(te.numGlyphs,j);continue}let be={};const Pe=C?null:E,Te=Ul(te,ke,!1,A,r,x,v,p.glyphOffsetArray,N,j,H,Ge.point,se,be,Z,Pe,I.projection,D,C);ae=Te.useVertical,Pe&&Te.needsFlipping&&(be={}),(Te.notEnoughRoom||ae||Te.needsFlipping&&Ul(te,ke,!0,A,r,x,v,p.glyphOffsetArray,N,j,H,Ge.point,se,be,Z,Pe,I.projection,D,C).notEnoughRoom)&&lo(te.numGlyphs,j)}m?(p.text.dynamicLayoutVertexBuffer.updateData(j),H&&p.text.globeExtVertexBuffer.updateData(H)):(p.icon.dynamicLayoutVertexBuffer.updateData(j),H&&p.icon.globeExtVertexBuffer.updateData(H))}function Vi(p,r,c,m,x,v,C,A,E,D,I,P,V,$,U,j){const H=A.glyphStartIndex+A.numGlyphs,N=A.lineStartIndex,K=A.lineStartIndex+A.lineLength,Z=r.getoffsetX(A.glyphStartIndex),ae=r.getoffsetX(H-1),oe=Lr(p*Z,c,m,x,v,C,A.segment,N,K,E,D,I,P,V,!0,$,U,j);if(!oe)return null;const te=Lr(p*ae,c,m,x,v,C,A.segment,N,K,E,D,I,P,V,!0,$,U,j);return te?{first:oe,last:te}:null}function li(p,r,c,m){return p.writingMode===h.WritingMode.horizontal&&Math.abs(c.y-r.y)>Math.abs(c.x-r.x)*m?{useVertical:!0}:p.writingMode===h.WritingMode.vertical?r.y<c.y?{needsFlipping:!0}:null:0!==p.flipState&&function(x,v,C){const A=(v.x-x.x)*C;return 0===A||Math.abs((v.y-x.y)/A)>Xe}(r,c,m)?1===p.flipState?{needsFlipping:!0}:null:r.x>c.x?{needsFlipping:!0}:null}function Ul(p,r,c,m,x,v,C,A,E,D,I,P,V,$,U,j,H,N,K){const Z=r/24,ae=p.lineOffsetX*Z,oe=p.lineOffsetY*Z;let te;if(p.numGlyphs>1){const se=p.glyphStartIndex+p.numGlyphs,re=p.lineStartIndex,de=p.lineStartIndex+p.lineLength,_e=Vi(Z,A,ae,oe,c,P,V,p,E,v,$,j,!1,H,N,K);if(!_e)return{notEnoughRoom:!0};const Le=vt(_e.first.point,C).point,me=vt(_e.last.point,C).point,Ae=new h.pointGeometry(Le[0],Le[1]),ke=new h.pointGeometry(me[0],me[1]);if(m&&!c){const Ge=li(p,Ae,ke,U);if(p.flipState=Ge&&Ge.needsFlipping?1:2,Ge)return Ge}te=[_e.first];for(let Ge=p.glyphStartIndex+1;Ge<se-1;Ge++)te.push(Lr(Z*A.getoffsetX(Ge),ae,oe,c,P,V,p.segment,re,de,E,v,$,j,!1,!1,H,N,K));te.push(_e.last)}else{if(m&&!c){const re=wn(V,x).point,de=p.lineStartIndex+p.segment+1,_e=new h.pointGeometry(E.getx(de),E.gety(de)),Le=wn(_e,x),me=Le.signedDistanceFromCamera>0?Le.point:jl(V,_e,re,1,x,void 0,H,N.canonical),Ae=li(p,new h.pointGeometry(re[0],re[1]),new h.pointGeometry(me[0],me[1]),U);if(p.flipState=Ae&&Ae.needsFlipping?1:2,Ae)return Ae}const se=Lr(Z*A.getoffsetX(p.glyphStartIndex),ae,oe,c,P,V,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,E,v,$,j,!1,!1,H,N,K);if(!se)return{notEnoughRoom:!0};te=[se]}if(I)for(const se of te)h.updateGlobeVertexNormal(I,D.length+0,se.up[0],se.up[1],se.up[2]),h.updateGlobeVertexNormal(I,D.length+1,se.up[0],se.up[1],se.up[2]),h.updateGlobeVertexNormal(I,D.length+2,se.up[0],se.up[1],se.up[2]),h.updateGlobeVertexNormal(I,D.length+3,se.up[0],se.up[1],se.up[2]),h.addDynamicAttributes(D,se.point[0],se.point[1],se.point[2],se.angle);else for(const se of te)h.addDynamicAttributes(D,se.point[0],se.point[1],se.point[2],se.angle);return{}}function ao(p,r,c,m,x){const v=m.projectTilePoint(p.x,p.y,r);if(!x)return wn(v,c,v.z);const C=x(p);return wn(new h.pointGeometry(v.x+C[0],v.y+C[1]),c,v.z+C[2])}function jl(p,r,c,m,x,v,C,A){const E=ao(p.add(p.sub(r)._unit()),A,x,C,v).point,D=h.sub([],c,E);return h.scaleAndAdd([],c,D,m/h.length(D))}function Lr(p,r,c,m,x,v,C,A,E,D,I,P,V,$,U,j,H,N){const K=m?p-r:p+r;let Z=K>0?1:-1,ae=0;m&&(Z*=-1,ae=Math.PI),Z<0&&(ae+=Math.PI);let oe=Z>0?A+C:A+C+1,te=x,se=x,re=0,de=0;const _e=Math.abs(K),Le=[],me=[];let Ae=v;const ke=()=>{const Je=oe-Z;return 0===re?v:new h.pointGeometry(D.getx(Je),D.gety(Je))},Ge=()=>jl(ke(),Ae,se,_e-re+1,I,V,j,H.canonical);for(;re+de<=_e;){if(oe+=Z,oe<A||oe>=E)return null;if(se=te,Le.push(te),$&&me.push(Ae||ke()),te=P[oe],void 0===te){Ae=new h.pointGeometry(D.getx(oe),D.gety(oe));const Je=ao(Ae,H.canonical,I,j,V);te=Je.signedDistanceFromCamera>0?P[oe]=Je.point:Ge()}else Ae=null;re+=de,de=h.distance(se,te)}Ae=Ae||new h.pointGeometry(D.getx(oe),D.gety(oe));const be=ke();U&&V&&(P[oe]=te=void 0===P[oe]?te:Ge(),de=h.distance(se,te));const Pe=(_e-re)/de,Te=Ae.sub(be).mult(Pe)._add(be),$e=h.sub([],te,se),Ne=h.scaleAndAdd([],se,$e,Pe);let Qe=[0,0,1],nt=$e[0],lt=$e[1];if(N&&(Qe=j.upVector(H.canonical,Te.x,Te.y),0!==Qe[0]||0!==Qe[1]||1!==Qe[2])){const Je=[1,0,0],pt=[0,1,0];Je[0]=Qe[2],Je[1]=0,Je[2]=-Qe[0],h.cross(pt,Qe,Je),h.normalize(Je,Je),h.normalize(pt,pt),nt=h.dot($e,Je),lt=h.dot($e,pt)}if(c){const Je=h.cross([],Qe,$e);h.normalize(Je,Je),h.scaleAndAdd(Ne,Ne,Je,c*Z)}const Tt=ae+Math.atan2(lt,nt);return Le.push(Ne),$&&me.push(Te),{point:Ne,angle:Tt,path:Le,tilePath:me,up:Qe}}const Ra=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function lo(p,r){for(let c=0;c<p;c++){const m=r.length;r.resize(m+4),r.float32.set(Ra,4*m)}}function un(p,r,c){const m=r[0],x=r[1];return p[0]=c[0]*m+c[4]*x+c[12],p[1]=c[1]*m+c[5]*x+c[13],p[3]=c[3]*m+c[7]*x+c[15],p}const Jt=100;class ru{constructor(r,c,m=new so(r.width+200,r.height+200,25),x=new so(r.width+200,r.height+200,25)){this.transform=r,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Jt,this.screenBottomBoundary=r.height+Jt,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,m,x,v,C,A,E){let D=m.projectedAnchorX,I=m.projectedAnchorY,P=m.projectedAnchorZ;const V=m.elevation,$=m.tileID;if(V&&$){const oe=r.getProjection().upVector($.canonical,m.tileAnchorX,m.tileAnchorY),te=r.getProjection().upVectorScale($.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=oe[0]*V*te,I+=oe[1]*V*te,P+=oe[2]*V*te}const U=this.projectAndGetPerspectiveRatio(A,[D,I,P],m.tileID,"globe"===r.projection.name||!!V||this.transform.pitch>0,r.getProjection()),j=C*U.perspectiveRatio,H=(m.x1*c+x.x-m.padding)*j+U.point.x,N=(m.y1*c+x.y-m.padding)*j+U.point.y,K=(m.x2*c+x.x+m.padding)*j+U.point.x,Z=(m.y2*c+x.y+m.padding)*j+U.point.y,ae=U.perspectiveRatio<=.55||U.occluded;return!this.isInsideGrid(H,N,K,Z)||!v&&this.grid.hitTest(H,N,K,Z,E)||ae?{box:[],offscreen:!1,occluded:U.occluded}:{box:[H,N,K,Z],offscreen:this.isOffscreen(H,N,K,Z),occluded:!1}}placeCollisionCircles(r,c,m,x,v,C,A,E,D,I,P,V,$,U,j){const H=[],N=this.transform.elevation,K=N?N.getAtTileOffsetFunc(j,this.transform.center.lat,this.transform.worldSize,r.getProjection()):be=>[0,0,0],Z=new h.pointGeometry(m.tileAnchorX,m.tileAnchorY),ae=r.getProjection().projectTilePoint(m.tileAnchorX,m.tileAnchorY,j.canonical),oe=K(Z),te=[ae.x+oe[0],ae.y+oe[1],ae.z+oe[2]],se="globe"===r.projection.name,re=this.projectAndGetPerspectiveRatio(A,[te[0],te[1],te[2]],j,se||!!N||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:de}=re,_e=(P?C/de:C*de)/h.ONE_EM,Le=wn(new h.pointGeometry(te[0],te[1]),E,te[2]).point,me=re.signedDistanceFromCamera>0?Vi(_e,v,m.lineOffsetX*_e,m.lineOffsetY*_e,!1,Le,Z,m,x,E,{},N&&!P?K:null,P&&!!N,r.getProjection(),j,P):null;let Ae=!1,ke=!1,Ge=!0;if(me&&!re.occluded){const be=.5*$*de+U,Pe=new h.pointGeometry(-100,-100),Te=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),$e=new Ch,Ne=me.first,Qe=me.last;let nt=[];for(let Je=Ne.path.length-1;Je>=1;Je--)nt.push(Ne.path[Je]);for(let Je=1;Je<Qe.path.length;Je++)nt.push(Qe.path[Je]);const lt=2.5*be;if(D){const Je=nt.map(N&&!se?(pt,zt)=>{const si=K(zt<Ne.path.length-1?Ne.tilePath[Ne.path.length-1-zt]:Qe.tilePath[zt-Ne.path.length+2]);return pt[2]=si[2],vt(pt,D)}:pt=>vt(pt,D));nt=Je.some(pt=>pt.signedDistanceFromCamera<=0)?[]:Je.map(pt=>pt.point)}let Tt=[];if(nt.length>0){const Je=nt.map(Zt=>new h.pointGeometry(Zt[0],Zt[1]));let pt=1/0,zt=-1/0,si=1/0,yi=-1/0;for(let Zt=0;Zt<Je.length;Zt++)pt=Math.min(pt,Je[Zt].x),si=Math.min(si,Je[Zt].y),zt=Math.max(zt,Je[Zt].x),yi=Math.max(yi,Je[Zt].y);Tt=pt>=Pe.x&&zt<=Te.x&&si>=Pe.y&&yi<=Te.y?[Je]:zt<Pe.x||pt>Te.x||yi<Pe.y||si>Te.y?[]:h.clipLine([Je],Pe.x,Pe.y,Te.x,Te.y)}for(const Je of Tt){$e.reset(Je,.25*be);let pt=0;pt=$e.length<=.5*be?1:Math.ceil($e.paddedLength/lt)+1;for(let zt=0;zt<pt;zt++){const si=zt/Math.max(pt-1,1),yi=$e.lerp(si),Zt=yi.x+Jt,Ui=yi.y+Jt;H.push(Zt,Ui,be,0);const tr=Zt-be,ir=Ui-be,ri=Zt+be,ui=Ui+be;if(Ge=Ge&&this.isOffscreen(tr,ir,ri,ui),ke=ke||this.isInsideGrid(tr,ir,ri,ui),!c&&this.grid.hitTestCircle(Zt,Ui,be,V)&&(Ae=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ae,occluded:!1}}}}return{circles:!I&&Ae||!ke?[]:H,offscreen:Ge,collisionDetected:Ae,occluded:re.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,x=1/0,v=-1/0,C=-1/0;for(const I of r){const P=new h.pointGeometry(I.x+Jt,I.y+Jt);m=Math.min(m,P.x),x=Math.min(x,P.y),v=Math.max(v,P.x),C=Math.max(C,P.y),c.push(P)}const A=this.grid.query(m,x,v,C).concat(this.ignoredGrid.query(m,x,v,C)),E={},D={};for(const I of A){const P=I.key;if(void 0===E[P.bucketInstanceId]&&(E[P.bucketInstanceId]={}),E[P.bucketInstanceId][P.featureIndex])continue;const V=[new h.pointGeometry(I.x1,I.y1),new h.pointGeometry(I.x2,I.y1),new h.pointGeometry(I.x2,I.y2),new h.pointGeometry(I.x1,I.y2)];h.polygonIntersectsPolygon(c,V)&&(E[P.bucketInstanceId][P.featureIndex]=!0,void 0===D[P.bucketInstanceId]&&(D[P.bucketInstanceId]=[]),D[P.bucketInstanceId].push(P.featureIndex))}return D}insertCollisionBox(r,c,m,x,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,m,x,v){const C=c?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:x,collisionGroupID:v};for(let E=0;E<r.length;E+=4)C.insertCircle(A,r[E],r[E+1],r[E+2])}projectAndGetPerspectiveRatio(r,c,m,x,v){const C=[c[0],c[1],c[2],1];let A=!1;if(c[2]||this.transform.pitch>0){h.transformMat4$1(C,C,r);const E="globe"===v.name;this.fogState&&m&&!E&&(A=function(D,I,P,V,$,U){const j=U.calculateFogTileMatrix($),H=[I,P,V];return h.transformMat4(H,H,j),Bn(D,H,U.pitch,U._fov)}(this.fogState,c[0],c[1],c[2],m.toUnwrapped(),this.transform)>.9)}else un(C,C,r);return{point:new h.pointGeometry((C[0]/C[3]+1)/2*this.transform.width+Jt,(-C[1]/C[3]+1)/2*this.transform.height+Jt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/C[3]*.5,1.5),signedDistanceFromCamera:C[3],occluded:x&&C[2]>C[3]||A}}isOffscreen(r,c,m,x){return m<Jt||r>=this.screenRightBoundary||x<Jt||c>this.screenBottomBoundary}isInsideGrid(r,c,m,x){return m>=0&&r<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=h.identity([]);return h.translate(r,r,[-100,-100,0]),r}}function Ls(p,r,c){const m=r.createTileMatrix(p,p.worldSize,c.toUnwrapped());return h.multiply(new Float32Array(16),p.projMatrix,m)}function rn(p,r,c){if(r.projection.name===c.projection.name)return p.projMatrix;const m=c.clone();return m.setProjection(r.projection),Ls(m,r.getProjection(),p)}function hn(p,r,c){return r.name===c.projection.name?p.projMatrix:Ls(c,r,p)}class Pa{constructor(r,c,m,x){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):x&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class yr{constructor(r,c,m,x,v,C=!1){this.text=new Pa(r?r.text:null,c,m,v),this.icon=new Pa(r?r.icon:null,c,x,v),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wi{constructor(r,c,m,x=!1){this.text=r,this.icon=c,this.skipFade=m,this.clipped=x}}class Rs{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class za{constructor(r,c,m,x,v){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=v}}class Ps{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[r]}}function Gi(p,r,c,m,x){const{horizontalAlign:v,verticalAlign:C}=h.getAnchorAlignment(p),A=-(v-.5)*r,E=-(C-.5)*c,D=h.evaluateVariableOffset(p,m);return new h.pointGeometry(A+D[0]*x,E+D[1]*x)}function Wo(p,r,c,m,x){const v=new h.pointGeometry(p,r);return c&&v._rotate(m?x:-x),v}class Hl{constructor(r,c,m,x,v){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new ru(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Ps(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,m,x){const v=m.getBucket(c),C=m.latestFeatureIndex;if(!v||!C||c.id!==v.layerIds[0])return;const A=v.layers[0].layout,E=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),I=m.tileSize/h.EXTENT,P=m.tileID.toUnwrapped();this.transform.setProjection(v.projection);const V=($=m.tileID,U=v.getProjection(),j=this.transform,U.name===this.projection?j.calculateProjMatrix($.toUnwrapped()):Ls(j,U,$));var $,U,j;const H="map"===A.get("text-pitch-alignment"),N="map"===A.get("text-rotation-alignment");c.compileFilter();const K=c.dynamicFilter(),Z=c.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(m),oe=Et(V,m.tileID.canonical,H,N,this.transform,v.getProjection(),ae);let te=null;if(H){const de=Dn(V,m.tileID.canonical,H,N,this.transform,v.getProjection(),ae);te=h.multiply([],this.transform.labelPlaneMatrix,de)}let se=null;K&&m.latestFeatureIndex&&(se={unwrappedTileID:P,dynamicFilter:K,dynamicFilterNeedsFeature:Z,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new za(v.bucketInstanceId,C,v.sourceLayerIndex,v.index,m.tileID);const re={bucket:v,layout:A,posMatrix:V,textLabelPlaneMatrix:oe,labelToScreenMatrix:te,clippingData:se,scale:D,textPixelRatio:I,holdingForFade:m.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:h.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(x)for(const de of v.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Le,symbolInstanceEnd:me}=de;r.push({sortKey:_e,symbolInstanceStart:Le,symbolInstanceEnd:me,parameters:re})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:re})}attemptAnchorPlacement(r,c,m,x,v,C,A,E,D,I,P,V,$,U,j,H,N,K){const Z=[V.textOffset0,V.textOffset1],ae=Gi(r,m,x,Z,v),oe=this.collisionIndex.placeCollisionBox(U,v,c,Wo(ae.x,ae.y,C,A,this.transform.angle),P,E,D,I.predicate);if((!H||0!==this.collisionIndex.placeCollisionBox(U,U.getSymbolInstanceIconSize(K,this.transform.zoom,$),H,Wo(ae.x,ae.y,C,A,this.transform.angle),P,E,D,I.predicate).box.length)&&oe.box.length>0){let te;return this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(te=this.prevPlacement.variableOffsets[V.crossTileID].anchor),this.variableOffsets[V.crossTileID]={textOffset:Z,width:m,height:x,anchor:r,textScale:v,prevAnchor:te},this.markUsedJustification(U,r,V,j),U.allowVerticalPlacement&&(this.markUsedOrientation(U,j,V),this.placedOrientations[V.crossTileID]=j),{shift:ae,placedGlyphBoxes:oe}}}placeLayerBucketPart(r,c,m,x){const{bucket:v,layout:C,posMatrix:A,textLabelPlaneMatrix:E,labelToScreenMatrix:D,clippingData:I,textPixelRatio:P,holdingForFade:V,collisionBoxArray:$,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:j,collisionGroup:H}=r.parameters,N=C.get("text-optional"),K=C.get("icon-optional"),Z=C.get("text-allow-overlap"),ae=C.get("icon-allow-overlap"),oe="map"===C.get("text-rotation-alignment"),te="map"===C.get("text-pitch-alignment"),se="none"!==C.get("icon-text-fit"),re="viewport-y"===C.get("symbol-z-order");this.transform.setProjection(v.projection);let de=Z&&(ae||!v.hasIconData()||K),_e=ae&&(Z||!v.hasTextData()||N);!v.collisionArrays&&$&&v.deserializeCollisionBoxes($),m&&x&&v.updateCollisionDebugBuffers(this.transform.zoom,$);const Le=(me,Ae,ke)=>{if(I){const ri={zoom:this.transform.zoom,pitch:this.transform.pitch};let ui=null;if(I.dynamicFilterNeedsFeature){const At=this.retainedQueryData[v.bucketInstanceId];ui=I.featureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:At.bucketIndex,sourceLayerIndex:At.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(ri,ui,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new h.pointGeometry(me.tileAnchorX,me.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[me.crossTileID]=new wi(!1,!1,!1,!0),void(c[me.crossTileID]=!0)}if(c[me.crossTileID])return;if(V)return void(this.placements[me.crossTileID]=new wi(!1,!1,!1));let Ge=!1,be=!1,Pe=!0,Te=!1,$e=!1,Ne=null,Qe={box:null,offscreen:null,occluded:null},nt={box:null,offscreen:null,occluded:null},lt=null,Tt=null,Je=null,pt=0,zt=0,si=0;ke.textFeatureIndex?pt=ke.textFeatureIndex:me.useRuntimeCollisionCircles&&(pt=me.featureIndex),ke.verticalTextFeatureIndex&&(zt=ke.verticalTextFeatureIndex);const yi=ri=>{ri.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||ri.elevation)&&(ri.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,ri.tileAnchorX,ri.tileAnchorY):0)},Zt=ke.textBox;if(Zt){yi(Zt);const ri=At=>{let Si=h.WritingMode.horizontal;if(v.allowVerticalPlacement&&!At&&this.prevPlacement){const $i=this.prevPlacement.placedOrientations[me.crossTileID];$i&&(this.placedOrientations[me.crossTileID]=$i,Si=$i,this.markUsedOrientation(v,Si,me))}return Si},ui=(At,Si)=>{if(v.allowVerticalPlacement&&me.numVerticalGlyphVertices>0&&ke.verticalTextBox){for(const $i of v.writingModes)if($i===h.WritingMode.vertical?(Qe=Si(),nt=Qe):Qe=At(),Qe&&Qe.box&&Qe.box.length)break}else Qe=At()};if(C.get("text-variable-anchor")){let At=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]){const ti=this.prevPlacement.variableOffsets[me.crossTileID];At.indexOf(ti.anchor)>0&&(At=At.filter(on=>on!==ti.anchor),At.unshift(ti.anchor))}const Si=(ti,on,Co)=>{const sn=v.getSymbolInstanceTextSize(U,me,this.transform.zoom,Ae),Vr=(ti.x2-ti.x1)*sn+2*ti.padding,Gr=(ti.y2-ti.y1)*sn+2*ti.padding,Mo=se&&!ae?on:null;Mo&&yi(Mo);let an={box:[],offscreen:!1,occluded:!1};const Ao=Z?2*At.length:At.length;for(let Nr=0;Nr<Ao;++Nr){const aa=this.attemptAnchorPlacement(At[Nr%At.length],ti,Vr,Gr,sn,oe,te,P,A,H,Nr>=At.length,me,Ae,v,Co,Mo,U,j);if(aa&&(an=aa.placedGlyphBoxes,an&&an.box&&an.box.length)){Ge=!0,Ne=aa.shift;break}}return an};ui(()=>Si(Zt,ke.iconBox,h.WritingMode.horizontal),()=>{const ti=ke.verticalTextBox;return ti&&yi(ti),v.allowVerticalPlacement&&!(Qe&&Qe.box&&Qe.box.length)&&me.numVerticalGlyphVertices>0&&ti?Si(ti,ke.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Qe&&(Ge=Qe.box,Pe=Qe.offscreen,Te=Qe.occluded);const $i=ri(Qe&&Qe.box);if(!Ge&&this.prevPlacement){const ti=this.prevPlacement.variableOffsets[me.crossTileID];ti&&(this.variableOffsets[me.crossTileID]=ti,this.markUsedJustification(v,ti.anchor,me,$i))}}else{const At=(Si,$i)=>{const ti=v.getSymbolInstanceTextSize(U,me,this.transform.zoom,Ae),on=this.collisionIndex.placeCollisionBox(v,ti,Si,new h.pointGeometry(0,0),Z,P,A,H.predicate);return on&&on.box&&on.box.length&&(this.markUsedOrientation(v,$i,me),this.placedOrientations[me.crossTileID]=$i),on};ui(()=>At(Zt,h.WritingMode.horizontal),()=>{const Si=ke.verticalTextBox;return v.allowVerticalPlacement&&me.numVerticalGlyphVertices>0&&Si?(yi(Si),At(Si,h.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ri(Qe&&Qe.box&&Qe.box.length)}}if(lt=Qe,Ge=lt&&lt.box&&lt.box.length>0,Pe=lt&&lt.offscreen,Te=lt&&lt.occluded,me.useRuntimeCollisionCircles){const ri=v.text.placedSymbolArray.get(me.centerJustifiedTextSymbolIndex>=0?me.centerJustifiedTextSymbolIndex:me.verticalPlacedTextSymbolIndex),ui=h.evaluateSizeForFeature(v.textSizeData,U,ri),At=C.get("text-padding");Tt=this.collisionIndex.placeCollisionCircles(v,Z,ri,v.lineVertexArray,v.glyphOffsetArray,ui,A,E,D,m,te,H.predicate,me.collisionCircleDiameter*ui/h.ONE_EM,At,this.retainedQueryData[v.bucketInstanceId].tileID),Ge=Z||Tt.circles.length>0&&!Tt.collisionDetected,Pe=Pe&&Tt.offscreen,Te=Tt.occluded}if(ke.iconFeatureIndex&&(si=ke.iconFeatureIndex),ke.iconBox){const ri=ui=>{yi(ui);const At=se&&Ne?Wo(Ne.x,Ne.y,oe,te,this.transform.angle):new h.pointGeometry(0,0),Si=v.getSymbolInstanceIconSize(j,this.transform.zoom,Ae);return this.collisionIndex.placeCollisionBox(v,Si,ui,At,ae,P,A,H.predicate)};nt&&nt.box&&nt.box.length&&ke.verticalIconBox?(Je=ri(ke.verticalIconBox),be=Je.box.length>0):(Je=ri(ke.iconBox),be=Je.box.length>0),Pe=Pe&&Je.offscreen,$e=Je.occluded}const Ui=N||0===me.numHorizontalGlyphVertices&&0===me.numVerticalGlyphVertices,tr=K||0===me.numIconVertices;if(Ui||tr?tr?Ui||(be=be&&Ge):Ge=be&&Ge:be=Ge=be&&Ge,Ge&&lt&&lt.box&&this.collisionIndex.insertCollisionBox(lt.box,C.get("text-ignore-placement"),v.bucketInstanceId,nt&&nt.box&&zt?zt:pt,H.ID),be&&Je&&this.collisionIndex.insertCollisionBox(Je.box,C.get("icon-ignore-placement"),v.bucketInstanceId,si,H.ID),Tt&&(Ge&&this.collisionIndex.insertCollisionCircles(Tt.circles,C.get("text-ignore-placement"),v.bucketInstanceId,pt,H.ID),m)){const ri=v.bucketInstanceId;let ui=this.collisionCircleArrays[ri];void 0===ui&&(ui=this.collisionCircleArrays[ri]=new Rs);for(let At=0;At<Tt.circles.length;At+=4)ui.circles.push(Tt.circles[At+0]),ui.circles.push(Tt.circles[At+1]),ui.circles.push(Tt.circles[At+2]),ui.circles.push(Tt.collisionDetected?1:0)}const ir="globe"!==v.projection.name;de=de&&(ir||!Te),_e=_e&&(ir||!$e),this.placements[me.crossTileID]=new wi(Ge||de,be||_e,Pe||v.justReloaded),c[me.crossTileID]=!0};if(re){const me=v.getSortedSymbolIndexes(this.transform.angle);for(let Ae=me.length-1;Ae>=0;--Ae){const ke=me[Ae];Le(v.symbolInstances.get(ke),ke,v.collisionArrays[ke])}}else for(let me=r.symbolInstanceStart;me<r.symbolInstanceEnd;me++)Le(v.symbolInstances.get(me),me,v.collisionArrays[me]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[v.bucketInstanceId];h.invert(me.invProjMatrix,A),me.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,c,m,x){let v;v=x===h.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(c)];const C=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const A of C)A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=v>=0&&A!==v?0:m.crossTileID)}markUsedOrientation(r,c,m){const x=c===h.WritingMode.horizontal||c===h.WritingMode.horizontalOnly?c:0,v=c===h.WritingMode.vertical?c:0,C=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const A of C)r.text.placedSymbolArray.get(A).placedOrientation=x;m.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(r):1,v=c?c.opacities:{},C=c?c.variableOffsets:{},A=c?c.placedOrientations:{};for(const E in this.placements){const D=this.placements[E],I=v[E];I?(this.opacities[E]=new yr(I,x,D.text,D.icon,null,D.clipped),m=m||D.text!==I.text.placed||D.icon!==I.icon.placed):(this.opacities[E]=new yr(null,x,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const E in v){const D=v[E];if(!this.opacities[E]){const I=new yr(D,x,!1,!1);I.isHidden()||(this.opacities[E]=I,m=m||D.text.placed||D.icon.placed)}}for(const E in C)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=C[E]);for(const E in A)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=A[E]);m?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c){const m={};for(const x of c){const v=x.getBucket(r);v&&x.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,m,x.collisionBoxArray)}}updateBucketOpacities(r,c,m){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const x=r.layers[0].layout,v=!!r.layers[0].dynamicFilter(),C=new yr(null,0,!1,!1,!0),A=x.get("text-allow-overlap"),E=x.get("icon-allow-overlap"),D=x.get("text-variable-anchor"),I="map"===x.get("text-rotation-alignment"),P="map"===x.get("text-pitch-alignment"),V="none"!==x.get("icon-text-fit"),$=new yr(null,0,A&&(E||!r.hasIconData()||x.get("icon-optional")),E&&(A||!r.hasTextData()||x.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const U=(H,N,K)=>{for(let Z=0;Z<N/4;Z++)H.opacityVertexArray.emplaceBack(K)};let j=0;for(let H=0;H<r.symbolInstances.length;H++){const N=r.symbolInstances.get(H),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:Z,crossTileID:ae}=N;let oe=this.opacities[ae];c[ae]?oe=C:oe||(oe=$,this.opacities[ae]=oe),c[ae]=!0;const te=K>0||Z>0,se=N.numIconVertices>0,re=this.placedOrientations[N.crossTileID],de=re===h.WritingMode.vertical,_e=re===h.WritingMode.horizontal||re===h.WritingMode.horizontalOnly;if(!te&&!se||oe.isHidden()||j++,te){const Le=uo(oe.text);U(r.text,K,de?Mn:Le),U(r.text,Z,_e?Mn:Le);const me=oe.text.isHidden();[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach(Ge=>{Ge>=0&&(r.text.placedSymbolArray.get(Ge).hidden=me||de?1:0)}),N.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(N.verticalPlacedTextSymbolIndex).hidden=me||_e?1:0);const Ae=this.variableOffsets[N.crossTileID];Ae&&this.markUsedJustification(r,Ae.anchor,N,re);const ke=this.placedOrientations[N.crossTileID];ke&&(this.markUsedJustification(r,"left",N,ke),this.markUsedOrientation(r,ke,N))}if(se){const Le=uo(oe.icon);N.placedIconSymbolIndex>=0&&(U(r.icon,N.numIconVertices,de?Mn:Le),r.icon.placedSymbolArray.get(N.placedIconSymbolIndex).hidden=oe.icon.isHidden()),N.verticalPlacedIconSymbolIndex>=0&&(U(r.icon,N.numVerticalIconVertices,_e?Mn:Le),r.icon.placedSymbolArray.get(N.verticalPlacedIconSymbolIndex).hidden=oe.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Le=r.collisionArrays[H];if(Le){let me=new h.pointGeometry(0,0),Ae=!0;if(Le.textBox||Le.verticalTextBox){if(D){const Ge=this.variableOffsets[ae];Ge?(me=Gi(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textScale),I&&me._rotate(P?this.transform.angle:-this.transform.angle)):Ae=!1}v&&(Ae=!oe.clipped),Le.textBox&&Cn(r.textCollisionBox.collisionVertexArray,oe.text.placed,!Ae||de,me.x,me.y),Le.verticalTextBox&&Cn(r.textCollisionBox.collisionVertexArray,oe.text.placed,!Ae||_e,me.x,me.y)}const ke=Ae&&Boolean(!_e&&Le.verticalIconBox);Le.iconBox&&Cn(r.iconCollisionBox.collisionVertexArray,oe.icon.placed,ke,V?me.x:0,V?me.y:0),Le.verticalIconBox&&Cn(r.iconCollisionBox.collisionVertexArray,oe.icon.placed,!ke,V?me.x:0,V?me.y:0)}}}if(r.fullyClipped=0===j,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=H.invProjMatrix,r.placementViewportMatrix=H.viewportMatrix,r.collisionCircleArray=H.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function Cn(p,r,c,m,x){p.emplaceBack(r?1:0,c?1:0,m||0,x||0),p.emplaceBack(r?1:0,c?1:0,m||0,x||0),p.emplaceBack(r?1:0,c?1:0,m||0,x||0),p.emplaceBack(r?1:0,c?1:0,m||0,x||0)}const zs=Math.pow(2,25),Bs=Math.pow(2,24),ql=Math.pow(2,17),$l=Math.pow(2,16),co=Math.pow(2,9),Mh=Math.pow(2,8),Xo=Math.pow(2,1);function uo(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const r=p.placed?1:0,c=Math.floor(127*p.opacity);return c*zs+r*Bs+c*ql+r*$l+c*co+r*Mh+c*Xo+r}const Mn=0;class Ba{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,c,m,x,v){const C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(C,x,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((A,E)=>A.sortKey-E.sortKey));this._currentPartIndex<C.length;){const A=C[this._currentPartIndex];if(c.placeLayerBucketPart(A,this._seenCrossTileIDs,m,0===A.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class Kn{constructor(r,c,m,x,v,C,A,E){this.placement=new Hl(r,v,C,A,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(r,c,m){const x=h.exported.now(),v=()=>{const C=h.exported.now()-x;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=c[r[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===C.type&&(!C.minzoom||C.minzoom<=A)&&(!C.maxzoom||C.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Ba(C)),this._inProgressLayer.continuePlacement(m[C.source],this.placement,this._showCollisionBoxes,C,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Va=512/h.EXTENT/2;class Ga{constructor(r,c,m){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let x=0;x<c.length;x++){const v=c.get(x),C=v.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,r)})}}getScaledCoordinates(r,c){const m=Va/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*h.EXTENT+r.tileAnchorX)*m),y:Math.floor((c.canonical.y*h.EXTENT+r.tileAnchorY)*m)}}findMatches(r,c,m){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let v=0;v<r.length;v++){const C=r.get(v);if(C.crossTileID)continue;const A=this.indexedSymbolInstances[C.key];if(!A)continue;const E=this.getScaledCoordinates(C,c);for(const D of A)if(Math.abs(D.coord.x-E.x)<=x&&Math.abs(D.coord.y-E.y)<=x&&!m[D.crossTileID]){m[D.crossTileID]=!0,C.crossTileID=D.crossTileID;break}}}}class ou{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ah{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(0!==c)for(const m in this.indexes){const x=this.indexes[m],v={};for(const C in x){const A=x[C];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+c),v[A.tileID.key]=A}this.indexes[m]=v}this.lng=r}addBucket(r,c,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const x=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const C=this.indexes[v];if(Number(v)>r.overscaledZ)for(const A in C){const E=C[A];E.tileID.isChildOf(r)&&E.findMatches(c.symbolInstances,r,x)}else{const A=C[r.scaledTo(Number(v)).key];A&&A.findMatches(c.symbolInstances,r,x)}}for(let v=0;v<c.symbolInstances.length;v++){const C=c.symbolInstances.get(v);C.crossTileID||(C.crossTileID=m.generate(),x[C.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Ga(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const m in c.indexedSymbolInstances)for(const x of c.indexedSymbolInstances[m])delete this.usedCrossTileIDs[r][x.crossTileID]}removeStaleBuckets(r){let c=!1;for(const m in this.indexes){const x=this.indexes[m];for(const v in x)r[x[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[v]),delete x[v],c=!0)}return c}}class Vs{constructor(){this.layerIndexes={},this.crossTileIDs=new ou,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,m,x){let v=this.layerIndexes[r.id];void 0===v&&(v=this.layerIndexes[r.id]=new Ah);let C=!1;const A={};"globe"!==x.name&&v.handleWrapJump(m);for(const E of c){const D=E.getBucket(r);D&&r.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(E.tileID,D,this.crossTileIDs)&&(C=!0),A[D.bucketInstanceId]=!0)}return v.removeStaleBuckets(A)&&(C=!0),C}pruneUnusedLayers(r){const c={};r.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const Na=(p,r)=>h.emitValidationErrors(p,r&&r.filter(c=>"source.canvas"!==c.identifier)),Ua=h.pick(tt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Sh=h.pick(tt,["setCenter","setZoom","setBearing","setPitch"]),su={version:8,layers:[],sources:{}},au={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class In extends h.Evented{constructor(r,c={}){super(),this.map=r,this.dispatcher=new Bi(Nt(),this),this.imageManager=new $n,this.imageManager.setEventedParent(this),this.glyphManager=new h.GlyphManager(r._requestManager,c.localFontFamily?h.LocalGlyphMode.all:c.localIdeographFontFamily?h.LocalGlyphMode.ideographs:h.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new h.LineAtlas(256,512),this.crossTileSymbolIndex=new Vs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const m=this;this._rtlTextPluginCallback=In.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(v,C)=>{if(h.triggerPluginCompletionEvent(v),C&&C.every(A=>A))for(const A in m._sourceCaches){const E=m._sourceCaches[A],D=E.getSource().type;"vector"!==D&&"geojson"!==D||E.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const v=this.getSource(x.sourceId);if(v&&v.vectorLayerIds)for(const C in this._layers){const A=this._layers[C];A.source===v.id&&this._validateLayer(A)}})}loadURL(r,c={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!h.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,c.accessToken);const x=this.map._requestManager.transformRequest(r,h.ResourceType.Style);this._request=h.getJSON(x,(v,C)=>{this._request=null,v?this.fire(new h.ErrorEvent(v)):C&&this._load(C,m)})}loadJSON(r,c={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(r,!1!==c.validate)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(su,!1)}_updateLayerCount(r,c){const m=c?1:-1;r.is3D()&&(this._num3DLayers+=m),"circle"===r.type&&(this._numCircleLayers+=m),"symbol"===r.type&&(this._numSymbolLayers+=m)}_load(r,c){if(c&&Na(this,h.validateStyle(r)))return;this._loaded=!0,this.stylesheet=h.clone$1(r),this._updateMapProjection();for(const x in r.sources)this.addSource(x,r.sources[x],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const m=jt(this.stylesheet.layers);this._order=m.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of m)x=h.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ss(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(c,m,x){let v,C,A;const E=h.exported.devicePixelRatio>1?"@2x":"";let D=h.getJSON(m.transformRequest(m.normalizeSpriteURL(c,E,".json"),h.ResourceType.SpriteJSON),(V,$)=>{D=null,A||(A=V,v=$,P())}),I=h.getImage(m.transformRequest(m.normalizeSpriteURL(c,E,".png"),h.ResourceType.SpriteImage),(V,$)=>{I=null,A||(A=V,C=$,P())});function P(){if(A)x(A);else if(v&&C){const V=h.exported.getImageData(C),$={};for(const U in v){const{width:j,height:H,x:N,y:K,sdf:Z,pixelRatio:ae,stretchX:oe,stretchY:te,content:se}=v[U],re=new h.RGBAImage({width:j,height:H});h.RGBAImage.copy(V,re,{x:N,y:K},{x:0,y:0},{width:j,height:H}),$[U]={data:re,pixelRatio:ae,sdf:Z,stretchX:oe,stretchY:te,content:se}}x(null,$)}}return{cancel(){D&&(D.cancel(),D=null),I&&(I.cancel(),I=null)}}}(r,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new h.ErrorEvent(c));else if(m)for(const x in m)this.imageManager.addImage(x,m[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(r){const c=this.getSource(r.source);if(!c)return;const m=r.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new h.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const c=[];for(const m of r){const x=this._layers[m];"custom"!==x.type&&c.push(x.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&au[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const c=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(x.length||v.length)&&this._updateWorkerLayers(x,v);for(const C in this._updatedSources){const A=this._updatedSources[C];"reload"===A?this._reloadSource(C):"clear"===A&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const m={};for(const x in this._sourceCaches){const v=this._sourceCaches[x];m[x]=v.used,v.used=!1}for(const x of this._order){const v=this._layers[x];if(v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)){const A=this._getLayerSourceCache(v);A&&(A.used=!0)}const C=this.map.painter;if(C){const A=v.getProgramIds();if(!A)continue;const E=v.getProgramConfiguration(r.zoom);for(const D of A)C.useProgram(D,E)}}for(const x in m){const v=this._sourceCaches[x];m[x]!==v.used&&v.getSource().fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Na(this,h.validateStyle(r)))return!1;(r=h.clone$1(r)).layers=jt(r.layers);const c=function(x,v){if(!x)return[{command:tt.setStyle,args:[v]}];let C=[];try{if(!Be(x.version,v.version))return[{command:tt.setStyle,args:[v]}];Be(x.center,v.center)||C.push({command:tt.setCenter,args:[v.center]}),Be(x.zoom,v.zoom)||C.push({command:tt.setZoom,args:[v.zoom]}),Be(x.bearing,v.bearing)||C.push({command:tt.setBearing,args:[v.bearing]}),Be(x.pitch,v.pitch)||C.push({command:tt.setPitch,args:[v.pitch]}),Be(x.sprite,v.sprite)||C.push({command:tt.setSprite,args:[v.sprite]}),Be(x.glyphs,v.glyphs)||C.push({command:tt.setGlyphs,args:[v.glyphs]}),Be(x.transition,v.transition)||C.push({command:tt.setTransition,args:[v.transition]}),Be(x.light,v.light)||C.push({command:tt.setLight,args:[v.light]}),Be(x.fog,v.fog)||C.push({command:tt.setFog,args:[v.fog]}),Be(x.projection,v.projection)||C.push({command:tt.setProjection,args:[v.projection]});const A={},E=[];!function(P,V,$,U){let j;for(j in V=V||{},P=P||{})P.hasOwnProperty(j)&&(V.hasOwnProperty(j)||bn(j,$,U));for(j in V)V.hasOwnProperty(j)&&(P.hasOwnProperty(j)?Be(P[j],V[j])||("geojson"===P[j].type&&"geojson"===V[j].type&&Or(P,V,j)?$.push({command:tt.setGeoJSONSourceData,args:[j,V[j].data]}):pi(j,V,$,U)):Ce(j,V,$))}(x.sources,v.sources,E,A);const D=[];x.layers&&x.layers.forEach(P=>{P.source&&A[P.source]?C.push({command:tt.removeLayer,args:[P.id]}):D.push(P)});let I=x.terrain;I&&A[I.source]&&(C.push({command:tt.setTerrain,args:[void 0]}),I=void 0),C=C.concat(E),Be(I,v.terrain)||C.push({command:tt.setTerrain,args:[v.terrain]}),function(P,V,$){V=V||[];const U=(P=P||[]).map(Gn),j=V.map(Gn),H=P.reduce(Nl,{}),N=V.reduce(Nl,{}),K=U.slice(),Z=Object.create(null);let ae,oe,te,se,re,de,_e;for(ae=0,oe=0;ae<U.length;ae++)te=U[ae],N.hasOwnProperty(te)?oe++:($.push({command:tt.removeLayer,args:[te]}),K.splice(K.indexOf(te,oe),1));for(ae=0,oe=0;ae<j.length;ae++)te=j[j.length-1-ae],K[K.length-1-ae]!==te&&(H.hasOwnProperty(te)?($.push({command:tt.removeLayer,args:[te]}),K.splice(K.lastIndexOf(te,K.length-oe),1)):oe++,de=K[K.length-ae],$.push({command:tt.addLayer,args:[N[te],de]}),K.splice(K.length-ae,0,te),Z[te]=!0);for(ae=0;ae<j.length;ae++)if(te=j[ae],se=H[te],re=N[te],!Z[te]&&!Be(se,re))if(Be(se.source,re.source)&&Be(se["source-layer"],re["source-layer"])&&Be(se.type,re.type)){for(_e in Fs(se.layout,re.layout,$,te,null,tt.setLayoutProperty),Fs(se.paint,re.paint,$,te,null,tt.setPaintProperty),Be(se.filter,re.filter)||$.push({command:tt.setFilter,args:[te,re.filter]}),Be(se.minzoom,re.minzoom)&&Be(se.maxzoom,re.maxzoom)||$.push({command:tt.setLayerZoomRange,args:[te,re.minzoom,re.maxzoom]}),se)se.hasOwnProperty(_e)&&"layout"!==_e&&"paint"!==_e&&"filter"!==_e&&"metadata"!==_e&&"minzoom"!==_e&&"maxzoom"!==_e&&(0===_e.indexOf("paint.")?Fs(se[_e],re[_e],$,te,_e.slice(6),tt.setPaintProperty):Be(se[_e],re[_e])||$.push({command:tt.setLayerProperty,args:[te,_e,re[_e]]}));for(_e in re)re.hasOwnProperty(_e)&&!se.hasOwnProperty(_e)&&"layout"!==_e&&"paint"!==_e&&"filter"!==_e&&"metadata"!==_e&&"minzoom"!==_e&&"maxzoom"!==_e&&(0===_e.indexOf("paint.")?Fs(se[_e],re[_e],$,te,_e.slice(6),tt.setPaintProperty):Be(se[_e],re[_e])||$.push({command:tt.setLayerProperty,args:[te,_e,re[_e]]}))}else $.push({command:tt.removeLayer,args:[te]}),de=K[K.lastIndexOf(te)+1],$.push({command:tt.addLayer,args:[re,de]})}(D,v.layers,C)}catch(A){console.warn("Unable to compute style diff:",A),C=[{command:tt.setStyle,args:[v]}]}return C}(this.serialize(),r).filter(x=>!(x.command in Sh));if(0===c.length)return!1;const m=c.filter(x=>!(x.command in Ua));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);return c.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,c){return this.getImage(r)?this.fire(new h.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,c),this._afterImageUpdated(r),this)}updateImage(r,c){this.imageManager.updateImage(r,c)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new h.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,c,m={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(h.validateSource,`sources.${r}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=ge(r,c,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:x.serialize(),sourceId:r}));const v=C=>{const A=(C?"symbol:":"other:")+r,E=this._sourceCaches[A]=new h.SourceCache(A,x,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[r]=E,E.style=this,E.onAdd(this.map)};v(!1),"vector"!==c.type&&"geojson"!==c.type||v(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const c=this.getSource(r);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===r)return this.fire(new h.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new h.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(r);for(const x of m)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getSource(r).setData(c),this._changed=!0}getSource(r){const c=this._getSourceCache(r);return c&&c.getSource()}addLayer(r,c,m={}){this._checkLoaded();const x=r.id;if(this.getLayer(x))return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let v;if("custom"===r.type){if(Na(this,h.validateCustomStyleLayer(r)))return;v=h.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(x,r.source),r=h.clone$1(r),r=h.extend(r,{source:x})),this._validate(h.validateLayer,`layers.${x}`,r,{arrayIndex:-1},m))return;v=h.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const C=c?this._order.indexOf(c):this._order.length;if(c&&-1===C)return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(C,0,x),this._layerOrderChanged=!0,this._layers[x]=v;const A=this._getLayerSourceCache(v);if(this._removedLayers[x]&&v.source&&A&&"custom"!==v.type){const E=this._removedLayers[x];delete this._removedLayers[x],E.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",A.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,c){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new h.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===c)return;const m=this._order.indexOf(r);this._order.splice(m,1);const x=c?this._order.indexOf(c):this._order.length;c&&-1===x?this.fire(new h.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(x,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const c=this._layers[r];if(!c)return void this.fire(new h.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=c,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,m){this._checkLoaded();const x=this.getLayer(r);x?x.minzoom===c&&x.maxzoom===m||(null!=c&&(x.minzoom=c),null!=m&&(x.maxzoom=m),this._updateLayer(x)):this.fire(new h.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,c,m={}){this._checkLoaded();const x=this.getLayer(r);if(x){if(!Be(x.filter,c))return null==c?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(h.validateFilter,`layers.${x.id}.filter`,c,{layerType:x.type},m)||(x.filter=h.clone$1(c),this._updateLayer(x)))}else this.fire(new h.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const c=this.getLayer(r);return c&&h.clone$1(c.filter)}setLayoutProperty(r,c,m,x={}){this._checkLoaded();const v=this.getLayer(r);v?Be(v.getLayoutProperty(c),m)||(v.setLayoutProperty(c,m,x),this._updateLayer(v)):this.fire(new h.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,c){const m=this.getLayer(r);if(m)return m.getLayoutProperty(c);this.fire(new h.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,c,m,x={}){this._checkLoaded();const v=this.getLayer(r);v?Be(v.getPaintProperty(c),m)||(v.setPaintProperty(c,m,x)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new h.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,c){const m=this.getLayer(r);return m&&m.getPaintProperty(c)}setFeatureState(r,c){this._checkLoaded();const m=r.source,x=r.sourceLayer,v=this.getSource(m);if(!v)return void this.fire(new h.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const C=v.type;if("geojson"===C&&x)return void this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===C&&!x)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(m);for(const E of A)E.setFeatureState(x,r.id,c)}removeFeatureState(r,c){this._checkLoaded();const m=r.source,x=this.getSource(m);if(!x)return void this.fire(new h.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const v=x.type,C="vector"===v?r.sourceLayer:void 0;if("vector"===v&&!C)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(m);for(const E of A)E.removeFeatureState(C,r.id,c)}getFeatureState(r){this._checkLoaded();const c=r.source,m=r.sourceLayer,x=this.getSource(c);if(x){if("vector"!==x.type||m)return void 0===r.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,r.id);this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new h.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();r[m.id]||(r[m.id]=m.serialize())}return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(r){this._updatedLayers[r.id]=!0;const c=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[r.source]="reload",c.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=C=>"fill-extrusion"===this._layers[C].type,m={},x=[];for(let C=this._order.length-1;C>=0;C--){const A=this._order[C];if(c(A)){m[A]=C;for(const E of r){const D=E[A];if(D)for(const I of D)x.push(I)}}}x.sort((C,A)=>A.intersectionZ-C.intersectionZ);const v=[];for(let C=this._order.length-1;C>=0;C--){const A=this._order[C];if(c(A))for(let E=x.length-1;E>=0;E--){const D=x[E].feature;if(m[D.layer.id]<C)break;v.push(D),x.pop()}else for(const E of r){const D=E[A];if(D)for(const I of D)v.push(I.feature)}}return v}queryRenderedFeatures(r,c,m){c&&c.filter&&this._validate(h.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const x={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of c.layers){const D=this._layers[E];if(!D)return this.fire(new h.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];x[D.source]=!0}}const v=[];c.availableImages=this._availableImages;const C=c&&c.layers?c.layers.some(E=>{const D=this.getLayer(E);return D&&D.is3D()}):this.has3DLayers(),A=cn.createFromScreenPoints(r,m);for(const E in this._sourceCaches){const D=this._sourceCaches[E].getSource().id;c.layers&&!x[D]||v.push(We(this._sourceCaches[E],this._layers,this._serializedLayers,A,c,m,C,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(E,D,I,P,V,$,U){const j={},H=$.queryRenderedSymbols(P),N=[];for(const K of Object.keys(H).map(Number))N.push(U[K]);N.sort(rt);for(const K of N){const Z=K.featureIndex.lookupSymbolFeatures(H[K.bucketInstanceId],D,K.bucketIndex,K.sourceLayerIndex,V.filter,V.layers,V.availableImages,E);for(const ae in Z){const oe=j[ae]=j[ae]||[],te=Z[ae];te.sort((se,re)=>{const de=K.featureSortOrder;if(de){const _e=de.indexOf(se.featureIndex);return de.indexOf(re.featureIndex)-_e}return re.featureIndex-se.featureIndex});for(const se of te)oe.push(se)}}for(const K in j)j[K].forEach(Z=>{const ae=Z.feature,oe=I(E[K]).getFeatureState(ae.layer["source-layer"],ae.id);ae.source=ae.layer.source,ae.layer["source-layer"]&&(ae.sourceLayer=ae.layer["source-layer"]),ae.state=oe});return j}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,c){c&&c.filter&&this._validate(h.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(r);let x=[];for(const v of m)x=x.concat(Oe(v,c));return x}addSourceType(r,c,m){return In.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(In.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(r,c={}){this._checkLoaded();const m=this.light.getLight();let x=!1;for(const C in r)if(!Be(r[C],m[C])){x=!0;break}if(!x)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,c),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,c=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof r.source){const m="terrain-dem-src";this.addSource(m,r.source),r=h.clone$1(r),r=h.extend(r,{source:m})}if(this._validate(h.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(r,c);else{const m=this.terrain,x=m.get();for(const v of Object.keys(h.spec.terrain))!r.hasOwnProperty(v)&&h.spec.terrain[v].default&&(r[v]=h.spec.terrain[v].default);for(const v in r)if(!Be(r[v],x[v])){m.set(r),this.stylesheet.terrain=r;const C=this._setTransitionParameters({duration:0});m.updateTransitions(C);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new ai(r,this.map.transform);this.stylesheet.fog=r;const m=this._setTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();0===Object.keys(r).length&&c.set(r);for(const x in r)if(!Be(r[x],m[x])){c.set(r),this.stylesheet.fog=r;const v=this._setTransitionParameters({duration:0});c.updateTransitions(v);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:h.exported.now(),transition:h.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const m=this.terrain=new io(r,c);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"symbol"===c.type&&this._updateLayer(c)}}_validate(r,c,m,x,v={}){return(!v||!1!==v.validate)&&Na(this,r.call(h.validateStyle,h.extend({key:c,style:this.serialize(),value:m,styleSpec:h.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const c=this._getSourceCaches(r);for(const m of c)m.clearTiles()}_reloadSource(r){const c=this._getSourceCaches(r);for(const m of c)m.resume(),m.reload()}_updateSources(r){for(const c in this._sourceCaches)this._sourceCaches[c].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,m,x,v=!1){let C=!1,A=!1;const E={};for(const D of this._order){const I=this._layers[D];if("symbol"!==I.type)continue;if(!E[I.source]){const V=this._getLayerSourceCache(I);if(!V)continue;E[I.source]=V.getRenderableIds(!0).map($=>V.getTileByID($)).sort(($,U)=>U.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(U.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(I,E[I.source],r.center.lng,r.projection);C=C||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new h.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),r.zoom))&&(this.pauseablePlacement=new Kn(r,this._order,v,c,m,x,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),A=!0),C&&this.pauseablePlacement.placement.setStale()),A||C)for(const D of this._order){const I=this._layers[D];"symbol"===I.type&&this.placement.updateLayerOpacities(I,E[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const x=v=>{v&&v.setDependencies(c.tileID.key,c.type,c.icons)};x(this._otherSourceCaches[c.source]),x(this._symbolSourceCaches[c.source])}getGlyphs(r,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(r,c,m){return h.makeRequest(c,m)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this._getSourceCaches(r);return 0===c.length?(this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}In.getSourceType=function(p){return he[p]},In.setSourceType=function(p,r){he[p]=r},In.registerForPluginStateChange=h.registerForPluginStateChange;var lu="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Gs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Zl="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ja="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",ho="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Jn={},po={};const xr=[];vr(lu,xr),vr(Zl,xr),vr(ja,xr),vr(ho,xr),Jn=Lt("",Zl),po=Lt(ho,ja);const Ns=Lt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Us=lu,Ha="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var qa={background:Lt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Lt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Lt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Lt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Lt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Lt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Lt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Lt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Lt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Lt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Lt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Lt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Lt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Lt("uniform lowp vec3 u_lightpos;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvoid main() {vec4 color=v_color;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Lt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Lt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Lt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Lt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Lt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Lt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Lt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Lt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Lt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Lt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Lt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Lt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Gs),skyboxGradient:Lt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Gs),skyboxCapture:Lt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Lt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Lt("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function vr(p,r){const c=p.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of c)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const v of x)r.includes(v)||r.push(v)}}function Lt(p,r){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},v=[...xr];return vr(p,v),vr(r,v),{fragmentSource:p=p.replace(c,(C,A,E,D,I)=>(x[I]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${I}\nvarying ${E} ${D} ${I};\n#else\nuniform ${E} ${D} u_${I};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${I}\n    ${E} ${D} ${I} = u_${I};\n#endif\n`)),vertexSource:r=r.replace(c,(C,A,E,D,I)=>{const P="float"===D?"vec2":"vec4",V=I.match(/color/)?"color":P;return x[I]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${I}\nuniform lowp float u_${I}_t;\nattribute ${E} ${P} a_${I};\nvarying ${E} ${D} ${I};\n#else\nuniform ${E} ${D} u_${I};\n#endif\n`:"vec4"===V?`\n#ifndef HAS_UNIFORM_u_${I}\n    ${I} = a_${I};\n#else\n    ${E} ${D} ${I} = u_${I};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${I}\n    ${I} = unpack_mix_${V}(a_${I}, u_${I}_t);\n#else\n    ${E} ${D} ${I} = u_${I};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${I}\nuniform lowp float u_${I}_t;\nattribute ${E} ${P} a_${I};\n#else\nuniform ${E} ${D} u_${I};\n#endif\n`:"vec4"===V?`\n#ifndef HAS_UNIFORM_u_${I}\n    ${E} ${D} ${I} = a_${I};\n#else\n    ${E} ${D} ${I} = u_${I};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${I}\n    ${E} ${D} ${I} = unpack_mix_${V}(a_${I}, u_${I}_t);\n#else\n    ${E} ${D} ${I} = u_${I};\n#endif\n`}),staticAttributes:m,usedDefines:v}}class $a{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,m,x,v,C,A){this.context=r;let E=this.boundPaintVertexBuffers.length!==x.length;for(let I=0;!E&&I<x.length;I++)this.boundPaintVertexBuffers[I]!==x[I]&&(E=!0);let D=this.boundDynamicVertexBuffers.length!==A.length;for(let I=0;!D&&I<A.length;I++)this.boundDynamicVertexBuffers[I]!==A[I]&&(D=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||E||D||this.boundIndexBuffer!==v||this.boundVertexOffset!==C)this.freshBind(c,m,x,v,C,A);else{r.bindVertexArrayOES.set(this.vao);for(const I of A)I&&I.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(r,c,m,x,v,C){let A;const E=r.numAttributes,D=this.context,I=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=C;else{A=D.currentNumAttributes||0;for(let P=E;P<A;P++)I.disableVertexAttribArray(P)}c.enableAttributes(I,r),c.bind(),c.setVertexAttribPointers(I,r,v);for(const P of m)P.enableAttributes(I,r),P.bind(),P.setVertexAttribPointers(I,r,v);for(const P of C)P&&(P.enableAttributes(I,r),P.bind(),P.setVertexAttribPointers(I,r,v));x&&x.bind(),D.currentNumAttributes=E}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Za(p,r){const c=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new h.MercatorCoordinate(0,m/c).toLngLat().lat,new h.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function Yl(p,r,c,m,x,v,C){const A=p.context,E=A.gl,D=c.fbo;if(!D)return;p.prepareDrawTile();const I=p.useProgram("hillshade");A.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,D.colorAttachment.get());const P=((j,H,N,K)=>{const Z=N.paint.get("hillshade-shadow-color"),ae=N.paint.get("hillshade-highlight-color"),oe=N.paint.get("hillshade-accent-color");let te=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===N.paint.get("hillshade-illumination-anchor")&&(te-=j.transform.angle);const se=!j.options.moving;return{u_matrix:K||j.transform.calculateProjMatrix(H.tileID.toUnwrapped(),se),u_image:0,u_latrange:Za(0,H.tileID),u_light:[N.paint.get("hillshade-exaggeration"),te],u_shadow:Z,u_highlight:ae,u_accent:oe}})(p,c,m,p.terrain?r.projMatrix:null);p.prepareDrawProgram(A,I,r.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:$,tileBoundsSegments:U}=p.getTileBoundsBuffers(c);I.draw(A,E.TRIANGLES,x,v,C,h.CullFaceMode.disabled,P,m.id,V,$,U)}function It(p,r,c){if(!r.needsDEMTextureUpload)return;const m=p.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(c.stride);const v=c.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new h.Texture(m,v,x.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Ko(p,r,c,m,x,v){const C=p.context,A=C.gl;if(!r.dem)return;const E=r.dem;if(C.activeTexture.set(A.TEXTURE1),It(p,r,E),!r.demTexture)return;r.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const D=E.dim;C.activeTexture.set(A.TEXTURE0);let I=r.fbo;if(!I){const U=new h.Texture(C,{width:D,height:D,data:null},A.RGBA);U.bind(A.LINEAR,A.CLAMP_TO_EDGE),I=r.fbo=C.createFramebuffer(D,D,!0),I.colorAttachment.set(U.texture)}C.bindFramebuffer.set(I.framebuffer),C.viewport.set([0,0,D,D]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:V,tileBoundsSegments:$}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(C,A.TRIANGLES,m,x,v,h.CullFaceMode.disabled,((U,j)=>{const H=j.stride,N=h.create();return h.ortho(N,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(N,N,[0,-h.EXTENT,0]),{u_matrix:N,u_image:1,u_dimension:[H,H],u_zoom:U.overscaledZ,u_unpack:j.unpackVector}})(r.tileID,E),c.id,P,V,$),r.needsHillshadePrepare=!1}const Jo=p=>({u_matrix:new h.UniformMatrix4f(p),u_image0:new h.Uniform1i(p),u_skirt_height:new h.Uniform1f(p)}),Wl=(p,r)=>({u_matrix:p,u_image0:0,u_skirt_height:r}),Ya=(p,r,c,m,x,v,C,A,E,D,I,P,V,$)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:v,u_image0:0,u_frustum_tl:C,u_frustum_tr:A,u_frustum_br:E,u_frustum_bl:D,u_globe_pos:I,u_globe_radius:P,u_viewport:V,u_grid_matrix:$?Float32Array.from($):new Float32Array(9)});function cu(p,r){return null!=p&&null!=r&&!(!p.hasData()||!r.hasData())&&null!=p.demTexture&&null!=r.demTexture&&p.tileID.key!==r.tileID.key}const fo=new class{constructor(){this.operations={}}newMorphing(p,r,c,m,x){if(p in this.operations){const v=this.operations[p];v.to.tileID.key!==c.tileID.key&&(v.queued=c)}else this.operations[p]={startTime:m,phase:0,duration:x,from:r,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const c=this.operations[r];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Wa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Eh(p,r){const c=1<<p.z;return!r&&(0===p.x||p.x===c-1)||0===p.y||p.y===c-1}const uu=p=>({u_matrix:p});function Xa(p,r,c,m,x){if(x>0){const v=h.exported.now(),C=(v-p.timeAdded)/x,A=r?(v-r.timeAdded)/x:-1,E=c.getSource(),D=m.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),I=!r||Math.abs(r.tileID.overscaledZ-D)>Math.abs(p.tileID.overscaledZ-D),P=I&&p.refreshedUponExpiration?1:h.clamp(I?C:1-A,0,1);return p.refreshedUponExpiration&&C>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-P}:{opacity:P,mix:0}}return{opacity:1,mix:0}}class Xl extends h.SourceCache{constructor(r){const c={type:"raster-dem",maxzoom:r.transform.maxZoom},m=new Bi(Nt(),null),x=ge("mock-dem",c,m,r.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class hu extends h.SourceCache{constructor(r){const c=ge("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Bi(Nt(),null),r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,m){if(r.freezeTileCoverage)return;this.transform=r;const x=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,C)=>{if(v[C.key]="",!this._tiles[C.key]){const A=new h.Tile(C,this._source.tileSize*C.overscaleFactor(),r.tileZoom);A.state="loaded",this._tiles[C.key]=A}return v},{});for(const v in this._tiles)v in x||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const c=this.proxyCachedFBO[r];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Kl extends h.OverscaledTileID{constructor(r,c,m){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Th extends h.Elevation{constructor(r,c){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,v]=function(E){const D=new h.StructArrayLayout4i8,I=new h.StructArrayLayout3ui6,P=131;D.reserve(17161),I.reserve(33800);const V=h.EXTENT/128,$=h.EXTENT+V/2,U=$+V;for(let H=-V;H<U;H+=V)for(let N=-V;N<U;N+=V){const K=N<0||N>$||H<0||H>$?24575:0,Z=h.clamp(Math.round(N),0,h.EXTENT),ae=h.clamp(Math.round(H),0,h.EXTENT);D.emplaceBack(Z+K,ae,Z,ae)}const j=(H,N)=>{const K=N*P+H;I.emplaceBack(K+1,K,K+P),I.emplaceBack(K+P,K+P+1,K+1)};for(let H=1;H<129;H++)for(let N=1;N<129;N++)j(N,H);return[0,129].forEach(H=>{for(let N=0;N<130;N++)j(N,H),j(H,N)}),[D,I,32768]}(),C=r.context;this.gridBuffer=C.createVertexBuffer(m,h.boundsAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(x),this.gridSegments=h.SegmentVector.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=h.SegmentVector.simpleSegment(0,0,m.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hu(c.map),this.orthoMatrix=h.create(),h.ortho(this.orthoMatrix,0,h.EXTENT,0,h.EXTENT,0,1);const A=C.gl;this._overlapStencilMode=new h.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Xl(c.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,c,m){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const x=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const v=()=>{this.sourceCache.used&&h.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(c,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),c.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&h.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(E=>{const D=c.getTileByID(E).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(E,D){const I=D.transform.pointCoordinate(D.transform.getCameraPoint()),P=new h.pointGeometry(I.x,I.y);E.sort((V,$)=>{if($.overscaledZ-V.overscaledZ)return $.overscaledZ-V.overscaledZ;const U=new h.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),j=new h.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),H=P.mult(1<<V.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(U)-H.distSqr(j)})})(x,this.painter),this._previousZoom=m.zoom;const v=this.proxyToSource||{};this.proxyToSource={},x.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const E in C){const D=C[E];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,r[E],v),D.usedForTerrain))continue;const I=r[E];D.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[c.id]=x.map(E=>new Kl(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=h.exported.now();const A={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const D=this.terrainTileForTile[E.key];if(!D)continue;const I=D.tileID.key;I in A||(this._visibleDemTiles.push(D),A[I]=I)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],v=x.dem;!v||x.demTexture&&!x.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),It(this.painter,x,v))}}_prepareDemTileUniforms(r,c,m,x){if(!c||null==c.demTexture)return!1;const v=r.tileID.canonical,C=Math.pow(2,c.tileID.canonical.z-v.z),A=x||"";return m[`u_dem_tl${A}`]=[v.x*C%1,v.y*C%1],m[`u_dem_scale${A}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,c=r.gl;if(!this._emptyDepthBufferTexture){const m=new h.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new h.Texture(r,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const c=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const v=x.dem.tree.minimums[0];return v>0&&r++,m+v},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new h.RGBAImage({width:1,height:1},new Uint8Array(h.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(x,{premultiply:!1}):v=this._emptyDEMTexture=new h.Texture(r,x,c.RGBA,{premultiply:!1}),v}setupElevationDraw(r,c,m){const x=this.painter.context,v=x.gl,C=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:h.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();const E=this.painter.transform,D=E.projection,I=r.tileID.canonical;C.u_tile_tl_up=D.upVector(I,0,0),C.u_tile_tr_up=D.upVector(I,h.EXTENT,0),C.u_tile_br_up=D.upVector(I,h.EXTENT,h.EXTENT),C.u_tile_bl_up=D.upVector(I,0,h.EXTENT),C.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?h.GLOBE_METERS_TO_ECEF:D.upVectorScale(I,E.center.lat,E.worldSize).metersToTile;let P=null,V=null,$=1;if(m&&m.morphing&&this._useVertexMorphing){const U=m.morphing.srcDemTile,j=m.morphing.dstDemTile;$=m.morphing.phase,U&&j&&(this._prepareDemTileUniforms(r,U,C,"_prev")&&(V=U),this._prepareDemTileUniforms(r,j,C)&&(P=j))}if(V&&P?(x.activeTexture.set(v.TEXTURE2),P.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),x.activeTexture.set(v.TEXTURE4),V.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),C.u_dem_lerp=$):(P=this.terrainTileForTile[r.tileID.key],x.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(r,P,C)?P.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),x.activeTexture.set(v.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&P){const U=(1<<P.tileID.canonical.z)*h.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=U}m&&m.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(x,C)}renderToBackBuffer(r){const c=this.painter,m=this.painter.context;0!==r.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,v,C,A,E){if("globe"===x.transform.projection.name)!function(D,I,P,V,$){const U=D.context,j=U.gl;let H,N;const K=D.options.showTerrainWireframe?2:0,Z=D.transform,ae=h.globeUseCustomAntiAliasing(D,U,Z),oe=(Ge,be)=>{if(N===Ge)return;const Pe=[Wa[Ge],"PROJECTION_GLOBE_VIEW"];ae&&Pe.push("CUSTOM_ANTIALIASING"),be&&Pe.push(Wa[K]),H=D.useProgram("globeRaster",null,Pe),N=Ge},te=D.colorModeForRenderPass(),se=new h.DepthMode(j.LEQUAL,h.DepthMode.ReadWrite,D.depthRangeFor3D);fo.update($);const re=h.calculateGlobeMercatorMatrix(Z),de=[h.mercatorXfromLng(Z.center.lng),h.mercatorYfromLat(Z.center.lat)],_e=K?[!1,!0]:[!1],Le=D.globeSharedBuffers,me=[Z.width*h.exported.devicePixelRatio,Z.height*h.exported.devicePixelRatio],Ae=Float32Array.from(Z.globeMatrix),ke={useDenormalizedUpVectorScale:!0};if(_e.forEach(Ge=>{N=-1;const be=Ge?j.LINES:j.TRIANGLES;for(const Pe of V){const Te=P.getTile(Pe),$e=h.StencilMode.disabled,Ne=I.prevTerrainTileForTile[Pe.key],Qe=I.terrainTileForTile[Pe.key];cu(Ne,Qe)&&fo.newMorphing(Pe.key,Ne,Qe,$,250),U.activeTexture.set(j.TEXTURE0),Te.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const nt=fo.getMorphValuesForProxy(Pe.key),lt=nt?1:0;nt&&h.extend$1(ke,{morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:h.easeCubicInOut(nt.phase)}});const Tt=h.tileCornersToBounds(Pe.canonical),Je=h.getLatitudinalLod(Tt.getCenter().lat),pt=h.getGridMatrix(Pe.canonical,Tt,Je),zt=h.globeNormalizeECEF(h.globeTileBounds(Pe.canonical)),si=Ya(Z.projMatrix,Ae,re,zt,h.globeToMercatorTransition(Z.zoom),de,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,me,pt);if(oe(lt,Ge),I.setupElevationDraw(Te,H,ke),D.prepareDrawProgram(U,H,Pe.toUnwrapped()),Le){const[yi,Zt,Ui]=Ge?Le.getWirefameBuffers(D.context,Je):Le.getGridBuffers(Je);H.draw(U,be,se,$e,te,h.CullFaceMode.backCCW,si,"globe_raster",yi,Zt,Ui)}}}),Le){const Ge=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ae&&Ge.push("CUSTOM_ANTIALIASING"),H=D.useProgram("globeRaster",null,Ge);for(const be of V){const{x:Pe,y:Te,z:$e}=be.canonical,Ne=0===Te,Qe=Te===(1<<$e)-1,[nt,lt,Tt,Je]=Le.getPoleBuffers($e);if(Je&&(Ne||Qe)){const pt=P.getTile(be);U.activeTexture.set(j.TEXTURE0),pt.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let zt=h.globePoleMatrixForTile($e,Pe,Z);const si=h.globeNormalizeECEF(h.globeTileBounds(be.canonical)),yi=(Zt,Ui)=>Zt.draw(U,j.TRIANGLES,se,h.StencilMode.disabled,te,h.CullFaceMode.disabled,Ya(Z.projMatrix,zt,zt,si,0,de,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,me),"globe_pole_raster",Ui,Tt,Je);I.setupElevationDraw(pt,H,ke),D.prepareDrawProgram(U,H,be.toUnwrapped()),Ne&&yi(H,nt),Qe&&(zt=h.scale(h.create(),zt,[1,-1,1]),yi(H,lt))}}}}(x,v,C,A,E);else{const D=x.context,I=D.gl;let P,V;const $=x.options.showTerrainWireframe?2:0,U=(Z,ae)=>{if(V===Z)return;const oe=[Wa[Z]];ae&&oe.push(Wa[$]),P=x.useProgram("terrainRaster",null,oe),V=Z},j=x.colorModeForRenderPass(),H=new h.DepthMode(I.LEQUAL,h.DepthMode.ReadWrite,x.depthRangeFor3D);fo.update(E);const N=x.transform,K=6*Math.pow(1.5,22-N.zoom)*v.exaggeration();($?[!1,!0]:[!1]).forEach(Z=>{V=-1;const ae=Z?I.LINES:I.TRIANGLES,[oe,te]=Z?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const se of A){const re=C.getTile(se),de=h.StencilMode.disabled,_e=v.prevTerrainTileForTile[se.key],Le=v.terrainTileForTile[se.key];cu(_e,Le)&&fo.newMorphing(se.key,_e,Le,E,250),D.activeTexture.set(I.TEXTURE0),re.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const me=fo.getMorphValuesForProxy(se.key),Ae=me?1:0;let ke;me&&(ke={morphing:{srcDemTile:me.from,dstDemTile:me.to,phase:h.easeCubicInOut(me.phase)}});const Ge=Wl(se.projMatrix,Eh(se.canonical,N.renderWorldCopies)?K/10:K);U(Ae,Z),v.setupElevationDraw(re,P,ke),x.prepareDrawProgram(D,P,se.toUnwrapped()),P.draw(D,ae,H,de,j,h.CullFaceMode.backCCW,Ge,"terrain_raster",v.gridBuffer,oe,te)}})}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,x=this.proxySourceCache,v=this.proxiedCoords[x.id],C=this._drapedRenderBatches.shift(),A=[],E=c.style.order;let D=0;for(const I of v){const P=x.getTileByID(I.proxyTileKey),V=x.proxyCachedFBO[I.key]?x.proxyCachedFBO[I.key][r]:void 0,$=void 0!==V?x.renderCache[V]:this.pool[D++],U=void 0!==V;if(P.texture=$.tex,U&&!$.dirty){A.push(P.tileID);continue}let j;m.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(m.clear({color:h.Color.transparent,stencil:0}),$.dirty=!1);for(let H=C.start;H<=C.end;++H){const N=c.style._layers[E[H]];if(N.isHidden(c.transform.zoom))continue;const K=c.style._getLayerSourceCache(N),Z=K?this.proxyToSource[I.key][K.id]:[I];if(!Z)continue;const ae=Z;m.viewport.set([0,0,$.fb.width,$.fb.height]),j!==(K?K.id:null)&&(this._setupStencil($,Z,N,K),j=K?K.id:null),c.renderLayer(c,K,N,ae)}this.renderedToTile?($.dirty=!0,A.push(P.tileID)):U||--D,5===D&&(D=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),C.end+1}postRender(){}renderCacheEfficiency(r){const c=r.order.length;if(0===c)return{efficiency:100};let m,x=0,v=0,C=!1;for(let A=0;A<c;++A){const E=r._layers[r.order[A]];this._style.isLayerDraped(E)?(C&&++x,++v):C||(C=!0,m=E.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-x/v),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,c,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const C=v.tileID,A=1<<C.overscaledZ,{x:E,y:D}=C.canonical,I=E/A,P=(E+1)/A,V=D/A,$=(D+1)/A;return{minx:I,miny:V,maxx:P,maxy:$,t:v.dem.tree.raycastRoot(I,V,P,$,r,c,m),tile:v}});x.sort((v,C)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const v of x){if(null==v.t)return null;const C=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,c,m);if(null!=C)return C}return null}_createFBO(){const r=this.painter.context,c=r.gl,m=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const x=new h.Texture(r,{width:m[0],height:m[1],data:null},c.RGBA);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const v=r.createFramebuffer(m[0],m[1],!1);return v.colorAttachment.set(x.texture),v.depthAttachment=new R(r,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._layers[r],m=c.isHidden(this.painter.transform.zoom),x=c.getCrossfadeParameters(),v=!!x&&1!==x.t,C=c.hasTransition();return"custom"!==c.type&&!m&&(v||C)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof Q){r=!0;break}if(r)for(let c=0;c<this._style.order.length;++c){const m=this._style._layers[this._style.order[c]],x=m.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(m);if("raster"!==m.type||x||!v)continue;const C=m.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const E=this.proxyToSource[A.key][v.id];if(E)for(const D of E){const I=Xa(v.getTile(D),v.findLoadedParent(D,0),v,this.painter.transform,C);(1!==I.opacity||0!==I.mix)&&this._clearRenderCacheForTile(v.id,D)}}}}_setupDrapedRenderBatches(){const r=this._style.order,c=r.length;if(0===c)return;const m=[];let x,v=0,C=this._style._layers[r[v]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++v<c;)C=this._style._layers[r[v]];for(;v<c;++v){const A=this._style._layers[r[v]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===x&&(x=v):void 0!==x&&(m.push({start:x,end:v-1}),x=void 0))}void 0!==x&&m.push({start:x,end:v-1}),this._drapedRenderBatches=m}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const C=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let A=0;A<C.length;++A){const E=Object.values(C[A]);c.renderCachePool.push(...E)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let C=m.length-1;C>=0;C--){const A=m[C];if(c.getTileByID(A.key),void 0!==c.proxyCachedFBO[A.key]){const E=r[A.key],D=this.proxyToSource[A.key];let I=0;for(const P in D){const V=D[P],$=E[P];if(!$||$.length!==V.length||V.some((U,j)=>U!==$[j]||x[P]&&x[P].hasOwnProperty(U.key))){I=-1;break}++I}for(const P in c.proxyCachedFBO[A.key])c.renderCache[c.proxyCachedFBO[A.key][P]].dirty=I<0||I!==Object.values(E).length}}const v=[...this._drapedRenderBatches];v.sort((C,A)=>A.end-A.start-(C.end-C.start));for(const C of v)for(const A of m){if(c.proxyCachedFBO[A.key])continue;let E=c.renderCachePool.pop();void 0===E&&c.renderCache.length<50&&(E=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==E&&(c.proxyCachedFBO[A.key]={},c.proxyCachedFBO[A.key][C.start]=E,c.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,C=v.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let A;if(m.isTileClipped())A=c.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):h.StencilMode.disabled}_renderTileClippingMasks(r,c){const m=this.painter,x=this.painter.context,v=x.gl;m._tileClippingMaskIDs={},x.setColorMode(h.ColorMode.disabled),x.setDepthMode(h.DepthMode.disabled);const C=m.useProgram("clippingMask");for(const A of r){const E=m._tileClippingMaskIDs[A.key]=--c;C.draw(x,v.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:v.ALWAYS,mask:0},E,255,v.KEEP,v.KEEP,v.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,uu(A.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const m=[r.x,r.y,1,1];h.transformMat4$1(m,m,c.pixelMatrixInverse),h.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const x=c._camera.position,v=h.mercatorZfromAltitude(1,c.center.lat),C=[x[0],x[1],x[2]/v,0],A=h.subtract([],m.slice(0,3),C);h.normalize(A,A);const E=this.raycast(C,A,this._exaggeration);return null!==E&&E?(h.scaleAndAdd(C,C,A,E),C[3]=C[2],C[2]*=v,C):null}drawDepth(){const r=this.painter,c=r.context,m=this.proxySourceCache,x=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=c.gl,A=c.createFramebuffer(x,v,!0);c.activeTexture.set(C.TEXTURE0);const E=new h.Texture(c,{width:x,height:v,data:null},C.RGBA);E.bind(C.NEAREST,C.CLAMP_TO_EDGE),A.colorAttachment.set(E.texture);const D=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,x,v);A.depthAttachment.set(D),this._depthFBO=A,this._depthTexture=E}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,x,v]),function(C,A,E,D){if("globe"===C.transform.projection.name)return;const I=C.context,P=I.gl;I.clear({depth:1});const V=C.useProgram("terrainDepth"),$=new h.DepthMode(P.LESS,h.DepthMode.ReadWrite,C.depthRangeFor3D);for(const U of D){const j=E.getTile(U),H=Wl(U.projMatrix,0);A.setupElevationDraw(j,V),V.draw(I,P.TRIANGLES,$,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.backCCW,H,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(r,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,c,m){if(r.getSource()instanceof pe)return this._setupProxiedCoordsForImageSource(r,c,m);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const x=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let A=0;A<v.length;A++){const E=v[A],D=this._findTileCoveringTileID(E,r);if(D){const I=this._createProxiedId(E,D,m[E.key]&&m[E.key][r.id]);x.push(I),this.proxyToSource[E.key][r.id]=[I]}}let C=!1;for(let A=0;A<c.length;A++){const E=r.getTile(c[A]);if(!E||!E.hasData())continue;const D=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==E.tileID.canonical.z){const I=this.proxyToSource[D.tileID.key][r.id],P=this._createProxiedId(D.tileID,E,m[D.tileID.key]&&m[D.tileID.key][r.id]);I?I.splice(I.length-1,0,P):this.proxyToSource[D.tileID.key][r.id]=[P],x.push(P),C=!0}}this._sourceTilesOverlap[r.id]=C}_setupProxiedCoordsForImageSource(r,c,m){if(!r.getSource().loaded())return;const x=this.proxiedCoords[r.id]=[],v=this.proxyCoords,C=r.getSource(),A=new h.pointGeometry(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),E=C.coordinates.map(h.MercatorCoordinate.fromLngLat).reduce((I,P)=>(I.min.x=Math.min(I.min.x,P.x-A.x),I.min.y=Math.min(I.min.y,P.y-A.y),I.max.x=Math.max(I.max.x,P.x-A.x),I.max.y=Math.max(I.max.y,P.y-A.y),I),{min:new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(I,P)=>{const V=I.wrap+I.canonical.x/(1<<I.canonical.z),$=I.canonical.y/(1<<I.canonical.z),U=h.EXTENT/(1<<I.canonical.z),j=P.wrap+P.canonical.x/(1<<P.canonical.z),H=P.canonical.y/(1<<P.canonical.z);return V+U<j+E.min.x||V>j+E.max.x||$+U<H+E.min.y||$>H+E.max.y};for(let I=0;I<v.length;I++){const P=v[I];for(let V=0;V<c.length;V++){const $=r.getTile(c[V]);if(!$||!$.hasData()||D(P,$.tileID))continue;const U=this._createProxiedId(P,$,m[P.key]&&m[P.key][r.id]),j=this.proxyToSource[P.key][r.id];j?j.push(U):this.proxyToSource[P.key][r.id]=[U],x.push(U)}}}_createProxiedId(r,c,m){let x=this.orthoMatrix;if(m){const v=m.find(C=>C.key===c.tileID.key);if(v)return v}if(c.tileID.key!==r.key){const v=r.canonical.z-c.tileID.canonical.z;let C,A,E;x=h.create();const D=c.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(C=h.EXTENT>>v,A=C*((c.tileID.canonical.x<<v)-r.canonical.x+D),E=C*((c.tileID.canonical.y<<v)-r.canonical.y)):(C=h.EXTENT<<-v,A=h.EXTENT*(c.tileID.canonical.x-(r.canonical.x+D<<-v)),E=h.EXTENT*(c.tileID.canonical.y-(r.canonical.y<<-v))),h.ortho(x,0,C,0,C,0,1),h.translate(x,x,[A,E,0])}return new Kl(c.tileID,r.key,x)}_findTileCoveringTileID(r,c){let m=c.getTile(r);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[c.id],v=x[r.key];if(m=v?c.getTileByID(v):null,m&&m.hasData()||null===v)return m;let C=m?m.tileID:r,A=C.overscaledZ;const E=c.getSource().minzoom,D=[];if(!v){const P=c.getSource().maxzoom;if(r.canonical.z>=P){const V=r.canonical.z-P;c.getSource().reparseOverscaled?(A=Math.max(r.canonical.z+2,c.transform.tileZoom),C=new h.OverscaledTileID(A,r.wrap,P,r.canonical.x>>V,r.canonical.y>>V)):0!==V&&(A=P,C=new h.OverscaledTileID(A,r.wrap,P,r.canonical.x>>V,r.canonical.y>>V))}C.key!==r.key&&(D.push(C.key),m=c.getTile(C))}const I=P=>{D.forEach(V=>{x[V]=P}),D.length=0};for(A-=1;A>=E&&(!m||!m.hasData());A--){m&&I(m.tileID.key);const P=C.calculateScaledKey(A);if(m=c.getTileByID(P),m&&m.hasData())break;const V=x[P];if(null===V)break;void 0===V?D.push(P):m=c.getTileByID(V)}return I(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let m=this._tilesDirty[r];m||(m=this._tilesDirty[r]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(c){let m=0;const x=new h.StructArrayLayout2ui4,v=131;for(let C=1;C<129;C++){for(let A=1;A<129;A++)m=C*v+A,x.emplaceBack(m,m+1),x.emplaceBack(m,m+v),x.emplaceBack(m+1,m+v),128===C&&x.emplaceBack(m+v,m+v+1);x.emplaceBack(m+1,m+1+v)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=h.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class du{static cacheKey(r,c,m,x){let v=`${c}${x?x.cacheKey:""}`;for(const C of m)r.usedDefines.includes(C)&&(v+=`/${C}`);return v}constructor(r,c,m,x,v,C){const A=r.gl;this.program=A.createProgram();const E=function(H){const N=[];for(let K=0;K<H.length;K++){if(null===H[K])continue;const Z=H[K].split(" ");N.push(Z.pop())}return N}(m.staticAttributes),D=x?x.getBinderAttributes():[],I=E.concat(D);let P=x?x.defines():[];P=P.concat(C.map(H=>`#define ${H}`));const V=P.concat(r.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(Ha):Ha,Ha,Us,Ns.fragmentSource,po.fragmentSource,m.fragmentSource).join("\n"),$=P.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Us,Ns.vertexSource,po.vertexSource,Jn.vertexSource,m.vertexSource).join("\n"),U=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(U,V),A.compileShader(U),A.attachShader(this.program,U);const j=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(j,$),A.compileShader(j),A.attachShader(this.program,j),this.attributes={},this.numAttributes=I.length;for(let H=0;H<this.numAttributes;H++)I[H]&&(A.bindAttribLocation(this.program,H,I[H]),this.attributes[I[H]]=H);A.linkProgram(this.program),A.deleteShader(j),A.deleteShader(U),this.fixedUniforms=v(r),this.binderUniforms=x?x.getUniforms(r):[],-1!==C.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new h.Uniform1i(H=r),u_dem_prev:new h.Uniform1i(H),u_dem_unpack:new h.Uniform4f(H),u_dem_tl:new h.Uniform2f(H),u_dem_scale:new h.Uniform1f(H),u_dem_tl_prev:new h.Uniform2f(H),u_dem_scale_prev:new h.Uniform1f(H),u_dem_size:new h.Uniform1f(H),u_dem_lerp:new h.Uniform1f(H),u_exaggeration:new h.Uniform1f(H),u_depth:new h.Uniform1i(H),u_depth_size_inv:new h.Uniform2f(H),u_meter_to_dem:new h.Uniform1f(H),u_label_plane_matrix_inv:new h.UniformMatrix4f(H),u_tile_tl_up:new h.Uniform3f(H),u_tile_tr_up:new h.Uniform3f(H),u_tile_br_up:new h.Uniform3f(H),u_tile_bl_up:new h.Uniform3f(H),u_tile_up_scale:new h.Uniform1f(H)}),-1!==C.indexOf("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new h.UniformMatrix4f(H),u_fog_range:new h.Uniform2f(H),u_fog_color:new h.Uniform4f(H),u_fog_horizon_blend:new h.Uniform1f(H),u_fog_temporal_offset:new h.Uniform1f(H),u_frustum_tl:new h.Uniform3f(H),u_frustum_tr:new h.Uniform3f(H),u_frustum_br:new h.Uniform3f(H),u_frustum_bl:new h.Uniform3f(H),u_globe_pos:new h.Uniform3f(H),u_globe_radius:new h.Uniform1f(H),u_globe_transition:new h.Uniform1f(H),u_is_globe:new h.Uniform1i(H),u_viewport:new h.Uniform2f(H)}))(r))}var H}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)m[x].set(this.program,x,c[x])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)m[x].set(this.program,x,c[x])}}draw(r,c,m,x,v,C,A,E,D,I,P,V,$,U,j){const H=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(x),r.setColorMode(v),r.setCullFace(C);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(this.program,K,A[K]);U&&U.setUniforms(this.program,r,this.binderUniforms,V,{zoom:$});const N={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[c];for(const K of P.get()){const Z=K.vaos||(K.vaos={});(Z[E]||(Z[E]=new $a)).bind(r,this,D,U?U.getPaintVertexBuffers():[],I,K.vertexOffset,j||[]),H.drawElements(c,K.primitiveLength*N,H.UNSIGNED_SHORT,K.primitiveOffset*N*2)}}}function kh(p,r,c){const m=1/Zn(c,1,r.transform.tileZoom),x=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,r.transform.tileZoom)/x,C=v*(c.tileID.canonical.x+c.tileID.wrap*x),A=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[m,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[C>>16,A>>16],u_pixel_coord_lower:[65535&C,65535&A]}}const Ka=h.create(),js=(p,r,c,m,x,v,C,A,E,D,I)=>{const P=r.style.light,V=P.properties.get("position"),$=[V.x,V.y,V.z],U=h.create$1();"viewport"===P.properties.get("anchor")&&(h.fromRotation(U,-r.transform.angle),h.transformMat3($,$,U));const j=P.properties.get("color"),H=r.transform,N={u_matrix:p,u_lightpos:$,u_lightintensity:P.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ka,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:v};return"globe"===H.projection.name&&(N.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],N.u_zoom_transition=E,N.u_inv_rot_matrix=I,N.u_merc_center=D,N.u_up_dir=H.projection.upVector(new h.CanonicalTileID(0,0,0),D[0]*h.EXTENT,D[1]*h.EXTENT),N.u_height_lift=A),N},at=(p,r,c,m,x,v,C,A,E,D,I,P,V)=>{const $=js(p,r,c,m,x,v,C,D,I,P,V),U={u_height_factor:-Math.pow(2,C.overscaledZ)/E.tileSize/8};return h.extend($,kh(A,r,E),U)},Qo=p=>({u_matrix:p}),Nn=(p,r,c,m)=>h.extend(Qo(p),kh(c,r,m)),ci=(p,r)=>({u_matrix:p,u_world:r}),mo=(p,r,c,m,x)=>h.extend(Nn(p,r,c,m),{u_world:x}),pu=h.create(),Jl=(p,r,c,m,x,v)=>{const C=p.transform,A="globe"===C.projection.name;let E;if("map"===v.paint.get("circle-pitch-alignment"))if(A){const I=h.globePixelsToTileUnits(C.zoom,r.canonical)*C._pixelsPerMercatorPixel;E=Float32Array.from([I,0,0,I])}else E=C.calculatePixelsToTileUnitsMatrix(c);else E=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:p.translatePosMatrix(r.projMatrix,c,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:h.exported.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:pu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=m,D.u_merc_center=x,D.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],D.u_zoom_transition=h.globeToMercatorTransition(C.zoom);const I=x[0]*h.EXTENT,P=x[1]*h.EXTENT;D.u_up_dir=C.projection.upVector(new h.CanonicalTileID(0,0,0),I,P)}return D},Ql=p=>{const r=[];return"map"===p.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},Hs=(p,r,c,m)=>{const x=h.EXTENT/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:r.getCameraToCenterDistance(m),u_extrude_scale:[r.pixelsToGLUnits[0]/x,r.pixelsToGLUnits[1]/x]}},Rr=(p,r,c=1)=>({u_matrix:p,u_color:r,u_overlay:0,u_overlay_scale:c}),Ja=h.create(),ec=(p,r,c,m,x,v,C)=>{const A=p.transform,E="globe"===A.projection.name,D=E?h.globePixelsToTileUnits(A.zoom,r.canonical)*A._pixelsPerMercatorPixel:Zn(c,1,v),I={u_matrix:r.projMatrix,u_extrude_scale:D,u_intensity:C,u_inv_rot_matrix:Ja,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){I.u_inv_rot_matrix=m,I.u_merc_center=x,I.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],I.u_zoom_transition=h.globeToMercatorTransition(A.zoom);const P=x[0]*h.EXTENT,V=x[1]*h.EXTENT;I.u_up_dir=A.projection.upVector(new h.CanonicalTileID(0,0,0),P,V)}return I},dn=(p,r,c,m,x,v,C,A)=>{const E=p.transform,D=E.calculatePixelsToTileUnitsMatrix(r),I={u_matrix:tc(p,r,c,x),u_pixels_to_tile_units:D,u_device_pixel_ratio:C,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:A};if(ts(c)){const P=es(r,p.transform);I.u_texsize=r.lineAtlasTexture.size,I.u_scale=[P,m.fromScale,m.toScale],I.u_mix=m.t}return I},go=(p,r,c,m,x,v)=>{const C=p.transform,A=es(r,C);return{u_matrix:tc(p,r,c,x),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:v,u_image:0,u_scale:[A,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function es(p,r){return 1/Zn(p,1,r.tileZoom)}function tc(p,r,c,m){return p.translatePosMatrix(m||r.tileID.projMatrix,r,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function ts(p){const r=p.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const fu=(p,r,c,m,x,v)=>{return{u_matrix:p,u_tl_parent:r,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(A=x.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(C=x.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Qa(x.paint.get("raster-hue-rotate")),u_perspective_transform:v};var C,A};function Qa(p){p*=Math.PI/180;const r=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const mu=h.create(),ic=(p,r,c,m,x,v,C,A,E,D,I,P,V,$,U,j)=>{const H=x.transform,N={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:H.width/H.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:C,u_coord_matrix:A,u_is_text:+E,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:mu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:mu,u_up_vector:[0,-1,0]};return"globe"===j.name&&(N.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],N.u_zoom_transition=P,N.u_inv_rot_matrix=$,N.u_merc_center=V,N.u_camera_forward=H._camera.forward(),N.u_ecef_origin=h.globeECEFOrigin(H.globeMatrix,I.toUnwrapped()),N.u_tile_matrix=Float32Array.from(H.globeMatrix),N.u_up_vector=U),N},nc=(p,r,c,m,x,v,C,A,E,D,I,P,V,$,U,j,H)=>h.extend(ic(p,r,c,m,x,v,C,A,E,D,P,V,$,U,j,H),{u_gamma_scale:m?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:h.exported.devicePixelRatio,u_is_halo:+I}),ni=(p,r,c,m,x,v,C,A,E,D,I,P,V,$,U,j)=>h.extend(nc(p,r,c,m,x,v,C,A,!0,E,!0,I,P,V,$,U,j),{u_texsize_icon:D,u_texture_icon:1}),Dh=(p,r,c)=>({u_matrix:p,u_opacity:r,u_color:c}),gu=(p,r,c,m,x,v)=>h.extend(function(C,A,E,D){const I=E.imageManager.getPattern(C.from.toString()),P=E.imageManager.getPattern(C.to.toString()),{width:V,height:$}=E.imageManager.getPixelSize(),U=Math.pow(2,D.tileID.overscaledZ),j=D.tileSize*Math.pow(2,E.transform.tileZoom)/U,H=j*(D.tileID.canonical.x+D.tileID.wrap*U),N=j*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[V,$],u_mix:A.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Zn(D,1,E.transform.tileZoom),u_pixel_coord_upper:[H>>16,N>>16],u_pixel_coord_lower:[65535&H,65535&N]}}(m,v,c,x),{u_matrix:p,u_opacity:r}),_u={fillExtrusion:p=>({u_matrix:new h.UniformMatrix4f(p),u_lightpos:new h.Uniform3f(p),u_lightintensity:new h.Uniform1f(p),u_lightcolor:new h.Uniform3f(p),u_vertical_gradient:new h.Uniform1f(p),u_opacity:new h.Uniform1f(p),u_edge_radius:new h.Uniform1f(p),u_ao:new h.Uniform2f(p),u_tile_id:new h.Uniform3f(p),u_zoom_transition:new h.Uniform1f(p),u_inv_rot_matrix:new h.UniformMatrix4f(p),u_merc_center:new h.Uniform2f(p),u_up_dir:new h.Uniform3f(p),u_height_lift:new h.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new h.UniformMatrix4f(p),u_lightpos:new h.Uniform3f(p),u_lightintensity:new h.Uniform1f(p),u_lightcolor:new h.Uniform3f(p),u_vertical_gradient:new h.Uniform1f(p),u_height_factor:new h.Uniform1f(p),u_edge_radius:new h.Uniform1f(p),u_ao:new h.Uniform2f(p),u_tile_id:new h.Uniform3f(p),u_zoom_transition:new h.Uniform1f(p),u_inv_rot_matrix:new h.UniformMatrix4f(p),u_merc_center:new h.Uniform2f(p),u_up_dir:new h.Uniform3f(p),u_height_lift:new h.Uniform1f(p),u_image:new h.Uniform1i(p),u_texsize:new h.Uniform2f(p),u_pixel_coord_upper:new h.Uniform2f(p),u_pixel_coord_lower:new h.Uniform2f(p),u_scale:new h.Uniform3f(p),u_fade:new h.Uniform1f(p),u_opacity:new h.Uniform1f(p)}),fill:p=>({u_matrix:new h.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new h.UniformMatrix4f(p),u_image:new h.Uniform1i(p),u_texsize:new h.Uniform2f(p),u_pixel_coord_upper:new h.Uniform2f(p),u_pixel_coord_lower:new h.Uniform2f(p),u_scale:new h.Uniform3f(p),u_fade:new h.Uniform1f(p)}),fillOutline:p=>({u_matrix:new h.UniformMatrix4f(p),u_world:new h.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new h.UniformMatrix4f(p),u_world:new h.Uniform2f(p),u_image:new h.Uniform1i(p),u_texsize:new h.Uniform2f(p),u_pixel_coord_upper:new h.Uniform2f(p),u_pixel_coord_lower:new h.Uniform2f(p),u_scale:new h.Uniform3f(p),u_fade:new h.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new h.Uniform1f(p),u_extrude_scale:new h.UniformMatrix2f(p),u_device_pixel_ratio:new h.Uniform1f(p),u_matrix:new h.UniformMatrix4f(p),u_inv_rot_matrix:new h.UniformMatrix4f(p),u_merc_center:new h.Uniform2f(p),u_tile_id:new h.Uniform3f(p),u_zoom_transition:new h.Uniform1f(p),u_up_dir:new h.Uniform3f(p)}),collisionBox:p=>({u_matrix:new h.UniformMatrix4f(p),u_camera_to_center_distance:new h.Uniform1f(p),u_extrude_scale:new h.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new h.UniformMatrix4f(p),u_inv_matrix:new h.UniformMatrix4f(p),u_camera_to_center_distance:new h.Uniform1f(p),u_viewport_size:new h.Uniform2f(p)}),debug:p=>({u_color:new h.UniformColor(p),u_matrix:new h.UniformMatrix4f(p),u_overlay:new h.Uniform1i(p),u_overlay_scale:new h.Uniform1f(p)}),clippingMask:p=>({u_matrix:new h.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new h.Uniform1f(p),u_intensity:new h.Uniform1f(p),u_matrix:new h.UniformMatrix4f(p),u_inv_rot_matrix:new h.UniformMatrix4f(p),u_merc_center:new h.Uniform2f(p),u_tile_id:new h.Uniform3f(p),u_zoom_transition:new h.Uniform1f(p),u_up_dir:new h.Uniform3f(p)}),heatmapTexture:p=>({u_image:new h.Uniform1i(p),u_color_ramp:new h.Uniform1i(p),u_opacity:new h.Uniform1f(p)}),hillshade:p=>({u_matrix:new h.UniformMatrix4f(p),u_image:new h.Uniform1i(p),u_latrange:new h.Uniform2f(p),u_light:new h.Uniform2f(p),u_shadow:new h.UniformColor(p),u_highlight:new h.UniformColor(p),u_accent:new h.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new h.UniformMatrix4f(p),u_image:new h.Uniform1i(p),u_dimension:new h.Uniform2f(p),u_zoom:new h.Uniform1f(p),u_unpack:new h.Uniform4f(p)}),line:p=>({u_matrix:new h.UniformMatrix4f(p),u_pixels_to_tile_units:new h.UniformMatrix2f(p),u_device_pixel_ratio:new h.Uniform1f(p),u_units_to_pixels:new h.Uniform2f(p),u_dash_image:new h.Uniform1i(p),u_gradient_image:new h.Uniform1i(p),u_image_height:new h.Uniform1f(p),u_texsize:new h.Uniform2f(p),u_scale:new h.Uniform3f(p),u_mix:new h.Uniform1f(p),u_alpha_discard_threshold:new h.Uniform1f(p),u_trim_offset:new h.Uniform2f(p)}),linePattern:p=>({u_matrix:new h.UniformMatrix4f(p),u_texsize:new h.Uniform2f(p),u_pixels_to_tile_units:new h.UniformMatrix2f(p),u_device_pixel_ratio:new h.Uniform1f(p),u_image:new h.Uniform1i(p),u_units_to_pixels:new h.Uniform2f(p),u_scale:new h.Uniform3f(p),u_fade:new h.Uniform1f(p),u_alpha_discard_threshold:new h.Uniform1f(p)}),raster:p=>({u_matrix:new h.UniformMatrix4f(p),u_tl_parent:new h.Uniform2f(p),u_scale_parent:new h.Uniform1f(p),u_fade_t:new h.Uniform1f(p),u_opacity:new h.Uniform1f(p),u_image0:new h.Uniform1i(p),u_image1:new h.Uniform1i(p),u_brightness_low:new h.Uniform1f(p),u_brightness_high:new h.Uniform1f(p),u_saturation_factor:new h.Uniform1f(p),u_contrast_factor:new h.Uniform1f(p),u_spin_weights:new h.Uniform3f(p),u_perspective_transform:new h.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new h.Uniform1i(p),u_is_size_feature_constant:new h.Uniform1i(p),u_size_t:new h.Uniform1f(p),u_size:new h.Uniform1f(p),u_camera_to_center_distance:new h.Uniform1f(p),u_rotate_symbol:new h.Uniform1i(p),u_aspect_ratio:new h.Uniform1f(p),u_fade_change:new h.Uniform1f(p),u_matrix:new h.UniformMatrix4f(p),u_label_plane_matrix:new h.UniformMatrix4f(p),u_coord_matrix:new h.UniformMatrix4f(p),u_is_text:new h.Uniform1i(p),u_pitch_with_map:new h.Uniform1i(p),u_texsize:new h.Uniform2f(p),u_tile_id:new h.Uniform3f(p),u_zoom_transition:new h.Uniform1f(p),u_inv_rot_matrix:new h.UniformMatrix4f(p),u_merc_center:new h.Uniform2f(p),u_camera_forward:new h.Uniform3f(p),u_tile_matrix:new h.UniformMatrix4f(p),u_up_vector:new h.Uniform3f(p),u_ecef_origin:new h.Uniform3f(p),u_texture:new h.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new h.Uniform1i(p),u_is_size_feature_constant:new h.Uniform1i(p),u_size_t:new h.Uniform1f(p),u_size:new h.Uniform1f(p),u_camera_to_center_distance:new h.Uniform1f(p),u_rotate_symbol:new h.Uniform1i(p),u_aspect_ratio:new h.Uniform1f(p),u_fade_change:new h.Uniform1f(p),u_matrix:new h.UniformMatrix4f(p),u_label_plane_matrix:new h.UniformMatrix4f(p),u_coord_matrix:new h.UniformMatrix4f(p),u_is_text:new h.Uniform1i(p),u_pitch_with_map:new h.Uniform1i(p),u_texsize:new h.Uniform2f(p),u_texture:new h.Uniform1i(p),u_gamma_scale:new h.Uniform1f(p),u_device_pixel_ratio:new h.Uniform1f(p),u_tile_id:new h.Uniform3f(p),u_zoom_transition:new h.Uniform1f(p),u_inv_rot_matrix:new h.UniformMatrix4f(p),u_merc_center:new h.Uniform2f(p),u_camera_forward:new h.Uniform3f(p),u_tile_matrix:new h.UniformMatrix4f(p),u_up_vector:new h.Uniform3f(p),u_ecef_origin:new h.Uniform3f(p),u_is_halo:new h.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new h.Uniform1i(p),u_is_size_feature_constant:new h.Uniform1i(p),u_size_t:new h.Uniform1f(p),u_size:new h.Uniform1f(p),u_camera_to_center_distance:new h.Uniform1f(p),u_rotate_symbol:new h.Uniform1i(p),u_aspect_ratio:new h.Uniform1f(p),u_fade_change:new h.Uniform1f(p),u_matrix:new h.UniformMatrix4f(p),u_label_plane_matrix:new h.UniformMatrix4f(p),u_coord_matrix:new h.UniformMatrix4f(p),u_is_text:new h.Uniform1i(p),u_pitch_with_map:new h.Uniform1i(p),u_texsize:new h.Uniform2f(p),u_texsize_icon:new h.Uniform2f(p),u_texture:new h.Uniform1i(p),u_texture_icon:new h.Uniform1i(p),u_gamma_scale:new h.Uniform1f(p),u_device_pixel_ratio:new h.Uniform1f(p),u_is_halo:new h.Uniform1i(p)}),background:p=>({u_matrix:new h.UniformMatrix4f(p),u_opacity:new h.Uniform1f(p),u_color:new h.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new h.UniformMatrix4f(p),u_opacity:new h.Uniform1f(p),u_image:new h.Uniform1i(p),u_pattern_tl_a:new h.Uniform2f(p),u_pattern_br_a:new h.Uniform2f(p),u_pattern_tl_b:new h.Uniform2f(p),u_pattern_br_b:new h.Uniform2f(p),u_texsize:new h.Uniform2f(p),u_mix:new h.Uniform1f(p),u_pattern_size_a:new h.Uniform2f(p),u_pattern_size_b:new h.Uniform2f(p),u_scale_a:new h.Uniform1f(p),u_scale_b:new h.Uniform1f(p),u_pixel_coord_upper:new h.Uniform2f(p),u_pixel_coord_lower:new h.Uniform2f(p),u_tile_units_to_pixels:new h.Uniform1f(p)}),terrainRaster:Jo,terrainDepth:Jo,skybox:p=>({u_matrix:new h.UniformMatrix4f(p),u_sun_direction:new h.Uniform3f(p),u_cubemap:new h.Uniform1i(p),u_opacity:new h.Uniform1f(p),u_temporal_offset:new h.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new h.UniformMatrix4f(p),u_color_ramp:new h.Uniform1i(p),u_center_direction:new h.Uniform3f(p),u_radius:new h.Uniform1f(p),u_opacity:new h.Uniform1f(p),u_temporal_offset:new h.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new h.UniformMatrix3f(p),u_sun_direction:new h.Uniform3f(p),u_sun_intensity:new h.Uniform1f(p),u_color_tint_r:new h.Uniform4f(p),u_color_tint_m:new h.Uniform4f(p),u_luminance:new h.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new h.UniformMatrix4f(p),u_globe_matrix:new h.UniformMatrix4f(p),u_normalize_matrix:new h.UniformMatrix4f(p),u_merc_matrix:new h.UniformMatrix4f(p),u_zoom_transition:new h.Uniform1f(p),u_merc_center:new h.Uniform2f(p),u_image0:new h.Uniform1i(p),u_grid_matrix:new h.UniformMatrix3f(p),u_frustum_tl:new h.Uniform3f(p),u_frustum_tr:new h.Uniform3f(p),u_frustum_br:new h.Uniform3f(p),u_frustum_bl:new h.Uniform3f(p),u_globe_pos:new h.Uniform3f(p),u_globe_radius:new h.Uniform1f(p),u_viewport:new h.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new h.Uniform3f(p),u_frustum_tr:new h.Uniform3f(p),u_frustum_br:new h.Uniform3f(p),u_frustum_bl:new h.Uniform3f(p),u_horizon:new h.Uniform1f(p),u_transition:new h.Uniform1f(p),u_fadeout_range:new h.Uniform1f(p),u_color:new h.Uniform4f(p),u_high_color:new h.Uniform4f(p),u_space_color:new h.Uniform4f(p),u_star_intensity:new h.Uniform1f(p),u_star_density:new h.Uniform1f(p),u_star_size:new h.Uniform1f(p),u_temporal_offset:new h.Uniform1f(p),u_horizon_angle:new h.Uniform1f(p),u_rotation_matrix:new h.UniformMatrix4f(p)})};let qs;function rc(p,r,c,m,x,v,C){const A=p.context,E=A.gl,D=p.transform,I=p.useProgram("collisionBox"),P=[];let V=0,$=0;for(let ae=0;ae<m.length;ae++){const oe=m[ae],te=r.getTile(oe),se=te.getBucket(c);if(!se)continue;const re=rn(oe,se,D);let de=re;0===x[0]&&0===x[1]||(de=p.translatePosMatrix(re,te,x,v));const _e=C?se.textCollisionBox:se.iconCollisionBox,Le=se.collisionCircleArray;if(Le.length>0){const me=h.create(),Ae=de;h.mul(me,se.placementInvProjMatrix,D.glCoordMatrix),h.mul(me,me,se.placementViewportMatrix),P.push({circleArray:Le,circleOffset:$,transform:Ae,invTransform:me,projection:se.getProjection()}),V+=Le.length/4,$=V}_e&&(p.terrain&&p.terrain.setupElevationDraw(te,I),I.draw(A,E.LINES,h.DepthMode.disabled,h.StencilMode.disabled,p.colorModeForRenderPass(),h.CullFaceMode.disabled,Hs(de,D,te,se.getProjection()),c.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,D.zoom,null,[_e.collisionVertexBuffer,_e.collisionVertexBufferExt]))}if(!C||!P.length)return;const U=p.useProgram("collisionCircle"),j=new h.StructArrayLayout2f1f2i16;j.resize(4*V),j._trim();let H=0;for(const ae of P)for(let oe=0;oe<ae.circleArray.length/4;oe++){const te=4*oe,se=ae.circleArray[te+0],re=ae.circleArray[te+1],de=ae.circleArray[te+2],_e=ae.circleArray[te+3];j.emplace(H++,se,re,de,_e,0),j.emplace(H++,se,re,de,_e,1),j.emplace(H++,se,re,de,_e,2),j.emplace(H++,se,re,de,_e,3)}(!qs||qs.length<2*V)&&(qs=function(ae){const oe=2*ae,te=new h.StructArrayLayout3ui6;te.resize(oe),te._trim();for(let se=0;se<oe;se++){const re=6*se;te.uint16[re+0]=4*se+0,te.uint16[re+1]=4*se+1,te.uint16[re+2]=4*se+2,te.uint16[re+3]=4*se+2,te.uint16[re+4]=4*se+3,te.uint16[re+5]=4*se+0}return te}(V));const N=A.createIndexBuffer(qs,!0),K=A.createVertexBuffer(j,h.collisionCircleLayout.members,!0);for(const ae of P){const oe={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(Z=D).getCameraToCenterDistance(ae.projection),u_viewport_size:[Z.width,Z.height]};U.draw(A,E.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,p.colorModeForRenderPass(),h.CullFaceMode.disabled,oe,c.id,K,N,h.SegmentVector.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,D.zoom)}var Z;K.destroy(),N.destroy()}const oc=h.create();function el(p,r,c,m,x,v){const{horizontalAlign:C,verticalAlign:A}=h.getAnchorAlignment(p),E=-(C-.5)*r,D=-(A-.5)*c,I=h.evaluateVariableOffset(p,m);return new h.pointGeometry((E/x+I[0])*v,(D/x+I[1])*v)}function Un(p,r,c,m,x,v,C,A,E,D,I){const P=p.text.placedSymbolArray,V=p.text.dynamicLayoutVertexArray,$=p.icon.dynamicLayoutVertexArray,U={},j=hn(A,p.getProjection(),v),H=v.elevation,N=p.getProjection().upVectorScale(A.canonical,v.center.lat,v.worldSize);V.clear();for(let K=0;K<P.length;K++){const Z=P.get(K),ae=p.allowVerticalPlacement&&!Z.placedOrientation,oe=Z.hidden||!Z.crossTileID||ae?null:m[Z.crossTileID];if(oe){const te=new h.pointGeometry(Z.tileAnchorX,Z.tileAnchorY),se=p.getProjection().upVector(A.canonical,te.x,te.y),re=H?H.getAtTileOffset(A,te.x,te.y):0,de=vt([Z.projectedAnchorX+re*se[0]*N.metersToTile,Z.projectedAnchorY+re*se[1]*N.metersToTile,Z.projectedAnchorZ+re*se[2]*N.metersToTile],c?j:C),_e=La(v.getCameraToCenterDistance(p.getProjection()),de.signedDistanceFromCamera);let Le=x.evaluateSizeForFeature(p.textSizeData,D,Z)*_e/h.ONE_EM;c&&(Le*=p.tilePixelRatio/E);const{width:me,height:Ae,anchor:ke,textOffset:Ge,textScale:be}=oe,Pe=el(ke,me,Ae,Ge,be,Le);let Te;if(c){const Ne=te.add(Pe),{x:Qe,y:nt,z:lt}=p.getProjection().projectTilePoint(Ne.x,Ne.y,A.canonical);Te=vt([Qe+re*se[0]*N.metersToTile,nt+re*se[1]*N.metersToTile,lt+re*se[2]*N.metersToTile],C).point}else{const Ne=r?Pe.rotate(-v.angle):Pe;Te=[de.point[0]+Ne.x,de.point[1]+Ne.y,0]}const $e=p.allowVerticalPlacement&&Z.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let Ne=0;Ne<Z.numGlyphs;Ne++)h.addDynamicAttributes(V,Te[0],Te[1],Te[2],$e);I&&Z.associatedIconIndex>=0&&(U[Z.associatedIconIndex]={shiftedAnchor:Te,angle:$e})}else lo(Z.numGlyphs,V)}if(I){$.clear();const K=p.icon.placedSymbolArray;for(let Z=0;Z<K.length;Z++){const ae=K.get(Z);if(ae.hidden)lo(ae.numGlyphs,$);else{const oe=U[Z];if(oe)for(let te=0;te<ae.numGlyphs;te++)h.addDynamicAttributes($,oe.shiftedAnchor[0],oe.shiftedAnchor[1],oe.shiftedAnchor[2],oe.angle);else lo(ae.numGlyphs,$)}}p.icon.dynamicLayoutVertexBuffer.updateData($)}p.text.dynamicLayoutVertexBuffer.updateData(V)}function yu(p,r,c){return c.iconsInText&&r?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function sc(p,r,c,m,x,v,C,A,E,D,I,P){const V=p.context,$=V.gl,U=p.transform,j="map"===A,H="map"===E,N=j&&"point"!==c.layout.get("symbol-placement"),K=j&&!H&&!N,Z=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let ae=!1;const oe=p.depthModeForSublayer(0,h.DepthMode.ReadOnly),te=[h.mercatorXfromLng(U.center.lng),h.mercatorYfromLat(U.center.lat)],se=c.layout.get("text-variable-anchor"),re="globe"===U.projection.name,de=[],_e=[0,-1,0];let Le=_e;!re&&!U.mercatorFromTransition||j||(Le=function(me){const Ae=me._camera.getWorldToCamera(me.worldSize,1),ke=h.multiply([],Ae,me.globeMatrix);h.invert(ke,ke);const Ge=[0,0,0],be=[0,1,0,0];return h.transformMat4$1(be,be,ke),Ge[0]=be[0],Ge[1]=be[1],Ge[2]=be[2],h.normalize(Ge,Ge),Ge}(U));for(const me of m){const Ae=r.getTile(me),ke=Ae.getBucket(c);if(!ke||"mercator"===ke.projection.name&&re)continue;const Ge=x?ke.text:ke.icon;if(!Ge||ke.fullyClipped||!Ge.segments.get().length)continue;const be=Ge.programConfigurations.get(c.id),Pe=x||ke.sdfIcons,Te=x?ke.textSizeData:ke.iconSizeData,$e=H||0!==U.pitch,Ne=h.evaluateSizeForZoom(Te,U.zoom);let Qe,nt,lt,Tt,Je=[0,0],pt=null;if(x){if(nt=Ae.glyphAtlasTexture,lt=$.LINEAR,Qe=Ae.glyphAtlasTexture.size,ke.iconsInText){Je=Ae.imageAtlasTexture.size,pt=Ae.imageAtlasTexture;const an="composite"===Te.kind||"camera"===Te.kind;Tt=$e||p.options.rotating||p.options.zooming||an?$.LINEAR:$.NEAREST}}else{const an=1!==c.layout.get("icon-size").constantOr(0)||ke.iconsNeedLinear;nt=Ae.imageAtlasTexture,lt=Pe||p.options.rotating||p.options.zooming||an||$e?$.LINEAR:$.NEAREST,Qe=Ae.imageAtlasTexture.size}const zt="globe"===ke.projection.name,si=zt?Le:_e,yi=zt?h.globeToMercatorTransition(U.zoom):0,Zt=hn(me,ke.getProjection(),U),Ui=U.calculatePixelsToTileUnitsMatrix(Ae),tr=Mt(Zt,Ae.tileID.canonical,H,j,U,ke.getProjection(),Ui),ir=p.terrain&&H&&N?h.invert(h.create(),tr):oc,ri=Dn(Zt,Ae.tileID.canonical,H,j,U,ke.getProjection(),Ui),ui=se&&ke.hasTextData(),At="none"!==c.layout.get("icon-text-fit")&&ui&&ke.hasIconData();if(N){const an=U.elevation,Ao=an?an.getAtTileOffsetFunc(me,U.center.lat,U.worldSize,ke.getProjection()):aa=>[0,0,0],Nr=Et(Zt,Ae.tileID.canonical,H,j,U,ke.getProjection(),Ui);_r(ke,Zt,p,x,Nr,ri,H,D,Ao,me)}const Si=N||x&&se||At,$i=p.translatePosMatrix(Zt,Ae,v,C),ti=Si?oc:tr,on=p.translatePosMatrix(ri,Ae,v,C,!0),Co=ke.getProjection().createInversionMatrix(U,me.canonical),sn=[];p.terrain&&H&&sn.push("PITCH_WITH_MAP_TERRAIN"),zt&&sn.push("PROJECTION_GLOBE_VIEW"),Si&&sn.push("PROJECTED_POS_ON_VIEWPORT");const Vr=Pe&&0!==c.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let Gr;Gr=Pe?ke.iconsInText?ni(Te.kind,Ne,K,H,p,$i,ti,on,Qe,Je,me,yi,te,Co,si,ke.getProjection()):nc(Te.kind,Ne,K,H,p,$i,ti,on,x,Qe,!0,me,yi,te,Co,si,ke.getProjection()):ic(Te.kind,Ne,K,H,p,$i,ti,on,x,Qe,me,yi,te,Co,si,ke.getProjection());const Mo={program:p.useProgram(yu(Pe,x,ke),be,sn),buffers:Ge,uniformValues:Gr,atlasTexture:nt,atlasTextureIcon:pt,atlasInterpolation:lt,atlasInterpolationIcon:Tt,isSDF:Pe,hasHalo:Vr,tile:Ae,labelPlaneMatrixInv:ir};if(Z&&ke.canOverlap){ae=!0;const an=Ge.segments.get();for(const Ao of an)de.push({segments:new h.SegmentVector([Ao]),sortKey:Ao.sortKey,state:Mo})}else de.push({segments:Ge.segments,sortKey:0,state:Mo})}ae&&de.sort((me,Ae)=>me.sortKey-Ae.sortKey);for(const me of de){const Ae=me.state;if(p.terrain&&p.terrain.setupElevationDraw(Ae.tile,Ae.program,{useDepthForOcclusion:!re,labelPlaneMatrixInv:Ae.labelPlaneMatrixInv}),V.activeTexture.set($.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,$.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(V.activeTexture.set($.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Ae.isSDF){const ke=Ae.uniformValues;Ae.hasHalo&&(ke.u_is_halo=1,ac(Ae.buffers,me.segments,c,p,Ae.program,oe,I,P,ke)),ke.u_is_halo=0}ac(Ae.buffers,me.segments,c,p,Ae.program,oe,I,P,Ae.uniformValues)}}function ac(p,r,c,m,x,v,C,A,E){const D=m.context,I=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];x.draw(D,D.gl.TRIANGLES,v,C,A,h.CullFaceMode.disabled,E,c.id,p.layoutVertexBuffer,p.indexBuffer,r,c.paint,m.transform.zoom,p.programConfigurations.get(c.id),I)}function tl(p,r,c,m,x,v,C){const A=p.context.gl,E=c.paint.get("fill-pattern"),D=E&&E.constantOr(1),I=c.getCrossfadeParameters();let P,V,$,U,j;C?(V=D&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=A.LINES):(V=D?"fillPattern":"fill",P=A.TRIANGLES);for(const H of m){const N=r.getTile(H);if(D&&!N.patternsLoaded())continue;const K=N.getBucket(c);if(!K)continue;p.prepareDrawTile();const Z=K.programConfigurations.get(c.id),ae=p.useProgram(V,Z);D&&(p.context.activeTexture.set(A.TEXTURE0),N.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Z.updatePaintBuffers(I));const oe=E.constantOr(null);if(oe&&N.imageAtlas){const se=N.imageAtlas,re=se.patternPositions[oe.to.toString()],de=se.patternPositions[oe.from.toString()];re&&de&&Z.setConstantPatternPositions(re,de)}const te=p.translatePosMatrix(H.projMatrix,N,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(C){U=K.indexBuffer2,j=K.segments2;const se=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];$="fillOutlinePattern"===V&&D?mo(te,p,I,N,se):ci(te,se)}else U=K.indexBuffer,j=K.segments,$=D?Nn(te,p,I,N):Qo(te);p.prepareDrawProgram(p.context,ae,H.toUnwrapped()),ae.draw(p.context,P,x,p.stencilModeForClipping(H),v,h.CullFaceMode.disabled,$,c.id,K.layoutVertexBuffer,U,j,c.paint,p.transform.zoom,Z)}}function br(p,r,c,m,x,v,C){const A=p.context,E=A.gl,D=p.transform,I=c.paint.get("fill-extrusion-pattern"),P=I.constantOr(1),V=c.getCrossfadeParameters(),$=c.paint.get("fill-extrusion-opacity"),U=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],j=c.layout.get("fill-extrusion-edge-radius"),H="globe"===D.projection.name?h.fillExtrusionHeightLift():0,N="globe"===D.projection.name,K=N?h.globeToMercatorTransition(D.zoom):0,Z=[h.mercatorXfromLng(D.center.lng),h.mercatorYfromLat(D.center.lat)],ae=[];N&&(ae.push("PROJECTION_GLOBE_VIEW"),p.style.terrainSetForDrapingOnly()&&ae.push("TERRAIN")),U[0]>0&&ae.push("FAUX_AO");for(const oe of m){const te=r.getTile(oe),se=te.getBucket(c);if(!se||se.projection.name!==D.projection.name)continue;const re=se.programConfigurations.get(c.id),de=p.useProgram(P?"fillExtrusionPattern":"fillExtrusion",re,ae);if(p.terrain){const be=p.terrain;if(p.style.terrainSetForDrapingOnly())be.setupElevationDraw(te,de,{useMeterToDem:!0});else{if(!se.enableTerrain)continue;if(be.setupElevationDraw(te,de,{useMeterToDem:!0}),$s(A,r,oe,se,c,be),!se.centroidVertexBuffer){const Pe=de.attributes.a_centroid_pos;void 0!==Pe&&E.vertexAttrib2f(Pe,0,0)}}}P&&(p.context.activeTexture.set(E.TEXTURE0),te.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),re.updatePaintBuffers(V));const _e=I.constantOr(null);if(_e&&te.imageAtlas){const be=te.imageAtlas,Pe=be.patternPositions[_e.to.toString()],Te=be.patternPositions[_e.from.toString()];Pe&&Te&&re.setConstantPatternPositions(Pe,Te)}const Le=p.translatePosMatrix(oe.projMatrix,te,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),me=D.projection.createInversionMatrix(D,oe.canonical),Ae=c.paint.get("fill-extrusion-vertical-gradient"),ke=P?at(Le,p,Ae,$,U,j,oe,V,te,H,K,Z,me):js(Le,p,Ae,$,U,j,oe,H,K,Z,me);p.prepareDrawProgram(A,de,oe.toUnwrapped());const Ge=[];p.terrain&&Ge.push(se.centroidVertexBuffer),N&&Ge.push(se.layoutVertexExtBuffer),de.draw(A,A.gl.TRIANGLES,x,v,C,h.CullFaceMode.backCCW,ke,c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,p.transform.zoom,re,Ge)}}function $s(p,r,c,m,x,v){const C=[N=>{let K=N.canonical.x-1,Z=N.wrap;return K<0&&(K=(1<<N.canonical.z)-1,Z--),new h.OverscaledTileID(N.overscaledZ,Z,N.canonical.z,K,N.canonical.y)},N=>{let K=N.canonical.x+1,Z=N.wrap;return K===1<<N.canonical.z&&(K=0,Z++),new h.OverscaledTileID(N.overscaledZ,Z,N.canonical.z,K,N.canonical.y)},N=>new h.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,(0===N.canonical.y?1<<N.canonical.z:N.canonical.y)-1),N=>new h.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y===(1<<N.canonical.z)-1?0:N.canonical.y+1)],A=N=>{const K=r.getSource().minzoom,Z=oe=>{const te=r.getTileByID(oe);if(te&&te.hasData())return te.getBucket(x)},ae=[0,-1,1];for(const oe of ae){if(N.overscaledZ+oe<K)continue;const te=Z(N.calculateScaledKey(N.overscaledZ+oe));if(te)return te}},E=[0,0,0],D=(N,K)=>(E[0]=Math.min(N.min.y,K.min.y),E[1]=Math.max(N.max.y,K.max.y),E[2]=h.EXTENT-K.min.x>N.max.x?K.min.x-h.EXTENT:N.max.x,E),I=(N,K)=>(E[0]=Math.min(N.min.x,K.min.x),E[1]=Math.max(N.max.x,K.max.x),E[2]=h.EXTENT-K.min.y>N.max.y?K.min.y-h.EXTENT:N.max.y,E),P=[(N,K)=>D(N,K),(N,K)=>D(K,N),(N,K)=>I(N,K),(N,K)=>I(K,N)],V=new h.pointGeometry(0,0);let $,U,j;const H=(N,K,Z,ae,oe)=>{const te=[[ae?Z:N,ae?N:Z,0],[ae?Z:K,ae?K:Z,0]],se=oe<0?h.EXTENT+oe:oe,re=[ae?se:(N+K)/2,ae?(N+K)/2:se,0];return 0===Z&&oe<0||0!==Z&&oe>0?v.getForTilePoints(j,[re],!0,U):te.push(re),v.getForTilePoints(c,te,!0,$),Math.max(te[0][2],te[1][2],re[2])/v.exaggeration()};for(let N=0;N<4;N++){const K=(N<2?1:5)-N,Z=m.borders[N];if(0===Z.length)continue;const ae=j=C[N](c),oe=A(ae);if(!(oe&&oe instanceof h.FillExtrusionBucket&&oe.enableTerrain)||m.borderDoneWithNeighborZ[N]===oe.canonical.z&&oe.borderDoneWithNeighborZ[K]===m.canonical.z||(U=v.findDEMTileFor(ae),!U||!U.dem))continue;if(!$){const de=v.findDEMTileFor(c);if(!de||!de.dem)return;$=de}const te=oe.borders[K];let se=0;const re=oe.borderDoneWithNeighborZ[K]!==m.canonical.z;if(m.canonical.z===oe.canonical.z){for(let de=0;de<Z.length;de++){const _e=m.featuresOnBorder[Z[de]],Le=_e.borders[N];let me;for(;se<te.length&&(me=oe.featuresOnBorder[te[se]],!(me.borders[K][1]>Le[0]+3));)re&&oe.encodeCentroid(void 0,me,!1),se++;if(me&&se<te.length){const Ae=se;let ke=0;for(;!(me.borders[K][0]>Le[1]-3)&&(ke++,++se!==te.length);)me=oe.featuresOnBorder[te[se]];if(me=oe.featuresOnBorder[te[Ae]],_e.intersectsCount()>1||me.intersectsCount()>1||1!==ke){1!==ke&&(se=Ae),m.encodeCentroid(void 0,_e,!1),re&&oe.encodeCentroid(void 0,me,!1);continue}const Ge=P[N](_e,me),be=N%2?h.EXTENT-1:0;V.x=H(Ge[0],Math.min(h.EXTENT-1,Ge[1]),be,N<2,Ge[2]),V.y=0,m.encodeCentroid(V,_e,!1),re&&oe.encodeCentroid(V,me,!1)}else m.encodeCentroid(void 0,_e,!1)}m.borderDoneWithNeighborZ[N]=oe.canonical.z,m.needsCentroidUpdate=!0,re&&(oe.borderDoneWithNeighborZ[K]=m.canonical.z,oe.needsCentroidUpdate=!0)}else{for(const de of Z)m.encodeCentroid(void 0,m.featuresOnBorder[de],!1);if(re){for(const de of te)oe.encodeCentroid(void 0,oe.featuresOnBorder[de],!1);oe.borderDoneWithNeighborZ[K]=m.canonical.z,oe.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[N]=oe.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(p)}const xu=new h.Color(1,0,0,1),_o=new h.Color(0,1,0,1),Qn=new h.Color(0,0,1,1),vu=new h.Color(1,0,1,1),yo=new h.Color(0,1,1,1);function Rt(p,r,c){const m=p.context,x=p.transform,v=m.gl,C="globe"===x.projection.name,A=C?["PROJECTION_GLOBE_VIEW"]:null;let E=c.projMatrix;if(C&&h.globeToMercatorTransition(x.zoom)>0){const _e=h.transitionTileAABBinECEF(c.canonical,x),Le=h.globeDenormalizeECEF(_e);E=h.multiply(new Float32Array(16),x.globeMatrix,Le),h.multiply(E,x.projMatrix,E)}const D=p.useProgram("debug",null,A),I=r.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(I,D);const P=h.DepthMode.disabled,V=h.StencilMode.disabled,$=p.colorModeForRenderPass(),U="$debug";m.activeTexture.set(v.TEXTURE0),p.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),C?I._makeGlobeTileDebugBuffers(p.context,x):I._makeDebugTileBoundsBuffers(p.context,x.projection);const j=I._tileDebugBuffer||p.debugBuffer,H=I._tileDebugIndexBuffer||p.debugIndexBuffer,N=I._tileDebugSegments||p.debugSegments;D.draw(m,v.LINE_STRIP,P,V,$,h.CullFaceMode.disabled,Rr(E,h.Color.red),U,j,H,N,null,null,null,[I._globeTileDebugBorderBuffer]);const K=I.latestRawTileData,Z=Math.floor((K&&K.byteLength||0)/1024),ae=r.getTile(c).tileSize,oe=512/Math.min(ae,512)*(c.overscaledZ/x.zoom)*.5;let te=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(te+=` => ${c.overscaledZ}`),te+=` ${Z}kb`,function(_e,Le){_e.initDebugOverlayCanvas();const me=_e.debugOverlayCanvas,Ae=_e.context.gl,ke=_e.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,me.width,me.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(Le,5,5),ke.strokeText(Le,5,5),_e.debugOverlayTexture.update(me),_e.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)}(p,te);const se=I._tileDebugTextBuffer||p.debugBuffer,re=I._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,de=I._tileDebugTextSegments||p.debugSegments;D.draw(m,v.TRIANGLES,P,V,h.ColorMode.alphaBlended,h.CullFaceMode.disabled,Rr(E,h.Color.transparent,oe),U,se,re,de,null,null,null,[I._globeTileDebugTextBuffer])}function is(p,r,c,m){Zs(p,0,r+c/2,p.transform.width,c,m)}function bu(p,r,c,m){Zs(p,r-c/2,0,c,p.transform.height,m)}function Zs(p,r,c,m,x,v){const C=p.context,A=C.gl;A.enable(A.SCISSOR_TEST),A.scissor(r*h.exported.devicePixelRatio,c*h.exported.devicePixelRatio,m*h.exported.devicePixelRatio,x*h.exported.devicePixelRatio),C.clear({color:v}),A.disable(A.SCISSOR_TEST)}const Ys=h.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ih}=Ys;function xo(p,r,c,m){p.emplaceBack(r,c,m)}class Pr{constructor(r){this.vertexArray=new h.StructArrayLayout3f12,this.indices=new h.StructArrayLayout3ui6,xo(this.vertexArray,-1,-1,1),xo(this.vertexArray,1,-1,1),xo(this.vertexArray,-1,1,1),xo(this.vertexArray,1,1,1),xo(this.vertexArray,-1,-1,-1),xo(this.vertexArray,1,-1,-1),xo(this.vertexArray,-1,1,-1),xo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Ih),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=h.SegmentVector.simpleSegment(0,0,36,12)}}function ns(p,r,c,m,x,v){const C=p.gl,A=r.paint.get("sky-atmosphere-color"),E=r.paint.get("sky-atmosphere-halo-color"),D=r.paint.get("sky-atmosphere-sun-intensity"),I={u_matrix_3f:h.fromMat4(h.create$1(),m),u_sun_direction:x,u_sun_intensity:D,u_color_tint_r:[(U=A).r,U.g,U.b,U.a],u_color_tint_m:[(j=E).r,j.g,j.b,j.a],u_luminance:5e-5};var U,j;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),c.draw(p,C.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.frontCW,I,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const il=h.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class nl{constructor(r){const c=new h.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new h.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,il.members),this.indexBuffer=r.createIndexBuffer(m),this.segments=h.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const rs={symbol:function(p,r,c,m,x){if("translucent"!==p.renderPass)return;const v=h.StencilMode.disabled,C=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(A,E,D,I,P,V,$){const U=E.transform,j="map"===P,H="map"===V;for(const N of A){const K=I.getTile(N),Z=K.getBucket(D);if(!Z||!Z.text||!Z.text.segments.get().length)continue;const ae=h.evaluateSizeForZoom(Z.textSizeData,U.zoom),oe=hn(N,Z.getProjection(),U),te=U.calculatePixelsToTileUnitsMatrix(K),se=Mt(oe,K.tileID.canonical,H,j,U,Z.getProjection(),te),re="none"!==D.layout.get("icon-text-fit")&&Z.hasIconData();if(ae){const de=Math.pow(2,U.zoom-K.tileID.overscaledZ);Un(Z,j,H,$,h.symbolSize,U,se,N,de,ae,re)}}}(m,p,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x),0!==c.paint.get("icon-opacity").constantOr(1)&&sc(p,r,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),v,C),0!==c.paint.get("text-opacity").constantOr(1)&&sc(p,r,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),v,C),r.map.showCollisionBoxes&&(rc(p,r,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),rc(p,r,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,c,m){if("translucent"!==p.renderPass)return;const x=c.paint.get("circle-opacity"),v=c.paint.get("circle-stroke-width"),C=c.paint.get("circle-stroke-opacity"),A=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===v.constantOr(1)||0===C.constantOr(1)))return;const E=p.context,D=E.gl,I=p.transform,P=p.depthModeForSublayer(0,h.DepthMode.ReadOnly),V=h.StencilMode.disabled,$=p.colorModeForRenderPass(),U="globe"===I.projection.name,j=[h.mercatorXfromLng(I.center.lng),h.mercatorYfromLat(I.center.lat)],H=[];for(let K=0;K<m.length;K++){const Z=m[K],ae=r.getTile(Z),oe=ae.getBucket(c);if(!oe||oe.projection.name!==I.projection.name)continue;const te=oe.programConfigurations.get(c.id),se=Ql(c);U&&se.push("PROJECTION_GLOBE_VIEW");const re=p.useProgram("circle",te,se),de=oe.layoutVertexBuffer,_e=oe.globeExtVertexBuffer,Le=oe.indexBuffer,me=I.projection.createInversionMatrix(I,Z.canonical),Ae={programConfiguration:te,program:re,layoutVertexBuffer:de,globeExtVertexBuffer:_e,indexBuffer:Le,uniformValues:Jl(p,Z,ae,me,j,c),tile:ae};if(A){const ke=oe.segments.get();for(const Ge of ke)H.push({segments:new h.SegmentVector([Ge]),sortKey:Ge.sortKey,state:Ae})}else H.push({segments:oe.segments,sortKey:0,state:Ae})}A&&H.sort((K,Z)=>K.sortKey-Z.sortKey);const N={useDepthForOcclusion:!U};for(const K of H){const{programConfiguration:Z,program:ae,layoutVertexBuffer:oe,globeExtVertexBuffer:te,indexBuffer:se,uniformValues:re,tile:de}=K.state,_e=K.segments;p.terrain&&p.terrain.setupElevationDraw(de,ae,N),p.prepareDrawProgram(E,ae,de.tileID.toUnwrapped()),ae.draw(E,D.TRIANGLES,P,V,$,h.CullFaceMode.disabled,re,c.id,oe,se,_e,c.paint,I.zoom,Z,[te])}},heatmap:function(p,r,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const x=p.context,v=x.gl,C=h.StencilMode.disabled,A=new h.ColorMode([v.ONE,v.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function($,U,j,H){const N=$.gl,K=U.width*H,Z=U.height*H;$.activeTexture.set(N.TEXTURE1),$.viewport.set([0,0,K,Z]);let ae=j.heatmapFbo;if(!ae||ae&&(ae.width!==K||ae.height!==Z)){ae&&ae.destroy();const oe=N.createTexture();N.bindTexture(N.TEXTURE_2D,oe),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),ae=j.heatmapFbo=$.createFramebuffer(K,Z,!1),function(te,se,re,de,_e,Le){const me=te.gl;me.texImage2D(me.TEXTURE_2D,0,me.RGBA,_e,Le,0,me.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:me.UNSIGNED_BYTE,null),de.colorAttachment.set(re)}($,0,oe,ae,K,Z)}else N.bindTexture(N.TEXTURE_2D,ae.colorAttachment.get()),$.bindFramebuffer.set(ae.framebuffer)})(x,p,c,"globe"===p.transform.projection.name?.5:.25),x.clear({color:h.Color.transparent});const E=p.transform,D="globe"===E.projection.name,I=D?["PROJECTION_GLOBE_VIEW"]:null,P=D?h.CullFaceMode.frontCCW:h.CullFaceMode.disabled,V=[h.mercatorXfromLng(E.center.lng),h.mercatorYfromLat(E.center.lat)];for(let $=0;$<m.length;$++){const U=m[$];if(r.hasRenderableParent(U))continue;const j=r.getTile(U),H=j.getBucket(c);if(!H||H.projection.name!==E.projection.name)continue;const N=H.programConfigurations.get(c.id),K=p.useProgram("heatmap",N,I),{zoom:Z}=p.transform;p.terrain&&p.terrain.setupElevationDraw(j,K),p.prepareDrawProgram(x,K,U.toUnwrapped());const ae=E.projection.createInversionMatrix(E,U.canonical);K.draw(x,v.TRIANGLES,h.DepthMode.disabled,C,A,P,ec(p,U,j,ae,V,Z,c.paint.get("heatmap-intensity")),c.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,c.paint,p.transform.zoom,N,D?[H.globeExtVertexBuffer]:null)}x.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(x,v){const C=x.context,A=C.gl,E=v.heatmapFbo;if(!E)return;C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,E.colorAttachment.get()),C.activeTexture.set(A.TEXTURE1);let D=v.colorRampTexture;D||(D=v.colorRampTexture=new h.Texture(C,v.colorRamp,A.RGBA)),D.bind(A.LINEAR,A.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(C,A.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,x.colorModeForRenderPass(),h.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,v.paint,x.transform.zoom)}(p,c))},line:function(p,r,c,m){if("translucent"!==p.renderPass)return;const x=c.paint.get("line-opacity"),v=c.paint.get("line-width");if(0===x.constantOr(1)||0===v.constantOr(1))return;const C=p.depthModeForSublayer(0,h.DepthMode.ReadOnly),A=p.colorModeForRenderPass(),E=p.terrain&&p.terrain.renderingToTexture?1:h.exported.devicePixelRatio,D=c.paint.get("line-dasharray"),I=D.constantOr(1),P=c.layout.get("line-cap"),V=c.paint.get("line-pattern"),$=V.constantOr(1),U=c.paint.get("line-gradient"),j=c.getCrossfadeParameters(),H=$?"linePattern":"line",N=p.context,K=N.gl,Z=(oe=>{const te=[];ts(oe)&&te.push("RENDER_LINE_DASH"),oe.paint.get("line-gradient")&&te.push("RENDER_LINE_GRADIENT");const se=oe.paint.get("line-trim-offset");0===se[0]&&0===se[1]||te.push("RENDER_LINE_TRIM_OFFSET");const re=oe.paint.get("line-pattern").constantOr(1),de=1!==oe.paint.get("line-opacity").constantOr(1);return!re&&de&&te.push("RENDER_LINE_ALPHA_DISCARD"),te})(c);let ae=Z.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ae=!1);for(const oe of m){const te=r.getTile(oe);if($&&!te.patternsLoaded())continue;const se=te.getBucket(c);if(!se)continue;p.prepareDrawTile();const re=se.programConfigurations.get(c.id),de=p.useProgram(H,re,Z),_e=V.constantOr(null);if(_e&&te.imageAtlas){const Te=te.imageAtlas,$e=Te.patternPositions[_e.to.toString()],Ne=Te.patternPositions[_e.from.toString()];$e&&Ne&&re.setConstantPatternPositions($e,Ne)}const Le=D.constantOr(null),me=P.constantOr(null);if(!$&&Le&&me&&te.lineAtlas){const Te=te.lineAtlas,$e=Te.getDash(Le.to,me),Ne=Te.getDash(Le.from,me);$e&&Ne&&re.setConstantPatternPositions($e,Ne)}let[Ae,ke]=c.paint.get("line-trim-offset");("round"===me||"square"===me)&&Ae!==ke&&(0===Ae&&(Ae-=1),1===ke&&(ke+=1));const Ge=p.terrain?oe.projMatrix:null,be=$?go(p,te,c,j,Ge,E):dn(p,te,c,j,Ge,se.lineClipsArray.length,E,[Ae,ke]);if(U){const Te=se.gradients[c.id];let $e=Te.texture;if(c.gradientVersion!==Te.version){let Ne=256;if(c.stepInterpolant){const Qe=r.getSource().maxzoom,nt=oe.canonical.z===Qe?Math.ceil(1<<p.transform.maxZoom-oe.canonical.z):1;Ne=h.clamp(h.nextPowerOfTwo(se.maxLineLength/h.EXTENT*1024*nt),256,N.maxTextureSize)}Te.gradient=h.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ne,image:Te.gradient||void 0,clips:se.lineClipsArray}),Te.texture?Te.texture.update(Te.gradient):Te.texture=new h.Texture(N,Te.gradient,K.RGBA),Te.version=c.gradientVersion,$e=Te.texture}N.activeTexture.set(K.TEXTURE1),$e.bind(c.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}I&&(N.activeTexture.set(K.TEXTURE0),te.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),re.updatePaintBuffers(j)),$&&(N.activeTexture.set(K.TEXTURE0),te.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),re.updatePaintBuffers(j)),p.prepareDrawProgram(N,de,oe.toUnwrapped());const Pe=Te=>{de.draw(N,K.TRIANGLES,C,Te,A,h.CullFaceMode.disabled,be,c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,p.transform.zoom,re,[se.layoutVertexBuffer2])};if(ae){const Te=p.stencilModeForClipping(oe).ref;0===Te&&p.terrain&&N.clear({stencil:0});const $e={func:K.EQUAL,mask:255};be.u_alpha_discard_threshold=.8,Pe(new h.StencilMode($e,Te,255,K.KEEP,K.KEEP,K.INVERT)),be.u_alpha_discard_threshold=0,Pe(new h.StencilMode($e,Te,255,K.KEEP,K.KEEP,K.KEEP))}else Pe(p.stencilModeForClipping(oe))}ae&&(p.resetStencilClippingMasks(),p.terrain&&N.clear({stencil:0}))},fill:function(p,r,c,m){const x=c.paint.get("fill-color"),v=c.paint.get("fill-opacity");if(0===v.constantOr(1))return;const C=p.colorModeForRenderPass(),A=c.paint.get("fill-pattern"),E=p.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===x.constantOr(h.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(p.renderPass===E){const D=p.depthModeForSublayer(1,"opaque"===p.renderPass?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly);tl(p,r,c,m,D,C,!1)}if("translucent"===p.renderPass&&c.paint.get("fill-antialias")){const D=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,h.DepthMode.ReadOnly);tl(p,r,c,m,D,C,!0)}},"fill-extrusion":function(p,r,c,m){const x=c.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===p.renderPass){const v=new h.DepthMode(p.context.gl.LEQUAL,h.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==x||c.paint.get("fill-extrusion-pattern").constantOr(1))br(p,r,c,m,v,h.StencilMode.disabled,h.ColorMode.disabled),br(p,r,c,m,v,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const C=p.colorModeForRenderPass();br(p,r,c,m,v,h.StencilMode.disabled,C)}}},hillshade:function(p,r,c,m){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const x=p.context,v=p.depthModeForSublayer(0,h.DepthMode.ReadOnly),C=p.colorModeForRenderPass(),A=p.terrain&&p.terrain.renderingToTexture,[E,D]="translucent"!==p.renderPass||A?[{},m]:p.stencilConfigForOverlap(m);for(const I of D){const P=r.getTile(I);if(P.needsHillshadePrepare&&"offscreen"===p.renderPass)Ko(p,P,c,v,h.StencilMode.disabled,C);else if("translucent"===p.renderPass){const V=A&&p.terrain?p.terrain.stencilModeForRTTOverlap(I):E[I.overscaledZ];Yl(p,I,P,c,v,V,C)}}x.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,c,m,x,v){if("translucent"!==p.renderPass||0===c.paint.get("raster-opacity")||!m.length)return;const C=p.context,A=C.gl,E=r.getSource(),D=p.useProgram("raster"),I=p.colorModeForRenderPass(),P=p.terrain&&p.terrain.renderingToTexture,[V,$]=E instanceof pe||P?[{},m]:p.stencilConfigForOverlap(m),U=$[$.length-1].overscaledZ,j=!p.options.moving;for(const H of $){const N=P?h.DepthMode.disabled:p.depthModeForSublayer(H.overscaledZ-U,1===c.paint.get("raster-opacity")?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly,A.LESS),K=H.toUnwrapped(),Z=r.getTile(H);if(P&&(!Z||!Z.hasData()))continue;const ae=P?H.projMatrix:p.transform.calculateProjMatrix(K,j),oe=p.terrain&&P?p.terrain.stencilModeForRTTOverlap(H):V[H.overscaledZ],te=v?0:c.paint.get("raster-fade-duration");Z.registerFadeDuration(te);const se=r.findLoadedParent(H,0),re=Xa(Z,se,r,p.transform,te);let de,_e;p.terrain&&p.terrain.prepareDrawTile();const Le="nearest"===c.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;C.activeTexture.set(A.TEXTURE0),Z.texture.bind(Le,A.CLAMP_TO_EDGE),C.activeTexture.set(A.TEXTURE1),se?(se.texture.bind(Le,A.CLAMP_TO_EDGE),de=Math.pow(2,se.tileID.overscaledZ-Z.tileID.overscaledZ),_e=[Z.tileID.canonical.x*de%1,Z.tileID.canonical.y*de%1]):Z.texture.bind(Le,A.CLAMP_TO_EDGE);const me=fu(ae,_e||[0,0],de||1,re,c,E instanceof pe?E.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(C,D,K),E instanceof pe)E.boundsBuffer&&E.boundsSegments&&D.draw(C,A.TRIANGLES,N,h.StencilMode.disabled,I,h.CullFaceMode.disabled,me,c.id,E.boundsBuffer,p.quadTriangleIndexBuffer,E.boundsSegments);else{const{tileBoundsBuffer:Ae,tileBoundsIndexBuffer:ke,tileBoundsSegments:Ge}=p.getTileBoundsBuffers(Z);D.draw(C,A.TRIANGLES,N,oe,I,h.CullFaceMode.disabled,me,c.id,Ae,ke,Ge)}}p.resetStencilClippingMasks()},background:function(p,r,c,m){const x=c.paint.get("background-color"),v=c.paint.get("background-opacity");if(0===v)return;const C=p.context,A=C.gl,E=p.transform,D=E.tileSize,I=c.paint.get("background-pattern");if(p.isPatternMissing(I))return;const P=!I&&1===x.a&&1===v&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==P)return;const V=h.StencilMode.disabled,$=p.depthModeForSublayer(0,"opaque"===P?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly),U=p.colorModeForRenderPass(),j=p.useProgram(I?"backgroundPattern":"background");let H,N=m;N||(H=p.getBackgroundTiles(),N=Object.values(H).map(Z=>Z.tileID)),I&&(C.activeTexture.set(A.TEXTURE0),p.imageManager.bind(p.context));const K=c.getCrossfadeParameters();for(const Z of N){const ae=Z.toUnwrapped(),oe=m?Z.projMatrix:p.transform.calculateProjMatrix(ae);p.prepareDrawTile();const te=r?r.getTile(Z):H?H[Z.key]:new h.Tile(Z,D,E.zoom,p),se=I?gu(oe,v,p,I,{tileID:Z,tileSize:D},K):Dh(oe,v,x);p.prepareDrawProgram(C,j,ae);const{tileBoundsBuffer:re,tileBoundsIndexBuffer:de,tileBoundsSegments:_e}=p.getTileBoundsBuffers(te);j.draw(C,A.TRIANGLES,$,V,U,h.CullFaceMode.disabled,se,c.id,re,de,_e)}},sky:function(p,r,c){const m=p.transform,x="mercator"===m.projection.name||"globe"===m.projection.name?1:h.smoothstep(7,8,m.zoom),v=c.paint.get("sky-opacity")*x;if(0===v)return;const C=p.context,A=c.paint.get("sky-type"),E=new h.DepthMode(C.gl.LEQUAL,h.DepthMode.ReadOnly,[0,1]),D=p.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===p.renderPass?c.needsSkyboxCapture(p)&&(function(I,P,V,$){const U=I.context,j=U.gl;let H=P.skyboxFbo;if(!H){H=P.skyboxFbo=U.createFramebuffer(32,32,!1),P.skyboxGeometry=new Pr(U),P.skyboxTexture=U.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,P.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let ae=0;ae<6;++ae)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(H.framebuffer),U.viewport.set([0,0,32,32]);const N=P.getCenter(I,!0),K=I.useProgram("skyboxCapture"),Z=new Float64Array(16);h.identity(Z),h.rotateY(Z,Z,.5*-Math.PI),ns(U,P,K,Z,N,0),h.identity(Z),h.rotateY(Z,Z,.5*Math.PI),ns(U,P,K,Z,N,1),h.identity(Z),h.rotateX(Z,Z,.5*-Math.PI),ns(U,P,K,Z,N,2),h.identity(Z),h.rotateX(Z,Z,.5*Math.PI),ns(U,P,K,Z,N,3),h.identity(Z),ns(U,P,K,Z,N,4),h.identity(Z),h.rotateY(Z,Z,Math.PI),ns(U,P,K,Z,N,5),U.viewport.set([0,0,I.width,I.height])}(p,c),c.markSkyboxValid(p)):"sky"===p.renderPass&&function(I,P,V,$,U){const j=I.context,H=j.gl,N=I.transform,K=I.useProgram("skybox");j.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,P.skyboxTexture);const Z={u_matrix:N.skyboxMatrix,u_sun_direction:P.getCenter(I,!1),u_cubemap:0,u_opacity:$,u_temporal_offset:U};I.prepareDrawProgram(j,K),K.draw(j,H.TRIANGLES,V,h.StencilMode.disabled,I.colorModeForRenderPass(),h.CullFaceMode.backCW,Z,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(p,c,E,v,D):"gradient"===A&&"sky"===p.renderPass&&function(I,P,V,$,U){const j=I.context,H=j.gl,N=I.transform,K=I.useProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new Pr(j)),j.activeTexture.set(H.TEXTURE0);let Z=P.colorRampTexture;Z||(Z=P.colorRampTexture=new h.Texture(j,P.colorRamp,H.RGBA)),Z.bind(H.LINEAR,H.CLAMP_TO_EDGE);const ae=(oe=N.skyboxMatrix,te=P.getCenter(I,!1),se=P.paint.get("sky-gradient-radius"),re=$,de=U,{u_matrix:oe,u_color_ramp:0,u_center_direction:te,u_radius:h.degToRad(se),u_opacity:re,u_temporal_offset:de});var oe,te,se,re,de;I.prepareDrawProgram(j,K),K.draw(j,H.TRIANGLES,V,h.StencilMode.disabled,I.colorModeForRenderPass(),h.CullFaceMode.backCW,ae,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(p,c,E,v,D)},debug:function(p,r,c){for(let m=0;m<c.length;m++)Rt(p,r,c[m])},custom:function(p,r,c){const m=p.context,x=c.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))h.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const v=x.prerender;v&&(p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),v.call(x,m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),m.setStencilMode(h.StencilMode.disabled);const v="3d"===x.renderingMode?new h.DepthMode(p.context.gl.LEQUAL,h.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,h.DepthMode.ReadOnly);m.setDepthMode(v),x.render(m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState(),m.bindFramebuffer.set(null)}}};class wu{constructor(r,c){this.context=new W(r),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=h.SourceCache.maxUnderzooming+h.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vs,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,c){const m=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Th(this,r));const x=this._terrain;this.transform.elevation=m?x:null,x.update(r,this.transform,c)}_updateFog(r){const c=r.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=c.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const v=m+.78*(x-m);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,c){if(this.width=r*h.exported.devicePixelRatio,this.height=c*h.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const r=this.context,c=new h.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(h.EXTENT,0),c.emplaceBack(0,h.EXTENT),c.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(c,h.posAttributes.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const m=new h.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(h.EXTENT,0),m.emplaceBack(0,h.EXTENT),m.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=r.createVertexBuffer(m,h.posAttributes.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const x=new h.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(x,h.posAttributes.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const v=new h.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(h.EXTENT,0,h.EXTENT,0),v.emplaceBack(0,h.EXTENT,0,h.EXTENT),v.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(v,h.boundsAttributes.members),this.mercatorBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const C=new h.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(C);const A=new h.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])A.emplaceBack(D);this.debugIndexBuffer=r.createIndexBuffer(A),this.emptyTexture=new h.Texture(r,new h.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=h.create();const E=this.context.gl;this.stencilClearMode=new h.StencilMode({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(h.window.performance.now()),this.atmosphereBuffer=new nl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,c=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,c.TRIANGLES,h.DepthMode.disabled,this.stencilClearMode,h.ColorMode.disabled,h.CullFaceMode.disabled,uu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,m){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const E of m)if(void 0===this._tileClippingMaskIDs[E.key]){A=!0;break}if(!A)return}this.currentStencilSource=c.id;const x=this.context,v=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(h.ColorMode.disabled),x.setDepthMode(h.DepthMode.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of m){const E=c.getTile(A),D=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:P,tileBoundsSegments:V}=this.getTileBoundsBuffers(E);C.draw(x,v.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,uu(A.projMatrix),"$clipping",I,P,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new h.StencilMode({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new h.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,m=r.sort((C,A)=>A.overscaledZ-C.overscaledZ),x=m[m.length-1].overscaledZ,v=m[0].overscaledZ-x+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const C={};for(let A=0;A<v;A++)C[A+x]=new h.StencilMode({func:c.GEQUAL,mask:255},A+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[C,m]}return[{[x]:h.StencilMode.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new h.ColorMode([r.CONSTANT_COLOR,r.ONE],new h.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?h.ColorMode.unblended:h.ColorMode.alphaBlended}depthModeForSublayer(r,c,m){if(!this.opaquePassEnabledForLayer())return h.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new h.DepthMode(m||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,c){this.style=r,this.options=c,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const m=this.style.order,x=this.style._sourceCaches;for(const E in x){const D=x[E];D.used&&D.prepare(this.context)}const v={},C={},A={};for(const E in x){const D=x[E];v[E]=D.getVisibleCoordinates(),C[E]=v[E].slice().reverse(),A[E]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<m.length;E++)if(this.style._layers[m[E]].is3D()){this.opaquePassCutoff=E;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new h.GlobeSharedBuffers(this.context)),h.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const E of m){const D=this.style._layers[E],I=r._getLayerSourceCache(D);if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const P=I?C[I.id]:void 0;("custom"===D.type||D.isSky()||P&&P.length)&&this.renderLayer(this,I,D,P)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?h.Color.black:h.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(E);if(E.isSky())continue;const I=D?C[D.id]:void 0;this._renderTileClippingMasks(E,D,I),this.renderLayer(this,D,E,I)}if(this.style.fog&&this.transform.projection.supportsFog&&function(E,D){const I=E.context,P=I.gl,V=E.transform,$=new h.DepthMode(P.LEQUAL,h.DepthMode.ReadOnly,[0,1]),U=E.useProgram("globeAtmosphere",null,"globe"===V.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),j=h.globeToMercatorTransition(V.zoom),H=D.properties.get("color").toArray01(),N=D.properties.get("high-color").toArray01(),K=D.properties.get("space-color").toArray01PremultipliedAlpha(),Z=h.identity$1([]);h.rotateY$1(Z,Z,-h.degToRad(V._center.lng)),h.rotateX$1(Z,Z,h.degToRad(V._center.lat)),h.rotateZ$1(Z,Z,V.angle),h.rotateX$1(Z,Z,-V._pitch);const ae=h.fromQuat(new Float32Array(16),Z),oe=h.mapValue(D.properties.get("star-intensity"),0,1,0,.25),se=h.mapValue(D.properties.get("horizon-blend"),0,1,5e-4,.25),re=h.globeUseCustomAntiAliasing(E,I,V)&&5e-4===se?V.worldSize/(2*Math.PI*1.025)-1:V.globeRadius,de=E.frameCounter/1e3%1,_e=h.length(V.globeCenterInViewSpace),Le=Math.sqrt(Math.pow(_e,2)-Math.pow(re,2)),me=Math.acos(Le/_e),Ae={u_frustum_tl:V.frustumCorners.TL,u_frustum_tr:V.frustumCorners.TR,u_frustum_br:V.frustumCorners.BR,u_frustum_bl:V.frustumCorners.BL,u_horizon:V.frustumCorners.horizon,u_transition:j,u_fadeout_range:se,u_color:H,u_high_color:N,u_space_color:K,u_star_intensity:oe,u_star_size:5*h.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:de,u_horizon_angle:me,u_rotation_matrix:ae};E.prepareDrawProgram(I,U);const ke=E.atmosphereBuffer;ke&&U.draw(I,P.TRIANGLES,$,h.StencilMode.disabled,h.ColorMode.alphaBlended,h.CullFaceMode.backCW,Ae,"skybox",ke.vertexBuffer,ke.indexBuffer,ke.segments)}(this,this.style.fog),this.renderPass="sky",(h.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const E=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(E);E.isSky()&&this.renderLayer(this,D,E,D?C[D.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const E=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(E);if(E.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(E)){if(E.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const I=D?("symbol"===E.type?A:C)[D.id]:void 0;this._renderTileClippingMasks(E,D,D?v[D.id]:void 0),this.renderLayer(this,D,E,I),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let E=null;h.values(this.style._layers).forEach(D=>{const I=r._getLayerSourceCache(D);I&&!D.isHidden(this.transform.zoom)&&(!E||E.getSource().maxzoom<I.getSource().maxzoom)&&(E=I)}),E&&this.options.showTileBoundaries&&rs.debug(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const D=E.transform.padding;is(E,E.transform.height-(D.top||0),3,xu),is(E,D.bottom||0,3,_o),bu(E,D.left||0,3,Qn),bu(E,E.transform.width-(D.right||0),3,vu);const I=E.transform.centerPoint;var P,V,$,U;Zs(P=E,(V=I.x)-1,($=E.transform.height-I.y)-10,2,20,U=yo),Zs(P,V-10,$-1,20,2,U)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(h.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,c,m,x){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(m.type)||rs[m.type](r,c,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[r.id];m||(m=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),r.beginQueryEXT(r.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const m in r){const x=r[m],v=this.context.extTimerQuery,C=v.getQueryObjectEXT(x.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(x.query),c[m]=C}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let m=0;for(const x of r)m+=c.getQueryObjectEXT(x,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(x);return m}translatePosMatrix(r,c,m,x,v){if(!m[0]&&!m[1])return r;const C=v?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(C){const D=Math.sin(C),I=Math.cos(C);m=[m[0]*I-m[1]*D,m[0]*D+m[1]*I]}const A=[v?m[0]:Zn(c,m[0],this.transform.zoom),v?m[1]:Zn(c,m[1],this.transform.zoom),0],E=new Float32Array(16);return h.translate(E,r,A),E}saveTileTexture(r){const c=this._tileTextures[r.size[0]];c?c.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const c=this.imageManager.getPattern(r.from.toString()),m=this.imageManager.getPattern(r.to.toString());return!c||!m}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),c&&!r&&0!==c.getOpacity(this.transform.pitch)&&m.push("FOG"),r&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(r,c,m){this.cache=this.cache||{};const x=m||[],v=this.currentGlobalDefines().concat(x),C=du.cacheKey(qa[r],r,v,c);return this.cache[C]||(this.cache[C]=new du(this.context,r,qa[r],c,_u[r],v)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=h.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const v=x.getOpacity(this.transform.pitch),C=((A,E,D,I,P,V,$,U,j,H,N)=>{const K=A.transform,Z=E.properties.get("color").toArray01();Z[3]=I;const ae=A.frameCounter/1e3%1;return{u_fog_matrix:D?K.calculateFogTileMatrix(D):A.identityMat,u_fog_range:E.getFovAdjustedRange(K._fov),u_fog_color:Z,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:ae,u_frustum_tl:P,u_frustum_tr:V,u_frustum_br:$,u_frustum_bl:U,u_globe_pos:j,u_globe_radius:H,u_viewport:N,u_globe_transition:h.globeToMercatorTransition(K.zoom),u_is_globe:+("globe"===K.projection.name)}})(this,x,m,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*h.exported.devicePixelRatio,this.transform.height*h.exported.devicePixelRatio]);c.setFogUniformValues(r,C)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)c[x.key]=r[x.key]||new h.Tile(x,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class rl{constructor(r=0,c=0,m=0,x=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=m,this.right=x}interpolate(r,c,m){return null!=c.top&&null!=r.top&&(this.top=h.number(r.top,c.top,m)),null!=c.bottom&&null!=r.bottom&&(this.bottom=h.number(r.bottom,c.bottom,m)),null!=c.left&&null!=r.left&&(this.left=h.number(r.left,c.left,m)),null!=c.right&&null!=r.right&&(this.right=h.number(r.right,c.right,m)),this}getCenter(r,c){const m=h.clamp((this.left+r-this.right)/2,0,r),x=h.clamp((this.top+c-this.bottom)/2,0,c);return new h.pointGeometry(m,x)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new rl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Cu(p,r){const c=h.getColumn(p,3);h.fromQuat(p,r),h.setColumn(p,3,c)}function Ws(p,r){const c=h.identity$1([]);return h.rotateZ$1(c,c,-r),h.rotateX$1(c,c,-p),c}function Xs(p,r){const c=[p[0],p[1],0],m=[r[0],r[1],0];if(h.length(c)>=1e-15){const C=h.normalize([],c);h.scale$2(m,C,h.dot(m,C)),r[0]=m[0],r[1]=m[1]}const x=h.cross([],r,p);if(h.len(x)<1e-15)return null;const v=Math.atan2(-x[1],x[0]);return Ws(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),v)}class Ye{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof h.MercatorCoordinate?r:new h.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=h.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(r)):0,x=this.position,v=h.MercatorCoordinate.fromLngLat(r,m),C=[v.x-x.x,v.y-x.y,v.z-x.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Xs(C,c)}setPitchBearing(r,c){this.orientation=Ws(h.degToRad(r),h.degToRad(-c))}}class Pt{constructor(r,c){this._transform=h.identity([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new h.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=h.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&h.setColumn(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||h.identity$1([]),r&&Cu(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=Ws(r,c),Cu(this._transform,this._orientation)}forward(){const r=h.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=h.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=h.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const m=new Float64Array(16);return h.invert(m,this.getWorldToCamera(r,c)),m}getWorldToCameraPosition(r,c,m){const x=this.position;h.scale$2(x,x,-r);const v=new Float64Array(16);return h.fromScaling(v,[m,m,m]),h.translate(v,v,x),v[10]*=c,v}getWorldToCamera(r,c){const m=new Float64Array(16),x=new Float64Array(4),v=this.position;return h.conjugate(x,this._orientation),h.scale$2(v,v,-r),h.fromQuat(m,x),h.translate(m,m,v),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(r,c,m,x){const v=new Float64Array(16);return h.perspective(v,r,c,m,x),v}getDistanceToElevation(r){const c=0===r?0:h.mercatorZfromAltitude(r,this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new Pt([...this.position],[...this.orientation])}}function vi(p,r){const c=os(p.projection,p.zoom,p.width,p.height),m=function(v,C,A,E,D){const I=new h.LngLat(A.lng-180*Ht,A.lat),P=new h.LngLat(A.lng+180*Ht,A.lat),V=v.project(I.lng,I.lat),$=v.project(P.lng,P.lat),U=-Math.atan2($.y-V.y,$.x-V.x),j=h.MercatorCoordinate.fromLngLat(A);j.y=h.clamp(j.y,-.999975,.999975);const H=j.toLngLat(),N=v.project(H.lng,H.lat),K=h.MercatorCoordinate.fromLngLat(H);K.x+=Ht;const Z=K.toLngLat(),ae=v.project(Z.lng,Z.lat),oe=ft(ae.x-N.x,ae.y-N.y,U),te=h.MercatorCoordinate.fromLngLat(H);te.y+=Ht;const se=te.toLngLat(),re=v.project(se.lng,se.lat),de=ft(re.x-N.x,re.y-N.y,U),_e=Math.abs(oe.x)/Math.abs(de.y),Le=h.identity([]);h.rotateZ(Le,Le,-U*(1-(D?0:E)));const me=h.identity([]);return h.scale(me,me,[1,1-(1-_e)*E,1]),me[4]=-de.x/de.y*E,h.rotateZ(me,me,U),h.multiply(me,Le,me),me}(p.projection,0,p.center,c,r),x=ol(p);return h.scale(m,m,[x,x,1]),m}function ol(p){const r=p.projection,c=os(p.projection,p.zoom,p.width,p.height),m=sl(r,p.center),x=sl(r,h.LngLat.convert(r.center));return Math.pow(2,m*c+(1-c)*x)}function os(p,r,c,m,x=1/0){const v=p.range;if(!v)return 0;const C=Math.min(x,Math.max(c,m)),A=Math.log(C/1024)/Math.LN2;return h.smoothstep(v[0]+A,v[1]+A,r)}const Ht=1/4e4;function sl(p,r){const c=h.clamp(r.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),m=new h.LngLat(r.lng-180*Ht,c),x=new h.LngLat(r.lng+180*Ht,c),v=p.project(m.lng,c),C=p.project(x.lng,c),A=h.MercatorCoordinate.fromLngLat(m),E=h.MercatorCoordinate.fromLngLat(x),D=C.x-v.x,I=C.y-v.y,P=E.x-A.x,V=E.y-A.y,$=Math.sqrt((P*P+V*V)/(D*D+I*I));return Math.log($)/Math.LN2}function ft(p,r,c){const m=Math.cos(c),x=Math.sin(c);return{x:p*m-r*x,y:p*x+r*m}}class Ri{constructor(r,c,m,x,v,C,A){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(C),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new rl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Pt,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Ri(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||c)&&this._updateCameraOnTerrain(),(r||c)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return h.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=h.getProjection(this.projectionOptions);const m=!Be(c,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=h.getProjection({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return h.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return h.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;var m,x,v,C,A,E,D,I,P,V;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),x=this.rotationMatrix,C=this.angle,A=(v=this.rotationMatrix)[0],E=v[1],D=v[2],I=v[3],P=Math.sin(C),V=Math.cos(C),x[0]=A*V+D*P,x[1]=E*V+I*P,x[2]=A*-P+D*V,x[3]=E*-P+I*V)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=h.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,v=0;for(let C=0;C<c.length;C++){const A=new h.pointGeometry(c[C][0]*this.width,m+c[C][1]*(this.height-m)),E=r.pointCoordinate(A);if(!E)continue;const D=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);x+=E[3]*D,v+=D}return 0===v?NaN:x/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),C=Math.max(x-m,v);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let m;m=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const x=h.length(h.sub([],this._camera.position,m));return h.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!h.exactEquals(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const m=[r.position.x,r.position.y,r.position.z];h.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new Ye;return c.position=new h.MercatorCoordinate(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!h.length$1(r))return!1;h.normalize$1(r,r);const c=h.transformQuat([],[0,0,-1],r),m=h.transformQuat([],[0,-1,0],r);if(m[2]<0)return!1;const x=Xs(c,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;r[2]=h.clamp(r[2],x/m,x/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,m){this._unmodified=!1,this._edgeInsets.interpolate(r,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new h.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const m=this.pointCoordinate(new h.pointGeometry(0,0)),x=this.pointCoordinate(new h.pointGeometry(this.width,0)),v=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),C=this.pointCoordinate(new h.pointGeometry(0,this.height)),A=Math.floor(Math.min(m.x,x.x,v.x,C.x)),E=Math.floor(Math.max(m.x,x.x,v.x,C.x)),D=1;for(let I=A-D;I<=E+D;I++)0!==I&&c.push(new h.UnwrappedTileID(I,r))}return c}coveringTiles(r){let c=this.coveringZoomLevel(r);const m=c,x=this.elevation&&!r.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==r.minzoom&&c<r.minzoom)return[];void 0!==r.maxzoom&&c>r.maxzoom&&(c=r.maxzoom);const C=this.locationCoordinate(this.center),A=this.center.lat,E=1<<c,D=[E*C.x,E*C.y,0],I="globe"===this.projection.name,P=!I,V=h.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,P),$=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=E*h.mercatorZfromAltitude(1,this.center.lat),j=this._camera.position[2]/h.mercatorZfromAltitude(1,this.center.lat),H=[E*$.x,E*$.y,j*(P?1:U)],N=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,Z=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ae=r.isTerrainDEM?-Z:this._elevation?this._elevation.getMinElevationBelowMSL():0,oe=this.projection.isReprojectedInTileSpace?ol(this):1,te=be=>{const Te=new h.MercatorCoordinate(be.x+25e-6,be.y,be.z),$e=new h.MercatorCoordinate(be.x,be.y+25e-6,be.z),Ne=be.toLngLat(),Qe=Te.toLngLat(),nt=$e.toLngLat(),lt=this.locationCoordinate(Ne),Tt=this.locationCoordinate(Qe),Je=this.locationCoordinate(nt),pt=Math.hypot(Tt.x-lt.x,Tt.y-lt.y),zt=Math.hypot(Je.x-lt.x,Je.y-lt.y);return Math.sqrt(pt*zt)*oe/25e-6},se=be=>{const Pe=Z,Te=ae;return{aabb:h.tileAABB(this,E,0,0,0,be,Te,Pe,this.projection),zoom:0,x:0,y:0,minZ:Te,maxZ:Pe,wrap:be,fullyVisible:!1}},re=[];let de=[];const _e=c,Le=r.reparseOverscaled?m:c,me=be=>be*be,Ae=me((j-this._centerAltitude)*U),ke=be=>{if(!this._elevation||!be.tileID||!v)return;const Pe=this._elevation.getMinMaxForTile(be.tileID),Te=be.aabb;Pe?(Te.min[2]=Pe.min,Te.max[2]=Pe.max,Te.center[2]=(Te.min[2]+Te.max[2])/2):(be.shouldSplit=Ge(be),be.shouldSplit||(Te.min[2]=Te.max[2]=Te.center[2]=this._centerAltitude))},Ge=be=>{if(be.zoom<K)return!0;if(be.zoom===_e)return!1;if(null!=be.shouldSplit)return be.shouldSplit;const Pe=be.aabb.distanceX(H),Te=be.aabb.distanceY(H);let $e=Ae,Ne=1;if(I){$e=me(be.aabb.distanceZ(H));const nt=Math.pow(2,be.zoom),lt=h.latFromMercatorY((be.y+1)/nt),Tt=h.latFromMercatorY(be.y/nt),Je=Math.min(Math.max(A,lt),Tt),pt=h.circumferenceAtLatitude(Je)/h.circumferenceAtLatitude(A);if(Ne=Je===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pt/this._mercatorScaleRatio),this.zoom<=h.GLOBE_ZOOM_THRESHOLD_MIN&&be.zoom===_e-1&&pt>=.9)return!0}else if(x&&($e=me(be.aabb.distanceZ(H)*U)),this.projection.isReprojectedInTileSpace&&m<=5){const nt=Math.pow(2,be.zoom),lt=te(new h.MercatorCoordinate((be.x+.5)/nt,(be.y+.5)/nt));Ne=lt>.85?1:lt}const Qe=Pe*Pe+Te*Te+$e;return Qe<me((1<<_e-be.zoom)*N*Ne*((nt,lt)=>{if(lt*me(.707)<nt)return 1;const Tt=Math.sqrt(lt/nt);return Tt/(1.4144271570014144+(Math.pow(1.1,Tt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max($e,Ae),Qe))};if(this.renderWorldCopies)for(let be=1;be<=3;be++)re.push(se(-be)),re.push(se(be));for(re.push(se(0));re.length>0;){const be=re.pop(),Pe=be.x,Te=be.y;let $e=be.fullyVisible;if(!$e){const Ne=be.aabb.intersects(V);if(0===Ne)continue;$e=2===Ne}if(be.zoom!==_e&&Ge(be))for(let Ne=0;Ne<4;Ne++){const Qe=(Pe<<1)+Ne%2,nt=(Te<<1)+(Ne>>1),lt={aabb:v?be.aabb.quadrant(Ne):h.tileAABB(this,E,be.zoom+1,Qe,nt,be.wrap,be.minZ,be.maxZ,this.projection),zoom:be.zoom+1,x:Qe,y:nt,wrap:be.wrap,fullyVisible:$e,tileID:void 0,shouldSplit:void 0,minZ:be.minZ,maxZ:be.maxZ};x&&!I&&(lt.tileID=new h.OverscaledTileID(be.zoom+1===_e?Le:be.zoom+1,be.wrap,be.zoom+1,Qe,nt),ke(lt)),re.push(lt)}else{const Ne=be.zoom===_e?Le:be.zoom;if(r.minzoom&&r.minzoom>Ne)continue;const Qe=D[0]-(.5+Pe+(be.wrap<<be.zoom))*(1<<c-be.zoom),nt=D[1]-.5-Te,lt=be.tileID?be.tileID:new h.OverscaledTileID(Ne,be.wrap,be.zoom,Pe,Te);de.push({tileID:lt,distanceSq:Qe*Qe+nt*nt})}}if(this.fogCullDistSq){const be=this.fogCullDistSq,Pe=this.horizonLineFromTop();de=de.filter(Te=>{const $e=[0,0,0,1],Ne=[h.EXTENT,h.EXTENT,0,1],Qe=this.calculateFogTileMatrix(Te.tileID.toUnwrapped());h.transformMat4$1($e,$e,Qe),h.transformMat4$1(Ne,Ne,Qe);const nt=h.getAABBPointSquareDist($e,Ne);if(0===nt)return!0;let lt=!1;const Tt=this._elevation;if(Tt&&nt>be&&0!==Pe){const Je=this.calculateProjMatrix(Te.tileID.toUnwrapped());let pt;r.isTerrainDEM||(pt=Tt.getMinMaxForTile(Te.tileID)),pt||(pt={min:ae,max:Z});const zt=h.furthestTileCorner(this.rotation),si=[zt[0]*h.EXTENT,zt[1]*h.EXTENT,pt.max];h.transformMat4(si,si,Je),lt=(1-si[1])*this.height*.5<Pe}return nt<be||lt})}return de.sort((be,Pe)=>be.distanceSq-Pe.distanceSq).map(be=>be.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=h.clamp(r.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),m=this.projection.project(r.lng,c);return new h.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,c){let m,x;const v=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;m=(c.x-v.x)/A,x=(c.y-v.y)/A}else{const A=this.pointCoordinate(c),E=this.pointCoordinate(v);m=A.x-E.x,x=A.y-E.y}const C=this.locationCoordinate(r);this.setLocation(new h.MercatorCoordinate(C.x-m,C.y-x))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,c){const m=c?h.mercatorZfromAltitude(c,r.lat):void 0,x=this.projection.project(r.lng,r.lat);return new h.MercatorCoordinate(x.x,x.y,m)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const m=c??this._centerAltitude,x=[r.x,r.y,0,1],v=[r.x,r.y,1,1];h.transformMat4$1(x,x,this.pixelMatrixInverse),h.transformMat4$1(v,v,this.pixelMatrixInverse);const C=v[3];h.scale$1(x,x,1/x[3]),h.scale$1(v,v,1/C);const A=x[2],E=v[2];return{p0:x,p1:v,t:A===E?0:(m-A)/(E-A)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],m=[r.x,r.y,1,1];return h.transformMat4$1(c,c,this.pixelMatrixInverse),h.transformMat4$1(m,m,this.pixelMatrixInverse),h.scale$1(c,c,1/c[3]),h.scale$1(m,m,1/m[3]),c[2]=h.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=h.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,h.scale$1(c,c,1/this.worldSize),h.scale$1(m,m,1/this.worldSize),new h.Ray([c[0],c[1],c[2]],h.normalize([],h.sub([],m,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:m,t:x}=r,v=h.mercatorZfromAltitude(c[2],this._center.lat),C=h.mercatorZfromAltitude(m[2],this._center.lat);return new h.MercatorCoordinate(h.number(c[0],m[0],x)/this.worldSize,h.number(c[1],m[1],x)/this.worldSize,h.number(v,C,x))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let c=this.projection.pointCoordinate3D(this,r.x,r.y);if(c)return new h.MercatorCoordinate(c[0],c[1],c[2]);let m=0,x=this.horizonLineFromTop();if(r.y>x)return this.pointCoordinate(r);const v=.02*x,C=r.clone();for(let A=0;A<10&&x-m>v;A++){C.y=h.number(m,x,.66);const E=this.projection.pointCoordinate3D(this,C.x,C.y);E?(x=C.y,c=E):m=C.y}return c?new h.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,x=[r.x*this.worldSize,r.y*this.worldSize,m+r.toAltitude(),1];return h.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new h.pointGeometry(x[0]/x[3],x[1]/x[3]):new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,c){const m=new h.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new h.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new h.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),C=new h.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(m,r),E=this.pointCoordinate(x,r);const D=this.pointCoordinate(v,c),I=this.pointCoordinate(C,c),P=(V,$)=>($.y-V.y)/($.x-V.x);return A.y>1&&E.y>=0?A=new h.MercatorCoordinate((1-I.y)/P(I,A)+I.x,1):A.y<0&&E.y<=1&&(A=new h.MercatorCoordinate(-I.y/P(I,A)+I.x,0)),E.y>1&&A.y>=0?E=new h.MercatorCoordinate((1-D.y)/P(D,E)+D.x,1):E.y<0&&A.y<=1&&(E=new h.MercatorCoordinate(-D.y/P(D,E)+D.x,0)),(new h.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(D))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const c=r.visibleDemTiles.reduce((m,x)=>{if(x.dem){const v=x.dem.tree;m.min=Math.min(m.min,v.minimums[0]),m.max=Math.max(m.max,v.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-h.MAX_MERCATOR_LATITUDE,this.maxLat=h.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=h.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=h.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=h.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,m=this._distanceTileDataCache;if(m[c])return m[c];const x=r.canonical,v=1/this.height,C=this.cameraWorldSize/this.zoomScale(x.z),A=(x.x+Math.pow(2,x.z)*r.wrap)*C,E=x.y*C,D=this.point,I=this.angle,P=Math.sin(-I),V=-Math.cos(-I);return m[c]={bearing:[P,V],center:[(D.x-A)*v,(D.y-E)*v],scale:C/h.EXTENT*v},m[c]}calculateFogTileMatrix(r){const c=r.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return h.multiply(x,this.worldToFogMatrix,x),m[c]=new Float32Array(x),m[c]}calculateProjMatrix(r,c=!1){const m=r.key,x=c?this._alignedProjMatrixCache:this._projMatrixCache;if(x[m])return x[m];const v=this.calculatePosMatrix(r,this.worldSize);return h.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,v),x[m]=new Float32Array(v),x[m]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const x=function(v,C){const{scale:A}=v.tileTransform,E=A*h.EXTENT/(v.tileSize*Math.pow(2,C.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return D=new Float32Array(4),V=(I=C.inverseAdjustmentMatrix)[1],$=I[2],U=I[3],H=(P=[E,E])[1],D[0]=I[0]*(j=P[0]),D[1]=V*j,D[2]=$*H,D[3]=U*H,D;var D,I,P,V,$,U,j,H}(r,this);return m[c]=x,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const c=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),x=this._camera.forward(),v=h.mercatorZfromAltitude(1,this._center.lat);m[2]/=v,x[2]/=v,h.normalize(x,x);const C=r.raycast(m,x,r.exaggeration());if(C){const A=h.scaleAndAdd([],m,x,C),E=new h.MercatorCoordinate(A[0],A[1],h.mercatorZfromAltitude(A[2],h.latFromMercatorY(A[1]))),D=(E.z+h.length([E.x-m[0],E.y-m[1],E.z-m[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const c=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),x=r.getAtPointOrZero(new h.MercatorCoordinate(...m)),v=this._minimumHeightOverTerrain()*Math.cos(h.degToRad(this._maxPitch)),C=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(C<v){const A=this.locationCoordinate(this._center,this._centerAltitude),E=[A.x-m[0],A.y-m[1],A.z-m[2]],D=h.length(E);E[2]-=(v-C)/this._pixelsPerMercatorPixel;const I=h.length(E);if(0===I)return;h.scale$2(E,E,D/I*this._pixelsPerMercatorPixel),this._camera.position=[A.x-E[0],A.y-E[1],A.z*this._pixelsPerMercatorPixel-E[2]],this._camera.orientation=Xs(E,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const V=this.center;return V.lat=h.clamp(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(V.lng=h.clamp(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const c=this._unmodified,{x:m,y:x}=this.point;let v=0,C=m,A=x;const E=this.width/2,D=this.height/2,I=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(x-D<I&&(A=I+D),x+D>P&&(A=P-D),P-I<this.height&&(v=Math.max(v,this.height/(P-I)),A=(P+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,U=this.worldSize/2-(V+$)/2;C=(m+U+this.worldSize)%this.worldSize-U,C-E<V&&(C=V+E),C+E>$&&(C=$-E),$-V<this.width&&(v=Math.max(v,this.width/($-V)),C=($+V)/2)}C===m&&A===x||(this.center=this.unproject(new h.pointGeometry(C,A))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=h.mercatorZfromAltitude(1,this.center.lat)/h.mercatorZfromAltitude(1,h.GLOBE_SCALE_MATCH_LATITUDE));const m=os(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?c:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-r.x/this.width,v[9]=2*r.y/this.height;let C=h.mul([],v,x);if(this.projection.isReprojectedInTileSpace){const oe=this.locationCoordinate(this.center),te=h.identity([]);h.translate(te,te,[oe.x*this.worldSize,oe.y*this.worldSize,0]),h.multiply(te,te,vi(this)),h.translate(te,te,[-oe.x*this.worldSize,-oe.y*this.worldSize,0]),h.multiply(C,C,te),this.inverseAdjustmentMatrix=function(se){const re=vi(se,!0);return to([],[re[0],re[1],re[4],re[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=h.scale([],C,[this.worldSize,this.worldSize,this.worldSize/c,1]),this.projMatrix=C,this.invProjMatrix=h.invert(new Float64Array(16),this.projMatrix);const A=h.invert([],v);this.frustumCorners=h.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const E=new Float32Array(16);h.identity(E),h.scale(E,E,[1,-1,1]),h.rotateX(E,E,this._pitch),h.rotateZ(E,E,this.angle);const D=h.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),I=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-r.x/this.width,D[9]=2*(r.y+I)/this.height,this.skyboxMatrix=h.multiply(E,D,E);const P=this.point,V=P.x,$=P.y,U=this.width%2/2,j=this.height%2/2,H=Math.cos(this.angle),N=Math.sin(this.angle),K=V-Math.round(V)+H*U+N*j,Z=$-Math.round($)+H*j+N*U,ae=new Float64Array(C);if(h.translate(ae,ae,[K>.5?K-1:K,Z>.5?Z-1:Z,0]),this.alignedProjMatrix=ae,C=h.create(),h.scale(C,C,[this.width/2,-this.height/2,1]),h.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=h.create(),h.scale(C,C,[1,-1,1]),h.translate(C,C,[-1,-1,0]),h.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=h.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=h.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=h.calculateGlobeMatrix(this);const oe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=h.transformMat4(oe,oe,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,c=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,c];h.scale$2(v,v,x),h.scale$2(m,m,-1),h.multiply$2(m,m,v);const C=h.create();h.translate(C,C,m),h.scale(C,C,v),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,x)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*v,x.y/this.worldSize-m[1]*v,r/this.worldSize*this._centerAltitude-m[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=r[2];let x=1;m>0&&(x=Math.min((c-this._camera.position[2])/m,1)),this._camera.position=h.scaleAndAdd([],this._camera.position,r,x),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),v=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.degToRad(this._maxPitch)),A=Math.max((r[2]-v)/Math.cos(m),C),E=this._zoomFromMercatorZ(A);h.scaleAndAdd(r,r,c,A),this._pitch=h.clamp(m,h.degToRad(this.minPitch),h.degToRad(this.maxPitch)),this.angle=h.wrap(x,-Math.PI,Math.PI),this._setZoom(h.clamp(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new h.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const m=Math.min(r.x,c.x),x=Math.max(r.x,c.x),v=Math.min(r.y,c.y),C=Math.max(r.y,c.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new h.pointGeometry(m,v),new h.pointGeometry(x,C),new h.pointGeometry(m,C),new h.pointGeometry(x,v)],E=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const I of A){const P=this.pointRayIntersection(I);if(P.t<0)return!0;const V=this.rayIntersectionCoordinate(P);if(V.x<E||V.y<0||V.x>D||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.pointGeometry(0,0),new h.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,c){const m=h.length(h.sub([],this._camera.position,r)),x=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const r=function(c,m){const x=[c[0],c[1],c[2],1];h.transformMat4$1(x,x,m);const v=Math.max(x[3],1e-6);return[x[0]/v,x[1]/v,x[2]/v,v]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new h.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,r))}}getCameraToCenterDistance(r){const c=os(r,this.zoom,this.width,this.height,1024),m=r.pixelSpaceConversion(this.center.lat,this.worldSize,c);return.5/Math.tan(.5*this._fov)*this.height*m}}function Ks(p,r){let c=!1,m=null;const x=()=>{m=null,c&&(p(),m=setTimeout(x,r),c=!1)};return()=>(c=!0,m||x(),m)}class lc{constructor(r){this._hashName=r&&encodeURIComponent(r),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ks(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,h.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),h.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=Ci(r);if(this._hashName){const m=this._hashName;let x=!1;const v=h.window.location.hash.slice(1).split("&").map(C=>{const A=C.split("=")[0];return A===m?(x=!0,`${A}=${c}`):C}).filter(C=>C);return x||v.push(`${m}=${c}`),`#${v.join("&")}`}return`#${c}`}_getCurrentHash(){const r=h.window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){const m=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=h.window.location.href.replace(/(#.+)?$/,this.getHashString());h.window.history.replaceState(h.window.history.state,null,r)}}function Ci(p,r){const c=p.getCenter(),m=Math.round(100*p.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,x),C=Math.round(c.lng*v)/v,A=Math.round(c.lat*v)/v,E=p.getBearing(),D=p.getPitch();let I=r?`/${C}/${A}/${m}`:`${m}/${A}/${C}`;return(E||D)&&(I+="/"+Math.round(10*E)/10),D&&(I+=`/${Math.round(D)}`),I}const Ni={linearity:.3,easing:h.bezier(0,0,.3,1)},ep=h.extend({deceleration:2500,maxSpeed:1400},Ni),ss=h.extend({deceleration:20,maxSpeed:1400},Ni),Ft=h.extend({deceleration:1e3,maxSpeed:360},Ni),al=h.extend({deceleration:1e3,maxSpeed:90},Ni);class cc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=h.exported.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const v=Js(c.pan.mag(),m,h.extend({},ep,r||{}));x.offset=c.pan.mult(v.amount/c.pan.mag()),x.center=this._map.transform.center,zr(x,v)}if(c.zoom){const v=Js(c.zoom,m,ss);x.zoom=this._map.transform.zoom+v.amount,zr(x,v)}if(c.bearing){const v=Js(c.bearing,m,Ft);x.bearing=this._map.transform.bearing+h.clamp(v.amount,-179,179),zr(x,v)}if(c.pitch){const v=Js(c.pitch,m,al);x.pitch=this._map.transform.pitch+v.amount,zr(x,v)}if(x.zoom||x.bearing){const v=void 0===c.pinchAround?c.around:c.pinchAround;x.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function zr(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function Js(p,r,c){const{maxSpeed:m,linearity:x,deceleration:v}=c,C=h.clamp(p*x/(r/1e3),-m,m),A=Math.abs(C)/(v*x);return{easing:c.easing,duration:1e3*A,amount:C*(A/2)}}class qi extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,m,x={}){const v=yt(c.getCanvasContainer(),m),C=c.unproject(v);super(r,h.extend({point:v,lngLat:C,originalEvent:m},x)),this._defaultPrevented=!1,this.target=c}}class as extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,m){const x="touchend"===r?m.changedTouches:m.touches,v=kn(c.getCanvasContainer(),x),C=v.map(E=>c.unproject(E)),A=v.reduce((E,D,I,P)=>E.add(D.div(P.length)),new h.pointGeometry(0,0));super(r,{points:v,point:A,lngLats:C,lngLat:c.unproject(A),originalEvent:m}),this._defaultPrevented=!1}}class Mu extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class Fh{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Mu(r.type,this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new qi(r.type,this._map,r))}mouseup(r){this._map.fire(new qi(r.type,this._map,r))}preclick(r){const c=h.extend({},r);c.type="preclick",this._map.fire(new qi(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new qi(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new qi(r.type,this._map,r))}mouseover(r){this._map.fire(new qi(r.type,this._map,r))}mouseout(r){this._map.fire(new qi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new as(r.type,this._map,r))}touchmove(r){this._map.fire(new as(r.type,this._map,r))}touchend(r){this._map.fire(new as(r.type,this._map,r))}touchcancel(r){this._map.fire(new as(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Au{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new qi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new qi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Su{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&0===r.button&&(Ea(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const m=c;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=m,this._box||(this._box=St("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(x.x,m.x),C=Math.max(x.x,m.x),A=Math.min(x.y,m.y),E=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${A}px)`,this._box.style.width=C-v+"px",this._box.style.height=E-A+"px")})}mouseupWindow(r,c){if(!this._active||0!==r.button)return;const m=this._startPos,x=c;if(this.reset(),No(),m.x!==x.x||m.y!==x.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Go(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new h.Event(r,{originalEvent:c}))}}function ll(p,r){const c={};for(let m=0;m<p.length;m++)c[p[m].identifier]=r[m];return c}class Qs{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const v=new h.pointGeometry(0,0);for(const C of x)v._add(C);return v.div(x.length)}(c),this.touches=ll(m,c)))}touchmove(r,c,m){if(this.aborted||!this.centroid)return;const x=ll(m,c);for(const v in this.touches){const C=this.touches[v],A=x[v];(!A||A.dist(C)>30)&&(this.aborted=!0)}}touchend(r,c,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class ls{constructor(r){this.singleTap=new Qs(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,m){this.singleTap.touchstart(r,c,m)}touchmove(r,c,m){this.singleTap.touchmove(r,c,m)}touchend(r,c,m){const x=this.singleTap.touchend(r,c,m);if(x){const v=r.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(x)<30;if(v&&C||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Eu{constructor(){this._zoomIn=new ls({numTouches:1,numTaps:2}),this._zoomOut=new ls({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,m){this._zoomIn.touchstart(r,c,m),this._zoomOut.touchstart(r,c,m)}touchmove(r,c,m){this._zoomIn.touchmove(r,c,m),this._zoomOut.touchmove(r,c,m)}touchend(r,c,m){const x=this._zoomIn.touchend(r,c,m),v=this._zoomOut.touchend(r,c,m);return x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(x)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Tu={0:1,2:2};class cs{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const m=Er(r);this._correctButton(r,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(r,c){const m=this._lastPoint;if(m)if(r.preventDefault(),null!=this._eventButton&&function(x,v){const C=Tu[v];return void 0===x.buttons||(x.buttons&C)!==C}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(r){this._lastPoint&&Er(r)===this._eventButton&&(this._moved&&No(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku extends cs{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return 0===c&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class Du extends cs{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const m=.8*(c.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class Pi extends cs{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const m=-.5*(c.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class Oh{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),h.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(r,c,m){return this._calculateTransform(r,c,m)}touchmove(r,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!h.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,m)}}touchend(r,c,m){this._calculateTransform(r,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,m){m.length>0&&(this._active=!0);const x=ll(m,c),v=new h.pointGeometry(0,0),C=new h.pointGeometry(0,0);let A=0;for(const D in x){const I=x[D],P=this._touches[D];P&&(v._add(I),C._add(I.sub(P)),A++,x[D]=I)}if(this._touches=x,A<this._minTouches||!C.mag())return;const E=C.div(A);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=St("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ea{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,m){return{}}touchstart(r,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,m){const x=this._firstTwoTouches;if(!x)return;r.preventDefault();const[v,C]=x,A=cl(m,c,v),E=cl(m,c,C);if(!A||!E)return;const D=this._aroundCenter?null:A.add(E).div(2);return this._move([A,E],D,r)}touchend(r,c,m){if(!this._firstTwoTouches)return;const[x,v]=this._firstTwoTouches,C=cl(m,c,x),A=cl(m,c,v);C&&A||(this._active&&No(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function cl(p,r,c){for(let m=0;m<p.length;m++)if(p[m].identifier===c)return r[m]}function Iu(p,r){return Math.log(p/r)/Math.LN2}class er extends ea{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Iu(this._distance,m),pinchAround:c}}}function ul(p,r){return 180*p.angleWith(r)/Math.PI}class vo extends ea{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ul(this._vector,m),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,m=ul(r,this._startVector);return Math.abs(m)<c}}function Fn(p){return Math.abs(p.y)>Math.abs(p.x)}class hl extends ea{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Fn(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,m){const x=this._lastPoints;if(!x)return;const v=r[0].sub(x[0]),C=r[1].sub(x[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(v,C,m.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+C.y)/2*-.5})}gestureBeginsVertically(r,c,m){if(void 0!==this._valid)return this._valid;const x=r.mag()>=2,v=c.mag()>=2;if(!x&&!v)return;if(!x||!v)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const C=r.y>0==c.y>0;return Fn(r)&&Fn(c)&&C}}const Ke={panStep:100,bearingStep:15,pitchStep:10};class uc{constructor(){const r=Ke;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,m=0,x=0,v=0,C=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?x=1:(r.preventDefault(),C=-1);break;case 40:r.shiftKey?x=-1:(r.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:A=>{const E=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:hc,zoom:c?Math.round(E)+c*(r.shiftKey?2:1):E,bearing:A.getBearing()+m*this._bearingStep,pitch:A.getPitch()+x*this._pitchStep,offset:[-v*this._panStep,-C*this._panStep],center:A.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hc(p){return p*(2-p)}const ta=4.000244140625;class us{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||h.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===h.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=h.exported.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%ta==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=yt(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const E="wheel"===this._type&&Math.abs(this._delta)>ta?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&0!==D&&(D=1/D);const I=c(),P=Math.pow(2,I),V="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):P;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(V*D))),"wheel"===this._type&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),x=this._startZoom,v=this._easing;let C,A=!1;if("wheel"===this._type&&x&&v){const E=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),D=v(E);C=h.number(x,m,D),E<1?this._frameId||(this._frameId=!0):A=!0}else C=m,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:C-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=h.ease;if(this._prevEase){const m=this._prevEase,x=(h.exported.now()-m.start)/m.duration,v=m.easing(x+.01)-m.easing(x),C=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-C*C);c=h.bezier(C,A,.25,1)}return this._prevEase={start:h.exported.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=St("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(h.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class dc{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pn{constructor(){this._tap=new ls({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,c,m))}touchmove(r,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=c[0],v=x.y-this._swipePoint.y;return this._swipePoint=x,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,c,m)}touchend(r,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(r,c,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lh{constructor(r,c,m){this._el=r,this._mousePan=c,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bo{constructor(r,c,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class dl{constructor(r,c,m,x){this._el=r,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Br=p=>p.zoom||p.drag||p.pitch||p.rotate;class pl extends h.Event{}class fl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const m=h.sub([],c,r);this.radius=h.length(m[2]<0?h.div([],m,this.constants):[m[0],m[1],0])}projectRay(r){h.div(r,r,this.constants),h.normalize(r,r),h.mul$1(r,r,this.constants);const c=h.scale$2([],r,this.radius);if(c[2]>0){const m=h.scale$2([],[0,0,1],h.dot(c,[0,0,1])),x=h.scale$2([],h.normalize([],[c[0],c[1],0]),this.radius),v=h.add([],c,h.scale$2([],h.sub([],h.add([],x,m),c),2));c[0]=v[0],c[1]=v[1]}return c}}function jn(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Ou{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cc(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new fl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),h.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[h.window.document,"mousemove",{capture:!0}],[h.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[h.window,"blur",void 0]];for(const[x,v,C]of this._listeners)x.addEventListener(v,x===h.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[r,c,m]of this._listeners)r.removeEventListener(c,r===h.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new Fh(c,r));const x=c.boxZoom=new Su(c,r);this._add("boxZoom",x);const v=new Eu,C=new Fu;c.doubleClickZoom=new dc(C,v),this._add("tapZoom",v),this._add("clickZoom",C);const A=new pn;this._add("tapDragZoom",A);const E=c.touchPitch=new hl(c);this._add("touchPitch",E);const D=new Du(r),I=new Pi(r);c.dragRotate=new bo(r,D,I),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const P=new ku(r),V=new Oh(c,r);c.dragPan=new Lh(m,P,V),this._add("mousePan",P),this._add("touchPan",V,["touchZoom","touchRotate"]);const $=new vo,U=new er;c.touchZoomRotate=new dl(m,U,$,A),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Au(c));const j=c.scrollZoom=new us(c,this);this._add("scrollZoom",j,["mousePan"]);const H=c.keyboard=new uc;this._add("keyboard",H);for(const N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[N]&&c[N].enable(r[N])}_add(r,c,m){this._handlers.push({handlerName:r,handler:c,allowed:m}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Br(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,c,m){for(const x in r)if(x!==m&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const m of r)this._el.contains(m.target)&&c.push(m);return c}handleEvent(r,c){this._updatingCamera=!0;const m="renderFrame"===r.type,x=m?void 0:r,v={needsRenderFrame:!1},C={},A={},E=r.touches?this._getMapTouches(r.touches):void 0,D=E?kn(this._el,E):m?void 0:yt(this._el,r);for(const{handlerName:V,handler:$,allowed:U}of this._handlers){if(!$.isEnabled())continue;let j;this._blockedByActive(A,U,V)?$.reset():$[c||r.type]&&(j=$[c||r.type](r,D,E),this.mergeHandlerResult(v,C,j,V,x),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||$.isActive())&&(A[V]=$)}const I={};for(const V in this._previousActiveHandlers)A[V]||(I[V]=x);this._previousActiveHandlers=A,(Object.keys(I).length||jn(v))&&(this._changes.push([v,C,I]),this._triggerRenderFrame()),(Object.keys(A).length||jn(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:P}=v;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))}mergeHandlerResult(r,c,m,x,v){if(!m)return;h.extend(r,m);const C={handlerName:x,originalEvent:m.originalEvent||v};void 0!==m.zoomDelta&&(c.zoom=C),void 0!==m.panDelta&&(c.drag=C),void 0!==m.pitchDelta&&(c.pitch=C),void 0!==m.bearingDelta&&(c.rotate=C)}_applyChanges(){const r={},c={},m={};for(const[x,v,C]of this._changes)x.panDelta&&(r.panDelta=(r.panDelta||new h.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(r.around=x.around),void 0!==x.aroundCoord&&(r.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(r.pinchAround=x.pinchAround),x.noInertia&&(r.noInertia=x.noInertia),h.extend(c,v),h.extend(m,C);this._updateMapTransform(r,c,m),this._changes=[]}_updateMapTransform(r,c,m){const x=this._map,v=x.transform,C=K=>[K.x,K.y,K.z];if((K=>{const Z=this._eventsInProgress.drag;return Z&&!this._handlersById[Z.handlerName].isActive()})()&&!jn(r)){const K=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",K!==v.zoom&&this._map._update(!0)}if(!jn(r))return void this._fireEvents(c,m,!0);let{panDelta:A,zoomDelta:E,bearingDelta:D,pitchDelta:I,around:P,aroundCoord:V,pinchAround:$}=r;void 0!==$&&(P=$),(K=>c.drag&&!this._eventsInProgress.drag)()&&P&&(this._dragOrigin=C(v.pointCoordinate3D(P)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",x._stop(!0),P=P||x.transform.centerPoint,D&&(v.bearing+=D),I&&(v.pitch+=I),v._updateCameraState();const U=[0,0,0];if(A)if("mercator"===v.projection.name){const K=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(P).dir),Z=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(P.sub(A)).dir);U[0]=Z[0]-K[0],U[1]=Z[1]-K[1]}else{const K=v.pointCoordinate(P);if("globe"===v.projection.name){A=A.rotate(-v.angle);const Z=v._pixelsPerMercatorPixel/v.worldSize;U[0]=-A.x*h.mercatorScale(h.latFromMercatorY(K.y))*Z,U[1]=-A.y*h.mercatorScale(v.center.lat)*Z}else{const Z=v.pointCoordinate(P.sub(A));K&&Z&&(U[0]=Z.x-K.x,U[1]=Z.y-K.y)}}const j=v.zoom,H=[0,0,0];if(E){const K=C(V||v.pointCoordinate3D(P)),Z={dir:h.normalize([],h.sub([],K,v._camera.position))};if(Z.dir[2]<0){const ae=v.zoomDeltaToMovement(K,E);h.scale$2(H,Z.dir,ae)}}const N=h.add(U,U,H);v._translateCameraConstrained(N),E&&Math.abs(v.zoom-j)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,m,!0)}_fireEvents(r,c,m){const x=Br(this._eventsInProgress),v=Br(r),C={};for(const I in r){const{originalEvent:P}=r[I];this._eventsInProgress[I]||(C[`${I}start`]=P),this._eventsInProgress[I]=r[I]}!x&&v&&this._fireEvent("movestart",v.originalEvent);for(const I in C)this._fireEvent(I,C[I]);v&&this._fireEvent("move",v.originalEvent);for(const I in r){const{originalEvent:P}=r[I];this._fireEvent(I,P)}const A={};let E;for(const I in this._eventsInProgress){const{handlerName:P,originalEvent:V}=this._eventsInProgress[I];this._handlersById[P].isActive()||(delete this._eventsInProgress[I],E=c[P]||V,A[`${I}end`]=E)}for(const I in A)this._fireEvent(I,A[I]);const D=Br(this._eventsInProgress);if(m&&(x||v)&&!D){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=V=>0!==V&&-this._bearingSnap<V&&V<this._bearingSnap;I?(P(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:E})):(this._map.fire(new h.Event("moveend",{originalEvent:E})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new h.Event(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new pl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const pc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Lu extends h.Evented{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,m){return r=h.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,h.extend({offset:r},c),m)}panTo(r,c,m){return this.easeTo(h.extend({center:r},c),m)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,m){return this.easeTo(h.extend({zoom:r},c),m)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,m){return this.easeTo(h.extend({bearing:r},c),m)}resetNorth(r,c){return this.rotateTo(0,h.extend({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){"globe"===this.transform.projection.name&&h.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),r=h.LngLatBounds.convert(r);const m=c&&c.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),m,c)}_extendCameraOptions(r){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=h.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const m=r.padding;r.padding={top:m,bottom:m,right:m,left:m}}return r.padding=h.extend(c,r.padding),r}_cameraForBoxAndBearing(r,c,m,x){const v=this._extendCameraOptions(x),C=this.transform,A=C.padding,E=C.project(h.LngLat.convert(r)),D=C.project(h.LngLat.convert(c)),I=new h.pointGeometry(E.x,D.y),P=new h.pointGeometry(D.x,E.y),V=-h.degToRad(m),$=E.rotate(V),U=D.rotate(V),j=I.rotate(V),H=P.rotate(V),N=new h.pointGeometry(Math.max($.x,U.x,j.x,H.x),Math.max($.y,U.y,j.y,H.y)),K=new h.pointGeometry(Math.min($.x,U.x,j.x,H.x),Math.min($.y,U.y,j.y,H.y)),Z=N.sub(K),ae=(C.width-((A.left||0)+(A.right||0)+v.padding.left+v.padding.right))/Z.x,oe=(C.height-((A.top||0)+(A.bottom||0)+v.padding.top+v.padding.bottom))/Z.y;if(oe<0||ae<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const te=Math.min(C.scaleZoom(C.scale*Math.min(ae,oe)),v.maxZoom),se="number"==typeof v.offset.x&&"number"==typeof v.offset.y?new h.pointGeometry(v.offset.x,v.offset.y):h.pointGeometry.convert(v.offset),re=new h.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(m*Math.PI/180),de=se.add(re).mult(C.scale/C.zoomScale(te));return{center:C.unproject(E.add(D).div(2).sub(de)),zoom:te,bearing:m}}_cameraForBox(r,c,m,x,v){const C=this._extendCameraOptions(v);m=m||0,x=x||0,r=h.LngLat.convert(r),c=h.LngLat.convert(c);const A=this.transform.clone();A.padding=C.padding;const E=this.getFreeCameraOptions(),D=new h.LngLat(.5*(r.lng+c.lng),.5*(r.lat+c.lat)),I=.5*(m+x);if(A._camera.position[2]<h.mercatorZfromAltitude(I,D.lat))return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");E.lookAtPoint(D),A.setFreeCameraOptions(E);const P=h.MercatorCoordinate.fromLngLat(r),V=h.MercatorCoordinate.fromLngLat(c),$=A.pointRayIntersection(A.centerPoint,I),U=[(j=A.rayIntersectionCoordinate($)).x,j.y,j.z];var j;const H=A.screenPointToMercatorRay(A.centerPoint),N="globe"!==A.projection.name;let K,Z=0;do{const ae=Math.floor(A.zoom),oe=1<<ae,te=Math.min(oe*P.x,oe*V.x),se=Math.min(oe*P.y,oe*V.y),re=Math.max(oe*P.x,oe*V.x),de=Math.max(oe*P.y,oe*V.y),_e=new h.Aabb([te,se,m],[re,de,x]),Le=h.Frustum.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,ae,N);if(2!==_e.intersects(Le)){K&&(A._camera.position=h.scaleAndAdd([],A._camera.position,H.dir,-K),A._updateStateFromCamera());break}const me=h.sub([],A._camera.position,U);K=.5*h.length(me),A._camera.position=h.scaleAndAdd([],A._camera.position,H.dir,K);try{A._updateStateFromCamera()}catch{return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Z<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(r,c,m){return"globe"===this.transform.projection.name&&h.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(r,c),c,m)}_raycastElevationBox(r,c){const m=this.transform.elevation;if(!m)return;const x=new h.pointGeometry(r.x,c.y),v=new h.pointGeometry(c.x,r.y),C=m.pointCoordinate(r);if(!C)return;const A=m.pointCoordinate(c);if(!A)return;const E=m.pointCoordinate(x);if(!E)return;const D=m.pointCoordinate(v);if(!D)return;const I=new h.MercatorCoordinate(C[0],C[1]).toLngLat(),P=new h.MercatorCoordinate(A[0],A[1]).toLngLat(),V=new h.MercatorCoordinate(E[0],E[1]).toLngLat(),$=new h.MercatorCoordinate(D[0],D[1]).toLngLat(),U=Math.min(I.lng,Math.min(P.lng,Math.min(V.lng,$.lng))),j=Math.min(I.lat,Math.min(P.lat,Math.min(V.lat,$.lat))),H=Math.max(I.lng,Math.max(P.lng,Math.max(V.lng,$.lng))),N=Math.max(I.lat,Math.max(P.lat,Math.max(V.lat,$.lat))),K=Math.min(C[3],Math.min(A[3],Math.min(E[3],D[3]))),Z=Math.max(C[3],Math.max(A[3],Math.max(E[3],D[3])));return{minLngLat:new h.LngLat(U,j),maxLngLat:new h.LngLat(H,N),minAltitude:K,maxAltitude:Z}}fitScreenCoordinates(r,c,m,x,v){let C,A,E,D;"globe"===this.transform.projection.name&&h.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const I=h.pointGeometry.convert(r),P=h.pointGeometry.convert(c),V=this._raycastElevationBox(I,P);if(V)C=V.minLngLat,A=V.maxLngLat,E=V.minAltitude,D=V.maxAltitude;else{if(this.transform.anyCornerOffEdge(I,P))return this;C=this.transform.pointLocation(I),A=this.transform.pointLocation(P)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(r)),this.transform.pointLocation(h.pointGeometry.convert(c)),m,x):this._cameraForBox(C,A,E,D,x),x,v)}_fitInternal(r,c,m){return r?(delete(c=h.extend(r,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(r,c){this.stop();const m=r.preloadOnly?this.transform.clone():this.transform;let x=!1,v=!1,C=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(x=!0,m.zoom=+r.zoom),void 0!==r.center&&(m.center=h.LngLat.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(v=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(C=!0,m.pitch=+r.pitch),null==r.padding||m.isPaddingEqual(r.padding)||(m.padding=r.padding),r.preloadOnly?(this._preloadTiles(m),this):(this.fire(new h.Event("movestart",c)).fire(new h.Event("move",c)),x&&this.fire(new h.Event("zoomstart",c)).fire(new h.Event("zoom",c)).fire(new h.Event("zoomend",c)),v&&this.fire(new h.Event("rotatestart",c)).fire(new h.Event("rotate",c)).fire(new h.Event("rotateend",c)),C&&this.fire(new h.Event("pitchstart",c)).fire(new h.Event("pitch",c)).fire(new h.Event("pitchend",c)),this.fire(new h.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.warnOnce(pc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return h.warnOnce(pc),this;this.stop();const x=m.zoom,v=m.pitch,C=m.bearing;m.setFreeCameraOptions(r);const A=x!==m.zoom,E=v!==m.pitch,D=C!==m.bearing;return this.fire(new h.Event("movestart",c)).fire(new h.Event("move",c)),A&&this.fire(new h.Event("zoomstart",c)).fire(new h.Event("zoom",c)).fire(new h.Event("zoomend",c)),D&&this.fire(new h.Event("rotatestart",c)).fire(new h.Event("rotate",c)).fire(new h.Event("rotateend",c)),E&&this.fire(new h.Event("pitchstart",c)).fire(new h.Event("pitch",c)).fire(new h.Event("pitchend",c)),this.fire(new h.Event("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),(!1===(r=h.extend({offset:[0,0],duration:500,easing:h.ease},r)).animate||!r.essential&&h.exported.prefersReducedMotion)&&(r.duration=0);const m=this.transform,x=this.getZoom(),v=this.getBearing(),C=this.getPitch(),A=this.getPadding(),E="zoom"in r?+r.zoom:x,D="bearing"in r?this._normalizeBearing(r.bearing,v):v,I="pitch"in r?+r.pitch:C,P="padding"in r?r.padding:m.padding,V=h.pointGeometry.convert(r.offset);let $,U,j;if("globe"===m.projection.name){const de=h.MercatorCoordinate.fromLngLat(m.center),_e=V.rotate(-m.angle);de.x+=_e.x/m.worldSize,de.y+=_e.y/m.worldSize;const Le=de.toLngLat(),me=h.LngLat.convert(r.center||Le);this._normalizeCenter(me),$=m.centerPoint.add(_e),U=new h.pointGeometry(de.x,de.y).mult(m.worldSize),j=new h.pointGeometry(h.mercatorXfromLng(me.lng),h.mercatorYfromLat(me.lat)).mult(m.worldSize).sub(U)}else{$=m.centerPoint.add(V);const de=m.pointLocation($),_e=h.LngLat.convert(r.center||de);this._normalizeCenter(_e),U=m.project(de),j=m.project(_e).sub(U)}const H=m.zoomScale(E-x);let N,K;r.around&&(N=h.LngLat.convert(r.around),K=m.locationPoint(N));const Z=this._zooming||E!==x,ae=this._rotating||v!==D,oe=this._pitching||I!==C,te=!m.isPaddingEqual(P),se=de=>_e=>{if(Z&&(de.zoom=h.number(x,E,_e)),ae&&(de.bearing=h.number(v,D,_e)),oe&&(de.pitch=h.number(C,I,_e)),te&&(de.interpolatePadding(A,P,_e),$=de.centerPoint.add(V)),N)de.setLocationAtPoint(N,K);else{const Le=de.zoomScale(de.zoom-x),me=E>x?Math.min(2,H):Math.max(.5,H),Ae=Math.pow(me,1-_e),ke=de.unproject(U.add(j.mult(_e*Ae)).mult(Le));de.setLocationAtPoint(de.renderWorldCopies?ke.wrap():ke,$)}return r.preloadOnly||this._fireMoveEvents(c),de};if(r.preloadOnly){const de=this._emulate(se,r.duration,m);return this._preloadTiles(de),this}const re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Z,this._rotating=ae,this._pitching=oe,this._padding=te,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,re),this._ease(se(m),de=>{m.recenterOnTerrain(),this._afterEase(c,de)},r),this}_prepareEase(r,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new h.Event("movestart",r)),this._zooming&&!m.zooming&&this.fire(new h.Event("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new h.Event("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new h.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new h.Event("move",r)),this._zooming&&this.fire(new h.Event("zoom",r)),this._rotating&&this.fire(new h.Event("rotate",r)),this._pitching&&this.fire(new h.Event("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new h.Event("zoomend",r)),x&&this.fire(new h.Event("rotateend",r)),v&&this.fire(new h.Event("pitchend",r)),this.fire(new h.Event("moveend",r))}flyTo(r,c){if(!r.essential&&h.exported.prefersReducedMotion){const $e=h.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo($e,c)}this.stop(),r=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},r);const m=this.transform,x=this.getZoom(),v=this.getBearing(),C=this.getPitch(),A=this.getPadding(),E="zoom"in r?h.clamp(+r.zoom,m.minZoom,m.maxZoom):x,D="bearing"in r?this._normalizeBearing(r.bearing,v):v,I="pitch"in r?+r.pitch:C,P="padding"in r?r.padding:m.padding,V=m.zoomScale(E-x),$=h.pointGeometry.convert(r.offset);let U=m.centerPoint.add($);const j=m.pointLocation(U),H=h.LngLat.convert(r.center||j);this._normalizeCenter(H);const N=m.project(j),K=m.project(H).sub(N);let Z=r.curve;const ae=Math.max(m.width,m.height),oe=ae/V,te=K.mag();if("minZoom"in r){const $e=h.clamp(Math.min(r.minZoom,x,E),m.minZoom,m.maxZoom),Ne=ae/m.zoomScale($e-x);Z=Math.sqrt(Ne/te*2)}const se=Z*Z;function re($e){const Ne=(oe*oe-ae*ae+($e?-1:1)*se*se*te*te)/(2*($e?oe:ae)*se*te);return Math.log(Math.sqrt(Ne*Ne+1)-Ne)}function de($e){return(Math.exp($e)-Math.exp(-$e))/2}function _e($e){return(Math.exp($e)+Math.exp(-$e))/2}const Le=re(0);let me=function($e){return _e(Le)/_e(Le+Z*$e)},Ae=function($e){return ae*((_e(Le)*(de(Ne=Le+Z*$e)/_e(Ne))-de(Le))/se)/te;var Ne},ke=(re(1)-Le)/Z;if(Math.abs(te)<1e-6||!isFinite(ke)){if(Math.abs(ae-oe)<1e-6)return this.easeTo(r,c);const $e=oe<ae?-1:1;ke=Math.abs(Math.log(oe/ae))/Z,Ae=function(){return 0},me=function(Ne){return Math.exp($e*Z*Ne)}}r.duration="duration"in r?+r.duration:1e3*ke/("screenSpeed"in r?+r.screenSpeed/Z:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Ge=v!==D,be=I!==C,Pe=!m.isPaddingEqual(P),Te=$e=>Ne=>{const Qe=Ne*ke,nt=1/me(Qe);$e.zoom=1===Ne?E:x+$e.scaleZoom(nt),Ge&&($e.bearing=h.number(v,D,Ne)),be&&($e.pitch=h.number(C,I,Ne)),Pe&&($e.interpolatePadding(A,P,Ne),U=$e.centerPoint.add($));const lt=1===Ne?H:$e.unproject(N.add(K.mult(Ae(Qe))).mult(nt));return $e.setLocationAtPoint($e.renderWorldCopies?lt.wrap():lt,U),$e._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),$e};if(r.preloadOnly){const $e=this._emulate(Te,r.duration,m);return this._preloadTiles($e),this}return this._zooming=!0,this._rotating=Ge,this._pitching=be,this._padding=Pe,this._prepareEase(c,!1),this._ease(Te(m),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,c,m){!1===m.animate||0===m.duration?(r(1),c()):(this._easeStart=h.exported.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=h.wrap(r,-180,180);const m=Math.abs(r-c);return Math.abs(r-360-c)<m&&(r-=360),Math.abs(r+360-c)<m&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=r.lng-c.center.lng;r.lng+=m>180?-360:m<-180?360:0}_emulate(r,c,m){const x=Math.ceil(15*c/1e3),v=[],C=r(m.clone());for(let A=0;A<=x;A++){const E=C(A/x);v.push(E.clone())}return v}}class fc{constructor(r={}){this.options=r,h.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact;return this._map=r,this._container=St("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=St("button","mapboxgl-ctrl-attrib-button",this._container),St("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=St("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,c){const m=this._map._getUIString(`AttributionControl.${c}`);r.setAttribute("aria-label",m),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.config.ACCESS_TOKEN}];if(r){const m=c.reduce((x,v,C)=>(v.value&&(x+=`${v.key}=${v.value}${C<c.length-1?"&":""}`),x),"?");r.href=`${h.config.FEEDBACK_URL}/${m}#${Ci(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._sourceCaches;for(const x in c){const v=c[x];if(v.used){const C=v.getSource();C.attribution&&r.indexOf(C.attribution)<0&&r.push(C.attribution)}}r.sort((x,v)=>x.length-v.length),r=r.filter((x,v)=>{for(let C=v+1;C<r.length;C++)if(r[C].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ru{constructor(){h.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=St("div","mapboxgl-ctrl");const c=St("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const c in r){const m=r[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class mc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const x of m)if(x.id===r)return void(x.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function hs(p,r,c){if(p=new h.LngLat(p.lng,p.lat),r){const m=new h.LngLat(p.lng-360,p.lat),x=new h.LngLat(p.lng+360,p.lat),v=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),C=c.locationPoint(p).distSqr(r),A=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint(m).distSqr(r)<C&&(A||Math.abs(m.lng-c.center.lng)<v)?p=m:c.locationPoint(x).distSqr(r)<C&&(A||Math.abs(x.lng-c.center.lng)<v)&&(p=x)}for(;Math.abs(p.lng-c.center.lng)>180;){const m=c.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const ia={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class na extends h.Evented{constructor(r,c){if(super(),(r instanceof h.window.HTMLElement||c)&&(r=h.extend({element:r},c)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=h.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=St("div");const x=41,v=27,C=en("svg",{display:"block",height:x*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${x}`},this._element),A=en("radialGradient",{id:"shadowGradient"},en("defs",{},C));en("stop",{offset:"10%","stop-opacity":.4},A),en("stop",{offset:"100%","stop-opacity":.05},A),en("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),en("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),en("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),en("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=h.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const m=this._element.classList;for(const x in ia)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=h.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,m=r.charCode||r.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map;if(!r)return!1;const c=r.unproject(this._pos),m=r.getFreeCameraOptions();if(!m.position)return!1;const x=m.position.toLngLat();return x.distanceTo(c)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const m=r.unproject(c);let x;r._showingGlobe()&&h.isLngLatBehindGlobe(r.transform,this._lngLat)?x=0:(x=1-r._queryFogOpacity(m),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(x*=.2)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${ia[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const r=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!r||"map"!==m)return"";if(!c._showingGlobe()){const E=c.getPitch();return E?`rotateX(${E}deg)`:""}const x=h.radToDeg(h.globeTiltAtLngLat(c.transform,this._lngLat)),v=r.sub(h.globeCenterToScreenPoint(c.transform)),C=Math.abs(v.x)+Math.abs(v.y);if(0===C)return"";const A=x/C;return`rotateX(${-v.y*A}deg) rotateY(${v.x*A}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let m=0;const x=this.getRotationAlignment();if("map"===x)if(c._showingGlobe()){const v=c.project(new h.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),C=c.project(new h.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);m=h.radToDeg(Math.atan2(C.y,C.x))-90}else m=-c.getBearing();else if("horizon"===x){const v=h.smoothstep(4,6,c.getZoom()),C=h.globeCenterToScreenPoint(c.transform);C.y+=v*c.transform.height;const A=r.sub(C),E=h.radToDeg(Math.atan2(A.y,A.x));m=(E>90?E-270:E+90)*(1-v)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(r){h.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=hs(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===r?this._updateFrameId=h.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=h.pointGeometry.convert(r),this._update(),this}_onMove(r){const c=this._map;if(c){if(!this._isDragging){const m=this._clickTolerance||c._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map;c&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Pu{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=h.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,m){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+m}}const zu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Rh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ra(p){p.parentNode&&p.parentNode.removeChild(p)}const Bu={showCompass:!0,showZoom:!0,visualizePitch:!1};class gc{constructor(r,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Du({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new Pi({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),Ea()}move(r,c){const m=this.map,x=this.mouseRotate.mousemoveWindow(r,c),v=x&&x.bearingDelta;if(v&&m.setBearing(m.getBearing()+v),this.mousePitch){const C=this.mousePitch.mousemoveWindow(r,c),A=C&&C.pitchDelta;A&&m.setPitch(m.getPitch()+A)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Go(),h.window.removeEventListener("mousemove",this.mousemove),h.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(h.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),yt(this.element,r)),h.window.addEventListener("mousemove",this.mousemove),h.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,yt(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=kn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=kn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Vu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},_c={maxWidth:100,unit:"metric"};function yc(p,r,c){const m=wo(r),x=m/r,v={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[c];this._map._requestDomTask(()=>{this._container.style.width=p*x+"px",this._container.innerHTML=`${m}&nbsp;${v}`})}function wo(p){const r=Math.pow(10,`${Math.floor(p)}`.length-1);let c=p/r;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(m){const x=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*x)/x}(c),r*c}const Ph={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function oa(p=new h.pointGeometry(0,0),r="bottom"){if("number"==typeof p){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new h.pointGeometry(0,p);case"top-left":return new h.pointGeometry(c,c);case"top-right":return new h.pointGeometry(-c,c);case"bottom":return new h.pointGeometry(0,-p);case"bottom-left":return new h.pointGeometry(c,-c);case"bottom-right":return new h.pointGeometry(-c,-c);case"left":return new h.pointGeometry(p,0);case"right":return new h.pointGeometry(-p,0)}return new h.pointGeometry(0,0)}return p instanceof h.pointGeometry||Array.isArray(p)?h.pointGeometry.convert(p):h.pointGeometry.convert(p[r]||[0,0])}const sa={version:h.version,supported:hr,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends Lu{constructor(p){if(null!=(p=h.extend({},Rh,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&h.isSafariWithAntialiasingBug(h.window)&&(p.antialias=!1,h.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ri(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language="auto"===p.language?h.window.navigator.language:p.language,this._worldview=p.worldview,this._renderTaskQueue=new mc,this._domRenderTaskQueue=new mc,this._controls=[],this._markers=[],this._mapId=h.uniqueId(),this._locale=h.extend({},zu,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Pu(0),this._useExplicitProjection=!1,this._requestManager=new h.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=h.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof h.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&h.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==h.window&&(h.window.addEventListener("online",this._onWindowOnline,!1),h.window.addEventListener("resize",this._onWindowResize,!1),h.window.addEventListener("orientationchange",this._onWindowResize,!1),h.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ou(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new lc("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,h.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new fc({customAttribution:p.customAttribution})),this._logoControl=new Ru,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new h.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new h.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(p,r){if(void 0===r&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[r];return-1!==r.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new h.Event("movestart",p)).fire(new h.Event("move",p)),this.fire(new h.Event("resize",p)),r&&this.fire(new h.Event("moveend",p)),this}getBounds(){return"globe"===this.transform.projection.name&&h.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(h.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getLanguage(){return this._language}setLanguage(p){if(this._language="auto"===p?h.window.navigator.language:p,this.style)for(const r in this.style._sourceCaches){const c=this.style._sourceCaches[r]._source;c._setLanguage&&c._setLanguage(this._language)}for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){if(this._worldview=p,this.style)for(const r in this.style._sourceCaches){const c=this.style._sourceCaches[r]._source;c._setWorldview&&c._setWorldview(p)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const p=this.transform,r=p.projection.name;let c;"globe"===r&&p.zoom>=h.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),c=!0):"mercator"===r&&p.zoom<h.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;if(r="globe"===p.name&&this.transform.zoom>=h.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0)}return this}project(p){return this.transform.locationPoint3D(h.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(h.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,r,c){if("mouseenter"===p||"mouseover"===p){let m=!1;const x=C=>{const A=r.filter(D=>this.getLayer(D)),E=A.length?this.queryRenderedFeatures(C.point,{layers:A}):[];E.length?m||(m=!0,c.call(this,new qi(p,this,C.originalEvent,{features:E}))):m=!1},v=()=>{m=!1};return{layers:new Set(r),listener:c,delegates:{mousemove:x,mouseout:v}}}if("mouseleave"===p||"mouseout"===p){let m=!1;const x=C=>{const A=r.filter(E=>this.getLayer(E));(A.length?this.queryRenderedFeatures(C.point,{layers:A}):[]).length?m=!0:m&&(m=!1,c.call(this,new qi(p,this,C.originalEvent)))},v=C=>{m&&(m=!1,c.call(this,new qi(p,this,C.originalEvent)))};return{layers:new Set(r),listener:c,delegates:{mousemove:x,mouseout:v}}}{const m=x=>{const v=r.filter(A=>this.getLayer(A)),C=v.length?this.queryRenderedFeatures(x.point,{layers:v}):[];C.length&&(x.features=C,c.call(this,x),delete x.features)};return{layers:new Set(r),listener:c,delegates:{[p]:m}}}}on(p,r,c){if(void 0===c)return super.on(p,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(p,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(p,r,c){if(void 0===c)return super.once(p,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(p,r,c);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(p,r,c){if(void 0===c)return super.off(p,r);r=new Set(Array.isArray(r)?r:[r]);const m=(v,C)=>{if(v.size!==C.size)return!1;for(const A of v)if(!C.has(A))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[p]:void 0;return x&&(v=>{for(let C=0;C<v.length;C++){const A=v[C];if(A.listener===c&&m(A.layers,r)){for(const E in A.delegates)this.off(E,A.delegates[E]);return v.splice(C,1),this}}})(x),this}queryRenderedFeatures(p,r){return this.style?(void 0!==r||void 0===p||p instanceof h.pointGeometry||Array.isArray(p)||(r=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(p,r){return this.style.querySourceFeatures(p,r)}queryTerrainElevation(p,r){const c=this.transform.elevation;return c?(r=h.extend({},{exaggerated:!0},r),c.getAtPoint(h.MercatorCoordinate.fromLngLat(p),null,r.exaggerated)):null}setStyle(p,r){return!1!==(r=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(null==r)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new In(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new In(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,r){if("string"==typeof p){const c=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(c,h.ResourceType.Style);h.getJSON(m,(x,v)=>{x?this.fire(new h.ErrorEvent(x)):v&&this._updateDiff(v,r)})}else"object"==typeof p&&this._updateDiff(p,r)}_updateDiff(p,r){try{this.style.setState(p)&&this._update(!0)}catch(c){h.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(h.warnOnce("There is no style added to the map."),!1)}addSource(p,r){return this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const r in p){const c=p[r]._tiles;for(const m in c){const x=c[m];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(p,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,c)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,r,{pixelRatio:c=1,sdf:m=!1,stretchX:x,stretchY:v,content:C}={}){if(this._lazyInitEmptyStyle(),r instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&r instanceof h.window.ImageBitmap){const{width:A,height:E,data:D}=h.exported.getImageData(r);this.style.addImage(p,{data:new h.RGBAImage({width:A,height:E},D),pixelRatio:c,stretchX:x,stretchY:v,content:C,sdf:m,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:E}=r,D=r;this.style.addImage(p,{data:new h.RGBAImage({width:A,height:E},new Uint8Array(D.data)),pixelRatio:c,stretchX:x,stretchY:v,content:C,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,p)}}updateImage(p,r){const c=this.style.getImage(p);if(!c)return void this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&r instanceof h.window.ImageBitmap?h.exported.getImageData(r):r,{width:x,height:v}=m;void 0!==x&&void 0!==v?x===c.data.width&&v===c.data.height?(c.data.replace(m.data,!(r instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&r instanceof h.window.ImageBitmap)),this.style.updateImage(p,c)):this.fire(new h.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${v})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`))):this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,r){h.getImage(this._requestManager.transformRequest(p,h.ResourceType.Image),(c,m)=>{r(c,m instanceof h.window.HTMLImageElement?h.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(p,r){return this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)}moveLayer(p,r){return this.style.moveLayer(p,r),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,r,c){return this.style.setLayerZoomRange(p,r,c),this._update(!0)}setFilter(p,r,c={}){return this.style.setFilter(p,r,c),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,r,c,m={}){return this.style.setPaintProperty(p,r,c,m),this._update(!0)}getPaintProperty(p,r){return this.style.getPaintProperty(p,r)}setLayoutProperty(p,r,c,m={}){return this.style.setLayoutProperty(p,r,c,m),this._update(!0)}getLayoutProperty(p,r){return this.style.getLayoutProperty(p,r)}setLight(p,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.LngLat.convert(p),this.transform):0}setFeatureState(p,r){return this.style.setFeatureState(p,r),this._update()}removeFeatureState(p,r){return this.style.removeFeatureState(p,r),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,m,x,v=this._container;for(;v&&(!m||!x);){const C=h.window.getComputedStyle(v).transform;C&&"none"!==C&&(c=C.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(m=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(x=c[3])),v=v.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=x?Math.abs(r/x):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==h.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=St("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=St("div","mapboxgl-canvas-container",p);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=St("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=St("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=St("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const c=h.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);-1!==r&&this._markers.splice(r,1)}_setupPainter(){const p=h.extend({},hr.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);r?(h.storeAuthState(r,!0),this.painter=new wu(r,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),h.exported$1.testSupport(r)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;const c=this.painter.context.extTimerQuery,m=h.exported.now();if(this.listens("gpu-timing-frame")&&(r=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let x=!1;const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,D=this.transform.pitch,I=h.exported.now();this.style.zoomHistory.update(E,I);const P=new h.EvaluationParameters(E,{now:I,fadeDuration:v,pitch:D,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),V=P.crossFadingFactor();1===V&&V===this._crossFadingFactor||(x=!0,this._crossFadingFactor=V),this.style.update(P)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):C=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const E=h.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,r),setTimeout(()=>{const D=c.getQueryObjectEXT(r,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(r),this.fire(new h.Event("gpu-timing-frame",{cpuTime:E,gpuTime:D})),h.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:D}})},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(E);this.fire(new h.Event("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(E);this.fire(new h.Event("gpu-timing-deferred-render",{gpuTime:D}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(A||this._repaint)this.triggerRepaint();else{const E=!this.isMoving()&&this.loaded();if(E&&(C=this._updateAverageElevation(m,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new h.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new h.Event("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,r=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const m=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const C=Math.abs(m-x);if(C>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,p,300)}else if(C>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){h.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===h.AUTH_ERR_MSG||401===p.status)){const r=this.painter.context.gl;h.storeAuthState(r,!1),this._logoControl instanceof Ru&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),h.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function x(v){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v,0);const C=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,C),C}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(x(p),r.canvasCopies.map(x),r.timeStamps)}_canvasPixelComparison(p,r,c){let m=c[1]-c[0];const x=p.length/4;for(let v=0;v<r.length;v++){const C=r[v];let A=0;for(let E=0;E<C.length;E+=4)C[E]===p[E]&&C[E+1]===p[E+1]&&C[E+2]===p[E+2]&&C[E+3]===p[E+3]&&(A+=1);m+=(c[v+2]-c[v+1])*(1-A/x)}return m}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==h.window&&(h.window.removeEventListener("resize",this._onWindowResize,!1),h.window.removeEventListener("orientationchange",this._onWindowResize,!1),h.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),ra(this._canvasContainer),ra(this._controlContainer),ra(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),h.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=h.exported.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(p){const r=this.style?Object.values(this.style._sourceCaches):[];return h.asyncAll(r,(c,m)=>c._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,r){h.setCacheLimits(p,r)}get version(){return h.version}},NavigationControl:class{constructor(p){this.options=h.extend({},Bu,p),this._container=St("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),St("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),St("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=St("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),c=r===p.getMaxZoom(),m=r===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new gc(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const c=St("button",p,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(p,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends h.Evented{constructor(p){super(),this.options=h.extend({geolocation:h.window.navigator.geolocation},Vu,p),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ks(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=St("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==h.window.navigator.permissions?h.window.navigator.permissions.query({name:"geolocation"}).then(r=>{this._supportsGeolocation="denied"!==r.state,p(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,p(this._supportsGeolocation))}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),c=p.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",p)),this._finish()}}_updateCamera(p){const r=new h.LngLat(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,m=this._map.getBearing(),x=h.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),x,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new h.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=h.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=St("button","mapboxgl-ctrl-geolocate",this._container),St("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=St("div","mapboxgl-user-location"),this._dotElement.appendChild(St("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(St("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new na({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=St("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new na({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{h.window.addEventListener("ondeviceorientationabsolute"in h.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==h.window.DeviceMotionEvent&&"function"==typeof h.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),h.window.removeEventListener("deviceorientation",this._onDeviceOrientation),h.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:fc,ScaleControl:class{constructor(p){this.options=h.extend({},_c,p),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=yc.bind(this)),h.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,m=r._containerWidth/2-p/2,x=r.unproject([m,c]),v=r.unproject([m+p,c]),C=x.distanceTo(v);if("imperial"===this.options.unit){const A=3.2808*C;A>5280?this._setScale(p,A/5280,"mile"):this._setScale(p,A,"foot")}else"nautical"===this.options.unit?this._setScale(p,C/1852,"nautical-mile"):C>=1e3?this._setScale(p,C/1e3,"kilometer"):this._setScale(p,C,"meter")}_setScale(p,r,c){const m=wo(r),x=m/r;this._map._requestDomTask(()=>{this._container.style.width=p*x+"px",this._container.innerHTML="nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:c}).format(m):`${m}&nbsp;nm`})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=St("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof h.window.HTMLElement?this._container=p.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in h.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in h.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=St("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,h.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!h.window.document.fullscreenEnabled&&!h.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=St("button","mapboxgl-ctrl-fullscreen",this._controlContainer);St("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),h.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(h.window.document.fullscreenElement||h.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?h.window.document.exitFullscreen?h.window.document.exitFullscreen():h.window.document.webkitCancelFullScreen&&h.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor(p){super(),this.options=h.extend(Object.create(Ph),p),h.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=h.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(h.window.document.createTextNode(p))}setHTML(p){const r=h.window.document.createDocumentFragment(),c=h.window.document.createElement("body");let m;for(c.innerHTML=p;m=c.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=St("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const c=this._closeButton=St("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,m=this._pos;if(!r||!c||!m)return"bottom";const x=c.offsetWidth,v=c.offsetHeight,C=m.x<x/2,A=m.x>r.transform.width-x/2;if(m.y+p<v)return C?"top-left":A?"top-right":"top";if(m.y>r.transform.height-v){if(C)return"bottom-left";if(A)return"bottom-right"}return C?"left":A?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=St("div","mapboxgl-popup",r.getContainer()),this._tip=St("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hs(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const x=this._pos=this._trackPointer&&p?p:r.project(this._lngLat),v=oa(this.options.offset),C=this._anchor=this._getAnchor(v.y),A=oa(this.options.offset,C),E=x.add(A).round();r._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${ia[C]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&r._showingGlobe()){const x=h.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(zh);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:na,Style:In,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,FreeCameraOptions:Ye,Evented:h.Evented,config:h.config,prewarm:function(){Nt().acquire(et)},clearPrewarmedResources:function(){const p=xt;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(et),xt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return h.config.ACCESS_TOKEN},set accessToken(p){h.config.ACCESS_TOKEN=p},get baseApiUrl(){return h.config.API_URL},set baseApiUrl(p){h.config.API_URL=p},get workerCount(){return ot.workerCount},set workerCount(p){ot.workerCount=p},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){h.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){h.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:h.exported.setNow,restoreNow:h.exported.restoreNow};return sa}),je}()}}]);