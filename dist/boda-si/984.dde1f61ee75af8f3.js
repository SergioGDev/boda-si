(self.webpackChunkboda_si=self.webpackChunkboda_si||[]).push([[984],{9984:($g,Da,he)=>{"use strict";he.r(Da),he.d(Da,{DashboardModule:()=>ob});var Vt=he(6895),ur=he(529),l=he(4650),d=he(5254),Bt=he(6498),hr=he(6688),li=he(4850),jt=he(7830);function Ae(...o){if(1===o.length){const c=o[0];if((0,hr.k)(c))return Xi(c,null);if((0,jt.K)(c)&&Object.getPrototypeOf(c)===Object.prototype){const e=Object.keys(c);return Xi(e.map(a=>c[a]),e)}}if("function"==typeof o[o.length-1]){const c=o.pop();return Xi(o=1===o.length&&(0,hr.k)(o[0])?o[0]:o,null).pipe((0,li.U)(e=>c(...e)))}return Xi(o,null)}function Xi(o,c){return new Bt.y(e=>{const a=o.length;if(0===a)return void e.complete();const _=new Array(a);let C=0,I=0;for(let G=0;G<a;G++){const ot=(0,d.D)(o[G]);let xt=!1;e.add(ot.subscribe({next:qt=>{xt||(xt=!0,I++),_[G]=qt},error:qt=>e.error(qt),complete:()=>{C++,(C===a||!xt)&&(I===a&&e.next(c?c.reduce((qt,pe,Ai)=>(qt[pe]=_[Ai],qt),{}):_),e.complete())}}))}})}let Bn=(()=>{class o{constructor(e,a){this._renderer=e,this._elementRef=a,this.onChange=_=>{},this.onTouched=()=>{}}setProperty(e,a){this._renderer.setProperty(this._elementRef.nativeElement,e,a)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.Qsj),l.Y36(l.SBq))},o.\u0275dir=l.lG2({type:o}),o})(),_e=(()=>{class o extends Bn{}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275dir=l.lG2({type:o,features:[l.qOj]}),o})();const si=new l.OlP("NgValueAccessor"),ao={provide:si,useExisting:(0,l.Gpc)(()=>sn),multi:!0},ye=new l.OlP("CompositionEventMode");let sn=(()=>{class o extends Bn{constructor(e,a,_){super(e,a),this._compositionMode=_,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Xo(){const o=(0,Vt.q)()?(0,Vt.q)().getUserAgent():"";return/android (\d+)/.test(o.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.Qsj),l.Y36(l.SBq),l.Y36(ye,8))},o.\u0275dir=l.lG2({type:o,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,a){1&e&&l.NdJ("input",function(C){return a._handleInput(C.target.value)})("blur",function(){return a.onTouched()})("compositionstart",function(){return a._compositionStart()})("compositionend",function(C){return a._compositionEnd(C.target.value)})},features:[l._Bn([ao]),l.qOj]}),o})();function Ji(o){return null==o||("string"==typeof o||Array.isArray(o))&&0===o.length}function lo(o){return null!=o&&"number"==typeof o.length}const Ve=new l.OlP("NgValidators"),Hn=new l.OlP("NgAsyncValidators"),Jo=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Ir{static min(c){return function Ls(o){return c=>{if(Ji(c.value)||Ji(o))return null;const e=parseFloat(c.value);return!isNaN(e)&&e<o?{min:{min:o,actual:c.value}}:null}}(c)}static max(c){return function Rs(o){return c=>{if(Ji(c.value)||Ji(o))return null;const e=parseFloat(c.value);return!isNaN(e)&&e>o?{max:{max:o,actual:c.value}}:null}}(c)}static required(c){return function dr(o){return Ji(o.value)?{required:!0}:null}(c)}static requiredTrue(c){return function co(o){return!0===o.value?null:{required:!0}}(c)}static email(c){return function Vn(o){return Ji(o.value)||Jo.test(o.value)?null:{email:!0}}(c)}static minLength(c){return function Or(o){return c=>Ji(c.value)||!lo(c.value)?null:c.value.length<o?{minlength:{requiredLength:o,actualLength:c.value.length}}:null}(c)}static maxLength(c){return function mn(o){return c=>lo(c.value)&&c.value.length>o?{maxlength:{requiredLength:o,actualLength:c.value.length}}:null}(c)}static pattern(c){return function Ko(o){if(!o)return ci;let c,e;return"string"==typeof o?(e="","^"!==o.charAt(0)&&(e+="^"),e+=o,"$"!==o.charAt(o.length-1)&&(e+="$"),c=new RegExp(e)):(e=o.toString(),c=o),a=>{if(Ji(a.value))return null;const _=a.value;return c.test(_)?null:{pattern:{requiredPattern:e,actualValue:_}}}}(c)}static nullValidator(c){return null}static compose(c){return Qo(c)}static composeAsync(c){return zs(c)}}function ci(o){return null}function Vi(o){return null!=o}function $n(o){return(0,l.QGY)(o)?(0,d.D)(o):o}function an(o){let c={};return o.forEach(e=>{c=null!=e?{...c,...e}:c}),0===Object.keys(c).length?null:c}function Yn(o,c){return c.map(e=>e(o))}function uo(o){return o.map(c=>function pr(o){return!o.validate}(c)?c:e=>c.validate(e))}function Qo(o){if(!o)return null;const c=o.filter(Vi);return 0==c.length?null:function(e){return an(Yn(e,c))}}function Gn(o){return null!=o?Qo(uo(o)):null}function zs(o){if(!o)return null;const c=o.filter(Vi);return 0==c.length?null:function(e){return Ae(Yn(e,c).map($n)).pipe((0,li.U)(an))}}function fr(o){return null!=o?zs(uo(o)):null}function Fr(o,c){return null===o?[c]:Array.isArray(o)?[...o,c]:[o,c]}function Oe(o){return o._rawValidators}function Wn(o){return o._rawAsyncValidators}function mr(o){return o?Array.isArray(o)?o:[o]:[]}function gn(o,c){return Array.isArray(o)?o.includes(c):o===c}function _n(o,c){const e=mr(c);return mr(o).forEach(_=>{gn(e,_)||e.push(_)}),e}function ho(o,c){return mr(c).filter(e=>!gn(o,e))}class Ie{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(c){this._rawValidators=c||[],this._composedValidatorFn=Gn(this._rawValidators)}_setAsyncValidators(c){this._rawAsyncValidators=c||[],this._composedAsyncValidatorFn=fr(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(c){this._onDestroyCallbacks.push(c)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(c=>c()),this._onDestroyCallbacks=[]}reset(c){this.control&&this.control.reset(c)}hasError(c,e){return!!this.control&&this.control.hasError(c,e)}getError(c,e){return this.control?this.control.getError(c,e):null}}class wi extends Ie{get formDirective(){return null}get path(){return null}}class Li extends Ie{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Xn{constructor(c){this._cd=c}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let po=(()=>{class o extends Xn{constructor(e){super(e)}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Li,2))},o.\u0275dir=l.lG2({type:o,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,a){2&e&&l.ekj("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)},features:[l.qOj]}),o})(),fo=(()=>{class o extends Xn{constructor(e){super(e)}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(wi,10))},o.\u0275dir=l.lG2({type:o,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,a){2&e&&l.ekj("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)("ng-submitted",a.isSubmitted)},features:[l.qOj]}),o})();const Ri="VALID",Rr="INVALID",Y="PENDING",L="DISABLED";function z(o){return(mt(o)?o.validators:o)||null}function W(o){return Array.isArray(o)?Gn(o):o||null}function Q(o,c){return(mt(c)?c.asyncValidators:o)||null}function ut(o){return Array.isArray(o)?fr(o):o||null}function mt(o){return null!=o&&!Array.isArray(o)&&"object"==typeof o}function pt(o,c,e){const a=o.controls;if(!(c?Object.keys(a):a).length)throw new l.vHH(1e3,"");if(!a[e])throw new l.vHH(1001,"")}function ht(o,c,e){o._forEachChild((a,_)=>{if(void 0===e[_])throw new l.vHH(1002,"")})}class _t{constructor(c,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=c,this._rawAsyncValidators=e,this._composedValidatorFn=W(this._rawValidators),this._composedAsyncValidatorFn=ut(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(c){this._rawValidators=this._composedValidatorFn=c}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(c){this._rawAsyncValidators=this._composedAsyncValidatorFn=c}get parent(){return this._parent}get valid(){return this.status===Ri}get invalid(){return this.status===Rr}get pending(){return this.status==Y}get disabled(){return this.status===L}get enabled(){return this.status!==L}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(c){this._rawValidators=c,this._composedValidatorFn=W(c)}setAsyncValidators(c){this._rawAsyncValidators=c,this._composedAsyncValidatorFn=ut(c)}addValidators(c){this.setValidators(_n(c,this._rawValidators))}addAsyncValidators(c){this.setAsyncValidators(_n(c,this._rawAsyncValidators))}removeValidators(c){this.setValidators(ho(c,this._rawValidators))}removeAsyncValidators(c){this.setAsyncValidators(ho(c,this._rawAsyncValidators))}hasValidator(c){return gn(this._rawValidators,c)}hasAsyncValidator(c){return gn(this._rawAsyncValidators,c)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(c={}){this.touched=!0,this._parent&&!c.onlySelf&&this._parent.markAsTouched(c)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(c=>c.markAllAsTouched())}markAsUntouched(c={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!c.onlySelf&&this._parent._updateTouched(c)}markAsDirty(c={}){this.pristine=!1,this._parent&&!c.onlySelf&&this._parent.markAsDirty(c)}markAsPristine(c={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!c.onlySelf&&this._parent._updatePristine(c)}markAsPending(c={}){this.status=Y,!1!==c.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!c.onlySelf&&this._parent.markAsPending(c)}disable(c={}){const e=this._parentMarkedDirty(c.onlySelf);this.status=L,this.errors=null,this._forEachChild(a=>{a.disable({...c,onlySelf:!0})}),this._updateValue(),!1!==c.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...c,skipPristineCheck:e}),this._onDisabledChange.forEach(a=>a(!0))}enable(c={}){const e=this._parentMarkedDirty(c.onlySelf);this.status=Ri,this._forEachChild(a=>{a.enable({...c,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:c.emitEvent}),this._updateAncestors({...c,skipPristineCheck:e}),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(c){this._parent&&!c.onlySelf&&(this._parent.updateValueAndValidity(c),c.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(c){this._parent=c}getRawValue(){return this.value}updateValueAndValidity(c={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ri||this.status===Y)&&this._runAsyncValidator(c.emitEvent)),!1!==c.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!c.onlySelf&&this._parent.updateValueAndValidity(c)}_updateTreeValidity(c={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(c)),this.updateValueAndValidity({onlySelf:!0,emitEvent:c.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?L:Ri}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(c){if(this.asyncValidator){this.status=Y,this._hasOwnPendingAsyncValidator=!0;const e=$n(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(a=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(a,{emitEvent:c})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(c,e={}){this.errors=c,this._updateControlsErrors(!1!==e.emitEvent)}get(c){let e=c;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((a,_)=>a&&a._find(_),this)}getError(c,e){const a=e?this.get(e):this;return a&&a.errors?a.errors[c]:null}hasError(c,e){return!!this.getError(c,e)}get root(){let c=this;for(;c._parent;)c=c._parent;return c}_updateControlsErrors(c){this.status=this._calculateStatus(),c&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(c)}_initObservables(){this.valueChanges=new l.vpe,this.statusChanges=new l.vpe}_calculateStatus(){return this._allControlsDisabled()?L:this.errors?Rr:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Y)?Y:this._anyControlsHaveStatus(Rr)?Rr:Ri}_anyControlsHaveStatus(c){return this._anyControls(e=>e.status===c)}_anyControlsDirty(){return this._anyControls(c=>c.dirty)}_anyControlsTouched(){return this._anyControls(c=>c.touched)}_updatePristine(c={}){this.pristine=!this._anyControlsDirty(),this._parent&&!c.onlySelf&&this._parent._updatePristine(c)}_updateTouched(c={}){this.touched=this._anyControlsTouched(),this._parent&&!c.onlySelf&&this._parent._updateTouched(c)}_registerOnCollectionChange(c){this._onCollectionChange=c}_setUpdateStrategy(c){mt(c)&&null!=c.updateOn&&(this._updateOn=c.updateOn)}_parentMarkedDirty(c){return!c&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(c){return null}}class Dt extends _t{constructor(c,e,a){super(z(e),Q(a,e)),this.controls=c,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(c,e){return this.controls[c]?this.controls[c]:(this.controls[c]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(c,e,a={}){this.registerControl(c,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(c,e={}){this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),delete this.controls[c],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(c,e,a={}){this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),delete this.controls[c],e&&this.registerControl(c,e),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(c){return this.controls.hasOwnProperty(c)&&this.controls[c].enabled}setValue(c,e={}){ht(this,0,c),Object.keys(c).forEach(a=>{pt(this,!0,a),this.controls[a].setValue(c[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(c,e={}){null!=c&&(Object.keys(c).forEach(a=>{const _=this.controls[a];_&&_.patchValue(c[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(c={},e={}){this._forEachChild((a,_)=>{a.reset(c[_],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(c,e,a)=>(c[a]=e.getRawValue(),c))}_syncPendingControls(){let c=this._reduceChildren(!1,(e,a)=>!!a._syncPendingControls()||e);return c&&this.updateValueAndValidity({onlySelf:!0}),c}_forEachChild(c){Object.keys(this.controls).forEach(e=>{const a=this.controls[e];a&&c(a,e)})}_setUpControls(){this._forEachChild(c=>{c.setParent(this),c._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(c){for(const[e,a]of Object.entries(this.controls))if(this.contains(e)&&c(a))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,a,_)=>((a.enabled||this.disabled)&&(e[_]=a.value),e))}_reduceChildren(c,e){let a=c;return this._forEachChild((_,C)=>{a=e(a,_,C)}),a}_allControlsDisabled(){for(const c of Object.keys(this.controls))if(this.controls[c].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(c){return this.controls.hasOwnProperty(c)?this.controls[c]:null}}function oe(o,c){Ue(o,c),c.valueAccessor.writeValue(o.value),o.disabled&&c.valueAccessor.setDisabledState?.(!0),function Ct(o,c){c.valueAccessor.registerOnChange(e=>{o._pendingValue=e,o._pendingChange=!0,o._pendingDirty=!0,"change"===o.updateOn&&gi(o,c)})}(o,c),function zr(o,c){const e=(a,_)=>{c.valueAccessor.writeValue(a),_&&c.viewToModelUpdate(a)};o.registerOnChange(e),c._registerOnDestroy(()=>{o._unregisterOnChange(e)})}(o,c),function xn(o,c){c.valueAccessor.registerOnTouched(()=>{o._pendingTouched=!0,"blur"===o.updateOn&&o._pendingChange&&gi(o,c),"submit"!==o.updateOn&&o.markAsTouched()})}(o,c),function We(o,c){if(c.valueAccessor.setDisabledState){const e=a=>{c.valueAccessor.setDisabledState(a)};o.registerOnDisabledChange(e),c._registerOnDestroy(()=>{o._unregisterOnDisabledChange(e)})}}(o,c)}function ve(o,c,e=!0){const a=()=>{};c.valueAccessor&&(c.valueAccessor.registerOnChange(a),c.valueAccessor.registerOnTouched(a)),ee(o,c),o&&(c._invokeOnDestroyCallbacks(),o._registerOnCollectionChange(()=>{}))}function Ge(o,c){o.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(c)})}function Ue(o,c){const e=Oe(o);null!==c.validator?o.setValidators(Fr(e,c.validator)):"function"==typeof e&&o.setValidators([e]);const a=Wn(o);null!==c.asyncValidator?o.setAsyncValidators(Fr(a,c.asyncValidator)):"function"==typeof a&&o.setAsyncValidators([a]);const _=()=>o.updateValueAndValidity();Ge(c._rawValidators,_),Ge(c._rawAsyncValidators,_)}function ee(o,c){let e=!1;if(null!==o){if(null!==c.validator){const _=Oe(o);if(Array.isArray(_)&&_.length>0){const C=_.filter(I=>I!==c.validator);C.length!==_.length&&(e=!0,o.setValidators(C))}}if(null!==c.asyncValidator){const _=Wn(o);if(Array.isArray(_)&&_.length>0){const C=_.filter(I=>I!==c.asyncValidator);C.length!==_.length&&(e=!0,o.setAsyncValidators(C))}}}const a=()=>{};return Ge(c._rawValidators,a),Ge(c._rawAsyncValidators,a),e}function gi(o,c){o._pendingDirty&&o.markAsDirty(),o.setValue(o._pendingValue,{emitModelToViewChange:!1}),c.viewToModelUpdate(o._pendingValue),o._pendingChange=!1}function Vs(o,c){Ue(o,c)}function Tn(o,c){o._syncPendingControls(),c.forEach(e=>{const a=e.control;"submit"===a.updateOn&&a._pendingChange&&(e.viewToModelUpdate(a._pendingValue),a._pendingChange=!1)})}const Gs={provide:wi,useExisting:(0,l.Gpc)(()=>Gi)},_r=(()=>Promise.resolve(null))();let Gi=(()=>{class o extends wi{constructor(e,a){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new l.vpe,this.form=new Dt({},Gn(e),fr(a))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){_r.then(()=>{const a=this._findContainer(e.path);e.control=a.registerControl(e.name,e.control),oe(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){_r.then(()=>{const a=this._findContainer(e.path);a&&a.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){_r.then(()=>{const a=this._findContainer(e.path),_=new Dt({});Vs(_,e),a.registerControl(e.name,_),_.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){_r.then(()=>{const a=this._findContainer(e.path);a&&a.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,a){_r.then(()=>{this.form.get(e.path).setValue(a)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,Tn(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Ve,10),l.Y36(Hn,10))},o.\u0275dir=l.lG2({type:o,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,a){1&e&&l.NdJ("submit",function(C){return a.onSubmit(C)})("reset",function(){return a.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[l._Bn([Gs]),l.qOj]}),o})();function ui(o,c){const e=o.indexOf(c);e>-1&&o.splice(e,1)}function tc(o){return"object"==typeof o&&null!==o&&2===Object.keys(o).length&&"value"in o&&"disabled"in o}const Jn=class extends _t{constructor(c=null,e,a){super(z(e),Q(a,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(c),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),mt(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=tc(c)?c.value:c)}setValue(c,e={}){this.value=this._pendingValue=c,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(a=>a(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(c,e={}){this.setValue(c,e)}reset(c=this.defaultValue,e={}){this._applyFormState(c),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(c){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(c){this._onChange.push(c)}_unregisterOnChange(c){ui(this._onChange,c)}registerOnDisabledChange(c){this._onDisabledChange.push(c)}_unregisterOnDisabledChange(c){ui(this._onDisabledChange,c)}_forEachChild(c){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(c){tc(c)?(this.value=this._pendingValue=c.value,c.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=c}};let yi=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275dir=l.lG2({type:o,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),o})(),rs=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({}),o})();const nc=new l.OlP("NgModelWithFormControlWarning"),Oh={provide:wi,useExisting:(0,l.Gpc)(()=>Vr)};let Vr=(()=>{class o extends wi{constructor(e,a){super(),this.validators=e,this.asyncValidators=a,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new l.vpe,this._setValidators(e),this._setAsyncValidators(a)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(ee(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const a=this.form.get(e.path);return oe(a,e),a.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),a}getControl(e){return this.form.get(e.path)}removeControl(e){ve(e.control||null,e,!1),function xe(o,c){const e=o.indexOf(c);e>-1&&o.splice(e,1)}(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,a){this.form.get(e.path).setValue(a)}onSubmit(e){return this.submitted=!0,Tn(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const a=e.control,_=this.form.get(e.path);a!==_&&(ve(a||null,e),(o=>o instanceof Jn)(_)&&(oe(_,e),e.control=_))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const a=this.form.get(e.path);Vs(a,e),a.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const a=this.form.get(e.path);a&&function Nn(o,c){return ee(o,c)}(a,e)&&a.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Ue(this.form,this),this._oldForm&&ee(this._oldForm,this)}_checkFormPresent(){}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Ve,10),l.Y36(Hn,10))},o.\u0275dir=l.lG2({type:o,selectors:[["","formGroup",""]],hostBindings:function(e,a){1&e&&l.NdJ("submit",function(C){return a.onSubmit(C)})("reset",function(){return a.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[l._Bn([Oh]),l.qOj,l.TTD]}),o})();const qa={provide:Li,useExisting:(0,l.Gpc)(()=>Za)};let Za=(()=>{class o extends Li{constructor(e,a,_,C,I){super(),this._ngModelWarningConfig=I,this._added=!1,this.update=new l.vpe,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(a),this._setAsyncValidators(_),this.valueAccessor=function bn(o,c){if(!c)return null;let e,a,_;return Array.isArray(c),c.forEach(C=>{C.constructor===sn?e=C:function Se(o){return Object.getPrototypeOf(o.constructor)===_e}(C)?a=C:_=C}),_||a||e||null}(0,C)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),function we(o,c){if(!o.hasOwnProperty("model"))return!1;const e=o.model;return!!e.isFirstChange()||!Object.is(c,e.currentValue)}(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return function te(o,c){return[...c.path,o]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return o._ngModelWarningSentOnce=!1,o.\u0275fac=function(e){return new(e||o)(l.Y36(wi,13),l.Y36(Ve,10),l.Y36(Hn,10),l.Y36(si,10),l.Y36(nc,8))},o.\u0275dir=l.lG2({type:o,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[l._Bn([qa]),l.qOj,l.TTD]}),o})(),Lh=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[rs]}),o})(),as=(()=>{class o{static withConfig(e){return{ngModule:o,providers:[{provide:nc,useValue:e.warnOnNgModelWithFormControl}]}}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Lh]}),o})();class el extends _t{constructor(c,e,a){super(z(e),Q(a,e)),this.controls=c,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(c){return this.controls[this._adjustIndex(c)]}push(c,e={}){this.controls.push(c),this._registerControl(c),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(c,e,a={}){this.controls.splice(c,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:a.emitEvent})}removeAt(c,e={}){let a=this._adjustIndex(c);a<0&&(a=0),this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),this.controls.splice(a,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(c,e,a={}){let _=this._adjustIndex(c);_<0&&(_=0),this.controls[_]&&this.controls[_]._registerOnCollectionChange(()=>{}),this.controls.splice(_,1),e&&(this.controls.splice(_,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(c,e={}){ht(this,0,c),c.forEach((a,_)=>{pt(this,!1,_),this.at(_).setValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(c,e={}){null!=c&&(c.forEach((a,_)=>{this.at(_)&&this.at(_).patchValue(a,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(c=[],e={}){this._forEachChild((a,_)=>{a.reset(c[_],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(c=>c.getRawValue())}clear(c={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:c.emitEvent}))}_adjustIndex(c){return c<0?c+this.length:c}_syncPendingControls(){let c=this.controls.reduce((e,a)=>!!a._syncPendingControls()||e,!1);return c&&this.updateValueAndValidity({onlySelf:!0}),c}_forEachChild(c){this.controls.forEach((e,a)=>{c(e,a)})}_updateValue(){this.value=this.controls.filter(c=>c.enabled||this.disabled).map(c=>c.value)}_anyControls(c){return this.controls.some(e=>e.enabled&&c(e))}_setUpControls(){this._forEachChild(c=>this._registerControl(c))}_allControlsDisabled(){for(const c of this.controls)if(c.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(c){c.setParent(this),c._registerOnCollectionChange(this._onCollectionChange)}_find(c){return this.at(c)??null}}function cc(o){return!!o&&(void 0!==o.asyncValidators||void 0!==o.validators||void 0!==o.updateOn)}let il=(()=>{class o{constructor(){this.useNonNullable=!1}get nonNullable(){const e=new o;return e.useNonNullable=!0,e}group(e,a=null){const _=this._reduceControls(e);let C={};return cc(a)?C=a:null!==a&&(C.validators=a.validator,C.asyncValidators=a.asyncValidator),new Dt(_,C)}control(e,a,_){let C={};return this.useNonNullable?(cc(a)?C=a:(C.validators=a,C.asyncValidators=_),new Jn(e,{...C,nonNullable:!0})):new Jn(e,a,_)}array(e,a,_){const C=e.map(I=>this._createControl(I));return new el(C,a,_)}_reduceControls(e){const a={};return Object.keys(e).forEach(_=>{a[_]=this._createControl(e[_])}),a}_createControl(e){return e instanceof Jn||e instanceof _t?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac,providedIn:as}),o})();var le=he(8929),ls=he(591),Un=he(6787),hi=he(2198),Co=he(2868);const uc={provide:l.tb,useFactory:function bu(o,c){return()=>{if((0,Vt.NF)(c)){const e=Array.from(o.querySelectorAll(`[class*=${hc}]`)),a=/\bflex-layout-.+?\b/g;e.forEach(_=>{_.classList.contains(`${hc}ssr`)&&_.parentNode?_.parentNode.removeChild(_):_.className.replace(a,"")})}}},deps:[Vt.K0,l.Lbi],multi:!0},hc="flex-layout-";let Js=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({providers:[uc]}),o})();class Gr{constructor(c=!1,e="all",a="",_="",C=0){this.matches=c,this.mediaQuery=e,this.mqAlias=a,this.suffix=_,this.priority=C,this.property=""}clone(){return new Gr(this.matches,this.mediaQuery,this.mqAlias,this.suffix)}}let rl=(()=>{class o{constructor(){this.stylesheet=new Map}addStyleToElement(e,a,_){const C=this.stylesheet.get(e);C?C.set(a,_):this.stylesheet.set(e,new Map([[a,_]]))}clearStyles(){this.stylesheet.clear()}getStyleForElement(e,a){const _=this.stylesheet.get(e);let C="";if(_){const I=_.get(a);("number"==typeof I||"string"==typeof I)&&(C=I+"")}return C}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=(0,l.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})();const dc={addFlexToParent:!0,addOrientationBps:!1,disableDefaultBps:!1,disableVendorPrefixes:!1,serverLoaded:!1,useColumnBasisZero:!0,printWithBreakpoints:[],mediaTriggerAutoRestore:!0,ssrObserveBreakpoints:[]},un=new l.OlP("Flex Layout token, config options for the library",{providedIn:"root",factory:()=>dc}),Mo=new l.OlP("FlexLayoutServerLoaded",{providedIn:"root",factory:()=>!1}),cs=new l.OlP("Flex Layout token, collect all breakpoints into one provider",{providedIn:"root",factory:()=>null});function pc(o,c){return o=o?o.clone():new Gr,c&&(o.mqAlias=c.alias,o.mediaQuery=c.mediaQuery,o.suffix=c.suffix,o.priority=c.priority),o}const us="inline",wu=["row","column","row-reverse","column-reverse"];function fc(o){if(o)switch(o.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":o="wrap-reverse";break;case"no":case"none":case"nowrap":o="nowrap";break;default:o="wrap"}return o}let ii=(()=>{class o{constructor(e,a,_,C){this.elementRef=e,this.styleBuilder=a,this.styler=_,this.marshal=C,this.DIRECTIVE_KEY="",this.inputs=[],this.mru={},this.destroySubject=new le.xQ,this.styleCache=new Map}get parentElement(){return this.elementRef.nativeElement.parentElement}get nativeElement(){return this.elementRef.nativeElement}get activatedValue(){return this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY)}set activatedValue(e){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,this.marshal.activatedAlias)}ngOnChanges(e){Object.keys(e).forEach(a=>{if(-1!==this.inputs.indexOf(a)){const _=a.split(".").slice(1).join(".");this.setValue(e[a].currentValue,_)}})}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete(),this.marshal.releaseElement(this.nativeElement)}init(e=[]){this.marshal.init(this.elementRef.nativeElement,this.DIRECTIVE_KEY,this.updateWithValue.bind(this),this.clearStyles.bind(this),e)}addStyles(e,a){const _=this.styleBuilder,C=_.shouldCache;let I=this.styleCache.get(e);(!I||!C)&&(I=_.buildStyles(e,a),C&&this.styleCache.set(e,I)),this.mru=Object.assign({},I),this.applyStyleToElement(I),_.sideEffect(e,I,a)}clearStyles(){Object.keys(this.mru).forEach(e=>{this.mru[e]=""}),this.applyStyleToElement(this.mru),this.mru={}}triggerUpdate(){this.marshal.triggerUpdate(this.nativeElement,this.DIRECTIVE_KEY)}getFlexFlowDirection(e,a=!1){if(e){const[_,C]=this.styler.getFlowDirection(e);if(!C&&a){const I=function ol(o){let[c,e,a]=function Cu(o){o=o?o.toLowerCase():"";let[c,e,a]=o.split(" ");return wu.find(_=>_===c)||(c=wu[0]),e===us&&(e=a!==us?a:"",a=us),[c,fc(e),!!a]}(o);return function mc(o,c=null,e=!1){return{display:e?"inline-flex":"flex","box-sizing":"border-box","flex-direction":o,"flex-wrap":c||null}}(c,e,a)}(_);this.styler.applyStyleToElements(I,[e])}return _.trim()}return"row"}hasWrap(e){return this.styler.hasWrap(e)}applyStyleToElement(e,a,_=this.nativeElement){this.styler.applyStyleToElement(_,e,a)}setValue(e,a){this.marshal.setValue(this.nativeElement,this.DIRECTIVE_KEY,e,a)}updateWithValue(e){this.currentValue!==e&&(this.addStyles(e),this.currentValue=e)}}return o.\u0275fac=function(e){l.$Z()},o.\u0275dir=l.lG2({type:o,features:[l.TTD]}),o})();const zh=[{alias:"xs",mediaQuery:"screen and (min-width: 0px) and (max-width: 599.98px)",priority:1e3},{alias:"sm",mediaQuery:"screen and (min-width: 600px) and (max-width: 959.98px)",priority:900},{alias:"md",mediaQuery:"screen and (min-width: 960px) and (max-width: 1279.98px)",priority:800},{alias:"lg",mediaQuery:"screen and (min-width: 1280px) and (max-width: 1919.98px)",priority:700},{alias:"xl",mediaQuery:"screen and (min-width: 1920px) and (max-width: 4999.98px)",priority:600},{alias:"lt-sm",overlapping:!0,mediaQuery:"screen and (max-width: 599.98px)",priority:950},{alias:"lt-md",overlapping:!0,mediaQuery:"screen and (max-width: 959.98px)",priority:850},{alias:"lt-lg",overlapping:!0,mediaQuery:"screen and (max-width: 1279.98px)",priority:750},{alias:"lt-xl",overlapping:!0,priority:650,mediaQuery:"screen and (max-width: 1919.98px)"},{alias:"gt-xs",overlapping:!0,mediaQuery:"screen and (min-width: 600px)",priority:-950},{alias:"gt-sm",overlapping:!0,mediaQuery:"screen and (min-width: 960px)",priority:-850},{alias:"gt-md",overlapping:!0,mediaQuery:"screen and (min-width: 1280px)",priority:-750},{alias:"gt-lg",overlapping:!0,mediaQuery:"screen and (min-width: 1920px)",priority:-650}],Mu="(orientation: portrait) and (max-width: 599.98px)",Au="(orientation: landscape) and (max-width: 959.98px)",Ks="(orientation: portrait) and (min-width: 600px) and (max-width: 839.98px)",gc="(orientation: landscape) and (min-width: 960px) and (max-width: 1279.98px)",_c="(orientation: portrait) and (min-width: 840px)",sl="(orientation: landscape) and (min-width: 1280px)",jn={HANDSET:`${Mu}, ${Au}`,TABLET:`${Ks} , ${gc}`,WEB:`${_c}, ${sl} `,HANDSET_PORTRAIT:`${Mu}`,TABLET_PORTRAIT:`${Ks} `,WEB_PORTRAIT:`${_c}`,HANDSET_LANDSCAPE:`${Au}`,TABLET_LANDSCAPE:`${gc}`,WEB_LANDSCAPE:`${sl}`},Su=[{alias:"handset",priority:2e3,mediaQuery:jn.HANDSET},{alias:"handset.landscape",priority:2e3,mediaQuery:jn.HANDSET_LANDSCAPE},{alias:"handset.portrait",priority:2e3,mediaQuery:jn.HANDSET_PORTRAIT},{alias:"tablet",priority:2100,mediaQuery:jn.TABLET},{alias:"tablet.landscape",priority:2100,mediaQuery:jn.TABLET_LANDSCAPE},{alias:"tablet.portrait",priority:2100,mediaQuery:jn.TABLET_PORTRAIT},{alias:"web",priority:2200,mediaQuery:jn.WEB,overlapping:!0},{alias:"web.landscape",priority:2200,mediaQuery:jn.WEB_LANDSCAPE,overlapping:!0},{alias:"web.portrait",priority:2200,mediaQuery:jn.WEB_PORTRAIT,overlapping:!0}],vc=/(\.|-|_)/g;function al(o){let c=o.length>0?o.charAt(0):"",e=o.length>1?o.slice(1):"";return c.toUpperCase()+e}function Tu(o,c=[]){const e={};return o.forEach(a=>{e[a.alias]=a}),c.forEach(a=>{e[a.alias]?function yc(o,...c){if(null==o)throw TypeError("Cannot convert undefined or null to object");for(let e of c)if(null!=e)for(let a in e)e.hasOwnProperty(a)&&(o[a]=e[a])}(e[a.alias],a):e[a.alias]=a}),function Qs(o){return o.forEach(c=>{c.suffix||(c.suffix=function br(o){return o.replace(vc,"|").split("|").map(al).join("")}(c.alias),c.overlapping=!!c.overlapping)}),o}(Object.keys(e).map(a=>e[a]))}const Ao=new l.OlP("Token (@angular/flex-layout) Breakpoints",{providedIn:"root",factory:()=>{const o=(0,l.f3M)(cs),c=(0,l.f3M)(un),e=[].concat.apply([],(o||[]).map(_=>Array.isArray(_)?_:[_]));return Tu((c.disableDefaultBps?[]:zh).concat(c.addOrientationBps?Su:[]),e)}});function tr(o,c){return(c&&c.priority||0)-(o&&o.priority||0)}function Eu(o,c){return(o.priority||0)-(c.priority||0)}let So=(()=>{class o{constructor(e){this.findByMap=new Map,this.items=[...e].sort(Eu)}findByAlias(e){return e?this.findWithPredicate(e,a=>a.alias==e):null}findByQuery(e){return this.findWithPredicate(e,a=>a.mediaQuery==e)}get overlappings(){return this.items.filter(e=>1==e.overlapping)}get aliases(){return this.items.map(e=>e.alias)}get suffixes(){return this.items.map(e=>e.suffix?e.suffix:"")}findWithPredicate(e,a){let _=this.findByMap.get(e);return _||(_=this.items.find(a)||null,this.findByMap.set(e,_)),_||null}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ao))},o.\u0275prov=(0,l.Yz7)({factory:function(){return new o((0,l.LFG)(Ao))},token:o,providedIn:"root"}),o})(),Le=(()=>{class o{constructor(e,a,_){this._zone=e,this._platformId=a,this._document=_,this.source=new ls.X(new Gr(!0)),this.registry=new Map,this.pendingRemoveListenerFns=[],this._observable$=this.source.asObservable()}get activations(){const e=[];return this.registry.forEach((a,_)=>{a.matches&&e.push(_)}),e}isActive(e){const a=this.registry.get(e);return a?a.matches:this.registerQuery(e).some(_=>_.matches)}observe(e,a=!1){if(e&&e.length){const _=this._observable$.pipe((0,hi.h)(I=>!a||e.indexOf(I.mediaQuery)>-1)),C=new Bt.y(I=>{const G=this.registerQuery(e);if(G.length){const ot=G.pop();G.forEach(xt=>{I.next(xt)}),this.source.next(ot)}I.complete()});return(0,Un.T)(C,_)}return this._observable$}registerQuery(e){const a=Array.isArray(e)?e:[e],_=[];return function ku(o,c){const e=o.filter(a=>!hs[a]);if(e.length>0){const a=e.join(", ");try{const _=c.createElement("style");_.setAttribute("type","text/css"),_.styleSheet||_.appendChild(c.createTextNode(`\n/*\n  @angular/flex-layout - workaround for possible browser quirk with mediaQuery listeners\n  see http://bit.ly/2sd4HMP\n*/\n@media ${a} {.fx-query-test{ }}\n`)),c.head.appendChild(_),e.forEach(C=>hs[C]=_)}catch(_){console.error(_)}}}(a,this._document),a.forEach(C=>{const I=ot=>{this._zone.run(()=>this.source.next(new Gr(ot.matches,C)))};let G=this.registry.get(C);G||(G=this.buildMQL(C),G.addListener(I),this.pendingRemoveListenerFns.push(()=>G.removeListener(I)),this.registry.set(C,G)),G.matches&&_.push(new Gr(!0,C))}),_}ngOnDestroy(){let e;for(;e=this.pendingRemoveListenerFns.pop();)e()}buildMQL(e){return function ta(o,c){return c&&window.matchMedia("all").addListener?window.matchMedia(o):{matches:"all"===o||""===o,media:o,addListener:()=>{},removeListener:()=>{},onchange:null,addEventListener(){},removeEventListener(){},dispatchEvent:()=>!1}}(e,(0,Vt.NF)(this._platformId))}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(l.R0b),l.LFG(l.Lbi),l.LFG(Vt.K0))},o.\u0275prov=(0,l.Yz7)({factory:function(){return new o((0,l.LFG)(l.R0b),(0,l.LFG)(l.Lbi),(0,l.LFG)(Vt.K0))},token:o,providedIn:"root"}),o})();const hs={},Nr="print",ds={alias:Nr,mediaQuery:Nr,priority:1e3};let ll=(()=>{class o{constructor(e,a,_){this.breakpoints=e,this.layoutConfig=a,this._document=_,this.registeredBeforeAfterPrintHooks=!1,this.isPrintingBeforeAfterEvent=!1,this.beforePrintEventListeners=[],this.afterPrintEventListeners=[],this.isPrinting=!1,this.queue=new cl,this.deactivations=[]}withPrintQuery(e){return[...e,Nr]}isPrintEvent(e){return e.mediaQuery.startsWith(Nr)}get printAlias(){return this.layoutConfig.printWithBreakpoints||[]}get printBreakPoints(){return this.printAlias.map(e=>this.breakpoints.findByAlias(e)).filter(e=>null!==e)}getEventBreakpoints({mediaQuery:e}){const a=this.breakpoints.findByQuery(e);return(a?[...this.printBreakPoints,a]:this.printBreakPoints).sort(tr)}updateEvent(e){let a=this.breakpoints.findByQuery(e.mediaQuery);return this.isPrintEvent(e)&&(a=this.getEventBreakpoints(e)[0],e.mediaQuery=a?a.mediaQuery:""),pc(e,a)}registerBeforeAfterPrintHooks(e){if(!this._document.defaultView||this.registeredBeforeAfterPrintHooks)return;this.registeredBeforeAfterPrintHooks=!0;const a=()=>{this.isPrinting||(this.isPrintingBeforeAfterEvent=!0,this.startPrinting(e,this.getEventBreakpoints(new Gr(!0,Nr))),e.updateStyles())},_=()=>{this.isPrintingBeforeAfterEvent=!1,this.isPrinting&&(this.stopPrinting(e),e.updateStyles())};this._document.defaultView.addEventListener("beforeprint",a),this._document.defaultView.addEventListener("afterprint",_),this.beforePrintEventListeners.push(a),this.afterPrintEventListeners.push(_)}interceptEvents(e){return this.registerBeforeAfterPrintHooks(e),a=>{this.isPrintEvent(a)?a.matches&&!this.isPrinting?(this.startPrinting(e,this.getEventBreakpoints(a)),e.updateStyles()):!a.matches&&this.isPrinting&&!this.isPrintingBeforeAfterEvent&&(this.stopPrinting(e),e.updateStyles()):this.collectActivations(a)}}blockPropagation(){return e=>!(this.isPrinting||this.isPrintEvent(e))}startPrinting(e,a){this.isPrinting=!0,e.activatedBreakpoints=this.queue.addPrintBreakpoints(a)}stopPrinting(e){e.activatedBreakpoints=this.deactivations,this.deactivations=[],this.queue.clear(),this.isPrinting=!1}collectActivations(e){if(!this.isPrinting||this.isPrintingBeforeAfterEvent)if(e.matches)this.isPrintingBeforeAfterEvent||(this.deactivations=[]);else{const a=this.breakpoints.findByQuery(e.mediaQuery);a&&(this.deactivations.push(a),this.deactivations.sort(tr))}}ngOnDestroy(){this._document.defaultView&&(this.beforePrintEventListeners.forEach(e=>this._document.defaultView.removeEventListener("beforeprint",e)),this.afterPrintEventListeners.forEach(e=>this._document.defaultView.removeEventListener("afterprint",e)))}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(So),l.LFG(un),l.LFG(Vt.K0))},o.\u0275prov=(0,l.Yz7)({factory:function(){return new o((0,l.LFG)(So),(0,l.LFG)(un),(0,l.LFG)(Vt.K0))},token:o,providedIn:"root"}),o})();class cl{constructor(){this.printBreakpoints=[]}addPrintBreakpoints(c){return c.push(ds),c.sort(tr),c.forEach(e=>this.addBreakpoint(e)),this.printBreakpoints}addBreakpoint(c){c&&void 0===this.printBreakpoints.find(a=>a.mediaQuery===c.mediaQuery)&&(this.printBreakpoints=function ps(o){return!!o&&o.mediaQuery.startsWith(Nr)}(c)?[c,...this.printBreakpoints]:[...this.printBreakpoints,c])}clear(){this.printBreakpoints=[]}}function Yt(o){for(let c in o){let e=o[c]||"";switch(c){case"display":o.display="flex"===e?["-webkit-flex","flex"]:"inline-flex"===e?["-webkit-inline-flex","inline-flex"]:e;break;case"align-items":case"align-self":case"align-content":case"flex":case"flex-basis":case"flex-flow":case"flex-grow":case"flex-shrink":case"flex-wrap":case"justify-content":o["-webkit-"+c]=e;break;case"flex-direction":e=e||"row",o["-webkit-flex-direction"]=e,o["flex-direction"]=e;break;case"order":o.order=o["-webkit-"+c]=isNaN(+e)?"0":e}}return o}let Re=(()=>{class o{constructor(e,a,_,C){this._serverStylesheet=e,this._serverModuleLoaded=a,this._platformId=_,this.layoutConfig=C}applyStyleToElement(e,a,_=null){let C={};"string"==typeof a&&(C[a]=_,a=C),C=this.layoutConfig.disableVendorPrefixes?a:Yt(a),this._applyMultiValueStyleToElement(C,e)}applyStyleToElements(e,a=[]){const _=this.layoutConfig.disableVendorPrefixes?e:Yt(e);a.forEach(C=>{this._applyMultiValueStyleToElement(_,C)})}getFlowDirection(e){const a="flex-direction";let _=this.lookupStyle(e,a);return[_||"row",this.lookupInlineStyle(e,a)||(0,Vt.PM)(this._platformId)&&this._serverModuleLoaded?_:""]}hasWrap(e){return"wrap"===this.lookupStyle(e,"flex-wrap")}lookupAttributeValue(e,a){return e.getAttribute(a)||""}lookupInlineStyle(e,a){return(0,Vt.NF)(this._platformId)?e.style.getPropertyValue(a):this._getServerStyle(e,a)}lookupStyle(e,a,_=!1){let C="";return e&&((C=this.lookupInlineStyle(e,a))||((0,Vt.NF)(this._platformId)?_||(C=getComputedStyle(e).getPropertyValue(a)):this._serverModuleLoaded&&(C=this._serverStylesheet.getStyleForElement(e,a)))),C?C.trim():""}_applyMultiValueStyleToElement(e,a){Object.keys(e).sort().forEach(_=>{const C=e[_],I=Array.isArray(C)?C:[C];I.sort();for(let G of I)G=G?G+"":"",(0,Vt.NF)(this._platformId)||!this._serverModuleLoaded?(0,Vt.NF)(this._platformId)?a.style.setProperty(_,G):this._setServerStyle(a,_,G):this._serverStylesheet.addStyleToElement(a,_,G)})}_setServerStyle(e,a,_){a=a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();const C=this._readStyleAttribute(e);C[a]=_||"",this._writeStyleAttribute(e,C)}_getServerStyle(e,a){return this._readStyleAttribute(e)[a]||""}_readStyleAttribute(e){const a={},_=e.getAttribute("style");if(_){const C=_.split(/;+/g);for(let I=0;I<C.length;I++){const G=C[I].trim();if(G.length>0){const ot=G.indexOf(":");if(-1===ot)throw new Error(`Invalid CSS style: ${G}`);a[G.substr(0,ot).trim()]=G.substr(ot+1).trim()}}}return a}_writeStyleAttribute(e,a){let _="";for(const C in a)a[C]&&(_+=C+":"+a[C]+";");e.setAttribute("style",_)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(rl),l.LFG(Mo),l.LFG(l.Lbi),l.LFG(un))},o.\u0275prov=(0,l.Yz7)({factory:function(){return new o((0,l.LFG)(rl),(0,l.LFG)(Mo),(0,l.LFG)(l.Lbi),(0,l.LFG)(un))},token:o,providedIn:"root"}),o})();class xi{constructor(){this.shouldCache=!0}sideEffect(c,e,a){}}function hl(o,c="1",e="1"){let a=[c,e,o],_=o.indexOf("calc");if(_>0){a[2]=fs(o.substring(_).trim());let C=o.substr(0,_).trim().split(" ");2==C.length&&(a[0]=C[0],a[1]=C[1])}else if(0==_)a[2]=fs(o.trim());else{let C=o.split(" ");a=3===C.length?C:[c,e,o]}return a}function fs(o){return o.replace(/[\s]/g,"").replace(/[\/\*\+\-]/g," $& ")}let je=(()=>{class o{constructor(e,a,_){this.matchMedia=e,this.breakpoints=a,this.hook=_,this.activatedBreakpoints=[],this.elementMap=new Map,this.elementKeyMap=new WeakMap,this.watcherMap=new WeakMap,this.updateMap=new WeakMap,this.clearMap=new WeakMap,this.subject=new le.xQ,this.observeActivations()}get activatedAlias(){return this.activatedBreakpoints[0]?this.activatedBreakpoints[0].alias:""}onMediaChange(e){const a=this.findByQuery(e.mediaQuery);a&&((e=pc(e,a)).matches&&-1===this.activatedBreakpoints.indexOf(a)?(this.activatedBreakpoints.push(a),this.activatedBreakpoints.sort(tr),this.updateStyles()):!e.matches&&-1!==this.activatedBreakpoints.indexOf(a)&&(this.activatedBreakpoints.splice(this.activatedBreakpoints.indexOf(a),1),this.activatedBreakpoints.sort(tr),this.updateStyles()))}init(e,a,_,C,I=[]){dl(this.updateMap,e,a,_),dl(this.clearMap,e,a,C),this.buildElementKeyMap(e,a),this.watchExtraTriggers(e,a,I)}getValue(e,a,_){const C=this.elementMap.get(e);if(C){const I=void 0!==_?C.get(_):this.getActivatedValues(C,a);if(I)return I.get(a)}}hasValue(e,a){const _=this.elementMap.get(e);if(_){const C=this.getActivatedValues(_,a);if(C)return void 0!==C.get(a)||!1}return!1}setValue(e,a,_,C){let I=this.elementMap.get(e);if(I){const ot=(I.get(C)||new Map).set(a,_);I.set(C,ot),this.elementMap.set(e,I)}else I=(new Map).set(C,(new Map).set(a,_)),this.elementMap.set(e,I);const G=this.getValue(e,a);void 0!==G&&this.updateElement(e,a,G)}trackValue(e,a){return this.subject.asObservable().pipe((0,hi.h)(_=>_.element===e&&_.key===a))}updateStyles(){this.elementMap.forEach((e,a)=>{const _=new Set(this.elementKeyMap.get(a));let C=this.getActivatedValues(e);C&&C.forEach((I,G)=>{this.updateElement(a,G,I),_.delete(G)}),_.forEach(I=>{if(C=this.getActivatedValues(e,I),C){const G=C.get(I);this.updateElement(a,I,G)}else this.clearElement(a,I)})})}clearElement(e,a){const _=this.clearMap.get(e);if(_){const C=_.get(a);C&&(C(),this.subject.next({element:e,key:a,value:""}))}}updateElement(e,a,_){const C=this.updateMap.get(e);if(C){const I=C.get(a);I&&(I(_),this.subject.next({element:e,key:a,value:_}))}}releaseElement(e){const a=this.watcherMap.get(e);a&&(a.forEach(C=>C.unsubscribe()),this.watcherMap.delete(e));const _=this.elementMap.get(e);_&&(_.forEach((C,I)=>_.delete(I)),this.elementMap.delete(e))}triggerUpdate(e,a){const _=this.elementMap.get(e);if(_){const C=this.getActivatedValues(_,a);C&&(a?this.updateElement(e,a,C.get(a)):C.forEach((I,G)=>this.updateElement(e,G,I)))}}buildElementKeyMap(e,a){let _=this.elementKeyMap.get(e);_||(_=new Set,this.elementKeyMap.set(e,_)),_.add(a)}watchExtraTriggers(e,a,_){if(_&&_.length){let C=this.watcherMap.get(e);if(C||(C=new Map,this.watcherMap.set(e,C)),!C.get(a)){const G=(0,Un.T)(..._).subscribe(()=>{const ot=this.getValue(e,a);this.updateElement(e,a,ot)});C.set(a,G)}}}findByQuery(e){return this.breakpoints.findByQuery(e)}getActivatedValues(e,a){for(let C=0;C<this.activatedBreakpoints.length;C++){const G=e.get(this.activatedBreakpoints[C].alias);if(G&&(void 0===a||G.has(a)&&null!=G.get(a)))return G}const _=e.get("");return void 0===a||_&&_.has(a)?_:void 0}observeActivations(){const a=this.breakpoints.items.map(_=>_.mediaQuery);this.matchMedia.observe(this.hook.withPrintQuery(a)).pipe((0,Co.b)(this.hook.interceptEvents(this)),(0,hi.h)(this.hook.blockPropagation())).subscribe(this.onMediaChange.bind(this))}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Le),l.LFG(So),l.LFG(ll))},o.\u0275prov=(0,l.Yz7)({factory:function(){return new o((0,l.LFG)(Le),(0,l.LFG)(So),(0,l.LFG)(ll))},token:o,providedIn:"root"}),o})();function dl(o,c,e,a){if(void 0!==a){let _=o.get(c);_||(_=new Map,o.set(c,_)),_.set(e,a)}}function ge(o){return null!=o&&"false"!=`${o}`}function zi(o,c=0){return function ra(o){return!isNaN(parseFloat(o))&&!isNaN(Number(o))}(o)?Number(o):c}function oa(o){return Array.isArray(o)?o:[o]}function Ci(o){return null==o?"":"string"==typeof o?o:`${o}px`}function Ui(o){return o instanceof l.SBq?o.nativeElement:o}var ms=he(1177);function ke(o){return c=>c.lift(new pl(o))}class pl{constructor(c){this.notifier=c}call(c,e){const a=new xc(c),_=(0,ms.ft)(this.notifier,new ms.IY(a));return _&&!a.seenValue?(a.add(_),e.subscribe(a)):a}}class xc extends ms.Ds{constructor(c){super(c),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}var Ur=he(1481);let Pu=(()=>{class o extends ii{constructor(e,a,_,C,I,G,ot){super(e,null,a,_),this.ngClassInstance=ot,this.DIRECTIVE_KEY="ngClass",this.ngClassInstance||(this.ngClassInstance=new Vt.mk(C,I,e,G)),this.init(),this.setValue("","")}set klass(e){this.ngClassInstance.klass=e,this.setValue(e,"")}updateWithValue(e){this.ngClassInstance.ngClass=e,this.ngClassInstance.ngDoCheck()}ngDoCheck(){this.ngClassInstance.ngDoCheck()}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Re),l.Y36(je),l.Y36(l.ZZ4),l.Y36(l.aQg),l.Y36(l.Qsj),l.Y36(Vt.mk,10))},o.\u0275dir=l.lG2({type:o,inputs:{klass:["class","klass"]},features:[l.qOj]}),o})();const fl=["ngClass","ngClass.xs","ngClass.sm","ngClass.md","ngClass.lg","ngClass.xl","ngClass.lt-sm","ngClass.lt-md","ngClass.lt-lg","ngClass.lt-xl","ngClass.gt-xs","ngClass.gt-sm","ngClass.gt-md","ngClass.gt-lg"];let jr=(()=>{class o extends Pu{constructor(){super(...arguments),this.inputs=fl}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275dir=l.lG2({type:o,selectors:[["","ngClass",""],["","ngClass.xs",""],["","ngClass.sm",""],["","ngClass.md",""],["","ngClass.lg",""],["","ngClass.xl",""],["","ngClass.lt-sm",""],["","ngClass.lt-md",""],["","ngClass.lt-lg",""],["","ngClass.lt-xl",""],["","ngClass.gt-xs",""],["","ngClass.gt-sm",""],["","ngClass.gt-md",""],["","ngClass.gt-lg",""]],inputs:{ngClass:"ngClass","ngClass.xs":"ngClass.xs","ngClass.sm":"ngClass.sm","ngClass.md":"ngClass.md","ngClass.lg":"ngClass.lg","ngClass.xl":"ngClass.xl","ngClass.lt-sm":"ngClass.lt-sm","ngClass.lt-md":"ngClass.lt-md","ngClass.lt-lg":"ngClass.lt-lg","ngClass.lt-xl":"ngClass.lt-xl","ngClass.gt-xs":"ngClass.gt-xs","ngClass.gt-sm":"ngClass.gt-sm","ngClass.gt-md":"ngClass.gt-md","ngClass.gt-lg":"ngClass.gt-lg"},features:[l.qOj]}),o})(),Lu=(()=>{class o extends xi{buildStyles(e,a){return{display:"true"===e?a.display||(a.isServer?"initial":""):"none"}}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275prov=(0,l.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})(),Ru=(()=>{class o extends ii{constructor(e,a,_,C,I,G,ot){super(e,a,_,C),this.layoutConfig=I,this.platformId=G,this.serverModuleLoaded=ot,this.DIRECTIVE_KEY="show-hide",this.display="",this.hasLayout=!1,this.hasFlexChild=!1}ngAfterViewInit(){this.trackExtraTriggers();const e=Array.from(this.nativeElement.children);for(let _=0;_<e.length;_++)if(this.marshal.hasValue(e[_],"flex")){this.hasFlexChild=!0;break}_s.has(this.nativeElement)?this.display=_s.get(this.nativeElement):(this.display=this.getDisplayStyle(),_s.set(this.nativeElement,this.display)),this.init();const a=this.marshal.getValue(this.nativeElement,this.DIRECTIVE_KEY,"");void 0===a||""===a?this.setValue(!0,""):this.triggerUpdate()}ngOnChanges(e){Object.keys(e).forEach(a=>{if(-1!==this.inputs.indexOf(a)){const _=a.split("."),C=_.slice(1).join("."),I=e[a].currentValue;let G=""===I||0!==I&&ge(I);"fxHide"===_[0]&&(G=!G),this.setValue(G,C)}})}trackExtraTriggers(){this.hasLayout=this.marshal.hasValue(this.nativeElement,"layout"),["layout","layout-align"].forEach(e=>{this.marshal.trackValue(this.nativeElement,e).pipe(ke(this.destroySubject)).subscribe(this.triggerUpdate.bind(this))})}getDisplayStyle(){return this.hasLayout||this.hasFlexChild&&this.layoutConfig.addFlexToParent?"flex":this.styler.lookupStyle(this.nativeElement,"display",!0)}updateWithValue(e=!0){if(""===e)return;const a=(0,Vt.PM)(this.platformId);this.addStyles(e?"true":"false",{display:this.display,isServer:a}),a&&this.serverModuleLoaded&&this.nativeElement.style.setProperty("display",""),this.marshal.triggerUpdate(this.parentElement,"layout-gap")}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Lu),l.Y36(Re),l.Y36(je),l.Y36(un),l.Y36(l.Lbi),l.Y36(Mo))},o.\u0275dir=l.lG2({type:o,features:[l.qOj,l.TTD]}),o})();const _s=new WeakMap,zu=["fxShow","fxShow.print","fxShow.xs","fxShow.sm","fxShow.md","fxShow.lg","fxShow.xl","fxShow.lt-sm","fxShow.lt-md","fxShow.lt-lg","fxShow.lt-xl","fxShow.gt-xs","fxShow.gt-sm","fxShow.gt-md","fxShow.gt-lg","fxHide","fxHide.print","fxHide.xs","fxHide.sm","fxHide.md","fxHide.lg","fxHide.xl","fxHide.lt-sm","fxHide.lt-md","fxHide.lt-lg","fxHide.lt-xl","fxHide.gt-xs","fxHide.gt-sm","fxHide.gt-md","fxHide.gt-lg"];let Di=(()=>{class o extends Ru{constructor(){super(...arguments),this.inputs=zu}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275dir=l.lG2({type:o,selectors:[["","fxShow",""],["","fxShow.print",""],["","fxShow.xs",""],["","fxShow.sm",""],["","fxShow.md",""],["","fxShow.lg",""],["","fxShow.xl",""],["","fxShow.lt-sm",""],["","fxShow.lt-md",""],["","fxShow.lt-lg",""],["","fxShow.lt-xl",""],["","fxShow.gt-xs",""],["","fxShow.gt-sm",""],["","fxShow.gt-md",""],["","fxShow.gt-lg",""],["","fxHide",""],["","fxHide.print",""],["","fxHide.xs",""],["","fxHide.sm",""],["","fxHide.md",""],["","fxHide.lg",""],["","fxHide.xl",""],["","fxHide.lt-sm",""],["","fxHide.lt-md",""],["","fxHide.lt-lg",""],["","fxHide.lt-xl",""],["","fxHide.gt-xs",""],["","fxHide.gt-sm",""],["","fxHide.gt-md",""],["","fxHide.gt-lg",""]],inputs:{fxShow:"fxShow","fxShow.print":"fxShow.print","fxShow.xs":"fxShow.xs","fxShow.sm":"fxShow.sm","fxShow.md":"fxShow.md","fxShow.lg":"fxShow.lg","fxShow.xl":"fxShow.xl","fxShow.lt-sm":"fxShow.lt-sm","fxShow.lt-md":"fxShow.lt-md","fxShow.lt-lg":"fxShow.lt-lg","fxShow.lt-xl":"fxShow.lt-xl","fxShow.gt-xs":"fxShow.gt-xs","fxShow.gt-sm":"fxShow.gt-sm","fxShow.gt-md":"fxShow.gt-md","fxShow.gt-lg":"fxShow.gt-lg",fxHide:"fxHide","fxHide.print":"fxHide.print","fxHide.xs":"fxHide.xs","fxHide.sm":"fxHide.sm","fxHide.md":"fxHide.md","fxHide.lg":"fxHide.lg","fxHide.xl":"fxHide.xl","fxHide.lt-sm":"fxHide.lt-sm","fxHide.lt-md":"fxHide.lt-md","fxHide.lt-lg":"fxHide.lt-lg","fxHide.lt-xl":"fxHide.lt-xl","fxHide.gt-xs":"fxHide.gt-xs","fxHide.gt-sm":"fxHide.gt-sm","fxHide.gt-md":"fxHide.gt-md","fxHide.gt-lg":"fxHide.gt-lg"},features:[l.qOj]}),o})();class Gh{constructor(c,e,a=!0){this.key=c,this.value=e,this.key=a?c.replace(/['"]/g,"").trim():c.trim(),this.value=a?e.replace(/['"]/g,"").trim():e.trim(),this.value=this.value.replace(/;/,"")}}function la(o){let c=typeof o;return"object"===c?o.constructor===Array?"array":o.constructor===Set?"set":"object":c}function gl(o){const[c,...e]=o.split(":");return new Gh(c,e.join(":"))}function Eo(o,c){return c.key&&(o[c.key]=c.value),o}let kn=(()=>{class o extends ii{constructor(e,a,_,C,I,G,ot,xt,qt){super(e,null,a,_),this.sanitizer=C,this.ngStyleInstance=ot,this.DIRECTIVE_KEY="ngStyle",this.ngStyleInstance||(this.ngStyleInstance=new Vt.PC(e,I,G)),this.init();const pe=this.nativeElement.getAttribute("style")||"";this.fallbackStyles=this.buildStyleMap(pe),this.isServer=xt&&(0,Vt.PM)(qt)}updateWithValue(e){const a=this.buildStyleMap(e);this.ngStyleInstance.ngStyle=Object.assign(Object.assign({},this.fallbackStyles),a),this.isServer&&this.applyStyleToElement(a),this.ngStyleInstance.ngDoCheck()}clearStyles(){this.ngStyleInstance.ngStyle=this.fallbackStyles,this.ngStyleInstance.ngDoCheck()}buildStyleMap(e){const a=_=>this.sanitizer.sanitize(l.q3G.STYLE,_)||"";if(e)switch(la(e)){case"string":return wc(function ml(o,c=";"){return String(o).trim().split(c).map(e=>e.trim()).filter(e=>""!==e)}(e),a);case"array":return wc(e,a);default:return function er(o,c){let e=[];return"set"===la(o)?o.forEach(a=>e.push(a)):Object.keys(o).forEach(a=>{e.push(`${a}:${o[a]}`)}),function Vu(o,c){return o.map(gl).filter(a=>!!a).map(a=>(c&&(a.value=c(a.value)),a)).reduce(Eo,{})}(e,c)}(e,a)}return{}}ngDoCheck(){this.ngStyleInstance.ngDoCheck()}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Re),l.Y36(je),l.Y36(Ur.H7),l.Y36(l.aQg),l.Y36(l.Qsj),l.Y36(Vt.PC,10),l.Y36(Mo),l.Y36(l.Lbi))},o.\u0275dir=l.lG2({type:o,features:[l.qOj]}),o})();const _l=["ngStyle","ngStyle.xs","ngStyle.sm","ngStyle.md","ngStyle.lg","ngStyle.xl","ngStyle.lt-sm","ngStyle.lt-md","ngStyle.lt-lg","ngStyle.lt-xl","ngStyle.gt-xs","ngStyle.gt-sm","ngStyle.gt-md","ngStyle.gt-lg"];let bc=(()=>{class o extends kn{constructor(){super(...arguments),this.inputs=_l}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275dir=l.lG2({type:o,selectors:[["","ngStyle",""],["","ngStyle.xs",""],["","ngStyle.sm",""],["","ngStyle.md",""],["","ngStyle.lg",""],["","ngStyle.xl",""],["","ngStyle.lt-sm",""],["","ngStyle.lt-md",""],["","ngStyle.lt-lg",""],["","ngStyle.lt-xl",""],["","ngStyle.gt-xs",""],["","ngStyle.gt-sm",""],["","ngStyle.gt-md",""],["","ngStyle.gt-lg",""]],inputs:{ngStyle:"ngStyle","ngStyle.xs":"ngStyle.xs","ngStyle.sm":"ngStyle.sm","ngStyle.md":"ngStyle.md","ngStyle.lg":"ngStyle.lg","ngStyle.xl":"ngStyle.xl","ngStyle.lt-sm":"ngStyle.lt-sm","ngStyle.lt-md":"ngStyle.lt-md","ngStyle.lt-lg":"ngStyle.lt-lg","ngStyle.lt-xl":"ngStyle.lt-xl","ngStyle.gt-xs":"ngStyle.gt-xs","ngStyle.gt-sm":"ngStyle.gt-sm","ngStyle.gt-md":"ngStyle.gt-md","ngStyle.gt-lg":"ngStyle.gt-lg"},features:[l.qOj]}),o})();function wc(o,c){return o.map(gl).filter(a=>!!a).map(a=>(c&&(a.value=c(a.value)),a)).reduce(Eo,{})}let ys=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Js]}),o})();const Cc=new l.OlP("cdk-dir-doc",{providedIn:"root",factory:function Gu(){return(0,l.f3M)(Vt.K0)}});let hn=(()=>{class o{constructor(e){if(this.value="ltr",this.change=new l.vpe,e){const _=e.documentElement?e.documentElement.dir:null,C=(e.body?e.body.dir:null)||_;this.value="ltr"===C||"rtl"===C?C:"ltr"}}ngOnDestroy(){this.change.complete()}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Cc,8))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Cc,8))},token:o,providedIn:"root"}),o})(),ko=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({}),o})();const yl="inline",qr=["row","column","row-reverse","column-reverse"];function xl(o){o=o?o.toLowerCase():"";let[c,e,a]=o.split(" ");return qr.find(_=>_===c)||(c=qr[0]),e===yl&&(e=a!==yl?a:"",a=yl),[c,Nu(e),!!a]}function qn(o){let[c]=xl(o);return c.indexOf("row")>-1}function Nu(o){if(o)switch(o.toLowerCase()){case"reverse":case"wrap-reverse":case"reverse-wrap":o="wrap-reverse";break;case"no":case"none":case"nowrap":o="nowrap";break;default:o="wrap"}return o}let Uu=(()=>{class o extends xi{buildStyles(e){return function vl(o){let[c,e,a]=xl(o);return function Mc(o,c=null,e=!1){return{display:e?"inline-flex":"flex","box-sizing":"border-box","flex-direction":o,"flex-wrap":c||null}}(c,e,a)}(e)}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275prov=(0,l.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})();const Ac=["fxLayout","fxLayout.xs","fxLayout.sm","fxLayout.md","fxLayout.lg","fxLayout.xl","fxLayout.lt-sm","fxLayout.lt-md","fxLayout.lt-lg","fxLayout.lt-xl","fxLayout.gt-xs","fxLayout.gt-sm","fxLayout.gt-md","fxLayout.gt-lg"];let Sc=(()=>{class o extends ii{constructor(e,a,_,C){super(e,_,a,C),this.DIRECTIVE_KEY="layout",this.styleCache=ua,this.init()}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Re),l.Y36(Uu),l.Y36(je))},o.\u0275dir=l.lG2({type:o,features:[l.qOj]}),o})(),Zr=(()=>{class o extends Sc{constructor(){super(...arguments),this.inputs=Ac}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275dir=l.lG2({type:o,selectors:[["","fxLayout",""],["","fxLayout.xs",""],["","fxLayout.sm",""],["","fxLayout.md",""],["","fxLayout.lg",""],["","fxLayout.xl",""],["","fxLayout.lt-sm",""],["","fxLayout.lt-md",""],["","fxLayout.lt-lg",""],["","fxLayout.lt-xl",""],["","fxLayout.gt-xs",""],["","fxLayout.gt-sm",""],["","fxLayout.gt-md",""],["","fxLayout.gt-lg",""]],inputs:{fxLayout:"fxLayout","fxLayout.xs":"fxLayout.xs","fxLayout.sm":"fxLayout.sm","fxLayout.md":"fxLayout.md","fxLayout.lg":"fxLayout.lg","fxLayout.xl":"fxLayout.xl","fxLayout.lt-sm":"fxLayout.lt-sm","fxLayout.lt-md":"fxLayout.lt-md","fxLayout.lt-lg":"fxLayout.lt-lg","fxLayout.lt-xl":"fxLayout.lt-xl","fxLayout.gt-xs":"fxLayout.gt-xs","fxLayout.gt-sm":"fxLayout.gt-sm","fxLayout.gt-md":"fxLayout.gt-md","fxLayout.gt-lg":"fxLayout.gt-lg"},features:[l.qOj]}),o})();const ua=new Map,ha={"margin-left":null,"margin-right":null,"margin-top":null,"margin-bottom":null};let qu=(()=>{class o extends xi{constructor(e){super(),this._styler=e}buildStyles(e,a){return e.endsWith(Do)?function qh(o,c){const[e,a]=o.split(" "),C=xt=>`-${xt}`;let I="0px",G=C(a||e),ot="0px";return"rtl"===c?ot=C(e):I=C(e),{margin:`0px ${I} ${G} ${ot}`}}(e=e.slice(0,e.indexOf(Do)),a.directionality):{}}sideEffect(e,a,_){const C=_.items;if(e.endsWith(Do)){const I=function jh(o,c){const[e,a]=o.split(" ");let C="0px",G="0px";return"rtl"===c?G=e:C=e,{padding:`0px ${C} ${a||e} ${G}`}}(e=e.slice(0,e.indexOf(Do)),_.directionality);this._styler.applyStyleToElements(I,_.items)}else{const I=C.pop(),G=function fa(o,c){const e=pa(c.directionality,c.layout),a=Object.assign({},ha);return a[e]=o,a}(e,_);this._styler.applyStyleToElements(G,C),this._styler.applyStyleToElements(ha,[I])}}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Re))},o.\u0275prov=(0,l.Yz7)({factory:function(){return new o((0,l.LFG)(Re))},token:o,providedIn:"root"}),o})();const Zu=["fxLayoutGap","fxLayoutGap.xs","fxLayoutGap.sm","fxLayoutGap.md","fxLayoutGap.lg","fxLayoutGap.xl","fxLayoutGap.lt-sm","fxLayoutGap.lt-md","fxLayoutGap.lt-lg","fxLayoutGap.lt-xl","fxLayoutGap.gt-xs","fxLayoutGap.gt-sm","fxLayoutGap.gt-md","fxLayoutGap.gt-lg"];let da=(()=>{class o extends ii{constructor(e,a,_,C,I,G){super(e,I,C,G),this.zone=a,this.directionality=_,this.styleUtils=C,this.layout="row",this.DIRECTIVE_KEY="layout-gap",this.observerSubject=new le.xQ;const ot=[this.directionality.change,this.observerSubject.asObservable()];this.init(ot),this.marshal.trackValue(this.nativeElement,"layout").pipe(ke(this.destroySubject)).subscribe(this.onLayoutChange.bind(this))}get childrenNodes(){const e=this.nativeElement.children,a=[];for(let _=e.length;_--;)a[_]=e[_];return a}ngAfterContentInit(){this.buildChildObservable(),this.triggerUpdate()}ngOnDestroy(){super.ngOnDestroy(),this.observer&&this.observer.disconnect()}onLayoutChange(e){const _=e.value.split(" ");this.layout=_[0],qr.find(C=>C===this.layout)||(this.layout="row"),this.triggerUpdate()}updateWithValue(e){const a=this.childrenNodes.filter(_=>1===_.nodeType&&this.willDisplay(_)).sort((_,C)=>{const I=+this.styler.lookupStyle(_,"order"),G=+this.styler.lookupStyle(C,"order");return isNaN(I)||isNaN(G)||I===G?0:I>G?1:-1});if(a.length>0){const _=this.directionality.value,C=this.layout;"row"===C&&"rtl"===_?this.styleCache=Ec:"row"===C&&"rtl"!==_?this.styleCache=kc:"column"===C&&"rtl"===_?this.styleCache=Hu:"column"===C&&"rtl"!==_&&(this.styleCache=Dc),this.addStyles(e,{directionality:_,items:a,layout:C})}}clearStyles(){const e=Object.keys(this.mru).length>0,a=e?"padding":pa(this.directionality.value,this.layout);e&&super.clearStyles(),this.styleUtils.applyStyleToElements({[a]:""},this.childrenNodes)}willDisplay(e){const a=this.marshal.getValue(e,"show-hide");return!0===a||void 0===a&&"none"!==this.styleUtils.lookupStyle(e,"display")}buildChildObservable(){this.zone.runOutsideAngular(()=>{typeof MutationObserver<"u"&&(this.observer=new MutationObserver(e=>{e.some(_=>_.addedNodes&&_.addedNodes.length>0||_.removedNodes&&_.removedNodes.length>0)&&this.observerSubject.next()}),this.observer.observe(this.nativeElement,{childList:!0}))})}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(l.R0b),l.Y36(hn),l.Y36(Re),l.Y36(qu),l.Y36(je))},o.\u0275dir=l.lG2({type:o,features:[l.qOj]}),o})(),Tc=(()=>{class o extends da{constructor(){super(...arguments),this.inputs=Zu}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275dir=l.lG2({type:o,selectors:[["","fxLayoutGap",""],["","fxLayoutGap.xs",""],["","fxLayoutGap.sm",""],["","fxLayoutGap.md",""],["","fxLayoutGap.lg",""],["","fxLayoutGap.xl",""],["","fxLayoutGap.lt-sm",""],["","fxLayoutGap.lt-md",""],["","fxLayoutGap.lt-lg",""],["","fxLayoutGap.lt-xl",""],["","fxLayoutGap.gt-xs",""],["","fxLayoutGap.gt-sm",""],["","fxLayoutGap.gt-md",""],["","fxLayoutGap.gt-lg",""]],inputs:{fxLayoutGap:"fxLayoutGap","fxLayoutGap.xs":"fxLayoutGap.xs","fxLayoutGap.sm":"fxLayoutGap.sm","fxLayoutGap.md":"fxLayoutGap.md","fxLayoutGap.lg":"fxLayoutGap.lg","fxLayoutGap.xl":"fxLayoutGap.xl","fxLayoutGap.lt-sm":"fxLayoutGap.lt-sm","fxLayoutGap.lt-md":"fxLayoutGap.lt-md","fxLayoutGap.lt-lg":"fxLayoutGap.lt-lg","fxLayoutGap.lt-xl":"fxLayoutGap.lt-xl","fxLayoutGap.gt-xs":"fxLayoutGap.gt-xs","fxLayoutGap.gt-sm":"fxLayoutGap.gt-sm","fxLayoutGap.gt-md":"fxLayoutGap.gt-md","fxLayoutGap.gt-lg":"fxLayoutGap.gt-lg"},features:[l.qOj]}),o})();const Ec=new Map,Hu=new Map,kc=new Map,Dc=new Map,Do=" grid";function pa(o,c){switch(c){case"column":return"margin-bottom";case"column-reverse":return"margin-top";case"row":default:return"rtl"===o?"margin-left":"margin-right";case"row-reverse":return"rtl"===o?"margin-right":"margin-left"}}function p(o,...c){if(null==o)throw TypeError("Cannot convert undefined or null to object");for(let e of c)if(null!=e)for(let a in e)e.hasOwnProperty(a)&&(o[a]=e[a]);return o}let r=(()=>{class o extends xi{constructor(e){super(),this.layoutConfig=e}buildStyles(e,a){let[_,C,...I]=e.split(" "),G=I.join(" ");const ot=a.direction.indexOf("column")>-1?"column":"row",xt=qn(ot)?"max-width":"max-height",qt=qn(ot)?"min-width":"min-height",pe=String(G).indexOf("calc")>-1,Ai=pe||"auto"===G,fn=String(G).indexOf("%")>-1&&!pe,zn=String(G).indexOf("px")>-1||String(G).indexOf("rem")>-1||String(G).indexOf("em")>-1||String(G).indexOf("vw")>-1||String(G).indexOf("vh")>-1;let Wi=pe||zn;_="0"==_?0:_,C="0"==C?0:C;const ka=!_&&!C;let Pi={};const Ps={"max-width":null,"max-height":null,"min-width":null,"min-height":null};switch(G||""){case"":const so=!1!==this.layoutConfig.useColumnBasisZero;G="row"===ot?"0%":so?"0.000000001px":"auto";break;case"initial":case"nogrow":_=0,G="auto";break;case"grow":G="100%";break;case"noshrink":C=0,G="auto";break;case"auto":break;case"none":_=0,C=0,G="auto";break;default:!Wi&&!fn&&!isNaN(G)&&(G+="%"),"0%"===G&&(Wi=!0),"0px"===G&&(G="0%"),Pi=p(Ps,pe?{"flex-grow":_,"flex-shrink":C,"flex-basis":Wi?G:"100%"}:{flex:`${_} ${C} ${Wi?G:"100%"}`})}return Pi.flex||Pi["flex-grow"]||(Pi=p(Ps,pe?{"flex-grow":_,"flex-shrink":C,"flex-basis":G}:{flex:`${_} ${C} ${G}`})),"0%"!==G&&"0px"!==G&&"0.000000001px"!==G&&"auto"!==G&&(Pi[qt]=ka||Wi&&_?G:null,Pi[xt]=ka||!Ai&&C?G:null),Pi[qt]||Pi[xt]?a.hasWrap&&(Pi[pe?"flex-basis":"flex"]=Pi[xt]?pe?Pi[xt]:`${_} ${C} ${Pi[xt]}`:pe?Pi[qt]:`${_} ${C} ${Pi[qt]}`):Pi=p(Ps,pe?{"flex-grow":_,"flex-shrink":C,"flex-basis":G}:{flex:`${_} ${C} ${G}`}),p(Pi,{"box-sizing":"border-box"})}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(un))},o.\u0275prov=(0,l.Yz7)({factory:function(){return new o((0,l.LFG)(un))},token:o,providedIn:"root"}),o})();const u=["fxFlex","fxFlex.xs","fxFlex.sm","fxFlex.md","fxFlex.lg","fxFlex.xl","fxFlex.lt-sm","fxFlex.lt-md","fxFlex.lt-lg","fxFlex.lt-xl","fxFlex.gt-xs","fxFlex.gt-sm","fxFlex.gt-md","fxFlex.gt-lg"];let v=(()=>{class o extends ii{constructor(e,a,_,C,I){super(e,C,a,I),this.layoutConfig=_,this.marshal=I,this.DIRECTIVE_KEY="flex",this.direction=void 0,this.wrap=void 0,this.flexGrow="1",this.flexShrink="1",this.init()}get shrink(){return this.flexShrink}set shrink(e){this.flexShrink=e||"1",this.triggerReflow()}get grow(){return this.flexGrow}set grow(e){this.flexGrow=e||"1",this.triggerReflow()}ngOnInit(){this.parentElement&&(this.marshal.trackValue(this.parentElement,"layout").pipe(ke(this.destroySubject)).subscribe(this.onLayoutChange.bind(this)),this.marshal.trackValue(this.nativeElement,"layout-align").pipe(ke(this.destroySubject)).subscribe(this.triggerReflow.bind(this)))}onLayoutChange(e){const _=e.value.split(" ");this.direction=_[0],this.wrap=void 0!==_[1]&&"wrap"===_[1],this.triggerUpdate()}updateWithValue(e){void 0===this.direction&&(this.direction=this.getFlexFlowDirection(this.parentElement,!1!==this.layoutConfig.addFlexToParent)),void 0===this.wrap&&(this.wrap=this.hasWrap(this.parentElement));const _=this.direction,C=_.startsWith("row"),I=this.wrap;C&&I?this.styleCache=T:C&&!I?this.styleCache=M:!C&&I?this.styleCache=D:!C&&!I&&(this.styleCache=A);const ot=hl(String(e).replace(";",""),this.flexGrow,this.flexShrink);this.addStyles(ot.join(" "),{direction:_,hasWrap:I})}triggerReflow(){const e=this.activatedValue;if(void 0!==e){const a=hl(e+"",this.flexGrow,this.flexShrink);this.marshal.updateElement(this.nativeElement,this.DIRECTIVE_KEY,a.join(" "))}}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Re),l.Y36(un),l.Y36(r),l.Y36(je))},o.\u0275dir=l.lG2({type:o,inputs:{shrink:["fxShrink","shrink"],grow:["fxGrow","grow"]},features:[l.qOj]}),o})(),x=(()=>{class o extends v{constructor(){super(...arguments),this.inputs=u}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275dir=l.lG2({type:o,selectors:[["","fxFlex",""],["","fxFlex.xs",""],["","fxFlex.sm",""],["","fxFlex.md",""],["","fxFlex.lg",""],["","fxFlex.xl",""],["","fxFlex.lt-sm",""],["","fxFlex.lt-md",""],["","fxFlex.lt-lg",""],["","fxFlex.lt-xl",""],["","fxFlex.gt-xs",""],["","fxFlex.gt-sm",""],["","fxFlex.gt-md",""],["","fxFlex.gt-lg",""]],inputs:{fxFlex:"fxFlex","fxFlex.xs":"fxFlex.xs","fxFlex.sm":"fxFlex.sm","fxFlex.md":"fxFlex.md","fxFlex.lg":"fxFlex.lg","fxFlex.xl":"fxFlex.xl","fxFlex.lt-sm":"fxFlex.lt-sm","fxFlex.lt-md":"fxFlex.lt-md","fxFlex.lt-lg":"fxFlex.lt-lg","fxFlex.lt-xl":"fxFlex.lt-xl","fxFlex.gt-xs":"fxFlex.gt-xs","fxFlex.gt-sm":"fxFlex.gt-sm","fxFlex.gt-md":"fxFlex.gt-md","fxFlex.gt-lg":"fxFlex.gt-lg"},features:[l.qOj]}),o})();const M=new Map,A=new Map,T=new Map,D=new Map;let Zt=(()=>{class o extends xi{buildStyles(e,a){const _={},[C,I]=e.split(" ");switch(C){case"center":_["justify-content"]="center";break;case"space-around":_["justify-content"]="space-around";break;case"space-between":_["justify-content"]="space-between";break;case"space-evenly":_["justify-content"]="space-evenly";break;case"end":case"flex-end":_["justify-content"]="flex-end";break;default:_["justify-content"]="flex-start"}switch(I){case"start":case"flex-start":_["align-items"]=_["align-content"]="flex-start";break;case"center":_["align-items"]=_["align-content"]="center";break;case"end":case"flex-end":_["align-items"]=_["align-content"]="flex-end";break;case"space-between":_["align-content"]="space-between",_["align-items"]="stretch";break;case"space-around":_["align-content"]="space-around",_["align-items"]="stretch";break;case"baseline":_["align-content"]="stretch",_["align-items"]="baseline";break;default:_["align-items"]=_["align-content"]="stretch"}return p(_,{display:a.inline?"inline-flex":"flex","flex-direction":a.layout,"box-sizing":"border-box","max-width":"stretch"===I?qn(a.layout)?null:"100%":null,"max-height":"stretch"===I&&qn(a.layout)?"100%":null})}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275prov=(0,l.Yz7)({factory:function(){return new o},token:o,providedIn:"root"}),o})();const Ut=["fxLayoutAlign","fxLayoutAlign.xs","fxLayoutAlign.sm","fxLayoutAlign.md","fxLayoutAlign.lg","fxLayoutAlign.xl","fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg"];let ie=(()=>{class o extends ii{constructor(e,a,_,C){super(e,_,a,C),this.DIRECTIVE_KEY="layout-align",this.layout="row",this.inline=!1,this.init(),this.marshal.trackValue(this.nativeElement,"layout").pipe(ke(this.destroySubject)).subscribe(this.onLayoutChange.bind(this))}updateWithValue(e){const a=this.layout||"row",_=this.inline;"row"===a&&_?this.styleCache=ai:"row"!==a||_?"row-reverse"===a&&_?this.styleCache=$e:"row-reverse"!==a||_?"column"===a&&_?this.styleCache=vi:"column"!==a||_?"column-reverse"===a&&_?this.styleCache=ji:"column-reverse"===a&&!_&&(this.styleCache=ze):this.styleCache=Kt:this.styleCache=me:this.styleCache=Te,this.addStyles(e,{layout:a,inline:_})}onLayoutChange(e){const a=e.value.split(" ");this.layout=a[0],this.inline=e.value.includes("inline"),qr.find(_=>_===this.layout)||(this.layout="row"),this.triggerUpdate()}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Re),l.Y36(Zt),l.Y36(je))},o.\u0275dir=l.lG2({type:o,features:[l.qOj]}),o})(),se=(()=>{class o extends ie{constructor(){super(...arguments),this.inputs=Ut}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275dir=l.lG2({type:o,selectors:[["","fxLayoutAlign",""],["","fxLayoutAlign.xs",""],["","fxLayoutAlign.sm",""],["","fxLayoutAlign.md",""],["","fxLayoutAlign.lg",""],["","fxLayoutAlign.xl",""],["","fxLayoutAlign.lt-sm",""],["","fxLayoutAlign.lt-md",""],["","fxLayoutAlign.lt-lg",""],["","fxLayoutAlign.lt-xl",""],["","fxLayoutAlign.gt-xs",""],["","fxLayoutAlign.gt-sm",""],["","fxLayoutAlign.gt-md",""],["","fxLayoutAlign.gt-lg",""]],inputs:{fxLayoutAlign:"fxLayoutAlign","fxLayoutAlign.xs":"fxLayoutAlign.xs","fxLayoutAlign.sm":"fxLayoutAlign.sm","fxLayoutAlign.md":"fxLayoutAlign.md","fxLayoutAlign.lg":"fxLayoutAlign.lg","fxLayoutAlign.xl":"fxLayoutAlign.xl","fxLayoutAlign.lt-sm":"fxLayoutAlign.lt-sm","fxLayoutAlign.lt-md":"fxLayoutAlign.lt-md","fxLayoutAlign.lt-lg":"fxLayoutAlign.lt-lg","fxLayoutAlign.lt-xl":"fxLayoutAlign.lt-xl","fxLayoutAlign.gt-xs":"fxLayoutAlign.gt-xs","fxLayoutAlign.gt-sm":"fxLayoutAlign.gt-sm","fxLayoutAlign.gt-md":"fxLayoutAlign.gt-md","fxLayoutAlign.gt-lg":"fxLayoutAlign.gt-lg"},features:[l.qOj]}),o})();const Te=new Map,Kt=new Map,me=new Map,ze=new Map,ai=new Map,vi=new Map,$e=new Map,ji=new Map;let nr=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Js,ko]}),o})(),mp=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Js]}),o})(),_p=(()=>{class o{constructor(e,a){(0,Vt.PM)(a)&&!e&&console.warn("Warning: Flex Layout loaded on the server without FlexLayoutServerModule")}static withConfig(e,a=[]){return{ngModule:o,providers:e.serverLoaded?[{provide:un,useValue:Object.assign(Object.assign({},dc),e)},{provide:cs,useValue:a,multi:!0},{provide:Mo,useValue:!0}]:[{provide:un,useValue:Object.assign(Object.assign({},dc),e)},{provide:cs,useValue:a,multi:!0}]}}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Mo),l.LFG(l.Lbi))},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[nr,ys,mp,nr,ys,mp]}),o})();var Ml=he(6630);let ga=(()=>{class o{constructor(){}getOpcionesConfiguracion(){return[{text:"Ubicaciones",path:"/dashboard/ubicaciones",icono:"my_location"},{text:"Invitados",path:"/dashboard/distribucion-mesas",icono:"restaurant"}]}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function yp(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"li",9),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.comprimido=!_.comprimido)}),l.TgZ(1,"div",10)(2,"span",11),l._uU(3),l.qZA()(),l._UZ(4,"div",12),l.qZA()}if(2&o){const e=c.$implicit;l.Q6J("routerLink",e.path),l.xp6(3),l.hij(" ",e.text," ")}}function pm(o,c){if(1&o&&(l.TgZ(0,"li",13)(1,"div"),l._uU(2),l.qZA()()),2&o){const e=c.$implicit;l.Q6J("routerLink",e.path),l.xp6(2),l.hij(" ",e.text," ")}}const _a=function(o){return{abierto:o}},Qu=function(o){return{comprimido:o}};let vp=(()=>{class o{constructor(e){this.enlacesService=e,this.enlaces=[],this.comprimido=!0}ngOnInit(){this.enlaces=this.enlacesService.getOpcionesConfiguracion()}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(ga))},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-menu-lateral"]],decls:12,vars:11,consts:[[1,"container"],["fxShow","false","fxShow.xs","true","fxShow.sm","true",1,"boton-menu",3,"ngClass","click"],[1,"linea"],["fxShow","false","fxShow.xs","true","fxShow.sm","true",1,"cortina",3,"ngClass"],["fxShow","false","fxShow.xs","true","fxShow.sm","true",1,"sidebar",3,"ngClass"],["routerLinkActive","hovered",3,"routerLink","click",4,"ngFor","ngForOf"],["fxShow","true","fxShow.xs","false","fxShow.sm","false",1,"toolbar"],["routerLinkActive","hovered",3,"routerLink",4,"ngFor","ngForOf"],[1,"content"],["routerLinkActive","hovered",3,"routerLink","click"],[1,"texto"],[1,"title"],[1,"tapa-title"],["routerLinkActive","hovered",3,"routerLink"]],template:function(e,a){1&e&&(l.TgZ(0,"div",0)(1,"div",1),l.NdJ("click",function(){return a.comprimido=!a.comprimido}),l._UZ(2,"div",2),l.qZA(),l._UZ(3,"div",3),l.TgZ(4,"div",4)(5,"ul"),l.YNc(6,yp,5,2,"li",5),l.qZA()(),l.TgZ(7,"div",6)(8,"ul"),l.YNc(9,pm,3,2,"li",7),l.qZA()(),l.TgZ(10,"div",8),l._UZ(11,"router-outlet"),l.qZA()()),2&e&&(l.xp6(1),l.Q6J("ngClass",l.VKq(5,_a,!a.comprimido)),l.xp6(2),l.Q6J("ngClass",l.VKq(7,_a,!a.comprimido)),l.xp6(1),l.Q6J("ngClass",l.VKq(9,Qu,a.comprimido)),l.xp6(2),l.Q6J("ngForOf",a.enlaces),l.xp6(3),l.Q6J("ngForOf",a.enlaces))},dependencies:[Vt.mk,Vt.sg,Ml.lC,Ml.rH,Ml.Od,Di,jr],styles:['.sidebar[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;right:0;width:500px;background:var(--tono1);color:var(--tono6);box-shadow:-5px 0 10px 10px var(--tono1);font-family:Square Peg,cursive;transition:var(--tr-menu);transition-timing-function:ease;z-index:50}.sidebar.comprimido[_ngcontent-%COMP%]{width:0;box-shadow:-5px 0 10px 10px transparent;transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-timing-function:ease}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;margin-left:80px;padding:0}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:70px;font-size:38pt;color:var(--tono6);cursor:pointer;position:relative;text-shadow:1px 1px 3px var(--tono5);transition:.2s}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{padding-left:15px;text-shadow:-14px 1px 10px var(--tono5);transition:.2s;transition-property:padding-left,text-shadow}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:first-child{margin-top:100px}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{z-index:5;opacity:1;transform:translateY(0);transition:var(--tr-texto-items);transition-delay:var(--trd-texto-items);transition-timing-function:ease;transition-property:opacity,transform}.sidebar.comprimido[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{z-index:5;opacity:0;font-size:0pt;transform:translateY(45px);transition:opacity var(--tr-texto-items) ease 0s,transform var(--tr-texto-items) ease 0s,font-size var(--tr-texto-items) ease var(--trd-texto-items)}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .tapa-title[_ngcontent-%COMP%]{width:100%;background:var(--tono1);height:0px;position:absolute;top:50px;z-index:10;transition:var(--tr-texto-items);transition-delay:var(--trd-texto-items);transition-timing-function:ease;transition-property:height}.sidebar.comprimido[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .tapa-title[_ngcontent-%COMP%]{width:100%;background:var(--tono1);height:100px;position:absolute;top:50px;z-index:10;transition:var(--tr-texto-items);transition-timing-function:ease;transition-property:height}.cortina[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;width:0px;z-index:1;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background-color:var(--tono5-transparente);transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-property:width;z-index:49}.cortina.abierto[_ngcontent-%COMP%]{width:100%;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);transition:var(--tr-menu);transition-property:width}.toolbar[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#000000C0,transparent);position:absolute;top:0;left:0;right:0;height:100px;z-index:25}.toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;margin:0;padding:30px;display:flex;justify-content:end;align-items:center;gap:40px}.toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-family:Comic Book Font,Square Peg,cursive;color:var(--tono6-tb-item);text-shadow:2px 2px 3px var(--tono3-transparente);font-size:18pt;padding-bottom:10px;border-bottom:2px solid var(--tono3-transparente);cursor:pointer;transition:.2s}.toolbar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{color:var(--tono6);border-bottom:2px solid var(--tono3);transform:translate(-2px,-2px);transition:.2s}.boton-menu[_ngcontent-%COMP%]{color:var(--tono1);padding:24px 20px 12px;width:26px;border-bottom-left-radius:5px;border-top-left-radius:5px;background-color:var(--tono3-transparente);cursor:pointer;position:fixed;right:0;top:calc(50% - 13px);transition:var(--tr-menu);transition-delay:var(--tr-texto-items);transition-timing-function:ease;z-index:51;box-shadow:1px 1px 3px var(--tono3-transparente)}.boton-menu.abierto[_ngcontent-%COMP%]{transition:var(--tr-menu);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%], .boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after, .boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{display:block;width:100%;border-top:2px solid var(--tono1);margin:5px 0;transition:.4s;transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]{transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{content:"";position:relative;border-top:2px solid var(--tono1);bottom:15px;transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after{content:"";position:relative;border-top:2px solid var(--tono1);bottom:6px;transition:.4s;transition-delay:var(--trd-texto-items);transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:before{transform:rotate(45deg);bottom:6px;border-top:2px solid var(--tono6);transition:.4s;transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]:after{transform:rotate(-45deg);bottom:13px;border-top:2px solid var(--tono6);transition:.4s;transition-timing-function:ease}.boton-menu.abierto[_ngcontent-%COMP%]   .linea[_ngcontent-%COMP%]{border-top:2px solid transparent;transition:.4s;transition-timing-function:ease}.content[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;right:0;left:0}.container[_ngcontent-%COMP%]{height:100%}@media screen and (max-width: 599px){.sidebar[_ngcontent-%COMP%]{width:100%}}']}),o})();var Kr=he(7545),Dn=he(4766);let xp=(()=>{class o{constructor(e){this.http=e,this.urlHeroes="api/heroe"}ngOnInit(){}obtenerListadoHeroes(){return this.http.get(`${Dn.N.backendUrl}/${this.urlHeroes}`)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(ur.eN))},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),Al=(()=>{class o{constructor(e){this.http=e,this.urlMesa="api/mesa",this.urlMesas="api/mesas"}guardarMesa(e){return this.http.post(`${Dn.N.backendUrl}/${this.urlMesa}`,e)}guardarMesas(e){const a={headers:new ur.WM};return a.headers.append("Access-Control-Allow-Origin","*"),a.headers.append("Content-Type","application/json"),a.headers.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),this.http.post(`${Dn.N.backendUrl}/${this.urlMesa}`,e,a)}obtenerListadoMesas(){return this.http.get(`${Dn.N.backendUrl}/${this.urlMesa}`)}modificarMesa(e){return this.http.put(`${Dn.N.backendUrl}/${this.urlMesa}/${e._id}`,e)}eliminarMesa(e){return this.http.delete(`${Dn.N.backendUrl}/${this.urlMesa}/${e}`)}eliminarTodasLasMesas(){return this.http.delete(`${Dn.N.backendUrl}/${this.urlMesas}`)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(ur.eN))},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),Mn=(()=>{class o{constructor(e,a){this.http=e,this.mesasService=a,this.urlInvitado="api/invitado",this.urlInvitados="api/invitados",this.urlActualizarCategoria="api/actualizar-categoria"}obtenerListadoInvitados(){return this.http.get(`${Dn.N.backendUrl}/${this.urlInvitado}`)}guardarInvitado(e){return this.http.post(`${Dn.N.backendUrl}/${this.urlInvitado}`,e)}guardarInvitados(e){const a={headers:new ur.WM};return a.headers.append("Access-Control-Allow-Origin","*"),a.headers.append("Content-Type","application/json"),a.headers.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),this.http.post(`${Dn.N.backendUrl}/${this.urlInvitado}/`,e,a)}actualizarInvitado(e,a){return this.http.put(`${Dn.N.backendUrl}/${this.urlInvitado}/${a}`,e)}eliminarInvitado(e){return this.http.delete(`${Dn.N.backendUrl}/${this.urlInvitado}/${e}`)}eliminarTodosLosInvitados(){return this.mesasService.eliminarTodasLasMesas().pipe((0,Kr.w)(()=>this.http.delete(`${Dn.N.backendUrl}/${this.urlInvitados}`)))}cambiarNombreCategoria(e,a){return this.http.post(`${Dn.N.backendUrl}/${this.urlActualizarCategoria}`,{nombreAntiguo:e,nombreNuevo:a})}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(ur.eN),l.LFG(Al))},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),th=(()=>{class o{constructor(){this.vColocados=[],this.m=this.inicializarMapa()}inicializarMapa(){for(var a=[],_=0;_<20;_++){a[_]=[];for(var C=0;C<20;C++)a[_][C]={letra:" ",esHeroe:!1,coordenada:{x:_,y:C},orientaciones:[],color:{r:255,g:255,b:255}}}return this.m=a,this.vColocados=[],a}mostrarMapa(){let e="";e+="   - 0 - 1 - 2 - 3 - 4 - 5 - 6 - 7 - 8 - 9 - 0 - 11- 12- 13- 14- 20- 16- 17- 18- 19-\n",e+="   ---------------------------------------------------------------------------------\n";for(var a=0;a<this.m.length;a++){e+=a<10?`${a}  `:`${a} `;for(var _=0;_<this.m[a].length;_++)e+=`| ${this.m[a][_].letra?this.m[a][_].letra:" "} `;e+="|\n   ---------------------------------------------------------------------------------\n"}console.log(e)}getMapa(){return this.m}getVColocados(){return this.vColocados}rellenarHuecosVacios(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ";this.m.forEach(a=>{a.forEach(_=>{" "==_.letra&&(_.letra=e.charAt(this.getRandomInt(e.length)))})})}colocarNombre(e){var a=!1;return this.vColocados.forEach(_=>{if(!a&&_.prioridad===e.prioridad-1&&e.orientacion!==_.orientacion){const C=this.getCoincidencias(_,e);a=this.insertarNombreEnMapa(C,e)}}),a}colocarHeroe(e){const a={x:this.getRandomInt(20-e.texto.length),y:this.getRandomInt(5)+4};for(var _=a.x;_<a.x+e.texto.length;_++)this.m[_][a.y]=e.letras[_-a.x],e.letras[_-a.x].coordenada={x:_,y:a.y};this.vColocados.push(e)}getCoincidencias(e,a){let _=[];return e.letras.forEach(C=>{a.letras.forEach(I=>{C.letra===I.letra&&_.push({letra:C.letra,esHeroe:C.esHeroe||I.esHeroe,coordenada:C.coordenada,orientaciones:["V","H"],color:this.mezclarColores(e.color,a.color)})})}),_}insertarNombreEnMapa(e,a){let _=!1;return e.forEach(C=>{if(!_){var I=0,G=!1;do{a.letras[I].letra===C.letra?(G=!0,a.letras[I].coordenada=C.coordenada):I++}while(!G&&I<a.letras.length);if("V"===a.orientacion&&a.letras[I].coordenada.x-I>=0&&a.letras[I].coordenada.x-I+a.texto.length-1<20){const xt=a.letras[I].coordenada.x-I,qt=xt+a.texto.length-1;console.log("Nombre:",a),console.log("i:",I,", xInicio:",xt,", xFin:",qt);for(var ot=xt;ot<=qt;ot++)a.letras[ot-xt].coordenada={x:ot,y:C.coordenada.y};if(this.puedoInsertarNombreEnMapa(a)){for(ot=xt;ot<=qt;ot++)this.m[ot][C.coordenada.y]=ot===C.coordenada.x?C:a.letras[ot-xt];_=!0,this.vColocados.push(a)}}else if("H"===a.orientacion&&a.letras[I].coordenada.y-I>=0&&a.letras[I].coordenada.y-I+a.texto.length-1<20){const xt=a.letras[I].coordenada.y-I,qt=xt+a.texto.length-1;for(ot=xt;ot<=qt;ot++)a.letras[ot-xt].coordenada={x:C.coordenada.x,y:ot};if(this.puedoInsertarNombreEnMapa(a)){for(ot=xt;ot<=qt;ot++)this.m[C.coordenada.x][ot]=ot===C.coordenada.y?C:a.letras[ot-xt];_=!0,this.vColocados.push(a)}}}}),_}obtenerNombre(e,a,_){const C={r:this.getRandomInt(256),g:this.getRandomInt(256),b:this.getRandomInt(256)},I=e.split("").map(G=>({letra:G.toUpperCase(),esHeroe:1===a,orientaciones:[_],color:C}));return{texto:e,prioridad:a,orientacion:_,letras:I,color:C}}puedoInsertarNombreEnMapa(e){const a=e.letras[0].coordenada,_=e.letras[e.texto.length-1].coordenada,C=e.orientacion,I="H"===C?a.y:a.x,G="H"===C?_.y:_.x;for(let ot=I;ot<=G;ot++){if("H"===C&&" "!==this.m[_.x][ot].letra&&this.m[_.x][ot].letra!=e.letras[ot-I].letra)return!1;if("V"===C&&" "!=this.m[ot][_.y].letra&&this.m[ot][_.y].letra!=e.letras[ot-I].letra)return!1}return!0}getMaximaPrioridadEnMapa(){let e=-1;return this.vColocados.forEach(a=>{e=a.prioridad>e?a.prioridad:e}),e}mezclarColores(e,a){return{r:(e.r+a.r)/2,g:(e.g+a.g)/2,b:(e.b+a.b)/2}}getRandomInt(e){return Math.floor(Math.random()*e)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();const Tl=function(o){return{"es-heroe":o}};function Fc(o,c){if(1&o&&(l.TgZ(0,"div",5),l._uU(1),l.qZA()),2&o){const e=c.$implicit;l.Q6J("ngClass",l.VKq(2,Tl,e.esHeroe)),l.xp6(1),l.hij(" ",e.letra," ")}}function ya(o,c){if(1&o&&(l.TgZ(0,"div",3),l.YNc(1,Fc,2,4,"div",4),l.qZA()),2&o){const e=c.$implicit;l.xp6(1),l.Q6J("ngForOf",e)}}function td(o,c){if(1&o&&l._UZ(0,"div",6),2&o){const e=c.$implicit;l.Udp("top",30*e.letras[0].coordenada.x,"px")("left",30*e.letras[0].coordenada.y,"px")("width","V"===e.orientacion?30:30*e.letras.length,"px")("height","V"===e.orientacion?30*e.letras.length:30,"px")}}let eh=(()=>{class o{constructor(e){this.sopaLetrasService=e,this.mapa=[],this.vColocados=[]}ngOnInit(){this.generarMapa()}generarMapa(){console.log("GENERAR MAPA"),this.sopaLetrasService.inicializarMapa();const e=this.sopaLetrasService.obtenerNombre(this.heroeSt,1,"V");this.sopaLetrasService.colocarHeroe(e);var a=2,_="H",C=0;do{this.vNombres.forEach(I=>{var G=this.sopaLetrasService.obtenerNombre(I,a,_);this.sopaLetrasService.colocarNombre(G)&&this.vNombres.splice(this.vNombres.indexOf(I),1)}),_="H"===_?"V":"H",a++,C++}while(this.vNombres.length>0&&C<30);this.sopaLetrasService.rellenarHuecosVacios(),this.mapa=this.sopaLetrasService.getMapa(),this.vColocados=this.sopaLetrasService.getVColocados(),this.vColocados.splice(this.vColocados.indexOf(e),1)}getColorString(e){return`rgba(${e.r}, ${e.g}, ${e.b}, 0.7)`}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(th))},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-sopa-letras"]],inputs:{heroeSt:"heroeSt",vNombres:"vNombres"},decls:3,vars:2,consts:[[1,"container"],["class","fila","fxLayout","row",4,"ngFor","ngForOf"],["class","linea",3,"top","left","width","height",4,"ngFor","ngForOf"],["fxLayout","row",1,"fila"],["class","celda",3,"ngClass",4,"ngFor","ngForOf"],[1,"celda",3,"ngClass"],[1,"linea"]],template:function(e,a){1&e&&(l.TgZ(0,"div",0),l.YNc(1,ya,2,1,"div",1),l.YNc(2,td,1,8,"div",2),l.qZA()),2&e&&(l.xp6(1),l.Q6J("ngForOf",a.mapa),l.xp6(1),l.Q6J("ngForOf",a.vColocados))},dependencies:[Vt.mk,Vt.sg,Zr,jr],styles:[".celda[_ngcontent-%COMP%]{height:25px;width:30px;text-align:center;font-size:11pt;padding-top:5px;font-family:CustomFont,sans-serif}.es-heroe[_ngcontent-%COMP%]{background-color:#5e0000!important;color:#fff!important}.linea[_ngcontent-%COMP%]{position:absolute;border:2px solid red;border-radius:50%;box-shadow:1px 2px 3px #00000080}@font-face{font-family:CustomFont;src:url(GoboldRegular.b1cb2a30e235b7b0.otf);font-weight:400}"]}),o})(),bp=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-spinner-carga"]],decls:1,vars:0,consts:[[1,"lds-hourglass"]],template:function(e,a){1&e&&l._UZ(0,"div",0)},styles:['.lds-hourglass[_ngcontent-%COMP%]{display:inline-block;position:relative;width:80px;height:80px}.lds-hourglass[_ngcontent-%COMP%]:after{content:" ";display:block;border-radius:50%;width:0;height:0;margin:8px;box-sizing:border-box;border:32px solid #fff;border-color:#fff transparent #fff transparent;animation:lds-hourglass 1.2s infinite}@keyframes lds-hourglass{0%{transform:rotate(0);animation-timing-function:cubic-bezier(.55,.055,.675,.19)}50%{transform:rotate(900deg);animation-timing-function:cubic-bezier(.215,.61,.355,1)}to{transform:rotate(1800deg)}}']}),o})();var sr=he(1086),ih=he(353),nh=he(3489),El=he(9312);class Cs{constructor(c,e){this.delay=c,this.scheduler=e}call(c,e){return e.subscribe(new Pc(c,this.delay,this.scheduler))}}class Pc extends nh.L{constructor(c,e,a){super(c),this.delay=e,this.scheduler=a,this.queue=[],this.active=!1,this.errored=!1}static dispatch(c){const e=c.source,a=e.queue,_=c.scheduler,C=c.destination;for(;a.length>0&&a[0].time-_.now()<=0;)a.shift().notification.observe(C);if(a.length>0){const I=Math.max(0,a[0].time-_.now());this.schedule(c,I)}else this.unsubscribe(),e.active=!1}_schedule(c){this.active=!0,this.destination.add(c.schedule(Pc.dispatch,this.delay,{source:this,destination:this.destination,scheduler:c}))}scheduleNotification(c){if(!0===this.errored)return;const e=this.scheduler,a=new wp(e.now()+this.delay,c);this.queue.push(a),!1===this.active&&this._schedule(e)}_next(c){this.scheduleNotification(El.P.createNext(c))}_error(c){this.errored=!0,this.queue=[],this.destination.error(c),this.unsubscribe()}_complete(){this.scheduleNotification(El.P.createComplete()),this.unsubscribe()}}class wp{constructor(c,e){this.time=c,this.notification=e}}const id=["inputBusqueda"];let nd=(()=>{class o{constructor(e){this.fb=e,this.eventoBusqueda=new l.vpe,this.formBusqueda=this.fb.group({busqueda:[]})}ngOnInit(){}emitirBusqueda(){const e=this.formBusqueda.get("busqueda")?.value;this.eventoBusqueda.emit(e||"")}clickCheck(){console.log(this.inputBusqueda),(0,sr.of)("").pipe(function kl(o,c=ih.P){const a=function ed(o){return o instanceof Date&&!isNaN(+o)}(o)?+o-c.now():Math.abs(o);return _=>_.lift(new Cs(a,c))}(250)).subscribe(()=>this.inputBusqueda.nativeElement.focus())}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(il))},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-input-busqueda"]],viewQuery:function(e,a){if(1&e&&l.Gf(id,5),2&e){let _;l.iGM(_=l.CRH())&&(a.inputBusqueda=_.first)}},outputs:{eventoBusqueda:"eventoBusqueda"},decls:7,vars:1,consts:[["fxLayoutAlign","center",1,"container"],["type","checkbox","id","checkbox",1,"c-checkbox",3,"click"],[1,"c-formContainer"],["action","",1,"c-form",3,"formGroup"],["placeholder","Escribe tu nombre...","type","text","formControlName","busqueda",1,"c-form__input",3,"keyup"],["inputBusqueda",""],["for","checkbox","data-title","\xbfD\xf3nde me siento?",1,"c-form__toggle"]],template:function(e,a){1&e&&(l.TgZ(0,"div",0)(1,"input",1),l.NdJ("click",function(){return a.clickCheck()}),l.qZA(),l.TgZ(2,"div",2)(3,"form",3)(4,"input",4,5),l.NdJ("keyup",function(){return a.emitirBusqueda()}),l.qZA(),l._UZ(6,"label",6),l.qZA()()()),2&e&&(l.xp6(3),l.Q6J("formGroup",a.formBusqueda))},dependencies:[yi,sn,po,fo,Vr,Za,se],styles:['@import"https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap";@import"https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap";.container[_ngcontent-%COMP%]{margin-top:40px;font-size:10px;text-transform:uppercase;font-family:Comic Book Font,Square Peg,cursive}.c-checkbox[_ngcontent-%COMP%]{display:none}.c-checkbox[_ngcontent-%COMP%]:checked + .c-formContainer[_ngcontent-%COMP%]   .c-form[_ngcontent-%COMP%]{width:35em}.c-checkbox[_ngcontent-%COMP%]:checked + .c-formContainer[_ngcontent-%COMP%]   .c-form__toggle[_ngcontent-%COMP%]{visibility:hidden;opacity:0;transform:scale(.7)}.c-checkbox[_ngcontent-%COMP%]:checked + .c-formContainer[_ngcontent-%COMP%]   .c-form__input[_ngcontent-%COMP%], .c-checkbox[_ngcontent-%COMP%]:checked + .c-formContainer[_ngcontent-%COMP%]   .c-form__buttonLabel[_ngcontent-%COMP%]{transition:.2s .1s;visibility:visible;opacity:1;transform:scale(1)}.c-checkbox[_ngcontent-%COMP%]:checked + .c-formContainer[_ngcontent-%COMP%]   .c-form__input[_ngcontent-%COMP%]:required:valid ~ .c-form__toggle[_ngcontent-%COMP%]:before, .c-checkbox[_ngcontent-%COMP%]:not(:checked)   d[_ngcontent-%COMP%] + .c-formContainer[_ngcontent-%COMP%]   .c-form__input[_ngcontent-%COMP%]:required:valid ~ .c-form__toggle[_ngcontent-%COMP%]:before{content:"Thank You! \\1f60a"}.c-checkbox[_ngcontent-%COMP%]:not(:checked) + .c-formContainer[_ngcontent-%COMP%]   .c-form__input[_ngcontent-%COMP%]:required:valid ~ .c-form__toggle[_ngcontent-%COMP%]{pointer-events:none;cursor:default}.c-formContainer[_ngcontent-%COMP%], .c-form[_ngcontent-%COMP%], .c-form__toggle[_ngcontent-%COMP%]{width:25em;height:5em}.c-formContainer[_ngcontent-%COMP%]{position:relative;font-weight:700}.c-form[_ngcontent-%COMP%], .c-form__toggle[_ngcontent-%COMP%]{position:absolute;border-radius:6.25em;background-color:#fff;transition:.2s}.c-form[_ngcontent-%COMP%]{left:50%;transform:translate(-50%);padding:.625em;box-sizing:border-box;box-shadow:0 .125em .3125em rgba(#000000,.3);display:flex;justify-content:center}.c-form__toggle[_ngcontent-%COMP%]{color:var(--tono1);padding:0 10px;top:0;cursor:pointer;z-index:1;display:flex;align-items:center;justify-content:center}.c-form__toggle[_ngcontent-%COMP%]:before{font-size:1.75em;content:attr(data-title)}.c-form__input[_ngcontent-%COMP%], .c-form__button[_ngcontent-%COMP%]{font:inherit;border:0;outline:0;border-radius:5em;box-sizing:border-box;text-transform:uppercase;text-align:center}.c-form__input[_ngcontent-%COMP%], .c-form__buttonLabel[_ngcontent-%COMP%]{font-size:1.75em;opacity:0;visibility:hidden;transform:scale(.7);transition:0s}.c-form__input[_ngcontent-%COMP%]{color:var(--tono2);height:100%;width:100%;padding:0 .714em}.c-form__input[_ngcontent-%COMP%]::placeholder{color:var(--tono3-transparente)}.c-form__input[_ngcontent-%COMP%]:required:valid{color:var(--tono1)}.c-form__input[_ngcontent-%COMP%]:required:valid + .c-form__buttonLabel[_ngcontent-%COMP%]{color:#fff}.c-form__input[_ngcontent-%COMP%]:required:valid + .c-form__buttonLabel[_ngcontent-%COMP%]:before{pointer-events:initial}.c-form__buttonLabel[_ngcontent-%COMP%]{color:var(--tono6);height:100%;width:auto}.c-form__buttonLabel[_ngcontent-%COMP%]:before{content:"";position:absolute;width:100%;height:100%;pointer-events:none;cursor:pointer}.c-form__button[_ngcontent-%COMP%]{color:inherit;padding:0;height:100%;width:5em;background-color:var(--tono1)}@font-face{font-family:Comic Book Font;src:url(ComicBook.37d3de50d316e077.otf)}']}),o})();function Cr(o,c){if(1&o&&(l.TgZ(0,"div",8),l._uU(1),l.qZA()),2&o){const e=c.$implicit;l.xp6(1),l.hij(" ",e," ")}}const rh=function(o){return{checked:o}},dn=function(o){return{"background-image":o}};let ar=(()=>{class o{constructor(){this.verReverso=!1}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-tarjeta"]],inputs:{mesa:"mesa"},decls:9,vars:8,consts:[[1,"card"],[1,"content",3,"ngClass","click"],[1,"front",3,"ngStyle"],[1,"borde-superior-nombre"],["fxLayoutAlign","center",1,"nombre-mesa"],[1,"back"],["fxLayout","column","fxLayoutAlign","center center",1,"tarjeta-reverso-container"],["class","item-invitado",4,"ngFor","ngForOf"],[1,"item-invitado"]],template:function(e,a){1&e&&(l.TgZ(0,"div",0)(1,"div",1),l.NdJ("click",function(){return a.verReverso=!a.verReverso}),l.TgZ(2,"div",2),l._UZ(3,"div",3),l.TgZ(4,"div",4),l._uU(5),l.qZA()(),l.TgZ(6,"div",5)(7,"div",6),l.YNc(8,Cr,2,1,"div",7),l.qZA()()()()),2&e&&(l.xp6(1),l.Q6J("ngClass",l.VKq(4,rh,a.verReverso)),l.xp6(1),l.Q6J("ngStyle",l.VKq(6,dn,"url("+a.mesa.heroeSchema.pathImagen+")")),l.xp6(3),l.hij(" Mesa ",a.mesa.heroeSchema.nombre," "),l.xp6(3),l.Q6J("ngForOf",a.mesa.vInvitados))},dependencies:[Vt.mk,Vt.sg,Vt.PC,Zr,se,jr,bc],styles:['.card[_ngcontent-%COMP%]{min-height:550px;margin:15px;box-shadow:3px 4px 4px var(--tono5-transparente);border-radius:5px;cursor:pointer;transition:.3s;position:relative;perspective:1500px}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:relative;width:100%;transform-style:preserve-3d;transition:transform .8s cubic-bezier(.75,0,.85,1)}.content.checked[_ngcontent-%COMP%]{transform:rotateY(180deg)}.front[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;-webkit-backface-visibility:hidden;backface-visibility:hidden;transform-style:preserve-3d;border-radius:6px}.back[_ngcontent-%COMP%]{-webkit-backface-visibility:hidden;backface-visibility:hidden;transform-style:preserve-3d;height:550px}.front[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{height:100%;display:grid;padding:1.5em;transform:translateZ(80px) scale(.94)}.front[_ngcontent-%COMP%]{background-size:cover;background-position:center center}.front[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;display:block;border-radius:6px;-webkit-backface-visibility:hidden;backface-visibility:hidden}.front[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{grid-template-rows:5fr 1fr 1fr 2fr 1fr;justify-items:center}.front[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{grid-row:3;color:#fffc;font-size:14px;display:flex;flex-flow:row nowrap}.nombre-mesa[_ngcontent-%COMP%]{margin-top:350px;padding-top:150px;height:200px;font-size:17pt;font-family:Comic Book Font,Square Peg,cursive;text-transform:uppercase;border-bottom-left-radius:5px;border-bottom-right-radius:5px;background:linear-gradient(to bottom,transparent,var(--transparente-2))}.back[_ngcontent-%COMP%]{transform:rotateY(180deg);background-color:#fff;background-image:url(fondo-comic-vinnetas-color.7eb4ad1982ffb5f0.jpeg);background-size:cover;background-position:center center;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:5px}.tarjeta-reverso-container[_ngcontent-%COMP%]{background-color:#fffe;border-radius:5px;box-shadow:2px 2px 4px #00000080;width:80%;height:90%}.item-invitado[_ngcontent-%COMP%]{color:#000;text-align:center;font-size:14pt;margin:8px 0;text-transform:uppercase;font-family:Comic Book Font,Square Peg,cursive}[_ngcontent-%COMP%]::-webkit-scrollbar{width:5px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:lighten(#355cc9,20%)}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#355cc9}']}),o})();const rd=["sopaDeLetras"];function Ii(o,c){1&o&&(l.TgZ(0,"div",10),l._UZ(1,"app-spinner-carga"),l.qZA())}function Cp(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div")(1,"app-input-busqueda",11),l.NdJ("eventoBusqueda",function(_){l.CHM(e);const C=l.oxw();return l.KtG(C.aplicarBusqueda(_))}),l.qZA()()}}function Lc(o,c){if(1&o&&(l.TgZ(0,"div",15),l._UZ(1,"app-tarjeta",16),l.qZA()),2&o){const e=c.$implicit;l.xp6(1),l.Q6J("mesa",e)}}function Mr(o,c){if(1&o&&(l.TgZ(0,"div",12)(1,"div",13),l.YNc(2,Lc,2,1,"div",14),l.qZA()()),2&o){const e=l.oxw();l.xp6(2),l.Q6J("ngForOf",e.vMesasMostradas)}}function fm(o,c){if(1&o&&(l.TgZ(0,"div",22),l._uU(1),l.qZA()),2&o){const e=c.$implicit;l.xp6(1),l.hij(" ",e.nombre," ")}}function mm(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",17)(1,"div",18)(2,"div",19),l.YNc(3,fm,2,1,"div",20),l.TgZ(4,"div",21),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.mostrandoListado=!1)}),l._uU(5," Cerrar listado "),l.qZA()()()()}if(2&o){const e=l.oxw();l.xp6(3),l.Q6J("ngForOf",e.vInvitadosMostrados)}}function Mp(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",23)(1,"div"),l._UZ(2,"app-sopa-letras",24,25),l.qZA(),l.TgZ(4,"div",26)(5,"div",27),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.cerrarSopaDeLetras())}),l._uU(6," Cerrar sopa "),l.qZA()()()}if(2&o){const e=l.oxw();l.xp6(2),l.Q6J("heroeSt",e.heroeSr)("vNombres",e.vNombres)}}let va=(()=>{class o{constructor(e,a,_,C){this.heroesService=e,this.mesasService=a,this.invitadosService=_,this.sopaLetrasService=C,this.vInvitados=[],this.vMesas=[],this.vHeroes=[],this.vMesasMostradas=[],this.mostrandoListado=!1,this.vInvitadosMostrados=[],this.vNombres=[],this.cargandoDatos=!1,this.mostrandoSopaLetras=!1,this.anchoPantalla=0,this.acentos=[{conTilde:"\xe1",sinTilde:"a"},{conTilde:"\xe9",sinTilde:"e"},{conTilde:"\xed",sinTilde:"i"},{conTilde:"\xf3",sinTilde:"o"},{conTilde:"\xfa",sinTilde:"u"},{conTilde:"\xc1",sinTilde:"A"},{conTilde:"\xc9",sinTilde:"E"},{conTilde:"\xcd",sinTilde:"I"},{conTilde:"\xd3",sinTilde:"O"},{conTilde:"\xda",sinTilde:"U"}]}ngOnInit(){this.anchoPantalla=window.innerWidth,this.cargandoDatos=!0,this.heroesService.obtenerListadoHeroes().pipe((0,Kr.w)(({data:e})=>(this.vHeroes=e,this.invitadosService.obtenerListadoInvitados())),(0,Kr.w)(({data:e})=>(this.vInvitados=e,this.mesasService.obtenerListadoMesas()))).subscribe(({data:e})=>{this.vMesas=e,this.vMesas.forEach(a=>{a.heroeSchema=this.vHeroes.find(_=>_._id===a.heroe),a.vInvitados=[]}),this.vInvitados.forEach(a=>{a.mesaSchema=this.vMesas.find(_=>_._id===a.mesa),this.vMesas.find(_=>_._id===a.mesa)?.vInvitados?.push(a.nombre)}),this.vMesasMostradas=this.vMesas,this.cargandoDatos=!1})}abrirListadoInvitados(e){const a=e.heroeSchema;this.vInvitadosMostrados=[],this.vInvitados.forEach(_=>{_.mesaSchema.heroe===a._id&&this.vInvitadosMostrados.push(_)}),this.vMesas.map(_=>_.mostrando=!1),e.mostrando=!0,this.mostrandoListado=!0}cerrarListadoInvitados(){this.mostrandoListado=!1,this.vMesas.map(e=>e.mostrando=!1)}mostrarSopaLetras(e){this.vInvitadosMostrados=[],this.vInvitados.forEach(a=>{a.mesaSchema.heroe===e._id&&(this.vInvitadosMostrados.push(a),this.vNombres.push(a.nombre.replace(" ","")))}),this.heroeSr=e.nombre,this.heroeSr=this.heroeSr.replace(" ",""),this.mostrandoSopaLetras=!0}cerrarSopaDeLetras(){this.vInvitadosMostrados=[],this.sopaLetrasService.inicializarMapa(),this.heroeSr="",this.mostrandoSopaLetras=!1}onResize(e){this.anchoPantalla=e.target.innerWidth}aplicarBusqueda(e){this.vMesasMostradas=this.vMesas.filter(a=>a.vInvitados.map(C=>C.toLowerCase()).some(C=>this.cumpleCriteriosBusqueda(C,e)))}cumpleCriteriosBusqueda(e,a){switch(e){case"rubia":return["m","mi","mir","miri","miria","miriam"].includes(a.toLowerCase())||e.toLowerCase().includes(a.toLowerCase())||this.coincideSinTildes(e,a);case"busti":return["b","be","bea","beat","beatr","beatri","beatriz"].includes(a.toLowerCase())||e.toLowerCase().includes(a.toLowerCase())||this.coincideSinTildes(e,a);default:return e.toLowerCase().includes(a.toLowerCase())||this.coincideSinTildes(e,a)}}coincideSinTildes(e,a){var _=e,C=a;return this.acentos.forEach(I=>{_=_.replace(I.conTilde,I.sinTilde),C=C.replace(I.conTilde,I.sinTilde)}),_.toLowerCase().includes(C.toLowerCase())}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(xp),l.Y36(Al),l.Y36(Mn),l.Y36(th))},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-distribucion-mesas"]],viewQuery:function(e,a){if(1&e&&l.Gf(rd,5),2&e){let _;l.iGM(_=l.CRH())&&(a.sopaLetras=_.first)}},hostBindings:function(e,a){1&e&&l.NdJ("resize",function(C){return a.onResize(C)},!1,l.Jf7)},decls:12,vars:5,consts:[[1,"container"],[1,"titulo-distribucion-mesas"],[1,"cortina"],["fxLayoutAlign","center center",1,"texto-titulo"],["fxLayoutAlign","center","class","spinner-carga",4,"ngIf"],[4,"ngIf"],["fxLayout","row wrap","class","container-tarjetas-grande","fxLayoutAlign","center",4,"ngIf"],[1,"fondo"],["class","dialog-listado-invitados",4,"ngIf"],["class","dialog-sopa-letras",4,"ngIf"],["fxLayoutAlign","center",1,"spinner-carga"],[3,"eventoBusqueda"],["fxLayout","row wrap","fxLayoutAlign","center",1,"container-tarjetas-grande"],["fxLayout","row wrap","fxLayoutAlign","center",1,"container-tarjetas"],["class","content-tarjeta","fxFlex","30","fxFlex.sm","45","fxFlex.xs","90",4,"ngFor","ngForOf"],["fxFlex","30","fxFlex.sm","45","fxFlex.xs","90",1,"content-tarjeta"],[3,"mesa"],[1,"dialog-listado-invitados"],[1,"listado-invitados"],["fxLayout","column","fxLayoutAlign","center center",1,"listado"],["class","invitado-item",4,"ngFor","ngForOf"],[1,"boton-cerrar-listado-invitados",3,"click"],[1,"invitado-item"],[1,"dialog-sopa-letras"],[3,"heroeSt","vNombres"],["sopaDeLetras",""],["fxLayoutAlign","center",1,"botonera-cerrar-sopa-letras"],[1,"boton",3,"click"]],template:function(e,a){1&e&&(l.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),l._uU(4," Distribuci\xf3n de invitados "),l.qZA()()(),l.YNc(5,Ii,2,0,"div",4),l.YNc(6,Cp,2,0,"div",5),l.YNc(7,Mr,3,1,"div",6),l.qZA(),l.TgZ(8,"div",7),l._UZ(9,"div",2),l.qZA(),l.YNc(10,mm,6,1,"div",8),l.YNc(11,Mp,7,2,"div",9)),2&e&&(l.xp6(5),l.Q6J("ngIf",0===a.vMesas.length),l.xp6(1),l.Q6J("ngIf",a.vMesas.length>0),l.xp6(1),l.Q6J("ngIf",a.vMesas.length>0),l.xp6(3),l.Q6J("ngIf",a.mostrandoListado),l.xp6(1),l.Q6J("ngIf",a.mostrandoSopaLetras))},dependencies:[Vt.sg,Vt.O5,Zr,se,x,eh,bp,nd,ar],styles:['@import"https://fonts.googleapis.com/css2?family=Abril+Fatface&display=swap";@import"https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap";.titulo-distribucion-mesas[_ngcontent-%COMP%]{width:100%;height:300px;background-image:url(foto-parador-3.54ab84ff17beded3.webp);background-position:center center;background-size:cover;font-family:Square Peg,cursive}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#00000090}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{color:#fff;text-shadow:2px 2px 3px #ffffff80;font-size:60pt;width:100%;height:100%}.spinner-carga[_ngcontent-%COMP%]{padding-top:50px}.fondo[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;right:0;background-image:url(foto-parador-1.501f9ed644383b38.jpeg);background-size:cover;background-position:center center;z-index:-10}.fondo[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#361d42c0}.container-tarjetas-grande[_ngcontent-%COMP%]{width:100%}.container-tarjetas[_ngcontent-%COMP%]{padding-top:50px;max-width:1400px;width:100%;margin:auto}.dialog-listado-invitados[_ngcontent-%COMP%]{z-index:30;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background-color:var(--tono5-transparente);position:fixed;top:0;bottom:0;left:0;right:0}.listado-invitados[_ngcontent-%COMP%]{width:400px;position:fixed;top:5%;bottom:5%;left:calc(50% - 200px);background-image:url(fondo-comic-vinnetas.1bc12bdaba77ae38.jpeg);background-size:cover;background-position:center center}.listado-invitados[_ngcontent-%COMP%] > .listado[_ngcontent-%COMP%]{position:relative;overflow-y:scroll;border-radius:5px;box-shadow:3px 4px 4px var(--tono5-transparente);padding-top:100px;padding-bottom:30px}.cerrar[_ngcontent-%COMP%]{position:fixed;top:0;right:0}.invitado-item[_ngcontent-%COMP%]{margin-top:30px;color:#fff;font-family:Square Peg,cursive;font-size:30pt;text-align:center}.boton-cerrar-listado-invitados[_ngcontent-%COMP%]{cursor:pointer;margin-top:50px;font-size:25pt;text-align:center;font-family:Square Peg,cursive}.dialog-sopa-letras[_ngcontent-%COMP%]{position:fixed;top:calc(45% - 300px);left:calc(50% - 300px)}.dialog-sopa-letras[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{z-index:5;background-color:#fff;border-radius:5px;box-shadow:3px 3px 3px var(--tono5-transparente)}.dialog-sopa-letras[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{border-bottom-right-radius:0!important;border-bottom-left-radius:0!important}.botonera-cerrar-sopa-letras[_ngcontent-%COMP%]{border-top-right-radius:0!important;border-top-left-radius:0!important}.botonera-cerrar-sopa-letras[_ngcontent-%COMP%]   .boton[_ngcontent-%COMP%]{margin:5px;padding:5px 20px;border:2px solid var(--tono5-transparente);background:var(--tono1);box-shadow:1px 2px 3px var(--tono1-transparente);border-radius:3px;color:var(--tono7);cursor:pointer;font-size:18pt;font-family:Square Peg,cursive}@media screen and (max-width: 595px){.listado-invitados[_ngcontent-%COMP%]{width:400px}.titulo-distribucion-mesas[_ngcontent-%COMP%]{height:300px}.titulo-distribucion-mesas[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{font-size:40pt}}@font-face{font-family:Avengers Font;src:url(AvengersFont.4131afb508e61ffa.otf)}@font-face{font-family:Comic Book Font;src:url(ComicBook.37d3de50d316e077.otf)}','.card[_ngcontent-%COMP%]{width:420px;height:340px;margin:1em;perspective:1500px}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .8s cubic-bezier(.75,0,.85,1)}.more[_ngcontent-%COMP%]{display:none}.more[_ngcontent-%COMP%]:checked ~ .content[_ngcontent-%COMP%]{transform:rotateY(180deg)}.front[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;-webkit-backface-visibility:hidden;backface-visibility:hidden;transform-style:preserve-3d;border-radius:6px}.front[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{height:100%;display:grid;padding:1.5em;transform:translateZ(80px) scale(.94)}.front[_ngcontent-%COMP%]{background-color:#fff;background-size:cover;background-position:center center}.front[_ngcontent-%COMP%]:after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;display:block;border-radius:6px;-webkit-backface-visibility:hidden;backface-visibility:hidden;background:linear-gradient(40deg,rgba(67,138,243,.7),rgba(255,242,166,.7))}.front[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{grid-template-rows:5fr 1fr 1fr 2fr 1fr;justify-items:center}.front[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{grid-row:2;margin-bottom:.3em;text-transform:uppercase;letter-spacing:3px;color:#fff;font-weight:500;text-shadow:0 0 6px rgba(0,0,0,.1)}.front[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]{grid-row:3;color:#fffc;font-size:14px;display:flex;flex-flow:row nowrap}.front[_ngcontent-%COMP%]   .rating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin:0 1px}.back[_ngcontent-%COMP%]{transform:rotateY(180deg);background-color:#fff;border:2px solid rgb(240,240,240)}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;color:#355cc9;grid-row:3}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]:not(:first-of-type):before{content:"";position:absolute;left:-.9em;height:18px;width:1px;background-color:#ccc}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:2em;font-weight:700}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]:before{background:linear-gradient(40deg,#355cc9,rgb(67,138,243));-webkit-text-fill-color:transparent;-webkit-background-clip:text}.back[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2em}.icon[_ngcontent-%COMP%]{margin-left:.3em}.icon[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;margin-top:-.25em;font-size:.8em;font-weight:600;white-space:nowrap}.back[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{grid-row:5;grid-column:1/-1;font-size:.86em;border-radius:5px;font-weight:600;line-height:1.4em;overflow:auto;color:#355cc9;padding-right:10px}.back[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%], .back[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-weight:600;color:#355cc9;grid-row:1;font-size:.86em}.back[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{grid-column:1/3;justify-self:left}.back[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{grid-column:3/-1;justify-self:right}.back[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{grid-column:1/-1;justify-self:center}.back[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{grid-template-rows:1fr 2fr 1fr 2fr 14fr 1fr 1fr;grid-template-columns:repeat(4,auto);grid-column-gap:.8em;justify-items:center}.button[_ngcontent-%COMP%]{grid-row:-1;text-transform:uppercase;letter-spacing:1px;font-weight:600;cursor:pointer;display:block;padding:0 1.5em;height:3em;line-height:2.9em;min-width:3em;background-color:transparent;border:solid 2px #fff;color:#fff;border-radius:4px;text-align:center;left:50%;-webkit-backface-visibility:hidden;backface-visibility:hidden;transition:.3s ease-in-out;text-shadow:0 0 6px rgba(0,0,0,.3)}.button[_ngcontent-%COMP%]:hover{background-color:#fff;box-shadow:0 0 50px #00000080;text-shadow:none;color:#355cc9}.button.return[_ngcontent-%COMP%]{line-height:3em;color:#355cc9;border-color:#355cc9;text-shadow:none}.button.return[_ngcontent-%COMP%]:hover{background-color:#355cc9;color:#fff;box-shadow:none}[_ngcontent-%COMP%]::-webkit-scrollbar{width:5px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:lighten(#355cc9,20%)}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#355cc9}']}),o})();const Ms="NOMBRE_ASC",Rc="NOMBRE_DESC",zc="MESA_ASC",od="MESA_DESC",Bc="NUMERO_ASC",oh="NUMERO_DESC";var Sp=he(7043);function xa(o,c,e,a){return(0,Sp.m)(e)&&(a=e,e=void 0),a?xa(o,c,e).pipe((0,li.U)(_=>(0,hr.k)(_)?a(..._):a(_))):new Bt.y(_=>{Tp(o,c,function C(I){_.next(arguments.length>1?Array.prototype.slice.call(arguments):I)},_,e)})}function Tp(o,c,e,a,_){let C;if(function kp(o){return o&&"function"==typeof o.addEventListener&&"function"==typeof o.removeEventListener}(o)){const I=o;o.addEventListener(c,e,_),C=()=>I.removeEventListener(c,e,_)}else if(function Ep(o){return o&&"function"==typeof o.on&&"function"==typeof o.off}(o)){const I=o;o.on(c,e),C=()=>I.off(c,e)}else if(function gm(o){return o&&"function"==typeof o.addListener&&"function"==typeof o.removeListener}(o)){const I=o;o.addListener(c,e),C=()=>I.removeListener(c,e)}else{if(!o||!o.length)throw new TypeError("Invalid event target");for(let I=0,G=o.length;I<G;I++)Tp(o[I],c,e,a,_)}a.add(C)}var Dp=he(6686),Bo=he(2268);new class On extends Bo.v{flush(c){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let a,_=-1,C=e.length;c=c||e.shift();do{if(a=c.execute(c.state,c.delay))break}while(++_<C&&(c=e.shift()));if(this.active=!1,a){for(;++_<C&&(c=e.shift());)c.unsubscribe();throw a}}}(class sd extends Dp.o{constructor(c,e){super(c,e),this.scheduler=c,this.work=e}requestAsyncId(c,e,a=0){return null!==a&&a>0?super.requestAsyncId(c,e,a):(c.actions.push(this),c.scheduled||(c.scheduled=requestAnimationFrame(()=>c.flush(null))))}recycleAsyncId(c,e,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(c,e,a);0===c.actions.length&&(cancelAnimationFrame(e),c.scheduled=void 0)}});he(8139);var Qr=he(2654),ba=he(5778);class sh{constructor(c){this.durationSelector=c}call(c,e){return e.subscribe(new Fp(c,this.durationSelector))}}class Fp extends ms.Ds{constructor(c,e){super(c),this.durationSelector=e,this.hasValue=!1}_next(c){if(this.value=c,this.hasValue=!0,!this.throttled){let e;try{const{durationSelector:_}=this;e=_(c)}catch(_){return this.destination.error(_)}const a=(0,ms.ft)(e,new ms.IY(this));!a||a.closed?this.clearThrottle():this.add(this.throttled=a)}}clearThrottle(){const{value:c,hasValue:e,throttled:a}=this;a&&(this.remove(a),this.throttled=void 0,a.unsubscribe()),e&&(this.value=void 0,this.hasValue=!1,this.destination.next(c))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}var As=he(4241),Dl=he(2866);function bm(o){const{index:c,period:e,subscriber:a}=o;if(a.next(c),!a.closed){if(-1===e)return a.complete();o.index=c+1,this.schedule(o,e)}}function ah(o,c=ih.P){return function vm(o){return function(e){return e.lift(new sh(o))}}(()=>function xm(o=0,c,e){let a=-1;return(0,As.k)(c)?a=Number(c)<1?1:Number(c):(0,Dl.K)(c)&&(e=c),(0,Dl.K)(e)||(e=ih.P),new Bt.y(_=>{const C=(0,As.k)(o)?o:+o-e.now();return e.schedule(bm,C,{index:0,period:a,subscriber:_})})}(o,c))}var Zn=he(1059);let ch;he(519),he(341),he(7770),he(5279),he(5283);try{ch=typeof Intl<"u"&&Intl.v8BreakIterator}catch{ch=!1}let to,Ye=(()=>{class o{constructor(e){this._platformId=e,this.isBrowser=this._platformId?(0,Vt.NF)(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!ch)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(l.Lbi))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(l.Lbi))},token:o,providedIn:"root"}),o})(),Vo=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({}),o})();const ld=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function cd(){if(to)return to;if("object"!=typeof document||!document)return to=new Set(ld),to;let o=document.createElement("input");return to=new Set(ld.filter(c=>(o.setAttribute("type",c),o.type===c))),to}let Go,Ss,Gc;function Ol(o){return function ud(){if(null==Go&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Go=!0}))}finally{Go=Go||!1}return Go}()?o:!!o.capture}function Fl(){if(null==Ss){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Ss=!1,Ss;if("scrollBehavior"in document.documentElement.style)Ss=!0;else{const o=Element.prototype.scrollTo;Ss=!!o&&!/\{\s*\[native code\]\s*\}/.test(o.toString())}}return Ss}function Pl(){let o=typeof document<"u"&&document?document.activeElement:null;for(;o&&o.shadowRoot;){const c=o.shadowRoot.activeElement;if(c===o)break;o=c}return o}function eo(o){return o.composedPath?o.composedPath()[0]:o.target}function dd(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}class hh{constructor(c=!1,e,a=!0){this._multiple=c,this._emitChanges=a,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new le.xQ,e&&e.length&&(c?e.forEach(_=>this._markSelected(_)):this._markSelected(e[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...c){this._verifyValueAssignment(c),c.forEach(e=>this._markSelected(e)),this._emitChangeEvent()}deselect(...c){this._verifyValueAssignment(c),c.forEach(e=>this._unmarkSelected(e)),this._emitChangeEvent()}toggle(c){this.isSelected(c)?this.deselect(c):this.select(c)}clear(){this._unmarkAll(),this._emitChangeEvent()}isSelected(c){return this._selection.has(c)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(c){this._multiple&&this.selected&&this._selected.sort(c)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(c){this.isSelected(c)||(this._multiple||this._unmarkAll(),this._selection.add(c),this._emitChanges&&this._selectedToEmit.push(c))}_unmarkSelected(c){this.isSelected(c)&&(this._selection.delete(c),this._emitChanges&&this._deselectedToEmit.push(c))}_unmarkAll(){this.isEmpty()||this._selection.forEach(c=>this._unmarkSelected(c))}_verifyValueAssignment(c){}}let Ll=(()=>{class o{constructor(e,a,_){this._ngZone=e,this._platform=a,this._scrolled=new le.xQ,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=_}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const a=this.scrollContainers.get(e);a&&(a.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new Bt.y(a=>{this._globalSubscription||this._addGlobalListener();const _=e>0?this._scrolled.pipe(ah(e)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{_.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,sr.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(e,a){const _=this.getAncestorScrollContainers(e);return this.scrolled(a).pipe((0,hi.h)(C=>!C||_.indexOf(C)>-1))}getAncestorScrollContainers(e){const a=[];return this.scrollContainers.forEach((_,C)=>{this._scrollableContainsElement(C,e)&&a.push(C)}),a}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,a){let _=Ui(a),C=e.getElementRef().nativeElement;do{if(_==C)return!0}while(_=_.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>xa(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(l.R0b),l.LFG(Ye),l.LFG(Vt.K0,8))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(l.R0b),l.LFG(Ye),l.LFG(Vt.K0,8))},token:o,providedIn:"root"}),o})(),Ts=(()=>{class o{constructor(e,a,_){this._platform=e,this._change=new le.xQ,this._changeListener=C=>{this._change.next(C)},this._document=_,a.runOutsideAngular(()=>{if(e.isBrowser){const C=this._getWindow();C.addEventListener("resize",this._changeListener),C.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:a,height:_}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+_,right:e.left+a,height:_,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,a=this._getWindow(),_=e.documentElement,C=_.getBoundingClientRect();return{top:-C.top||e.body.scrollTop||a.scrollY||_.scrollTop||0,left:-C.left||e.body.scrollLeft||a.scrollX||_.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(ah(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ye),l.LFG(l.R0b),l.LFG(Vt.K0,8))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ye),l.LFG(l.R0b),l.LFG(Vt.K0,8))},token:o,providedIn:"root"}),o})(),Rl=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({}),o})(),md=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ko,Vo,Rl,ko,Rl]}),o})();class dh{attach(c){return this._attachedHost=c,c.attach(this)}detach(){let c=this._attachedHost;null!=c&&(this._attachedHost=null,c.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(c){this._attachedHost=c}}class Bi extends dh{constructor(c,e,a,_){super(),this.component=c,this.viewContainerRef=e,this.injector=a,this.componentFactoryResolver=_}}class No extends dh{constructor(c,e,a){super(),this.templateRef=c,this.viewContainerRef=e,this.context=a}get origin(){return this.templateRef.elementRef}attach(c,e=this.context){return this.context=e,super.attach(c)}detach(){return this.context=void 0,super.detach()}}class qc extends dh{constructor(c){super(),this.element=c instanceof l.SBq?c.nativeElement:c}}class Zc{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(c){return c instanceof Bi?(this._attachedPortal=c,this.attachComponentPortal(c)):c instanceof No?(this._attachedPortal=c,this.attachTemplatePortal(c)):this.attachDomPortal&&c instanceof qc?(this._attachedPortal=c,this.attachDomPortal(c)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(c){this._disposeFn=c}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class Vp extends Zc{constructor(c,e,a,_,C){super(),this.outletElement=c,this._componentFactoryResolver=e,this._appRef=a,this._defaultInjector=_,this.attachDomPortal=I=>{const G=I.element,ot=this._document.createComment("dom-portal");G.parentNode.insertBefore(ot,G),this.outletElement.appendChild(G),this._attachedPortal=I,super.setDisposeFn(()=>{ot.parentNode&&ot.parentNode.replaceChild(G,ot)})},this._document=C}attachComponentPortal(c){const a=(c.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(c.component);let _;return c.viewContainerRef?(_=c.viewContainerRef.createComponent(a,c.viewContainerRef.length,c.injector||c.viewContainerRef.injector),this.setDisposeFn(()=>_.destroy())):(_=a.create(c.injector||this._defaultInjector),this._appRef.attachView(_.hostView),this.setDisposeFn(()=>{this._appRef.detachView(_.hostView),_.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(_)),this._attachedPortal=c,_}attachTemplatePortal(c){let e=c.viewContainerRef,a=e.createEmbeddedView(c.templateRef,c.context);return a.rootNodes.forEach(_=>this.outletElement.appendChild(_)),a.detectChanges(),this.setDisposeFn(()=>{let _=e.indexOf(a);-1!==_&&e.remove(_)}),this._attachedPortal=c,a}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(c){return c.hostView.rootNodes[0]}}let zl=(()=>{class o extends Zc{constructor(e,a,_){super(),this._componentFactoryResolver=e,this._viewContainerRef=a,this._isInitialized=!1,this.attached=new l.vpe,this.attachDomPortal=C=>{const I=C.element,G=this._document.createComment("dom-portal");C.setAttachedHost(this),I.parentNode.insertBefore(G,I),this._getRootNode().appendChild(I),this._attachedPortal=C,super.setDisposeFn(()=>{G.parentNode&&G.parentNode.replaceChild(I,G)})},this._document=_}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(e){e.setAttachedHost(this);const a=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,C=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),I=a.createComponent(C,a.length,e.injector||a.injector);return a!==this._viewContainerRef&&this._getRootNode().appendChild(I.hostView.rootNodes[0]),super.setDisposeFn(()=>I.destroy()),this._attachedPortal=e,this._attachedRef=I,this.attached.emit(I),I}attachTemplatePortal(e){e.setAttachedHost(this);const a=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context);return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=a,this.attached.emit(a),a}_getRootNode(){const e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l._Vd),l.Y36(l.s_b),l.Y36(Vt.K0))},o.\u0275dir=l.lG2({type:o,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[l.qOj]}),o})(),yd=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({}),o})();var Fn=he(2986),Np=he(4290);function Pn(o,...c){return c.length?c.some(e=>o[e]):o.altKey||o.shiftKey||o.ctrlKey||o.metaKey}const tu=Fl();class eu{constructor(c,e){this._viewportRuler=c,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const c=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=c.style.left||"",this._previousHTMLStyles.top=c.style.top||"",c.style.left=Ci(-this._previousScrollPosition.left),c.style.top=Ci(-this._previousScrollPosition.top),c.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const c=this._document.documentElement,a=c.style,_=this._document.body.style,C=a.scrollBehavior||"",I=_.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,c.classList.remove("cdk-global-scrollblock"),tu&&(a.scrollBehavior=_.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),tu&&(a.scrollBehavior=C,_.scrollBehavior=I)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,a=this._viewportRuler.getViewportSize();return e.scrollHeight>a.height||e.scrollWidth>a.width}}class sf{constructor(c,e,a,_){this._scrollDispatcher=c,this._ngZone=e,this._viewportRuler=a,this._config=_,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(c){this._overlayRef=c}enable(){if(this._scrollSubscription)return;const c=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=c.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=c.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class Nl{enable(){}disable(){}attach(){}}function iu(o,c){return c.some(e=>o.bottom<e.top||o.top>e.bottom||o.right<e.left||o.left>e.right)}function kd(o,c){return c.some(e=>o.top<e.top||o.bottom>e.bottom||o.left<e.left||o.right>e.right)}class nu{constructor(c,e,a,_){this._scrollDispatcher=c,this._viewportRuler=e,this._ngZone=a,this._config=_,this._scrollSubscription=null}attach(c){this._overlayRef=c}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:_}=this._viewportRuler.getViewportSize();iu(e,[{width:a,height:_,bottom:_,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let af=(()=>{class o{constructor(e,a,_,C){this._scrollDispatcher=e,this._viewportRuler=a,this._ngZone=_,this.noop=()=>new Nl,this.close=I=>new sf(this._scrollDispatcher,this._ngZone,this._viewportRuler,I),this.block=()=>new eu(this._viewportRuler,this._document),this.reposition=I=>new nu(this._scrollDispatcher,this._viewportRuler,this._ngZone,I),this._document=C}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ll),l.LFG(Ts),l.LFG(l.R0b),l.LFG(Vt.K0))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ll),l.LFG(Ts),l.LFG(l.R0b),l.LFG(Vt.K0))},token:o,providedIn:"root"}),o})();class ru{constructor(c){if(this.scrollStrategy=new Nl,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,c){const e=Object.keys(c);for(const a of e)void 0!==c[a]&&(this[a]=c[a])}}}class bg{constructor(c,e,a,_,C){this.offsetX=a,this.offsetY=_,this.panelClass=C,this.originX=c.originX,this.originY=c.originY,this.overlayX=e.overlayX,this.overlayY=e.overlayY}}class lf{constructor(c,e){this.connectionPair=c,this.scrollableViewProperties=e}}let qo=(()=>{class o{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const a=this._attachedOverlays.indexOf(e);a>-1&&this._attachedOverlays.splice(a,1),0===this._attachedOverlays.length&&this.detach()}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Vt.K0))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Vt.K0))},token:o,providedIn:"root"}),o})(),wg=(()=>{class o extends qo{constructor(e){super(e),this._keydownListener=a=>{const _=this._attachedOverlays;for(let C=_.length-1;C>-1;C--)if(_[C]._keydownEvents.observers.length>0){_[C]._keydownEvents.next(a);break}}}add(e){super.add(e),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Vt.K0))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Vt.K0))},token:o,providedIn:"root"}),o})(),ou=(()=>{class o extends qo{constructor(e,a){super(e),this._platform=a,this._cursorStyleIsSet=!1,this._pointerDownListener=_=>{this._pointerDownEventTarget=eo(_)},this._clickListener=_=>{const C=eo(_),I="click"===_.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:C;this._pointerDownEventTarget=null;const G=this._attachedOverlays.slice();for(let ot=G.length-1;ot>-1;ot--){const xt=G[ot];if(!(xt._outsidePointerEvents.observers.length<1)&&xt.hasAttached()){if(xt.overlayElement.contains(C)||xt.overlayElement.contains(I))break;xt._outsidePointerEvents.next(_)}}}}add(e){if(super.add(e),!this._isAttached){const a=this._document.body;a.addEventListener("pointerdown",this._pointerDownListener,!0),a.addEventListener("click",this._clickListener,!0),a.addEventListener("auxclick",this._clickListener,!0),a.addEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("pointerdown",this._pointerDownListener,!0),e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Vt.K0),l.LFG(Ye))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Vt.K0),l.LFG(Ye))},token:o,providedIn:"root"}),o})(),Zo=(()=>{class o{constructor(e,a){this._platform=a,this._document=e}ngOnDestroy(){const e=this._containerElement;e&&e.parentNode&&e.parentNode.removeChild(e)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||dd()){const _=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let C=0;C<_.length;C++)_[C].parentNode.removeChild(_[C])}const a=this._document.createElement("div");a.classList.add(e),dd()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Vt.K0),l.LFG(Ye))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Vt.K0),l.LFG(Ye))},token:o,providedIn:"root"}),o})();class su{constructor(c,e,a,_,C,I,G,ot,xt){this._portalOutlet=c,this._host=e,this._pane=a,this._config=_,this._ngZone=C,this._keyboardDispatcher=I,this._document=G,this._location=ot,this._outsideClickDispatcher=xt,this._backdropElement=null,this._backdropClick=new le.xQ,this._attachments=new le.xQ,this._detachments=new le.xQ,this._locationChanges=Qr.w.EMPTY,this._backdropClickHandler=qt=>this._backdropClick.next(qt),this._keydownEvents=new le.xQ,this._outsidePointerEvents=new le.xQ,_.scrollStrategy&&(this._scrollStrategy=_.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=_.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(c){let e=this._portalOutlet.attach(c);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe((0,Fn.q)(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const c=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),c}dispose(){const c=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,c&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(c){c!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=c,this.hasAttached()&&(c.attach(this),this.updatePosition()))}updateSize(c){this._config=Object.assign(Object.assign({},this._config),c),this._updateElementSize()}setDirection(c){this._config=Object.assign(Object.assign({},this._config),{direction:c}),this._updateElementDirection()}addPanelClass(c){this._pane&&this._toggleClasses(this._pane,c,!0)}removePanelClass(c){this._pane&&this._toggleClasses(this._pane,c,!1)}getDirection(){const c=this._config.direction;return c?"string"==typeof c?c:c.value:"ltr"}updateScrollStrategy(c){c!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=c,this.hasAttached()&&(c.attach(this),c.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const c=this._pane.style;c.width=Ci(this._config.width),c.height=Ci(this._config.height),c.minWidth=Ci(this._config.minWidth),c.minHeight=Ci(this._config.minHeight),c.maxWidth=Ci(this._config.maxWidth),c.maxHeight=Ci(this._config.maxHeight)}_togglePointerEvents(c){this._pane.style.pointerEvents=c?"":"none"}_attachBackdrop(){const c="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(c)})}):this._backdropElement.classList.add(c)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const c=this._backdropElement;if(!c)return;let e;const a=()=>{c&&(c.removeEventListener("click",this._backdropClickHandler),c.removeEventListener("transitionend",a),this._disposeBackdrop(c)),this._config.backdropClass&&this._toggleClasses(c,this._config.backdropClass,!1),clearTimeout(e)};c.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{c.addEventListener("transitionend",a)}),c.style.pointerEvents="none",e=this._ngZone.runOutsideAngular(()=>setTimeout(a,500))}_toggleClasses(c,e,a){const _=c.classList;oa(e).forEach(C=>{C&&(a?_.add(C):_.remove(C))})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const c=this._ngZone.onStable.pipe(ke((0,Un.T)(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),c.unsubscribe())})})}_disposeScrollStrategy(){const c=this._scrollStrategy;c&&(c.disable(),c.detach&&c.detach())}_disposeBackdrop(c){c&&(c.parentNode&&c.parentNode.removeChild(c),this._backdropElement===c&&(this._backdropElement=null))}}const jl="cdk-overlay-connected-position-bounding-box",vh=/([A-Za-z%]+)$/;class cf{constructor(c,e,a,_,C){this._viewportRuler=e,this._document=a,this._platform=_,this._overlayContainer=C,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new le.xQ,this._resizeSubscription=Qr.w.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(c)}get positions(){return this._preferredPositions}attach(c){this._validatePositions(),c.hostElement.classList.add(jl),this._overlayRef=c,this._boundingBox=c.hostElement,this._pane=c.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const c=this._originRect,e=this._overlayRect,a=this._viewportRect,_=[];let C;for(let I of this._preferredPositions){let G=this._getOriginPoint(c,I),ot=this._getOverlayPoint(G,e,I),xt=this._getOverlayFit(ot,e,a,I);if(xt.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(I,G);this._canFitWithFlexibleDimensions(xt,ot,a)?_.push({position:I,origin:G,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(G,I)}):(!C||C.overlayFit.visibleArea<xt.visibleArea)&&(C={overlayFit:xt,overlayPoint:ot,originPoint:G,position:I,overlayRect:e})}if(_.length){let I=null,G=-1;for(const ot of _){const xt=ot.boundingBoxRect.width*ot.boundingBoxRect.height*(ot.position.weight||1);xt>G&&(G=xt,I=ot)}return this._isPushed=!1,void this._applyPosition(I.position,I.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(C.position,C.originPoint);this._applyPosition(C.position,C.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Ma(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(jl),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const c=this._lastPosition||this._preferredPositions[0],e=this._getOriginPoint(this._originRect,c);this._applyPosition(c,e)}}withScrollableContainers(c){return this._scrollables=c,this}withPositions(c){return this._preferredPositions=c,-1===c.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(c){return this._viewportMargin=c,this}withFlexibleDimensions(c=!0){return this._hasFlexibleDimensions=c,this}withGrowAfterOpen(c=!0){return this._growAfterOpen=c,this}withPush(c=!0){return this._canPush=c,this}withLockedPosition(c=!0){return this._positionLocked=c,this}setOrigin(c){return this._origin=c,this}withDefaultOffsetX(c){return this._offsetX=c,this}withDefaultOffsetY(c){return this._offsetY=c,this}withTransformOriginOn(c){return this._transformOriginSelector=c,this}_getOriginPoint(c,e){let a,_;if("center"==e.originX)a=c.left+c.width/2;else{const C=this._isRtl()?c.right:c.left,I=this._isRtl()?c.left:c.right;a="start"==e.originX?C:I}return _="center"==e.originY?c.top+c.height/2:"top"==e.originY?c.top:c.bottom,{x:a,y:_}}_getOverlayPoint(c,e,a){let _,C;return _="center"==a.overlayX?-e.width/2:"start"===a.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,C="center"==a.overlayY?-e.height/2:"top"==a.overlayY?0:-e.height,{x:c.x+_,y:c.y+C}}_getOverlayFit(c,e,a,_){const C=au(e);let{x:I,y:G}=c,ot=this._getOffset(_,"x"),xt=this._getOffset(_,"y");ot&&(I+=ot),xt&&(G+=xt);let Ai=0-G,fn=G+C.height-a.height,zn=this._subtractOverflows(C.width,0-I,I+C.width-a.width),Wi=this._subtractOverflows(C.height,Ai,fn),ka=zn*Wi;return{visibleArea:ka,isCompletelyWithinViewport:C.width*C.height===ka,fitsInViewportVertically:Wi===C.height,fitsInViewportHorizontally:zn==C.width}}_canFitWithFlexibleDimensions(c,e,a){if(this._hasFlexibleDimensions){const _=a.bottom-e.y,C=a.right-e.x,I=Aa(this._overlayRef.getConfig().minHeight),G=Aa(this._overlayRef.getConfig().minWidth),xt=c.fitsInViewportHorizontally||null!=G&&G<=C;return(c.fitsInViewportVertically||null!=I&&I<=_)&&xt}return!1}_pushOverlayOnScreen(c,e,a){if(this._previousPushAmount&&this._positionLocked)return{x:c.x+this._previousPushAmount.x,y:c.y+this._previousPushAmount.y};const _=au(e),C=this._viewportRect,I=Math.max(c.x+_.width-C.width,0),G=Math.max(c.y+_.height-C.height,0),ot=Math.max(C.top-a.top-c.y,0),xt=Math.max(C.left-a.left-c.x,0);let qt=0,pe=0;return qt=_.width<=C.width?xt||-I:c.x<this._viewportMargin?C.left-a.left-c.x:0,pe=_.height<=C.height?ot||-G:c.y<this._viewportMargin?C.top-a.top-c.y:0,this._previousPushAmount={x:qt,y:pe},{x:c.x+qt,y:c.y+pe}}_applyPosition(c,e){if(this._setTransformOrigin(c),this._setOverlayElementStyles(e,c),this._setBoundingBoxStyles(e,c),c.panelClass&&this._addPanelClasses(c.panelClass),this._lastPosition=c,this._positionChanges.observers.length){const a=this._getScrollVisibility(),_=new lf(c,a);this._positionChanges.next(_)}this._isInitialRender=!1}_setTransformOrigin(c){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let a,_=c.overlayY;a="center"===c.overlayX?"center":this._isRtl()?"start"===c.overlayX?"right":"left":"start"===c.overlayX?"left":"right";for(let C=0;C<e.length;C++)e[C].style.transformOrigin=`${a} ${_}`}_calculateBoundingBoxRect(c,e){const a=this._viewportRect,_=this._isRtl();let C,I,G,qt,pe,Ai;if("top"===e.overlayY)I=c.y,C=a.height-I+this._viewportMargin;else if("bottom"===e.overlayY)G=a.height-c.y+2*this._viewportMargin,C=a.height-G+this._viewportMargin;else{const fn=Math.min(a.bottom-c.y+a.top,c.y),zn=this._lastBoundingBoxSize.height;C=2*fn,I=c.y-fn,C>zn&&!this._isInitialRender&&!this._growAfterOpen&&(I=c.y-zn/2)}if("end"===e.overlayX&&!_||"start"===e.overlayX&&_)Ai=a.width-c.x+this._viewportMargin,qt=c.x-this._viewportMargin;else if("start"===e.overlayX&&!_||"end"===e.overlayX&&_)pe=c.x,qt=a.right-c.x;else{const fn=Math.min(a.right-c.x+a.left,c.x),zn=this._lastBoundingBoxSize.width;qt=2*fn,pe=c.x-fn,qt>zn&&!this._isInitialRender&&!this._growAfterOpen&&(pe=c.x-zn/2)}return{top:I,left:pe,bottom:G,right:Ai,width:qt,height:C}}_setBoundingBoxStyles(c,e){const a=this._calculateBoundingBoxRect(c,e);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));const _={};if(this._hasExactPosition())_.top=_.left="0",_.bottom=_.right=_.maxHeight=_.maxWidth="",_.width=_.height="100%";else{const C=this._overlayRef.getConfig().maxHeight,I=this._overlayRef.getConfig().maxWidth;_.height=Ci(a.height),_.top=Ci(a.top),_.bottom=Ci(a.bottom),_.width=Ci(a.width),_.left=Ci(a.left),_.right=Ci(a.right),_.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",_.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",C&&(_.maxHeight=Ci(C)),I&&(_.maxWidth=Ci(I))}this._lastBoundingBoxSize=a,Ma(this._boundingBox.style,_)}_resetBoundingBoxStyles(){Ma(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Ma(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(c,e){const a={},_=this._hasExactPosition(),C=this._hasFlexibleDimensions,I=this._overlayRef.getConfig();if(_){const qt=this._viewportRuler.getViewportScrollPosition();Ma(a,this._getExactOverlayY(e,c,qt)),Ma(a,this._getExactOverlayX(e,c,qt))}else a.position="static";let G="",ot=this._getOffset(e,"x"),xt=this._getOffset(e,"y");ot&&(G+=`translateX(${ot}px) `),xt&&(G+=`translateY(${xt}px)`),a.transform=G.trim(),I.maxHeight&&(_?a.maxHeight=Ci(I.maxHeight):C&&(a.maxHeight="")),I.maxWidth&&(_?a.maxWidth=Ci(I.maxWidth):C&&(a.maxWidth="")),Ma(this._pane.style,a)}_getExactOverlayY(c,e,a){let _={top:"",bottom:""},C=this._getOverlayPoint(e,this._overlayRect,c);this._isPushed&&(C=this._pushOverlayOnScreen(C,this._overlayRect,a));let I=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return C.y-=I,"bottom"===c.overlayY?_.bottom=this._document.documentElement.clientHeight-(C.y+this._overlayRect.height)+"px":_.top=Ci(C.y),_}_getExactOverlayX(c,e,a){let I,_={left:"",right:""},C=this._getOverlayPoint(e,this._overlayRect,c);return this._isPushed&&(C=this._pushOverlayOnScreen(C,this._overlayRect,a)),I=this._isRtl()?"end"===c.overlayX?"left":"right":"end"===c.overlayX?"right":"left","right"===I?_.right=this._document.documentElement.clientWidth-(C.x+this._overlayRect.width)+"px":_.left=Ci(C.x),_}_getScrollVisibility(){const c=this._getOriginRect(),e=this._pane.getBoundingClientRect(),a=this._scrollables.map(_=>_.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:kd(c,a),isOriginOutsideView:iu(c,a),isOverlayClipped:kd(e,a),isOverlayOutsideView:iu(e,a)}}_subtractOverflows(c,...e){return e.reduce((a,_)=>a-Math.max(_,0),c)}_getNarrowedViewportRect(){const c=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+c-this._viewportMargin,bottom:a.top+e-this._viewportMargin,width:c-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(c,e){return"x"===e?c.offsetX??this._offsetX:c.offsetY??this._offsetY}_validatePositions(){}_addPanelClasses(c){this._pane&&oa(c).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(c=>{this._pane.classList.remove(c)}),this._appliedPanelClasses=[])}_getOriginRect(){const c=this._origin;if(c instanceof l.SBq)return c.nativeElement.getBoundingClientRect();if(c instanceof Element)return c.getBoundingClientRect();const e=c.width||0,a=c.height||0;return{top:c.y,bottom:c.y+a,left:c.x,right:c.x+e,height:a,width:e}}}function Ma(o,c){for(let e in c)c.hasOwnProperty(e)&&(o[e]=c[e]);return o}function Aa(o){if("number"!=typeof o&&null!=o){const[c,e]=o.split(vh);return e&&"px"!==e?null:parseFloat(c)}return o||null}function au(o){return{top:Math.floor(o.top),right:Math.floor(o.right),bottom:Math.floor(o.bottom),left:Math.floor(o.left),width:Math.floor(o.width),height:Math.floor(o.height)}}class Cg{constructor(c,e,a,_,C,I,G){this._preferredPositions=[],this._positionStrategy=new cf(a,_,C,I,G).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(c,e),this.onPositionChange=this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(c){this._overlayRef=c,this._positionStrategy.attach(c),this._direction&&(c.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(c){this._positionStrategy.withScrollableContainers(c)}withFallbackPosition(c,e,a,_){const C=new bg(c,e,a,_);return this._preferredPositions.push(C),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(c){return this._overlayRef?this._overlayRef.setDirection(c):this._direction=c,this}withOffsetX(c){return this._positionStrategy.withDefaultOffsetX(c),this}withOffsetY(c){return this._positionStrategy.withDefaultOffsetY(c),this}withLockedPosition(c){return this._positionStrategy.withLockedPosition(c),this}withPositions(c){return this._preferredPositions=c.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(c){return this._positionStrategy.setOrigin(c),this}}const Dd="cdk-global-overlay-wrapper";class uf{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(c){const e=c.getConfig();this._overlayRef=c,this._width&&!e.width&&c.updateSize({width:this._width}),this._height&&!e.height&&c.updateSize({height:this._height}),c.hostElement.classList.add(Dd),this._isDisposed=!1}top(c=""){return this._bottomOffset="",this._topOffset=c,this._alignItems="flex-start",this}left(c=""){return this._rightOffset="",this._leftOffset=c,this._justifyContent="flex-start",this}bottom(c=""){return this._topOffset="",this._bottomOffset=c,this._alignItems="flex-end",this}right(c=""){return this._leftOffset="",this._rightOffset=c,this._justifyContent="flex-end",this}width(c=""){return this._overlayRef?this._overlayRef.updateSize({width:c}):this._width=c,this}height(c=""){return this._overlayRef?this._overlayRef.updateSize({height:c}):this._height=c,this}centerHorizontally(c=""){return this.left(c),this._justifyContent="center",this}centerVertically(c=""){return this.top(c),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const c=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:_,height:C,maxWidth:I,maxHeight:G}=a,ot=!("100%"!==_&&"100vw"!==_||I&&"100%"!==I&&"100vw"!==I),xt=!("100%"!==C&&"100vh"!==C||G&&"100%"!==G&&"100vh"!==G);c.position=this._cssPosition,c.marginLeft=ot?"0":this._leftOffset,c.marginTop=xt?"0":this._topOffset,c.marginBottom=this._bottomOffset,c.marginRight=this._rightOffset,ot?e.justifyContent="flex-start":"center"===this._justifyContent?e.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?e.justifyContent="flex-end":"flex-end"===this._justifyContent&&(e.justifyContent="flex-start"):e.justifyContent=this._justifyContent,e.alignItems=xt?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const c=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,a=e.style;e.classList.remove(Dd),a.justifyContent=a.alignItems=c.marginTop=c.marginBottom=c.marginLeft=c.marginRight=c.position="",this._overlayRef=null,this._isDisposed=!0}}let Mg=(()=>{class o{constructor(e,a,_,C){this._viewportRuler=e,this._document=a,this._platform=_,this._overlayContainer=C}global(){return new uf}connectedTo(e,a,_){return new Cg(a,_,e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}flexibleConnectedTo(e){return new cf(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ts),l.LFG(Vt.K0),l.LFG(Ye),l.LFG(Zo))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ts),l.LFG(Vt.K0),l.LFG(Ye),l.LFG(Zo))},token:o,providedIn:"root"}),o})(),hf=0,Ho=(()=>{class o{constructor(e,a,_,C,I,G,ot,xt,qt,pe,Ai){this.scrollStrategies=e,this._overlayContainer=a,this._componentFactoryResolver=_,this._positionBuilder=C,this._keyboardDispatcher=I,this._injector=G,this._ngZone=ot,this._document=xt,this._directionality=qt,this._location=pe,this._outsideClickDispatcher=Ai}create(e){const a=this._createHostElement(),_=this._createPaneElement(a),C=this._createPortalOutlet(_),I=new ru(e);return I.direction=I.direction||this._directionality.value,new su(C,a,_,I,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(e){const a=this._document.createElement("div");return a.id="cdk-overlay-"+hf++,a.classList.add("cdk-overlay-pane"),e.appendChild(a),a}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(l.z2F)),new Vp(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(af),l.LFG(Zo),l.LFG(l._Vd),l.LFG(Mg),l.LFG(wg),l.LFG(l.zs3),l.LFG(l.R0b),l.LFG(Vt.K0),l.LFG(hn),l.LFG(Vt.Ye),l.LFG(ou))},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac}),o})();const df=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],pf=new l.OlP("cdk-connected-overlay-scroll-strategy");let ff=(()=>{class o{constructor(e){this.elementRef=e}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq))},o.\u0275dir=l.lG2({type:o,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),o})(),mf=(()=>{class o{constructor(e,a,_,C,I){this._overlay=e,this._dir=I,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=Qr.w.EMPTY,this._attachSubscription=Qr.w.EMPTY,this._detachSubscription=Qr.w.EMPTY,this._positionSubscription=Qr.w.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new l.vpe,this.positionChange=new l.vpe,this.attach=new l.vpe,this.detach=new l.vpe,this.overlayKeydown=new l.vpe,this.overlayOutsideClick=new l.vpe,this._templatePortal=new No(a,_),this._scrollStrategyFactory=C,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=ge(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=ge(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=ge(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=ge(e)}get push(){return this._push}set push(e){this._push=ge(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=df);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(a=>{this.overlayKeydown.next(a),27===a.keyCode&&!this.disableClose&&!Pn(a)&&(a.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(a=>{this.overlayOutsideClick.next(a)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),a=new ru({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(a.width=this.width),(this.height||0===this.height)&&(a.height=this.height),(this.minWidth||0===this.minWidth)&&(a.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(a.minHeight=this.minHeight),this.backdropClass&&(a.backdropClass=this.backdropClass),this.panelClass&&(a.panelClass=this.panelClass),a}_updatePositionStrategy(e){const a=this.positions.map(_=>({originX:_.originX,originY:_.originY,overlayX:_.overlayX,overlayY:_.overlayY,offsetX:_.offsetX||this.offsetX,offsetY:_.offsetY||this.offsetY,panelClass:_.panelClass||void 0}));return e.setOrigin(this.origin.elementRef).withPositions(a).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.origin.elementRef);return this._updatePositionStrategy(e),e}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe((0,Np.o)(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Ho),l.Y36(l.Rgc),l.Y36(l.s_b),l.Y36(pf),l.Y36(hn,8))},o.\u0275dir=l.lG2({type:o,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"],positions:["cdkConnectedOverlayPositions","positions"],origin:["cdkConnectedOverlayOrigin","origin"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[l.TTD]}),o})();const xh={provide:pf,deps:[Ho],useFactory:function Ag(o){return()=>o.scrollStrategies.reposition()}};let ql=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({providers:[Ho,xh],imports:[ko,yd,md,md]}),o})();function bh(o,c=ih.P){return e=>e.lift(new Od(o,c))}class Od{constructor(c,e){this.dueTime=c,this.scheduler=e}call(c,e){return e.subscribe(new Fd(c,this.dueTime,this.scheduler))}}class Fd extends nh.L{constructor(c,e,a){super(c),this.dueTime=e,this.scheduler=a,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(c){this.clearDebounce(),this.lastValue=c,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Ds,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:c}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(c)}}clearDebounce(){const c=this.debouncedSubscription;null!==c&&(this.remove(c),c.unsubscribe(),this.debouncedSubscription=null)}}function Ds(o){o.debouncedNext()}function gf(o){return c=>c.lift(new Pd(o))}class Pd{constructor(c){this.total=c}call(c,e){return e.subscribe(new _f(c,this.total))}}class _f extends nh.L{constructor(c,e){super(c),this.total=e,this.count=0}_next(c){++this.count>this.total&&this.destination.next(c)}}let Zl=(()=>{class o{create(e){return typeof MutationObserver>"u"?null:new MutationObserver(e)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=l.Yz7({factory:function(){return new o},token:o,providedIn:"root"}),o})(),yf=(()=>{class o{constructor(e){this._mutationObserverFactory=e,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((e,a)=>this._cleanupObserver(a))}observe(e){const a=Ui(e);return new Bt.y(_=>{const I=this._observeElement(a).subscribe(_);return()=>{I.unsubscribe(),this._unobserveElement(a)}})}_observeElement(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{const a=new le.xQ,_=this._mutationObserverFactory.create(C=>a.next(C));_&&_.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:_,stream:a,count:1})}return this._observedElements.get(e).stream}_unobserveElement(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}_cleanupObserver(e){if(this._observedElements.has(e)){const{observer:a,stream:_}=this._observedElements.get(e);a&&a.disconnect(),_.complete(),this._observedElements.delete(e)}}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Zl))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Zl))},token:o,providedIn:"root"}),o})(),vf=(()=>{class o{constructor(e,a,_){this._contentObserver=e,this._elementRef=a,this._ngZone=_,this.event=new l.vpe,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(e){this._disabled=ge(e),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(e){this._debounce=zi(e),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const e=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?e.pipe(bh(this.debounce)):e).subscribe(this.event)})}_unsubscribe(){var e;null===(e=this._currentSubscription)||void 0===e||e.unsubscribe()}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(yf),l.Y36(l.SBq),l.Y36(l.R0b))},o.\u0275dir=l.lG2({type:o,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),o})(),Ld=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({providers:[Zl]}),o})();class Is extends class Sr{constructor(c){this._items=c,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new le.xQ,this._typeaheadSubscription=Qr.w.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new le.xQ,this.change=new le.xQ,c instanceof l.n_E&&c.changes.subscribe(e=>{if(this._activeItem){const _=e.toArray().indexOf(this._activeItem);_>-1&&_!==this._activeItemIndex&&(this._activeItemIndex=_)}})}skipPredicate(c){return this._skipPredicateFn=c,this}withWrap(c=!0){return this._wrap=c,this}withVerticalOrientation(c=!0){return this._vertical=c,this}withHorizontalOrientation(c){return this._horizontal=c,this}withAllowedModifierKeys(c){return this._allowedModifierKeys=c,this}withTypeAhead(c=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe((0,Co.b)(e=>this._pressedLetters.push(e)),bh(c),(0,hi.h)(()=>this._pressedLetters.length>0),(0,li.U)(()=>this._pressedLetters.join(""))).subscribe(e=>{const a=this._getItemsArray();for(let _=1;_<a.length+1;_++){const C=(this._activeItemIndex+_)%a.length,I=a[C];if(!this._skipPredicateFn(I)&&0===I.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(C);break}}this._pressedLetters=[]}),this}withHomeAndEnd(c=!0){return this._homeAndEnd=c,this}setActiveItem(c){const e=this._activeItem;this.updateActiveItem(c),this._activeItem!==e&&this.change.next(this._activeItemIndex)}onKeydown(c){const e=c.keyCode,_=["altKey","ctrlKey","metaKey","shiftKey"].every(C=>!c[C]||this._allowedModifierKeys.indexOf(C)>-1);switch(e){case 9:return void this.tabOut.next();case 40:if(this._vertical&&_){this.setNextItemActive();break}return;case 38:if(this._vertical&&_){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&_){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&_){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&_){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&_){this.setLastItemActive();break}return;default:return void((_||Pn(c,"shiftKey"))&&(c.key&&1===c.key.length?this._letterKeyStream.next(c.key.toLocaleUpperCase()):(e>=65&&e<=90||e>=48&&e<=57)&&this._letterKeyStream.next(String.fromCharCode(e))))}this._pressedLetters=[],c.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(c){const e=this._getItemsArray(),a="number"==typeof c?c:e.indexOf(c);this._activeItem=e[a]??null,this._activeItemIndex=a}_setActiveItemByDelta(c){this._wrap?this._setActiveInWrapMode(c):this._setActiveInDefaultMode(c)}_setActiveInWrapMode(c){const e=this._getItemsArray();for(let a=1;a<=e.length;a++){const _=(this._activeItemIndex+c*a+e.length)%e.length;if(!this._skipPredicateFn(e[_]))return void this.setActiveItem(_)}}_setActiveInDefaultMode(c){this._setActiveItemByIndex(this._activeItemIndex+c,c)}_setActiveItemByIndex(c,e){const a=this._getItemsArray();if(a[c]){for(;this._skipPredicateFn(a[c]);)if(!a[c+=e])return;this.setActiveItem(c)}}_getItemsArray(){return this._items instanceof l.n_E?this._items.toArray():this._items}}{setActiveItem(c){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(c),this.activeItem&&this.activeItem.setActiveStyles()}}let Rd=(()=>{class o{constructor(e){this._platform=e}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return function zd(o){return!!(o.offsetWidth||o.offsetHeight||"function"==typeof o.getClientRects&&o.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}isTabbable(e){if(!this._platform.isBrowser)return!1;const a=function Mf(o){try{return o.frameElement}catch{return null}}(function Df(o){return o.ownerDocument&&o.ownerDocument.defaultView||window}(e));if(a&&(-1===Vd(a)||!this.isVisible(a)))return!1;let _=e.nodeName.toLowerCase(),C=Vd(e);return e.hasAttribute("contenteditable")?-1!==C:!("iframe"===_||"object"===_||this._platform.WEBKIT&&this._platform.IOS&&!function kf(o){let c=o.nodeName.toLowerCase(),e="input"===c&&o.type;return"text"===e||"password"===e||"select"===c||"textarea"===c}(e))&&("audio"===_?!!e.hasAttribute("controls")&&-1!==C:"video"===_?-1!==C&&(null!==C||this._platform.FIREFOX||e.hasAttribute("controls")):e.tabIndex>=0)}isFocusable(e,a){return function Os(o){return!function Af(o){return function Tf(o){return"input"==o.nodeName.toLowerCase()}(o)&&"hidden"==o.type}(o)&&(function kg(o){let c=o.nodeName.toLowerCase();return"input"===c||"select"===c||"button"===c||"textarea"===c}(o)||function Sf(o){return function Ef(o){return"a"==o.nodeName.toLowerCase()}(o)&&o.hasAttribute("href")}(o)||o.hasAttribute("contenteditable")||Bd(o))}(e)&&!this.isDisabled(e)&&(a?.ignoreVisibility||this.isVisible(e))}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ye))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ye))},token:o,providedIn:"root"}),o})();function Bd(o){if(!o.hasAttribute("tabindex")||void 0===o.tabIndex)return!1;let c=o.getAttribute("tabindex");return"-32768"!=c&&!(!c||isNaN(parseInt(c,10)))}function Vd(o){if(!Bd(o))return null;const c=parseInt(o.getAttribute("tabindex")||"",10);return isNaN(c)?-1:c}class Ch{constructor(c,e,a,_,C=!1){this._element=c,this._checker=e,this._ngZone=a,this._document=_,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,C||this.attachAnchors()}get enabled(){return this._enabled}set enabled(c){this._enabled=c,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(c,this._startAnchor),this._toggleAnchorTabIndex(c,this._endAnchor))}destroy(){const c=this._startAnchor,e=this._endAnchor;c&&(c.removeEventListener("focus",this.startAnchorListener),c.parentNode&&c.parentNode.removeChild(c)),e&&(e.removeEventListener("focus",this.endAnchorListener),e.parentNode&&e.parentNode.removeChild(e)),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(c){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(c)))})}focusFirstTabbableElementWhenReady(c){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(c)))})}focusLastTabbableElementWhenReady(c){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(c)))})}_getRegionBoundary(c){let e=this._element.querySelectorAll(`[cdk-focus-region-${c}], [cdkFocusRegion${c}], [cdk-focus-${c}]`);for(let a=0;a<e.length;a++)e[a].hasAttribute(`cdk-focus-${c}`)?console.warn(`Found use of deprecated attribute 'cdk-focus-${c}', use 'cdkFocusRegion${c}' instead. The deprecated attribute will be removed in 8.0.0.`,e[a]):e[a].hasAttribute(`cdk-focus-region-${c}`)&&console.warn(`Found use of deprecated attribute 'cdk-focus-region-${c}', use 'cdkFocusRegion${c}' instead. The deprecated attribute will be removed in 8.0.0.`,e[a]);return"start"==c?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(c){const e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(e.hasAttribute("cdk-focus-initial")&&console.warn("Found use of deprecated attribute 'cdk-focus-initial', use 'cdkFocusInitial' instead. The deprecated attribute will be removed in 8.0.0",e),!this._checker.isFocusable(e)){const a=this._getFirstTabbableElement(e);return a?.focus(c),!!a}return e.focus(c),!0}return this.focusFirstTabbableElement(c)}focusFirstTabbableElement(c){const e=this._getRegionBoundary("start");return e&&e.focus(c),!!e}focusLastTabbableElement(c){const e=this._getRegionBoundary("end");return e&&e.focus(c),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(c){if(this._checker.isFocusable(c)&&this._checker.isTabbable(c))return c;let e=c.children||c.childNodes;for(let a=0;a<e.length;a++){let _=e[a].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[a]):null;if(_)return _}return null}_getLastTabbableElement(c){if(this._checker.isFocusable(c)&&this._checker.isTabbable(c))return c;let e=c.children||c.childNodes;for(let a=e.length-1;a>=0;a--){let _=e[a].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[a]):null;if(_)return _}return null}_createAnchor(){const c=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,c),c.classList.add("cdk-visually-hidden"),c.classList.add("cdk-focus-trap-anchor"),c.setAttribute("aria-hidden","true"),c}_toggleAnchorTabIndex(c,e){c?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(c){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(c,this._startAnchor),this._toggleAnchorTabIndex(c,this._endAnchor))}_executeOnStable(c){this._ngZone.isStable?c():this._ngZone.onStable.pipe((0,Fn.q)(1)).subscribe(c)}}let Gd=(()=>{class o{constructor(e,a,_){this._checker=e,this._ngZone=a,this._document=_}create(e,a=!1){return new Ch(e,this._checker,this._ngZone,this._document,a)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Rd),l.LFG(l.R0b),l.LFG(Vt.K0))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Rd),l.LFG(l.R0b),l.LFG(Vt.K0))},token:o,providedIn:"root"}),o})();function Yl(o){return 0===o.offsetX&&0===o.offsetY}function cu(o){const c=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0];return!(!c||-1!==c.identifier||null!=c.radiusX&&1!==c.radiusX||null!=c.radiusY&&1!==c.radiusY)}typeof Element<"u"&&Element;const jd=new l.OlP("cdk-input-modality-detector-options"),Ff={ignoreKeys:[18,17,224,91,16]},Ta=Ol({passive:!0,capture:!0});let Lf=(()=>{class o{constructor(e,a,_,C){this._platform=e,this._mostRecentTarget=null,this._modality=new ls.X(null),this._lastTouchMs=0,this._onKeydown=I=>{var G,ot;null!==(ot=null===(G=this._options)||void 0===G?void 0:G.ignoreKeys)&&void 0!==ot&&ot.some(xt=>xt===I.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=eo(I))},this._onMousedown=I=>{Date.now()-this._lastTouchMs<650||(this._modality.next(Yl(I)?"keyboard":"mouse"),this._mostRecentTarget=eo(I))},this._onTouchstart=I=>{cu(I)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=eo(I))},this._options=Object.assign(Object.assign({},Ff),C),this.modalityDetected=this._modality.pipe(gf(1)),this.modalityChanged=this.modalityDetected.pipe((0,ba.x)()),e.isBrowser&&a.runOutsideAngular(()=>{_.addEventListener("keydown",this._onKeydown,Ta),_.addEventListener("mousedown",this._onMousedown,Ta),_.addEventListener("touchstart",this._onTouchstart,Ta)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Ta),document.removeEventListener("mousedown",this._onMousedown,Ta),document.removeEventListener("touchstart",this._onTouchstart,Ta))}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ye),l.LFG(l.R0b),l.LFG(Vt.K0),l.LFG(jd,8))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ye),l.LFG(l.R0b),l.LFG(Vt.K0),l.LFG(jd,8))},token:o,providedIn:"root"}),o})();const Mh=new l.OlP("liveAnnouncerElement",{providedIn:"root",factory:function Rf(){return null}}),qd=new l.OlP("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let i=(()=>{class o{constructor(e,a,_,C){this._ngZone=a,this._defaultOptions=C,this._document=_,this._liveElement=e||this._createLiveElement()}announce(e,...a){const _=this._defaultOptions;let C,I;return 1===a.length&&"number"==typeof a[0]?I=a[0]:[C,I]=a,this.clear(),clearTimeout(this._previousTimeout),C||(C=_&&_.politeness?_.politeness:"polite"),null==I&&_&&(I=_.duration),this._liveElement.setAttribute("aria-live",C),this._ngZone.runOutsideAngular(()=>new Promise(G=>{clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,G(),"number"==typeof I&&(this._previousTimeout=setTimeout(()=>this.clear(),I))},100)}))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement&&this._liveElement.parentNode&&(this._liveElement.parentNode.removeChild(this._liveElement),this._liveElement=null)}_createLiveElement(){const e="cdk-live-announcer-element",a=this._document.getElementsByClassName(e),_=this._document.createElement("div");for(let C=0;C<a.length;C++)a[C].parentNode.removeChild(a[C]);return _.classList.add(e),_.classList.add("cdk-visually-hidden"),_.setAttribute("aria-atomic","true"),_.setAttribute("aria-live","polite"),this._document.body.appendChild(_),_}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Mh,8),l.LFG(l.R0b),l.LFG(Vt.K0),l.LFG(qd,8))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Mh,8),l.LFG(l.R0b),l.LFG(Vt.K0),l.LFG(qd,8))},token:o,providedIn:"root"}),o})();const n=new l.OlP("cdk-focus-monitor-default-options"),s=Ol({passive:!0,capture:!0});let h=(()=>{class o{constructor(e,a,_,C,I){this._ngZone=e,this._platform=a,this._inputModalityDetector=_,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new le.xQ,this._rootNodeFocusAndBlurListener=G=>{const ot=eo(G),xt="focus"===G.type?this._onFocus:this._onBlur;for(let qt=ot;qt;qt=qt.parentElement)xt.call(this,G,qt)},this._document=C,this._detectionMode=I?.detectionMode||0}monitor(e,a=!1){const _=Ui(e);if(!this._platform.isBrowser||1!==_.nodeType)return(0,sr.of)(null);const C=function hd(o){if(function Tm(){if(null==Gc){const o=typeof document<"u"?document.head:null;Gc=!(!o||!o.createShadowRoot&&!o.attachShadow)}return Gc}()){const c=o.getRootNode?o.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&c instanceof ShadowRoot)return c}return null}(_)||this._getDocument(),I=this._elementInfo.get(_);if(I)return a&&(I.checkChildren=!0),I.subject;const G={checkChildren:a,subject:new le.xQ,rootNode:C};return this._elementInfo.set(_,G),this._registerGlobalListeners(G),G.subject}stopMonitoring(e){const a=Ui(e),_=this._elementInfo.get(a);_&&(_.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(_))}focusVia(e,a,_){const C=Ui(e);C===this._getDocument().activeElement?this._getClosestElementsInfo(C).forEach(([G,ot])=>this._originChanged(G,a,ot)):(this._setOrigin(a),"function"==typeof C.focus&&C.focus(_))}ngOnDestroy(){this._elementInfo.forEach((e,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_toggleClass(e,a,_){_?e.classList.add(a):e.classList.remove(a)}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:"program"}_shouldBeAttributedToTouch(e){return 1===this._detectionMode||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,a){this._toggleClass(e,"cdk-focused",!!a),this._toggleClass(e,"cdk-touch-focused","touch"===a),this._toggleClass(e,"cdk-keyboard-focused","keyboard"===a),this._toggleClass(e,"cdk-mouse-focused","mouse"===a),this._toggleClass(e,"cdk-program-focused","program"===a)}_setOrigin(e,a=!1){this._ngZone.runOutsideAngular(()=>{this._origin=e,this._originFromTouchInteraction="touch"===e&&a,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(e,a){const _=this._elementInfo.get(a),C=eo(e);!_||!_.checkChildren&&a!==C||this._originChanged(a,this._getFocusOrigin(C),_)}_onBlur(e,a){const _=this._elementInfo.get(a);!_||_.checkChildren&&e.relatedTarget instanceof Node&&a.contains(e.relatedTarget)||(this._setClasses(a),this._emitOrigin(_.subject,null))}_emitOrigin(e,a){this._ngZone.run(()=>e.next(a))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;const a=e.rootNode,_=this._rootNodeFocusListenerCount.get(a)||0;_||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,s),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,s)}),this._rootNodeFocusListenerCount.set(a,_+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ke(this._stopInputModalityDetector)).subscribe(C=>{this._setOrigin(C,!0)}))}_removeGlobalListeners(e){const a=e.rootNode;if(this._rootNodeFocusListenerCount.has(a)){const _=this._rootNodeFocusListenerCount.get(a);_>1?this._rootNodeFocusListenerCount.set(a,_-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,s),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,s),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,a,_){this._setClasses(e,a),this._emitOrigin(_.subject,a),this._lastFocusOrigin=a}_getClosestElementsInfo(e){const a=[];return this._elementInfo.forEach((_,C)=>{(C===e||_.checkChildren&&C.contains(e))&&a.push([C,_])}),a}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(l.R0b),l.LFG(Ye),l.LFG(Lf),l.LFG(Vt.K0,8),l.LFG(n,8))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(l.R0b),l.LFG(Ye),l.LFG(Lf),l.LFG(Vt.K0,8),l.LFG(n,8))},token:o,providedIn:"root"}),o})();const g="cdk-high-contrast-black-on-white",y="cdk-high-contrast-white-on-black",b="cdk-high-contrast-active";let w=(()=>{class o{constructor(e,a){this._platform=e,this._document=a}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const a=this._document.defaultView||window,_=a&&a.getComputedStyle?a.getComputedStyle(e):null,C=(_&&_.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(e),C){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(b),e.remove(g),e.remove(y),this._hasCheckedHighContrastMode=!0;const a=this.getHighContrastMode();1===a?(e.add(b),e.add(g)):2===a&&(e.add(b),e.add(y))}}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ye),l.LFG(Vt.K0))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ye),l.LFG(Vt.K0))},token:o,providedIn:"root"}),o})();const E=new l.GfV("12.2.13");function P(o,c){if(1&o&&l._UZ(0,"mat-pseudo-checkbox",4),2&o){const e=l.oxw();l.Q6J("state",e.selected?"checked":"unchecked")("disabled",e.disabled)}}function B(o,c){if(1&o&&(l.TgZ(0,"span",5),l._uU(1),l.qZA()),2&o){const e=l.oxw();l.xp6(1),l.hij("(",e.group.label,")")}}const N=["*"],tt=new l.GfV("12.2.13"),nt=new l.OlP("mat-sanity-checks",{providedIn:"root",factory:function ct(){return!0}});let de,ft=(()=>{class o{constructor(e,a,_){this._hasDoneGlobalChecks=!1,this._document=_,e._applyBodyHighContrastModeCssClasses(),this._sanityChecks=a,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!(!(0,l.X6Q)()||dd())&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}_checkDoctypeIsDefined(){this._checkIsEnabled("doctype")&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checkIsEnabled("theme")||!this._document.body||"function"!=typeof getComputedStyle)return;const e=this._document.createElement("div");e.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(e);const a=getComputedStyle(e);a&&"none"!==a.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(e)}_checkCdkVersionMatch(){this._checkIsEnabled("version")&&tt.full!==E.full&&console.warn("The Angular Material version ("+tt.full+") does not match the Angular CDK version ("+E.full+").\nPlease ensure the versions of these two packages exactly match.")}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(w),l.LFG(nt,8),l.LFG(Vt.K0))},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ko,ko]}),o})();function vt(o){return class extends o{constructor(...c){super(...c),this._disabled=!1}get disabled(){return this._disabled}set disabled(c){this._disabled=ge(c)}}}function Mt(o,c){return class extends o{constructor(...e){super(...e),this.defaultColor=c,this.color=c}get color(){return this._color}set color(e){const a=e||this.defaultColor;a!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),a&&this._elementRef.nativeElement.classList.add(`mat-${a}`),this._color=a)}}}function Pt(o){return class extends o{constructor(...c){super(...c),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(c){this._disableRipple=ge(c)}}}function bt(o,c=0){return class extends o{constructor(...e){super(...e),this._tabIndex=c,this.defaultTabIndex=c}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?zi(e):this.defaultTabIndex}}}function St(o){return class extends o{constructor(...c){super(...c),this.stateChanges=new le.xQ,this.errorState=!1}updateErrorState(){const c=this.errorState,C=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);C!==c&&(this.errorState=C,this.stateChanges.next())}}}try{de=typeof Intl<"u"}catch{de=!1}let He=(()=>{class o{isErrorState(e,a){return!!(e&&e.invalid&&(e.touched||a&&a.submitted))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=l.Yz7({factory:function(){return new o},token:o,providedIn:"root"}),o})(),ki=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ft,ft]}),o})();class Sn{constructor(c,e,a){this._renderer=c,this.element=e,this.config=a,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const De={enterDuration:225,exitDuration:150},qi=Ol({passive:!0}),Ne=["mousedown","touchstart"],fi=["mouseup","mouseleave","touchend","touchcancel"];class pn{constructor(c,e,a,_){this._target=c,this._ngZone=e,this._isPointerDown=!1,this._activeRipples=new Set,this._pointerUpEventsRegistered=!1,_.isBrowser&&(this._containerElement=Ui(a))}fadeInRipple(c,e,a={}){const _=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),C=Object.assign(Object.assign({},De),a.animation);a.centered&&(c=_.left+_.width/2,e=_.top+_.height/2);const I=a.radius||function Mi(o,c,e){const a=Math.max(Math.abs(o-e.left),Math.abs(o-e.right)),_=Math.max(Math.abs(c-e.top),Math.abs(c-e.bottom));return Math.sqrt(a*a+_*_)}(c,e,_),G=c-_.left,ot=e-_.top,xt=C.enterDuration,qt=document.createElement("div");qt.classList.add("mat-ripple-element"),qt.style.left=G-I+"px",qt.style.top=ot-I+"px",qt.style.height=2*I+"px",qt.style.width=2*I+"px",null!=a.color&&(qt.style.backgroundColor=a.color),qt.style.transitionDuration=`${xt}ms`,this._containerElement.appendChild(qt),function mi(o){window.getComputedStyle(o).getPropertyValue("opacity")}(qt),qt.style.transform="scale(1)";const pe=new Sn(this,qt,a);return pe.state=0,this._activeRipples.add(pe),a.persistent||(this._mostRecentTransientRipple=pe),this._runTimeoutOutsideZone(()=>{const Ai=pe===this._mostRecentTransientRipple;pe.state=1,!a.persistent&&(!Ai||!this._isPointerDown)&&pe.fadeOut()},xt),pe}fadeOutRipple(c){const e=this._activeRipples.delete(c);if(c===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),!e)return;const a=c.element,_=Object.assign(Object.assign({},De),c.config.animation);a.style.transitionDuration=`${_.exitDuration}ms`,a.style.opacity="0",c.state=2,this._runTimeoutOutsideZone(()=>{c.state=3,a.parentNode.removeChild(a)},_.exitDuration)}fadeOutAll(){this._activeRipples.forEach(c=>c.fadeOut())}fadeOutAllNonPersistent(){this._activeRipples.forEach(c=>{c.config.persistent||c.fadeOut()})}setupTriggerEvents(c){const e=Ui(c);!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,this._registerEvents(Ne))}handleEvent(c){"mousedown"===c.type?this._onMousedown(c):"touchstart"===c.type?this._onTouchStart(c):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(fi),this._pointerUpEventsRegistered=!0)}_onMousedown(c){const e=Yl(c),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!e&&!a&&(this._isPointerDown=!0,this.fadeInRipple(c.clientX,c.clientY,this._target.rippleConfig))}_onTouchStart(c){if(!this._target.rippleDisabled&&!cu(c)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const e=c.changedTouches;for(let a=0;a<e.length;a++)this.fadeInRipple(e[a].clientX,e[a].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._activeRipples.forEach(c=>{!c.config.persistent&&(1===c.state||c.config.terminateOnPointerUp&&0===c.state)&&c.fadeOut()}))}_runTimeoutOutsideZone(c,e=0){this._ngZone.runOutsideAngular(()=>setTimeout(c,e))}_registerEvents(c){this._ngZone.runOutsideAngular(()=>{c.forEach(e=>{this._triggerElement.addEventListener(e,this,qi)})})}_removeTriggerEvents(){this._triggerElement&&(Ne.forEach(c=>{this._triggerElement.removeEventListener(c,this,qi)}),this._pointerUpEventsRegistered&&fi.forEach(c=>{this._triggerElement.removeEventListener(c,this,qi)}))}}const Zi=new l.OlP("mat-ripple-global-options");let _i=(()=>{class o{constructor(e,a,_,C,I){this._elementRef=e,this._animationMode=I,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=C||{},this._rippleRenderer=new pn(this,a,e,_)}get disabled(){return this._disabled}set disabled(e){e&&this.fadeOutAllNonPersistent(),this._disabled=e,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign(Object.assign(Object.assign({},this._globalOptions.animation),"NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(e,a=0,_){return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,a,Object.assign(Object.assign({},this.rippleConfig),_)):this._rippleRenderer.fadeInRipple(0,0,Object.assign(Object.assign({},this.rippleConfig),e))}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(l.R0b),l.Y36(Ye),l.Y36(Zi,8),l.Y36(l.QbO,8))},o.\u0275dir=l.lG2({type:o,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(e,a){2&e&&l.ekj("mat-ripple-unbounded",a.unbounded)},inputs:{radius:["matRippleRadius","radius"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"],color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],animation:["matRippleAnimation","animation"]},exportAs:["matRipple"]}),o})(),Oi=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ft,Vo,ft]}),o})(),on=(()=>{class o{constructor(e){this._animationMode=e,this.state="unchecked",this.disabled=!1}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.QbO,8))},o.\u0275cmp=l.Xpm({type:o,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:8,hostBindings:function(e,a){2&e&&l.ekj("mat-pseudo-checkbox-indeterminate","indeterminate"===a.state)("mat-pseudo-checkbox-checked","checked"===a.state)("mat-pseudo-checkbox-disabled",a.disabled)("_mat-animation-noopable","NoopAnimations"===a._animationMode)},inputs:{state:"state",disabled:"disabled"},decls:0,vars:0,template:function(e,a){},styles:['.mat-pseudo-checkbox{width:16px;height:16px;border:2px solid;border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox.mat-pseudo-checkbox-indeterminate{border-color:transparent}._mat-animation-noopable.mat-pseudo-checkbox{transition:none;animation:none}._mat-animation-noopable.mat-pseudo-checkbox::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{top:5px;left:1px;width:10px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{top:2.4px;left:1px;width:8px;height:3px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}\n'],encapsulation:2,changeDetection:0}),o})(),Fi=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ft]}),o})();const Er=new l.OlP("MAT_OPTION_PARENT_COMPONENT"),Wl=vt(class{});let uu=0,Xl=(()=>{class o extends Wl{constructor(e){var a;super(),this._labelId="mat-optgroup-label-"+uu++,this._inert=null!==(a=e?.inertGroups)&&void 0!==a&&a}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Er,8))},o.\u0275dir=l.lG2({type:o,inputs:{label:"label"},features:[l.qOj]}),o})();const Ah=new l.OlP("MatOptgroup");let zf=0;class Zd{constructor(c,e=!1){this.source=c,this.isUserInput=e}}let Hd=(()=>{class o{constructor(e,a,_,C){this._element=e,this._changeDetectorRef=a,this._parent=_,this.group=C,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this.id="mat-option-"+zf++,this.onSelectionChange=new l.vpe,this._stateChanges=new le.xQ}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=ge(e)}get disableRipple(){return this._parent&&this._parent.disableRipple}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,a){const _=this._getHostElement();"function"==typeof _.focus&&_.focus(a)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(13===e.keyCode||32===e.keyCode)&&!Pn(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this._selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new Zd(this,e))}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(l.sBO),l.Y36(void 0),l.Y36(Xl))},o.\u0275dir=l.lG2({type:o,inputs:{id:"id",disabled:"disabled",value:"value"},outputs:{onSelectionChange:"onSelectionChange"}}),o})(),kr=(()=>{class o extends Hd{constructor(e,a,_,C){super(e,a,_,C)}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(l.sBO),l.Y36(Er,8),l.Y36(Ah,8))},o.\u0275cmp=l.Xpm({type:o,selectors:[["mat-option"]],hostAttrs:["role","option",1,"mat-option","mat-focus-indicator"],hostVars:12,hostBindings:function(e,a){1&e&&l.NdJ("click",function(){return a._selectViaInteraction()})("keydown",function(C){return a._handleKeydown(C)}),2&e&&(l.Ikx("id",a.id),l.uIk("tabindex",a._getTabIndex())("aria-selected",a._getAriaSelected())("aria-disabled",a.disabled.toString()),l.ekj("mat-selected",a.selected)("mat-option-multiple",a.multiple)("mat-active",a.active)("mat-option-disabled",a.disabled))},exportAs:["matOption"],features:[l.qOj],ngContentSelectors:N,decls:5,vars:4,consts:[["class","mat-option-pseudo-checkbox",3,"state","disabled",4,"ngIf"],[1,"mat-option-text"],["class","cdk-visually-hidden",4,"ngIf"],["mat-ripple","",1,"mat-option-ripple",3,"matRippleTrigger","matRippleDisabled"],[1,"mat-option-pseudo-checkbox",3,"state","disabled"],[1,"cdk-visually-hidden"]],template:function(e,a){1&e&&(l.F$t(),l.YNc(0,P,1,2,"mat-pseudo-checkbox",0),l.TgZ(1,"span",1),l.Hsn(2),l.qZA(),l.YNc(3,B,2,1,"span",2),l._UZ(4,"div",3)),2&e&&(l.Q6J("ngIf",a.multiple),l.xp6(3),l.Q6J("ngIf",a.group&&a.group._inert),l.xp6(1),l.Q6J("matRippleTrigger",a._getHostElement())("matRippleDisabled",a.disabled||a.disableRipple))},dependencies:[_i,Vt.O5,on],styles:[".mat-option{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;line-height:48px;height:48px;padding:0 16px;text-align:left;text-decoration:none;max-width:100%;position:relative;cursor:pointer;outline:none;display:flex;flex-direction:row;max-width:100%;box-sizing:border-box;align-items:center;-webkit-tap-highlight-color:transparent}.mat-option[disabled]{cursor:default}[dir=rtl] .mat-option{text-align:right}.mat-option .mat-icon{margin-right:16px;vertical-align:middle}.mat-option .mat-icon svg{vertical-align:top}[dir=rtl] .mat-option .mat-icon{margin-left:16px;margin-right:0}.mat-option[aria-disabled=true]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.mat-optgroup .mat-option:not(.mat-option-multiple){padding-left:32px}[dir=rtl] .mat-optgroup .mat-option:not(.mat-option-multiple){padding-left:16px;padding-right:32px}.cdk-high-contrast-active .mat-option{margin:0 1px}.cdk-high-contrast-active .mat-option.mat-active{border:solid 1px currentColor;margin:0}.cdk-high-contrast-active .mat-option[aria-disabled=true]{opacity:.5}.mat-option-text{display:inline-block;flex-grow:1;overflow:hidden;text-overflow:ellipsis}.mat-option .mat-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-option-pseudo-checkbox{margin-right:8px}[dir=rtl] .mat-option-pseudo-checkbox{margin-left:8px;margin-right:0}\n"],encapsulation:2,changeDetection:0}),o})();function $d(o,c,e){if(e.length){let a=c.toArray(),_=e.toArray(),C=0;for(let I=0;I<o+1;I++)a[I].group&&a[I].group===_[C]&&C++;return C}return 0}let Sh=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Oi,Vt.ez,ft,Fi]}),o})();const Th=["mat-button",""],Yo=["*"],Ln=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],Rn=Mt(vt(Pt(class{constructor(o){this._elementRef=o}})));let Fs=(()=>{class o extends Rn{constructor(e,a,_){super(e),this._focusMonitor=a,this._animationMode=_,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const C of Ln)this._hasHostAttributes(C)&&this._getHostElement().classList.add(C);e.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(e,a){e?this._focusMonitor.focusVia(this._getHostElement(),e,a):this._getHostElement().focus(a)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...e){return e.some(a=>this._getHostElement().hasAttribute(a))}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(h),l.Y36(l.QbO,8))},o.\u0275cmp=l.Xpm({type:o,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(e,a){if(1&e&&l.Gf(_i,5),2&e){let _;l.iGM(_=l.CRH())&&(a.ripple=_.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(e,a){2&e&&(l.uIk("disabled",a.disabled||null),l.ekj("_mat-animation-noopable","NoopAnimations"===a._animationMode)("mat-button-disabled",a.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[l.qOj],attrs:Th,ngContentSelectors:Yo,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(e,a){1&e&&(l.F$t(),l.TgZ(0,"span",0),l.Hsn(1),l.qZA(),l._UZ(2,"span",1)(3,"span",2)),2&e&&(l.xp6(2),l.ekj("mat-button-ripple-round",a.isRoundButton||a.isIconButton),l.Q6J("matRippleDisabled",a._isRippleDisabled())("matRippleCentered",a.isIconButton)("matRippleTrigger",a._getHostElement()))},dependencies:[_i],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}.cdk-high-contrast-active .mat-button-base.cdk-keyboard-focused,.cdk-high-contrast-active .mat-button-base.cdk-program-focused{outline:solid 3px}\n"],encapsulation:2,changeDetection:0}),o})(),Yd=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Oi,ft,ft]}),o})();var ue=he(7340),Ry=he(3426),zy=he(1221);const G_=new Set;let kh,N_=(()=>{class o{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Vy}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function By(o){if(!G_.has(o))try{kh||(kh=document.createElement("style"),kh.setAttribute("type","text/css"),document.head.appendChild(kh)),kh.sheet&&(kh.sheet.insertRule(`@media ${o} {body{ }}`,0),G_.add(o))}catch(c){console.error(c)}}(e),this._matchMedia(e)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ye))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ye))},token:o,providedIn:"root"}),o})();function Vy(o){return{matches:"all"===o||""===o,media:o,addListener:()=>{},removeListener:()=>{}}}let U_=(()=>{class o{constructor(e,a){this._mediaMatcher=e,this._zone=a,this._queries=new Map,this._destroySubject=new le.xQ}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return j_(oa(e)).some(_=>this._registerQuery(_).mql.matches)}observe(e){const _=j_(oa(e)).map(I=>this._registerQuery(I).observable);let C=(0,Ry.aj)(_);return C=(0,zy.z)(C.pipe((0,Fn.q)(1)),C.pipe(gf(1),bh(0))),C.pipe((0,li.U)(I=>{const G={matches:!1,breakpoints:{}};return I.forEach(({matches:ot,query:xt})=>{G.matches=G.matches||ot,G.breakpoints[xt]=ot}),G}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const a=this._mediaMatcher.matchMedia(e),C={observable:new Bt.y(I=>{const G=ot=>this._zone.run(()=>I.next(ot));return a.addListener(G),()=>{a.removeListener(G)}}).pipe((0,Zn.O)(a),(0,li.U)(({matches:I})=>({query:e,matches:I})),ke(this._destroySubject)),mql:a};return this._queries.set(e,C),C}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(N_),l.LFG(l.R0b))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(N_),l.LFG(l.R0b))},token:o,providedIn:"root"}),o})();function j_(o){return o.map(c=>c.split(",")).reduce((c,e)=>c.concat(e)).map(c=>c.trim())}function Ny(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",1)(1,"button",2),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.action())}),l._uU(2),l.qZA()()}if(2&o){const e=l.oxw();l.xp6(2),l.Oqu(e.data.action)}}function Uy(o,c){}const q_=new l.OlP("MatSnackBarData");class Vf{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}}const jy=Math.pow(2,31)-1;class Pg{constructor(c,e){this._overlayRef=e,this._afterDismissed=new le.xQ,this._afterOpened=new le.xQ,this._onAction=new le.xQ,this._dismissedByAction=!1,this.containerInstance=c,this.onAction().subscribe(()=>this.dismiss()),c._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(c){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(c,jy))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}}let qy=(()=>{class o{constructor(e,a){this.snackBarRef=e,this.data=a}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Pg),l.Y36(q_))},o.\u0275cmp=l.Xpm({type:o,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-simple-snackbar"],decls:3,vars:2,consts:[["class","mat-simple-snackbar-action",4,"ngIf"],[1,"mat-simple-snackbar-action"],["mat-button","",3,"click"]],template:function(e,a){1&e&&(l.TgZ(0,"span"),l._uU(1),l.qZA(),l.YNc(2,Ny,3,1,"div",0)),2&e&&(l.xp6(1),l.Oqu(a.data.message),l.xp6(1),l.Q6J("ngIf",a.hasAction))},dependencies:[Vt.O5,Fs],styles:[".mat-simple-snackbar{display:flex;justify-content:space-between;align-items:center;line-height:20px;opacity:1}.mat-simple-snackbar-action{flex-shrink:0;margin:-8px -8px -8px 8px}.mat-simple-snackbar-action button{max-height:36px;min-width:0}[dir=rtl] .mat-simple-snackbar-action{margin-left:-8px;margin-right:8px}\n"],encapsulation:2,changeDetection:0}),o})();const Zy={snackBarState:(0,ue.X$)("state",[(0,ue.SB)("void, hidden",(0,ue.oB)({transform:"scale(0.8)",opacity:0})),(0,ue.SB)("visible",(0,ue.oB)({transform:"scale(1)",opacity:1})),(0,ue.eR)("* => visible",(0,ue.jt)("150ms cubic-bezier(0, 0, 0.2, 1)")),(0,ue.eR)("* => void, * => hidden",(0,ue.jt)("75ms cubic-bezier(0.4, 0.0, 1, 1)",(0,ue.oB)({opacity:0})))])};let Hy=(()=>{class o extends Zc{constructor(e,a,_,C,I){super(),this._ngZone=e,this._elementRef=a,this._changeDetectorRef=_,this._platform=C,this.snackBarConfig=I,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new le.xQ,this._onExit=new le.xQ,this._onEnter=new le.xQ,this._animationState="void",this.attachDomPortal=G=>(this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachDomPortal(G)),this._live="assertive"!==I.politeness||I.announcementMessage?"off"===I.politeness?"off":"polite":"assertive",this._platform.FIREFOX&&("polite"===this._live&&(this._role="status"),"assertive"===this._live&&(this._role="alert"))}attachComponentPortal(e){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachComponentPortal(e)}attachTemplatePortal(e){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachTemplatePortal(e)}onAnimationEnd(e){const{fromState:a,toState:_}=e;if(("void"===_&&"void"!==a||"hidden"===_)&&this._completeExit(),"visible"===_){const C=this._onEnter;this._ngZone.run(()=>{C.next(),C.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._animationState="hidden",this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe((0,Fn.q)(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_applySnackBarClasses(){const e=this._elementRef.nativeElement,a=this.snackBarConfig.panelClass;a&&(Array.isArray(a)?a.forEach(_=>e.classList.add(_)):e.classList.add(a)),"center"===this.snackBarConfig.horizontalPosition&&e.classList.add("mat-snack-bar-center"),"top"===this.snackBarConfig.verticalPosition&&e.classList.add("mat-snack-bar-top")}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{const e=this._elementRef.nativeElement.querySelector("[aria-hidden]"),a=this._elementRef.nativeElement.querySelector("[aria-live]");if(e&&a){let _=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&e.contains(document.activeElement)&&(_=document.activeElement),e.removeAttribute("aria-hidden"),a.appendChild(e),_?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.R0b),l.Y36(l.SBq),l.Y36(l.sBO),l.Y36(Ye),l.Y36(Vf))},o.\u0275cmp=l.Xpm({type:o,selectors:[["snack-bar-container"]],viewQuery:function(e,a){if(1&e&&l.Gf(zl,7),2&e){let _;l.iGM(_=l.CRH())&&(a._portalOutlet=_.first)}},hostAttrs:[1,"mat-snack-bar-container"],hostVars:1,hostBindings:function(e,a){1&e&&l.WFA("@state.done",function(C){return a.onAnimationEnd(C)}),2&e&&l.d8E("@state",a._animationState)},features:[l.qOj],decls:3,vars:2,consts:[["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(e,a){1&e&&(l.TgZ(0,"div",0),l.YNc(1,Uy,0,0,"ng-template",1),l.qZA(),l._UZ(2,"div")),2&e&&(l.xp6(2),l.uIk("aria-live",a._live)("role",a._role))},dependencies:[zl],styles:[".mat-snack-bar-container{border-radius:4px;box-sizing:border-box;display:block;margin:24px;max-width:33vw;min-width:344px;padding:14px 16px;min-height:48px;transform-origin:center}.cdk-high-contrast-active .mat-snack-bar-container{border:solid 1px}.mat-snack-bar-handset{width:100%}.mat-snack-bar-handset .mat-snack-bar-container{margin:8px;max-width:100%;min-width:0;width:100%}\n"],encapsulation:2,data:{animation:[Zy.snackBarState]}}),o})(),Z_=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ql,yd,Vt.ez,Yd,ft,ft]}),o})();const H_=new l.OlP("mat-snack-bar-default-options",{providedIn:"root",factory:function $y(){return new Vf}});let Yy=(()=>{class o{constructor(e,a,_,C,I,G){this._overlay=e,this._live=a,this._injector=_,this._breakpointObserver=C,this._parentSnackBar=I,this._defaultConfig=G,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=qy,this.snackBarContainerComponent=Hy,this.handsetCssClass="mat-snack-bar-handset"}get _openedSnackBarRef(){const e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}openFromComponent(e,a){return this._attach(e,a)}openFromTemplate(e,a){return this._attach(e,a)}open(e,a="",_){const C=Object.assign(Object.assign({},this._defaultConfig),_);return C.data={message:e,action:a},C.announcementMessage===e&&(C.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,C)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,a){const C=l.zs3.create({parent:a&&a.viewContainerRef&&a.viewContainerRef.injector||this._injector,providers:[{provide:Vf,useValue:a}]}),I=new Bi(this.snackBarContainerComponent,a.viewContainerRef,C),G=e.attach(I);return G.instance.snackBarConfig=a,G.instance}_attach(e,a){const _=Object.assign(Object.assign(Object.assign({},new Vf),this._defaultConfig),a),C=this._createOverlay(_),I=this._attachSnackBarContainer(C,_),G=new Pg(I,C);if(e instanceof l.Rgc){const ot=new No(e,null,{$implicit:_.data,snackBarRef:G});G.instance=I.attachTemplatePortal(ot)}else{const ot=this._createInjector(_,G),xt=new Bi(e,void 0,ot),qt=I.attachComponentPortal(xt);G.instance=qt.instance}return this._breakpointObserver.observe("(max-width: 599.98px) and (orientation: portrait)").pipe(ke(C.detachments())).subscribe(ot=>{const xt=C.overlayElement.classList;ot.matches?xt.add(this.handsetCssClass):xt.remove(this.handsetCssClass)}),_.announcementMessage&&I._onAnnounce.subscribe(()=>{this._live.announce(_.announcementMessage,_.politeness)}),this._animateSnackBar(G,_),this._openedSnackBarRef=G,this._openedSnackBarRef}_animateSnackBar(e,a){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),a.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter(),a.duration&&a.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(a.duration))}_createOverlay(e){const a=new ru;a.direction=e.direction;let _=this._overlay.position().global();const C="rtl"===e.direction,I="left"===e.horizontalPosition||"start"===e.horizontalPosition&&!C||"end"===e.horizontalPosition&&C,G=!I&&"center"!==e.horizontalPosition;return I?_.left("0"):G?_.right("0"):_.centerHorizontally(),"top"===e.verticalPosition?_.top("0"):_.bottom("0"),a.positionStrategy=_,this._overlay.create(a)}_createInjector(e,a){return l.zs3.create({parent:e&&e.viewContainerRef&&e.viewContainerRef.injector||this._injector,providers:[{provide:Pg,useValue:a},{provide:q_,useValue:e.data}]})}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ho),l.LFG(i),l.LFG(l.zs3),l.LFG(U_),l.LFG(o,12),l.LFG(H_))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ho),l.LFG(i),l.LFG(l.gxx),l.LFG(U_),l.LFG(o,12),l.LFG(H_))},token:o,providedIn:Z_}),o})();var Wy=he(1737),Xy=he(7221),Jy=he(537),Ky=he(2474);const Qy=["*"];function $_(o){return Error(`Unable to find icon with the name "${o}"`)}function Y_(o){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${o}".`)}function W_(o){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${o}".`)}class hu{constructor(c,e,a){this.url=c,this.svgText=e,this.options=a}}let Gf=(()=>{class o{constructor(e,a,_,C){this._httpClient=e,this._sanitizer=a,this._errorHandler=C,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass="material-icons",this._document=_}addSvgIcon(e,a,_){return this.addSvgIconInNamespace("",e,a,_)}addSvgIconLiteral(e,a,_){return this.addSvgIconLiteralInNamespace("",e,a,_)}addSvgIconInNamespace(e,a,_,C){return this._addSvgIconConfig(e,a,new hu(_,null,C))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,a,_,C){const I=this._sanitizer.sanitize(l.q3G.HTML,_);if(!I)throw W_(_);return this._addSvgIconConfig(e,a,new hu("",I,C))}addSvgIconSet(e,a){return this.addSvgIconSetInNamespace("",e,a)}addSvgIconSetLiteral(e,a){return this.addSvgIconSetLiteralInNamespace("",e,a)}addSvgIconSetInNamespace(e,a,_){return this._addSvgIconSetConfig(e,new hu(a,null,_))}addSvgIconSetLiteralInNamespace(e,a,_){const C=this._sanitizer.sanitize(l.q3G.HTML,a);if(!C)throw W_(a);return this._addSvgIconSetConfig(e,new hu("",C,_))}registerFontClassAlias(e,a=e){return this._fontCssClassesByAlias.set(e,a),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){const a=this._sanitizer.sanitize(l.q3G.RESOURCE_URL,e);if(!a)throw Y_(e);const _=this._cachedIconsByUrl.get(a);return _?(0,sr.of)(Nf(_)):this._loadSvgIconFromConfig(new hu(e,null)).pipe((0,Co.b)(C=>this._cachedIconsByUrl.set(a,C)),(0,li.U)(C=>Nf(C)))}getNamedSvgIcon(e,a=""){const _=X_(a,e);let C=this._svgIconConfigs.get(_);if(C)return this._getSvgFromConfig(C);if(C=this._getIconConfigFromResolvers(a,e),C)return this._svgIconConfigs.set(_,C),this._getSvgFromConfig(C);const I=this._iconSetConfigs.get(a);return I?this._getSvgFromIconSetConfigs(e,I):(0,Wy._)($_(_))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?(0,sr.of)(Nf(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe((0,li.U)(a=>Nf(a)))}_getSvgFromIconSetConfigs(e,a){const _=this._extractIconWithNameFromAnySet(e,a);return _?(0,sr.of)(_):Ae(a.filter(I=>!I.svgText).map(I=>this._loadSvgIconSetFromConfig(I).pipe((0,Xy.K)(G=>{const xt=`Loading icon set URL: ${this._sanitizer.sanitize(l.q3G.RESOURCE_URL,I.url)} failed: ${G.message}`;return this._errorHandler.handleError(new Error(xt)),(0,sr.of)(null)})))).pipe((0,li.U)(()=>{const I=this._extractIconWithNameFromAnySet(e,a);if(!I)throw $_(e);return I}))}_extractIconWithNameFromAnySet(e,a){for(let _=a.length-1;_>=0;_--){const C=a[_];if(C.svgText&&C.svgText.indexOf(e)>-1){const I=this._svgElementFromConfig(C),G=this._extractSvgIconFromSet(I,e,C.options);if(G)return G}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe((0,Co.b)(a=>e.svgText=a),(0,li.U)(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?(0,sr.of)(null):this._fetchIcon(e).pipe((0,Co.b)(a=>e.svgText=a))}_extractSvgIconFromSet(e,a,_){const C=e.querySelector(`[id="${a}"]`);if(!C)return null;const I=C.cloneNode(!0);if(I.removeAttribute("id"),"svg"===I.nodeName.toLowerCase())return this._setSvgAttributes(I,_);if("symbol"===I.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(I),_);const G=this._svgElementFromString("<svg></svg>");return G.appendChild(I),this._setSvgAttributes(G,_)}_svgElementFromString(e){const a=this._document.createElement("DIV");a.innerHTML=e;const _=a.querySelector("svg");if(!_)throw Error("<svg> tag not found");return _}_toSvgElement(e){const a=this._svgElementFromString("<svg></svg>"),_=e.attributes;for(let C=0;C<_.length;C++){const{name:I,value:G}=_[C];"id"!==I&&a.setAttribute(I,G)}for(let C=0;C<e.childNodes.length;C++)e.childNodes[C].nodeType===this._document.ELEMENT_NODE&&a.appendChild(e.childNodes[C].cloneNode(!0));return a}_setSvgAttributes(e,a){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),a&&a.viewBox&&e.setAttribute("viewBox",a.viewBox),e}_fetchIcon(e){var a;const{url:_,options:C}=e,I=null!==(a=C?.withCredentials)&&void 0!==a&&a;if(!this._httpClient)throw function tv(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==_)throw Error(`Cannot fetch icon from URL "${_}".`);const G=this._sanitizer.sanitize(l.q3G.RESOURCE_URL,_);if(!G)throw Y_(_);const ot=this._inProgressUrlFetches.get(G);if(ot)return ot;const xt=this._httpClient.get(G,{responseType:"text",withCredentials:I}).pipe((0,Jy.x)(()=>this._inProgressUrlFetches.delete(G)),(0,Ky.B)());return this._inProgressUrlFetches.set(G,xt),xt}_addSvgIconConfig(e,a,_){return this._svgIconConfigs.set(X_(e,a),_),this}_addSvgIconSetConfig(e,a){const _=this._iconSetConfigs.get(e);return _?_.push(a):this._iconSetConfigs.set(e,[a]),this}_svgElementFromConfig(e){if(!e.svgElement){const a=this._svgElementFromString(e.svgText);this._setSvgAttributes(a,e.options),e.svgElement=a}return e.svgElement}_getIconConfigFromResolvers(e,a){for(let _=0;_<this._resolvers.length;_++){const C=this._resolvers[_](a,e);if(C)return iv(C)?new hu(C.url,null,C.options):new hu(C,null)}}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(ur.eN,8),l.LFG(Ur.H7),l.LFG(Vt.K0,8),l.LFG(l.qLn))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(ur.eN,8),l.LFG(Ur.H7),l.LFG(Vt.K0,8),l.LFG(l.qLn))},token:o,providedIn:"root"}),o})();function Nf(o){return o.cloneNode(!0)}function X_(o,c){return o+":"+c}function iv(o){return!(!o.url||!o.options)}const nv=Mt(class{constructor(o){this._elementRef=o}}),rv=new l.OlP("mat-icon-location",{providedIn:"root",factory:function ov(){const o=(0,l.f3M)(Vt.K0),c=o?o.location:null;return{getPathname:()=>c?c.pathname+c.search:""}}}),J_=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],av=J_.map(o=>`[${o}]`).join(", "),lv=/^url\(['"]?#(.*?)['"]?\)$/;let cv=(()=>{class o extends nv{constructor(e,a,_,C,I){super(e),this._iconRegistry=a,this._location=C,this._errorHandler=I,this._inline=!1,this._currentIconFetch=Qr.w.EMPTY,_||e.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(e){this._inline=ge(e)}get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}get fontSet(){return this._fontSet}set fontSet(e){const a=this._cleanupFontValue(e);a!==this._fontSet&&(this._fontSet=a,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(e){const a=this._cleanupFontValue(e);a!==this._fontIcon&&(this._fontIcon=a,this._updateFontIconClasses())}_splitIconName(e){if(!e)return["",""];const a=e.split(":");switch(a.length){case 1:return["",a[0]];case 2:return a;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const e=this._elementsWithExternalReferences;if(e&&e.size){const a=this._location.getPathname();a!==this._previousPath&&(this._previousPath=a,this._prependPathToReferences(a))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();const a=e.querySelectorAll("style");for(let C=0;C<a.length;C++)a[C].textContent+=" ";const _=this._location.getPathname();this._previousPath=_,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(_),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){const e=this._elementRef.nativeElement;let a=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();a--;){const _=e.childNodes[a];(1!==_.nodeType||"svg"===_.nodeName.toLowerCase())&&e.removeChild(_)}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const e=this._elementRef.nativeElement,a=this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet):this._iconRegistry.getDefaultFontSetClass();a!=this._previousFontSetClass&&(this._previousFontSetClass&&e.classList.remove(this._previousFontSetClass),a&&e.classList.add(a),this._previousFontSetClass=a),this.fontIcon!=this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return"string"==typeof e?e.trim().split(" ")[0]:e}_prependPathToReferences(e){const a=this._elementsWithExternalReferences;a&&a.forEach((_,C)=>{_.forEach(I=>{C.setAttribute(I.name,`url('${e}#${I.value}')`)})})}_cacheChildrenWithExternalReferences(e){const a=e.querySelectorAll(av),_=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let C=0;C<a.length;C++)J_.forEach(I=>{const G=a[C],ot=G.getAttribute(I),xt=ot?ot.match(lv):null;if(xt){let qt=_.get(G);qt||(qt=[],_.set(G,qt)),qt.push({name:I,value:xt[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){const[a,_]=this._splitIconName(e);a&&(this._svgNamespace=a),_&&(this._svgName=_),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(_,a).pipe((0,Fn.q)(1)).subscribe(C=>this._setSvgElement(C),C=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${a}:${_}! ${C.message}`))})}}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Gf),l.$8M("aria-hidden"),l.Y36(rv),l.Y36(l.qLn))},o.\u0275cmp=l.Xpm({type:o,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:7,hostBindings:function(e,a){2&e&&(l.uIk("data-mat-icon-type",a._usingFontIcon()?"font":"svg")("data-mat-icon-name",a._svgName||a.fontIcon)("data-mat-icon-namespace",a._svgNamespace||a.fontSet),l.ekj("mat-icon-inline",a.inline)("mat-icon-no-color","primary"!==a.color&&"accent"!==a.color&&"warn"!==a.color))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[l.qOj],ngContentSelectors:Qy,decls:1,vars:0,template:function(e,a){1&e&&(l.F$t(),l.Hsn(0))},styles:[".mat-icon{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}\n"],encapsulation:2,changeDetection:0}),o})(),uv=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ft,ft]}),o})();const hv=["underline"],dv=["connectionContainer"],pv=["inputContainer"],fv=["label"];function mv(o,c){1&o&&(l.ynx(0),l.TgZ(1,"div",14),l._UZ(2,"div",15)(3,"div",16)(4,"div",17),l.qZA(),l.TgZ(5,"div",18),l._UZ(6,"div",15)(7,"div",16)(8,"div",17),l.qZA(),l.BQk())}function gv(o,c){1&o&&(l.TgZ(0,"div",19),l.Hsn(1,1),l.qZA())}function _v(o,c){if(1&o&&(l.ynx(0),l.Hsn(1,2),l.TgZ(2,"span"),l._uU(3),l.qZA(),l.BQk()),2&o){const e=l.oxw(2);l.xp6(3),l.Oqu(e._control.placeholder)}}function yv(o,c){1&o&&l.Hsn(0,3,["*ngSwitchCase","true"])}function vv(o,c){1&o&&(l.TgZ(0,"span",23),l._uU(1," *"),l.qZA())}function xv(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"label",20,21),l.NdJ("cdkObserveContent",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.updateOutlineGap())}),l.YNc(2,_v,4,1,"ng-container",12),l.YNc(3,yv,1,0,"ng-content",12),l.YNc(4,vv,2,0,"span",22),l.qZA()}if(2&o){const e=l.oxw();l.ekj("mat-empty",e._control.empty&&!e._shouldAlwaysFloat())("mat-form-field-empty",e._control.empty&&!e._shouldAlwaysFloat())("mat-accent","accent"==e.color)("mat-warn","warn"==e.color),l.Q6J("cdkObserveContentDisabled","outline"!=e.appearance)("id",e._labelId)("ngSwitch",e._hasLabel()),l.uIk("for",e._control.id)("aria-owns",e._control.id),l.xp6(2),l.Q6J("ngSwitchCase",!1),l.xp6(1),l.Q6J("ngSwitchCase",!0),l.xp6(1),l.Q6J("ngIf",!e.hideRequiredMarker&&e._control.required&&!e._control.disabled)}}function bv(o,c){1&o&&(l.TgZ(0,"div",24),l.Hsn(1,4),l.qZA())}function wv(o,c){if(1&o&&(l.TgZ(0,"div",25,26),l._UZ(2,"span",27),l.qZA()),2&o){const e=l.oxw();l.xp6(2),l.ekj("mat-accent","accent"==e.color)("mat-warn","warn"==e.color)}}function Cv(o,c){if(1&o&&(l.TgZ(0,"div"),l.Hsn(1,5),l.qZA()),2&o){const e=l.oxw();l.Q6J("@transitionMessages",e._subscriptAnimationState)}}function Mv(o,c){if(1&o&&(l.TgZ(0,"div",31),l._uU(1),l.qZA()),2&o){const e=l.oxw(2);l.Q6J("id",e._hintLabelId),l.xp6(1),l.Oqu(e.hintLabel)}}function Av(o,c){if(1&o&&(l.TgZ(0,"div",28),l.YNc(1,Mv,2,2,"div",29),l.Hsn(2,6),l._UZ(3,"div",30),l.Hsn(4,7),l.qZA()),2&o){const e=l.oxw();l.Q6J("@transitionMessages",e._subscriptAnimationState),l.xp6(1),l.Q6J("ngIf",e.hintLabel)}}const Sv=["*",[["","matPrefix",""]],[["mat-placeholder"]],[["mat-label"]],[["","matSuffix",""]],[["mat-error"]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],Tv=["*","[matPrefix]","mat-placeholder","mat-label","[matSuffix]","mat-error","mat-hint:not([align='end'])","mat-hint[align='end']"],K_=new l.OlP("MatError"),kv={transitionMessages:(0,ue.X$)("transitionMessages",[(0,ue.SB)("enter",(0,ue.oB)({opacity:1,transform:"translateY(0%)"})),(0,ue.eR)("void => enter",[(0,ue.oB)({opacity:0,transform:"translateY(-5px)"}),(0,ue.jt)("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let Uf=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275dir=l.lG2({type:o}),o})();const Q_=new l.OlP("MatHint");let Lg=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275dir=l.lG2({type:o,selectors:[["mat-label"]]}),o})(),Iv=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275dir=l.lG2({type:o,selectors:[["mat-placeholder"]]}),o})();const ty=new l.OlP("MatPrefix"),ey=new l.OlP("MatSuffix");let iy=0;const Fv=Mt(class{constructor(o){this._elementRef=o}},"primary"),Pv=new l.OlP("MAT_FORM_FIELD_DEFAULT_OPTIONS"),Rg=new l.OlP("MatFormField");let Lv=(()=>{class o extends Fv{constructor(e,a,_,C,I,G,ot,xt){super(e),this._changeDetectorRef=a,this._dir=C,this._defaults=I,this._platform=G,this._ngZone=ot,this._outlineGapCalculationNeededImmediately=!1,this._outlineGapCalculationNeededOnStable=!1,this._destroyed=new le.xQ,this._showAlwaysAnimate=!1,this._subscriptAnimationState="",this._hintLabel="",this._hintLabelId="mat-hint-"+iy++,this._labelId="mat-form-field-label-"+iy++,this.floatLabel=this._getDefaultFloatLabelState(),this._animationsEnabled="NoopAnimations"!==xt,this.appearance=I&&I.appearance?I.appearance:"legacy",this._hideRequiredMarker=!(!I||null==I.hideRequiredMarker)&&I.hideRequiredMarker}get appearance(){return this._appearance}set appearance(e){const a=this._appearance;this._appearance=e||this._defaults&&this._defaults.appearance||"legacy","outline"===this._appearance&&a!==e&&(this._outlineGapCalculationNeededOnStable=!0)}get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(e){this._hideRequiredMarker=ge(e)}_shouldAlwaysFloat(){return"always"===this.floatLabel&&!this._showAlwaysAnimate}_canLabelFloat(){return"never"!==this.floatLabel}get hintLabel(){return this._hintLabel}set hintLabel(e){this._hintLabel=e,this._processHints()}get floatLabel(){return"legacy"!==this.appearance&&"never"===this._floatLabel?"auto":this._floatLabel}set floatLabel(e){e!==this._floatLabel&&(this._floatLabel=e||this._getDefaultFloatLabelState(),this._changeDetectorRef.markForCheck())}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(e){this._explicitFormFieldControl=e}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}ngAfterContentInit(){this._validateControlChild();const e=this._control;e.controlType&&this._elementRef.nativeElement.classList.add(`mat-form-field-type-${e.controlType}`),e.stateChanges.pipe((0,Zn.O)(null)).subscribe(()=>{this._validatePlaceholders(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),e.ngControl&&e.ngControl.valueChanges&&e.ngControl.valueChanges.pipe(ke(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(ke(this._destroyed)).subscribe(()=>{this._outlineGapCalculationNeededOnStable&&this.updateOutlineGap()})}),(0,Un.T)(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._outlineGapCalculationNeededOnStable=!0,this._changeDetectorRef.markForCheck()}),this._hintChildren.changes.pipe((0,Zn.O)(null)).subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.pipe((0,Zn.O)(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._dir&&this._dir.change.pipe(ke(this._destroyed)).subscribe(()=>{"function"==typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this.updateOutlineGap())}):this.updateOutlineGap()})}ngAfterContentChecked(){this._validateControlChild(),this._outlineGapCalculationNeededImmediately&&this.updateOutlineGap()}ngAfterViewInit(){this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(e){const a=this._control?this._control.ngControl:null;return a&&a[e]}_hasPlaceholder(){return!!(this._control&&this._control.placeholder||this._placeholderChild)}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_shouldLabelFloat(){return this._canLabelFloat()&&(this._control&&this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_hideControlPlaceholder(){return"legacy"===this.appearance&&!this._hasLabel()||this._hasLabel()&&!this._shouldLabelFloat()}_hasFloatingLabel(){return this._hasLabel()||"legacy"===this.appearance&&this._hasPlaceholder()}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_animateAndLockLabel(){this._hasFloatingLabel()&&this._canLabelFloat()&&(this._animationsEnabled&&this._label&&(this._showAlwaysAnimate=!0,xa(this._label.nativeElement,"transitionend").pipe((0,Fn.q)(1)).subscribe(()=>{this._showAlwaysAnimate=!1})),this.floatLabel="always",this._changeDetectorRef.markForCheck())}_validatePlaceholders(){}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_getDefaultFloatLabelState(){return this._defaults&&this._defaults.floatLabel||"auto"}_syncDescribedByIds(){if(this._control){let e=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&e.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const a=this._hintChildren?this._hintChildren.find(C=>"start"===C.align):null,_=this._hintChildren?this._hintChildren.find(C=>"end"===C.align):null;a?e.push(a.id):this._hintLabel&&e.push(this._hintLabelId),_&&e.push(_.id)}else this._errorChildren&&e.push(...this._errorChildren.map(a=>a.id));this._control.setDescribedByIds(e)}}_validateControlChild(){}updateOutlineGap(){const e=this._label?this._label.nativeElement:null;if(!("outline"===this.appearance&&e&&e.children.length&&e.textContent.trim()&&this._platform.isBrowser))return;if(!this._isAttachedToDOM())return void(this._outlineGapCalculationNeededImmediately=!0);let a=0,_=0;const C=this._connectionContainerRef.nativeElement,I=C.querySelectorAll(".mat-form-field-outline-start"),G=C.querySelectorAll(".mat-form-field-outline-gap");if(this._label&&this._label.nativeElement.children.length){const ot=C.getBoundingClientRect();if(0===ot.width&&0===ot.height)return this._outlineGapCalculationNeededOnStable=!0,void(this._outlineGapCalculationNeededImmediately=!1);const xt=this._getStartEnd(ot),qt=e.children,pe=this._getStartEnd(qt[0].getBoundingClientRect());let Ai=0;for(let fn=0;fn<qt.length;fn++)Ai+=qt[fn].offsetWidth;a=Math.abs(pe-xt)-5,_=Ai>0?.75*Ai+10:0}for(let ot=0;ot<I.length;ot++)I[ot].style.width=`${a}px`;for(let ot=0;ot<G.length;ot++)G[ot].style.width=`${_}px`;this._outlineGapCalculationNeededOnStable=this._outlineGapCalculationNeededImmediately=!1}_getStartEnd(e){return this._dir&&"rtl"===this._dir.value?e.right:e.left}_isAttachedToDOM(){const e=this._elementRef.nativeElement;if(e.getRootNode){const a=e.getRootNode();return a&&a!==e}return document.documentElement.contains(e)}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(l.sBO),l.Y36(l.SBq),l.Y36(hn,8),l.Y36(Pv,8),l.Y36(Ye),l.Y36(l.R0b),l.Y36(l.QbO,8))},o.\u0275cmp=l.Xpm({type:o,selectors:[["mat-form-field"]],contentQueries:function(e,a,_){if(1&e&&(l.Suo(_,Uf,5),l.Suo(_,Uf,7),l.Suo(_,Lg,5),l.Suo(_,Lg,7),l.Suo(_,Iv,5),l.Suo(_,K_,5),l.Suo(_,Q_,5),l.Suo(_,ty,5),l.Suo(_,ey,5)),2&e){let C;l.iGM(C=l.CRH())&&(a._controlNonStatic=C.first),l.iGM(C=l.CRH())&&(a._controlStatic=C.first),l.iGM(C=l.CRH())&&(a._labelChildNonStatic=C.first),l.iGM(C=l.CRH())&&(a._labelChildStatic=C.first),l.iGM(C=l.CRH())&&(a._placeholderChild=C.first),l.iGM(C=l.CRH())&&(a._errorChildren=C),l.iGM(C=l.CRH())&&(a._hintChildren=C),l.iGM(C=l.CRH())&&(a._prefixChildren=C),l.iGM(C=l.CRH())&&(a._suffixChildren=C)}},viewQuery:function(e,a){if(1&e&&(l.Gf(hv,5),l.Gf(dv,7),l.Gf(pv,5),l.Gf(fv,5)),2&e){let _;l.iGM(_=l.CRH())&&(a.underlineRef=_.first),l.iGM(_=l.CRH())&&(a._connectionContainerRef=_.first),l.iGM(_=l.CRH())&&(a._inputContainerRef=_.first),l.iGM(_=l.CRH())&&(a._label=_.first)}},hostAttrs:[1,"mat-form-field"],hostVars:40,hostBindings:function(e,a){2&e&&l.ekj("mat-form-field-appearance-standard","standard"==a.appearance)("mat-form-field-appearance-fill","fill"==a.appearance)("mat-form-field-appearance-outline","outline"==a.appearance)("mat-form-field-appearance-legacy","legacy"==a.appearance)("mat-form-field-invalid",a._control.errorState)("mat-form-field-can-float",a._canLabelFloat())("mat-form-field-should-float",a._shouldLabelFloat())("mat-form-field-has-label",a._hasFloatingLabel())("mat-form-field-hide-placeholder",a._hideControlPlaceholder())("mat-form-field-disabled",a._control.disabled)("mat-form-field-autofilled",a._control.autofilled)("mat-focused",a._control.focused)("ng-untouched",a._shouldForward("untouched"))("ng-touched",a._shouldForward("touched"))("ng-pristine",a._shouldForward("pristine"))("ng-dirty",a._shouldForward("dirty"))("ng-valid",a._shouldForward("valid"))("ng-invalid",a._shouldForward("invalid"))("ng-pending",a._shouldForward("pending"))("_mat-animation-noopable",!a._animationsEnabled)},inputs:{color:"color",floatLabel:"floatLabel",appearance:"appearance",hideRequiredMarker:"hideRequiredMarker",hintLabel:"hintLabel"},exportAs:["matFormField"],features:[l._Bn([{provide:Rg,useExisting:o}]),l.qOj],ngContentSelectors:Tv,decls:15,vars:8,consts:[[1,"mat-form-field-wrapper"],[1,"mat-form-field-flex",3,"click"],["connectionContainer",""],[4,"ngIf"],["class","mat-form-field-prefix",4,"ngIf"],[1,"mat-form-field-infix"],["inputContainer",""],[1,"mat-form-field-label-wrapper"],["class","mat-form-field-label",3,"cdkObserveContentDisabled","id","mat-empty","mat-form-field-empty","mat-accent","mat-warn","ngSwitch","cdkObserveContent",4,"ngIf"],["class","mat-form-field-suffix",4,"ngIf"],["class","mat-form-field-underline",4,"ngIf"],[1,"mat-form-field-subscript-wrapper",3,"ngSwitch"],[4,"ngSwitchCase"],["class","mat-form-field-hint-wrapper",4,"ngSwitchCase"],[1,"mat-form-field-outline"],[1,"mat-form-field-outline-start"],[1,"mat-form-field-outline-gap"],[1,"mat-form-field-outline-end"],[1,"mat-form-field-outline","mat-form-field-outline-thick"],[1,"mat-form-field-prefix"],[1,"mat-form-field-label",3,"cdkObserveContentDisabled","id","ngSwitch","cdkObserveContent"],["label",""],["class","mat-placeholder-required mat-form-field-required-marker","aria-hidden","true",4,"ngIf"],["aria-hidden","true",1,"mat-placeholder-required","mat-form-field-required-marker"],[1,"mat-form-field-suffix"],[1,"mat-form-field-underline"],["underline",""],[1,"mat-form-field-ripple"],[1,"mat-form-field-hint-wrapper"],["class","mat-hint",3,"id",4,"ngIf"],[1,"mat-form-field-hint-spacer"],[1,"mat-hint",3,"id"]],template:function(e,a){1&e&&(l.F$t(Sv),l.TgZ(0,"div",0)(1,"div",1,2),l.NdJ("click",function(C){return a._control.onContainerClick&&a._control.onContainerClick(C)}),l.YNc(3,mv,9,0,"ng-container",3),l.YNc(4,gv,2,0,"div",4),l.TgZ(5,"div",5,6),l.Hsn(7),l.TgZ(8,"span",7),l.YNc(9,xv,5,16,"label",8),l.qZA()(),l.YNc(10,bv,2,0,"div",9),l.qZA(),l.YNc(11,wv,3,4,"div",10),l.TgZ(12,"div",11),l.YNc(13,Cv,2,1,"div",12),l.YNc(14,Av,5,2,"div",13),l.qZA()()),2&e&&(l.xp6(3),l.Q6J("ngIf","outline"==a.appearance),l.xp6(1),l.Q6J("ngIf",a._prefixChildren.length),l.xp6(5),l.Q6J("ngIf",a._hasFloatingLabel()),l.xp6(1),l.Q6J("ngIf",a._suffixChildren.length),l.xp6(1),l.Q6J("ngIf","outline"!=a.appearance),l.xp6(1),l.Q6J("ngSwitch",a._getDisplayedMessages()),l.xp6(1),l.Q6J("ngSwitchCase","error"),l.xp6(1),l.Q6J("ngSwitchCase","hint"))},dependencies:[Vt.O5,Vt.RF,Vt.n9,vf],styles:[".mat-form-field{display:inline-block;position:relative;text-align:left}[dir=rtl] .mat-form-field{text-align:right}.mat-form-field-wrapper{position:relative}.mat-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-form-field-prefix,.mat-form-field-suffix{white-space:nowrap;flex:none;position:relative}.mat-form-field-infix{display:block;position:relative;flex:auto;min-width:0;width:180px}.cdk-high-contrast-active .mat-form-field-infix{border-image:linear-gradient(transparent, transparent)}.mat-form-field-label-wrapper{position:absolute;left:0;box-sizing:content-box;width:100%;height:100%;overflow:hidden;pointer-events:none}[dir=rtl] .mat-form-field-label-wrapper{left:auto;right:0}.mat-form-field-label{position:absolute;left:0;font:inherit;pointer-events:none;width:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),width 400ms cubic-bezier(0.25, 0.8, 0.25, 1);display:none}[dir=rtl] .mat-form-field-label{transform-origin:100% 0;left:auto;right:0}.mat-form-field-empty.mat-form-field-label,.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{display:block}.mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:block;transition:none}.mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-form-field-can-float .mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:block}.mat-form-field-label:not(.mat-form-field-empty){transition:none}.mat-form-field-underline{position:absolute;width:100%;pointer-events:none;transform:scale3d(1, 1.0001, 1)}.mat-form-field-ripple{position:absolute;left:0;width:100%;transform-origin:50%;transform:scaleX(0.5);opacity:0;transition:background-color 300ms cubic-bezier(0.55, 0, 0.55, 0.2)}.mat-form-field.mat-focused .mat-form-field-ripple,.mat-form-field.mat-form-field-invalid .mat-form-field-ripple{opacity:1;transform:none;transition:transform 300ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 300ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-subscript-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.mat-form-field-subscript-wrapper .mat-icon,.mat-form-field-label-wrapper .mat-icon{width:1em;height:1em;font-size:inherit;vertical-align:baseline}.mat-form-field-hint-wrapper{display:flex}.mat-form-field-hint-spacer{flex:1 0 1em}.mat-error{display:block}.mat-form-field-control-wrapper{position:relative}.mat-form-field-hint-end{order:1}.mat-form-field._mat-animation-noopable .mat-form-field-label,.mat-form-field._mat-animation-noopable .mat-form-field-ripple{transition:none}\n",'.mat-form-field-appearance-fill .mat-form-field-flex{border-radius:4px 4px 0 0;padding:.75em .75em 0 .75em}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-flex{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-form-field-flex{outline:dashed 3px}.mat-form-field-appearance-fill .mat-form-field-underline::before{content:"";display:block;position:absolute;bottom:0;height:1px;width:100%}.mat-form-field-appearance-fill .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-ripple{height:0}.mat-form-field-appearance-fill:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-fill._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}.mat-form-field-appearance-fill .mat-form-field-subscript-wrapper{padding:0 1em}\n','.mat-input-element{font:inherit;background:transparent;color:currentColor;border:none;outline:none;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit;box-sizing:content-box}.mat-input-element:-moz-ui-invalid{box-shadow:none}.mat-input-element::-ms-clear,.mat-input-element::-ms-reveal{display:none}.mat-input-element,.mat-input-element::-webkit-search-cancel-button,.mat-input-element::-webkit-search-decoration,.mat-input-element::-webkit-search-results-button,.mat-input-element::-webkit-search-results-decoration{-webkit-appearance:none}.mat-input-element::-webkit-contacts-auto-fill-button,.mat-input-element::-webkit-caps-lock-indicator,.mat-input-element:not([type=password])::-webkit-credentials-auto-fill-button{visibility:hidden}.mat-input-element[type=date],.mat-input-element[type=datetime],.mat-input-element[type=datetime-local],.mat-input-element[type=month],.mat-input-element[type=week],.mat-input-element[type=time]{line-height:1}.mat-input-element[type=date]::after,.mat-input-element[type=datetime]::after,.mat-input-element[type=datetime-local]::after,.mat-input-element[type=month]::after,.mat-input-element[type=week]::after,.mat-input-element[type=time]::after{content:" ";white-space:pre;width:1px}.mat-input-element::-webkit-inner-spin-button,.mat-input-element::-webkit-calendar-picker-indicator,.mat-input-element::-webkit-clear-button{font-size:.75em}.mat-input-element::placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element::-moz-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-moz-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element::-webkit-input-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-webkit-input-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element:-ms-input-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element:-ms-input-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-form-field-hide-placeholder .mat-input-element::placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{opacity:0}textarea.mat-input-element{resize:vertical;overflow:auto}textarea.mat-input-element.cdk-textarea-autosize{resize:none}textarea.mat-input-element{padding:2px 0;margin:-2px 0}select.mat-input-element{-moz-appearance:none;-webkit-appearance:none;position:relative;background-color:transparent;display:inline-flex;box-sizing:border-box;padding-top:1em;top:-1em;margin-bottom:-1em}select.mat-input-element::-ms-expand{display:none}select.mat-input-element::-moz-focus-inner{border:0}select.mat-input-element:not(:disabled){cursor:pointer}select.mat-input-element::-ms-value{color:inherit;background:none}.mat-focused .cdk-high-contrast-active select.mat-input-element::-ms-value{color:inherit}.mat-form-field-type-mat-native-select .mat-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;position:absolute;top:50%;right:0;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-form-field-type-mat-native-select .mat-form-field-infix::after{right:auto;left:0}.mat-form-field-type-mat-native-select .mat-input-element{padding-right:15px}[dir=rtl] .mat-form-field-type-mat-native-select .mat-input-element{padding-right:0;padding-left:15px}.mat-form-field-type-mat-native-select .mat-form-field-label-wrapper{max-width:calc(100% - 10px)}.mat-form-field-type-mat-native-select.mat-form-field-appearance-outline .mat-form-field-infix::after{margin-top:-5px}.mat-form-field-type-mat-native-select.mat-form-field-appearance-fill .mat-form-field-infix::after{margin-top:-10px}\n',".mat-form-field-appearance-legacy .mat-form-field-label{transform:perspective(100px);-ms-transform:none}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon{width:1em}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button{font:inherit;vertical-align:baseline}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button .mat-icon{font-size:inherit}.mat-form-field-appearance-legacy .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-legacy .mat-form-field-ripple{top:0;height:2px;overflow:hidden}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}.cdk-high-contrast-active .mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-legacy.mat-form-field-invalid:not(.mat-focused) .mat-form-field-ripple{height:1px}\n",".mat-form-field-appearance-outline .mat-form-field-wrapper{margin:.25em 0}.mat-form-field-appearance-outline .mat-form-field-flex{padding:0 .75em 0 .75em;margin-top:-0.25em;position:relative}.mat-form-field-appearance-outline .mat-form-field-prefix,.mat-form-field-appearance-outline .mat-form-field-suffix{top:.25em}.mat-form-field-appearance-outline .mat-form-field-outline{display:flex;position:absolute;top:.25em;left:0;right:0;bottom:0;pointer-events:none}.mat-form-field-appearance-outline .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-end{border:1px solid currentColor;min-width:5px}.mat-form-field-appearance-outline .mat-form-field-outline-start{border-radius:5px 0 0 5px;border-right-style:none}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-start{border-right-style:solid;border-left-style:none;border-radius:0 5px 5px 0}.mat-form-field-appearance-outline .mat-form-field-outline-end{border-radius:0 5px 5px 0;border-left-style:none;flex-grow:1}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-end{border-left-style:solid;border-right-style:none;border-radius:5px 0 0 5px}.mat-form-field-appearance-outline .mat-form-field-outline-gap{border-radius:.000001px;border:1px solid currentColor;border-left-style:none;border-right-style:none}.mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-outline-gap{border-top-color:transparent}.mat-form-field-appearance-outline .mat-form-field-outline-thick{opacity:0}.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-end,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-gap{border-width:2px}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline{opacity:0;transition:opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline-thick{opacity:1}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick{border:3px dashed}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline{opacity:0;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline-thick{opacity:1}.mat-form-field-appearance-outline .mat-form-field-subscript-wrapper{padding:0 1em}.mat-form-field-appearance-outline._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-start,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-end,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-gap{transition:none}\n",".mat-form-field-appearance-standard .mat-form-field-flex{padding-top:.75em}.mat-form-field-appearance-standard .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-standard .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}.cdk-high-contrast-active .mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-standard:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-standard._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}\n"],encapsulation:2,data:{animation:[kv.transitionMessages]},changeDetection:0}),o})(),zg=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Vt.ez,ft,Ld,ft]}),o})();var ry=he(8514);const Rv=["trigger"],zv=["panel"];function Bv(o,c){if(1&o&&(l.TgZ(0,"span",8),l._uU(1),l.qZA()),2&o){const e=l.oxw();l.xp6(1),l.Oqu(e.placeholder)}}function Vv(o,c){if(1&o&&(l.TgZ(0,"span",12),l._uU(1),l.qZA()),2&o){const e=l.oxw(2);l.xp6(1),l.Oqu(e.triggerValue)}}function Gv(o,c){1&o&&l.Hsn(0,0,["*ngSwitchCase","true"])}function Nv(o,c){if(1&o&&(l.TgZ(0,"span",9),l.YNc(1,Vv,2,1,"span",10),l.YNc(2,Gv,1,0,"ng-content",11),l.qZA()),2&o){const e=l.oxw();l.Q6J("ngSwitch",!!e.customTrigger),l.xp6(2),l.Q6J("ngSwitchCase",!0)}}function Uv(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",13)(1,"div",14,15),l.NdJ("@transformPanel.done",function(_){l.CHM(e);const C=l.oxw();return l.KtG(C._panelDoneAnimatingStream.next(_.toState))})("keydown",function(_){l.CHM(e);const C=l.oxw();return l.KtG(C._handleKeydown(_))}),l.Hsn(3,1),l.qZA()()}if(2&o){const e=l.oxw();l.Q6J("@transformPanelWrap",void 0),l.xp6(1),l.Gre("mat-select-panel ",e._getPanelTheme(),""),l.Udp("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),l.Q6J("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),l.uIk("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const jv=[[["mat-select-trigger"]],"*"],qv=["mat-select-trigger","*"],oy={transformPanelWrap:(0,ue.X$)("transformPanelWrap",[(0,ue.eR)("* => void",(0,ue.IO)("@transformPanel",[(0,ue.pV)()],{optional:!0}))]),transformPanel:(0,ue.X$)("transformPanel",[(0,ue.SB)("void",(0,ue.oB)({transform:"scaleY(0.8)",minWidth:"100%",opacity:0})),(0,ue.SB)("showing",(0,ue.oB)({opacity:1,minWidth:"calc(100% + 32px)",transform:"scaleY(1)"})),(0,ue.SB)("showing-multiple",(0,ue.oB)({opacity:1,minWidth:"calc(100% + 64px)",transform:"scaleY(1)"})),(0,ue.eR)("void => *",(0,ue.jt)("120ms cubic-bezier(0, 0, 0.2, 1)")),(0,ue.eR)("* => void",(0,ue.jt)("100ms 25ms linear",(0,ue.oB)({opacity:0})))])};let sy=0;const ly=new l.OlP("mat-select-scroll-strategy"),Yv=new l.OlP("MAT_SELECT_CONFIG"),Wv={provide:ly,deps:[Ho],useFactory:function $v(o){return()=>o.scrollStrategies.reposition()}};class Xv{constructor(c,e){this.source=c,this.value=e}}const Jv=Pt(bt(vt(St(class{constructor(o,c,e,a,_){this._elementRef=o,this._defaultErrorStateMatcher=c,this._parentForm=e,this._parentFormGroup=a,this.ngControl=_}})))),cy=new l.OlP("MatSelectTrigger");let Kv=(()=>{class o extends Jv{constructor(e,a,_,C,I,G,ot,xt,qt,pe,Ai,fn,zn,Wi){var ka,Pi,Ps;super(I,C,ot,xt,pe),this._viewportRuler=e,this._changeDetectorRef=a,this._ngZone=_,this._dir=G,this._parentFormField=qt,this._liveAnnouncer=zn,this._defaultOptions=Wi,this._panelOpen=!1,this._compareWith=(so,Hg)=>so===Hg,this._uid="mat-select-"+sy++,this._triggerAriaLabelledBy=null,this._destroy=new le.xQ,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="mat-select-value-"+sy++,this._panelDoneAnimatingStream=new le.xQ,this._overlayPanelClass=(null===(ka=this._defaultOptions)||void 0===ka?void 0:ka.overlayPanelClass)||"",this._focused=!1,this.controlType="mat-select",this._required=!1,this._multiple=!1,this._disableOptionCentering=null!==(Ps=null===(Pi=this._defaultOptions)||void 0===Pi?void 0:Pi.disableOptionCentering)&&void 0!==Ps&&Ps,this.ariaLabel="",this.optionSelectionChanges=(0,ry.P)(()=>{const so=this.options;return so?so.changes.pipe((0,Zn.O)(so),(0,Kr.w)(()=>(0,Un.T)(...so.map(Hg=>Hg.onSelectionChange)))):this._ngZone.onStable.pipe((0,Fn.q)(1),(0,Kr.w)(()=>this.optionSelectionChanges))}),this.openedChange=new l.vpe,this._openedStream=this.openedChange.pipe((0,hi.h)(so=>so),(0,li.U)(()=>{})),this._closedStream=this.openedChange.pipe((0,hi.h)(so=>!so),(0,li.U)(()=>{})),this.selectionChange=new l.vpe,this.valueChange=new l.vpe,this.ngControl&&(this.ngControl.valueAccessor=this),null!=Wi?.typeaheadDebounceInterval&&(this._typeaheadDebounceInterval=Wi.typeaheadDebounceInterval),this._scrollStrategyFactory=fn,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(Ai)||0,this.id=this.id}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){return this._required}set required(e){this._required=ge(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=ge(e)}get disableOptionCentering(){return this._disableOptionCentering}set disableOptionCentering(e){this._disableOptionCentering=ge(e)}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=zi(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new hh(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe((0,ba.x)(),ke(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen))}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(ke(this._destroy)).subscribe(e=>{e.added.forEach(a=>a.select()),e.removed.forEach(a=>a.deselect())}),this.options.changes.pipe((0,Zn.O)(null),ke(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby();if(e!==this._triggerAriaLabelledBy){const a=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?a.setAttribute("aria-labelledby",e):a.removeAttribute("aria-labelledby")}this.ngControl&&this.updateErrorState()}ngOnChanges(e){e.disabled&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck())}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this.value=e}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){var e,a;return this.multiple?(null===(e=this._selectionModel)||void 0===e?void 0:e.selected)||[]:null===(a=this._selectionModel)||void 0===a?void 0:a.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){const e=this._selectionModel.selected.map(a=>a.viewValue);return this._isRtl()&&e.reverse(),e.join(", ")}return this._selectionModel.selected[0].viewValue}_isRtl(){return!!this._dir&&"rtl"===this._dir.value}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const a=e.keyCode,_=40===a||38===a||37===a||39===a,C=13===a||32===a,I=this._keyManager;if(!I.isTyping()&&C&&!Pn(e)||(this.multiple||e.altKey)&&_)e.preventDefault(),this.open();else if(!this.multiple){const G=this.selected;I.onKeydown(e);const ot=this.selected;ot&&G!==ot&&this._liveAnnouncer.announce(ot.viewValue,1e4)}}_handleOpenKeydown(e){const a=this._keyManager,_=e.keyCode,C=40===_||38===_,I=a.isTyping();if(C&&e.altKey)e.preventDefault(),this.close();else if(I||13!==_&&32!==_||!a.activeItem||Pn(e))if(!I&&this._multiple&&65===_&&e.ctrlKey){e.preventDefault();const G=this.options.some(ot=>!ot.disabled&&!ot.selected);this.options.forEach(ot=>{ot.disabled||(G?ot.select():ot.deselect())})}else{const G=a.activeItemIndex;a.onKeydown(e),this._multiple&&C&&e.shiftKey&&a.activeItem&&a.activeItemIndex!==G&&a.activeItem._selectViaInteraction()}else e.preventDefault(),a.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this._overlayDir.positionChange.pipe((0,Fn.q)(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this._setSelectionByValue(this.ngControl?this.ngControl.value:this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(a=>a.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(a=>this._selectValue(a)),this._sortValues();else{const a=this._selectValue(e);a?this._keyManager.updateActiveItem(a):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectValue(e){const a=this.options.find(_=>{if(this._selectionModel.isSelected(_))return!1;try{return null!=_.value&&this._compareWith(_.value,e)}catch{return!1}});return a&&this._selectionModel.select(a),a}_initKeyManager(){this._keyManager=new Is(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(ke(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(ke(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=(0,Un.T)(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(ke(e)).subscribe(a=>{this._onSelect(a.source,a.isUserInput),a.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),(0,Un.T)(...this.options.map(a=>a._stateChanges)).pipe(ke(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,a){const _=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(_!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),a&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),a&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),_!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((a,_)=>this.sortComparator?this.sortComparator(a,_,e):e.indexOf(a)-e.indexOf(_)),this.stateChanges.next()}}_propagateChanges(e){let a=null;a=this.multiple?this.selected.map(_=>_.value):this.selected?this.selected.value:e,this._value=a,this.valueChange.emit(a),this._onChange(a),this.selectionChange.emit(this._getChangeEvent(a)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const a=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(a?a+" ":"")+this.ariaLabelledby:a}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const a=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let _=(a?a+" ":"")+this._valueId;return this.ariaLabelledby&&(_+=" "+this.ariaLabelledby),_}_panelDoneAnimating(e){this.openedChange.emit(e)}setDescribedByIds(e){this._ariaDescribedby=e.join(" ")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this._panelOpen||!this.empty||this._focused&&!!this._placeholder}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Ts),l.Y36(l.sBO),l.Y36(l.R0b),l.Y36(He),l.Y36(l.SBq),l.Y36(hn,8),l.Y36(Gi,8),l.Y36(Vr,8),l.Y36(Rg,8),l.Y36(Li,10),l.$8M("tabindex"),l.Y36(ly),l.Y36(i),l.Y36(Yv,8))},o.\u0275dir=l.lG2({type:o,viewQuery:function(e,a){if(1&e&&(l.Gf(Rv,5),l.Gf(zv,5),l.Gf(mf,5)),2&e){let _;l.iGM(_=l.CRH())&&(a.trigger=_.first),l.iGM(_=l.CRH())&&(a.panel=_.first),l.iGM(_=l.CRH())&&(a._overlayDir=_.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],id:"id",placeholder:"placeholder",required:"required",multiple:"multiple",disableOptionCentering:"disableOptionCentering",compareWith:"compareWith",value:"value",typeaheadDebounceInterval:"typeaheadDebounceInterval",panelClass:"panelClass",ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",sortComparator:"sortComparator"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},features:[l.qOj,l.TTD]}),o})(),Qv=(()=>{class o extends Kv{constructor(){super(...arguments),this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"top",overlayX:"start",overlayY:"top"},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"bottom"}]}_calculateOverlayScroll(e,a,_){const C=this._getItemHeight();return Math.min(Math.max(0,C*e-a+C/2),_)}ngOnInit(){super.ngOnInit(),this._viewportRuler.change().pipe(ke(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this.trigger.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}open(){super._canOpen()&&(super.open(),this._triggerRect=this.trigger.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this.trigger.nativeElement).fontSize||"0"),this._calculateOverlayPosition(),this._ngZone.onStable.pipe((0,Fn.q)(1)).subscribe(()=>{this._triggerFontSize&&this._overlayDir.overlayRef&&this._overlayDir.overlayRef.overlayElement&&(this._overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`)}))}_scrollOptionIntoView(e){const a=$d(e,this.options,this.optionGroups),_=this._getItemHeight();this.panel.nativeElement.scrollTop=0===e&&1===a?0:function Ea(o,c,e,a){return o<e?o:o+c>e+a?Math.max(0,o-a+c):e}((e+a)*_,_,this.panel.nativeElement.scrollTop,256)}_positioningSettled(){this._calculateOverlayOffsetX(),this.panel.nativeElement.scrollTop=this._scrollTop}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this._overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),super._panelDoneAnimating(e)}_getChangeEvent(e){return new Xv(this,e)}_calculateOverlayOffsetX(){const e=this._overlayDir.overlayRef.overlayElement.getBoundingClientRect(),a=this._viewportRuler.getViewportSize(),_=this._isRtl(),C=this.multiple?56:32;let I;if(this.multiple)I=40;else if(this.disableOptionCentering)I=16;else{let xt=this._selectionModel.selected[0]||this.options.first;I=xt&&xt.group?32:16}_||(I*=-1);const G=0-(e.left+I-(_?C:0)),ot=e.right+I-a.width+(_?0:C);G>0?I+=G+8:ot>0&&(I-=ot+8),this._overlayDir.offsetX=Math.round(I),this._overlayDir.overlayRef.updatePosition()}_calculateOverlayOffsetY(e,a,_){const C=this._getItemHeight(),I=(C-this._triggerRect.height)/2,G=Math.floor(256/C);let ot;return this.disableOptionCentering?0:(ot=0===this._scrollTop?e*C:this._scrollTop===_?(e-(this._getItemCount()-G))*C+(C-(this._getItemCount()*C-256)%C):a-C/2,Math.round(-1*ot-I))}_checkOverlayWithinViewport(e){const a=this._getItemHeight(),_=this._viewportRuler.getViewportSize(),C=this._triggerRect.top-8,I=_.height-this._triggerRect.bottom-8,G=Math.abs(this._offsetY),xt=Math.min(this._getItemCount()*a,256)-G-this._triggerRect.height;xt>I?this._adjustPanelUp(xt,I):G>C?this._adjustPanelDown(G,C,e):this._transformOrigin=this._getOriginBasedOnOption()}_adjustPanelUp(e,a){const _=Math.round(e-a);this._scrollTop-=_,this._offsetY-=_,this._transformOrigin=this._getOriginBasedOnOption(),this._scrollTop<=0&&(this._scrollTop=0,this._offsetY=0,this._transformOrigin="50% bottom 0px")}_adjustPanelDown(e,a,_){const C=Math.round(e-a);if(this._scrollTop+=C,this._offsetY+=C,this._transformOrigin=this._getOriginBasedOnOption(),this._scrollTop>=_)return this._scrollTop=_,this._offsetY=0,void(this._transformOrigin="50% top 0px")}_calculateOverlayPosition(){const e=this._getItemHeight(),a=this._getItemCount(),_=Math.min(a*e,256),I=a*e-_;let G;G=this.empty?0:Math.max(this.options.toArray().indexOf(this._selectionModel.selected[0]),0),G+=$d(G,this.options,this.optionGroups);const ot=_/2;this._scrollTop=this._calculateOverlayScroll(G,ot,I),this._offsetY=this._calculateOverlayOffsetY(G,ot,I),this._checkOverlayWithinViewport(I)}_getOriginBasedOnOption(){const e=this._getItemHeight(),a=(e-this._triggerRect.height)/2;return`50% ${Math.abs(this._offsetY)-a+e/2}px 0px`}_getItemHeight(){return 3*this._triggerFontSize}_getItemCount(){return this.options.length+this.optionGroups.length}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275cmp=l.Xpm({type:o,selectors:[["mat-select"]],contentQueries:function(e,a,_){if(1&e&&(l.Suo(_,cy,5),l.Suo(_,kr,5),l.Suo(_,Ah,5)),2&e){let C;l.iGM(C=l.CRH())&&(a.customTrigger=C.first),l.iGM(C=l.CRH())&&(a.options=C),l.iGM(C=l.CRH())&&(a.optionGroups=C)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"mat-select"],hostVars:20,hostBindings:function(e,a){1&e&&l.NdJ("keydown",function(C){return a._handleKeydown(C)})("focus",function(){return a._onFocus()})("blur",function(){return a._onBlur()}),2&e&&(l.uIk("id",a.id)("tabindex",a.tabIndex)("aria-controls",a.panelOpen?a.id+"-panel":null)("aria-expanded",a.panelOpen)("aria-label",a.ariaLabel||null)("aria-required",a.required.toString())("aria-disabled",a.disabled.toString())("aria-invalid",a.errorState)("aria-describedby",a._ariaDescribedby||null)("aria-activedescendant",a._getAriaActiveDescendant()),l.ekj("mat-select-disabled",a.disabled)("mat-select-invalid",a.errorState)("mat-select-required",a.required)("mat-select-empty",a.empty)("mat-select-multiple",a.multiple))},inputs:{disabled:"disabled",disableRipple:"disableRipple",tabIndex:"tabIndex"},exportAs:["matSelect"],features:[l._Bn([{provide:Uf,useExisting:o},{provide:Er,useExisting:o}]),l.qOj],ngContentSelectors:qv,decls:9,vars:12,consts:[["cdk-overlay-origin","",1,"mat-select-trigger",3,"click"],["origin","cdkOverlayOrigin","trigger",""],[1,"mat-select-value",3,"ngSwitch"],["class","mat-select-placeholder mat-select-min-line",4,"ngSwitchCase"],["class","mat-select-value-text",3,"ngSwitch",4,"ngSwitchCase"],[1,"mat-select-arrow-wrapper"],[1,"mat-select-arrow"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayMinWidth","cdkConnectedOverlayOffsetY","backdropClick","attach","detach"],[1,"mat-select-placeholder","mat-select-min-line"],[1,"mat-select-value-text",3,"ngSwitch"],["class","mat-select-min-line",4,"ngSwitchDefault"],[4,"ngSwitchCase"],[1,"mat-select-min-line"],[1,"mat-select-panel-wrap"],["role","listbox","tabindex","-1",3,"ngClass","keydown"],["panel",""]],template:function(e,a){if(1&e&&(l.F$t(jv),l.TgZ(0,"div",0,1),l.NdJ("click",function(){return a.toggle()}),l.TgZ(3,"div",2),l.YNc(4,Bv,2,1,"span",3),l.YNc(5,Nv,3,2,"span",4),l.qZA(),l.TgZ(6,"div",5),l._UZ(7,"div",6),l.qZA()(),l.YNc(8,Uv,4,14,"ng-template",7),l.NdJ("backdropClick",function(){return a.close()})("attach",function(){return a._onAttached()})("detach",function(){return a.close()})),2&e){const _=l.MAs(1);l.uIk("aria-owns",a.panelOpen?a.id+"-panel":null),l.xp6(3),l.Q6J("ngSwitch",a.empty),l.uIk("id",a._valueId),l.xp6(1),l.Q6J("ngSwitchCase",!0),l.xp6(1),l.Q6J("ngSwitchCase",!1),l.xp6(3),l.Q6J("cdkConnectedOverlayPanelClass",a._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",a._scrollStrategy)("cdkConnectedOverlayOrigin",_)("cdkConnectedOverlayOpen",a.panelOpen)("cdkConnectedOverlayPositions",a._positions)("cdkConnectedOverlayMinWidth",null==a._triggerRect?null:a._triggerRect.width)("cdkConnectedOverlayOffsetY",a._offsetY)}},dependencies:[Vt.mk,Vt.RF,Vt.n9,Vt.ED,mf,ff],styles:['.mat-select{display:inline-block;width:100%;outline:none}.mat-select-trigger{display:inline-table;cursor:pointer;position:relative;box-sizing:border-box}.mat-select-disabled .mat-select-trigger{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.mat-select-value{display:table-cell;max-width:0;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-select-arrow-wrapper{display:table-cell;vertical-align:middle}.mat-form-field-appearance-fill .mat-select-arrow-wrapper{transform:translateY(-50%)}.mat-form-field-appearance-outline .mat-select-arrow-wrapper{transform:translateY(-25%)}.mat-form-field-appearance-standard.mat-form-field-has-label .mat-select:not(.mat-select-empty) .mat-select-arrow-wrapper{transform:translateY(-50%)}.mat-form-field-appearance-standard .mat-select.mat-select-empty .mat-select-arrow-wrapper{transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}._mat-animation-noopable.mat-form-field-appearance-standard .mat-select.mat-select-empty .mat-select-arrow-wrapper{transition:none}.mat-select-arrow{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;margin:0 4px}.mat-select-panel-wrap{flex-basis:100%}.mat-select-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;padding-top:0;padding-bottom:0;max-height:256px;min-width:100%;border-radius:4px;outline:0}.cdk-high-contrast-active .mat-select-panel{outline:solid 1px}.mat-select-panel .mat-optgroup-label,.mat-select-panel .mat-option{font-size:inherit;line-height:3em;height:3em}.mat-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-form-field-flex{cursor:pointer}.mat-form-field-type-mat-select .mat-form-field-label{width:calc(100% - 18px)}.mat-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}._mat-animation-noopable .mat-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-select-placeholder{color:transparent;-webkit-text-fill-color:transparent;transition:none;display:block}.mat-select-min-line:empty::before{content:" ";white-space:pre;width:1px;display:inline-block;opacity:0}\n'],encapsulation:2,data:{animation:[oy.transformPanelWrap,oy.transformPanel]},changeDetection:0}),o})(),tx=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({providers:[Wv],imports:[Vt.ez,ql,Sh,ft,Rl,zg,Sh,ft]}),o})();var ex=he(8896);const uy=Ol({passive:!0});let hy=(()=>{class o{constructor(e,a){this._platform=e,this._ngZone=a,this._monitoredElements=new Map}monitor(e){if(!this._platform.isBrowser)return ex.E;const a=Ui(e),_=this._monitoredElements.get(a);if(_)return _.subject;const C=new le.xQ,I="cdk-text-field-autofilled",G=ot=>{"cdk-text-field-autofill-start"!==ot.animationName||a.classList.contains(I)?"cdk-text-field-autofill-end"===ot.animationName&&a.classList.contains(I)&&(a.classList.remove(I),this._ngZone.run(()=>C.next({target:ot.target,isAutofilled:!1}))):(a.classList.add(I),this._ngZone.run(()=>C.next({target:ot.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{a.addEventListener("animationstart",G,uy),a.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(a,{subject:C,unlisten:()=>{a.removeEventListener("animationstart",G,uy)}}),C}stopMonitoring(e){const a=Ui(e),_=this._monitoredElements.get(a);_&&(_.unlisten(),_.subject.complete(),a.classList.remove("cdk-text-field-autofill-monitored"),a.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(a))}ngOnDestroy(){this._monitoredElements.forEach((e,a)=>this.stopMonitoring(a))}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ye),l.LFG(l.R0b))},o.\u0275prov=l.Yz7({factory:function(){return new o(l.LFG(Ye),l.LFG(l.R0b))},token:o,providedIn:"root"}),o})(),dy=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Vo]}),o})();const nx=new l.OlP("MAT_INPUT_VALUE_ACCESSOR"),rx=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let ox=0;const sx=St(class{constructor(o,c,e,a){this._defaultErrorStateMatcher=o,this._parentForm=c,this._parentFormGroup=e,this.ngControl=a}});let ax=(()=>{class o extends sx{constructor(e,a,_,C,I,G,ot,xt,qt,pe){super(G,C,I,_),this._elementRef=e,this._platform=a,this._autofillMonitor=xt,this._formField=pe,this._uid="mat-input-"+ox++,this.focused=!1,this.stateChanges=new le.xQ,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._required=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(zn=>cd().has(zn));const Ai=this._elementRef.nativeElement,fn=Ai.nodeName.toLowerCase();this._inputValueAccessor=ot||Ai,this._previousNativeValue=this.value,this.id=this.id,a.IOS&&qt.runOutsideAngular(()=>{e.nativeElement.addEventListener("keyup",zn=>{const Wi=zn.target;!Wi.value&&0===Wi.selectionStart&&0===Wi.selectionEnd&&(Wi.setSelectionRange(1,1),Wi.setSelectionRange(0,0))})}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===fn,this._isTextarea="textarea"===fn,this._isInFormField=!!pe,this._isNativeSelect&&(this.controlType=Ai.multiple?"mat-native-select-multiple":"mat-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(e){this._disabled=ge(e),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(e){this._id=e||this._uid}get required(){return this._required}set required(e){this._required=ge(e)}get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&cd().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=ge(e)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(e){this._elementRef.nativeElement.focus(e)}_focusChanged(e){e!==this.focused&&(this.focused=e,this.stateChanges.next())}_onInput(){}_dirtyCheckPlaceholder(){var e,a;const _=null!==(a=null===(e=this._formField)||void 0===e?void 0:e._hideControlPlaceholder)&&void 0!==a&&a.call(e)?null:this.placeholder;if(_!==this._previousPlaceholder){const C=this._elementRef.nativeElement;this._previousPlaceholder=_,_?C.setAttribute("placeholder",_):C.removeAttribute("placeholder")}}_dirtyCheckNativeValue(){const e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_validateType(){rx.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let e=this._elementRef.nativeElement.validity;return e&&e.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const e=this._elementRef.nativeElement,a=e.options[0];return this.focused||e.multiple||!this.empty||!!(e.selectedIndex>-1&&a&&a.label)}return this.focused||!this.empty}setDescribedByIds(e){e.length?this._elementRef.nativeElement.setAttribute("aria-describedby",e.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const e=this._elementRef.nativeElement;return this._isNativeSelect&&(e.multiple||e.size>1)}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Ye),l.Y36(Li,10),l.Y36(Gi,8),l.Y36(Vr,8),l.Y36(He),l.Y36(nx,10),l.Y36(hy),l.Y36(l.R0b),l.Y36(Rg,8))},o.\u0275dir=l.lG2({type:o,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-input-element","mat-form-field-autofill-control"],hostVars:11,hostBindings:function(e,a){1&e&&l.NdJ("focus",function(){return a._focusChanged(!0)})("blur",function(){return a._focusChanged(!1)})("input",function(){return a._onInput()}),2&e&&(l.Ikx("disabled",a.disabled)("required",a.required),l.uIk("id",a.id)("data-placeholder",a.placeholder)("readonly",a.readonly&&!a._isNativeSelect||null)("aria-invalid",a.empty&&a.required?null:a.errorState)("aria-required",a.required),l.ekj("mat-input-server",a._isServer)("mat-native-select-inline",a._isInlineSelect()))},inputs:{id:"id",disabled:"disabled",required:"required",type:"type",value:"value",readonly:"readonly",placeholder:"placeholder",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"]},exportAs:["matInput"],features:[l._Bn([{provide:Uf,useExisting:o}]),l.qOj,l.TTD]}),o})(),lx=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({providers:[He],imports:[dy,zg,ft,dy,zg]}),o})(),cx=(()=>{class o{constructor(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),ux=(()=>{class o{constructor(e){this.dataFunctionService=e,this.onLoadCsv=new l.vpe,this.textoBoton="Cargar fichero CSV"}ngOnInit(){}csvInputChange(e){const a=e.target.files[0];if(a&&a.name.endsWith(".csv"))try{const _=new FileReader;_.readAsText(a),_.onload=C=>{const G=this.csvToArray(_.result);this.onLoadCsv.emit(G)}}catch(_){console.log(_)}else console.log("EL FICHERO TIENE QUE SER CSV")}csvToArray(e){const a=e.split("\n"),_=[];return a.forEach(C=>{const I=C.replace("\r","").split(";");_.push({nombre:I[0],categoria:I[1]})}),_}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(cx))},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-load-csv"]],inputs:{textoBoton:"textoBoton"},outputs:{onLoadCsv:"onLoadCsv"},decls:4,vars:1,consts:[["hidden","true","type","file","onclick","this.value=null","accept",".csv",1,"form-control-file",3,"change"],["csvInput",""],["mat-button","",1,"button-class",3,"click"]],template:function(e,a){if(1&e){const _=l.EpF();l.TgZ(0,"input",0,1),l.NdJ("change",function(I){return a.csvInputChange(I)}),l.qZA(),l.TgZ(2,"button",2),l.NdJ("click",function(){l.CHM(_);const I=l.MAs(1);return l.KtG(I.click())}),l._uU(3),l.qZA()}2&e&&(l.xp6(3),l.hij(" ",a.textoBoton," "))},dependencies:[Fs],styles:[".button-class[_ngcontent-%COMP%]{border:2px solid var(--tono1);padding:5px 30px;font-family:Crimson Text,serif;font-size:11pt;box-shadow:1px 2px 3px 0 var(--tono3-transparente);background:var(--tono2);color:var(--tono6)}@media screen and (max-width: 599px){.button-class[_ngcontent-%COMP%]{width:100%;padding:0}}"]}),o})();function hx(o,c){if(1&o&&(l.TgZ(0,"span"),l._uU(1),l.qZA()),2&o){const e=l.oxw().$implicit;l.xp6(1),l.hij(" \xa0(",null==e.mesaSchema||null==e.mesaSchema.heroeSchema?null:e.mesaSchema.heroeSchema.nombre,") ")}}function dx(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"tr",15)(1,"td",21),l._uU(2),l.qZA(),l.TgZ(3,"td",22),l._uU(4),l.YNc(5,hx,2,1,"span",14),l.qZA(),l.TgZ(6,"td",19)(7,"button",23),l.NdJ("click",function(){const _=l.CHM(e),C=_.$implicit,I=_.index,G=l.oxw(2);return l.KtG(G.editarInvitado(C,I))}),l.TgZ(8,"mat-icon"),l._uU(9,"edit"),l.qZA()(),l.TgZ(10,"button",24),l.NdJ("click",function(){const _=l.CHM(e),C=_.$implicit,I=_.index,G=l.oxw(2);return l.KtG(G.abrirDialogEliminarInvitado(C,I))}),l.TgZ(11,"mat-icon"),l._uU(12,"delete"),l.qZA()()()()}if(2&o){const e=c.$implicit;l.xp6(2),l.hij(" ",e.nombre," "),l.xp6(2),l.hij(" ",null==e.mesaSchema?null:e.mesaSchema.nombre," "),l.xp6(1),l.Q6J("ngIf",null==e.mesaSchema?null:e.mesaSchema.heroeSchema)}}function px(o,c){1&o&&(l.TgZ(0,"tr")(1,"td",25),l._uU(2,"No hay invitados registrados"),l.qZA()())}function fx(o,c){1&o&&(l.TgZ(0,"tr")(1,"td",25),l._uU(2,"Cargando datos de los invitados..."),l.qZA()())}const Xd=function(o,c){return{ascendente:o,descendente:c}};function mx(o,c){if(1&o&&(l.TgZ(0,"mat-icon",26),l._uU(1,"arrow_forward_ios"),l.qZA()),2&o){const e=l.oxw(2);l.Q6J("ngClass",l.WLB(1,Xd,"NOMBRE_ASC"===e.ordenTablaInvitados,"NOMBRE_DESC"===e.ordenTablaInvitados))}}function gx(o,c){if(1&o&&(l.TgZ(0,"mat-icon",26),l._uU(1,"arrow_forward_ios"),l.qZA()),2&o){const e=l.oxw(2);l.Q6J("ngClass",l.WLB(1,Xd,"MESA_ASC"===e.ordenTablaInvitados,"MESA_DESC"===e.ordenTablaInvitados))}}function _x(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",29),l.NdJ("click",function(){l.CHM(e);const _=l.oxw(3);return l.KtG(_.paginaAnterior())}),l.TgZ(1,"mat-icon"),l._uU(2,"chevron_left"),l.qZA(),l._uU(3," Anterior "),l.qZA()}}function yx(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",29),l.NdJ("click",function(){l.CHM(e);const _=l.oxw(3);return l.KtG(_.paginaSiguiente())}),l._uU(1," Siguiente "),l.TgZ(2,"mat-icon"),l._uU(3,"chevron_right"),l.qZA()()}}function vx(o,c){if(1&o&&(l.TgZ(0,"div",27),l.YNc(1,_x,4,0,"div",28),l.YNc(2,yx,4,0,"div",28),l.qZA()),2&o){const e=l.oxw(2);l.xp6(1),l.Q6J("ngIf",0!==e.page),l.xp6(1),l.Q6J("ngIf",e.page<e.maxPaginas)}}function xx(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",12)(1,"table")(2,"tbody"),l.YNc(3,dx,13,3,"tr",13),l.YNc(4,px,3,0,"tr",14),l.YNc(5,fx,3,0,"tr",14),l.qZA(),l.TgZ(6,"thead")(7,"tr",15)(8,"th",16),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.ordenar("nombre"))}),l._uU(9," Nombre "),l.YNc(10,mx,2,4,"mat-icon",17),l.qZA(),l.TgZ(11,"th",18),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.ordenar("mesa"))}),l._uU(12," Mesa "),l.YNc(13,gx,2,4,"mat-icon",17),l.qZA(),l.TgZ(14,"th",19),l._uU(15," Acciones "),l.qZA()()()(),l.YNc(16,vx,3,2,"div",20),l.qZA()}if(2&o){const e=l.oxw();l.xp6(3),l.Q6J("ngForOf",e.vInvitadosVisible),l.xp6(1),l.Q6J("ngIf",0===e.vInvitados.length&&!e.cargandoInvitados),l.xp6(1),l.Q6J("ngIf",e.cargandoInvitados),l.xp6(5),l.Q6J("ngIf","NOMBRE_ASC"===e.ordenTablaInvitados||"NOMBRE_DESC"===e.ordenTablaInvitados),l.xp6(3),l.Q6J("ngIf","MESA_ASC"===e.ordenTablaInvitados||"MESA_DESC"===e.ordenTablaInvitados),l.xp6(3),l.Q6J("ngIf",e.vInvitados.length>0)}}function bx(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"tr",15)(1,"td",21),l._uU(2),l.qZA(),l.TgZ(3,"td",19),l._uU(4),l.qZA(),l.TgZ(5,"td",21),l._uU(6),l.qZA(),l.TgZ(7,"td",19)(8,"button",23),l.NdJ("click",function(){const C=l.CHM(e).$implicit,I=l.oxw(2);return l.KtG(I.abrirDialogEditarMesa(C))}),l.TgZ(9,"mat-icon"),l._uU(10,"edit"),l.qZA()()()()}if(2&o){const e=c.$implicit;l.xp6(2),l.hij(" ",e.nombre," "),l.xp6(2),l.hij(" ",e.numeroInvitados?e.numeroInvitados:0," "),l.xp6(2),l.hij(" ",null==e.heroeSchema?null:e.heroeSchema.nombre," ")}}function wx(o,c){1&o&&(l.TgZ(0,"tr")(1,"td",25),l._uU(2,"No hay mesas registradas"),l.qZA()())}function Cx(o,c){if(1&o&&(l.TgZ(0,"mat-icon",26),l._uU(1,"arrow_forward_ios"),l.qZA()),2&o){const e=l.oxw(2);l.Q6J("ngClass",l.WLB(1,Xd,"NOMBRE_ASC"===e.ordenTablaMesas,"NOMBRE_DESC"===e.ordenTablaMesas))}}function Mx(o,c){if(1&o&&(l.TgZ(0,"mat-icon",26),l._uU(1,"arrow_forward_ios"),l.qZA()),2&o){const e=l.oxw(2);l.Q6J("ngClass",l.WLB(1,Xd,"NUMERO_ASC"===e.ordenTablaMesas,"NUMERO_DESC"===e.ordenTablaMesas))}}function Ax(o,c){if(1&o&&(l.TgZ(0,"mat-icon",26),l._uU(1,"arrow_forward_ios"),l.qZA()),2&o){const e=l.oxw(2);l.Q6J("ngClass",l.WLB(1,Xd,"HEROE_ASC"===e.ordenTablaMesas,"HEROE_DESC"===e.ordenTablaMesas))}}function Sx(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",12)(1,"table")(2,"tbody"),l.YNc(3,bx,11,3,"tr",13),l.YNc(4,wx,3,0,"tr",14),l.qZA(),l.TgZ(5,"thead")(6,"tr",15)(7,"th",16),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.ordenarTablaMesas("nombre"))}),l._uU(8," Nombre "),l.YNc(9,Cx,2,4,"mat-icon",17),l.qZA(),l.TgZ(10,"th",30),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.ordenarTablaMesas("numero"))}),l._uU(11," N\xba invitados "),l.YNc(12,Mx,2,4,"mat-icon",17),l.qZA(),l.TgZ(13,"th",16),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.ordenarTablaMesas("heroe"))}),l._uU(14," Heroe "),l.YNc(15,Ax,2,4,"mat-icon",17),l.qZA(),l.TgZ(16,"th",19),l._uU(17," Acciones "),l.qZA()()()()()}if(2&o){const e=l.oxw();l.xp6(3),l.Q6J("ngForOf",e.vMesas),l.xp6(1),l.Q6J("ngIf",0===e.vInvitados.length&&!e.cargandoInvitados),l.xp6(5),l.Q6J("ngIf","NOMBRE_ASC"===e.ordenTablaMesas||"NOMBRE_DESC"===e.ordenTablaMesas),l.xp6(3),l.Q6J("ngIf","NUMERO_ASC"===e.ordenTablaMesas||"NUMERO_DESC"===e.ordenTablaMesas),l.xp6(3),l.Q6J("ngIf","HEROE_ASC"===e.ordenTablaMesas||"HEROE_DESC"===e.ordenTablaMesas)}}function Tx(o,c){if(1&o&&(l.TgZ(0,"mat-option",44),l._uU(1),l.qZA()),2&o){const e=c.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e.nombre," ")}}function Ex(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",31)(1,"div",32)(2,"div",33)(3,"button",34),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.cerrarDialogEditar())}),l.TgZ(4,"mat-icon"),l._uU(5,"close"),l.qZA()()(),l.TgZ(6,"div",35)(7,"div",36),l._uU(8),l.qZA(),l.TgZ(9,"form",37),l.NdJ("submit",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.creandoNuevoInvitado?_.submitGuardarNuevoInvitado():_.submitEditarInvitado())}),l.TgZ(10,"div")(11,"mat-form-field",38)(12,"mat-label"),l._uU(13,"Nombre del invitado"),l.qZA(),l._UZ(14,"input",39),l.qZA()(),l.TgZ(15,"div")(16,"mat-form-field",38)(17,"mat-label"),l._uU(18,"Selecciona la mesa"),l.qZA(),l.TgZ(19,"mat-select",40),l.YNc(20,Tx,2,2,"mat-option",41),l.qZA()()(),l.TgZ(21,"div",42)(22,"button",43),l._uU(23," Guardar "),l.qZA()()()()()()}if(2&o){const e=l.oxw();l.xp6(8),l.hij(" ",e.creandoNuevoInvitado?"Nuevo invitado":"Editar datos del invitado"," "),l.xp6(1),l.Q6J("formGroup",e.formEditarInvitado),l.xp6(11),l.Q6J("ngForOf",e.vMesas)}}function kx(o,c){if(1&o&&(l.TgZ(0,"mat-option",44),l._uU(1),l.qZA()),2&o){const e=c.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e.nombre," ")}}function Dx(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",45)(1,"div",32)(2,"div",33)(3,"button",34),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.cerrarDialogEditarMesa())}),l.TgZ(4,"mat-icon"),l._uU(5,"close"),l.qZA()()(),l.TgZ(6,"div",35)(7,"div",36),l._uU(8),l.qZA(),l.TgZ(9,"form",37),l.NdJ("submit",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.creandoNuevaMesa?_.submitCrearNuevaMesa():_.submitEditarMesa())}),l.TgZ(10,"div")(11,"mat-form-field",38)(12,"mat-label"),l._uU(13,"Nombre de la mesa"),l.qZA(),l._UZ(14,"input",46),l.qZA()(),l.TgZ(15,"div")(16,"mat-form-field",38)(17,"mat-label"),l._uU(18,"Selecciona el heroe"),l.qZA(),l.TgZ(19,"mat-select",47),l.YNc(20,kx,2,2,"mat-option",41),l.qZA()()(),l.TgZ(21,"div",48)(22,"button",49),l._uU(23," Guardar "),l.qZA()()()()()()}if(2&o){const e=l.oxw();l.xp6(8),l.hij(" ",e.creandoNuevaMesa?"Crear nueva mesa":"Editar datos mesa"," "),l.xp6(1),l.Q6J("formGroup",e.formEditarMesa),l.xp6(11),l.Q6J("ngForOf",e.vHeroes)}}function Ix(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",50)(1,"div",32)(2,"div",33)(3,"button",34),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.dialogEliminarInvitadoAbierto=!1)}),l.TgZ(4,"mat-icon"),l._uU(5,"close"),l.qZA()()(),l.TgZ(6,"div",35)(7,"div",36),l._uU(8," Eliminar invitado "),l.qZA(),l.TgZ(9,"div",51),l._uU(10," \xbfQuieres eliminar los datos de este invitado? (Cuidado: No podr\xe1s recuperarlos) "),l.qZA(),l.TgZ(11,"div",52)(12,"button",43),l._uU(13," Cancelar "),l.qZA(),l.TgZ(14,"button",53),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.submitEliminarInvitado())}),l._uU(15," Eliminar "),l.qZA()()()()()}}function Ox(o,c){if(1&o){const e=l.EpF();l.TgZ(0,"div",50)(1,"div",32)(2,"div",33)(3,"button",34),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.dialogEliminarTodosLosInvitadosAbierto=!1)}),l.TgZ(4,"mat-icon"),l._uU(5,"close"),l.qZA()()(),l.TgZ(6,"div",35)(7,"div",36),l._uU(8," Eliminar listado de invitados "),l.qZA(),l.TgZ(9,"div",51),l._uU(10," \xbfQuieres eliminar el listado completo de invitados? (Cuidado: No podr\xe1s recuperarlos) "),l.qZA(),l.TgZ(11,"div",52)(12,"button",43),l._uU(13," Cancelar "),l.qZA(),l.TgZ(14,"button",53),l.NdJ("click",function(){l.CHM(e);const _=l.oxw();return l.KtG(_.submitEliminarListadoInvitados())}),l._uU(15," Eliminar "),l.qZA()()()()()}}let Fx=(()=>{class o{constructor(e,a,_,C,I){this.invitadosService=e,this.mesasService=a,this.heroesService=_,this.fb=C,this.snackBarService=I,this.vInvitados=[],this.vInvitadosVisible=[],this.vMesas=[],this.vHeroes=[],this.page=0,this.maxPaginas=0,this.pageSize=10,this.ordenTablaInvitados=zc,this.ordenTablaMesas=Ms,this.cargandoInvitados=!1,this.dialogEditarInvitadoAbierto=!1,this.creandoNuevoInvitado=!1,this.creandoNuevaMesa=!1,this.formEditarInvitado=this.fb.group({nombre:[,[Ir.required]],mesaSelect:[,[]]}),this.formEditarMesa=this.fb.group({nombre:[,[Ir.required]],heroe:[,[Ir.required]]}),this.dialogEliminarInvitadoAbierto=!1,this.dialogEliminarTodosLosInvitadosAbierto=!1,this.dialogEditarMesaAbierto=!1}ngOnInit(){this.cargandoInvitados=!0,this.invitadosService.obtenerListadoInvitados().pipe((0,Kr.w)(e=>(this.vInvitados=e.data,this.mesasService.obtenerListadoMesas())),(0,Kr.w)(e=>(this.vMesas=e.data,this.heroesService.obtenerListadoHeroes()))).subscribe(e=>{this.vHeroes=e.data,this.vMesas.forEach(a=>{const _=this.vHeroes.find(C=>C._id===a.heroe);a.heroeSchema=_}),this.vInvitados.forEach(a=>{const _=this.vMesas.find(C=>C._id===a.mesa);a.mesaSchema=_}),this.page=0,this.maxPaginas=Math.floor(this.vInvitados.length/this.pageSize),this.asignarVInvitados(),this.cargandoInvitados=!1},e=>{console.log(e),this.cargandoInvitados=!1})}ordenar(e){switch("nombre"===e?this.ordenTablaInvitados=this.ordenTablaInvitados===Ms?Rc:Ms:"mesa"===e&&(this.ordenTablaInvitados=this.ordenTablaInvitados===zc?od:zc),this.ordenTablaInvitados){case Ms:this.vInvitados=this.vInvitados.sort((a,_)=>a.nombre<_.nombre?-1:1);break;case Rc:this.vInvitados=this.vInvitados.sort((a,_)=>a.nombre<_.nombre?1:-1);break;case zc:this.vInvitados=this.vInvitados.sort((a,_)=>a.mesaSchema?.nombre<_.mesaSchema?.nombre?-1:1);break;case od:this.vInvitados=this.vInvitados.sort((a,_)=>a.mesaSchema?.nombre<_.mesaSchema?.nombre?1:-1)}this.asignarVInvitados()}ordenarTablaMesas(e){switch("nombre"===e?this.ordenTablaMesas=this.ordenTablaMesas===Ms?Rc:Ms:"numero"===e&&(this.ordenTablaMesas=this.ordenTablaMesas===Bc?oh:Bc),this.ordenTablaMesas){case Ms:this.vMesas=this.vMesas.sort((a,_)=>a.nombre<_.nombre?-1:1);break;case Rc:this.vMesas=this.vMesas.sort((a,_)=>a.nombre<_.nombre?1:-1);break;case Bc:this.vMesas=this.vMesas.sort((a,_)=>a.numeroInvitados<_.numeroInvitados?-1:1);break;case oh:this.vMesas=this.vMesas.sort((a,_)=>a.numeroInvitados<_.numeroInvitados?1:-1)}}asignarVInvitados(e){e&&(this.vInvitados=this.vInvitados.concat(e),this.page=0,this.maxPaginas=Math.floor(this.vInvitados.length/this.pageSize)),this.asignarVMesas();const a=this.page*this.pageSize;this.vInvitadosVisible=this.vInvitados.slice(a,a+this.pageSize)}asignarVMesas(){let e={};this.vInvitados.forEach(a=>{e[a.categoria]?e[a.categoria]++:e[a.categoria]=1}),Object.keys(e).forEach(a=>{this.vMesas.find(_=>_.nombre===a).numeroInvitados=e[a]})}cargarDatosCsv(e){this.cargandoInvitados=!0;let a=[],_={};e.forEach(C=>{_[C.categoria]?_[C.categoria]++:_[C.categoria]=1}),Object.keys(_).forEach(C=>{a.push({nombre:C})}),this.mesasService.guardarMesas(a).pipe((0,Kr.w)(C=>(this.vMesas=this.vMesas.concat(C.data),e.forEach(I=>{I.mesa=this.vMesas.find(G=>G.nombre===I.categoria)?._id}),this.invitadosService.guardarInvitados(e)))).subscribe(C=>{console.log(C),this.vInvitados=this.vInvitados.concat(C.data),this.vInvitados.forEach(I=>I.mesaSchema=this.vMesas.find(G=>G._id===I.mesa)),this.asignarVInvitados(),this.cargandoInvitados=!1},C=>{console.log(C),this.cargandoInvitados=!1})}paginaSiguiente(){this.page=this.page===this.maxPaginas?this.page:this.page+1,this.asignarVInvitados()}paginaAnterior(){this.page=0===this.page?0:this.page-1,this.asignarVInvitados()}abrirDialogNuevoInvitado(){this.invitadoSeleccionado=void 0,this.dialogEditarInvitadoAbierto=!0,this.formEditarInvitado.reset({nombre:"",mesaSelect:"",mesaNueva:"",checkMesaNueva:!1})}editarInvitado(e,a){this.indexInvitadoEditando=a,this.invitadoSeleccionado=e,this.dialogEditarInvitadoAbierto=!0,this.formEditarInvitado.reset({nombre:this.invitadoSeleccionado.nombre,mesaSelect:this.invitadoSeleccionado.mesaSchema})}abrirDialogNuevaMesa(){this.mesaSeleccionada=void 0,this.dialogEditarMesaAbierto=!0,this.creandoNuevaMesa=!0,this.formEditarMesa.reset({nombre:"",heroe:void 0})}abrirDialogEliminarInvitado(e,a){this.dialogEliminarInvitadoAbierto=!0,this.invitadoSeleccionado=e}abrirDialogEditarMesa(e){this.mesaSeleccionada=e,this.dialogEditarMesaAbierto=!0,this.creandoNuevaMesa=!1,this.formEditarMesa.reset({nombre:e.nombre,heroe:e.heroeSchema})}submitGuardarNuevoInvitado(){const e=this.formEditarInvitado.value.checkMesaNueva;if(e&&""===this.formEditarInvitado.value.mesaNueva.trim())return this.formEditarInvitado.get("mesaNueva").setErrors({"mesa-requerida":!0}),void this.formEditarInvitado.markAllAsTouched();this.formEditarInvitado.get("mesaNueva").setErrors({"mesa-requerida":!0}),this.invitadosService.guardarInvitado({nombre:this.formEditarInvitado.value.nombre,categoria:e?this.formEditarInvitado.value.mesaNueva:this.formEditarInvitado.value.mesaSelect}).subscribe(_=>{this.vInvitados.push(_.data),this.asignarVInvitados(),this.formEditarInvitado.reset({}),this.invitadoSeleccionado=void 0,this.dialogEditarInvitadoAbierto=!1,this.snackBarService.open("Invitado guardado correctamente","Aceptar")})}submitEditarInvitado(){var e={_id:this.invitadoSeleccionado._id,nombre:this.formEditarInvitado.value.nombre,mesa:this.formEditarInvitado.value.mesaSelect};this.invitadosService.actualizarInvitado(e,this.invitadoSeleccionado._id).subscribe(a=>{const _=this.vInvitados.find(I=>I._id===this.invitadoSeleccionado._id),C=this.vInvitados.indexOf(_);e.mesaSchema=_.mesaSchema,e.categoria=_.categoria,this.vInvitados[C]=e,this.asignarVInvitados(),this.formEditarInvitado.reset({}),this.invitadoSeleccionado=void 0,this.dialogEditarInvitadoAbierto=!1,this.snackBarService.open("Invitado editado correctamente","Aceptar")})}submitEliminarInvitado(){this.invitadosService.eliminarInvitado(this.invitadoSeleccionado._id).subscribe(e=>{this.dialogEliminarInvitadoAbierto=!1,this.vInvitados.splice(this.vInvitados.indexOf(this.invitadoSeleccionado),1),this.asignarVInvitados(),this.snackBarService.open("Invitado eliminado correctamente","Aceptar")})}submitEliminarListadoInvitados(){this.invitadosService.eliminarTodosLosInvitados().subscribe(e=>{this.vInvitados.splice(0),this.asignarVInvitados(),this.dialogEliminarTodosLosInvitadosAbierto=!1,this.snackBarService.open("Se han eliminado todos los invitados.","Aceptar")})}submitCrearNuevaMesa(){this.formEditarMesa.invalid?this.formEditarMesa.markAllAsTouched():this.mesasService.guardarMesa({nombre:this.formEditarMesa.value.nombre,heroe:this.formEditarMesa.value.heroe._id}).subscribe(a=>{this.vMesas.push(a.data),this.asignarVInvitados(),this.snackBarService.open("Se ha guardado la nueva mesa correctamente.","Aceptar"),this.dialogEditarMesaAbierto=!1,this.creandoNuevaMesa=!1},a=>{console.log(a),this.snackBarService.open("Ha ocurrido un error al guardar los datos.","Aceptar"),this.dialogEditarMesaAbierto=!1,this.creandoNuevaMesa=!1})}submitEditarMesa(){this.formEditarMesa.invalid?this.formEditarMesa.markAllAsTouched():this.mesasService.modificarMesa({_id:this.mesaSeleccionada._id,nombre:this.formEditarMesa.value.nombre,heroe:this.formEditarMesa.value.heroe}).subscribe(a=>{this.vMesas.forEach(_=>{_._id===this.mesaSeleccionada?._id&&(_.heroe=this.formEditarMesa.value.heroe.nombre,_.heroeSchema=this.formEditarMesa.value.heroe)}),this.vInvitados.map(_=>{_.mesaSchema._id===this.mesaSeleccionada._id&&(_.mesa=a.data._id,_.mesaSchema=a.data)}),this.asignarVInvitados(),this.dialogEditarMesaAbierto=!1,this.mesaSeleccionada=void 0,this.formEditarMesa.reset({}),this.snackBarService.open("Se han modificadolos datos de la mesa.","Aceptar")},a=>{this.dialogEditarMesaAbierto=!1,this.snackBarService.open("Ha ocurrido un error al cambiar los datos de la mesa.","Aceptar"),console.log(a)})}cerrarDialogEditarMesa(){this.mesaSeleccionada=void 0,this.formEditarMesa.reset(),this.dialogEditarMesaAbierto=!1}cerrarDialogEditar(){this.creandoNuevoInvitado=!1,this.dialogEditarInvitadoAbierto=!1,this.invitadoSeleccionado=void 0}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Mn),l.Y36(Al),l.Y36(xp),l.Y36(il),l.Y36(Yy))},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-gestion-invitados"]],decls:21,vars:6,consts:[[1,"titulo-gestion-invitados"],[1,"cortina"],["fxLayoutAlign","center center",1,"texto-titulo"],[1,"container"],["fxLayout","row","fxLayoutAlign","end","fxLayoutGap","20px","fxLayoutGap.xs","10px","fxLayout.xs","column",1,"boton-cargar-container"],[1,"boton-nuevo-invitado",3,"click"],[3,"onLoadCsv"],["class","table-content",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end","fxLayoutGap","20px",1,"boton-cargar-container"],["class","dialog-edit-invitado","fxLayoutAlign","center center",4,"ngIf"],["class","dialog-edit-mesa","fxLayoutAlign","center center",4,"ngIf"],["class","dialog-eliminar-invitado","fxLayoutAlign","center center",4,"ngIf"],[1,"table-content"],["fxLayout","row",4,"ngFor","ngForOf"],[4,"ngIf"],["fxLayout","row"],["fxFlex","30","fxLayoutAlign","start center",3,"click"],["class","icon-order",3,"ngClass",4,"ngIf"],["fxFlex","50","fxLayoutAlign","start center",3,"click"],["fxFlex","20","fxLayoutAlign","start center"],["class","control-table","fxLayout","row","fxLayoutAlign","center",4,"ngIf"],["fxFlex","30","fxLayoutAlign","start center"],["fxFlex","50","fxLayoutAlign","start center"],["mat-icon-button","",1,"edit-button",3,"click"],["mat-icon-button","",1,"delete-button",3,"click"],["colspan","4"],[1,"icon-order",3,"ngClass"],["fxLayout","row","fxLayoutAlign","center",1,"control-table"],["class","control-table-button","fxFlex","25","fxFlex.sm","40","fxFlex.xs","45","fxLayoutAlign","center center",3,"click",4,"ngIf"],["fxFlex","25","fxFlex.sm","40","fxFlex.xs","45","fxLayoutAlign","center center",1,"control-table-button",3,"click"],["fxFlex","20","fxLayoutAlign","start center",3,"click"],["fxLayoutAlign","center center",1,"dialog-edit-invitado"],[1,"content-dialog"],["fxLayoutAlign","end"],["mat-icon-button","",3,"click"],["fxLayout","column",1,"dialog-form"],[1,"title-dialog"],[3,"formGroup","submit"],["fxFlex","100","appearance","fill"],["matInput","","placeholder",'Por ejemplo "Manoli"',"formControlName","nombre"],["disableRipple","","formControlName","mesaSelect"],[3,"value",4,"ngFor","ngForOf"],["type","submit","fxLayoutAlign","end",1,"botonera"],["mat-raised-button","","color","primary"],[3,"value"],["fxLayoutAlign","center center",1,"dialog-edit-mesa"],["matInput","","placeholder",'Por ejemplo "Mesa Nupcial"',"formControlName","nombre"],["disableRipple","","formControlName","heroe"],["fxLayoutAlign","end",1,"botonera"],["mat-raised-button","","color","primary","type","submit"],["fxLayoutAlign","center center",1,"dialog-eliminar-invitado"],[1,"texto-dialog"],["type","submit","fxLayoutAlign","end","fxLayoutGap","20px",1,"botonera"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,a){1&e&&(l.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"div",2),l._uU(4," Gesti\xf3n de los invitados "),l.qZA()()(),l.TgZ(5,"div",3)(6,"div",4)(7,"button",5),l.NdJ("click",function(){return a.dialogEliminarTodosLosInvitadosAbierto=!0}),l._uU(8," Vaciar listado de invitados "),l.qZA(),l.TgZ(9,"button",5),l.NdJ("click",function(){return a.abrirDialogNuevoInvitado()}),l._uU(10," Nuevo invitado "),l.qZA(),l.TgZ(11,"app-load-csv",6),l.NdJ("onLoadCsv",function(C){return a.cargarDatosCsv(C)}),l.qZA()(),l.YNc(12,xx,17,6,"div",7),l.TgZ(13,"div",8)(14,"button",5),l.NdJ("click",function(){return a.abrirDialogNuevaMesa()}),l._uU(15," Nueva mesa "),l.qZA()(),l.YNc(16,Sx,18,5,"div",7),l.qZA()(),l.YNc(17,Ex,24,3,"div",9),l.YNc(18,Dx,24,3,"div",10),l.YNc(19,Ix,16,0,"div",11),l.YNc(20,Ox,16,0,"div",11)),2&e&&(l.xp6(12),l.Q6J("ngIf",a.vInvitados.length>0),l.xp6(4),l.Q6J("ngIf",a.vMesas.length>0&&!a.cargandoInvitados),l.xp6(1),l.Q6J("ngIf",a.dialogEditarInvitadoAbierto),l.xp6(1),l.Q6J("ngIf",a.dialogEditarMesaAbierto),l.xp6(1),l.Q6J("ngIf",a.dialogEliminarInvitadoAbierto),l.xp6(1),l.Q6J("ngIf",a.dialogEliminarTodosLosInvitadosAbierto))},dependencies:[Vt.mk,Vt.sg,Vt.O5,Fs,cv,Lv,Lg,Qv,kr,ax,yi,sn,po,fo,Vr,Za,Zr,Tc,se,x,jr,ux],styles:[".container[_ngcontent-%COMP%]{font-family:Crimson Text,serif;padding:40px;min-width:calc(100% - 80px);max-width:calc(100% - 80px);min-height:calc(100% - 80px);background-color:var(--tono6)}.boton-nuevo-invitado[_ngcontent-%COMP%]{border:2px solid var(--tono1);border-radius:3px;padding:5px 30px;font-family:Crimson Text,serif;font-size:12pt;box-shadow:1px 2px 3px 0 var(--tono3-transparente);background:var(--tono2);color:var(--tono6);cursor:pointer}.subtitle-container[_ngcontent-%COMP%]{font-weight:900;text-shadow:3px 2px 4px var(--tono-box-shadow)}.titulo-gestion-invitados[_ngcontent-%COMP%]{width:100%;height:250px;background-image:url(santuario-puerto-1.632d610674907cb1.jpeg);background-position:center center;background-size:cover;font-family:Square Peg,cursive}.titulo-gestion-invitados[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#00000090}.titulo-gestion-invitados[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{color:#fff;text-shadow:2px 2px 3px #ffffff80;font-size:60pt;width:100%;height:100%}.subtitle-container[_ngcontent-%COMP%]{font-size:18pt;margin:5px 20px}.boton-cargar-container[_ngcontent-%COMP%]{margin:10px 10% 0 0;text-align:right}.table-content[_ngcontent-%COMP%]{margin:25px 10% 10px}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;background-color:var(--tono2);border-radius:3px;box-shadow:2px 2px 10px #000;margin:15px 0;border-spacing:0;border-collapse:collapse}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:2px solid var(--tono6);text-align:start;padding:15px 10px;background-color:var(--tono1);font-size:15pt;font-weight:900}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .icon-order[_ngcontent-%COMP%]{margin-left:10px}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .icon-order.no-order[_ngcontent-%COMP%]{display:none}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .icon-order.ascendente[_ngcontent-%COMP%]{transform:rotate(-90deg)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]   .icon-order.descendente[_ngcontent-%COMP%]{transform:rotate(90deg)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-right:1px solid var(--tono5-transparente);border-bottom:1px solid var(--tono5-transparente);max-width:500px;color:#000!important;text-align:start}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:2px 10px}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-right:0}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--tono7)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(even){background-color:var(--tono8)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr#row-nueva-seccion[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:0 10px 8px;text-align:center}.edit-button[_ngcontent-%COMP%]{color:var(--tono2)}.delete-button[_ngcontent-%COMP%]{color:red}input[_ngcontent-%COMP%]{color:var(--tono1)}input[_ngcontent-%COMP%]::placeholder{color:var(--tono1-transparente)}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#fff}.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:13pt}.control-table[_ngcontent-%COMP%]{margin:25px 10px;font-size:14pt;text-shadow:1px 1px 1px #00000030}.control-table-button[_ngcontent-%COMP%]{padding:10px 15px;margin:0 20px;border:2px solid var(--tono5-transparente);background:var(--tono1);box-shadow:1px 2px 3px var(--tono1-transparente);border-radius:3px;color:var(--tono7);cursor:pointer}.control-table-button[_ngcontent-%COMP%]:hover{background-color:var(--tono2);transform:translateY(-1px);box-shadow:2px 3px 5px var(--tono1-transparente)}.control-table-button[_ngcontent-%COMP%]:active{background-color:var(--tono1)}.dialog-edit-invitado[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;left:0;right:0;background-color:var(--tono5-transparente);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);z-index:50;transition:.3s}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]{width:750px;height:auto;border-radius:3px;box-shadow:1px 2px 3px var(--tono1-transparente);background-color:var(--tono8)}.dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]{width:600px;height:auto;border-radius:3px;box-shadow:1px 2px 3px var(--tono1-transparente);background-color:var(--tono8)}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]{padding:20px}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:10px 0}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%]{color:var(--tono1);text-shadow:1px 2px 3px var(--tono1-transparente);font-size:22pt;margin-bottom:40px;font-family:Crimson Text,serif}.dialog-edit-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .botonera[_ngcontent-%COMP%], .dialog-eliminar-invitado[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%]   .botonera[_ngcontent-%COMP%], .dialog-edit-mesa[_ngcontent-%COMP%]   .content-dialog[_ngcontent-%COMP%]   .dialog-form[_ngcontent-%COMP%]   .title-dialog[_ngcontent-%COMP%]   .botonera[_ngcontent-%COMP%]{margin:20px 5px 10px}@media screen and (max-width: 599px){.table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table-content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:11pt}.edit-button[_ngcontent-%COMP%], .delete-button[_ngcontent-%COMP%]{height:30px;width:30px;line-height:30px;font-size:12pt}.container[_ngcontent-%COMP%]{padding:40px 2px;min-width:calc(100% - 4px);max-width:calc(100% - 4px);min-height:calc(100% - 80px)}.table-content[_ngcontent-%COMP%]{margin:25px 1px 10px}.boton-cargar-container[_ngcontent-%COMP%]{margin:30px 1px 0}}@media screen and (min-width: 600px) and (max-width: 959px){.container[_ngcontent-%COMP%]{padding:40px 5px;min-width:calc(100% - 10px);max-width:calc(100% - 10px);min-height:calc(100% - 80px)}.table-content[_ngcontent-%COMP%]{margin:25px 5px 10px}.boton-cargar-container[_ngcontent-%COMP%]{margin:30px 5px 0 0}}@media screen and (min-width: 960px) and (max-width: 1279px){.container[_ngcontent-%COMP%]{padding:40px 10px;min-width:calc(100% - 20px);max-width:calc(100% - 20px);min-height:calc(100% - 80px)}.table-content[_ngcontent-%COMP%]{margin:25px 5% 10px}.boton-cargar-container[_ngcontent-%COMP%]{margin:30px 5% 0 0}}"]}),o})();var du=he(9898),Px=he(3963);const Lx=[{path:"",component:vp,children:[{path:"distribucion-mesas",component:va},{path:"gestion-invitados",component:Fx},{path:"ubicaciones",component:(()=>{class o{constructor(){this.centerIglesia=[-6.07987967275465,40.06193837264466],this.centerParador=[-6.094094531103214,40.02918737941208],this.zoomParador=16,this.zoomIglesia=15,this.containerIglesia="mapaIglesia",this.containerParador="mapaParador",this.containerParador2="mapaParador2",this.ubicacionIglesia="https://www.google.com/maps/place/Santuario+de+Nuestra+Se%C3%B1ora+del+Puerto/@40.0618776,-6.0818982,17z/data=!3m1!4b1!4m5!3m4!1s0xd3e160f40a550fb:0xe88a4d3fd88ddc91!8m2!3d40.0619512!4d-6.0798938",this.ubicacionParador="https://www.google.com/maps/place/Parador+de+Plasencia/@40.0291874,-6.0962725,17z/data=!3m1!4b1!4m8!3m7!1s0xd3e164b9c9b1465:0x44caa32733429e63!5m2!4m1!1i2!8m2!3d40.0291874!4d-6.0940838"}ngOnInit(){window.scroll({top:0,left:0})}ngAfterViewInit(){du.accessToken=Px.N.mapboxToken;var e=new du.Map({container:this.containerIglesia,style:"mapbox://styles/mapbox/streets-v11",center:this.centerIglesia,zoom:this.zoomIglesia,scrollZoom:!1});(new du.Marker).setLngLat(this.centerIglesia).addTo(e);var _=new du.Map({container:this.containerParador,style:"mapbox://styles/mapbox/streets-v11",center:this.centerParador,zoom:this.zoomParador,scrollZoom:!1});(new du.Marker).setLngLat(this.centerParador).addTo(_),new du.Map({container:this.containerParador2,style:"mapbox://styles/mapbox/streets-v11",center:this.centerParador,zoom:this.zoomParador,scrollZoom:!1}),(new du.Marker).setLngLat(this.centerParador).addTo(_)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-ubicaciones"]],decls:27,vars:2,consts:[[1,"container-ubicaciones"],[1,"titulo-ubicaciones"],[1,"cortina"],["fxLayoutAlign","center center",1,"texto-titulo"],["fxLayout","row wrap"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"descripcion","iglesia"],["fxLayout","column","fxLayoutAlign","center center",1,"cortina"],[1,"linea-texto"],["target","_blank",1,"como-llegar",3,"href"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"ubicacion-iglesia"],["id","mapaIglesia",1,"mapa"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100","fxShow.sm","false","fxShow.xs","false","fxShow","true",1,"ubicacion-parador"],["id","mapaParador",1,"mapa"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100",1,"descripcion","parador"],["fxFlex","50","fxFlex.xs","100","fxFlex.sm","100","fxShow.sm","true","fxShow.xs","true","fxShow","false",1,"ubicacion-parador"],["id","mapaParador2",1,"mapa"]],template:function(e,a){1&e&&(l.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),l._uU(4," Ubicaciones del enlace "),l.qZA()()(),l.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),l._uU(9," Santuario Virgen del Puerto "),l.qZA(),l.TgZ(10,"div",7),l._uU(11," Hora: 13:00 "),l.qZA(),l.TgZ(12,"a",8),l._uU(13," C\xf3mo llegar "),l.qZA()()(),l.TgZ(14,"div",9),l._UZ(15,"div",10),l.qZA()(),l.TgZ(16,"div",4)(17,"div",11),l._UZ(18,"div",12),l.qZA(),l.TgZ(19,"div",13)(20,"div",6)(21,"div",7),l._uU(22," Parador de Plasencia "),l.qZA(),l.TgZ(23,"a",8),l._uU(24," C\xf3mo llegar "),l.qZA()()(),l.TgZ(25,"div",14),l._UZ(26,"div",15),l.qZA()()()),2&e&&(l.xp6(12),l.Q6J("href",a.ubicacionIglesia,l.LSH),l.xp6(11),l.Q6J("href",a.ubicacionParador,l.LSH))},dependencies:[Zr,se,x,Di],styles:[".titulo-ubicaciones[_ngcontent-%COMP%]{width:100%;height:300px;background-image:url(foto-parador-2.f0d5aaf8d1f80569.jpeg);background-position:center center;background-size:cover;font-family:Square Peg,cursive}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#00000090}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{color:#fff;text-shadow:2px 2px 3px #ffffff80;font-size:60pt;width:100%;height:100%}.ubicacion-iglesia[_ngcontent-%COMP%], .ubicacion-parador[_ngcontent-%COMP%], .descripcion[_ngcontent-%COMP%]{height:500px}#mapaIglesia[_ngcontent-%COMP%], #mapaParador[_ngcontent-%COMP%], #mapaParador2[_ngcontent-%COMP%]{width:100%;height:100%}.descripcion.iglesia[_ngcontent-%COMP%]{background-image:url(santuario-puerto-1.632d610674907cb1.jpeg);background-position:center center;background-size:cover;z-index:10;box-shadow:2px 2px 4px #00000050}.descripcion.parador[_ngcontent-%COMP%]{background-image:url(foto-parador-1.501f9ed644383b38.jpeg);background-position:center center;background-size:cover;z-index:9;box-shadow:-2px -1px 4px #00000050}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]{font-family:Dancing Script,cursive;font-size:20pt;background-color:#ffffffc0;width:100%;height:100%}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .linea-texto[_ngcontent-%COMP%]{margin:15px 0}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .como-llegar[_ngcontent-%COMP%]{margin:30px 0;border:1px solid var(--tono1);padding:15px 40px;cursor:pointer;box-shadow:2px 2px 4px #00000050;border-radius:2px;text-decoration:none;color:#000;transition:.3s}.descripcion[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .como-llegar[_ngcontent-%COMP%]:hover{background-color:var(--tono5-transparente);border:1px solid var(--tono1);color:var(--tono1);transform:translateY(-3px) scale(1.02);transition:.3s}@media (max-width: 595px){.ubicacion-iglesia[_ngcontent-%COMP%], .ubicacion-parador[_ngcontent-%COMP%], .titulo-ubicaciones[_ngcontent-%COMP%]{height:300px}.titulo-ubicaciones[_ngcontent-%COMP%]   .cortina[_ngcontent-%COMP%]   .texto-titulo[_ngcontent-%COMP%]{font-size:40pt}}"]}),o})()},{path:"**",redirectTo:"ubicaciones"}]}];let Rx=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Ml.Bz.forChild(Lx),Ml.Bz]}),o})(),jx=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ft,ft]}),o})(),my=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({}),o})(),e0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Oi,ft,Ld,my,ft,my]}),o})();function n0(o,c){}class Bg{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.closeOnNavigation=!0}}const r0={dialogContainer:(0,ue.X$)("dialogContainer",[(0,ue.SB)("void, exit",(0,ue.oB)({opacity:0,transform:"scale(0.7)"})),(0,ue.SB)("enter",(0,ue.oB)({transform:"none"})),(0,ue.eR)("* => enter",(0,ue.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,ue.oB)({transform:"none",opacity:1}))),(0,ue.eR)("* => void, * => exit",(0,ue.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,ue.oB)({opacity:0})))])};let o0=(()=>{class o extends Zc{constructor(e,a,_,C,I,G){super(),this._elementRef=e,this._focusTrapFactory=a,this._changeDetectorRef=_,this._config=I,this._focusMonitor=G,this._animationStateChanged=new l.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=ot=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(ot)),this._ariaLabelledBy=I.ariaLabelledBy||null,this._document=C}_initializeWithAttachedContent(){this._setupFocusTrap(),this._capturePreviouslyFocusedElement(),this._focusDialogContainer()}attachComponentPortal(e){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(e)}attachTemplatePortal(e){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(e)}_recaptureFocus(){this._containsFocus()||(!this._config.autoFocus||!this._focusTrap.focusInitialElement())&&this._elementRef.nativeElement.focus()}_trapFocus(){this._config.autoFocus?this._focusTrap.focusInitialElementWhenReady():this._containsFocus()||this._elementRef.nativeElement.focus()}_restoreFocus(){const e=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&e&&"function"==typeof e.focus){const a=Pl(),_=this._elementRef.nativeElement;(!a||a===this._document.body||a===_||_.contains(a))&&(this._focusMonitor?(this._focusMonitor.focusVia(e,this._closeInteractionType),this._closeInteractionType=null):e.focus())}this._focusTrap&&this._focusTrap.destroy()}_setupFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement)}_capturePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=Pl())}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const e=this._elementRef.nativeElement,a=Pl();return e===a||e.contains(a)}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(l.SBq),l.Y36(Gd),l.Y36(l.sBO),l.Y36(Vt.K0,8),l.Y36(Bg),l.Y36(h))},o.\u0275dir=l.lG2({type:o,viewQuery:function(e,a){if(1&e&&l.Gf(zl,7),2&e){let _;l.iGM(_=l.CRH())&&(a._portalOutlet=_.first)}},features:[l.qOj]}),o})(),s0=(()=>{class o extends o0{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:e,totalTime:a}){"enter"===e?(this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:a})):"exit"===e&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:a}))}_onAnimationStart({toState:e,totalTime:a}){"enter"===e?this._animationStateChanged.next({state:"opening",totalTime:a}):("exit"===e||"void"===e)&&this._animationStateChanged.next({state:"closing",totalTime:a})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}return o.\u0275fac=function(){let c;return function(a){return(c||(c=l.n5z(o)))(a||o)}}(),o.\u0275cmp=l.Xpm({type:o,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(e,a){1&e&&l.WFA("@dialogContainer.start",function(C){return a._onAnimationStart(C)})("@dialogContainer.done",function(C){return a._onAnimationDone(C)}),2&e&&(l.Ikx("id",a._id),l.uIk("role",a._config.role)("aria-labelledby",a._config.ariaLabel?null:a._ariaLabelledBy)("aria-label",a._config.ariaLabel)("aria-describedby",a._config.ariaDescribedBy||null),l.d8E("@dialogContainer",a._state))},features:[l.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(e,a){1&e&&l.YNc(0,n0,0,0,"ng-template",0)},dependencies:[zl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[r0.dialogContainer]}}),o})(),a0=0;class Vg{constructor(c,e,a="mat-dialog-"+a0++){this._overlayRef=c,this._containerInstance=e,this.id=a,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new le.xQ,this._afterClosed=new le.xQ,this._beforeClosed=new le.xQ,this._state=0,e._id=a,e._animationStateChanged.pipe((0,hi.h)(_=>"opened"===_.state),(0,Fn.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),e._animationStateChanged.pipe((0,hi.h)(_=>"closed"===_.state),(0,Fn.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),c.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),c.keydownEvents().pipe((0,hi.h)(_=>27===_.keyCode&&!this.disableClose&&!Pn(_))).subscribe(_=>{_.preventDefault(),Gg(this,"keyboard")}),c.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():Gg(this,"mouse")})}close(c){this._result=c,this._containerInstance._animationStateChanged.pipe((0,hi.h)(e=>"closing"===e.state),(0,Fn.q)(1)).subscribe(e=>{this._beforeClosed.next(c),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),e.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(c){let e=this._getPositionStrategy();return c&&(c.left||c.right)?c.left?e.left(c.left):e.right(c.right):e.centerHorizontally(),c&&(c.top||c.bottom)?c.top?e.top(c.top):e.bottom(c.bottom):e.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(c="",e=""){return this._overlayRef.updateSize({width:c,height:e}),this._overlayRef.updatePosition(),this}addPanelClass(c){return this._overlayRef.addPanelClass(c),this}removePanelClass(c){return this._overlayRef.removePanelClass(c),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function Gg(o,c,e){return void 0!==o._containerInstance&&(o._containerInstance._closeInteractionType=c),o.close(e)}const l0=new l.OlP("MatDialogData"),c0=new l.OlP("mat-dialog-default-options"),gy=new l.OlP("mat-dialog-scroll-strategy"),h0={provide:gy,deps:[Ho],useFactory:function u0(o){return()=>o.scrollStrategies.block()}};let d0=(()=>{class o{constructor(e,a,_,C,I,G,ot,xt,qt){this._overlay=e,this._injector=a,this._defaultOptions=_,this._parentDialog=C,this._overlayContainer=I,this._dialogRefConstructor=ot,this._dialogContainerType=xt,this._dialogDataToken=qt,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new le.xQ,this._afterOpenedAtThisLevel=new le.xQ,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,ry.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,Zn.O)(void 0))),this._scrollStrategy=G}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(e,a){a=function p0(o,c){return Object.assign(Object.assign({},c),o)}(a,this._defaultOptions||new Bg),a.id&&this.getDialogById(a.id);const _=this._createOverlay(a),C=this._attachDialogContainer(_,a),I=this._attachDialogContent(e,C,_,a);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(I),I.afterClosed().subscribe(()=>this._removeOpenDialog(I)),this.afterOpened.next(I),C._initializeWithAttachedContent(),I}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(a=>a.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(e){const a=this._getOverlayConfig(e);return this._overlay.create(a)}_getOverlayConfig(e){const a=new ru({positionStrategy:this._overlay.position().global(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,disposeOnNavigation:e.closeOnNavigation});return e.backdropClass&&(a.backdropClass=e.backdropClass),a}_attachDialogContainer(e,a){const C=l.zs3.create({parent:a&&a.viewContainerRef&&a.viewContainerRef.injector||this._injector,providers:[{provide:Bg,useValue:a}]}),I=new Bi(this._dialogContainerType,a.viewContainerRef,C,a.componentFactoryResolver);return e.attach(I).instance}_attachDialogContent(e,a,_,C){const I=new this._dialogRefConstructor(_,a,C.id);if(e instanceof l.Rgc)a.attachTemplatePortal(new No(e,null,{$implicit:C.data,dialogRef:I}));else{const G=this._createInjector(C,I,a),ot=a.attachComponentPortal(new Bi(e,C.viewContainerRef,G));I.componentInstance=ot.instance}return I.updateSize(C.width,C.height).updatePosition(C.position),I}_createInjector(e,a,_){const C=e&&e.viewContainerRef&&e.viewContainerRef.injector,I=[{provide:this._dialogContainerType,useValue:_},{provide:this._dialogDataToken,useValue:e.data},{provide:this._dialogRefConstructor,useValue:a}];return e.direction&&(!C||!C.get(hn,null,l.XFs.Optional))&&I.push({provide:hn,useValue:{value:e.direction,change:(0,sr.of)()}}),l.zs3.create({parent:C||this._injector,providers:I})}_removeOpenDialog(e){const a=this.openDialogs.indexOf(e);a>-1&&(this.openDialogs.splice(a,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((_,C)=>{_?C.setAttribute("aria-hidden",_):C.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const e=this._overlayContainer.getContainerElement();if(e.parentElement){const a=e.parentElement.children;for(let _=a.length-1;_>-1;_--){let C=a[_];C!==e&&"SCRIPT"!==C.nodeName&&"STYLE"!==C.nodeName&&!C.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(C,C.getAttribute("aria-hidden")),C.setAttribute("aria-hidden","true"))}}}_closeDialogs(e){let a=e.length;for(;a--;)e[a].close()}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(Ho),l.Y36(l.zs3),l.Y36(void 0),l.Y36(void 0),l.Y36(Zo),l.Y36(void 0),l.Y36(l.DyG),l.Y36(l.DyG),l.Y36(l.OlP))},o.\u0275dir=l.lG2({type:o}),o})(),Ng=(()=>{class o extends d0{constructor(e,a,_,C,I,G,ot){super(e,a,C,G,ot,I,Vg,s0,l0)}}return o.\u0275fac=function(e){return new(e||o)(l.LFG(Ho),l.LFG(l.zs3),l.LFG(Vt.Ye,8),l.LFG(c0,8),l.LFG(gy),l.LFG(o,12),l.LFG(Zo))},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac}),o})(),yy=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({providers:[Ng,h0],imports:[ql,yd,ft,ft]}),o})(),m0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ft,ft]}),o})(),E0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ki,Oi,ft,Fi,Vt.ez,ki,ft,Fi,m0]}),o})(),V0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ki,ft,ki,ft]}),o})();he(7604);let K0=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Vt.ez,ft,Vo,Rl,Rl,ft]}),o})(),nb=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[ft,ft]}),o})(),rb=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Yd,jx,yy,V0,uv,E0,K0,nb,yy,tx,e0,lx,Z_]}),o})(),ob=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[Vt.ez,Rx,rb,as,ur.JF,_p,as]}),o})()},9898:function($g){$g.exports=function(){"use strict";var Da,he,Vt;function ur(d,Bt){if(Da)if(he){var hr="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Da+")(sharedChunk); ("+he+")(sharedChunk); self.onerror = null;",li={};Da(li),Vt=Bt(li),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Vt.workerUrl=window.URL.createObjectURL(new Blob([hr],{type:"text/javascript"})))}else he=Bt;else Da=Bt}return ur(0,function(d){var Bt=typeof self<"u"?self:{},hr=li;function li(i,t,n,s){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=s,this.p2x=n,this.p2y=s}li.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},li.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},li.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},li.prototype.solveCurveX=function(i,t){var n,s,h,f,g;for(void 0===t&&(t=1e-6),h=i,g=0;g<8;g++){if(f=this.sampleCurveX(h)-i,Math.abs(f)<t)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=f/y}if((h=i)<(n=0))return n;if(h>(s=1))return s;for(;n<s;){if(f=this.sampleCurveX(h),Math.abs(f-i)<t)return h;i>f?n=h:s=h,h=.5*(s-n)+n}return h},li.prototype.solve=function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))};var jt=Ae;function Ae(i,t){this.x=i,this.y=t}Ae.prototype={clone:function(){return new Ae(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),n=Math.sin(i),s=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=s,this},_rotateAround:function(i,t){var n=Math.cos(i),s=Math.sin(i),h=t.y+s*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-s*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ae.convert=function(i){return i instanceof Ae?i:Array.isArray(i)?new Ae(i[0],i[1]):i};const Xi=Math.PI/180,Bn=180/Math.PI;function _e(i){return i*Xi}function si(i){return i*Bn}const Ia=[[0,0],[1,0],[1,1],[0,1]];function Wo(i){if(i<=0)return 0;if(i>=1)return 1;const t=i*i,n=t*i;return 4*(i<.5?n:3*(i-t)+n-.75)}function ao(i,t,n,s){const h=new hr(i,t,n,s);return function(f){return h.solve(f)}}const Xo=ao(.25,.1,.25,1);function ye(i,t,n){return Math.min(n,Math.max(t,i))}function sn(i,t,n){return(n=ye((n-i)/(t-i),0,1))*n*(3-2*n)}function Dr(i,t,n){const s=n-t,h=((i-t)%s+s)%s+t;return h===t?n:h}function Ji(i,t,n){if(!i.length)return n(null,[]);let s=i.length;const h=new Array(i.length);let f=null;i.forEach((g,y)=>{t(g,(b,w)=>{b&&(f=b),h[y]=w,0==--s&&n(f,h)})})}function lo(i){const t=[];for(const n in i)t.push(i[n]);return t}function Ve(i,...t){for(const n of t)for(const s in n)i[s]=n[s];return i}let Hn=1;function Jo(){return Hn++}function Ir(){return function i(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ls(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Rs(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function dr(i,t){i.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function co(i,t){return-1!==i.indexOf(t,i.length-t.length)}function Vn(i,t,n){const s={};for(const h in i)s[h]=t.call(n||this,i[h],h,i);return s}function Or(i,t,n){const s={};for(const h in i)t.call(n||this,i[h],h,i)&&(s[h]=i[h]);return s}function mn(i){return Array.isArray(i)?i.map(mn):"object"==typeof i&&i?Vn(i,mn):i}const Ko={};function ci(i){Ko[i]||(typeof console<"u"&&console.warn(i),Ko[i]=!0)}function Vi(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function $n(i){let t=0;for(let n,s,h=0,f=i.length,g=f-1;h<f;g=h++)n=i[h],s=i[g],t+=(s.x-n.x)*(n.y+s.y);return t}function an(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Yn(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,h,f)=>{const g=h||f;return t[s]=!g||g.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let pr=null;function uo(i){if(null==pr){const t=i.navigator?i.navigator.userAgent:null;pr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return pr}function Qo(i){try{const t=Bt[i];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Gn(i,t){return[i[4*t],i[4*t+1],i[4*t+2],i[4*t+3]]}const zs=Bt.performance;function fr(i){const t=i?i.url.toString():void 0;return zs.getEntriesByName(t)}let Oe,Wn,mr,gn;const _n={now:()=>void 0!==mr?mr:Bt.performance.now(),setNow(i){mr=i},restoreNow(){mr=void 0},frame(i){const t=Bt.requestAnimationFrame(i);return{cancel:()=>Bt.cancelAnimationFrame(t)}},getImageData(i,t=0){const{width:n,height:s}=i;gn||(gn=Bt.document.createElement("canvas"));const h=gn.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(n>gn.width||s>gn.height)&&(gn.width=n,gn.height=s),h.clearRect(-t,-t,n+2*t,s+2*t),h.drawImage(i,0,0,n,s),h.getImageData(-t,-t,n+2*t,s+2*t)},resolveURL:i=>(Oe||(Oe=Bt.document.createElement("a")),Oe.href=i,Oe.href),get devicePixelRatio(){return Bt.devicePixelRatio},get prefersReducedMotion(){return!!Bt.matchMedia&&(null==Wn&&(Wn=Bt.matchMedia("(prefers-reduced-motion: reduce)")),Wn.matches)}};let ho;const Ie={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ho){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ho=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):i}catch{ho=i}}return ho},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},wi={supported:!1,testSupport:function(i){!ts&&Xn&&(Bs?po(i):Li=i)}};let Li,Xn,ts=!1,Bs=!1;function po(i){const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Xn),i.isContextLost())return;wi.supported=!0}catch{}i.deleteTexture(t),ts=!0}Bt.document&&(Xn=Bt.document.createElement("img"),Xn.onload=function(){Li&&po(Li),Li=null,Bs=!0},Xn.onerror=function(){ts=!0,Li=null},Xn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const fo="01",Ki="NO_ACCESS_TOKEN";function yn(i){return 0===i.indexOf("mapbox:")}function mo(i){return Ie.API_URL_REGEX.test(i)}const es=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function vn(i){const t=i.match(es);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Pr(i){const t=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${t}`}function Jl(i){if(!i)return null;const t=i.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(Bt.atob(t[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Oa{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=Jl(Ie.ACCESS_TOKEN);let s="";return s=n&&n.u?Bt.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(Number("0x"+f)))):Ie.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const t=Qo("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{const h=Bt.localStorage.getItem(n);h&&(this.eventData=JSON.parse(h));const f=Bt.localStorage.getItem(s);f&&(this.anonId=f)}catch{ci("Unable to read from LocalStorage")}}saveEventData(){const t=Qo("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{Bt.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Bt.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{ci("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,s,h){if(!Ie.EVENTS_URL)return;const f=vn(Ie.EVENTS_URL);f.params.push(`access_token=${h||Ie.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.10.0",skuId:fo,userId:this.anonId},y=n?Ve(g,n):g,b={url:Pr(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=Dt(b,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(h)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Fa=new class extends Oa{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,t){Ie.EVENTS_URL&&Ie.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>yn(n)||mo(n))&&this.queueRequest(Date.now(),t)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Jl(Ie.ACCESS_TOKEN),n=t?t.u:Ie.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;Rs(this.anonId)||(this.anonId=Ir(),s=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(h),y=(h-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||f.getDate()!==g.getDate()}else s=!0;s?this.postEvent(h,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=n)},i):this.processRequests()}},Pa=Fa.postTurnstileEvent.bind(Fa),La=new class extends Oa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,t,n,s){this.skuToken=t,this.errorCb=s,Ie.EVENTS_URL&&(n||Ie.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Ki)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Rs(this.anonId)||(this.anonId=Ir()),this.postEvent(n,{skuToken:this.skuToken},s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},i))}},Kl=La.postMapLoadEvent.bind(La),Ra=new class extends Oa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,t,n,s){if(!Ie.API_URL||!Ie.SESSION_PATH)return;const h=vn(Ie.API_URL+Ie.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${s||Ie.ACCESS_TOKEN||""}`);const f={url:Pr(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Wt(f,g=>{this.pendingRequest=null,n(g),this.saveEventData(),this.processRequests(s)})}getSessionAPI(i,t,n,s){this.skuToken=t,this.errorCb=s,Ie.SESSION_PATH&&Ie.API_URL&&(n||Ie.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Ki)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):t&&(this.success[t]=!0)},i)}},za=Ra.getSessionAPI.bind(Ra),Lr=new Set;let gr,is=500,ns=50,Ri={};function Rr(i){const t=z(i);let n,s;t&&t.forEach(f=>{const g=f.split("=");"language"===g[0]?n=g[1]:"worldview"===g[0]&&(s=g[1])});let h="mapbox-tiles";return n&&(h+=`-${n}`),s&&(h+=`-${s}`),h}function Y(){try{return Bt.caches}catch{}}function L(i){const t=Y();t&&!Ri[i]&&(Ri[i]=t.open(i))}function z(i){const t=i.indexOf("?");return t>0?i.slice(t+1).split("&"):[]}function W(i){const t=i.indexOf("?");if(t<0)return i;const n=z(i).filter(s=>{const h=s.split("=");return"language"===h[0]||"worldview"===h[0]});return n.length?`${i.slice(0,t)}?${n.join("&")}`:i.slice(0,t)}let Q=1/0;const ut={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ut);class mt extends Error{constructor(t,n,s){401===n&&mo(s)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pt=an()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Bt.location.protocol?Bt.parent:Bt).location.href,ht=function(i,t){if(!(/^file:/.test(n=i.url)||/^file:/.test(pt())&&!/^\w+:/.test(n))){if(Bt.fetch&&Bt.Request&&Bt.AbortController&&Bt.Request.prototype.hasOwnProperty("signal"))return function(s,h){const f=new Bt.AbortController,g=new Bt.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:pt(),signal:f.signal});let y=!1,b=!1;const w=(S=g.url).indexOf("sku=")>0&&mo(S);var S;"json"===s.type&&g.headers.set("Accept","application/json");const E=(F,P,B)=>{if(b)return;if(F&&"SecurityError"!==F.message&&ci(F),P&&B)return k(P);const N=Date.now();Bt.fetch(g).then(X=>{if(X.ok){const it=w?X.clone():null;return k(X,it,N)}return h(new mt(X.statusText,X.status,s.url))}).catch(X=>{20!==X.code&&h(new Error(X.message))})},k=(F,P,B)=>{("arrayBuffer"===s.type?F.arrayBuffer():"json"===s.type?F.json():F.text()).then(N=>{b||(P&&B&&function(X,it,K){const tt=Rr(X.url);if(L(tt),!Ri[tt])return;const ct={status:it.status,statusText:it.statusText,headers:new Bt.Headers};it.headers.forEach((vt,Mt)=>ct.headers.set(Mt,vt));const nt=Yn(it.headers.get("Cache-Control")||"");if(nt["no-store"])return;nt["max-age"]&&ct.headers.set("Expires",new Date(K+1e3*nt["max-age"]).toUTCString());const ft=ct.headers.get("Expires");ft&&(new Date(ft).getTime()-K<42e4||function(vt,Mt){if(void 0===gr)try{new Response(new ReadableStream),gr=!0}catch{gr=!1}gr?Mt(vt.body):vt.blob().then(Mt)}(it,vt=>{const Mt=new Bt.Response(vt,ct);L(tt),Ri[tt]&&Ri[tt].then(Pt=>Pt.put(W(X.url),Mt)).catch(Pt=>ci(Pt.message))}))}(g,P,B),y=!0,h(null,N,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(N=>{b||h(new Error(N.message))})};return w?function(F,P){const B=Rr(F.url);if(L(B),!Ri[B])return P(null);const N=W(F.url);Ri[B].then(X=>{X.match(N).then(it=>{const K=function(tt){if(!tt)return!1;const ct=new Date(tt.headers.get("Expires")||0),nt=Yn(tt.headers.get("Cache-Control")||"");return ct>Date.now()&&!nt["no-cache"]}(it);X.delete(N),K&&X.put(N,it.clone()),P(null,it,K)}).catch(P)}).catch(P)}(g,E):E(null,null),{cancel:()=>{b=!0,y||f.abort()}}}(i,t);if(an()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var n;return function(s,h){const f=new Bt.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const g in s.headers)f.setRequestHeader(g,s.headers[g]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===s.type)try{g=JSON.parse(f.response)}catch(y){return h(y)}h(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new mt(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(i,t)},_t=function(i,t){return ht(Ve(i,{type:"arrayBuffer"}),t)},Dt=function(i,t){return ht(Ve(i,{method:"POST"}),t)},Wt=function(i,t){return ht(Ve(i,{method:"GET"}),t)};function Ft(i){const t=Bt.document.createElement("a");return t.href=i,t.protocol===Bt.document.location.protocol&&t.host===Bt.document.location.host}const re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ae,te;ae=[],te=0;const oe=function(i,t){if(wi.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),te>=Ie.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return ae.push(f),f}te++;let n=!1;const s=()=>{if(!n)for(n=!0,te--;ae.length&&te<Ie.MAX_PARALLEL_IMAGE_REQUESTS;){const f=ae.shift(),{requestParameters:g,callback:y,cancelled:b}=f;b||(f.cancel=oe(g,y).cancel)}},h=_t(i,(f,g,y,b)=>{s(),f?t(f):g&&(Bt.createImageBitmap?function(w,S){const E=new Bt.Blob([new Uint8Array(w)],{type:"image/png"});Bt.createImageBitmap(E).then(k=>{S(null,k)}).catch(k=>{S(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(w,S)=>t(w,S,y,b)):function(w,S){const E=new Bt.Image,k=Bt.URL;E.onload=()=>{S(null,E),k.revokeObjectURL(E.src),E.onload=null,Bt.requestAnimationFrame(()=>{E.src=re})},E.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Bt.Blob([new Uint8Array(w)],{type:"image/png"});E.src=w.byteLength?k.createObjectURL(F):re}(g,(w,S)=>t(w,S,y,b)))});return{cancel:()=>{h.cancel(),s()}}};function ve(i,t,n){n[i]&&-1!==n[i].indexOf(t)||(n[i]=n[i]||[],n[i].push(t))}function Ge(i,t,n){if(n&&n[i]){const s=n[i].indexOf(t);-1!==s&&n[i].splice(s,1)}}class We{constructor(t,n={}){Ve(this,n),this.type=t}}class Ue extends We{constructor(t,n={}){super("error",Ve({error:t},n))}}class ee{on(t,n){return this._listeners=this._listeners||{},ve(t,n,this._listeners),this}off(t,n){return Ge(t,n,this._listeners),Ge(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ve(t,n,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,n){"string"==typeof t&&(t=new We(t,n||{}));const s=t.type;if(this.listens(s)){t.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of h)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)Ge(s,y,this._oneTimeListeners),y.call(this,t);const g=this._eventedParent;g&&(Ve(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Ue&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var Ct=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function xn(i,...t){for(const n of t)for(const s in n)i[s]=n[s];return i}function gi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function zr(i){if(Array.isArray(i))return i.map(zr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=zr(i[n]);return t}return gi(i)}class Vs extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var Nn=Vs;class Ql{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[s,h]of n)this.bindings[s]=h}concat(t){return new Ql(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Ih=Ql;const go={kind:"null"},Xt={kind:"number"},we={kind:"string"},Se={kind:"boolean"},Tn={kind:"color"},bn={kind:"object"},xe={kind:"value"},Ba={kind:"collator"},Gs={kind:"formatted"},_r={kind:"resolvedImage"};function Gi(i,t){return{kind:"array",itemType:i,N:t}}function ui(i){if("array"===i.kind){const t=ui(i.itemType);return"number"==typeof i.N?`array<${t}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${t}>`}return i.kind}const tc=[go,Xt,we,Se,Tn,Gs,bn,Gi(xe),_r];function Jn(i,t){if("error"===t.kind)return null;if("array"===i.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Jn(i.itemType,t.itemType))&&("number"!=typeof i.N||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if("value"===i.kind)for(const n of tc)if(!Jn(n,t))return null}return`Expected ${ui(i)} but found ${ui(t)} instead.`}function ec(i,t){return t.some(n=>n.kind===i.kind)}function Br(i,t){return t.some(n=>"null"===n?null===i:"array"===n?Array.isArray(i):"object"===n?i&&!Array.isArray(i)&&"object"==typeof i:n===typeof i)}function Va(i){var t={exports:{}};return i(t,t.exports),t.exports}var _o=Va(function(i,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(y){return(y=Math.round(y))<0?0:y>255?255:y}function h(y){return s("%"===y[y.length-1]?parseFloat(y)/100*255:parseInt(y))}function f(y){return(b="%"===y[y.length-1]?parseFloat(y)/100:parseFloat(y))<0?0:b>1?1:b;var b}function g(y,b,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?y+(b-y)*w*6:2*w<1?b:3*w<2?y+(b-y)*(2/3-w)*6:y}try{t.parseCSSColor=function(y){var b,w=y.replace(/ /g,"").toLowerCase();if(w in n)return n[w].slice();if("#"===w[0])return 4===w.length?(b=parseInt(w.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===w.length&&(b=parseInt(w.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var S=w.indexOf("("),E=w.indexOf(")");if(-1!==S&&E+1===w.length){var k=w.substr(0,S),F=w.substr(S+1,E-(S+1)).split(","),P=1;switch(k){case"rgba":if(4!==F.length)return null;P=f(F.pop());case"rgb":return 3!==F.length?null:[h(F[0]),h(F[1]),h(F[2]),P];case"hsla":if(4!==F.length)return null;P=f(F.pop());case"hsl":if(3!==F.length)return null;var B=(parseFloat(F[0])%360+360)%360/360,N=f(F[1]),X=f(F[2]),it=X<=.5?X*(N+1):X+N-X*N,K=2*X-it;return[s(255*g(K,it,B+1/3)),s(255*g(K,it,B)),s(255*g(K,it,B-1/3)),P];default:return null}}return null}}catch{}});class ln{constructor(t,n,s,h=1){this.r=t,this.g=n,this.b=s,this.a=h}static parse(t){if(!t)return;if(t instanceof ln)return t;if("string"!=typeof t)return;const n=_o.parseCSSColor(t);return n?new ln(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,s,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(s)},${h})`}toArray(){const{r:t,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[255*t/h,255*n/h,255*s/h,h]}toArray01(){const{r:t,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[t/h,n/h,s/h,h]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:s,a:h}=this;return[t,n,s,h]}}ln.black=new ln(0,0,0,1),ln.white=new ln(1,1,1,1),ln.transparent=new ln(0,0,0,0),ln.red=new ln(1,0,0,1),ln.blue=new ln(0,0,1,1);var Xe=ln;class fu{constructor(t,n,s){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ns{constructor(t,n,s,h,f){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=s,this.fontStack=h,this.textColor=f}}class Qi{constructor(t){this.sections=t}static fromString(t){return new Qi([new Ns(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof Qi?t:Qi.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.name]);continue}t.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(s)}return t}}class cn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new cn({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Ga(i,t,n,s){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[i,t,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[i,t,n,s]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yr(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof Xe||i instanceof fu||i instanceof Qi||i instanceof cn)return!0;if(Array.isArray(i)){for(const t of i)if(!yr(t))return!1;return!0}if("object"==typeof i){for(const t in i)if(!yr(i[t]))return!1;return!0}return!1}function yi(i){if(null===i)return go;if("string"==typeof i)return we;if("boolean"==typeof i)return Se;if("number"==typeof i)return Xt;if(i instanceof Xe)return Tn;if(i instanceof fu)return Ba;if(i instanceof Qi)return Gs;if(i instanceof cn)return _r;if(Array.isArray(i)){const t=i.length;let n;for(const s of i){const h=yi(s);if(n){if(n===h)continue;n=xe;break}n=h}return Gi(n||xe,t)}return bn}function Us(i){const t=typeof i;return null===i?"":"string"===t||"number"===t||"boolean"===t?String(i):i instanceof Xe||i instanceof Qi||i instanceof cn?i.toString():JSON.stringify(i)}class Na{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(2!==t.length)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!yr(t[1]))return n.error("invalid value");const s=t[1];let h=yi(s);const f=n.expectedType;return"array"!==h.kind||0!==h.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(h=f),new Na(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Xe?["rgba"].concat(this.value.toArray()):this.value instanceof Qi?this.value.serialize():this.value}}var js=Na,Ni=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const rs={string:we,number:Xt,boolean:Se,object:bn};class ic{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let s,h=1;const f=t[0];if("array"===f){let y,b;if(t.length>2){const w=t[1];if("string"!=typeof w||!(w in rs)||"object"===w)return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=rs[w],h++}else y=xe;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}s=Gi(y,b)}else s=rs[f];const g=[];for(;h<t.length;h++){const y=n.parse(t[h],h,xe);if(!y)return null;g.push(y)}return new ic(s,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(t);if(!Jn(this.type,yi(s)))return s;if(n===this.args.length-1)throw new Ni(`Expected value to be of type ${ui(this.type)}, but found ${ui(yi(s))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if("array"===t.kind){const s=t.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const h=t.N;("number"==typeof h||this.args.length>1)&&n.push(h)}}return n.concat(this.args.map(s=>s.serialize()))}}var wn=ic;class qs{constructor(t){this.type=Gs,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const h=[];let f=!1;for(let g=1;g<=t.length-1;++g){const y=t[g];if(f&&"object"==typeof y&&!Array.isArray(y)){f=!1;let b=null;if(y["font-scale"]&&(b=n.parse(y["font-scale"],1,Xt),!b))return null;let w=null;if(y["text-font"]&&(w=n.parse(y["text-font"],1,Gi(we)),!w))return null;let S=null;if(y["text-color"]&&(S=n.parse(y["text-color"],1,Tn),!S))return null;const E=h[h.length-1];E.scale=b,E.font=w,E.textColor=S}else{const b=n.parse(t[g],1,xe);if(!b)return null;const w=b.type.kind;if("string"!==w&&"value"!==w&&"null"!==w&&"resolvedImage"!==w)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new qs(h)}evaluate(t){return new Qi(this.sections.map(n=>{const s=n.content.evaluate(t);return yi(s)===_r?new Ns("",s,null,null,null):new Ns(Us(s),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),t.push(s)}return t}}class Zs{constructor(t){this.type=_r,this.input=t}static parse(t,n){if(2!==t.length)return n.error("Expected two arguments.");const s=n.parse(t[1],1,we);return s?new Zs(s):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),s=cn.fromString(n);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(n)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const nc={"to-boolean":Se,"to-color":Tn,"to-number":Xt,"to-string":we};class rc{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const s=t[0];if(("to-boolean"===s||"to-string"===s)&&2!==t.length)return n.error("Expected one argument.");const h=nc[s],f=[];for(let g=1;g<t.length;g++){const y=n.parse(t[g],g,xe);if(!y)return null;f.push(y)}return new rc(h,f)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let n,s;for(const h of this.args){if(n=h.evaluate(t),s=null,n instanceof Xe)return n;if("string"==typeof n){const f=t.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ga(n[0],n[1],n[2],n[3]),!s))return new Xe(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ni(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(t),null===n)return 0;const h=Number(n);if(!isNaN(h))return h}throw new Ni(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Qi.fromString(Us(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?cn.fromString(Us(this.args[0].evaluate(t))):Us(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new qs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Zs(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}var yo=rc;const Oh=["Unknown","Point","LineString","Polygon"];var Vr=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Oh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-i[0])+this.featureDistanceData.bearing[1]*(s*t-i[1])}return 0}parseColor(i){let t=this._parseColorCache[i];return t||(t=this._parseColorCache[i]=Xe.parse(i)),t}};class vo{constructor(t,n,s,h){this.name=t,this.type=n,this._evaluate=s,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const s=t[0],h=vo.definitions[s];if(!h)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,y=g.filter(([w])=>!Array.isArray(w)||w.length===t.length-1);let b=null;for(const[w,S]of y){b=new xr(n.registry,n.path,null,n.scope);const E=[];let k=!1;for(let F=1;F<t.length;F++){const P=t[F],B=Array.isArray(w)?w[F-1]:w.type,N=b.parse(P,1+E.length,B);if(!N){k=!0;break}E.push(N)}if(!k)if(Array.isArray(w)&&w.length!==E.length)b.error(`Expected ${w.length} arguments, but found ${E.length} instead.`);else{for(let F=0;F<E.length;F++){const P=Array.isArray(w)?w[F]:w.type,B=E[F];b.concat(F+1).checkSubtype(P,B.type)}if(0===b.errors.length)return new vo(s,f,S,E)}}if(1===y.length)n.errors.push(...b.errors);else{const w=(y.length?y:g).map(([E])=>{return k=E,Array.isArray(k)?`(${k.map(ui).join(", ")})`:`(${ui(k.type)}...)`;var k}).join(" | "),S=[];for(let E=1;E<t.length;E++){const k=n.parse(t[E],1+S.length);if(!k)return null;S.push(ui(k.type))}n.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(t,n){vo.definitions=n;for(const s in n)t[s]=vo}}var Cn=vo;class Ua{constructor(t,n,s){this.type=Ba,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(2!==t.length)return n.error("Expected one argument.");const s=t[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const h=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Se);if(!h)return null;const f=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Se);if(!f)return null;let g=null;return s.locale&&(g=n.parse(s.locale,1,we),!g)?null:new Ua(h,f,g)}evaluate(t){return new fu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Kn=8192;function ja(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function qa(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Za(i,t){const n=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(n*h*Kn),Math.round(s*h*Kn)]}function Fh(i,t,n){const s=i[0]-t[0],h=i[1]-t[1],f=i[0]-n[0],g=i[1]-n[1];return s*g-f*h==0&&s*f<=0&&h*g<=0}function Hs(i,t){let n=!1;for(let g=0,y=t.length;g<y;g++){const b=t[g];for(let w=0,S=b.length;w<S-1;w++){if(Fh(i,b[w],b[w+1]))return!1;(h=b[w])[1]>(s=i)[1]!=(f=b[w+1])[1]>s[1]&&s[0]<(f[0]-h[0])*(s[1]-h[1])/(f[1]-h[1])+h[0]&&(n=!n)}}var s,h,f;return n}function Ha(i,t){for(let n=0;n<t.length;n++)if(Hs(i,t[n]))return!0;return!1}function $a(i,t,n,s){const h=s[0]-n[0],f=s[1]-n[1],g=(i[0]-n[0])*f-h*(i[1]-n[1]),y=(t[0]-n[0])*f-h*(t[1]-n[1]);return g>0&&y<0||g<0&&y>0}function Ph(i,t,n){for(const w of n)for(let S=0;S<w.length-1;++S)if((y=[(g=w[S+1])[0]-(f=w[S])[0],g[1]-f[1]])[0]*(b=[(h=t)[0]-(s=i)[0],h[1]-s[1]])[1]-y[1]*b[0]!=0&&$a(s,h,f,g)&&$a(f,g,s,h))return!0;var s,h,f,g,y,b;return!1}function mu(i,t){for(let n=0;n<i.length;++n)if(!Hs(i[n],t))return!1;for(let n=0;n<i.length-1;++n)if(Ph(i[n],i[n+1],t))return!1;return!0}function gu(i,t){for(let n=0;n<t.length;n++)if(mu(i,t[n]))return!0;return!1}function En(i,t,n){const s=[];for(let h=0;h<i.length;h++){const f=[];for(let g=0;g<i[h].length;g++){const y=Za(i[h][g],n);ja(t,y),f.push(y)}s.push(f)}return s}function _u(i,t,n){const s=[];for(let h=0;h<i.length;h++){const f=En(i[h],t,n);s.push(f)}return s}function $s(i,t,n,s){if(i[0]<n[0]||i[0]>n[2]){const h=.5*s;let f=i[0]-n[0]>h?-s:n[0]-i[0]>h?s:0;0===f&&(f=i[0]-n[2]>h?-s:n[2]-i[0]>h?s:0),i[0]+=f}ja(t,i)}function oc(i,t,n,s){const h=Math.pow(2,s.z)*Kn,f=[s.x*Kn,s.y*Kn],g=[];if(!i)return g;for(const y of i)for(const b of y){const w=[b.x+f[0],b.y+f[1]];$s(w,t,n,h),g.push(w)}return g}function Ya(i,t,n,s){const h=Math.pow(2,s.z)*Kn,f=[s.x*Kn,s.y*Kn],g=[];if(!i)return g;for(const b of i){const w=[];for(const S of b){const E=[S.x+f[0],S.y+f[1]];ja(t,E),w.push(E)}g.push(w)}if(t[2]-t[0]<=h/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of g)for(const w of b)$s(w,t,n,h)}var y;return g}class xo{constructor(t,n){this.type=Se,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(yr(t[1])){const s=t[1];if("FeatureCollection"===s.type)for(let h=0;h<s.features.length;++h){const f=s.features[h].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new xo(s,s.features[h].geometry)}else if("Feature"===s.type){const h=s.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new xo(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new xo(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if("Polygon"===s.type){const y=En(s.coordinates,f,g),b=oc(n.geometry(),h,f,g);if(!qa(h,f))return!1;for(const w of b)if(!Hs(w,y))return!1}if("MultiPolygon"===s.type){const y=_u(s.coordinates,f,g),b=oc(n.geometry(),h,f,g);if(!qa(h,f))return!1;for(const w of b)if(!Ha(w,y))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if("Polygon"===s.type){const y=En(s.coordinates,f,g),b=Ya(n.geometry(),h,f,g);if(!qa(h,f))return!1;for(const w of b)if(!mu(w,y))return!1}if("MultiPolygon"===s.type){const y=_u(s.coordinates,f,g),b=Ya(n.geometry(),h,f,g);if(!qa(h,f))return!1;for(const w of b)if(!gu(w,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Qn=xo;function bo(i){if(i instanceof Cn&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof Qn)return!1;let t=!0;return i.eachChild(n=>{t&&!bo(n)&&(t=!1)}),t}function vr(i){if(i instanceof Cn&&"feature-state"===i.name)return!1;let t=!0;return i.eachChild(n=>{t&&!vr(n)&&(t=!1)}),t}function Ys(i,t){if(i instanceof Cn&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(s=>{n&&!Ys(s,t)&&(n=!1)}),n}class Ws{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");const s=t[1];return n.scope.has(s)?new Ws(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Wa=Ws;class Xa{constructor(t,n=[],s,h=new Ih,f=[]){this.registry=t,this.path=n,this.key=n.map(g=>`[${g}]`).join(""),this.scope=h,this.errors=f,this.expectedType=s}parse(t,n,s,h,f={}){return n?this.concat(n,s,h)._parse(t,f):this._parse(t,f)}_parse(t,n){function s(h,f,g){return"assert"===g?new wn(f,[h]):"coerce"===g?new yo(f,[h]):h}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let g=f.parse(t,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,b=g.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==b.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(y,b))return null}else g=s(g,y,n.typeAnnotation||"coerce");else g=s(g,y,n.typeAnnotation||"assert")}if(!(g instanceof js)&&"resolvedImage"!==g.type.kind&&Pe(g)){const y=new Vr;try{g=new js(g.type,g.evaluate(y))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,s){const h="number"==typeof t?this.path.concat(t):this.path,f=s?this.scope.concat(s):this.scope;return new Xa(this.registry,h,n||null,f,this.errors)}error(t,...n){const s=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Nn(s,t))}checkSubtype(t,n){const s=Jn(t,n);return s&&this.error(s),s}}var xr=Xa;function Pe(i){if(i instanceof Wa)return Pe(i.boundExpression);if(i instanceof Cn&&"error"===i.name||i instanceof Ua||i instanceof Qn)return!1;const t=i instanceof yo||i instanceof wn;let n=!0;return i.eachChild(s=>{n=t?n&&Pe(s):n&&s instanceof js}),!!n&&bo(i)&&Ys(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ja(i,t){const n=i.length-1;let s,h,f=0,g=n,y=0;for(;f<=g;)if(y=Math.floor((f+g)/2),s=i[y],h=i[y+1],s<=t){if(y===n||t<h)return y;f=y+1}else{if(!(s>t))throw new Ni("Input is not a number.");g=y-1}return 0}class Ka{constructor(t,n,s){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[h,f]of s)this.labels.push(h),this.outputs.push(f)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(t[1],1,Xt);if(!s)return null;const h=[];let f=null;n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(let g=1;g<t.length;g+=2){const y=1===g?-1/0:t[g],b=t[g+1],w=g,S=g+1;if("number"!=typeof y)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(h.length&&h[h.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const E=n.parse(b,S,f);if(!E)return null;f=f||E.type,h.push([y,E])}return new Ka(f,s,h)}evaluate(t){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return s[0].evaluate(t);const f=n.length;return h>=n[f-1]?s[f-1].evaluate(t):s[Ja(n,h)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var sc=Ka;function Fe(i,t,n){return i*(1-n)+t*n}function os(i,t,n){return i.map((s,h)=>Fe(s,t[h],n))}var ss=Object.freeze({__proto__:null,number:Fe,color:function(i,t,n){return new Xe(Fe(i.r,t.r,n),Fe(i.g,t.g,n),Fe(i.b,t.b,n),Fe(i.a,t.a,n))},array:os});const yu=4/29,wo=6/29,tl=3*wo*wo,Lh=Math.PI/180,vu=180/Math.PI;function as(i){return i>.008856451679035631?Math.pow(i,1/3):i/tl+yu}function el(i){return i>wo?i*i*i:tl*(i-yu)}function xu(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function lc(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function cc(i){const t=lc(i.r),n=lc(i.g),s=lc(i.b),h=as((.4124564*t+.3575761*n+.1804375*s)/.95047),f=as((.2126729*t+.7151522*n+.072175*s)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-as((.0193339*t+.119192*n+.9503041*s)/1.08883)),alpha:i.a}}function il(i){let t=(i.l+16)/116,n=isNaN(i.a)?t:t+i.a/500,s=isNaN(i.b)?t:t-i.b/200;return t=1*el(t),n=.95047*el(n),s=1.08883*el(s),new Xe(xu(3.2404542*n-1.5371385*t-.4985314*s),xu(-.969266*n+1.8760108*t+.041556*s),xu(.0556434*n-.2040259*t+1.0572252*s),i.alpha)}function Rh(i,t,n){const s=t-i;return i+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const nl={forward:cc,reverse:il,interpolate:function(i,t,n){return{l:Fe(i.l,t.l,n),a:Fe(i.a,t.a,n),b:Fe(i.b,t.b,n),alpha:Fe(i.alpha,t.alpha,n)}}},Xs={forward:function(i){const{l:t,a:n,b:s}=cc(i),h=Math.atan2(s,n)*vu;return{h:h<0?h+360:h,c:Math.sqrt(n*n+s*s),l:t,alpha:i.a}},reverse:function(i){const t=i.h*Lh,n=i.c;return il({l:i.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:i.alpha})},interpolate:function(i,t,n){return{h:Rh(i.h,t.h,n),c:Fe(i.c,t.c,n),l:Fe(i.l,t.l,n),alpha:Fe(i.alpha,t.alpha,n)}}};var le=Object.freeze({__proto__:null,lab:nl,hcl:Xs});class ls{constructor(t,n,s,h,f){this.type=t,this.operator=n,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[g,y]of f)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(t,n,s,h){let f=0;if("exponential"===t.name)f=Un(n,t.base,s,h);else if("linear"===t.name)f=Un(n,1,s,h);else if("cubic-bezier"===t.name){const g=t.controlPoints;f=new hr(g[0],g[1],g[2],g[3]).solve(Un(n,1,s,h))}return f}static parse(t,n){let[s,h,f,...g]=t;if(!Array.isArray(h)||0===h.length)return n.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const w=h[1];if("number"!=typeof w)return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:w}}else{if("cubic-bezier"!==h[0])return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const w=h.slice(1);if(4!==w.length||w.some(S=>"number"!=typeof S||S<0||S>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:w}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,Xt),!f)return null;const y=[];let b=null;"interpolate-hcl"===s||"interpolate-lab"===s?b=Tn:n.expectedType&&"value"!==n.expectedType.kind&&(b=n.expectedType);for(let w=0;w<g.length;w+=2){const S=g[w],E=g[w+1],k=w+3,F=w+4;if("number"!=typeof S)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=S)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const P=n.parse(E,F,b);if(!P)return null;b=b||P.type,y.push([S,P])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new ls(b,s,h,f,y):n.error(`Type ${ui(b)} is not interpolatable.`)}evaluate(t){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return s[0].evaluate(t);const f=n.length;if(h>=n[f-1])return s[f-1].evaluate(t);const g=Ja(n,h),y=ls.interpolationFactor(this.interpolation,h,n[g],n[g+1]),b=s[g].evaluate(t),w=s[g+1].evaluate(t);return"interpolate"===this.operator?ss[this.type.kind.toLowerCase()](b,w,y):"interpolate-hcl"===this.operator?Xs.reverse(Xs.interpolate(Xs.forward(b),Xs.forward(w),y)):nl.reverse(nl.interpolate(nl.forward(b),nl.forward(w),y))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Un(i,t,n,s){const h=s-n,f=i-n;return 0===h?0:1===t?f/h:(Math.pow(t,f)-1)/(Math.pow(t,h)-1)}var hi=ls;class Co{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let s=null;const h=n.expectedType;h&&"value"!==h.kind&&(s=h);const f=[];for(const y of t.slice(1)){const b=n.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,f.push(b)}const g=h&&f.some(y=>Jn(h,y.type));return new Co(g?xe:s,f)}evaluate(t){let n,s=null,h=0;for(const f of this.args){if(h++,s=f.evaluate(t),s&&s instanceof cn&&!s.available&&(n||(n=s),s=null,h===this.args.length))return n;if(null!==s)break}return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var bu=Co;class uc{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let f=1;f<t.length-1;f+=2){const g=t[f];if("string"!=typeof g)return n.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=n.parse(t[f+1],f+1);if(!y)return null;s.push([g,y])}const h=n.parse(t[t.length-1],t.length-1,n.expectedType,s);return h?new uc(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,s]of this.bindings)t.push(n,s.serialize());return t.push(this.result.serialize()),t}}var hc=uc;class Js{constructor(t,n,s){this.type=t,this.index=n,this.input=s}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=n.parse(t[1],1,Xt),h=n.parse(t[2],2,Gi(n.expectedType||xe));return s&&h?new Js(h.type.itemType,s,h):null}evaluate(t){const n=this.index.evaluate(t),s=this.input.evaluate(t);if(n<0)throw new Ni(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Ni(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Ni(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Gr=Js;class rl{constructor(t,n){this.type=Se,this.needle=t,this.haystack=n}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=n.parse(t[1],1,xe),h=n.parse(t[2],2,xe);return s&&h?ec(s.type,[Se,we,Xt,go,xe])?new rl(s,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ui(s.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(null==s)return!1;if(!Br(n,["boolean","string","number","null"]))throw new Ni(`Expected first argument to be of type boolean, string, number or null, but found ${ui(yi(n))} instead.`);if(!Br(s,["string","array"]))throw new Ni(`Expected second argument to be of type array or string, but found ${ui(yi(s))} instead.`);return s.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var dc=rl;class un{constructor(t,n,s){this.type=Xt,this.needle=t,this.haystack=n,this.fromIndex=s}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=n.parse(t[1],1,xe),h=n.parse(t[2],2,xe);if(!s||!h)return null;if(!ec(s.type,[Se,we,Xt,go,xe]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ui(s.type)} instead`);if(4===t.length){const f=n.parse(t[3],3,Xt);return f?new un(s,h,f):null}return new un(s,h)}evaluate(t){const n=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Br(n,["boolean","string","number","null"]))throw new Ni(`Expected first argument to be of type boolean, string, number or null, but found ${ui(yi(n))} instead.`);if(!Br(s,["string","array"]))throw new Ni(`Expected second argument to be of type array or string, but found ${ui(yi(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return s.indexOf(n,h)}return s.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Mo=un;class cs{constructor(t,n,s,h,f,g){this.inputType=t,this.type=n,this.input=s,this.cases=h,this.outputs=f,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let s,h;n.expectedType&&"value"!==n.expectedType.kind&&(h=n.expectedType);const f={},g=[];for(let w=2;w<t.length-1;w+=2){let S=t[w];const E=t[w+1];Array.isArray(S)||(S=[S]);const k=n.concat(w);if(0===S.length)return k.error("Expected at least one branch label.");for(const P of S){if("number"!=typeof P&&"string"!=typeof P)return k.error("Branch labels must be numbers or strings.");if("number"==typeof P&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof P&&Math.floor(P)!==P)return k.error("Numeric branch labels must be integer values.");if(s){if(k.checkSubtype(s,yi(P)))return null}else s=yi(P);if(void 0!==f[String(P)])return k.error("Branch labels must be unique.");f[String(P)]=g.length}const F=n.parse(E,w,h);if(!F)return null;h=h||F.type,g.push(F)}const y=n.parse(t[1],1,xe);if(!y)return null;const b=n.parse(t[t.length-1],t.length-1,h);return b?"value"!==y.type.kind&&n.concat(1).checkSubtype(s,y.type)?null:new cs(s,h,y,f,g,b):null}evaluate(t){const n=this.input.evaluate(t);return(yi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],h={};for(const g of n){const y=h[this.cases[g]];void 0===y?(h[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[y][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,y]of s)t.push(1===y.length?f(y[0]):y.map(f)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}var pc=cs;class us{constructor(t,n,s){this.type=t,this.branches=n,this.otherwise=s}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const y=n.parse(t[g],g,Se);if(!y)return null;const b=n.parse(t[g+1],g+1,s);if(!b)return null;h.push([y,b]),s=s||b.type}const f=n.parse(t[t.length-1],t.length-1,s);return f?new us(s,h,f):null}evaluate(t){for(const[n,s]of this.branches)if(n.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,s]of this.branches)t(n),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var wu=us;class ol{constructor(t,n,s,h){this.type=t,this.input=n,this.beginIndex=s,this.endIndex=h}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=n.parse(t[1],1,xe),h=n.parse(t[2],2,Xt);if(!s||!h)return null;if(!ec(s.type,[Gi(xe),we,xe]))return n.error(`Expected first argument to be of type array or string, but found ${ui(s.type)} instead`);if(4===t.length){const f=n.parse(t[3],3,Xt);return f?new ol(s.type,s,h,f):null}return new ol(s.type,s,h)}evaluate(t){const n=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Br(n,["string","array"]))throw new Ni(`Expected first argument to be of type array or string, but found ${ui(yi(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return n.slice(s,h)}return n.slice(s)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Cu=ol;function fc(i,t){return"=="===i||"!="===i?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function mc(i,t,n,s){return 0===s.compare(t,n)}function ii(i,t,n){const s="=="!==i&&"!="!==i;return class Ly{constructor(f,g,y){this.type=Se,this.lhs=f,this.rhs=g,this.collator=y,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const y=f[0];let b=g.parse(f[1],1,xe);if(!b)return null;if(!fc(y,b.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${ui(b.type)}'.`);let w=g.parse(f[2],2,xe);if(!w)return null;if(!fc(y,w.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${ui(w.type)}'.`);if(b.type.kind!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return g.error(`Cannot compare types '${ui(b.type)}' and '${ui(w.type)}'.`);s&&("value"===b.type.kind&&"value"!==w.type.kind?b=new wn(w.type,[b]):"value"!==b.type.kind&&"value"===w.type.kind&&(w=new wn(b.type,[w])));let S=null;if(4===f.length){if("string"!==b.type.kind&&"string"!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return g.error("Cannot use collator to compare non-string types.");if(S=g.parse(f[3],3,Ba),!S)return null}return new Ly(b,w,S)}evaluate(f){const g=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const b=yi(g),w=yi(y);if(b.kind!==w.kind||"string"!==b.kind&&"number"!==b.kind)throw new Ni(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=yi(g),w=yi(y);if("string"!==b.kind||"string"!==w.kind)return t(f,g,y)}return this.collator?n(f,g,y,this.collator.evaluate(f)):t(f,g,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[i];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const zh=ii("==",function(i,t,n){return t===n},mc),Mu=ii("!=",function(i,t,n){return t!==n},function(i,t,n,s){return!mc(0,t,n,s)}),Au=ii("<",function(i,t,n){return t<n},function(i,t,n,s){return s.compare(t,n)<0}),Ks=ii(">",function(i,t,n){return t>n},function(i,t,n,s){return s.compare(t,n)>0}),gc=ii("<=",function(i,t,n){return t<=n},function(i,t,n,s){return s.compare(t,n)<=0}),_c=ii(">=",function(i,t,n){return t>=n},function(i,t,n,s){return s.compare(t,n)>=0});class sl{constructor(t,n,s,h,f,g){this.type=we,this.number=t,this.locale=n,this.currency=s,this.unit=h,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(t,n){if(3!==t.length)return n.error("Expected two arguments.");const s=n.parse(t[1],1,Xt);if(!s)return null;const h=t[2];if("object"!=typeof h||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=n.parse(h.locale,1,we),!f))return null;let g=null;if(h.currency&&(g=n.parse(h.currency,1,we),!g))return null;let y=null;if(h.unit&&(y=n.parse(h.unit,1,we),!y))return null;let b=null;if(h["min-fraction-digits"]&&(b=n.parse(h["min-fraction-digits"],1,Xt),!b))return null;let w=null;return h["max-fraction-digits"]&&(w=n.parse(h["max-fraction-digits"],1,Xt),!w)?null:new sl(s,f,g,y,b,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class jn{constructor(t){this.type=Xt,this.input=t}static parse(t,n){if(2!==t.length)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=n.parse(t[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${ui(s.type)} instead.`):new jn(s):null}evaluate(t){const n=this.input.evaluate(t);if("string"==typeof n||Array.isArray(n))return n.length;throw new Ni(`Expected value to be of type string or array, but found ${ui(yi(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}const Su={"==":zh,"!=":Mu,">":Ks,"<":Au,">=":_c,"<=":gc,array:wn,at:Gr,boolean:wn,case:wu,coalesce:bu,collator:Ua,format:qs,image:Zs,in:dc,"index-of":Mo,interpolate:hi,"interpolate-hcl":hi,"interpolate-lab":hi,length:jn,let:hc,literal:js,match:pc,number:wn,"number-format":sl,object:wn,slice:Cu,step:sc,string:wn,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:Wa,within:Qn};function yc(i,[t,n,s,h]){t=t.evaluate(i),n=n.evaluate(i),s=s.evaluate(i);const f=h?h.evaluate(i):1,g=Ga(t,n,s,f);if(g)throw new Ni(g);return new Xe(t/255*f,n/255*f,s/255*f,f)}function vc(i,t){return i in t}function al(i,t){const n=t[i];return void 0===n?null:n}function br(i){return{type:i}}Cn.register(Su,{error:[{kind:"error"},[we],(i,[t])=>{throw new Ni(t.evaluate(i))}],typeof:[we,[xe],(i,[t])=>ui(yi(t.evaluate(i)))],"to-rgba":[Gi(Xt,4),[Tn],(i,[t])=>t.evaluate(i).toArray()],rgb:[Tn,[Xt,Xt,Xt],yc],rgba:[Tn,[Xt,Xt,Xt,Xt],yc],has:{type:Se,overloads:[[[we],(i,[t])=>vc(t.evaluate(i),i.properties())],[[we,bn],(i,[t,n])=>vc(t.evaluate(i),n.evaluate(i))]]},get:{type:xe,overloads:[[[we],(i,[t])=>al(t.evaluate(i),i.properties())],[[we,bn],(i,[t,n])=>al(t.evaluate(i),n.evaluate(i))]]},"feature-state":[xe,[we],(i,[t])=>al(t.evaluate(i),i.featureState||{})],properties:[bn,[],i=>i.properties()],"geometry-type":[we,[],i=>i.geometryType()],id:[xe,[],i=>i.id()],zoom:[Xt,[],i=>i.globals.zoom],pitch:[Xt,[],i=>i.globals.pitch||0],"distance-from-center":[Xt,[],i=>i.distanceFromCenter()],"heatmap-density":[Xt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Xt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Xt,[],i=>i.globals.skyRadialProgress||0],accumulated:[xe,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[Xt,br(Xt),(i,t)=>{let n=0;for(const s of t)n+=s.evaluate(i);return n}],"*":[Xt,br(Xt),(i,t)=>{let n=1;for(const s of t)n*=s.evaluate(i);return n}],"-":{type:Xt,overloads:[[[Xt,Xt],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[Xt],(i,[t])=>-t.evaluate(i)]]},"/":[Xt,[Xt,Xt],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[Xt,[Xt,Xt],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[Xt,[],()=>Math.LN2],pi:[Xt,[],()=>Math.PI],e:[Xt,[],()=>Math.E],"^":[Xt,[Xt,Xt],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[Xt,[Xt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Xt,[Xt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Xt,[Xt],(i,[t])=>Math.log(t.evaluate(i))],log2:[Xt,[Xt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Xt,[Xt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Xt,[Xt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Xt,[Xt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Xt,[Xt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Xt,[Xt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Xt,[Xt],(i,[t])=>Math.atan(t.evaluate(i))],min:[Xt,br(Xt),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[Xt,br(Xt),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[Xt,[Xt],(i,[t])=>Math.abs(t.evaluate(i))],round:[Xt,[Xt],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Xt,[Xt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Xt,[Xt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Se,[we,xe],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[Se,[xe],(i,[t])=>i.id()===t.value],"filter-type-==":[Se,[we],(i,[t])=>i.geometryType()===t.value],"filter-<":[Se,[we,xe],(i,[t,n])=>{const s=i.properties()[t.value],h=n.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Se,[xe],(i,[t])=>{const n=i.id(),s=t.value;return typeof n==typeof s&&n<s}],"filter->":[Se,[we,xe],(i,[t,n])=>{const s=i.properties()[t.value],h=n.value;return typeof s==typeof h&&s>h}],"filter-id->":[Se,[xe],(i,[t])=>{const n=i.id(),s=t.value;return typeof n==typeof s&&n>s}],"filter-<=":[Se,[we,xe],(i,[t,n])=>{const s=i.properties()[t.value],h=n.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Se,[xe],(i,[t])=>{const n=i.id(),s=t.value;return typeof n==typeof s&&n<=s}],"filter->=":[Se,[we,xe],(i,[t,n])=>{const s=i.properties()[t.value],h=n.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Se,[xe],(i,[t])=>{const n=i.id(),s=t.value;return typeof n==typeof s&&n>=s}],"filter-has":[Se,[xe],(i,[t])=>t.value in i.properties()],"filter-has-id":[Se,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[Se,[Gi(we)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Se,[Gi(xe)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Se,[we,Gi(xe)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Se,[we,Gi(xe)],(i,[t,n])=>function(s,h,f,g){for(;f<=g;){const y=f+g>>1;if(h[y]===s)return!0;h[y]>s?g=y-1:f=y+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Se,overloads:[[[Se,Se],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[br(Se),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Se,overloads:[[[Se,Se],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[br(Se),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[Se,[Se],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Se,[we],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[we,[we],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[we,[we],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[we,br(xe),(i,t)=>t.map(n=>Us(n.evaluate(i))).join("")],"resolved-locale":[we,[Ba],(i,[t])=>t.evaluate(i).resolvedLocale()]});var Qs=Su;function Tu(i){return{result:"success",value:i}}function Ao(i){return{result:"error",value:i}}function tr(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function Eu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function So(i){return!!i.expression&&i.expression.interpolated}function Le(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function hs(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function ku(i){return i}function ta(i,t){const n="color"===t.type,s=i.stops&&"object"==typeof i.stops[0][0],h=s||!(s||void 0!==i.property),f=i.type||(So(t)?"exponential":"interval");if(n&&((i=xn({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],Xe.parse(w[1])])),i.default=Xe.parse(i.default?i.default:t.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!le[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let g,y,b;if("exponential"===f)g=Nr;else if("interval"===f)g=To;else if("categorical"===f){g=Bh,y=Object.create(null);for(const w of i.stops)y[w[0]]=w[1];b=typeof i.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=ds}if(s){const w={},S=[];for(let F=0;F<i.stops.length;F++){const P=i.stops[F],B=P[0].zoom;void 0===w[B]&&(w[B]={zoom:B,type:i.type,property:i.property,default:i.default,stops:[]},S.push(B)),w[B].stops.push([P[0].value,P[1]])}const E=[];for(const F of S)E.push([w[F].zoom,ta(w[F],t)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:hi.interpolationFactor.bind(void 0,k),zoomStops:E.map(F=>F[0]),evaluate:({zoom:F},P)=>Nr({stops:E,base:i.base},t,F).evaluate(F,P)}}if(h){const w="exponential"===f?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:hi.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>g(i,t,S,y,b)}}return{kind:"source",evaluate(w,S){const E=S&&S.properties?S.properties[i.property]:void 0;return void 0===E?ea(i.default,t.default):g(i,t,E,y,b)}}}function ea(i,t,n){return void 0!==i?i:void 0!==t?t:void 0!==n?n:void 0}function Bh(i,t,n,s,h){return ea(typeof n===h?s[n]:void 0,i.default,t.default)}function To(i,t,n){if("number"!==Le(n))return ea(i.default,t.default);const s=i.stops.length;if(1===s||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[s-1][0])return i.stops[s-1][1];const h=Ja(i.stops.map(f=>f[0]),n);return i.stops[h][1]}function Nr(i,t,n){const s=void 0!==i.base?i.base:1;if("number"!==Le(n))return ea(i.default,t.default);const h=i.stops.length;if(1===h||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[h-1][0])return i.stops[h-1][1];const f=Ja(i.stops.map(S=>S[0]),n),g=function(S,E,k,F){const P=F-k,B=S-k;return 0===P?0:1===E?B/P:(Math.pow(E,B)-1)/(Math.pow(E,P)-1)}(n,s,i.stops[f][0],i.stops[f+1][0]),y=i.stops[f][1],b=i.stops[f+1][1];let w=ss[t.type]||ku;if(i.colorSpace&&"rgb"!==i.colorSpace){const S=le[i.colorSpace];w=(E,k)=>S.reverse(S.interpolate(S.forward(E),S.forward(k),g))}return"function"==typeof y.evaluate?{evaluate(...S){const E=y.evaluate.apply(void 0,S),k=b.evaluate.apply(void 0,S);if(void 0!==E&&void 0!==k)return w(E,k,g)}}:w(y,b,g)}function ds(i,t,n){return"color"===t.type?n=Xe.parse(n):"formatted"===t.type?n=Qi.fromString(n.toString()):"resolvedImage"===t.type?n=cn.fromString(n.toString()):Le(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),ea(n,i.default,t.default)}class ll{constructor(t,n){var s;this.expression=t,this._warningHistory={},this._evaluator=new Vr,this._defaultValue=n?"color"===(s=n).type&&(hs(s.default)||Array.isArray(s.default))?new Xe(0,0,0,0):"color"===s.type?Xe.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(t,n,s,h,f,g,y,b){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,s,h,f,g,y,b){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(null==w||"number"==typeof w&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Ni(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function cl(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in Qs}function ps(i,t){const n=new xr(Qs,[],t?function(h){const f={color:Tn,string:we,number:Xt,enum:we,boolean:Se,formatted:Gs,resolvedImage:_r};return"array"===h.type?Gi(f[h.value]||xe,h.length):f[h.type]}(t):void 0),s=n.parse(i,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return s?Tu(new ll(s,t)):Ao(n.errors)}class Du{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent="constant"!==t&&!vr(n.expression)}evaluateWithoutErrorHandling(t,n,s,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,s,h,f,g)}evaluate(t,n,s,h,f,g){return this._styleExpression.evaluate(t,n,s,h,f,g)}}class ul{constructor(t,n,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==t&&!vr(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,n,s,h,f,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,s,h,f,g)}evaluate(t,n,s,h,f,g){return this._styleExpression.evaluate(t,n,s,h,f,g)}interpolationFactor(t,n,s){return this.interpolationType?hi.interpolationFactor(this.interpolationType,t,n,s):0}}function Iu(i,t){if("error"===(i=ps(i,t)).result)return i;const n=i.value.expression,s=bo(n);if(!s&&!tr(t))return Ao([new Nn("","data expressions not supported")]);const h=Ys(n,["zoom","pitch","distance-from-center"]);if(!h&&!Eu(t))return Ao([new Nn("","zoom expressions not supported")]);const f=na(n);return f||h?f instanceof Nn?Ao([f]):f instanceof hi&&!So(t)?Ao([new Nn("",'"interpolate" expressions cannot be used with this property')]):Tu(f?new ul(s?"camera":"composite",i.value,f.labels,f instanceof hi?f.interpolation:void 0):new Du(s?"constant":"source",i.value)):Ao([new Nn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ia{constructor(t,n){this._parameters=t,this._specification=n,xn(this,ta(this._parameters,this._specification))}static deserialize(t){return new ia(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function na(i){let t=null;if(i instanceof hc)t=na(i.result);else if(i instanceof bu){for(const n of i.args)if(t=na(n),t)break}else(i instanceof sc||i instanceof hi)&&i.input instanceof Cn&&"zoom"===i.input.name&&(t=i);return t instanceof Nn||i.eachChild(n=>{const s=na(n);s instanceof Nn?t=s:!t&&s?t=new Nn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new Nn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class Yt{constructor(t,n,s,h){this.message=(t?`${t}: `:"")+s,h&&(this.identifier=h),null!=n&&n.__line__&&(this.line=n.__line__)}}function Re(i){const t=i.key,n=i.value,s=i.valueSpec||{},h=i.objectElementValidators||{},f=i.style,g=i.styleSpec;let y=[];const b=Le(n);if("object"!==b)return[new Yt(t,n,`object expected, ${b} found`)];for(const w in n){const S=w.split(".")[0],E=s[S]||s["*"];let k;h[S]?k=h[S]:s[S]?k=Di:h["*"]?k=h["*"]:s["*"]&&(k=Di),k?y=y.concat(k({key:(t&&`${t}.`)+w,value:n[w],valueSpec:E,style:f,styleSpec:g,object:n,objectKey:w},n)):y.push(new Yt(t,n[w],`unknown property "${w}"`))}for(const w in s)h[w]||s[w].required&&void 0===s[w].default&&void 0===n[w]&&y.push(new Yt(t,n,`missing required property "${w}"`));return y}function xi(i){const t=i.value,n=i.valueSpec,s=i.style,h=i.styleSpec,f=i.key,g=i.arrayElementValidator||Di;if("array"!==Le(t))return[new Yt(f,t,`array expected, ${Le(t)} found`)];if(n.length&&t.length!==n.length)return[new Yt(f,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Yt(f,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let y={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};h.$version<7&&(y.function=n.function),"object"===Le(n.value)&&(y=n.value);let b=[];for(let w=0;w<t.length;w++)b=b.concat(g({array:t,arrayIndex:w,value:t[w],valueSpec:y,style:s,styleSpec:h,key:`${f}[${w}]`}));return b}function hl(i){const t=i.key,n=i.value,s=i.valueSpec;let h=Le(n);if("number"===h&&n!=n&&(h="NaN"),"number"!==h)return[new Yt(t,n,`number expected, ${h} found`)];if("minimum"in s){let f=s.minimum;if("array"===Le(s.minimum)&&(f=s.minimum[i.arrayIndex]),n<f)return[new Yt(t,n,`${n} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===Le(s.maximum)&&(f=s.maximum[i.arrayIndex]),n>f)return[new Yt(t,n,`${n} is greater than the maximum value ${f}`)]}return[]}function fs(i){const t=i.valueSpec,n=gi(i.value.type);let s,h,f,g={};const y="categorical"!==n&&void 0===i.value.property,b=!y,w="array"===Le(i.value.stops)&&"array"===Le(i.value.stops[0])&&"object"===Le(i.value.stops[0][0]),S=Re({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if("identity"===n)return[new Yt(F.key,F.value,'identity function may not have a "stops" property')];let P=[];const B=F.value;return P=P.concat(xi({key:F.key,value:B,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:E})),"array"===Le(B)&&0===B.length&&P.push(new Yt(F.key,B,"array must have at least one stop")),P},default:function(F){return Di({key:F.key,value:F.value,valueSpec:t,style:F.style,styleSpec:F.styleSpec})}}});return"identity"===n&&y&&S.push(new Yt(i.key,i.value,'missing required property "property"')),"identity"===n||i.value.stops||S.push(new Yt(i.key,i.value,'missing required property "stops"')),"exponential"===n&&i.valueSpec.expression&&!So(i.valueSpec)&&S.push(new Yt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!tr(i.valueSpec)?S.push(new Yt(i.key,i.value,"property functions not supported")):y&&!Eu(i.valueSpec)&&S.push(new Yt(i.key,i.value,"zoom functions not supported"))),"categorical"!==n&&!w||void 0!==i.value.property||S.push(new Yt(i.key,i.value,'"property" property is required')),S;function E(F){let P=[];const B=F.value,N=F.key;if("array"!==Le(B))return[new Yt(N,B,`array expected, ${Le(B)} found`)];if(2!==B.length)return[new Yt(N,B,`array length 2 expected, length ${B.length} found`)];if(w){if("object"!==Le(B[0]))return[new Yt(N,B,`object expected, ${Le(B[0])} found`)];if(void 0===B[0].zoom)return[new Yt(N,B,"object stop key must have zoom")];if(void 0===B[0].value)return[new Yt(N,B,"object stop key must have value")];const X=gi(B[0].zoom);if("number"!=typeof X)return[new Yt(N,B[0].zoom,"stop zoom values must be numbers")];if(f&&f>X)return[new Yt(N,B[0].zoom,"stop zoom values must appear in ascending order")];X!==f&&(f=X,h=void 0,g={}),P=P.concat(Re({key:`${N}[0]`,value:B[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:hl,value:k}}))}else P=P.concat(k({key:`${N}[0]`,value:B[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},B));return cl(zr(B[1]))?P.concat([new Yt(`${N}[1]`,B[1],"expressions are not allowed in function stops.")]):P.concat(Di({key:`${N}[1]`,value:B[1],valueSpec:t,style:F.style,styleSpec:F.styleSpec}))}function k(F,P){const B=Le(F.value),N=gi(F.value),X=null!==F.value?F.value:P;if(s){if(B!==s)return[new Yt(F.key,X,`${B} stop domain type must match previous stop domain type ${s}`)]}else s=B;if("number"!==B&&"string"!==B&&"boolean"!==B&&"number"!=typeof N&&"string"!=typeof N&&"boolean"!=typeof N)return[new Yt(F.key,X,"stop domain value must be a number, string, or boolean")];if("number"!==B&&"categorical"!==n){let it=`number expected, ${B} found`;return tr(t)&&void 0===n&&(it+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Yt(F.key,X,it)]}return"categorical"!==n||"number"!==B||"number"==typeof N&&isFinite(N)&&Math.floor(N)===N?"categorical"!==n&&"number"===B&&"number"==typeof N&&"number"==typeof h&&void 0!==h&&N<h?[new Yt(F.key,X,"stop domain values must appear in ascending order")]:(h=N,"categorical"===n&&N in g?[new Yt(F.key,X,"stop domain values must be unique")]:(g[N]=!0,[])):[new Yt(F.key,X,`integer expected, found ${String(N)}`)]}}function je(i){const t=("property"===i.expressionContext?Iu:ps)(zr(i.value),i.valueSpec);if("error"===t.result)return t.value.map(s=>new Yt(`${i.key}${s.key}`,i.value,s.message));const n=t.value.expression||t.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!n.outputDefined())return[new Yt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!vr(n))return[new Yt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext)return dl(n,i);if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!Ys(n,["zoom","feature-state"]))return[new Yt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!bo(n))return[new Yt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dl(i,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const h of t.valueSpec.expression.parameters)n.delete(h);if(0===n.size)return[];const s=[];return i instanceof Cn&&n.has(i.name)?[new Yt(t.key,t.value,`["${i.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(i.eachChild(h=>{s.push(...dl(h,t))}),s)}function ge(i){const t=i.key,n=i.value,s=i.valueSpec,h=[];return Array.isArray(s.values)?-1===s.values.indexOf(gi(n))&&h.push(new Yt(t,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(gi(n))&&h.push(new Yt(t,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function zi(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!zi(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ra(i,t="fill"){if(null==i)return{filter:()=>!0,needGeometry:!1,needFeature:!1};zi(i)||(i=pl(i));const n=i;let s=!0;try{s=function(w){if(!Ui(w))return w;let S=zr(w);return Ci(S),S=oa(S),S}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const h=Ct[`filter_${t}`],f=ps(s,h);let g=null;if("error"===f.result)throw new Error(f.value.map(w=>`${w.key}: ${w.message}`).join(", "));g=(w,S,E)=>f.value.evaluate(w,S,{},E);let y=null,b=null;if(s!==n){const w=ps(n,h);if("error"===w.result)throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,E,k,F,P)=>w.value.evaluate(S,E,{},k,void 0,void 0,F,P),b=!bo(w.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:ke(s),needFeature:!!b}}function oa(i){if(!Array.isArray(i))return i;const t=function(n){if(Jd.has(n[0]))for(let s=1;s<n.length;s++)if(Ui(n[s]))return!0;return n}(i);return!0===t?t:t.map(n=>oa(n))}function Ci(i){let t=!1;const n=[];if("case"===i[0]){for(let s=1;s<i.length-1;s+=2)t=t||Ui(i[s]),n.push(i[s+1]);n.push(i[i.length-1])}else if("match"===i[0]){t=t||Ui(i[1]);for(let s=2;s<i.length-1;s+=2)n.push(i[s+1]);n.push(i[i.length-1])}else if("step"===i[0]){t=t||Ui(i[1]);for(let s=1;s<i.length-1;s+=2)n.push(i[s+1])}t&&(i.length=0,i.push("any",...n));for(let s=1;s<i.length;s++)Ci(i[s])}function Ui(i){if(!Array.isArray(i))return!1;if("pitch"===(t=i[0])||"distance-from-center"===t)return!0;var t;for(let n=1;n<i.length;n++)if(Ui(i[n]))return!0;return!1}const Jd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ms(i,t){return i<t?-1:i>t?1:0}function ke(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let t=1;t<i.length;t++)if(ke(i[t]))return!0;return!1}function pl(i){if(!i)return!0;const t=i[0];return i.length<=1?"any"!==t:"=="===t?xc(i[1],i[2],"=="):"!="===t?Hi(xc(i[1],i[2],"==")):"<"===t||">"===t||"<="===t||">="===t?xc(i[1],i[2],t):"any"===t?(n=i.slice(1),["any"].concat(n.map(pl))):"all"===t?["all"].concat(i.slice(1).map(pl)):"none"===t?["all"].concat(i.slice(1).map(pl).map(Hi)):"in"===t?Ur(i[1],i.slice(2)):"!in"===t?Hi(Ur(i[1],i.slice(2))):"has"===t?sa(i[1]):"!has"===t?Hi(sa(i[1])):"within"!==t||i;var n}function xc(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function Ur(i,t){if(0===t.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort(ms)]]:["filter-in-small",i,["literal",t]]}}function sa(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Hi(i){return["!",i]}function gs(i){return zi(zr(i.value))?je(xn({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Ou(i)}function Ou(i){const t=i.value,n=i.key;if("array"!==Le(t))return[new Yt(n,t,`array expected, ${Le(t)} found`)];const s=i.styleSpec;let h,f=[];if(t.length<1)return[new Yt(n,t,"filter array must have at least 1 element")];switch(f=f.concat(ge({key:`${n}[0]`,value:t[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),gi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===gi(t[1])&&f.push(new Yt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&f.push(new Yt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Le(t[1]),"string"!==h&&f.push(new Yt(`${n}[1]`,t[1],`string expected, ${h} found`)));for(let g=2;g<t.length;g++)h=Le(t[g]),"$type"===gi(t[1])?f=f.concat(ge({key:`${n}[${g}]`,value:t[g],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&f.push(new Yt(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)f=f.concat(Ou({key:`${n}[${g}]`,value:t[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Le(t[1]),2!==t.length?f.push(new Yt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==h&&f.push(new Yt(`${n}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=Le(t[1]),2!==t.length?f.push(new Yt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==h&&f.push(new Yt(`${n}[1]`,t[1],`object expected, ${h} found`))}return f}function Vh(i,t){const n=i.key,s=i.style,h=i.styleSpec,f=i.value,g=i.objectKey,y=h[`${t}_${i.layerType}`];if(!y)return[];const b=g.match(/^(.*)-transition$/);if("paint"===t&&b&&y[b[1]]&&y[b[1]].transition)return Di({key:n,value:f,valueSpec:h.transition,style:s,styleSpec:h});const w=i.valueSpec||y[g];if(!w)return[new Yt(n,f,`unknown property "${g}"`)];let S;if("string"===Le(f)&&tr(w)&&!w.tokens&&(S=/^{([^}]+)}$/.exec(f)))return[new Yt(n,f,`"${g}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const E=[];return"symbol"===i.layerType&&("text-field"===g&&s&&!s.glyphs&&E.push(new Yt(n,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&hs(zr(f))&&"identity"===gi(f.type)&&E.push(new Yt(n,f,'"text-font" does not support identity functions'))),E.concat(Di({key:i.key,value:f,valueSpec:w,style:s,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:g}))}function Fu(i){return Vh(i,"paint")}function Pu(i){return Vh(i,"layout")}function fl(i){let t=[];const n=i.value,s=i.key,h=i.style,f=i.styleSpec;n.type||n.ref||t.push(new Yt(s,n,'either "type" or "ref" is required'));let g=gi(n.type);const y=gi(n.ref);if(n.id){const b=gi(n.id);for(let w=0;w<i.arrayIndex;w++){const S=h.layers[w];gi(S.id)===b&&t.push(new Yt(s,n.id,`duplicate layer id "${n.id}", previously used at line ${S.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&t.push(new Yt(s,n[w],`"${w}" is prohibited for ref layers`))}),h.layers.forEach(w=>{gi(w.id)===y&&(b=w)}),b?b.ref?t.push(new Yt(s,n.ref,"ref cannot reference another ref layer")):g=gi(b.type):"string"==typeof y&&t.push(new Yt(s,n.ref,`ref layer "${y}" not found`))}else if("background"!==g&&"sky"!==g)if(n.source){const b=h.sources&&h.sources[n.source],w=b&&gi(b.type);b?"vector"===w&&"raster"===g?t.push(new Yt(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===w&&"raster"!==g?t.push(new Yt(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==w||n["source-layer"]?"raster-dem"===w&&"hillshade"!==g?t.push(new Yt(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===w&&b.lineMetrics||t.push(new Yt(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Yt(s,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Yt(s,n.source,`source "${n.source}" not found`))}else t.push(new Yt(s,n,'missing required property "source"'));return t=t.concat(Re({key:s,value:n,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Di({key:`${s}.type`,value:n.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:b=>gs(xn({layerType:g},b)),layout:b=>Re({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Pu(xn({layerType:g},w))}}),paint:b=>Re({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Fu(xn({layerType:g},w))}})}})),t}function aa(i){const t=i.value,n=i.key,s=Le(t);return"string"!==s?[new Yt(n,t,`string expected, ${s} found`)]:[]}const jr={promoteId:function({key:i,value:t}){if("string"===Le(t))return aa({key:i,value:t});{const n=[];for(const s in t)n.push(...aa({key:`${i}.${s}`,value:t[s]}));return n}}};function Lu(i){const t=i.value,n=i.key,s=i.styleSpec,h=i.style;if(!t.type)return[new Yt(n,t,'"type" is required')];const f=gi(t.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=Re({key:n,value:t,valueSpec:s[`source_${f.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:jr}),g;case"geojson":if(g=Re({key:n,value:t,valueSpec:s.source_geojson,style:h,styleSpec:s,objectElementValidators:jr}),t.cluster)for(const y in t.clusterProperties){const[b,w]=t.clusterProperties[y],S="string"==typeof b?[b,["accumulated"],["get",y]]:b;g.push(...je({key:`${n}.${y}.map`,value:w,expressionContext:"cluster-map"})),g.push(...je({key:`${n}.${y}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return g;case"video":return Re({key:n,value:t,valueSpec:s.source_video,style:h,styleSpec:s});case"image":return Re({key:n,value:t,valueSpec:s.source_image,style:h,styleSpec:s});case"canvas":return[new Yt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ge({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:s})}}function Ru(i){const t=i.value,n=i.styleSpec,s=n.light,h=i.style;let f=[];const g=Le(t);if(void 0===t)return f;if("object"!==g)return f=f.concat([new Yt("light",t,`object expected, ${g} found`)]),f;for(const y in t){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&s[b[1]]&&s[b[1]].transition?Di({key:y,value:t[y],valueSpec:n.transition,style:h,styleSpec:n}):s[y]?Di({key:y,value:t[y],valueSpec:s[y],style:h,styleSpec:n}):[new Yt(y,t[y],`unknown property "${y}"`)])}return f}function _s(i){const t=i.value,n=i.key,s=i.style,h=i.styleSpec,f=h.terrain;let g=[];const y=Le(t);if(void 0===t)return g;if("object"!==y)return g=g.concat([new Yt("terrain",t,`object expected, ${y} found`)]),g;for(const b in t){const w=b.match(/^(.*)-transition$/);g=g.concat(w&&f[w[1]]&&f[w[1]].transition?Di({key:b,value:t[b],valueSpec:h.transition,style:s,styleSpec:h}):f[b]?Di({key:b,value:t[b],valueSpec:f[b],style:s,styleSpec:h}):[new Yt(b,t[b],`unknown property "${b}"`)])}if(t.source){const b=s.sources&&s.sources[t.source],w=b&&gi(b.type);b?"raster-dem"!==w&&g.push(new Yt(n,t.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):g.push(new Yt(n,t.source,`source "${t.source}" not found`))}else g.push(new Yt(n,t,'terrain is missing required property "source"'));return g}function zu(i){const t=i.value,n=i.style,s=i.styleSpec,h=s.fog;let f=[];const g=Le(t);if(void 0===t)return f;if("object"!==g)return f=f.concat([new Yt("fog",t,`object expected, ${g} found`)]),f;for(const y in t){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&h[b[1]]&&h[b[1]].transition?Di({key:y,value:t[y],valueSpec:s.transition,style:n,styleSpec:s}):h[y]?Di({key:y,value:t[y],valueSpec:h[y],style:n,styleSpec:s}):[new Yt(y,t[y],`unknown property "${y}"`)])}return f}const Bu={"*":()=>[],array:xi,boolean:function(i){const t=i.value,n=i.key,s=Le(t);return"boolean"!==s?[new Yt(n,t,`boolean expected, ${s} found`)]:[]},number:hl,color:function(i){const t=i.key,n=i.value,s=Le(n);return"string"!==s?[new Yt(t,n,`color expected, ${s} found`)]:null===_o.parseCSSColor(n)?[new Yt(t,n,`color expected, "${n}" found`)]:[]},enum:ge,filter:gs,function:fs,layer:fl,object:Re,source:Lu,light:Ru,terrain:_s,fog:zu,string:aa,formatted:function(i){return 0===aa(i).length?[]:je(i)},resolvedImage:function(i){return 0===aa(i).length?[]:je(i)},projection:function(i){const t=i.value,n=i.styleSpec,s=n.projection,h=i.style;let f=[];const g=Le(t);if("object"===g)for(const y in t)f=f.concat(Di({key:y,value:t[y],valueSpec:s[y],style:h,styleSpec:n}));else"string"!==g&&(f=f.concat([new Yt("projection",t,`object or string expected, ${g} found`)]));return f}};function Di(i){const t=i.value,n=i.valueSpec,s=i.styleSpec;return n.expression&&hs(gi(t))?fs(i):n.expression&&cl(zr(t))?je(i):n.type&&Bu[n.type]?Bu[n.type](i):Re(xn({},i,{valueSpec:n.type?s[n.type]:n}))}function Gh(i){const t=i.value,n=i.key,s=aa(i);return s.length||(-1===t.indexOf("{fontstack}")&&s.push(new Yt(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&s.push(new Yt(n,t,'"glyphs" url must include a "{range}" token'))),s}function la(i,t=Ct){return er(Di({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,objectElementValidators:{glyphs:Gh,"*":()=>[]}}))}const ml=i=>er(Fu(i)),Vu=i=>er(Pu(i));function er(i){return i.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function gl(i,t){let n=!1;if(t&&t.length)for(const s of t)i.fire(new Ue(new Error(s.message))),n=!0;return n}var Eo=kn;function kn(i,t,n){var s=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(t=h[1])+2*(n=h[2]);for(var f=0;f<this.d*this.d;f++){var g=h[3+f],y=h[3+f+1];s.push(g===y?null:h.subarray(g,y))}var b=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=i,this.padding=n,this.scale=t/i,this.uid=0;var S=n/t*i;this.min=-S,this.max=i+S}kn.prototype.insert=function(i,t,n,s,h){this._forEachCell(t,n,s,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(h)},kn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},kn.prototype._insertCell=function(i,t,n,s,h,f){this.cells[h].push(f)},kn.prototype.query=function(i,t,n,s,h){var f=this.min,g=this.max;if(i<=f&&t<=f&&g<=n&&g<=s&&!h)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(i,t,n,s,this._queryCell,y,{},h),y},kn.prototype._queryCell=function(i,t,n,s,h,f,g,y){var b=this.cells[h];if(null!==b)for(var w=this.keys,S=this.bboxes,E=0;E<b.length;E++){var k=b[E];if(void 0===g[k]){var F=4*k;(y?y(S[F+0],S[F+1],S[F+2],S[F+3]):i<=S[F+2]&&t<=S[F+3]&&n>=S[F+0]&&s>=S[F+1])?(g[k]=!0,f.push(w[k])):g[k]=!1}}},kn.prototype._forEachCell=function(i,t,n,s,h,f,g,y){for(var b=this._convertToCellCoord(i),w=this._convertToCellCoord(t),S=this._convertToCellCoord(n),E=this._convertToCellCoord(s),k=b;k<=S;k++)for(var F=w;F<=E;F++){var P=this.d*F+k;if((!y||y(this._convertFromCellCoord(k),this._convertFromCellCoord(F),this._convertFromCellCoord(k+1),this._convertFromCellCoord(F+1)))&&h.call(this,i,t,n,s,P,f,g,y))return}},kn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},kn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},kn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,t=3+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var h=new Int32Array(t+n+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=t,g=0;g<i.length;g++){var y=i[g];h[3+g]=f,h.set(y,f),f+=y.length}return h[3+i.length]=f,h.set(this.keys,f),h[3+i.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};const _l={};function Jt(i,t,n={}){Object.defineProperty(i,"_classRegistryKey",{value:t,writeable:!1}),_l[t]={klass:i,omit:n.omit||[]}}Jt(Object,"Object"),Eo.serialize=function(i,t){const n=i.toArrayBuffer();return t&&t.push(n),{buffer:n}},Eo.deserialize=function(i){return new Eo(i.buffer)},Object.defineProperty(Eo,"name",{value:"Grid"}),Jt(Eo,"Grid"),Jt(Xe,"Color"),Jt(Error,"Error"),Jt(mt,"AJAXError"),Jt(cn,"ResolvedImage"),Jt(ia,"StylePropertyFunction"),Jt(ll,"StyleExpression",{omit:["_evaluator"]}),Jt(ul,"ZoomDependentExpression"),Jt(Du,"ZoomConstantExpression"),Jt(Cn,"CompoundExpression",{omit:["_evaluate"]});for(const i in Qs)_l[Qs[i]._classRegistryKey]||Jt(Qs[i],`Expression${i}`);function bc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function wc(i){return Bt.ImageBitmap&&i instanceof Bt.ImageBitmap}function ca(i,t){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(bc(i)||wc(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return t&&t.push(n.buffer),n}if(i instanceof Bt.ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const s of i)n.push(ca(s,t));return n}if("object"==typeof i){const n=i.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const h=n.serialize?n.serialize(i,t):{};if(!n.serialize){for(const f in i)i.hasOwnProperty(f)&&(_l[s].omit.indexOf(f)>=0||(h[f]=ca(i[f],t)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof i)}function ys(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||bc(i)||wc(i)||ArrayBuffer.isView(i)||i instanceof Bt.ImageData)return i;if(Array.isArray(i))return i.map(ys);if("object"==typeof i){const t=i.$name||"Object",{klass:n}=_l[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const s=Object.create(n.prototype);for(const h of Object.keys(i))"$name"!==h&&(s[h]=ys(i[h]));return s}throw new Error("can't deserialize object of type "+typeof i)}class Cc{constructor(){this.first=!0}update(t,n){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const Gu=i=>i>=1536&&i<=1791,hn=i=>i>=1872&&i<=1919,Nh=i=>i>=2208&&i<=2303,ko=i=>i>=11904&&i<=12031,yl=i=>i>=12032&&i<=12255,qr=i=>i>=12272&&i<=12287,vl=i=>i>=12288&&i<=12351,xl=i=>i>=12352&&i<=12447,qn=i=>i>=12448&&i<=12543,Nu=i=>i>=12544&&i<=12591,Mc=i=>i>=12704&&i<=12735,Uu=i=>i>=12736&&i<=12783,Ac=i=>i>=12784&&i<=12799,ju=i=>i>=12800&&i<=13055,Sc=i=>i>=13056&&i<=13311,Zr=i=>i>=13312&&i<=19903,ua=i=>i>=19968&&i<=40959,ha=i=>i>=40960&&i<=42127,qu=i=>i>=42128&&i<=42191,Zu=i=>i>=44032&&i<=55215,Uh=i=>i>=63744&&i<=64255,da=i=>i>=64336&&i<=65023,Tc=i=>i>=65040&&i<=65055,Ec=i=>i>=65072&&i<=65103,Hu=i=>i>=65104&&i<=65135,kc=i=>i>=65136&&i<=65279,Dc=i=>i>=65280&&i<=65519;function Do(i){for(const t of i)if(pa(t.charCodeAt(0)))return!0;return!1}function jh(i){for(const t of i)if(!qh(t.charCodeAt(0)))return!1;return!0}function qh(i){return!(Gu(i)||hn(i)||Nh(i)||da(i)||kc(i))}function pa(i){return!(746!==i&&747!==i&&(i<4352||!(Mc(i)||Nu(i)||Ec(i)&&!(i>=65097&&i<=65103)||Uh(i)||Sc(i)||ko(i)||Uu(i)||!(!vl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||Zr(i)||ua(i)||ju(i)||(t=i,t>=12592&&t<=12687)||(t=>t>=43360&&t<=43391)(i)||(t=>t>=55216&&t<=55295)(i)||(t=>t>=4352&&t<=4607)(i)||Zu(i)||xl(i)||qr(i)||(t=>t>=12688&&t<=12703)(i)||yl(i)||Ac(i)||qn(i)&&12540!==i||!(!Dc(i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!Hu(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(t=>t>=5120&&t<=5759)(i)||(t=>t>=6320&&t<=6399)(i)||Tc(i)||(t=>t>=19904&&t<=19967)(i)||ha(i)||qu(i))));var t}function fa(i){return!(pa(i)||(t=i,(n=t)>=128&&n<=255&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(n=>n>=8192&&n<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(n=>n>=8448&&n<=8527)(t)||(n=>n>=8528&&n<=8591)(t)||(n=>n>=8960&&n<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(n=>n>=9216&&n<=9279)(t)&&9251!==t||(n=>n>=9280&&n<=9311)(t)||(n=>n>=9312&&n<=9471)(t)||(n=>n>=9632&&n<=9727)(t)||(n=>n>=9728&&n<=9983)(t)&&!(t>=9754&&t<=9759)||(n=>n>=11008&&n<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||vl(t)||qn(t)||(n=>n>=57344&&n<=63743)(t)||Ec(t)||Hu(t)||Dc(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t,n}function p(i){return i>=1424&&i<=2303||da(i)||kc(i)}function r(i,t){return!(!t&&p(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(n=i,n>=6016&&n<=6143));var n}function u(i){for(const t of i)if(p(t.charCodeAt(0)))return!0;return!1}const m="deferred",v="loading",x="loaded";let M=null,A="unavailable",T=null;const D=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(A="error"),M&&M(i)};function O(){R.fire(new We("pluginStateChange",{pluginStatus:A,pluginURL:T}))}const R=new ee,V=function(){return A},H=function(){if(A!==m||!T)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");A=v,O(),T&&_t({url:T},i=>{i?D(i):(A=x,O())})},j={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>A===x||null!=j.applyArabicShaping,isLoading:()=>A===v,setState(i){A=i.pluginStatus,T=i.pluginURL},isParsed:()=>null!=j.applyArabicShaping&&null!=j.processBidirectionalText&&null!=j.processStyledBidirectionalText,getPluginURL:()=>T};class q{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cc,this.transition={},this.pitch=0)}isSupportedScript(t){return function(n,s){for(const h of n)if(!r(h.charCodeAt(0),s))return!1;return!0}(t,j.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*n}}}class Z{constructor(t,n){this.property=t,this.value=n,this.expression=function(s,h){if(hs(s))return new ia(s,h);if(cl(s)){const f=Iu(s,h);if("error"===f.result)throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===h.type&&(f=Xe.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===n?t.specification.default:n,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,n,s){return this.property.possiblyEvaluate(this,t,n,s)}}class U{constructor(t){this.property=t,this.value=new Z(t,void 0)}transitioned(t,n){return new $(this.property,this.value,n,Ve({},t.transition,this.transition),t.now)}untransitioned(){return new $(this.property,this.value,null,{},0)}}class J{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return mn(this._values[t].value.value)}setValue(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new U(this._values[t].property)),this._values[t].value=new Z(this._values[t].property,null===n?void 0:mn(n))}getTransition(t){return mn(this._values[t].transition)}setTransition(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new U(this._values[t].property)),this._values[t].transition=mn(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(t[n]=s);const h=this.getTransition(n);void 0!==h&&(t[`${n}-transition`]=h)}return t}transitioned(t,n){const s=new lt(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(t,n._values[h]);return s}untransitioned(){const t=new lt(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class ${constructor(t,n,s,h,f){const g=h.delay||0,y=h.duration||0;f=f||0,this.property=t,this.value=n,this.begin=f+g,this.end=this.begin+y,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(t,n,s){const h=t.now||0,f=this.value.possiblyEvaluate(t,n,s),g=this.prior;if(g){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return g.possiblyEvaluate(t,n,s);{const y=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,s),f,Wo(y))}}return f}}class lt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,s){const h=new at(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,n,s);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class st{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return mn(this._values[t].value)}setValue(t,n){this._values[t]=new Z(this._values[t].property,null===n?void 0:mn(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(t[n]=s)}return t}possiblyEvaluate(t,n,s){const h=new at(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,n,s);return h}}class et{constructor(t,n,s){this.property=t,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,n,s,h){return this.property.evaluate(this.value,this.parameters,t,n,s,h)}}class at{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class rt{constructor(t){this.specification=t}possiblyEvaluate(t,n){return t.expression.evaluate(n)}interpolate(t,n,s){const h=ss[this.specification.type];return h?h(t,n,s):t}}class dt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,s,h){return new et(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(n,null,{},s,h)}:t.expression,n)}interpolate(t,n,s){if("constant"!==t.value.kind||"constant"!==n.value.kind)return t;if(void 0===t.value.value||void 0===n.value.value)return new et(this,{kind:"constant",value:void 0},t.parameters);const h=ss[this.specification.type];return h?new et(this,{kind:"constant",value:h(t.value.value,n.value.value,s)},t.parameters):t}evaluate(t,n,s,h,f,g){return"constant"===t.kind?t.value:t.evaluate(n,s,h,f,g)}}class yt extends dt{possiblyEvaluate(t,n,s,h){if(void 0===t.value)return new et(this,{kind:"constant",value:void 0},n);if("constant"===t.expression.kind){const f=t.expression.evaluate(n,null,{},s,h),g="resolvedImage"===t.property.specification.type&&"string"!=typeof f?f.name:f,y=this._calculate(g,g,g,n);return new et(this,{kind:"constant",value:y},n)}if("camera"===t.expression.kind){const f=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new et(this,{kind:"constant",value:f},n)}return new et(this,t.expression,n)}evaluate(t,n,s,h,f,g){if("source"===t.kind){const y=t.evaluate(n,s,h,f,g);return this._calculate(y,y,y,n)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},s,h),t.evaluate({zoom:Math.floor(n.zoom)},s,h),t.evaluate({zoom:Math.floor(n.zoom)+1},s,h),n):t.value}_calculate(t,n,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n,other:s}:{from:s,to:n,other:t}}interpolate(t){return t}}class Lt{constructor(t){this.specification=t}possiblyEvaluate(t,n,s,h){if(void 0!==t.value){if("constant"===t.expression.kind){const f=t.expression.evaluate(n,null,{},s,h);return this._calculate(f,f,f,n)}return this._calculate(t.expression.evaluate(new q(Math.floor(n.zoom-1),n)),t.expression.evaluate(new q(Math.floor(n.zoom),n)),t.expression.evaluate(new q(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:s,to:n}}interpolate(t){return t}}class gt{constructor(t){this.specification=t}possiblyEvaluate(t,n,s,h){return!!t.expression.evaluate(n,null,{},s,h)}interpolate(){return!1}}class At{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new q(0,{});for(const s in t){const h=t[s];h.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new Z(h,void 0),g=this.defaultTransitionablePropertyValues[s]=new U(h);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(n)}}}function kt(i,t){return 256*(i=ye(Math.floor(i),0,255))+ye(Math.floor(t),0,255)}Jt(dt,"DataDrivenProperty"),Jt(rt,"DataConstantProperty"),Jt(yt,"CrossFadedDataDrivenProperty"),Jt(Lt,"CrossFadedProperty"),Jt(gt,"ColorRampProperty");const Gt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wt{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Et(i,t=1){let n=0,s=0;return{members:i.map(h=>{const f=Gt[h.type].BYTES_PER_ELEMENT,g=n=Zt(n,Math.max(t,f)),y=h.components||1;return s=Math.max(s,f),n+=f*y,{name:h.name,type:h.type,components:y,offset:g}}),size:Zt(n,Math.max(s,t)),alignment:t}}function Zt(i,t){return Math.ceil(i/t)*t}class Ut extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,n)}emplace(t,n,s){const h=2*t;return this.int16[h+0]=n,this.int16[h+1]=s,t}}Ut.prototype.bytesPerElement=4,Jt(Ut,"StructArrayLayout2i4");class Qt extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,s)}emplace(t,n,s,h){const f=3*t;return this.int16[f+0]=n,this.int16[f+1]=s,this.int16[f+2]=h,t}}Qt.prototype.bytesPerElement=6,Jt(Qt,"StructArrayLayout3i6");class ie extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,s,h)}emplace(t,n,s,h,f){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=s,this.int16[g+2]=h,this.int16[g+3]=f,t}}ie.prototype.bytesPerElement=8,Jt(ie,"StructArrayLayout4i8");class se extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,s,h,f,g,y)}emplace(t,n,s,h,f,g,y,b){const w=6*t,S=12*t,E=3*t;return this.int16[w+0]=n,this.int16[w+1]=s,this.uint8[S+4]=h,this.uint8[S+5]=f,this.uint8[S+6]=g,this.uint8[S+7]=y,this.float32[E+2]=b,t}}se.prototype.bytesPerElement=12,Jt(se,"StructArrayLayout2i4ub1f12");class Te extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,s,h)}emplace(t,n,s,h,f){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=s,this.float32[g+2]=h,this.float32[g+3]=f,t}}Te.prototype.bytesPerElement=16,Jt(Te,"StructArrayLayout4f16");class Kt extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g,y,b,w,S){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,s,h,f,g,y,b,w,S)}emplace(t,n,s,h,f,g,y,b,w,S,E){const k=10*t;return this.uint16[k+0]=n,this.uint16[k+1]=s,this.uint16[k+2]=h,this.uint16[k+3]=f,this.uint16[k+4]=g,this.uint16[k+5]=y,this.uint16[k+6]=b,this.uint16[k+7]=w,this.uint16[k+8]=S,this.uint16[k+9]=E,t}}Kt.prototype.bytesPerElement=20,Jt(Kt,"StructArrayLayout10ui20");class me extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g,y,b){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,s,h,f,g,y,b)}emplace(t,n,s,h,f,g,y,b,w){const S=8*t;return this.uint16[S+0]=n,this.uint16[S+1]=s,this.uint16[S+2]=h,this.uint16[S+3]=f,this.uint16[S+4]=g,this.uint16[S+5]=y,this.uint16[S+6]=b,this.uint16[S+7]=w,t}}me.prototype.bytesPerElement=16,Jt(me,"StructArrayLayout8ui16");class ze extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,s,h,f,g)}emplace(t,n,s,h,f,g,y){const b=6*t;return this.int16[b+0]=n,this.int16[b+1]=s,this.int16[b+2]=h,this.int16[b+3]=f,this.int16[b+4]=g,this.int16[b+5]=y,t}}ze.prototype.bytesPerElement=12,Jt(ze,"StructArrayLayout6i12");class ai extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g,y,b,w,S,E,k){const F=this.length;return this.resize(F+1),this.emplace(F,t,n,s,h,f,g,y,b,w,S,E,k)}emplace(t,n,s,h,f,g,y,b,w,S,E,k,F){const P=12*t;return this.int16[P+0]=n,this.int16[P+1]=s,this.int16[P+2]=h,this.int16[P+3]=f,this.uint16[P+4]=g,this.uint16[P+5]=y,this.uint16[P+6]=b,this.uint16[P+7]=w,this.int16[P+8]=S,this.int16[P+9]=E,this.int16[P+10]=k,this.int16[P+11]=F,t}}ai.prototype.bytesPerElement=24,Jt(ai,"StructArrayLayout4i4ui4i24");class vi extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,s,h,f,g)}emplace(t,n,s,h,f,g,y){const b=10*t,w=5*t;return this.int16[b+0]=n,this.int16[b+1]=s,this.int16[b+2]=h,this.float32[w+2]=f,this.float32[w+3]=g,this.float32[w+4]=y,t}}vi.prototype.bytesPerElement=20,Jt(vi,"StructArrayLayout3i3f20");class $e extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}$e.prototype.bytesPerElement=4,Jt($e,"StructArrayLayout1ul4");class ji extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g,y,b,w,S,E,k,F){const P=this.length;return this.resize(P+1),this.emplace(P,t,n,s,h,f,g,y,b,w,S,E,k,F)}emplace(t,n,s,h,f,g,y,b,w,S,E,k,F,P){const B=20*t,N=10*t;return this.int16[B+0]=n,this.int16[B+1]=s,this.int16[B+2]=h,this.int16[B+3]=f,this.int16[B+4]=g,this.float32[N+3]=y,this.float32[N+4]=b,this.float32[N+5]=w,this.float32[N+6]=S,this.int16[B+14]=E,this.uint32[N+8]=k,this.uint16[B+18]=F,this.uint16[B+19]=P,t}}ji.prototype.bytesPerElement=40,Jt(ji,"StructArrayLayout5i4f1i1ul2ui40");class ir extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,s,h,f,g,y)}emplace(t,n,s,h,f,g,y,b){const w=8*t;return this.int16[w+0]=n,this.int16[w+1]=s,this.int16[w+2]=h,this.int16[w+4]=f,this.int16[w+5]=g,this.int16[w+6]=y,this.int16[w+7]=b,t}}ir.prototype.bytesPerElement=16,Jt(ir,"StructArrayLayout3i2i2i16");class nr extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,s,h,f)}emplace(t,n,s,h,f,g){const y=4*t,b=8*t;return this.float32[y+0]=n,this.float32[y+1]=s,this.float32[y+2]=h,this.int16[b+6]=f,this.int16[b+7]=g,t}}nr.prototype.bytesPerElement=16,Jt(nr,"StructArrayLayout2f1f2i16");class ni extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,s,h)}emplace(t,n,s,h,f){const g=12*t,y=3*t;return this.uint8[g+0]=n,this.uint8[g+1]=s,this.float32[y+1]=h,this.float32[y+2]=f,t}}ni.prototype.bytesPerElement=12,Jt(ni,"StructArrayLayout2ub2f12");class di extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,s)}emplace(t,n,s,h){const f=3*t;return this.float32[f+0]=n,this.float32[f+1]=s,this.float32[f+2]=h,t}}di.prototype.bytesPerElement=12,Jt(di,"StructArrayLayout3f12");class Me extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,s)}emplace(t,n,s,h){const f=3*t;return this.uint16[f+0]=n,this.uint16[f+1]=s,this.uint16[f+2]=h,t}}Me.prototype.bytesPerElement=6,Jt(Me,"StructArrayLayout3ui6");class Si extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g,y,b,w,S,E,k,F,P,B,N,X,it,K,tt,ct){const nt=this.length;return this.resize(nt+1),this.emplace(nt,t,n,s,h,f,g,y,b,w,S,E,k,F,P,B,N,X,it,K,tt,ct)}emplace(t,n,s,h,f,g,y,b,w,S,E,k,F,P,B,N,X,it,K,tt,ct,nt){const ft=30*t,vt=15*t,Mt=60*t;return this.int16[ft+0]=n,this.int16[ft+1]=s,this.int16[ft+2]=h,this.float32[vt+2]=f,this.float32[vt+3]=g,this.uint16[ft+8]=y,this.uint16[ft+9]=b,this.uint32[vt+5]=w,this.uint32[vt+6]=S,this.uint32[vt+7]=E,this.uint16[ft+16]=k,this.uint16[ft+17]=F,this.uint16[ft+18]=P,this.float32[vt+10]=B,this.float32[vt+11]=N,this.uint8[Mt+48]=X,this.uint8[Mt+49]=it,this.uint8[Mt+50]=K,this.uint32[vt+13]=tt,this.int16[ft+28]=ct,this.uint8[Mt+58]=nt,t}}Si.prototype.bytesPerElement=60,Jt(Si,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class $i extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f,g,y,b,w,S,E,k,F,P,B,N,X,it,K,tt,ct,nt,ft,vt,Mt,Pt,bt,St,Ot,Tt){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,t,n,s,h,f,g,y,b,w,S,E,k,F,P,B,N,X,it,K,tt,ct,nt,ft,vt,Mt,Pt,bt,St,Ot,Tt)}emplace(t,n,s,h,f,g,y,b,w,S,E,k,F,P,B,N,X,it,K,tt,ct,nt,ft,vt,Mt,Pt,bt,St,Ot,Tt,Rt){const It=38*t,Ht=19*t;return this.int16[It+0]=n,this.int16[It+1]=s,this.int16[It+2]=h,this.float32[Ht+2]=f,this.float32[Ht+3]=g,this.int16[It+8]=y,this.int16[It+9]=b,this.int16[It+10]=w,this.int16[It+11]=S,this.int16[It+12]=E,this.int16[It+13]=k,this.uint16[It+14]=F,this.uint16[It+15]=P,this.uint16[It+16]=B,this.uint16[It+17]=N,this.uint16[It+18]=X,this.uint16[It+19]=it,this.uint16[It+20]=K,this.uint16[It+21]=tt,this.uint16[It+22]=ct,this.uint16[It+23]=nt,this.uint16[It+24]=ft,this.uint16[It+25]=vt,this.uint16[It+26]=Mt,this.uint16[It+27]=Pt,this.uint16[It+28]=bt,this.uint32[Ht+15]=St,this.float32[Ht+16]=Ot,this.float32[Ht+17]=Tt,this.float32[Ht+18]=Rt,t}}$i.prototype.bytesPerElement=76,Jt($i,"StructArrayLayout3i2f6i15ui1ul3f76");class Ke extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Ke.prototype.bytesPerElement=4,Jt(Ke,"StructArrayLayout1f4");class tn extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,s,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,s,h,f)}emplace(t,n,s,h,f,g){const y=5*t;return this.float32[y+0]=n,this.float32[y+1]=s,this.float32[y+2]=h,this.float32[y+3]=f,this.float32[y+4]=g,t}}tn.prototype.bytesPerElement=20,Jt(tn,"StructArrayLayout5f20");class Io extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,s,h)}emplace(t,n,s,h,f){const g=6*t;return this.uint32[3*t+0]=n,this.uint16[g+2]=s,this.uint16[g+3]=h,this.uint16[g+4]=f,t}}Io.prototype.bytesPerElement=12,Jt(Io,"StructArrayLayout1ul3ui12");class en extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,n)}emplace(t,n,s){const h=2*t;return this.uint16[h+0]=n,this.uint16[h+1]=s,t}}en.prototype.bytesPerElement=4,Jt(en,"StructArrayLayout2ui4");class Hr extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Hr.prototype.bytesPerElement=2,Jt(Hr,"StructArrayLayout1ui2");class $r extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,n)}emplace(t,n,s){const h=2*t;return this.float32[h+0]=n,this.float32[h+1]=s,t}}$r.prototype.bytesPerElement=8,Jt($r,"StructArrayLayout2f8");class Oo extends wt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Oo.prototype.size=12;class nn extends ze{get(t){return new Oo(this,t)}}Jt(nn,"FillExtrusionExtArray");class Fo extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Fo.prototype.size=40;class Yr extends ji{get(t){return new Fo(this,t)}}Jt(Yr,"CollisionBoxArray");class ma extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}ma.prototype.size=60;class Hf extends Si{get(t){return new ma(this,t)}}Jt(Hf,"PlacedSymbolArray");class Kd extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Kd.prototype.size=76;class Qd extends $i{get(t){return new Kd(this,t)}}Jt(Qd,"SymbolInstanceArray");class Zh extends Ke{getoffsetX(t){return this.float32[1*t+0]}}Jt(Zh,"GlyphOffsetArray");class Hh extends Qt{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Jt(Hh,"SymbolLineVertexArray");class tp extends wt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}tp.prototype.size=12;class ep extends Io{get(t){return new tp(this,t)}}Jt(ep,"FeatureIndexArray");class ip extends wt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ip.prototype.size=4;class np extends en{get(t){return new ip(this,t)}}Jt(np,"FillExtrusionCentroidArray");class rp extends wt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}rp.prototype.size=12;class $f extends ze{get(t){return new rp(this,t)}}Jt($f,"CircleGlobeExtArray");const Yf=Et([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Wf=Et([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var op=Va(function(i){i.exports=function(t,n){var s,h,f,g,y,b,w,S;for(h=t.length-(s=3&t.length),f=n,y=3432918353,b=461845907,S=0;S<h;)w=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24,++S,f=27492+(65535&(g=5*(65535&(f=(f^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&t.charCodeAt(S+2))<<16;case 2:w^=(255&t.charCodeAt(S+1))<<8;case 1:f^=w=(65535&(w=(w=(65535&(w^=255&t.charCodeAt(S)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295}return f^=t.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Xf=Va(function(i){i.exports=function(t,n){for(var s,h=t.length,f=n^h,g=0;h>=4;)s=1540483477*(65535&(s=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:f^=(255&t.charCodeAt(g+2))<<16;case 2:f^=(255&t.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&t.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),Ic=op,Jf=Xf;Ic.murmur3=op,Ic.murmur2=Jf;class $u{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,s,h){this.ids.push(Kf(t)),this.positions.push(n,s,h)}getPositions(t){const n=Kf(t);let s=0,h=this.ids.length-1;for(;s<h;){const g=s+h>>1;this.ids[g]>=n?h=g:s=g+1}const f=[];for(;this.ids[s]===n;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(t,n){const s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return $h(s,h,0,s.length-1),n&&n.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(t){const n=new $u;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Kf(i){const t=+i;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Ic(String(i))}function $h(i,t,n,s){for(;n<s;){const h=i[n+s>>1];let f=n-1,g=s+1;for(;;){do{f++}while(i[f]<h);do{g--}while(i[g]>h);if(f>=g)break;Yu(i,f,g),Yu(t,3*f,3*g),Yu(t,3*f+1,3*g+1),Yu(t,3*f+2,3*g+2)}g-n<s-g?($h(i,t,n,g),n=g+1):($h(i,t,g+1,s),s=g)}}function Yu(i,t,n){const s=i[t];i[t]=i[n],i[n]=s}Jt($u,"FeaturePositionMap");class Po{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,n),this.initialized=!0),!!this.location}}class Wu extends Po{constructor(t){super(t),this.current=0}set(t,n,s){this.fetchUniformLocation(t,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class sp extends Po{constructor(t){super(t),this.current=[0,0,0,0]}set(t,n,s){this.fetchUniformLocation(t,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class ap extends Po{constructor(t){super(t),this.current=Xe.transparent}set(t,n,s){this.fetchUniformLocation(t,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Qf=new Float32Array(16),tm=new Float32Array(9),Yg=new Float32Array(4);function Yh(i){return[kt(255*i.r,255*i.g),kt(255*i.b,255*i.a)]}class Oc{constructor(t,n,s){this.value=t,this.uniformNames=n.map(h=>`u_${h}`),this.type=s}setUniform(t,n,s,h,f){n.set(t,f,h.constantOr(this.value))}getBinding(t,n){return"color"===this.type?new ap(t):new Wu(t)}}class bl{constructor(t,n){this.uniformNames=n.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio||1,this.pixelRatioTo=t.pixelRatio||1,this.patternFrom=n.tl.concat(n.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,n,s,h,f){const g="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;g&&n.set(t,f,g)}getBinding(t,n){return"u_pattern_from"===n||"u_pattern_to"===n||"u_dash_from"===n||"u_dash_to"===n?new sp(t):new Wu(t)}}class Lo{constructor(t,n,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,n,s,h,f,g){const y=this.paintVertexArray.length,b=this.expression.evaluate(new q(0),n,{},f,h,g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,b)}updatePaintArray(t,n,s,h,f){const g=this.expression.evaluate({zoom:0},s,h,void 0,f);this._setPaintValue(t,n,g)}_setPaintValue(t,n,s){if("color"===this.type){const h=Yh(s);for(let f=t;f<n;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wr{constructor(t,n,s,h,f,g){this.expression=t,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,n,s,h,f,g){const y=this.expression.evaluate(new q(this.zoom),n,{},f,h,g),b=this.expression.evaluate(new q(this.zoom+1),n,{},f,h,g),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,y,b)}updatePaintArray(t,n,s,h,f){const g=this.expression.evaluate({zoom:this.zoom},s,h,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},s,h,void 0,f);this._setPaintValue(t,n,g,y)}_setPaintValue(t,n,s,h){if("color"===this.type){const f=Yh(s),g=Yh(h);for(let y=t;y<n;y++)this.paintVertexArray.emplace(y,f[0],f[1],g[0],g[1])}else{for(let f=t;f<n;f++)this.paintVertexArray.emplace(f,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n,s,h,f){const g=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=ye(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);n.set(t,f,y)}getBinding(t,n){return new Wu(t)}}class vs{constructor(t,n,s,h,f,g,y){this.expression=t,this.type=s,this.useIntegerZoom=h,this.zoom=f,this.layerId=y,this.paintVertexAttributes=("array"===s?Wf:Yf).members;for(let b=0;b<n.length;++b);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,s){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(t,n,s,h,f,g){this._setPaintValues(t,n,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(t,n,s,h){if(!h||!s)return;const{min:f,mid:g,max:y}=s,b=h[f],w=h[g],S=h[y];if(b&&w&&S)for(let E=t;E<n;E++)this._setPaintValue(this.zoomInPaintVertexArray,E,w,b),this._setPaintValue(this.zoomOutPaintVertexArray,E,w,S)}_setPaintValue(t,n,s,h){t.emplace(n,s.tl[0],s.tl[1],s.br[0],s.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],s.pixelRatio,h.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class xs{constructor(t,n,s=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const f in t.paint._values){if(!s(f))continue;const g=t.paint.get(f);if(!(g instanceof et&&tr(g.property.specification)))continue;const y=im(f,t.type),b=g.value,w=g.property.specification.type,S=g.property.useIntegerZoom,E=g.property.specification["property-type"],k="cross-faded"===E||"cross-faded-data-driven"===E,F="line-dasharray"===String(f)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==b.kind||F)if("source"===b.kind||F||k){const P=lp(f,w,"source");this.binders[f]=k?new vs(b,y,w,S,n,P,t.id):new Lo(b,y,w,P),h.push(`/a_${f}`)}else{const P=lp(f,w,"composite");this.binders[f]=new wr(b,y,w,S,n,P),h.push(`/z_${f}`)}else this.binders[f]=k?new bl(b.value,y):new Oc(b.value,y,w),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Lo||n instanceof wr?n.maxValue:0}populatePaintArrays(t,n,s,h,f,g){for(const y in this.binders){const b=this.binders[y];(b instanceof Lo||b instanceof wr||b instanceof vs)&&b.populatePaintArray(t,n,s,h,f,g)}}setConstantPatternPositions(t,n){for(const s in this.binders){const h=this.binders[s];h instanceof bl&&h.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,s,h,f,g){let y=!1;for(const b in t){const w=n.getPositions(b);for(const S of w){const E=s.feature(S.index);for(const k in this.binders){const F=this.binders[k];if((F instanceof Lo||F instanceof wr||F instanceof vs)&&!0===F.expression.isStateDependent){const P=h.paint.get(k);F.expression=P.value,F.updatePaintArray(S.start,S.end,E,t[b],f,g),y=!0}}}}return y}defines(){const t=[];for(const n in this.binders){const s=this.binders[n];(s instanceof Oc||s instanceof bl)&&t.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Lo||s instanceof wr||s instanceof vs)for(let h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Oc||s instanceof bl||s instanceof wr)for(const h of s.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const n=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Oc||h instanceof bl||h instanceof wr)for(const f of h.uniformNames)n.push({name:f,property:s,binding:h.getBinding(t,f)})}return n}setUniforms(t,n,s,h,f){for(const{name:g,property:y,binding:b}of s)this.binders[y].setUniform(t,b,f,h.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const s=this.binders[n];if(t&&s instanceof vs){const h=2===t.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof Lo||s instanceof wr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const n in this.binders){const s=this.binders[n];(s instanceof Lo||s instanceof wr||s instanceof vs)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Lo||n instanceof wr||n instanceof vs)&&n.destroy()}}}class wl{constructor(t,n,s=(()=>!0)){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new xs(h,n,s);this.needsUpload=!1,this._featureMap=new $u,this._bufferOffset=0}populatePaintArrays(t,n,s,h,f,g,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,n,h,f,g,y);void 0!==n.id&&this._featureMap.add(n.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,s,h,f){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,h,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const em={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function im(i,t){return em[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}const nm={"line-pattern":{source:Kt,composite:Kt},"fill-pattern":{source:Kt,composite:Kt},"fill-extrusion-pattern":{source:Kt,composite:Kt},"line-dasharray":{source:me,composite:me}},rm={color:{source:$r,composite:Te},number:{source:Ke,composite:$r}};function lp(i,t,n){const s=nm[i];return s&&s[n]||rm[t][n]}Jt(Oc,"ConstantBinder"),Jt(bl,"CrossFadedConstantBinder"),Jt(Lo,"SourceExpressionBinder"),Jt(vs,"CrossFadedCompositeBinder"),Jt(wr,"CompositeExpressionBinder"),Jt(xs,"ProgramConfiguration",{omit:["_buffers"]}),Jt(wl,"ProgramConfigurationSet");const Xu="-transition";class Wr extends ee{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new st(n.layout)),n.paint)){this._transitionablePaint=new J(n.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new at(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,s={}){null!=n&&this._validate(Vu,`layers.${this.id}.layout.${t}`,t,n,s)||("visibility"!==t?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return co(t,Xu)?this._transitionablePaint.getTransition(t.slice(0,-Xu.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,s={}){if(null!=n&&this._validate(ml,`layers.${this.id}.paint.${t}`,t,n,s))return!1;if(co(t,Xu))return this._transitionablePaint.setTransition(t.slice(0,-Xu.length),n||void 0),!1;{const h=this._transitionablePaint._values[t],f="cross-faded-data-driven"===h.property.specification["property-type"],g=h.value.isDataDriven(),y=h.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(t,y,b)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,n,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Or(t,(n,s)=>!(void 0===n||"layout"===s&&!Object.keys(n).length||"paint"===s&&!Object.keys(n).length))}_validate(t,n,s,h,f={}){return(!f||!1!==f.validate)&&gl(this,t.call(la,{key:n,layerType:this.type,objectKey:s,value:h,styleSpec:Ct,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof et&&tr(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ra(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const om=Et([{name:"a_pos",components:2,type:"Int16"}],4),sm=Et([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ti{constructor(t=[]){this.segments=t}prepareSegment(t,n,s,h){let f=this.segments[this.segments.length-1];return t>Ti.MAX_VERTEX_ARRAY_LENGTH&&ci(`Max vertices per segment is ${Ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>Ti.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==h&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,s,h){return new Ti([{vertexOffset:t,primitiveOffset:n,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}Ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jt(Ti,"SegmentVector");var ce=8192;class bs{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof qe?new qe(t.lng,t.lat):qe.convert(t),this}setSouthWest(t){return this._sw=t instanceof qe?new qe(t.lng,t.lat):qe.convert(t),this}extend(t){const n=this._sw,s=this._ne;let h,f;if(t instanceof qe)h=t,f=t;else{if(!(t instanceof bs))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(bs.convert(t)):this.extend(qe.convert(t)):this;if(h=t._sw,f=t._ne,!h||!f)return this}return n||s?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new qe(h.lng,h.lat),this._ne=new qe(f.lng,f.lat)),this}getCenter(){return new qe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qe(this.getWest(),this.getNorth())}getSouthEast(){return new qe(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:s}=qe.convert(t);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(t){return!t||t instanceof bs?t:new bs(t)}}const Wh=6371008.8;class qe{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qe(Dr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,s=this.lat*n,h=t.lat*n,f=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*n);return Wh*Math.acos(Math.min(f,1))}toBounds(t=0){const n=360*t/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new bs(new qe(this.lng-s,this.lat-n),new qe(this.lng+s,this.lat+n))}static convert(t){if(t instanceof qe)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new qe(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new qe(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const cp=2*Math.PI*Wh;function up(i){return cp*Math.cos(i*Math.PI/180)}function Xr(i){return(180+i)/360}function Ro(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function rr(i,t){return i/up(t)}function or(i){return 360*i-180}function Yi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function hp(i,t){return i*up(Yi(t))}const Jr=85.051129;function am(i){return 1/Math.cos(i*Math.PI/180)}class Cl{constructor(t,n,s=0){this.x=+t,this.y=+n,this.z=+s}static fromLngLat(t,n=0){const s=qe.convert(t);return new Cl(Xr(s.lng),Ro(s.lat),rr(n,s.lat))}toLngLat(){return new qe(or(this.x),Yi(this.y))}toAltitude(){return hp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/cp*am(Yi(this.y))}}function Xh(i,t,n,s,h,f,g,y,b){const w=(t+s)/2,S=(n+h)/2,E=new jt(w,S);y(E),function(k,F,P,B,N,X){const it=P-N,K=B-X;return Math.abs((B-F)*it-(P-k)*K)/Math.hypot(it,K)}(E.x,E.y,f.x,f.y,g.x,g.y)>=b?(Xh(i,t,n,w,S,f,E,y,b),Xh(i,w,S,s,h,E,g,y,b)):i.push(g)}function dp(i,t,n){let s=i[0],h=s.x,f=s.y;t(s);const g=[s];for(let y=1;y<i.length;y++){const b=i[y],{x:w,y:S}=b;t(b),Xh(g,h,f,w,S,s,b,t,n),h=w,f=S,s=b}return g}function Jh(i,t,n,s,h){if(h(t,n)){const f=t.add(n).mult(.5);s(f),Jh(i,t,f,s,h),Jh(i,f,n,s,h)}else i.push(n)}function lm(i,t,n){let s=i[0];t(s);const h=[s];for(let f=1;f<i.length;f++){const g=i[f];t(g),Jh(h,s,g,t,n),s=g}return h}const Kh=Math.pow(2,14)-1,cm=-Kh-1;function um(i,t){const n=Math.round(i.x*t),s=Math.round(i.y*t);return i.x=ye(n,cm,Kh),i.y=ye(s,cm,Kh),(n<i.x||n>i.x+1||s<i.y||s>i.y+1)&&ci("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function zo(i,t,n){const s=i.loadGeometry(),h=i.extent,f=ce/h;if(t&&n&&n.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:y,x:b,y:w,projection:S}=n,E=k=>{const F=or((t.x+k.x/h)/g),P=Yi((t.y+k.y/h)/g),B=S.project(F,P);k.x=(B.x*y-b)*h,k.y=(B.y*y-w)*h};for(let k=0;k<s.length;k++)if(1!==i.type)s[k]=dp(s[k],E,1);else{const F=[];for(const P of s[k])P.x<0||P.x>=h||P.y<0||P.y>=h||(E(P),F.push(P));s[k]=F}}for(const g of s)for(const y of g)um(y,f);return s}function ws(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?zo(i):[]}}function Ju(i,t,n,s,h){i.emplaceBack(2*t+(s+1)/2,2*n+(h+1)/2)}function Ku(i,t,n){i.emplaceBack(t.x,t.y,t.z,16384*n[0],16384*n[1],16384*n[2])}class Qh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Ut,this.indexArray=new Me,this.segments=new Ti,this.programConfigurations=new wl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,s,h){const f=this.layers[0],g=[];let y=null;"circle"===f.type&&(y=f.layout.get("circle-sort-key"));for(const{feature:w,id:S,index:E,sourceLayerIndex:k}of t){const F=this.layers[0]._featureFilter.needGeometry,P=ws(w,F);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),P,s))continue;const B=y?y.evaluate(P,{},s):void 0,N={id:S,properties:w.properties,type:w.type,sourceLayerIndex:k,index:E,geometry:F?P.geometry:zo(w,s,h),patterns:{},sortKey:B};g.push(N)}y&&g.sort((w,S)=>w.sortKey-S.sortKey);let b=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new $f,b=h.projection);for(const w of g){const{geometry:S,index:E,sourceLayerIndex:k}=w,F=t[E].feature;this.addFeature(w,S,E,n.availableImages,s,b),n.featureIndex.insert(F,S,E,k,this.index)}}update(t,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,om.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,sm.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,n,s,h,f,g){for(const y of n)for(const b of y){const w=b.x,S=b.y;if(w<0||w>=ce||S<0||S>=ce)continue;if(g){const F=g.projectTilePoint(w,S,f),P=g.upVector(f,w,S),B=this.globeExtVertexArray;Ku(B,F,P),Ku(B,F,P),Ku(B,F,P),Ku(B,F,P)}const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),k=E.vertexLength;Ju(this.layoutVertexArray,w,S,-1,-1),Ju(this.layoutVertexArray,w,S,1,-1),Ju(this.layoutVertexArray,w,S,1,1),Ju(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h,f)}}function pp(i,t){for(let n=0;n<i.length;n++)if(ga(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(ga(i,t[n]))return!0;return!!fp(i,t)}function hm(i,t,n){return!!ga(i,t)||!!gp(t,i,n)}function dm(i,t){if(1===i.length)return Ml(t,i[0]);for(let n=0;n<t.length;n++){const s=t[n];for(let h=0;h<s.length;h++)if(ga(i,s[h]))return!0}for(let n=0;n<i.length;n++)if(Ml(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(fp(i,t[n]))return!0;return!1}function Wg(i,t,n){if(i.length>1){if(fp(i,t))return!0;for(let s=0;s<t.length;s++)if(gp(t[s],i,n))return!0}for(let s=0;s<i.length;s++)if(gp(i[s],t,n))return!0;return!1}function fp(i,t){if(0===i.length||0===t.length)return!1;for(let n=0;n<i.length-1;n++){const s=i[n],h=i[n+1];for(let f=0;f<t.length-1;f++)if(mp(s,h,t[f],t[f+1]))return!0}return!1}function mp(i,t,n,s){return Vi(i,n,s)!==Vi(t,n,s)&&Vi(i,t,n)!==Vi(i,t,s)}function gp(i,t,n){const s=n*n;if(1===t.length)return i.distSqr(t[0])<s;for(let h=1;h<t.length;h++)if(_p(i,t[h-1],t[h])<s)return!0;return!1}function _p(i,t,n){const s=t.distSqr(n);if(0===s)return i.distSqr(t);const h=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/s;return i.distSqr(h<0?t:h>1?n:n.sub(t)._mult(h)._add(t))}function Ml(i,t){let n,s,h,f=!1;for(let g=0;g<i.length;g++){n=i[g];for(let y=0,b=n.length-1;y<n.length;b=y++)s=n[y],h=n[b],s.y>t.y!=h.y>t.y&&t.x<(h.x-s.x)*(t.y-s.y)/(h.y-s.y)+s.x&&(f=!f)}return f}function ga(i,t){let n=!1;for(let s=0,h=i.length-1;s<i.length;h=s++){const f=i[s],g=i[h];f.y>t.y!=g.y>t.y&&t.x<(g.x-f.x)*(t.y-f.y)/(g.y-f.y)+f.x&&(n=!n)}return n}function yp(i,t,n,s,h){for(const g of i)if(t<=g.x&&n<=g.y&&s>=g.x&&h>=g.y)return!0;const f=[new jt(t,n),new jt(t,h),new jt(s,h),new jt(s,n)];if(i.length>2)for(const g of f)if(ga(i,g))return!0;for(let g=0;g<i.length-1;g++)if(pm(i[g],i[g+1],f))return!0;return!1}function pm(i,t,n){const s=n[0],h=n[2];if(i.x<s.x&&t.x<s.x||i.x>h.x&&t.x>h.x||i.y<s.y&&t.y<s.y||i.y>h.y&&t.y>h.y)return!1;const f=Vi(i,t,n[0]);return f!==Vi(i,t,n[1])||f!==Vi(i,t,n[2])||f!==Vi(i,t,n[3])}function _a(i,t,n){const s=t.paint.get(i).value;return"constant"===s.kind?s.value:n.programConfigurations.get(t.id).getMaxValue(i)}function Qu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function vp(i,t,n,s,h){if(!t[0]&&!t[1])return i;const f=jt.convert(t)._mult(h);"viewport"===n&&f._rotate(-s);const g=[];for(let y=0;y<i.length;y++)g.push(i[y].sub(f));return g}function Kr(i,t,n,s){const h=jt.convert(i)._mult(s);return"viewport"===t&&h._rotate(-n),h}Jt(Qh,"CircleBucket",{omit:["layers"]});const Dn=new At({"circle-sort-key":new dt(Ct.layout_circle["circle-sort-key"])});var xp={paint:new At({"circle-radius":new dt(Ct.paint_circle["circle-radius"]),"circle-color":new dt(Ct.paint_circle["circle-color"]),"circle-blur":new dt(Ct.paint_circle["circle-blur"]),"circle-opacity":new dt(Ct.paint_circle["circle-opacity"]),"circle-translate":new rt(Ct.paint_circle["circle-translate"]),"circle-translate-anchor":new rt(Ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rt(Ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rt(Ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dt(Ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dt(Ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dt(Ct.paint_circle["circle-stroke-opacity"])}),layout:Dn},Al=1e-6,Mn=typeof Float32Array<"u"?Float32Array:Array;function Sl(){var i=new Mn(9);return Mn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function An(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function th(i,t){var n=t[0],s=t[1],h=t[2],f=t[3],g=t[4],y=t[5],b=t[6],w=t[7],S=t[8],E=t[9],k=t[10],F=t[11],P=t[12],B=t[13],N=t[14],X=t[15],it=n*y-s*g,K=n*b-h*g,tt=n*w-f*g,ct=s*b-h*y,nt=s*w-f*y,ft=h*w-f*b,vt=S*B-E*P,Mt=S*N-k*P,Pt=S*X-F*P,bt=E*N-k*B,St=E*X-F*B,Ot=k*X-F*N,Tt=it*Ot-K*St+tt*bt+ct*Pt-nt*Mt+ft*vt;return Tt?(i[0]=(y*Ot-b*St+w*bt)*(Tt=1/Tt),i[1]=(h*St-s*Ot-f*bt)*Tt,i[2]=(B*ft-N*nt+X*ct)*Tt,i[3]=(k*nt-E*ft-F*ct)*Tt,i[4]=(b*Pt-g*Ot-w*Mt)*Tt,i[5]=(n*Ot-h*Pt+f*Mt)*Tt,i[6]=(N*tt-P*ft-X*K)*Tt,i[7]=(S*ft-k*tt+F*K)*Tt,i[8]=(g*St-y*Pt+w*vt)*Tt,i[9]=(s*Pt-n*St-f*vt)*Tt,i[10]=(P*nt-B*tt+X*it)*Tt,i[11]=(E*tt-S*nt-F*it)*Tt,i[12]=(y*Mt-g*bt-b*vt)*Tt,i[13]=(n*bt-s*Mt+h*vt)*Tt,i[14]=(B*K-P*ct-N*it)*Tt,i[15]=(S*ct-E*K+k*it)*Tt,i):null}function Tl(i,t,n){var s=t[0],h=t[1],f=t[2],g=t[3],y=t[4],b=t[5],w=t[6],S=t[7],E=t[8],k=t[9],F=t[10],P=t[11],B=t[12],N=t[13],X=t[14],it=t[15],K=n[0],tt=n[1],ct=n[2],nt=n[3];return i[0]=K*s+tt*y+ct*E+nt*B,i[1]=K*h+tt*b+ct*k+nt*N,i[2]=K*f+tt*w+ct*F+nt*X,i[3]=K*g+tt*S+ct*P+nt*it,i[4]=(K=n[4])*s+(tt=n[5])*y+(ct=n[6])*E+(nt=n[7])*B,i[5]=K*h+tt*b+ct*k+nt*N,i[6]=K*f+tt*w+ct*F+nt*X,i[7]=K*g+tt*S+ct*P+nt*it,i[8]=(K=n[8])*s+(tt=n[9])*y+(ct=n[10])*E+(nt=n[11])*B,i[9]=K*h+tt*b+ct*k+nt*N,i[10]=K*f+tt*w+ct*F+nt*X,i[11]=K*g+tt*S+ct*P+nt*it,i[12]=(K=n[12])*s+(tt=n[13])*y+(ct=n[14])*E+(nt=n[15])*B,i[13]=K*h+tt*b+ct*k+nt*N,i[14]=K*f+tt*w+ct*F+nt*X,i[15]=K*g+tt*S+ct*P+nt*it,i}function Fc(i,t,n){var s,h,f,g,y,b,w,S,E,k,F,P,B=n[0],N=n[1],X=n[2];return t===i?(i[12]=t[0]*B+t[4]*N+t[8]*X+t[12],i[13]=t[1]*B+t[5]*N+t[9]*X+t[13],i[14]=t[2]*B+t[6]*N+t[10]*X+t[14],i[15]=t[3]*B+t[7]*N+t[11]*X+t[15]):(h=t[1],f=t[2],g=t[3],y=t[4],b=t[5],w=t[6],S=t[7],E=t[8],k=t[9],F=t[10],P=t[11],i[0]=s=t[0],i[1]=h,i[2]=f,i[3]=g,i[4]=y,i[5]=b,i[6]=w,i[7]=S,i[8]=E,i[9]=k,i[10]=F,i[11]=P,i[12]=s*B+y*N+E*X+t[12],i[13]=h*B+b*N+k*X+t[13],i[14]=f*B+w*N+F*X+t[14],i[15]=g*B+S*N+P*X+t[15]),i}function ya(i,t,n){var s=n[0],h=n[1],f=n[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*h,i[5]=t[5]*h,i[6]=t[6]*h,i[7]=t[7]*h,i[8]=t[8]*f,i[9]=t[9]*f,i[10]=t[10]*f,i[11]=t[11]*f,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function td(i,t,n){var s=Math.sin(n),h=Math.cos(n),f=t[4],g=t[5],y=t[6],b=t[7],w=t[8],S=t[9],E=t[10],k=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=f*h+w*s,i[5]=g*h+S*s,i[6]=y*h+E*s,i[7]=b*h+k*s,i[8]=w*h-f*s,i[9]=S*h-g*s,i[10]=E*h-y*s,i[11]=k*h-b*s,i}function eh(i,t,n){var s=Math.sin(n),h=Math.cos(n),f=t[0],g=t[1],y=t[2],b=t[3],w=t[8],S=t[9],E=t[10],k=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*h-w*s,i[1]=g*h-S*s,i[2]=y*h-E*s,i[3]=b*h-k*s,i[8]=f*s+w*h,i[9]=g*s+S*h,i[10]=y*s+E*h,i[11]=b*s+k*h,i}function bp(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function sr(i,t,n){var s,h,f,g=n[0],y=n[1],b=n[2],w=Math.hypot(g,y,b);return w<Al?null:(g*=w=1/w,y*=w,b*=w,s=Math.sin(t),h=Math.cos(t),i[0]=g*g*(f=1-h)+h,i[1]=y*g*f+b*s,i[2]=b*g*f-y*s,i[3]=0,i[4]=g*y*f-b*s,i[5]=y*y*f+h,i[6]=b*y*f+g*s,i[7]=0,i[8]=g*b*f+y*s,i[9]=y*b*f-g*s,i[10]=b*b*f+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var ih=Tl;function ed(){var i=new Mn(3);return Mn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function nh(i){var t=new Mn(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function El(i){return Math.hypot(i[0],i[1],i[2])}function kl(i,t,n){var s=new Mn(3);return s[0]=i,s[1]=t,s[2]=n,s}function Cs(i,t,n){return i[0]=t[0]+n[0],i[1]=t[1]+n[1],i[2]=t[2]+n[2],i}function Pc(i,t,n){return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],i}function wp(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i}function id(i,t,n){return i[0]=Math.min(t[0],n[0]),i[1]=Math.min(t[1],n[1]),i[2]=Math.min(t[2],n[2]),i}function nd(i,t,n){return i[0]=Math.max(t[0],n[0]),i[1]=Math.max(t[1],n[1]),i[2]=Math.max(t[2],n[2]),i}function Cr(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i}function rh(i,t,n,s){return i[0]=t[0]+n[0]*s,i[1]=t[1]+n[1]*s,i[2]=t[2]+n[2]*s,i}function dn(i,t){var n=t[0],s=t[1],h=t[2],f=n*n+s*s+h*h;return f>0&&(f=1/Math.sqrt(f)),i[0]=t[0]*f,i[1]=t[1]*f,i[2]=t[2]*f,i}function ar(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function rd(i,t,n){var s=t[0],h=t[1],f=t[2],g=n[0],y=n[1],b=n[2];return i[0]=h*b-f*y,i[1]=f*g-s*b,i[2]=s*y-h*g,i}function Ii(i,t,n){var s=t[0],h=t[1],f=t[2],g=n[3]*s+n[7]*h+n[11]*f+n[15];return i[0]=(n[0]*s+n[4]*h+n[8]*f+n[12])/(g=g||1),i[1]=(n[1]*s+n[5]*h+n[9]*f+n[13])/g,i[2]=(n[2]*s+n[6]*h+n[10]*f+n[14])/g,i}function Cp(i,t,n){var s=n[0],h=n[1],f=n[2],g=t[0],y=t[1],b=t[2],w=h*b-f*y,S=f*g-s*b,E=s*y-h*g,k=h*E-f*S,F=f*w-s*E,P=s*S-h*w,B=2*n[3];return S*=B,E*=B,F*=2,P*=2,i[0]=g+(w*=B)+(k*=2),i[1]=y+S+F,i[2]=b+E+P,i}var Lc,Mr=Pc,fm=wp,mm=El;function Mp(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i}function va(i,t,n){var s=t[0],h=t[1],f=t[2],g=t[3];return i[0]=n[0]*s+n[4]*h+n[8]*f+n[12]*g,i[1]=n[1]*s+n[5]*h+n[9]*f+n[13]*g,i[2]=n[2]*s+n[6]*h+n[10]*f+n[14]*g,i[3]=n[3]*s+n[7]*h+n[11]*f+n[15]*g,i}function Ms(){var i=new Mn(4);return Mn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Rc(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function zc(i,t,n){n*=.5;var s=t[0],h=t[1],f=t[2],g=t[3],y=Math.sin(n),b=Math.cos(n);return i[0]=s*b+g*y,i[1]=h*b+f*y,i[2]=f*b-h*y,i[3]=g*b-s*y,i}function od(i,t,n){n*=.5;var s=t[0],h=t[1],f=t[2],g=t[3],y=Math.sin(n),b=Math.cos(n);return i[0]=s*b-f*y,i[1]=h*b+g*y,i[2]=f*b+s*y,i[3]=g*b-h*y,i}ed(),Lc=new Mn(4),Mn!=Float32Array&&(Lc[0]=0,Lc[1]=0,Lc[2]=0,Lc[3]=0),ed(),kl(1,0,0),kl(0,1,0),Ms(),Ms(),Sl();class Bc{constructor(t,n){this.pos=t,this.dir=n}intersectsPlane(t,n,s){const h=ar(n,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((t[0]-this.pos[0])*n[0]+(t[1]-this.pos[1])*n[1]+(t[2]-this.pos[2])*n[2])/h;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(t,n,s){if(B=(F=this.pos)[0],N=F[1],X=F[2],it=(P=t)[0],K=P[1],tt=P[2],Math.abs(B-it)<=Al*Math.max(1,Math.abs(B),Math.abs(it))&&Math.abs(N-K)<=Al*Math.max(1,Math.abs(N),Math.abs(K))&&Math.abs(X-tt)<=Al*Math.max(1,Math.abs(X),Math.abs(tt))||0===n)return s[0]=s[1]=s[2]=0,!1;var F,P,B,N,X,it,K,tt;const[h,f,g]=this.dir,y=this.pos[0]-t[0],b=this.pos[1]-t[1],w=this.pos[2]-t[2],S=h*h+f*f+g*g,E=2*(y*h+b*f+w*g),k=E*E-4*S*(y*y+b*b+w*w-n*n);if(k<0){const F=Math.max(-E/2,0),P=y+h*F,B=b+f*F,N=w+g*F,X=Math.hypot(P,B,N);return s[0]=P*n/X,s[1]=B*n/X,s[2]=N*n/X,!1}{const F=(-E-Math.sqrt(k))/(2*S);if(F<0){const P=Math.hypot(y,b,w);return s[0]=y*n/P,s[1]=b*n/P,s[2]=w*n/P,!1}return s[0]=y+h*F,s[1]=b+f*F,s[2]=w+g*F,!0}}}class oh{constructor(t,n,s,h,f){this.TL=t,this.TR=n,this.BR=s,this.BL=h,this.horizon=f}static fromInvProjectionMatrix(t,n,s){const h=[-1,1,1],f=[1,1,1],g=[1,-1,1],y=[-1,-1,1],b=Ii(h,h,t),w=Ii(f,f,t),S=Ii(g,g,t),E=Ii(y,y,t);return new oh(b,w,S,E,n/s)}}class Ap{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,s,h){const f=Math.pow(2,s),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const w=va([],b,t),S=1/w[3]/n*f;return(E=w)[0]=(k=w)[0]*(F=[S,S,h?1/w[3]:S,S])[0],E[1]=k[1]*F[1],E[2]=k[2]*F[2],E[3]=k[3]*F[3],E;var E,k,F}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const w=dn([],rd([],Mr([],g[b[0]],g[b[1]]),Mr([],g[b[2]],g[b[1]]))),S=-ar(w,g[b[1]]);return w.concat(S)});return new Ap(g,y)}}class In{static fromPoints(t){const n=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],s=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const h of t)n[0]=Math.min(n[0],h[0]),n[1]=Math.min(n[1],h[1]),n[2]=Math.min(n[2],h[2]),s[0]=Math.max(s[0],h[0]),s[1]=Math.max(s[1],h[1]),s[2]=Math.max(s[2],h[2]);return new In(n,s)}constructor(t,n){this.min=t,this.max=n,this.center=Cr([],Cs([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],s=nh(this.min),h=nh(this.max);for(let f=0;f<n.length;f++)s[f]=n[f]?this.min[f]:this.center[f],h[f]=n[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new In(s,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,n=this.max;return[[t[0],t[1],t[2]],[n[0],t[1],t[2]],[n[0],n[1],t[2]],[t[0],n[1],t[2]],[t[0],t[1],n[2]],[n[0],t[1],n[2]],[n[0],n[1],n[2]],[t[0],n[1],n[2]]]}intersects(t){const n=this.getCorners();let s=!0;for(let h=0;h<t.planes.length;h++){const f=t.planes[h];let g=0;for(let y=0;y<n.length;y++)g+=ar(f,n[y])+f[3]>=0;if(0===g)return 0;g!==n.length&&(s=!1)}if(s)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let y=0;y<t.points.length;y++){const b=t.points[y][h]-this.min[h];f=Math.min(f,b),g=Math.max(g,b)}if(g<0||f>this.max[h]-this.min[h])return 0}return 1}}function Sp(i,t,n,s,h,f,g,y,b){if(f&&i.queryGeometry.isAboveHorizon)return!1;f&&(b*=i.pixelToTileUnitsFactor);const w=i.tileID.canonical,S=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(const E of t)for(const k of E){const F=k.add(y),P=h&&n.elevation?n.elevation.exaggeration()*h.getElevationAt(F.x,F.y,!0):0,B=n.projection.projectTilePoint(F.x,F.y,w);if(P>0){const K=n.projection.upVector(w,F.x,F.y);B.x+=K[0]*S*P,B.y+=K[1]*S*P,B.z+=K[2]*S*P}const N=f?F:Xg(B.x,B.y,B.z,s),X=f?i.tilespaceRays.map(K=>gm(K,P)):i.queryGeometry.screenGeometry,it=va([],[B.x,B.y,B.z,1],s);if(!g&&f?b*=it[3]/n.cameraToCenterDistance:g&&!f&&(b*=n.cameraToCenterDistance/it[3]),f){const K=Yi((k.y/ce+w.y)/(1<<w.z));b/=n.projection.pixelsPerMeter(K,1)/rr(1,K)}if(hm(X,N,b))return!0}return!1}function Xg(i,t,n,s){const h=va([],[i,t,n,1],s);return new jt(h[0]/h[3],h[1]/h[3])}const xa=kl(0,0,0),Tp=kl(0,0,1);function gm(i,t){const n=ed();return xa[2]=t,i.intersectsPlane(xa,Tp,n),new jt(n[0],n[1])}class Ep extends Qh{}function kp(i,{width:t,height:n},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*n*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*n*s);return i.width=t,i.height=n,i.data=h,i}function Dp(i,t,n){const{width:s,height:h}=t;s===i.width&&h===i.height||(sd(i,t,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,s),height:Math.min(i.height,h)},n),i.width=s,i.height=h,i.data=t.data)}function sd(i,t,n,s,h,f){if(0===h.width||0===h.height)return t;if(h.width>i.width||h.height>i.height||n.x>i.width-h.width||n.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||s.x>t.width-h.width||s.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,y=t.data;for(let b=0;b<h.height;b++){const w=((n.y+b)*i.width+n.x)*f,S=((s.y+b)*t.width+s.x)*f;for(let E=0;E<h.width*f;E++)y[S+E]=g[w+E]}return t}Jt(Ep,"HeatmapBucket",{omit:["layers"]});class Bo{constructor(t,n){kp(this,t,1,n)}resize(t){Dp(this,new Bo(t),1)}clone(){return new Bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,s,h,f){sd(t,n,s,h,f,1)}}class On{constructor(t,n){kp(this,t,4,n)}resize(t){Dp(this,new On(t),4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new On({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,s,h,f){sd(t,n,s,h,f,4)}}Jt(Bo,"AlphaImage"),Jt(On,"RGBAImage");var _m={paint:new At({"heatmap-radius":new dt(Ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dt(Ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rt(Ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gt(Ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rt(Ct.paint_heatmap["heatmap-opacity"])})};function Ip(i){const t={},n=i.resolution||256,s=i.clips?i.clips.length:1,h=i.image||new On({width:n,height:s}),f=(g,y,b)=>{t[i.evaluationKey]=b;const w=i.expression.evaluate(t);h.data[g+y+0]=Math.floor(255*w.r/w.a),h.data[g+y+1]=Math.floor(255*w.g/w.a),h.data[g+y+2]=Math.floor(255*w.b/w.a),h.data[g+y+3]=Math.floor(255*w.a)};if(i.clips)for(let g=0,y=0;g<s;++g,y+=4*n)for(let b=0,w=0;b<n;b++,w+=4){const S=b/(n-1),{start:E,end:k}=i.clips[g];f(y,w,E*(1-S)+k*S)}else for(let g=0,y=0;g<n;g++,y+=4)f(0,y,g/(n-1));return h}var ym={paint:new At({"hillshade-illumination-direction":new rt(Ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new rt(Ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rt(Ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rt(Ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rt(Ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rt(Ct.paint_hillshade["hillshade-accent-color"])})};const Qr=Et([{name:"a_pos",components:2,type:"Int16"}],4),{members:Op}=Qr;var ba=sh,vm=sh;function sh(i,t,n){n=n||2;var s,h,f,g,y,b,w,S=t&&t.length,E=S?t[0]*n:i.length,k=Fp(i,0,E,n,!0),F=[];if(!k||k.next===k.prev)return F;if(S&&(k=function(B,N,X,it){var K,tt,ct,nt=[];for(K=0,tt=N.length;K<tt;K++)(ct=Fp(B,N[K]*it,K<tt-1?N[K+1]*it:B.length,it,!1))===ct.next&&(ct.steiner=!0),nt.push(Am(ct));for(nt.sort(wm),K=0;K<nt.length;K++)X=Cm(nt[K],X);return X}(i,t,k,n)),i.length>80*n){s=f=i[0],h=g=i[1];for(var P=n;P<E;P+=n)(y=i[P])<s&&(s=y),(b=i[P+1])<h&&(h=b),y>f&&(f=y),b>g&&(g=b);w=0!==(w=Math.max(f-s,g-h))?32767/w:0}return Dl(k,F,n,s,h,w,0),F}function Fp(i,t,n,s,h){var f,g;if(h===Ol(i,t,n,s)>0)for(f=t;f<n;f+=s)g=cd(f,i[f],i[f+1],g);else for(f=n-s;f>=t;f-=s)g=cd(f,i[f],i[f+1],g);return g&&lh(g,g.next)&&(Go(g),g=g.next),g}function As(i,t){if(!i)return i;t||(t=i);var n,s=i;do{if(n=!1,s.steiner||!lh(s,s.next)&&0!==Ei(s.prev,s,s.next))s=s.next;else{if(Go(s),(s=t=s.prev)===s.next)break;n=!0}}while(n||s!==t);return t}function Dl(i,t,n,s,h,f,g){if(i){!g&&f&&function(S,E,k,F){var P=S;do{0===P.z&&(P.z=ad(P.x,P.y,E,k,F)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next}while(P!==S);P.prevZ.nextZ=null,P.prevZ=null,function(B){var N,X,it,K,tt,ct,nt,ft,vt=1;do{for(X=B,B=null,tt=null,ct=0;X;){for(ct++,it=X,nt=0,N=0;N<vt&&(nt++,it=it.nextZ);N++);for(ft=vt;nt>0||ft>0&&it;)0!==nt&&(0===ft||!it||X.z<=it.z)?(K=X,X=X.nextZ,nt--):(K=it,it=it.nextZ,ft--),tt?tt.nextZ=K:B=K,K.prevZ=tt,tt=K;X=it}tt.nextZ=null,vt*=2}while(ct>1)}(P)}(i,s,h,f);for(var y,b,w=i;i.prev!==i.next;)if(y=i.prev,b=i.next,f?bm(i,s,h,f):xm(i))t.push(y.i/n|0),t.push(i.i/n|0),t.push(b.i/n|0),Go(i),i=b.next,w=b.next;else if((i=b)===w){g?1===g?Dl(i=ah(As(i),t,n),t,n,s,h,f,2):2===g&&Zn(i,t,n,s,h,f):Dl(As(i),t,n,s,h,f,1);break}}}function xm(i){var t=i.prev,n=i,s=i.next;if(Ei(t,n,s)>=0)return!1;for(var h=t.x,f=n.x,g=s.x,y=t.y,b=n.y,w=s.y,S=h<f?h<g?h:g:f<g?f:g,E=y<b?y<w?y:w:b<w?b:w,k=h>f?h>g?h:g:f>g?f:g,F=y>b?y>w?y:w:b>w?b:w,P=s.next;P!==t;){if(P.x>=S&&P.x<=k&&P.y>=E&&P.y<=F&&Il(h,y,f,b,g,w,P.x,P.y)&&Ei(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function bm(i,t,n,s){var h=i.prev,f=i,g=i.next;if(Ei(h,f,g)>=0)return!1;for(var y=h.x,b=f.x,w=g.x,S=h.y,E=f.y,k=g.y,F=y<b?y<w?y:w:b<w?b:w,P=S<E?S<k?S:k:E<k?E:k,B=y>b?y>w?y:w:b>w?b:w,N=S>E?S>k?S:k:E>k?E:k,X=ad(F,P,t,n,s),it=ad(B,N,t,n,s),K=i.prevZ,tt=i.nextZ;K&&K.z>=X&&tt&&tt.z<=it;){if(K.x>=F&&K.x<=B&&K.y>=P&&K.y<=N&&K!==h&&K!==g&&Il(y,S,b,E,w,k,K.x,K.y)&&Ei(K.prev,K,K.next)>=0||(K=K.prevZ,tt.x>=F&&tt.x<=B&&tt.y>=P&&tt.y<=N&&tt!==h&&tt!==g&&Il(y,S,b,E,w,k,tt.x,tt.y)&&Ei(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;K&&K.z>=X;){if(K.x>=F&&K.x<=B&&K.y>=P&&K.y<=N&&K!==h&&K!==g&&Il(y,S,b,E,w,k,K.x,K.y)&&Ei(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;tt&&tt.z<=it;){if(tt.x>=F&&tt.x<=B&&tt.y>=P&&tt.y<=N&&tt!==h&&tt!==g&&Il(y,S,b,E,w,k,tt.x,tt.y)&&Ei(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function ah(i,t,n){var s=i;do{var h=s.prev,f=s.next.next;!lh(h,f)&&ch(h,s,s.next,f)&&to(h,f)&&to(f,h)&&(t.push(h.i/n|0),t.push(s.i/n|0),t.push(f.i/n|0),Go(s),Go(s.next),s=i=f),s=s.next}while(s!==i);return As(s)}function Zn(i,t,n,s,h,f){var g=i;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&Sm(g,y)){var b=ld(g,y);return g=As(g,g.next),b=As(b,b.next),Dl(g,t,n,s,h,f,0),void Dl(b,t,n,s,h,f,0)}y=y.next}g=g.next}while(g!==i)}function wm(i,t){return i.x-t.x}function Cm(i,t){var n=function(h,f){var g,y=f,b=h.x,w=h.y,S=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var E=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(E<=b&&E>S&&(S=E,g=y.x<y.next.x?y:y.next,E===b))return g}y=y.next}while(y!==f);if(!g)return null;var k,F=g,P=g.x,B=g.y,N=1/0;y=g;do{b>=y.x&&y.x>=P&&b!==y.x&&Il(w<B?b:S,w,P,B,w<B?S:b,w,y.x,y.y)&&(k=Math.abs(w-y.y)/(b-y.x),to(y,h)&&(k<N||k===N&&(y.x>g.x||y.x===g.x&&Mm(g,y)))&&(g=y,N=k)),y=y.next}while(y!==F);return g}(i,t);if(!n)return t;var s=ld(n,i);return As(s,s.next),As(n,n.next)}function Mm(i,t){return Ei(i.prev,i,t.prev)<0&&Ei(t.next,i,i.next)<0}function ad(i,t,n,s,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Am(i){var t=i,n=i;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==i);return n}function Il(i,t,n,s,h,f,g,y){return(h-g)*(t-y)>=(i-g)*(f-y)&&(i-g)*(s-y)>=(n-g)*(t-y)&&(n-g)*(f-y)>=(h-g)*(s-y)}function Sm(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,s){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==s.i&&h.next.i!==s.i&&ch(h,h.next,n,s))return!0;h=h.next}while(h!==n);return!1}(i,t)&&(to(i,t)&&to(t,i)&&function(n,s){var h=n,f=!1,g=(n.x+s.x)/2,y=(n.y+s.y)/2;do{h.y>y!=h.next.y>y&&h.next.y!==h.y&&g<(h.next.x-h.x)*(y-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next}while(h!==n);return f}(i,t)&&(Ei(i.prev,i,t.prev)||Ei(i,t.prev,t))||lh(i,t)&&Ei(i.prev,i,i.next)>0&&Ei(t.prev,t,t.next)>0)}function Ei(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function lh(i,t){return i.x===t.x&&i.y===t.y}function ch(i,t,n,s){var h=Vo(Ei(i,t,n)),f=Vo(Ei(i,t,s)),g=Vo(Ei(n,s,i)),y=Vo(Ei(n,s,t));return h!==f&&g!==y||!(0!==h||!Ye(i,n,t))||!(0!==f||!Ye(i,s,t))||!(0!==g||!Ye(n,i,s))||!(0!==y||!Ye(n,t,s))}function Ye(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function Vo(i){return i>0?1:i<0?-1:0}function to(i,t){return Ei(i.prev,i,i.next)<0?Ei(i,t,i.next)>=0&&Ei(i,i.prev,t)>=0:Ei(i,t,i.prev)<0||Ei(i,i.next,t)<0}function ld(i,t){var n=new ud(i.i,i.x,i.y),s=new ud(t.i,t.x,t.y),h=i.next,f=t.prev;return i.next=t,t.prev=i,n.next=h,h.prev=n,s.next=n,n.prev=s,f.next=s,s.prev=f,s}function cd(i,t,n,s){var h=new ud(i,t,n);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Go(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ud(i,t,n){this.i=i,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ol(i,t,n,s){for(var h=0,f=t,g=n-s;f<n;f+=s)h+=(i[g]-i[f])*(i[f+1]+i[g+1]),g=f;return h}function uh(i,t,n,s,h){Ss(i,t,n||0,s||i.length-1,h||Vc)}function Ss(i,t,n,s,h){for(;s>n;){if(s-n>600){var f=s-n+1,g=t-n+1,y=Math.log(f),b=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*b*(f-b)/f)*(g-f/2<0?-1:1);Ss(i,t,Math.max(n,Math.floor(t-g*b/f+w)),Math.min(s,Math.floor(t+(f-g)*b/f+w)),h)}var S=i[t],E=n,k=s;for(Fl(i,n,t),h(i[s],S)>0&&Fl(i,n,s);E<k;){for(Fl(i,E,k),E++,k--;h(i[E],S)<0;)E++;for(;h(i[k],S)>0;)k--}0===h(i[n],S)?Fl(i,n,k):Fl(i,++k,s),k<=t&&(n=k+1),t<=k&&(s=k-1)}}function Fl(i,t,n){var s=i[t];i[t]=i[n],i[n]=s}function Vc(i,t){return i<t?-1:i>t?1:0}function Gc(i,t){const n=i.length;if(n<=1)return[i];const s=[];let h,f;for(let g=0;g<n;g++){const y=$n(i[g]);0!==y&&(i[g].area=Math.abs(y),void 0===f&&(f=y<0),f===y<0?(h&&s.push(h),h=[i[g]]):h.push(i[g]))}if(h&&s.push(h),t>1)for(let g=0;g<s.length;g++)s[g].length<=t||(uh(s[g],t,1,s[g].length-1,Tm),s[g]=s[g].slice(0,t));return s}function Tm(i,t){return t.area-i.area}function hd(i,t,n){const s=n.patternDependencies;let h=!1;for(const f of t){const g=f.paint.get(`${i}-pattern`);g.isConstant()||(h=!0);const y=g.constantOr(null);y&&(h=!0,s[y.to]=!0,s[y.from]=!0)}return h}function Pl(i,t,n,s,h){const f=h.patternDependencies;for(const g of t){const y=g.paint.get(`${i}-pattern`).value;if("constant"!==y.kind){let b=y.evaluate({zoom:s-1},n,{},h.availableImages),w=y.evaluate({zoom:s},n,{},h.availableImages),S=y.evaluate({zoom:s+1},n,{},h.availableImages);b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,S=S&&S.name?S.name:S,f[b]=!0,f[w]=!0,f[S]=!0,n.patterns[g.id]={min:b,mid:w,max:S}}}return n}sh.deviation=function(i,t,n,s){var h=t&&t.length,f=Math.abs(Ol(i,0,h?t[0]*n:i.length,n));if(h)for(var g=0,y=t.length;g<y;g++)f-=Math.abs(Ol(i,t[g]*n,g<y-1?t[g+1]*n:i.length,n));var b=0;for(g=0;g<s.length;g+=3){var w=s[g]*n,S=s[g+1]*n,E=s[g+2]*n;b+=Math.abs((i[w]-i[E])*(i[S+1]-i[w+1])-(i[w]-i[S])*(i[E+1]-i[w+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)},sh.flatten=function(i){for(var t=i[0][0].length,n={vertices:[],holes:[],dimensions:t},s=0,h=0;h<i.length;h++){for(var f=0;f<i[h].length;f++)for(var g=0;g<t;g++)n.vertices.push(i[h][f][g]);h>0&&n.holes.push(s+=i[h-1].length)}return n},ba.default=vm;class eo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ut,this.indexArray=new Me,this.indexArray2=new en,this.programConfigurations=new wl(t.layers,t.zoom),this.segments=new Ti,this.segments2=new Ti,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=t.projection}populate(t,n,s,h){this.hasPattern=hd("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:y,id:b,index:w,sourceLayerIndex:S}of t){const E=this.layers[0]._featureFilter.needGeometry,k=ws(y,E);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),k,s))continue;const F=f?f.evaluate(k,{},s,n.availableImages):void 0,P={id:b,properties:y.properties,type:y.type,sourceLayerIndex:S,index:w,geometry:E?k.geometry:zo(y,s,h),patterns:{},sortKey:F};g.push(P)}f&&g.sort((y,b)=>y.sortKey-b.sortKey);for(const y of g){const{geometry:b,index:w,sourceLayerIndex:S}=y;if(this.hasPattern){const E=Pl("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(y,b,w,s,{},n.availableImages);n.featureIndex.insert(t[w].feature,b,w,S,this.index)}}update(t,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,s,h)}addFeatures(t,n,s,h,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Op),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,s,h,f,g=[]){for(const y of Gc(n,500)){let b=0;for(const P of y)b+=P.length;const w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),S=w.vertexLength,E=[],k=[];for(const P of y){if(0===P.length)continue;P!==y[0]&&k.push(E.length/2);const B=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),N=B.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(N+P.length-1,N),E.push(P[0].x),E.push(P[0].y);for(let X=1;X<P.length;X++)this.layoutVertexArray.emplaceBack(P[X].x,P[X].y),this.indexArray2.emplaceBack(N+X-1,N+X),E.push(P[X].x),E.push(P[X].y);B.vertexLength+=P.length,B.primitiveLength+=P.length}const F=ba(E,k);for(let P=0;P<F.length;P+=3)this.indexArray.emplaceBack(S+F[P],S+F[P+1],S+F[P+2]);w.vertexLength+=b,w.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,g,h)}}Jt(eo,"FillBucket",{omit:["layers","patternFeatures"]});const dd=new At({"fill-sort-key":new dt(Ct.layout_fill["fill-sort-key"])});var Em={paint:new At({"fill-antialias":new rt(Ct.paint_fill["fill-antialias"]),"fill-opacity":new dt(Ct.paint_fill["fill-opacity"]),"fill-color":new dt(Ct.paint_fill["fill-color"]),"fill-outline-color":new dt(Ct.paint_fill["fill-outline-color"]),"fill-translate":new rt(Ct.paint_fill["fill-translate"]),"fill-translate-anchor":new rt(Ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new yt(Ct.paint_fill["fill-pattern"])}),layout:dd};const km=Et([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dm=Et([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Jg=Et([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Im}=km;var hh=Nc;function Nc(i,t,n,s,h){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=h,i.readFields(Kg,this,t)}function Kg(i,t,n){1==i?t.id=n.readVarint():2==i?function(s,h){for(var f=s.readVarint()+s.pos;s.pos<f;){var g=h._keys[s.readVarint()],y=h._values[s.readVarint()];h.properties[g]=y}}(n,t):3==i?t.type=n.readVarint():4==i&&(t._geometry=n.pos)}function Pp(i){for(var t,n,s=0,h=0,f=i.length,g=f-1;h<f;g=h++)s+=((n=i[g]).x-(t=i[h]).x)*(t.y+n.y);return s}Nc.types=["Unknown","Point","LineString","Polygon"],Nc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,n=i.readVarint()+i.pos,s=1,h=0,f=0,g=0,y=[];i.pos<n;){if(h<=0){var b=i.readVarint();s=7&b,h=b>>3}if(h--,1===s||2===s)f+=i.readSVarint(),g+=i.readSVarint(),1===s&&(t&&y.push(t),t=[]),t.push(new jt(f,g));else{if(7!==s)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&y.push(t),y},Nc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,n=1,s=0,h=0,f=0,g=1/0,y=-1/0,b=1/0,w=-1/0;i.pos<t;){if(s<=0){var S=i.readVarint();n=7&S,s=S>>3}if(s--,1===n||2===n)(h+=i.readSVarint())<g&&(g=h),h>y&&(y=h),(f+=i.readSVarint())<b&&(b=f),f>w&&(w=f);else if(7!==n)throw new Error("unknown command "+n)}return[g,b,y,w]},Nc.prototype.toGeoJSON=function(i,t,n){var s,h,f=this.extent*Math.pow(2,n),g=this.extent*i,y=this.extent*t,b=this.loadGeometry(),w=Nc.types[this.type];function S(F){for(var P=0;P<F.length;P++){var B=F[P];F[P]=[360*(B.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(s=0;s<b.length;s++)E[s]=b[s][0];S(b=E);break;case 2:for(s=0;s<b.length;s++)S(b[s]);break;case 3:for(b=function(F){var P=F.length;if(P<=1)return[F];for(var B,N,X=[],it=0;it<P;it++){var K=Pp(F[it]);0!==K&&(void 0===N&&(N=K<0),N===K<0?(B&&X.push(B),B=[F[it]]):B.push(F[it]))}return B&&X.push(B),X}(b),s=0;s<b.length;s++)for(h=0;h<b[s].length;h++)S(b[s][h])}1===b.length?b=b[0]:w="Multi"+w;var k={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(k.id=this.id),k};var Lp=Rp;function Rp(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(zp,this,t),this.length=this._features.length}function zp(i,t,n){15===i?t.version=n.readVarint():1===i?t.name=n.readString():5===i?t.extent=n.readVarint():2===i?t._features.push(n.pos):3===i?t._keys.push(n.readString()):4===i&&t._values.push(function(s){for(var h=null,f=s.readVarint()+s.pos;s.pos<f;){var g=s.readVarint()>>3;h=1===g?s.readString():2===g?s.readFloat():3===g?s.readDouble():4===g?s.readVarint64():5===g?s.readVarint():6===g?s.readSVarint():7===g?s.readBoolean():null}return h}(n))}function Om(i,t,n){if(3===i){var s=new Lp(n,n.readVarint()+n.pos);s.length&&(t[s.name]=s)}}Rp.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new hh(this._pbf,t,this.extent,this._keys,this._values)};var wa={VectorTile:function(i,t){this.layers=i.readFields(Om,{},t)},VectorTileFeature:hh,VectorTileLayer:Lp};function pd(i,t,n,s){const h=[],f=0===s?(g,y,b,w,S,E)=>{g.push(new jt(E,b+(E-y)/(w-y)*(S-b)))}:(g,y,b,w,S,E)=>{g.push(new jt(y+(E-b)/(S-b)*(w-y),E))};for(const g of i){const y=[];for(const b of g){if(b.length<=2)continue;const w=[];for(let k=0;k<b.length-1;k++){const F=b[k].x,P=b[k].y,B=b[k+1].x,N=b[k+1].y,X=0===s?F:P,it=0===s?B:N;X<t?it>t&&f(w,F,P,B,N,t):X>n?it<n&&f(w,F,P,B,N,n):w.push(b[k]),it<t&&X>=t&&f(w,F,P,B,N,t),it>n&&X<=n&&f(w,F,P,B,N,n)}let S=b[b.length-1];const E=0===s?S.x:S.y;E>=t&&E<=n&&w.push(S),w.length&&(S=w[w.length-1],w[0].x===S.x&&w[0].y===S.y||w.push(w[0]),y.push(w))}y.length&&h.push(y)}return h}const Fm=wa.VectorTileFeature.types,Ll=Math.pow(2,13);function io(i,t,n,s,h,f,g,y){i.emplaceBack((t<<1)+g,(n<<1)+f,(Math.floor(s*Ll)<<1)+h,Math.round(y))}function Uc(i,t,n){i.emplaceBack(t.x,t.y,t.z,16384*n[0],16384*n[1],16384*n[2])}class Ts{constructor(){this.acc=new jt(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new jt(t.x,t.y),this.max=new jt(t.x,t.y))}append(t,n){this.currentPolyCount.edges++,this.acc._add(t);const s=this.min,h=this.max;t.x<s.x?s.x=t.x:t.x>h.x&&(h.x=t.x),t.y<s.y?s.y=t.y:t.y>h.y&&(h.y=t.y),((0===t.x||t.x===ce)&&t.x===n.x)!=((0===t.y||t.y===ce)&&t.y===n.y)&&this.processBorderOverlap(t,n),n.x<0!=t.x<0&&this.addBorderIntersection(0,Fe(n.y,t.y,(0-n.x)/(t.x-n.x))),n.x>ce!=t.x>ce&&this.addBorderIntersection(1,Fe(n.y,t.y,(ce-n.x)/(t.x-n.x))),n.y<0!=t.y<0&&this.addBorderIntersection(2,Fe(n.x,t.x,(0-n.y)/(t.y-n.y))),n.y>ce!=t.y>ce&&this.addBorderIntersection(3,Fe(n.x,t.x,(ce-n.y)/(t.y-n.y)))}addBorderIntersection(t,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[t];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(t,n){if(t.x===n.x){if(t.y===n.y)return;const s=0===t.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,t.y)}else{const s=0===t.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,t.x)}}centroid(){const t=this.polyCount.reduce((n,s)=>n+s.edges,0);return 0!==t?this.acc.div(t)._round():new jt(0,0)}span(){return new jt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,n)=>t+ +(n[0]!==Number.MAX_VALUE),0)}}class jc{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new ie,this.centroidVertexArray=new np,this.indexArray=new Me,this.programConfigurations=new wl(t.layers,t.zoom),this.segments=new Ti,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=t.enableTerrain}populate(t,n,s,h){this.features=[],this.hasPattern=hd("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/ce/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:g,index:y,sourceLayerIndex:b}of t){const w=this.layers[0]._featureFilter.needGeometry,S=ws(f,w);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),S,s))continue;const E={id:g,sourceLayerIndex:b,index:y,geometry:w?S.geometry:zo(f,s,h),properties:f.properties,type:f.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(Pl("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,y,s,{},n.availableImages,h),n.featureIndex.insert(f,E.geometry,y,b,this.index,k)}this.sortBorders()}addFeatures(t,n,s,h,f){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,n,s,h,f)}this.sortBorders()}update(t,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Im),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Jg.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Dm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,s,h,f,g,y){const b=[new jt(0,0),new jt(ce,ce)],w=y.projection,S="globe"===w.name,E=this.enableTerrain&&!S?new Ts:null,k="Polygon"===Fm[t.type];S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nn);const F=Gc(n,500);for(let X=F.length-1;X>=0;X--){const it=F[X];(0===it.length||(P=it[0]).every(K=>K.x<=0)||P.every(K=>K.x>=ce)||P.every(K=>K.y<=0)||P.every(K=>K.y>=ce))&&F.splice(X,1)}var P;let B;if(S)B=zm(F,b,h);else{B=[];for(const X of F)B.push({polygon:X,bounds:b})}const N=k?this.edgeRadius:0;for(const{polygon:X,bounds:it}of B){let K=0,tt=0;for(const nt of X)k&&!nt[0].equals(nt[nt.length-1])&&nt.push(nt[0]),tt+=k?nt.length-1:nt.length;const ct=this.segments.prepareSegment((k?5:4)*tt,this.layoutVertexArray,this.indexArray);if(k){const nt=[],ft=[];K=ct.vertexLength;for(const Mt of X){let Pt,bt;Mt.length&&Mt!==X[0]&&ft.push(nt.length/2),Pt=Mt[1].sub(Mt[0])._perp()._unit();for(let St=1;St<Mt.length;St++){const Ot=Mt[St],Tt=Mt[St===Mt.length-1?1:St+1];let{x:Rt,y:It}=Ot;if(N){bt=Tt.sub(Ot)._perp()._unit();const Ht=Pt.add(bt)._unit(),de=N*Math.min(4,1/(Pt.x*Ht.x+Pt.y*Ht.y));Rt+=de*Ht.x,It+=de*Ht.y,Pt=bt}io(this.layoutVertexArray,Rt,It,0,0,1,1,0),ct.vertexLength++,nt.push(Ot.x,Ot.y),S&&Uc(this.layoutVertexExtArray,w.projectTilePoint(Rt,It,h),w.upVector(h,Rt,It))}}const vt=ba(nt,ft);for(let Mt=0;Mt<vt.length;Mt+=3)this.indexArray.emplaceBack(K+vt[Mt],K+vt[Mt+2],K+vt[Mt+1]),ct.primitiveLength++}for(const nt of X){E&&nt.length&&E.startRing(nt[0]);let ft,vt,Mt,Pt=nt.length>4&&Rl(nt[nt.length-2],nt[0],nt[1]),bt=N?Pm(nt[nt.length-2],nt[0],nt[1],N):0;vt=nt[1].sub(nt[0])._perp()._unit();for(let St=1,Ot=0;St<nt.length;St++){let Tt=nt[St-1],Rt=nt[St];const It=nt[St===nt.length-1?1:St+1];if(E&&k&&E.currentPolyCount.top++,Lm(Rt,Tt,it)){N&&(vt=It.sub(Rt)._perp()._unit());continue}E&&E.append(Rt,Tt);const Ht=Rt.sub(Tt)._perp(),de=Ht.x/(Math.abs(Ht.x)+Math.abs(Ht.y)),be=Ht.y>0?1:0,ne=Tt.dist(Rt);if(Ot+ne>32768&&(Ot=0),N){Mt=It.sub(Rt)._perp()._unit();let $t=fd(Tt,Rt,It,Bp(vt,Mt),N);isNaN($t)&&($t=0);const Qe=Rt.sub(Tt)._unit();Tt=Tt.add(Qe.mult(bt))._round(),Rt=Rt.add(Qe.mult(-$t))._round(),bt=$t,vt=Mt}const Nt=ct.vertexLength,Ee=nt.length>4&&Rl(Tt,Rt,It);let fe=md(Ot,Pt,!0);if(io(this.layoutVertexArray,Tt.x,Tt.y,de,be,0,0,fe),io(this.layoutVertexArray,Tt.x,Tt.y,de,be,0,1,fe),Ot+=ne,fe=md(Ot,Ee,!1),Pt=Ee,io(this.layoutVertexArray,Rt.x,Rt.y,de,be,0,0,fe),io(this.layoutVertexArray,Rt.x,Rt.y,de,be,0,1,fe),ct.vertexLength+=4,this.indexArray.emplaceBack(Nt+0,Nt+1,Nt+2),this.indexArray.emplaceBack(Nt+1,Nt+3,Nt+2),ct.primitiveLength+=2,N){const $t=K+(1===St?nt.length-2:St-2),Qe=1===St?K:$t+1;if(this.indexArray.emplaceBack(Nt+1,$t,Nt+3),this.indexArray.emplaceBack($t,Qe,Nt+3),ct.primitiveLength+=2,void 0===ft&&(ft=Nt),!Lm(It,nt[St],it)){const Je=St===nt.length-1?ft:ct.vertexLength;this.indexArray.emplaceBack(Nt+2,Nt+3,Je),this.indexArray.emplaceBack(Nt+3,Je+1,Je),this.indexArray.emplaceBack(Nt+3,Qe,Je+1),ct.primitiveLength+=3}}if(S){const $t=this.layoutVertexExtArray,Qe=w.projectTilePoint(Tt.x,Tt.y,h),Je=w.projectTilePoint(Rt.x,Rt.y,h),pi=w.upVector(h,Tt.x,Tt.y),Ce=w.upVector(h,Rt.x,Rt.y);Uc($t,Qe,pi),Uc($t,Qe,pi),Uc($t,Je,Ce),Uc($t,Je,Ce)}}k&&(K+=nt.length-1)}}if(E&&E.polyCount.length>0){if(E.borders){E.vertexArrayOffset=this.centroidVertexArray.length;const X=E.borders,it=this.featuresOnBorder.push(E)-1;for(let K=0;K<4;K++)X[K][0]!==Number.MAX_VALUE&&this.borders[K].push(it)}this.encodeCentroid(E.borders?void 0:E.centroid(),E)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,g,h)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((n,s)=>this.featuresOnBorder[n].borders[t][0]-this.featuresOnBorder[s].borders[t][0])}encodeCentroid(t,n,s=!0){let h,f;if(t)if(0!==t.y){const y=n.span()._mult(this.tileToMeter);h=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else h=Math.ceil(7*(t.x+450)),f=0;else h=0,f=+s;let g=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const y of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(g++,h,f);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,h,f)}}}function Bp(i,t){const n=i.add(t)._unit();return i.x*n.x+i.y*n.y}function Pm(i,t,n,s){const h=t.sub(i)._perp()._unit(),f=n.sub(t)._perp()._unit();return fd(i,t,n,Bp(h,f),s)}function fd(i,t,n,s,h){const f=Math.sqrt(1-s*s);return Math.min(i.dist(t)/3,t.dist(n)/3,h*f/s)}function Lm(i,t,n){return i.x<n[0].x&&t.x<n[0].x||i.x>n[1].x&&t.x>n[1].x||i.y<n[0].y&&t.y<n[0].y||i.y>n[1].y&&t.y>n[1].y}function Rl(i,t,n){if(i.x<0||i.x>=ce||t.x<0||t.x>=ce||n.x<0||n.x>=ce)return!1;const s=n.sub(t),h=s.perp(),f=i.sub(t);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&h.x*f.x+h.y*f.y<0}function md(i,t,n){const s=t?2|i:-3&i;return n?1|s:-2&s}function Rm(){const i=Math.PI/32,t=Math.tan(i),n=Wh;return n*Math.sqrt(1+2*t*t)-n}function zm(i,t,n){const s=1<<n.z,h=or(n.x/s),f=or((n.x+1)/s),g=Yi(n.y/s),y=Yi((n.y+1)/s);return function(b,w,S,E,k=0,F){const P=[];if(!b.length||!S||!E)return P;const B=(nt,ft)=>{for(const vt of nt)P.push({polygon:vt,bounds:ft})},N=Math.ceil(Math.log2(S)),X=Math.ceil(Math.log2(E)),it=N-X,K=[];for(let nt=0;nt<Math.abs(it);nt++)K.push(it>0?0:1);for(let nt=0;nt<Math.min(N,X);nt++)K.push(0),K.push(1);let tt=b;if(tt=pd(tt,w[0].y-k,w[1].y+k,1),tt=pd(tt,w[0].x-k,w[1].x+k,0),!tt.length)return P;const ct=[];for(K.length?ct.push({polygons:tt,bounds:w,depth:0}):B(tt,w);ct.length;){const nt=ct.pop(),ft=nt.depth,vt=K[ft],Mt=nt.bounds[0],Pt=nt.bounds[1],bt=0===vt?Mt.x:Mt.y,St=0===vt?Pt.x:Pt.y,Ot=F?F(vt,bt,St):.5*(bt+St),Tt=pd(nt.polygons,bt-k,Ot+k,vt),Rt=pd(nt.polygons,Ot-k,St+k,vt);if(Tt.length){const It=[Mt,new jt(0===vt?Ot:Pt.x,1===vt?Ot:Pt.y)];K.length>ft+1?ct.push({polygons:Tt,bounds:It,depth:ft+1}):B(Tt,It)}if(Rt.length){const It=[new jt(0===vt?Ot:Mt.x,1===vt?Ot:Mt.y),Pt];K.length>ft+1?ct.push({polygons:Rt,bounds:It,depth:ft+1}):B(Rt,It)}}return P}(i,t,Math.ceil((f-h)/11.25),Math.ceil((g-y)/11.25),1,(b,w,S)=>{if(0===b)return.5*(w+S);{const E=Yi((n.y+w/ce)/s);return(Ro(.5*(Yi((n.y+S/ce)/s)+E))*s-n.y)*ce}})}Jt(jc,"FillExtrusionBucket",{omit:["layers","features"]}),Jt(Ts,"PartMetadata");const Qg=new At({"fill-extrusion-edge-radius":new rt(Ct["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var t_={paint:new At({"fill-extrusion-opacity":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dt(Ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yt(Ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dt(Ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dt(Ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new rt(Ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Qg};function Bm(i,t,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[i*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class gd{constructor(t,n,s){this.z=t,this.x=n,this.y=s,this.key=No(0,t,t,n,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n){const s=(g=this.y,y=this.z,b=Bm(256*(f=this.x),256*(g=Math.pow(2,y)-g-1),y),w=Bm(256*(f+1),256*(g+1),y),b[0]+","+b[1]+","+w[0]+","+w[1]),h=function(f,g,y){let b,w="";for(let S=f;S>0;S--)b=1<<S-1,w+=(g&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);var f,g,y,b,w;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dh{constructor(t,n){this.wrap=t,this.canonical=n,this.key=No(t,n.z,n.z,n.x,n.y)}}class Bi{constructor(t,n,s,h,f){this.overscaledZ=t,this.wrap=n,this.canonical=new gd(s,+h,+f),this.key=0===n&&t===s?this.canonical.key:No(n,t,s,h,f)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const n=this.canonical.z-t;return t>this.canonical.z?new Bi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bi(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n=!0){if(this.overscaledZ===t&&n)return this.key;if(t>this.canonical.z)return No(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-t;return No(this.wrap*+n,t,t,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Bi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new Bi(n,this.wrap,n,s,h),new Bi(n,this.wrap,n,s+1,h),new Bi(n,this.wrap,n,s,h+1),new Bi(n,this.wrap,n,s+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Bi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Bi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function No(i,t,n,s,h){const f=1<<Math.min(n,22);let g=f*(h%f)+s%f;return i&&n<22&&(g+=f*f*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*g+n)+(t-n)}function qc(i,t){return i.x*t.x+i.y*t.y}function Zc(i,t){if(1===i.length){let n=0;const s=t[n++];let h;for(;!h||s.equals(h);)if(h=t[n++],!h)return 1/0;for(;n<t.length;n++){const f=t[n],g=i[0],y=h.sub(s),b=f.sub(s),w=g.sub(s),S=qc(y,y),E=qc(y,b),k=qc(b,b),F=qc(w,y),P=qc(w,b),B=S*k-E*E,N=(k*F-E*P)/B,X=(S*P-E*F)/B,it=s.z*(1-N-X)+h.z*N+f.z*X;if(isFinite(it))return it}return 1/0}{let n=1/0;for(const s of t)n=Math.min(n,s.z);return n}}function _d(i){const t=new jt(i[0],i[1]);return t.z=i[2],t}function Vp(i,t,n,s,h,f,g,y){const b=g*h.getElevationAt(i,t,!0,!0),w=0!==f[0],S=w?0===f[1]?g*(f[0]/7-450):g*function(E,k,F){const P=Math.floor(k[0]/8),B=Math.floor(k[1]/8),N=10*(k[0]-8*P),X=10*(k[1]-8*B),it=E.getElevationAt(P,B,!0,!0),K=E.getMeterToDEM(F),tt=Math.floor(.5*(N*K-1)),ct=Math.floor(.5*(X*K-1)),nt=E.tileCoordToPixel(P,B),ft=2*tt+1,vt=2*ct+1,Mt=(de=ft,be=vt,[(Rt=E).getElevationAtPixel(It=nt.x-tt,Ht=nt.y-ct,!0),Rt.getElevationAtPixel(It+be,Ht,!0),Rt.getElevationAtPixel(It,Ht+be,!0),Rt.getElevationAtPixel(It+de,Ht+be,!0)]),Pt=Math.abs(Mt[0]-Mt[1]),bt=Math.abs(Mt[2]-Mt[3]),St=Math.abs(Mt[0]-Mt[2])+Math.abs(Mt[1]-Mt[3]),Ot=Math.min(.25,.5*K*(Pt+bt)/ft),Tt=Math.min(.25,.5*K*St/vt);var Rt,It,Ht,de,be;return it+Math.max(Ot*N,Tt*X)}(h,f,y):b;return{base:b+(0===n)?-1:n,top:w?Math.max(S+s,b+n+2):b+s}}Jt(gd,"CanonicalTileID"),Jt(Bi,"OverscaledTileID",{omit:["projMatrix"]});const e_=Et([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Gp}=e_,i_=Et([{name:"a_packed",components:4,type:"Float32"}]),{members:zl}=i_,n_=wa.VectorTileFeature.types,yd=Math.cos(Math.PI/180*37.5);class vd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new se,this.layoutVertexArray2=new Te,this.indexArray=new Me,this.programConfigurations=new wl(t.layers,t.zoom),this.segments=new Ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,s,h){this.hasPattern=hd("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:S,id:E,index:k,sourceLayerIndex:F}of t){const P=this.layers[0]._featureFilter.needGeometry,B=ws(S,P);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),B,s))continue;const N=f?f.evaluate(B,{},s):void 0,X={id:E,properties:S.properties,type:S.type,sourceLayerIndex:F,index:k,geometry:P?B.geometry:zo(S,s,h),patterns:{},sortKey:N};g.push(X)}f&&g.sort((S,E)=>S.sortKey-E.sortKey);const{lineAtlas:y,featureIndex:b}=n,w=this.addConstantDashes(y);for(const S of g){const{geometry:E,index:k,sourceLayerIndex:F}=S;if(w&&this.addFeatureDashes(S,y),this.hasPattern){const P=Pl("line",this.layers,S,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(S,E,k,s,y.positions,n.availableImages);b.insert(t[k].feature,E,k,F,this.index)}}addConstantDashes(t){let n=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==f.kind)n=!0;else{const g=f.value,y=h.value;if(!y)continue;t.addDash(y.from,g),t.addDash(y.to,g),y.other&&t.addDash(y.other,g)}}return n}addFeatureDashes(t,n){const s=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let y,b,w,S,E,k;if("constant"===f.kind){const N=f.value;if(!N)continue;y=N.other||N.to,b=N.to,w=N.from}else y=f.evaluate({zoom:s-1},t),b=f.evaluate({zoom:s},t),w=f.evaluate({zoom:s+1},t);"constant"===g.kind?S=E=k=g.value:(S=g.evaluate({zoom:s-1},t),E=g.evaluate({zoom:s},t),k=g.evaluate({zoom:s+1},t)),n.addDash(y,S),n.addDash(b,E),n.addDash(w,k);const F=n.getKey(y,S),P=n.getKey(b,E),B=n.getKey(w,k);t.patterns[h.id]={min:F,mid:P,max:B}}}update(t,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,s,h)}addFeatures(t,n,s,h,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,zl)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,s,h,f,g){const y=this.layers[0].layout,b=y.get("line-join").evaluate(t,{}),w=y.get("line-cap").evaluate(t,{}),S=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const k of n)this.addLine(k,t,b,w,S,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,g,h)}addLine(t,n,s,h,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y="Polygon"===n_[n.type];let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let w=0;for(;w<b-1&&t[w].equals(t[w+1]);)w++;if(b<(y?3:2))return;"bevel"===s&&(f=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,E=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let k,F,P,B,N;this.e1=this.e2=-1,y&&(k=t[b-2],N=t[w].sub(k)._unit()._perp());for(let X=w;X<b;X++){if(P=X===b-1?y?t[w+1]:void 0:t[X+1],P&&t[X].equals(P))continue;N&&(B=N),k&&(F=k),k=t[X],N=P?P.sub(k)._unit()._perp():B,B=B||N;let it=B.add(N);0===it.x&&0===it.y||it._unit();const K=B.x*N.x+B.y*N.y,tt=it.x*N.x+it.y*N.y,ct=0!==tt?1/tt:1/0,nt=2*Math.sqrt(2-2*tt),ft=tt<yd&&F&&P,vt=B.x*N.y-B.y*N.x>0;if(ft&&X>w){const bt=k.dist(F);if(bt>2*S){const St=k.sub(k.sub(F)._mult(S/bt)._round());this.updateDistance(F,St),this.addCurrentVertex(St,B,0,0,E),F=St}}const Mt=F&&P;let Pt=Mt?s:y?"butt":h;if(Mt&&"round"===Pt&&(ct<g?Pt="miter":ct<=2&&(Pt="fakeround")),"miter"===Pt&&ct>f&&(Pt="bevel"),"bevel"===Pt&&(ct>2&&(Pt="flipbevel"),ct<f&&(Pt="miter")),F&&this.updateDistance(F,k),"miter"===Pt)it._mult(ct),this.addCurrentVertex(k,it,0,0,E);else if("flipbevel"===Pt){if(ct>100)it=N.mult(-1);else{const bt=ct*B.add(N).mag()/B.sub(N).mag();it._perp()._mult(bt*(vt?-1:1))}this.addCurrentVertex(k,it,0,0,E),this.addCurrentVertex(k,it.mult(-1),0,0,E)}else if("bevel"===Pt||"fakeround"===Pt){const bt=-Math.sqrt(ct*ct-1),St=vt?bt:0,Ot=vt?0:bt;if(F&&this.addCurrentVertex(k,B,St,Ot,E),"fakeround"===Pt){const Tt=Math.round(180*nt/Math.PI/20);for(let Rt=1;Rt<Tt;Rt++){let It=Rt/Tt;if(.5!==It){const de=It-.5;It+=It*de*(It-1)*((1.0904+K*(K*(3.55645-1.43519*K)-3.2452))*de*de+(.848013+K*(.215638*K-1.06021)))}const Ht=N.sub(B)._mult(It)._add(B)._unit()._mult(vt?-1:1);this.addHalfVertex(k,Ht.x,Ht.y,!1,vt,0,E)}}P&&this.addCurrentVertex(k,N,-St,-Ot,E)}else if("butt"===Pt)this.addCurrentVertex(k,it,0,0,E);else if("square"===Pt){const bt=F?1:-1;F||this.addCurrentVertex(k,it,bt,bt,E),this.addCurrentVertex(k,it,0,0,E),F&&this.addCurrentVertex(k,it,bt,bt,E)}else"round"===Pt&&(F&&(this.addCurrentVertex(k,B,0,0,E),this.addCurrentVertex(k,B,1,1,E,!0)),P&&(this.addCurrentVertex(k,N,-1,-1,E,!0),this.addCurrentVertex(k,N,0,0,E)));if(ft&&X<b-1){const bt=k.dist(P);if(bt>2*S){const St=k.add(P.sub(k)._mult(S/bt)._round());this.updateDistance(k,St),this.addCurrentVertex(St,N,0,0,E),k=St}}}}addCurrentVertex(t,n,s,h,f,g=!1){const y=n.y*h-n.x,b=-n.y-n.x*h;this.addHalfVertex(t,n.x+n.y*s,n.y-n.x*s,g,!1,s,f),this.addHalfVertex(t,y,b,g,!0,-h,f)}addHalfVertex({x:t,y:n},s,h,f,g,y,b){this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(n<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(0===y?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),g?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}Jt(vd,"LineBucket",{omit:["layers","patternFeatures"]});const Fn=new At({"line-cap":new dt(Ct.layout_line["line-cap"]),"line-join":new dt(Ct.layout_line["line-join"]),"line-miter-limit":new rt(Ct.layout_line["line-miter-limit"]),"line-round-limit":new rt(Ct.layout_line["line-round-limit"]),"line-sort-key":new dt(Ct.layout_line["line-sort-key"])});var Np={paint:new At({"line-opacity":new dt(Ct.paint_line["line-opacity"]),"line-color":new dt(Ct.paint_line["line-color"]),"line-translate":new rt(Ct.paint_line["line-translate"]),"line-translate-anchor":new rt(Ct.paint_line["line-translate-anchor"]),"line-width":new dt(Ct.paint_line["line-width"]),"line-gap-width":new dt(Ct.paint_line["line-gap-width"]),"line-offset":new dt(Ct.paint_line["line-offset"]),"line-blur":new dt(Ct.paint_line["line-blur"]),"line-dasharray":new yt(Ct.paint_line["line-dasharray"]),"line-pattern":new yt(Ct.paint_line["line-pattern"]),"line-gradient":new gt(Ct.paint_line["line-gradient"]),"line-trim-offset":new rt(Ct.paint_line["line-trim-offset"])}),layout:Fn};const Vm=new class extends dt{possiblyEvaluate(i,t){return t=new q(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,n,s){return t=Ve({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,n,s)}}(Np.paint.properties["line-width"].specification);function Gm(i,t){return t>0?t+2*i:i}Vm.useIntegerZoom=!0;const Nm=Et([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),r_=Et([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ph=Et([{name:"a_projected_pos",components:4,type:"Float32"}],4);Et([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Um=Et([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),jm=Et([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Up=Et([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),o_=Et([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Et([{name:"triangle",components:3,type:"Uint16"}]),Et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Et([{type:"Float32",name:"offsetX"}]),Et([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const lr=128;function Bl(i,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new q(i+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:h}=n;let f=0;for(;f<s.length&&s[f]<=i;)f++;f=Math.max(0,f-1);let g=f;for(;g<s.length&&s[g]<i+1;)g++;g=Math.min(s.length-1,g);const y=s[f],b=s[g];return"composite"===n.kind?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:y,maxZoom:b,minSize:n.evaluate(new q(y)),maxSize:n.evaluate(new q(b)),interpolationType:h}}}function xd(i,{uSize:t,uSizeT:n},{lowerSize:s,upperSize:h}){return"source"===i.kind?s/lr:"composite"===i.kind?Fe(s/lr,h/lr,n):t}function Hc(i,t){let n=0,s=0;if("constant"===i.kind)s=i.layoutSize;else if("source"!==i.kind){const{interpolationType:h,minZoom:f,maxZoom:g}=i,y=h?ye(hi.interpolationFactor(h,t,f,g),0,1):0;"camera"===i.kind?s=Fe(i.minSize,i.maxSize,y):n=y}return{uSizeT:n,uSize:s}}var qm=Object.freeze({__proto__:null,getSizeData:Bl,evaluateSizeForFeature:xd,evaluateSizeForZoom:Hc,SIZE_PACK_FACTOR:lr});function Zm(i,t,n){return i.sections.forEach(s=>{s.text=function(h,f,g){const y=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===y?h=h.toLocaleUpperCase():"lowercase"===y&&(h=h.toLocaleLowerCase()),j.applyArabicShaping&&(h=j.applyArabicShaping(h)),h}(s.text,t,n)}),i}const Vl={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function fh(i){return"\ufe36"===i||"\ufe48"===i||"\ufe38"===i||"\ufe44"===i||"\ufe42"===i||"\ufe3e"===i||"\ufe3c"===i||"\ufe3a"===i||"\ufe18"===i||"\ufe40"===i||"\ufe10"===i||"\ufe13"===i||"\ufe14"===i||"\uff40"===i||"\uffe3"===i||"\ufe11"===i||"\ufe12"===i}function jp(i){return"\ufe35"===i||"\ufe47"===i||"\ufe37"===i||"\ufe43"===i||"\ufe41"===i||"\ufe3d"===i||"\ufe3b"===i||"\ufe39"===i||"\ufe17"===i||"\ufe3f"===i}var $c=function(i,t,n,s,h){var f,g,y=8*h-s-1,b=(1<<y)-1,w=b>>1,S=-7,E=n?h-1:0,k=n?-1:1,F=i[t+E];for(E+=k,f=F&(1<<-S)-1,F>>=-S,S+=y;S>0;f=256*f+i[t+E],E+=k,S-=8);for(g=f&(1<<-S)-1,f>>=-S,S+=s;S>0;g=256*g+i[t+E],E+=k,S-=8);if(0===f)f=1-w;else{if(f===b)return g?NaN:1/0*(F?-1:1);g+=Math.pow(2,s),f-=w}return(F?-1:1)*g*Math.pow(2,f-s)},Hm=function(i,t,n,s,h,f){var g,y,b,w=8*f-h-1,S=(1<<w)-1,E=S>>1,k=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,F=s?0:f-1,P=s?1:-1,B=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,g=S):(g=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-g))<1&&(g--,b*=2),(t+=g+E>=1?k/b:k*Math.pow(2,1-E))*b>=2&&(g++,b/=2),g+E>=S?(y=0,g=S):g+E>=1?(y=(t*b-1)*Math.pow(2,h),g+=E):(y=t*Math.pow(2,E-1)*Math.pow(2,h),g=0));h>=8;i[n+F]=255&y,F+=P,y/=256,h-=8);for(g=g<<h|y,w+=h;w>0;i[n+F]=255&g,F+=P,g/=256,w-=8);i[n+F-P]|=128*B},mh=ri;function ri(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ri.Varint=0,ri.Fixed64=1,ri.Bytes=2,ri.Fixed32=5;var qp=4294967296,Zp=1/qp,$m=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Es(i){return i.type===ri.Bytes?i.readVarint()+i.pos:i.pos+1}function Ym(i,t,n){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(s);for(var h=n.pos-1;h>=i;h--)n.buf[h+s]=n.buf[h]}function s_(i,t){for(var n=0;n<i.length;n++)t.writeVarint(i[n])}function a_(i,t){for(var n=0;n<i.length;n++)t.writeSVarint(i[n])}function l_(i,t){for(var n=0;n<i.length;n++)t.writeFloat(i[n])}function c_(i,t){for(var n=0;n<i.length;n++)t.writeDouble(i[n])}function Wm(i,t){for(var n=0;n<i.length;n++)t.writeBoolean(i[n])}function u_(i,t){for(var n=0;n<i.length;n++)t.writeFixed32(i[n])}function h_(i,t){for(var n=0;n<i.length;n++)t.writeSFixed32(i[n])}function d_(i,t){for(var n=0;n<i.length;n++)t.writeFixed64(i[n])}function p_(i,t){for(var n=0;n<i.length;n++)t.writeSFixed64(i[n])}function Gl(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Wc(i,t,n){i[n]=t,i[n+1]=t>>>8,i[n+2]=t>>>16,i[n+3]=t>>>24}function Xm(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function f_(i,t,n){t.glyphs=[],1===i&&n.readMessage(m_,t)}function m_(i,t,n){if(3===i){const{id:s,bitmap:h,width:f,height:g,left:y,top:b,advance:w}=n.readMessage(g_,{});t.glyphs.push({id:s,bitmap:new Bo({width:f+6,height:g+6},h),metrics:{width:f,height:g,left:y,top:b,advance:w}})}else 4===i?t.ascender=n.readSVarint():5===i&&(t.descender=n.readSVarint())}function g_(i,t,n){1===i?t.id=n.readVarint():2===i?t.bitmap=n.readBytes():3===i?t.width=n.readVarint():4===i?t.height=n.readVarint():5===i?t.left=n.readSVarint():6===i?t.top=n.readSVarint():7===i&&(t.advance=n.readVarint())}function Hp(i){let t=0,n=0;for(const g of i)t+=g.w*g.h,n=Math.max(n,g.w);i.sort((g,y)=>y.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let h=0,f=0;for(const g of i)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,f=Math.max(f,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===b.w&&g.h===b.h){const w=s.pop();y<s.length&&(s[y]=w)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(s.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:h,h:f,fill:t/(h*f)||0}}ri.prototype={destroy:function(){this.buf=null},readFields:function(i,t,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),h=s>>3,f=this.pos;this.type=7&s,i(h,t,this),this.pos===f&&this.skip(s)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Gl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Xm(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Gl(this.buf,this.pos)+Gl(this.buf,this.pos+4)*qp;return this.pos+=8,i},readSFixed64:function(){var i=Gl(this.buf,this.pos)+Xm(this.buf,this.pos+4)*qp;return this.pos+=8,i},readFloat:function(){var i=$c(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=$c(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,n,s=this.buf;return t=127&(n=s[this.pos++]),n<128?t:(t|=(127&(n=s[this.pos++]))<<7,n<128?t:(t|=(127&(n=s[this.pos++]))<<14,n<128?t:(t|=(127&(n=s[this.pos++]))<<21,n<128?t:function(h,f,g){var y,b,w=g.buf;if(y=(112&(b=w[g.pos++]))>>4,b<128||(y|=(127&(b=w[g.pos++]))<<3,b<128)||(y|=(127&(b=w[g.pos++]))<<10,b<128)||(y|=(127&(b=w[g.pos++]))<<17,b<128)||(y|=(127&(b=w[g.pos++]))<<24,b<128)||(y|=(1&(b=w[g.pos++]))<<31,b<128))return function Yc(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}(h,y,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&$m?$m.decode(this.buf.subarray(t,i)):function(n,s,h){for(var f="",g=s;g<h;){var y,b,w,S=n[g],E=null,k=S>239?4:S>223?3:S>191?2:1;if(g+k>h)break;1===k?S<128&&(E=S):2===k?128==(192&(y=n[g+1]))&&(E=(31&S)<<6|63&y)<=127&&(E=null):3===k?(b=n[g+2],128==(192&(y=n[g+1]))&&128==(192&b)&&((E=(15&S)<<12|(63&y)<<6|63&b)<=2047||E>=55296&&E<=57343)&&(E=null)):4===k&&(b=n[g+2],w=n[g+3],128==(192&(y=n[g+1]))&&128==(192&b)&&128==(192&w)&&((E=(15&S)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||E>=1114112)&&(E=null)),null===E?(E=65533,k=1):E>65535&&(E-=65536,f+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),f+=String.fromCharCode(E),g+=k}return f}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==ri.Bytes)return i.push(this.readVarint(t));var n=Es(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==ri.Bytes)return i.push(this.readSVarint());var t=Es(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ri.Bytes)return i.push(this.readBoolean());var t=Es(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ri.Bytes)return i.push(this.readFloat());var t=Es(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ri.Bytes)return i.push(this.readDouble());var t=Es(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ri.Bytes)return i.push(this.readFixed32());var t=Es(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ri.Bytes)return i.push(this.readSFixed32());var t=Es(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ri.Bytes)return i.push(this.readFixed64());var t=Es(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ri.Bytes)return i.push(this.readSFixed64());var t=Es(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===ri.Varint)for(;this.buf[this.pos++]>127;);else if(t===ri.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ri.Fixed32)this.pos+=4;else{if(t!==ri.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Wc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Wc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Wc(this.buf,-1&i,this.pos),Wc(this.buf,Math.floor(i*Zp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Wc(this.buf,-1&i,this.pos),Wc(this.buf,Math.floor(i*Zp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,n){var s,h,f,y;if(t>=0?(s=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,h=h+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),f=s,(y=n).buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7),function(f,g){var y=(7&f)<<4;g.buf[g.pos++]|=y|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(h,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(s,h,f){for(var g,y,b=0;b<h.length;b++){if((g=h.charCodeAt(b))>55295&&g<57344){if(!y){g>56319||b+1===h.length?(s[f++]=239,s[f++]=191,s[f++]=189):y=g;continue}if(g<56320){s[f++]=239,s[f++]=191,s[f++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(s[f++]=239,s[f++]=191,s[f++]=189,y=null);g<128?s[f++]=g:(g<2048?s[f++]=g>>6|192:(g<65536?s[f++]=g>>12|224:(s[f++]=g>>18|240,s[f++]=g>>12&63|128),s[f++]=g>>6&63|128),s[f++]=63&g|128)}return f}(this.buf,i,this.pos);var n=this.pos-t;n>=128&&Ym(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Hm(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Hm(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,t){this.pos++;var n=this.pos;i(t,this);var s=this.pos-n;s>=128&&Ym(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,t,n){this.writeTag(i,ri.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,s_,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,a_,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Wm,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,l_,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,c_,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,u_,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,h_,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,d_,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,p_,t)},writeBytesField:function(i,t){this.writeTag(i,ri.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,ri.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,ri.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,ri.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,ri.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,ri.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,ri.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,ri.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,ri.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,ri.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,Boolean(t))}};class $p{constructor(t,{pixelRatio:n,version:s,stretchX:h,stretchY:f,content:g}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=h,this.stretchY=f,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Jm{constructor(t,n){const s={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,s,f),this.addImages(n,h,f);const{w:g,h:y}=Hp(f),b=new On({width:g||1,height:y||1});for(const w in t){const S=t[w],E=s[w].paddedRect;On.copy(S.data,b,{x:0,y:0},{x:E.x+1,y:E.y+1},S.data)}for(const w in n){const S=n[w],E=h[w].paddedRect,k=E.x+1,F=E.y+1,P=S.data.width,B=S.data.height;On.copy(S.data,b,{x:0,y:0},{x:k,y:F},S.data),On.copy(S.data,b,{x:0,y:B-1},{x:k,y:F-1},{width:P,height:1}),On.copy(S.data,b,{x:0,y:0},{x:k,y:F+B},{width:P,height:1}),On.copy(S.data,b,{x:P-1,y:0},{x:k-1,y:F},{width:1,height:B}),On.copy(S.data,b,{x:0,y:0},{x:k+P,y:F},{width:1,height:B})}this.image=b,this.iconPositions=s,this.patternPositions=h}addImages(t,n,s){for(const h in t){const f=t[h],g={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(g),n[h]=new $p(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>t.hasImage(s)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),n)}patchUpdatedImage(t,n,s){if(!t||!n||t.version===n.version)return;t.version=n.version;const[h,f]=t.tl;s.update(n.data,void 0,{x:h,y:f})}}Jt($p,"ImagePosition"),Jt(Jm,"ImageAtlas");const cr={horizontal:1,vertical:2,horizontalOnly:3};class gh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const s=new gh;return s.scale=t||1,s.fontStack=n,s}static forImage(t){const n=new gh;return n.imageName=t,n}}class Xc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const s=new Xc;for(let h=0;h<t.sections.length;h++){const f=t.sections[h];f.image?s.addImageSection(f):s.addTextSection(f,n)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(n,s){let h="";for(let f=0;f<n.length;f++){const g=n.charCodeAt(f+1)||null,y=n.charCodeAt(f-1)||null;h+=!s&&(g&&fa(g)&&!Vl[n[f+1]]||y&&fa(y)&&!Vl[n[f-1]])||!Vl[n[f]]?n[f]:Vl[n[f]]}return h}(this.text,t)}trim(){let t=0;for(let s=0;s<this.text.length&&bd[this.text.charCodeAt(s)];s++)t++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&bd[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const s=new Xc;return s.text=this.text.substring(t,n),s.sectionIndex=this.sectionIndex.slice(t,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(gh.forText(t.scale,t.fontStack||n));const s=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(s)}addImageSection(t){const n=t.image?t.image.name:"";if(0===n.length)return void ci("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(gh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yp(i,t,n,s,h,f,g,y,b,w,S,E,k,F,P,B){const N=Xc.fromFeature(i,h);let X;E===cr.vertical&&N.verticalizePunctuation(k);const{processBidirectionalText:it,processStyledBidirectionalText:K}=j;if(it&&1===N.sections.length){X=[];const nt=it(N.toString(),Wp(N,w,f,t,s,F,P));for(const ft of nt){const vt=new Xc;vt.text=ft,vt.sections=N.sections;for(let Mt=0;Mt<ft.length;Mt++)vt.sectionIndex.push(0);X.push(vt)}}else if(K){X=[];const nt=K(N.text,N.sectionIndex,Wp(N,w,f,t,s,F,P));for(const ft of nt){const vt=new Xc;vt.text=ft[0],vt.sectionIndex=ft[1],vt.sections=N.sections,X.push(vt)}}else X=function(nt,ft){const vt=[],Mt=nt.text;let Pt=0;for(const bt of ft)vt.push(nt.substring(Pt,bt)),Pt=bt;return Pt<Mt.length&&vt.push(nt.substring(Pt,Mt.length)),vt}(N,Wp(N,w,f,t,s,F,P));const tt=[],ct={positionedLines:tt,text:N.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(nt,ft,vt,Mt,Pt,bt,St,Ot,Tt,Rt,It,Ht){let de=0,be=0,ne=0;const Nt="right"===Ot?1:"left"===Ot?0:.5;let Ee=!1;for(const Ce of Pt){const Be=Ce.getSections();for(const oi of Be){if(oi.imageName)continue;const He=ft[oi.fontStack];if(He&&(Ee=void 0!==He.ascender&&void 0!==He.descender,!Ee))break}if(!Ee)break}let fe=0;for(const Ce of Pt){Ce.trim();const Be=Ce.getMaxScale(),oi=24*(Be-1),He={positionedGlyphs:[],lineOffset:0};nt.positionedLines[fe]=He;const Ze=He.positionedGlyphs;let ti=0;if(!Ce.length()){be+=bt,++fe;continue}let ei=0,ki=0;for(let De=0;De<Ce.length();De++){const bi=Ce.getSection(De),qi=Ce.getSectionIndex(De),Ne=Ce.getCharCode(De);let fi=bi.scale,pn=null,mi=null,Mi=null,Zi=24,_i=0;const Oi=!(Tt===cr.horizontal||!It&&!pa(Ne)||It&&(bd[Ne]||($t=Ne,Gu($t)||hn($t)||Nh($t)||da($t)||kc($t))));if(bi.imageName){const on=Mt[bi.imageName];if(!on)continue;Mi=bi.imageName,nt.iconsInText=nt.iconsInText||!0,mi=on.paddedRect;const Fi=on.displaySize;fi=24*fi/Ht,pn={width:Fi[0],height:Fi[1],left:1,top:-3,advance:Oi?Fi[1]:Fi[0],localGlyph:!1},_i=Ee?-pn.height*fi:24*Be-17-Fi[1]*fi,Zi=pn.advance;const Er=(Oi?Fi[0]:Fi[1])*fi-24*Be;Er>0&&Er>ti&&(ti=Er)}else{const on=vt[bi.fontStack];if(!on)continue;on[Ne]&&(mi=on[Ne]);const Fi=ft[bi.fontStack];if(!Fi)continue;const Er=Fi.glyphs[Ne];if(!Er)continue;if(pn=Er.metrics,Zi=8203!==Ne?24:0,Ee){const Wl=void 0!==Fi.ascender?Math.abs(Fi.ascender):0,uu=void 0!==Fi.descender?Math.abs(Fi.descender):0,Xl=(Wl+uu)*fi;ei<Xl&&(ei=Xl,ki=(Wl-uu)/2*fi),_i=-Wl*fi}else _i=24*(Be-fi)-17}Oi?(nt.verticalizable=!0,Ze.push({glyph:Ne,imageName:Mi,x:de,y:be+_i,vertical:Oi,scale:fi,localGlyph:pn.localGlyph,fontStack:bi.fontStack,sectionIndex:qi,metrics:pn,rect:mi}),de+=Zi*fi+Rt):(Ze.push({glyph:Ne,imageName:Mi,x:de,y:be+_i,vertical:Oi,scale:fi,localGlyph:pn.localGlyph,fontStack:bi.fontStack,sectionIndex:qi,metrics:pn,rect:mi}),de+=pn.advance*fi+Rt)}0!==Ze.length&&(ne=Math.max(de-Rt,ne),Ee?ig(Ze,Nt,ti,ki,bt*Be/2):ig(Ze,Nt,ti,0,bt/2)),de=0;const Sn=bt*Be+ti;He.lineOffset=Math.max(ti,oi),be+=Sn,++fe}var $t;const Qe=be,{horizontalAlign:Je,verticalAlign:pi}=Xp(St);(function(Ce,Be,oi,He,Ze,ti){const ei=(Be-oi)*Ze,ki=-ti*He;for(const Sn of Ce)for(const De of Sn.positionedGlyphs)De.x+=ei,De.y+=ki})(nt.positionedLines,Nt,Je,pi,ne,Qe),nt.top+=-pi*Qe,nt.bottom=nt.top+Qe,nt.left+=-Je*ne,nt.right=nt.left+ne,nt.hasBaseline=Ee}(ct,t,n,s,X,g,y,b,E,w,k,B),!function(nt){for(const ft of nt)if(0!==ft.positionedGlyphs.length)return!1;return!0}(tt)&&ct}const bd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},__={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Km(i,t,n,s,h,f){if(t.imageName){const g=s[t.imageName];return g?g.displaySize[0]*t.scale*24/f+h:0}{const g=n[t.fontStack],y=g&&g.glyphs[i];return y?y.metrics.advance*t.scale+h:0}}function Qm(i,t,n,s){const h=Math.pow(i-t,2);return s?i<t?h/2:2*h:h+Math.abs(n)*n}function y_(i,t,n){let s=0;return 10===i&&(s-=1e4),n&&(s+=150),40!==i&&65288!==i||(s+=50),41!==t&&65289!==t||(s+=50),s}function tg(i,t,n,s,h,f){let g=null,y=Qm(t,n,h,f);for(const b of s){const w=Qm(t-b.x,n,h,f)+b.badness;w<=y&&(g=b,y=w)}return{index:i,x:t,priorBreak:g,badness:y}}function eg(i){return i?eg(i.priorBreak).concat(i.index):[]}function Wp(i,t,n,s,h,f,g){if("point"!==f)return[];if(!i)return[];const y=[],b=function(k,F,P,B,N,X){let it=0;for(let K=0;K<k.length();K++){const tt=k.getSection(K);it+=Km(k.getCharCode(K),tt,B,N,F,X)}return it/Math.max(1,Math.ceil(it/P))}(i,t,n,s,h,g),w=i.text.indexOf("\u200b")>=0;let S=0;for(let k=0;k<i.length();k++){const F=i.getSection(k),P=i.getCharCode(k);if(bd[P]||(S+=Km(P,F,s,h,t,g)),k<i.length()-1){const B=!((E=P)<11904||!(Mc(E)||Nu(E)||Ec(E)||Uh(E)||Sc(E)||ko(E)||Uu(E)||vl(E)||Zr(E)||ua(E)||ju(E)||Dc(E)||xl(E)||qr(E)||yl(E)||Ac(E)||qn(E)||Tc(E)||qu(E)||ha(E)));(__[P]||B||F.imageName)&&y.push(tg(k+1,S,b,y,y_(P,i.getCharCode(k+1),B&&w),!1))}}var E;return eg(tg(i.length(),S,b,y,0,!0))}function Xp(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function ig(i,t,n,s,h){if(!(t||n||s||h))return;const f=i.length-1,g=i[f],y=(g.x+g.metrics.advance*g.scale)*t;for(let b=0;b<=f;b++)i[b].x-=y,i[b].y+=n+s+h}function v_(i,t,n){const{horizontalAlign:s,verticalAlign:h}=Xp(n),f=t[0]-i.displaySize[0]*s,g=t[1]-i.displaySize[1]*h;return{image:i,top:g,bottom:g+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function ng(i,t,n,s,h,f){const g=i.image;let y;if(g.content){const N=g.content,X=g.pixelRatio||1;y=[N[0]/X,N[1]/X,g.displaySize[0]-N[2]/X,g.displaySize[1]-N[3]/X]}const b=t.left*f,w=t.right*f;let S,E,k,F;"width"===n||"both"===n?(F=h[0]+b-s[3],E=h[0]+w+s[1]):(F=h[0]+(b+w-g.displaySize[0])/2,E=F+g.displaySize[0]);const P=t.top*f,B=t.bottom*f;return"height"===n||"both"===n?(S=h[1]+P-s[0],k=h[1]+B+s[2]):(S=h[1]+(P+B-g.displaySize[1])/2,k=S+g.displaySize[1]),{image:g,top:S,right:E,bottom:k,left:F,collisionPadding:y}}class Uo extends jt{constructor(t,n,s,h,f){super(t,n),this.angle=h,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new Uo(this.x,this.y,this.z,this.angle,this.segment)}}function Jp(i,t,n,s,h){if(void 0===t.segment)return!0;let f=t,g=t.segment+1,y=0;for(;y>-n/2;){if(g--,g<0)return!1;y-=i[g].dist(f),f=i[g]}y+=i[g].dist(i[g+1]),g++;const b=[];let w=0;for(;y<n/2;){const S=i[g],E=i[g+1];if(!E)return!1;let k=i[g-1].angleTo(S)-S.angleTo(E);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:k}),w+=k;y-b[0].distance>s;)w-=b.shift().angleDelta;if(w>h)return!1;g++,y+=S.dist(E)}return!0}function rg(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function og(i,t,n){return i?.6*t*n:0}function sg(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function x_(i,t,n,s,h,f){const g=og(n,h,f),y=sg(n,s)*f;let b=0;const w=rg(i)/2;for(let S=0;S<i.length-1;S++){const E=i[S],k=i[S+1],F=E.dist(k);if(b+F>w){const P=(w-b)/F,B=Fe(E.x,k.x,P),N=Fe(E.y,k.y,P),X=new Uo(B,N,0,k.angleTo(E),S);return!g||Jp(i,X,y,g,t)?X:void 0}b+=F}}function b_(i,t,n,s,h,f,g,y,b){const w=og(s,f,g),S=sg(s,h),E=S*g,k=0===i[0].x||i[0].x===b||0===i[0].y||i[0].y===b;return t-E<t/4&&(t=E+t/4),ag(i,k?t/2*y%t:(S/2+2*f)*g*y%t,t,w,n,E,k,!1,b)}function ag(i,t,n,s,h,f,g,y,b){const w=f/2,S=rg(i);let E=0,k=t-n,F=[];for(let P=0;P<i.length-1;P++){const B=i[P],N=i[P+1],X=B.dist(N),it=N.angleTo(B);for(;k+n<E+X;){k+=n;const K=(k-E)/X,tt=Fe(B.x,N.x,K),ct=Fe(B.y,N.y,K);if(tt>=0&&tt<b&&ct>=0&&ct<b&&k-w>=0&&k+w<=S){const nt=new Uo(tt,ct,0,it,P);nt._round(),s&&!Jp(i,nt,f,s,h)||F.push(nt)}}E+=X}return y||F.length||g||(F=ag(i,E/2,n,s,h,f,g,!0,b)),F}function lg(i,t,n,s,h){const f=[];for(let g=0;g<i.length;g++){const y=i[g];let b;for(let w=0;w<y.length-1;w++){let S=y[w],E=y[w+1];S.x<t&&E.x<t||(S.x<t?S=new jt(t,S.y+(t-S.x)/(E.x-S.x)*(E.y-S.y))._round():E.x<t&&(E=new jt(t,S.y+(t-S.x)/(E.x-S.x)*(E.y-S.y))._round()),S.y<n&&E.y<n||(S.y<n?S=new jt(S.x+(n-S.y)/(E.y-S.y)*(E.x-S.x),n)._round():E.y<n&&(E=new jt(S.x+(n-S.y)/(E.y-S.y)*(E.x-S.x),n)._round()),S.x>=s&&E.x>=s||(S.x>=s?S=new jt(s,S.y+(s-S.x)/(E.x-S.x)*(E.y-S.y))._round():E.x>=s&&(E=new jt(s,S.y+(s-S.x)/(E.x-S.x)*(E.y-S.y))._round()),S.y>=h&&E.y>=h||(S.y>=h?S=new jt(S.x+(h-S.y)/(E.y-S.y)*(E.x-S.x),h)._round():E.y>=h&&(E=new jt(S.x+(h-S.y)/(E.y-S.y)*(E.x-S.x),h)._round()),b&&S.equals(b[b.length-1])||(b=[S],f.push(b)),b.push(E)))))}}return f}Jt(Uo,"Anchor");const _h=1e20;function cg(i,t,n,s,h,f,g,y,b){for(let w=t;w<t+s;w++)ug(i,n*f+w,f,h,g,y,b);for(let w=n;w<n+h;w++)ug(i,w*f+t,1,s,g,y,b)}function ug(i,t,n,s,h,f,g){f[0]=0,g[0]=-_h,g[1]=_h,h[0]=i[t];for(let y=1,b=0,w=0;y<s;y++){h[y]=i[t+y*n];const S=y*y;do{const E=f[b];w=(h[y]-h[E]+S-E*E)/(y-E)/2}while(w<=g[b]&&--b>-1);b++,f[b]=y,g[b]=w,g[b+1]=_h}for(let y=0,b=0;y<s;y++){for(;g[b+1]<y;)b++;const w=f[b],S=y-w;i[t+y*n]=h[w]+S*S}}const Kp={none:0,ideographs:1,all:2};class Jc{constructor(t,n,s){this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,n){const s=[];for(const h in t)for(const f of t[h])s.push({stack:h,id:f});Ji(s,({stack:h,id:f},g)=>{let y=this.entries[h];y||(y=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[f];if(void 0!==b)return void g(null,{stack:h,id:f,glyph:b});if(b=this._tinySDF(y,h,f),b)return y.glyphs[f]=b,void g(null,{stack:h,id:f,glyph:b});const w=Math.floor(f/256);if(256*w>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void g(null,{stack:h,id:f,glyph:b});let S=y.requests[w];S||(S=y.requests[w]=[],Jc.loadGlyphRange(h,w,this.url,this.requestManager,(E,k)=>{if(k){y.ascender=k.ascender,y.descender=k.descender;for(const F in k.glyphs)this._doesCharSupportLocalGlyph(+F)||(y.glyphs[+F]=k.glyphs[+F]);y.ranges[w]=!0}for(const F of S)F(E,k);delete y.requests[w]})),S.push((E,k)=>{E?g(E):k&&g(null,{stack:h,id:f,glyph:k.glyphs[f]||null})})},(h,f)=>{if(h)n(h);else if(f){const g={};for(const{stack:y,id:b,glyph:w}of f)void 0===g[y]&&(g[y]={}),void 0===g[y].glyphs&&(g[y].glyphs={}),g[y].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;n(null,g)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Kp.none&&(this.localGlyphMode===Kp.all?!!this.localFontFamily:!!this.localFontFamily&&(ua(t)||Zu(t)||xl(t)||qn(t)||vl(t)))}_tinySDF(t,n,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let f=t.tinySDF;if(!f){let B="400";/bold/i.test(n)?B="900":/medium/i.test(n)?B="500":/light/i.test(n)&&(B="200"),f=t.tinySDF=new Jc.TinySDF({fontFamily:h,fontWeight:B,fontSize:48,buffer:6,radius:16}),f.fontWeight=B}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const g=String.fromCharCode(s),{data:y,width:b,height:w,glyphWidth:S,glyphHeight:E,glyphLeft:k,glyphTop:F,glyphAdvance:P}=f.draw(g);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new Bo({width:b,height:w},y),metrics:{width:S/2,height:E/2,left:k/2,top:F/2-27,advance:P/2,localGlyph:!0}}}}function hg(i,t,n,s){const h=[],f=i.image,g=f.pixelRatio,y=f.paddedRect.w-2,b=f.paddedRect.h-2,w=i.right-i.left,S=i.bottom-i.top,E=f.stretchX||[[0,y]],k=f.stretchY||[[0,b]],F=(bt,St)=>bt+St[1]-St[0],P=E.reduce(F,0),B=k.reduce(F,0),N=y-P,X=b-B;let it=0,K=P,tt=0,ct=B,nt=0,ft=N,vt=0,Mt=X;if(f.content&&s){const bt=f.content;it=wd(E,0,bt[0]),tt=wd(k,0,bt[1]),K=wd(E,bt[0],bt[2]),ct=wd(k,bt[1],bt[3]),nt=bt[0]-it,vt=bt[1]-tt,ft=bt[2]-bt[0]-K,Mt=bt[3]-bt[1]-ct}const Pt=(bt,St,Ot,Tt)=>{const Rt=Cd(bt.stretch-it,K,w,i.left),It=Md(bt.fixed-nt,ft,bt.stretch,P),Ht=Cd(St.stretch-tt,ct,S,i.top),de=Md(St.fixed-vt,Mt,St.stretch,B),be=Cd(Ot.stretch-it,K,w,i.left),ne=Md(Ot.fixed-nt,ft,Ot.stretch,P),Nt=Cd(Tt.stretch-tt,ct,S,i.top),Ee=Md(Tt.fixed-vt,Mt,Tt.stretch,B),fe=new jt(Rt,Ht),$t=new jt(be,Ht),Qe=new jt(be,Nt),Je=new jt(Rt,Nt),pi=new jt(It/g,de/g),Ce=new jt(ne/g,Ee/g),Be=t*Math.PI/180;if(Be){const Ze=Math.sin(Be),ti=Math.cos(Be),ei=[ti,-Ze,Ze,ti];fe._matMult(ei),$t._matMult(ei),Je._matMult(ei),Qe._matMult(ei)}const oi=bt.stretch+bt.fixed,He=St.stretch+St.fixed;return{tl:fe,tr:$t,bl:Je,br:Qe,tex:{x:f.paddedRect.x+1+oi,y:f.paddedRect.y+1+He,w:Ot.stretch+Ot.fixed-oi,h:Tt.stretch+Tt.fixed-He},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pi,pixelOffsetBR:Ce,minFontScaleX:ft/g/w,minFontScaleY:Mt/g/S,isSDF:n}};if(s&&(f.stretchX||f.stretchY)){const bt=dg(E,N,P),St=dg(k,X,B);for(let Ot=0;Ot<bt.length-1;Ot++){const Tt=bt[Ot],Rt=bt[Ot+1];for(let It=0;It<St.length-1;It++)h.push(Pt(Tt,St[It],Rt,St[It+1]))}}else h.push(Pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return h}function wd(i,t,n){let s=0;for(const h of i)s+=Math.max(t,Math.min(n,h[1]))-Math.max(t,Math.min(n,h[0]));return s}function dg(i,t,n){const s=[{fixed:-1,stretch:0}];for(const[h,f]of i){const g=s[s.length-1];s.push({fixed:h-g.stretch,stretch:g.stretch}),s.push({fixed:h-g.stretch,stretch:g.stretch+(f-h)})}return s.push({fixed:t+1,stretch:n}),s}function Cd(i,t,n,s){return i/t*n+s}function Md(i,t,n,s){return i-t*n/s}function w_(i,t,n,s){const h=t+i.positionedLines[s].lineOffset;return 0===s?n+h/2:n+(h+(t+i.positionedLines[s-1].lineOffset))/2}Jc.loadGlyphRange=function(i,t,n,s,h){const f=256*t,g=f+255,y=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${f}-${g}`),ut.Glyphs);_t(y,(b,w)=>{if(b)h(b);else if(w){const S={},E=new mh(w).readFields(f_,{});for(const k of E.glyphs)S[k.id]=k;h(null,{glyphs:S,ascender:E.ascender,descender:E.descender})}})},Jc.TinySDF=class{constructor({fontSize:i=24,buffer:t=3,radius:n=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=n;const y=this.size=i+4*t,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${g} ${f} ${i}px ${h}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(i){const t=document.createElement("canvas");return t.width=t.height=i,t}draw(i){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(i),g=Math.ceil(n),y=Math.min(this.size-this.buffer,Math.ceil(f-h)),b=Math.min(this.size-this.buffer,g+Math.ceil(s)),w=y+2*this.buffer,S=b+2*this.buffer,E=Math.max(w*S,0),k=new Uint8ClampedArray(E),F={data:k,width:w,height:S,glyphWidth:y,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(0===y||0===b)return F;const{ctx:P,buffer:B,gridInner:N,gridOuter:X}=this;P.clearRect(B,B,y,b),P.fillText(i,B,B+g);const it=P.getImageData(B,B,y,b);X.fill(_h,0,E),N.fill(0,0,E);for(let K=0;K<b;K++)for(let tt=0;tt<y;tt++){const ct=it.data[4*(K*y+tt)+3]/255;if(0===ct)continue;const nt=(K+B)*w+tt+B;if(1===ct)X[nt]=0,N[nt]=_h;else{const ft=.5-ct;X[nt]=ft>0?ft*ft:0,N[nt]=ft<0?ft*ft:0}}cg(X,0,0,w,S,w,this.f,this.v,this.z),cg(N,B,B,y,b,w,this.f,this.v,this.z);for(let K=0;K<E;K++){const tt=Math.sqrt(X[K])-Math.sqrt(N[K]);k[K]=Math.round(255-255*(tt/this.radius+this.cutoff))}return F}};class C_{constructor(t=[],n=M_){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:s}=this,h=n[t];for(;t>0;){const f=t-1>>1,g=n[f];if(s(h,g)>=0)break;n[t]=g,t=f}n[t]=h}_down(t){const{data:n,compare:s}=this,h=this.length>>1,f=n[t];for(;t<h;){let g=1+(t<<1),y=n[g];const b=g+1;if(b<this.length&&s(n[b],y)<0&&(g=b,y=n[b]),s(y,f)>=0)break;n[t]=y,t=g}n[t]=f}}function M_(i,t){return i<t?-1:i>t?1:0}function A_(i,t=1,n=!1){let s=1/0,h=1/0,f=-1/0,g=-1/0;const y=i[0];for(let F=0;F<y.length;F++){const P=y[F];(!F||P.x<s)&&(s=P.x),(!F||P.y<h)&&(h=P.y),(!F||P.x>f)&&(f=P.x),(!F||P.y>g)&&(g=P.y)}const b=Math.min(f-s,g-h);let w=b/2;const S=new C_([],S_);if(0===b)return new jt(s,h);for(let F=s;F<f;F+=b)for(let P=h;P<g;P+=b)S.push(new Kc(F+w,P+w,w,i));let E=function(F){let P=0,B=0,N=0;const X=F[0];for(let it=0,K=X.length,tt=K-1;it<K;tt=it++){const ct=X[it],nt=X[tt],ft=ct.x*nt.y-nt.x*ct.y;B+=(ct.x+nt.x)*ft,N+=(ct.y+nt.y)*ft,P+=3*ft}return new Kc(B/P,N/P,0,F)}(i),k=S.length;for(;S.length;){const F=S.pop();(F.d>E.d||!E.d)&&(E=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,k)),F.max-E.d<=t||(w=F.h/2,S.push(new Kc(F.p.x-w,F.p.y-w,w,i)),S.push(new Kc(F.p.x+w,F.p.y-w,w,i)),S.push(new Kc(F.p.x-w,F.p.y+w,w,i)),S.push(new Kc(F.p.x+w,F.p.y+w,w,i)),k+=4)}return n&&(console.log(`num probes: ${k}`),console.log(`best distance: ${E.d}`)),E.p}function S_(i,t){return t.max-i.max}function Kc(i,t,n,s){this.p=new jt(i,t),this.h=n,this.d=function(h,f){let g=!1,y=1/0;for(let b=0;b<f.length;b++){const w=f[b];for(let S=0,E=w.length,k=E-1;S<E;k=S++){const F=w[S],P=w[k];F.y>h.y!=P.y>h.y&&h.x<(P.x-F.x)*(h.y-F.y)/(P.y-F.y)+F.x&&(g=!g),y=Math.min(y,_p(h,F,P))}}return(g?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Qp=Number.POSITIVE_INFINITY,T_=Math.sqrt(2);function pg(i,t){return t[1]!==Qp?function(n,s,h){let f=0,g=0;switch(s=Math.abs(s),h=Math.abs(h),n){case"top-right":case"top-left":case"top":g=h-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-h}switch(n){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,g]}(i,t[0],t[1]):function(n,s){let h=0,f=0;s<0&&(s=0);const g=s/T_;switch(n){case"top-right":case"top-left":f=g-7;break;case"bottom-right":case"bottom-left":f=7-g;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(n){case"top-right":case"bottom-right":h=-g;break;case"top-left":case"bottom-left":h=g;break;case"left":h=s;break;case"right":h=-s}return[h,f]}(i,t[0])}function E_(i,t,n,s,h,f,g,y,b,w){i.createArrays(),i.tilePixelRatio=ce/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const S=i.layers[0].layout,E=i.layers[0]._unevaluatedLayout._values,k={};if("composite"===i.textSizeData.kind){const{minZoom:B,maxZoom:N}=i.textSizeData;k.compositeTextSizes=[E["text-size"].possiblyEvaluate(new q(B),y),E["text-size"].possiblyEvaluate(new q(N),y)]}if("composite"===i.iconSizeData.kind){const{minZoom:B,maxZoom:N}=i.iconSizeData;k.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new q(B),y),E["icon-size"].possiblyEvaluate(new q(N),y)]}k.layoutTextSize=E["text-size"].possiblyEvaluate(new q(b+1),y),k.layoutIconSize=E["icon-size"].possiblyEvaluate(new q(b+1),y),k.textMaxSize=E["text-size"].possiblyEvaluate(new q(18),y);const F="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),P=S.get("text-size");for(const B of i.features){const N=S.get("text-font").evaluate(B,{},y).join(","),X=P.evaluate(B,{},y),it=k.layoutTextSize.evaluate(B,{},y),K=(k.layoutIconSize.evaluate(B,{},y),{horizontal:{},vertical:void 0}),tt=B.text;let ct,nt=[0,0];if(tt){const Mt=tt.toString(),Pt=24*S.get("text-letter-spacing").evaluate(B,{},y),bt=24*S.get("text-line-height").evaluate(B,{},y),St=jh(Mt)?Pt:0,Ot=S.get("text-anchor").evaluate(B,{},y),Tt=S.get("text-variable-anchor");if(!Tt){const ne=S.get("text-radial-offset").evaluate(B,{},y);nt=ne?pg(Ot,[24*ne,Qp]):S.get("text-offset").evaluate(B,{},y).map(Nt=>24*Nt)}let Rt=F?"center":S.get("text-justify").evaluate(B,{},y);const It=S.get("symbol-placement"),Ht="point"===It,de="point"===It?24*S.get("text-max-width").evaluate(B,{},y):0,be=ne=>{i.allowVerticalPlacement&&Do(Mt)&&(K.vertical=Yp(tt,t,n,h,N,de,bt,Ot,ne,St,nt,cr.vertical,!0,It,it,X))};if(!F&&Tt){const ne="auto"===Rt?Tt.map(Ee=>tf(Ee)):[Rt];let Nt=!1;for(let Ee=0;Ee<ne.length;Ee++){const fe=ne[Ee];if(!K.horizontal[fe])if(Nt)K.horizontal[fe]=K.horizontal[0];else{const $t=Yp(tt,t,n,h,N,de,bt,"center",fe,St,nt,cr.horizontal,!1,It,it,X);$t&&(K.horizontal[fe]=$t,Nt=1===$t.positionedLines.length)}}be("left")}else{if("auto"===Rt&&(Rt=tf(Ot)),Ht||S.get("text-writing-mode").indexOf("horizontal")>=0||!Do(Mt)){const ne=Yp(tt,t,n,h,N,de,bt,Ot,Rt,St,nt,cr.horizontal,!1,It,it,X);ne&&(K.horizontal[Rt]=ne)}be("point"===It?"left":Rt)}}let ft=!1;if(B.icon&&B.icon.name){const Mt=s[B.icon.name];Mt&&(ct=v_(h[B.icon.name],S.get("icon-offset").evaluate(B,{},y),S.get("icon-anchor").evaluate(B,{},y)),ft=Mt.sdf,void 0===i.sdfIcons?i.sdfIcons=Mt.sdf:i.sdfIcons!==Mt.sdf&&ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Mt.pixelRatio!==i.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}const vt=mg(K.horizontal)||K.vertical;i.iconsInText||(i.iconsInText=!!vt&&vt.iconsInText),(vt||ct)&&k_(i,B,K,ct,s,k,it,0,nt,ft,g,y,w)}f&&i.generateCollisionDebugBuffers(b,i.collisionBoxArray)}function tf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function k_(i,t,n,s,h,f,g,y,b,w,S,E,k){let F=f.textMaxSize.evaluate(t,{},E);void 0===F&&(F=g);const P=i.layers[0].layout,B=P.get("icon-offset").evaluate(t,{},E),N=mg(n.horizontal)||n.vertical,X="globe"===k.name,it=g/24,K=i.tilePixelRatio*F/24,tt=(St=i.overscaling,i.zoom>18&&St>2&&(St>>=1),Math.max(ce/(512*St),1)*P.get("symbol-spacing")),ct=P.get("text-padding")*i.tilePixelRatio,nt=P.get("icon-padding")*i.tilePixelRatio,ft=_e(P.get("text-max-angle")),vt="map"===P.get("text-rotation-alignment")&&"point"!==P.get("symbol-placement"),Mt="map"===P.get("icon-rotation-alignment")&&"point"!==P.get("symbol-placement"),Pt=P.get("symbol-placement"),bt=tt/2;var St;const Ot=P.get("icon-text-fit");let Tt;s&&"none"!==Ot&&(i.allowVerticalPlacement&&n.vertical&&(Tt=ng(s,n.vertical,Ot,P.get("icon-text-fit-padding"),B,it)),N&&(s=ng(s,N,Ot,P.get("icon-text-fit-padding"),B,it)));const Rt=(It,Ht,de)=>{if(Ht.x<0||Ht.x>=ce||Ht.y<0||Ht.y>=ce)return;let be=null;if(X){const{x:ne,y:Nt,z:Ee}=k.projectTilePoint(Ht.x,Ht.y,de);be={anchor:new Uo(ne,Nt,Ee,0,void 0),up:k.upVector(de,Ht.x,Ht.y)}}!function(ne,Nt,Ee,fe,$t,Qe,Je,pi,Ce,Be,oi,He,Ze,ti,ei,ki,Sn,De,bi,qi,Ne,fi,pn,mi,Mi){const Zi=ne.addToLineVertexArray(Nt,fe);let _i,Oi,on,Fi,Er,Wl,uu,Xl=0,Ah=0,Og=0,zf=0,Zd=-1,Hd=-1;const kr={};let $d=Ic("");const Ea=Ee?Ee.anchor:Nt;let Sh=0,Th=0;if(void 0===Ce._unevaluatedLayout.getValue("text-radial-offset")?[Sh,Th]=Ce.layout.get("text-offset").evaluate(Ne,{},Mi).map(Ln=>24*Ln):(Sh=24*Ce.layout.get("text-radial-offset").evaluate(Ne,{},Mi),Th=Qp),ne.allowVerticalPlacement&&$t.vertical){const Ln=$t.vertical;if(ei)Wl=ef(Ln),pi&&(uu=ef(pi));else{const Rn=Ce.layout.get("text-rotate").evaluate(Ne,{},Mi)+90;on=Ad(Be,Ea,Nt,oi,He,Ze,Ln,ti,Rn,ki),pi&&(Fi=Ad(Be,Ea,Nt,oi,He,Ze,pi,De,Rn))}}if(Qe){const Ln=Ce.layout.get("icon-rotate").evaluate(Ne,{},Mi),Rn="none"!==Ce.layout.get("icon-text-fit"),Fs=hg(Qe,Ln,pn,Rn),Bf=pi?hg(pi,Ln,pn,Rn):void 0;Oi=Ad(Be,Ea,Nt,oi,He,Ze,Qe,De,Ln),Xl=4*Fs.length;const Yd=ne.iconSizeData;let ue=null;"source"===Yd.kind?(ue=[lr*Ce.layout.get("icon-size").evaluate(Ne,{},Mi)],ue[0]>Ca&&ci(`${ne.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Yd.kind&&(ue=[lr*fi.compositeIconSizes[0].evaluate(Ne,{},Mi),lr*fi.compositeIconSizes[1].evaluate(Ne,{},Mi)],(ue[0]>Ca||ue[1]>Ca)&&ci(`${ne.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ne.addSymbols(ne.icon,Fs,ue,qi,bi,Ne,!1,Ee,Nt,Zi.lineStartIndex,Zi.lineLength,-1,mi,Mi),Zd=ne.icon.placedSymbolArray.length-1,Bf&&(Ah=4*Bf.length,ne.addSymbols(ne.icon,Bf,ue,qi,bi,Ne,cr.vertical,Ee,Nt,Zi.lineStartIndex,Zi.lineLength,-1,mi,Mi),Hd=ne.icon.placedSymbolArray.length-1)}for(const Ln in $t.horizontal){const Rn=$t.horizontal[Ln];_i||($d=Ic(Rn.text),ei?Er=ef(Rn):_i=Ad(Be,Ea,Nt,oi,He,Ze,Rn,ti,Ce.layout.get("text-rotate").evaluate(Ne,{},Mi),ki));const Fs=1===Rn.positionedLines.length;if(Og+=fg(ne,Ee,Nt,Rn,Je,Ce,ei,Ne,ki,Zi,$t.vertical?cr.horizontal:cr.horizontalOnly,Fs?Object.keys($t.horizontal):[Ln],kr,Zd,fi,mi,Mi),Fs)break}$t.vertical&&(zf+=fg(ne,Ee,Nt,$t.vertical,Je,Ce,ei,Ne,ki,Zi,cr.vertical,["vertical"],kr,Hd,fi,mi,Mi));let Yo=-1;const Eh=(Ln,Rn)=>Ln?Math.max(Ln,Rn):Rn;Yo=Eh(Er,Yo),Yo=Eh(Wl,Yo),Yo=Eh(uu,Yo);const Fg=Yo>-1?1:0;ne.glyphOffsetArray.length>=Ds.MAX_GLYPHS&&ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ne.sortKey&&ne.addToSortKeyRanges(ne.symbolInstances.length,Ne.sortKey),ne.symbolInstances.emplaceBack(Ea.x,Ea.y,Ea.z,Nt.x,Nt.y,kr.right>=0?kr.right:-1,kr.center>=0?kr.center:-1,kr.left>=0?kr.left:-1,kr.vertical>=0?kr.vertical:-1,Zd,Hd,$d,void 0!==_i?_i:ne.collisionBoxArray.length,void 0!==_i?_i+1:ne.collisionBoxArray.length,void 0!==on?on:ne.collisionBoxArray.length,void 0!==on?on+1:ne.collisionBoxArray.length,void 0!==Oi?Oi:ne.collisionBoxArray.length,void 0!==Oi?Oi+1:ne.collisionBoxArray.length,Fi||ne.collisionBoxArray.length,Fi?Fi+1:ne.collisionBoxArray.length,oi,Og,zf,Xl,Ah,Fg,0,Sh,Th,Yo)}(i,Ht,be,It,n,s,h,Tt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ct,vt,b,0,nt,Mt,B,t,f,w,S,E)};if("line"===Pt)for(const It of lg(t.geometry,0,0,ce,ce)){const Ht=b_(It,tt,ft,n.vertical||N,s,24,K,i.overscaling,ce);for(const de of Ht){const be=N;be&&D_(i,be.text,bt,de)||Rt(It,de,E)}}else if("line-center"===Pt){for(const It of t.geometry)if(It.length>1){const Ht=x_(It,ft,n.vertical||N,s,24,K);Ht&&Rt(It,Ht,E)}}else if("Polygon"===t.type)for(const It of Gc(t.geometry,0)){const Ht=A_(It,16);Rt(It[0],new Uo(Ht.x,Ht.y,0,0,void 0),E)}else if("LineString"===t.type)for(const It of t.geometry)Rt(It,new Uo(It[0].x,It[0].y,0,0,void 0),E);else if("Point"===t.type)for(const It of t.geometry)for(const Ht of It)Rt([Ht],new Uo(Ht.x,Ht.y,0,0,void 0),E)}const Ca=32640;function fg(i,t,n,s,h,f,g,y,b,w,S,E,k,F,P,B,N){const X=function(tt,ct,nt,ft,vt,Mt,Pt,bt){const St=[];if(0===ct.positionedLines.length)return St;const Ot=ft.layout.get("text-rotate").evaluate(Mt,{})*Math.PI/180,Tt=function(be){const ne=be[0],Nt=be[1],Ee=ne*Nt;return Ee>0?[ne,-Nt]:Ee<0?[-ne,Nt]:0===ne?[Nt,ne]:[Nt,-ne]}(nt);let Rt=Math.abs(ct.top-ct.bottom);for(const be of ct.positionedLines)Rt-=be.lineOffset;const It=ct.positionedLines.length,Ht=Rt/It;let de=ct.top-nt[1];for(let be=0;be<It;++be){const ne=ct.positionedLines[be];de=w_(ct,Ht,de,be);for(const Nt of ne.positionedGlyphs){if(!Nt.rect)continue;const Ee=Nt.rect||{};let fe=4,$t=!0,Qe=1,Je=0;if(Nt.imageName){const mi=Pt[Nt.imageName];if(!mi)continue;if(mi.sdf){ci("SDF images are not supported in formatted text and will be ignored.");continue}$t=!1,Qe=mi.pixelRatio,fe=1/Qe}const pi=(vt||bt)&&Nt.vertical,Ce=Nt.metrics.advance*Nt.scale/2,Be=Nt.metrics,oi=Nt.rect;if(null===oi)continue;bt&&ct.verticalizable&&(Je=Nt.imageName?Ce-Nt.metrics.width*Nt.scale/2:0);const He=vt?[Nt.x+Ce,Nt.y]:[0,0];let Ze=[0,0],ti=[0,0],ei=!1;vt||(pi?(ti=[Nt.x+Ce+Tt[0],Nt.y+Tt[1]-Je],ei=!0):Ze=[Nt.x+Ce+nt[0],Nt.y+nt[1]-Je]);const ki=oi.w*Nt.scale/(Qe*(Nt.localGlyph?2:1)),Sn=oi.h*Nt.scale/(Qe*(Nt.localGlyph?2:1));let De,bi,qi,Ne;if(pi){const mi=Nt.y-de,Mi=new jt(-Ce,Ce-mi),Zi=-Math.PI/2,_i=new jt(...ti);De=new jt(-Ce+Ze[0],Ze[1]),De._rotateAround(Zi,Mi)._add(_i),De.x+=-mi+Ce,De.y-=(Be.left-fe)*Nt.scale;const Oi=Nt.imageName?Be.advance*Nt.scale:24*Nt.scale,on=String.fromCharCode(Nt.glyph);fh(on)?De.x+=(1-fe)*Nt.scale:jp(on)?De.x+=Oi-Be.height*Nt.scale+(-fe-1)*Nt.scale:De.x+=Nt.imageName||Be.width+2*fe===oi.w&&Be.height+2*fe===oi.h?(Oi-Sn)/2:(Oi-(Be.height+2*fe)*Nt.scale)/2,bi=new jt(De.x,De.y-ki),qi=new jt(De.x+Sn,De.y),Ne=new jt(De.x+Sn,De.y-ki)}else{const mi=(Be.left-fe)*Nt.scale-Ce+Ze[0],Mi=(-Be.top-fe)*Nt.scale+Ze[1],Zi=mi+ki,_i=Mi+Sn;De=new jt(mi,Mi),bi=new jt(Zi,Mi),qi=new jt(mi,_i),Ne=new jt(Zi,_i)}if(Ot){let mi;mi=vt?new jt(0,0):ei?new jt(Tt[0],Tt[1]):new jt(nt[0],nt[1]),De._rotateAround(Ot,mi),bi._rotateAround(Ot,mi),qi._rotateAround(Ot,mi),Ne._rotateAround(Ot,mi)}const fi=new jt(0,0),pn=new jt(0,0);St.push({tl:De,tr:bi,bl:qi,br:Ne,tex:Ee,writingMode:ct.writingMode,glyphOffset:He,sectionIndex:Nt.sectionIndex,isSDF:$t,pixelOffsetTL:fi,pixelOffsetBR:pn,minFontScaleX:0,minFontScaleY:0})}}return St}(0,s,b,f,g,y,h,i.allowVerticalPlacement),it=i.textSizeData;let K=null;"source"===it.kind?(K=[lr*f.layout.get("text-size").evaluate(y,{},N)],K[0]>Ca&&ci(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===it.kind&&(K=[lr*P.compositeTextSizes[0].evaluate(y,{},N),lr*P.compositeTextSizes[1].evaluate(y,{},N)],(K[0]>Ca||K[1]>Ca)&&ci(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,X,K,b,g,y,S,t,n,w.lineStartIndex,w.lineLength,F,B,N);for(const tt of E)k[tt]=i.text.placedSymbolArray.length-1;return 4*X.length}function mg(i){for(const t in i)return i[t];return null}function Ad(i,t,n,s,h,f,g,y,b,w){let S=g.top,E=g.bottom,k=g.left,F=g.right;const P=g.collisionPadding;if(P&&(k-=P[0],S-=P[1],F+=P[2],E+=P[3]),b){const B=new jt(k,S),N=new jt(F,S),X=new jt(k,E),it=new jt(F,E),K=_e(b);let tt=new jt(0,0);w&&(tt=new jt(w[0],w[1])),B._rotateAround(K,tt),N._rotateAround(K,tt),X._rotateAround(K,tt),it._rotateAround(K,tt),k=Math.min(B.x,N.x,X.x,it.x),F=Math.max(B.x,N.x,X.x,it.x),S=Math.min(B.y,N.y,X.y,it.y),E=Math.max(B.y,N.y,X.y,it.y)}return i.emplaceBack(t.x,t.y,t.z,n.x,n.y,k,S,F,E,y,s,h,f),i.length-1}function ef(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const t=i.bottom-i.top;return t>0?Math.max(10,t):null}function D_(i,t,n,s){const h=i.compareText;if(t in h){const f=h[t];for(let g=f.length-1;g>=0;g--)if(s.dist(f[g])<n)return!0}else h[t]=[];return h[t].push(s),!1}const I_=Et([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:gg}=I_,_g=Et([{name:"a_pos_3",components:3,type:"Int16"}]);var yh=Et([{name:"a_pos",type:"Int16",components:2}]);const ks=ce/Math.PI/2,nf=2*rr(1,0)*ks*Math.PI,Qc=[64,32,16],no=-ks,ro=ks,O_=[new In([no,no,no],[ro,ro,ro]),new In([no,no,no],[0,0,ro]),new In([0,no,no],[ro,0,ro]),new In([no,0,no],[0,ro,ro]),new In([0,0,no],[ro,ro,ro])];function yg(i,t,n,s=!0){const h=Cr([],i._camera.position,i.worldSize),f=[t,n,1,1];va(f,f,i.pixelMatrixInverse),Mp(f,f,1/f[3]);const g=dn([],Mr([],f,h)),y=i.globeMatrix,b=[y[12],y[13],y[14]],w=Mr([],b,h),S=El(w),E=dn([],w),k=i.worldSize/(2*Math.PI),F=ar(E,g),P=Math.asin(k/S);if(P<Math.acos(F)){if(!s)return null;const Pt=[],bt=[];Cr(Pt,g,S/F),dn(bt,Mr(bt,Pt,w)),dn(g,Cs(g,w,Cr(g,bt,Math.tan(P)*S)))}const B=[];new Bc(h,g).closestPointOnSphere(b,k,B);const N=dn([],Gn(y,0)),X=dn([],Gn(y,1)),it=dn([],Gn(y,2)),K=ar(N,B),tt=ar(X,B),ct=ar(it,B),nt=si(Math.asin(-tt/k));let ft=si(Math.atan2(K,ct));ft=i.center.lng+function(Pt,bt){const St=(bt-Pt+180)%360-180;return St<-180?St+360:St}(i.center.lng,ft);const vt=Xr(ft),Mt=ye(Ro(nt),0,1);return new Cl(vt,Mt)}class F_{constructor(t,n,s){this.a=Mr([],t,s),this.b=Mr([],n,s),this.center=s;const h=dn([],this.a),f=dn([],this.b);this.angle=Math.acos(ar(h,f))}}function rf(i,t){if(0===i.angle)return null;let n;return n=0===i.a[t]?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[t]/i.a[t]/Math.sin(i.angle)-1/Math.tan(i.angle)),n<0||n>1?null:function(s,h,f,g){const y=Math.sin(f);return s*(Math.sin((1-g)*f)/y)+h*(Math.sin(g*f)/y)}(i.a[t],i.b[t],i.angle,ye(n,0,1))+i.center[t]}function jo(i){if(i.z<=1)return O_[i.z+2*i.y+i.x];const t=Td(Sd(i));return In.fromPoints(t)}function vg(i,t){const n=nu(t.zoom);if(0===n)return jo(i);const s=Sd(i),h=Td(s),f=Xr(s.getWest())*t.worldSize,g=Xr(s.getEast())*t.worldSize,y=Ro(s.getNorth())*t.worldSize,b=Ro(s.getSouth())*t.worldSize,w=[f,y,0],S=[g,y,0],E=[f,b,0],k=[g,b,0],F=th([],t.globeMatrix);return Ii(w,w,F),Ii(S,S,F),Ii(E,E,F),Ii(k,k,F),h[0]=os(h[0],E,n),h[1]=os(h[1],k,n),h[2]=os(h[2],S,n),h[3]=os(h[3],w,n),In.fromPoints(h)}function xg(i,t,n,s,h){for(const f of n)Ii(f,f,s),Cr(f,f,h),id(i,i,f),nd(t,t,f)}function Sd({x:i,y:t,z:n}){const s=1/(1<<n),h=new qe(or(i*s),Yi((t+1)*s)),f=new qe(or((i+1)*s),Yi(t*s));return new bs(h,f)}function Td(i){const t=_e(i.getNorth()),n=_e(i.getSouth()),s=Math.cos(t),h=Math.cos(n),f=Math.sin(t),g=Math.sin(n),y=i.getWest(),b=i.getEast();return[Pn(h,g,y),Pn(h,g,b),Pn(s,f,b),Pn(s,f,y)]}function Pn(i,t,n,s=ks){return n=_e(n),[i*Math.sin(n)*s,-t*s,i*Math.cos(n)*s]}function tu(i,t,n){return Pn(Math.cos(_e(i)),Math.sin(_e(i)),t,n)}function eu(i,t,n,s){const h=1<<n.z,f=(i/ce+n.x)/h;return tu(Yi((t/ce+n.y)/h),or(f),s)}function Ed({min:i,max:t}){return 16383/Math.max(t[0]-i[0],t[1]-i[1],t[2]-i[2])}const sf=new Float64Array(16);function Nl(i){const t=Ed(i),n=bp(sf,[t,t,t]);return Fc(n,n,((s=[])[0]=-(h=i.min)[0],s[1]=-h[1],s[2]=-h[2],s));var s,h}function iu(i){const t=(s=i.min,(n=sf)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const h=1/Ed(i);return ya(t,t,[h,h,h])}function kd(i,t,n,s,h){const f=function(b){const w=ce/(2*Math.PI);return b/(2*Math.PI)/w}(n),g=[i,t,-n/(2*Math.PI)],y=An(new Float64Array(16));return Fc(y,y,g),ya(y,y,[f,f,f]),td(y,y,_e(-h)),eh(y,y,_e(-s)),y}function nu(i){return sn(5,6,i)}function af(i,t){const n=tu(t.lat,t.lng);return f=(s=Pc([],function(F){const P=tu(F._center.lat,F._center.lng);let B=rd([],kl(0,1,0),P);const N=sr([],-F.angle,P);B=Ii(B,B,N),sr(N,-F._pitch,B);const X=dn([],P);return Cr(X,X,F.cameraToCenterDistance/F.pixelsPerMeter*nf),Ii(X,X,N),Cs([],P,X)}(i),n))[0],g=s[1],y=s[2],b=(h=n)[0],w=h[1],S=h[2],k=(E=Math.sqrt(f*f+g*g+y*y)*Math.sqrt(b*b+w*w+S*S))&&ar(s,h)/E,Math.acos(Math.min(Math.max(k,-1),1));var s,h,f,g,y,b,w,S,E,k}const ru=_e(85),bg=Math.cos(ru),L_=Math.sin(ru);function lf(i,t){const n=i.fovAboveCenter,s=i.elevation?i.elevation.getMinElevationBelowMSL()*t:0,h=(i._camera.position[2]*i.worldSize-s)/Math.cos(i._pitch),f=Math.sin(n)*h/Math.sin(Math.max(Math.PI/2-i._pitch-n,.01)),g=Math.sin(i._pitch)*f+h;return Math.min(1.01*g,h*(1/i._horizonShift))}function Ul(i,t){if(!t.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:t};const n=Math.pow(2,-i.z),s=i.x*n,h=(i.x+1)*n,f=i.y*n,g=(i.y+1)*n,y=or(s),b=or(h),w=Yi(f),S=Yi(g),E=t.project(y,w),k=t.project(b,w),F=t.project(b,S),P=t.project(y,S);let B=Math.min(E.x,k.x,F.x,P.x),N=Math.min(E.y,k.y,F.y,P.y),X=Math.max(E.x,k.x,F.x,P.x),it=Math.max(E.y,k.y,F.y,P.y);const K=n/16;function tt(nt,ft,vt,Mt,Pt,bt){const St=(vt+Pt)/2,Ot=(Mt+bt)/2,Tt=t.project(or(St),Yi(Ot)),Rt=Math.max(0,B-Tt.x,N-Tt.y,Tt.x-X,Tt.y-it);B=Math.min(B,Tt.x),X=Math.max(X,Tt.x),N=Math.min(N,Tt.y),it=Math.max(it,Tt.y),Rt>K&&(tt(nt,Tt,vt,Mt,St,Ot),tt(Tt,ft,St,Ot,Pt,bt))}tt(E,k,s,f,h,f),tt(k,F,h,f,h,g),tt(F,P,h,g,s,g),tt(P,E,s,g,s,f),B-=K,N-=K,X+=K,it+=K;const ct=1/Math.max(X-B,it-N);return{scale:ct,x:B*ct,y:N*ct,x2:X*ct,y2:it*ct,projection:t}}const R_=An(new Float32Array(16));class qo{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,n){return{x:0,y:0,z:0}}unproject(t,n){return new qe(0,0)}projectTilePoint(t,n,s){return{x:t,y:n,z:0}}locationPoint(t,n,s=!0){return t._coordinatePoint(t.locationCoordinate(n),s)}pixelsPerMeter(t,n){return rr(1,t)*n}pixelSpaceConversion(t,n,s){return 1}farthestPixelDistance(t){return lf(t,t.pixelsPerMeter)}pointCoordinate(t,n,s,h){const f=t.horizonLineFromTop(!1),g=new jt(n,Math.max(f,s));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}pointCoordinate3D(t,n,s){const h=new jt(n,s);if(t.elevation)return t.elevation.pointCoordinate(h);{const f=this.pointCoordinate(t,h.x,h.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(t,n){if(t.elevation)return!this.pointCoordinate3D(t,n.x,n.y);const s=t.horizonLineFromTop();return n.y<s}createInversionMatrix(t,n){return R_}createTileMatrix(t,n,s){let h,f,g;const y=s.canonical,b=An(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Ul(y,this);h=1,f=w.x+s.wrap*w.scale,g=w.y,ya(b,b,[h/w.scale,h/w.scale,t.pixelsPerMeter/n])}else h=n/t.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*s.wrap)*h,g=y.y*h;return Fc(b,b,[f,g,0]),ya(b,b,[h/ce,h/ce,1]),b}upVector(t,n,s){return[0,0,1]}upVectorScale(t,n,s){return{metersToTile:1}}}class wg extends qo{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[n,s]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(_e(n));this.n=(h+Math.sin(_e(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,n){const{n:s,c:h,r0:f}=this,g=_e(t-this.center[0]),y=_e(n),b=Math.sqrt(h-2*s*Math.sin(y))/s;return{x:b*Math.sin(g*s),y:b*Math.cos(g*s)-f,z:0}}unproject(t,n){const{n:s,c:h,r0:f}=this,g=f+n;let y=Math.atan2(t,Math.abs(g))*Math.sign(g);g*s<0&&(y-=Math.PI*Math.sign(t)*Math.sign(g));const b=_e(this.center[0])*s;y=Dr(y,-Math.PI-b,Math.PI-b);const w=si(y/s)+this.center[0],S=Math.asin(ye((h-(t*t+g*g)*s*s)/(2*s),-1,1)),E=ye(si(S),-85.051129,Jr);return new qe(w,E)}}const ou=1.340264,Zo=-.081106,su=893e-6,jl=.003796,vh=Math.sqrt(3)/2;class cf extends qo{project(t,n){n=n/180*Math.PI,t=t/180*Math.PI;const s=Math.asin(vh*Math.sin(n)),h=s*s,f=h*h*h;return{x:.5*(t*Math.cos(s)/(vh*(ou+3*Zo*h+f*(7*su+9*jl*h)))/Math.PI+.5),y:1-.5*(s*(ou+Zo*h+f*(su+jl*h))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=s*s,f=h*h*h;for(let S,E,k,F=0;F<12&&(E=s*(ou+Zo*h+f*(su+jl*h))-n,k=ou+3*Zo*h+f*(7*su+9*jl*h),S=E/k,s=ye(s-S,-Math.PI/3,Math.PI/3),h=s*s,f=h*h*h,!(Math.abs(S)<1e-12));++F);const g=vh*t*(ou+3*Zo*h+f*(7*su+9*jl*h))/Math.cos(s),y=Math.asin(Math.sin(s)/vh),b=ye(180*g/Math.PI,-180,180),w=ye(180*y/Math.PI,-85.051129,Jr);return new qe(b,w)}}class Ma extends qo{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){return{x:.5+t/360,y:.5-n/360,z:0}}unproject(t,n){const s=360*(t-.5),h=ye(360*(.5-n),-85.051129,Jr);return new qe(s,h)}}const Aa=Math.PI/2;function au(i){return Math.tan((Aa+i)/2)}class Cg extends qo{constructor(t){super(t),this.center=t.center||[0,30];const[n,s]=this.parallels=t.parallels||[30,30],h=_e(n),f=_e(s),g=Math.cos(h);this.n=h===f?Math.sin(h):Math.log(g/Math.cos(f))/Math.log(au(f)/au(h)),this.f=g*Math.pow(au(h),this.n)/this.n}project(t,n){n=_e(n),t=_e(t-this.center[0]);const s=1e-6,{n:h,f}=this;f>0?n<-Aa+s&&(n=-Aa+s):n>Aa-s&&(n=Aa-s);const g=f/Math.pow(au(n),h),y=g*Math.sin(h*t),b=f-g*Math.cos(h*t);return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI,n=(2*(1-n)-.5)*Math.PI;const{n:s,f:h}=this,f=h-n,g=Math.sign(f),y=Math.sign(s)*Math.sqrt(t*t+f*f);let b=Math.atan2(t,Math.abs(f))*g;f*s<0&&(b-=Math.PI*Math.sign(t)*g);const w=ye(si(b/s)+this.center[0],-180,180),S=ye(si(2*Math.atan(Math.pow(h/y,1/s))-Aa),-85.051129,Jr);return new qe(w,S)}}class Dd extends qo{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,n){return{x:Xr(t),y:Ro(n),z:0}}unproject(t,n){const s=or(t),h=Yi(n);return new qe(s,h)}}const uf=_e(Jr);class Mg extends qo{project(t,n){const s=(n=_e(n))*n,h=s*s;return{x:.5*((t=_e(t))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=25,f=0,g=s*s;do{g=s*s;const w=g*g;f=(s*(1.007226+g*(.015085+w*(.028874*g-.044475-.005916*w)))-n)/(1.007226+g*(.045255+w*(.259866*g-.311325-.005916*11*w))),s=ye(s-f,-uf,uf)}while(Math.abs(f)>1e-6&&--h>0);g=s*s;const y=ye(si(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=si(s);return new qe(y,b)}}const hf=_e(Jr);class Ho extends qo{project(t,n){n=_e(n),t=_e(t);const s=Math.cos(n),h=2/Math.PI,f=Math.acos(s*Math.cos(t/2)),g=Math.sin(f)/f,y=.5*(t*h+2*s*Math.sin(t/2)/g)||0,b=.5*(n+Math.sin(n)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(t,n){let s=t=(2*t-.5)*Math.PI,h=n=(2*(1-n)-1)*Math.PI,f=25;const g=1e-6;let y=0,b=0;do{const w=Math.cos(h),S=Math.sin(h),E=2*S*w,k=S*S,F=w*w,P=Math.cos(s/2),B=Math.sin(s/2),N=2*P*B,X=B*B,it=1-F*P*P,K=it?1/it:0,tt=it?Math.acos(w*P)*Math.sqrt(1/it):0,ct=.5*(2*tt*w*B+2*s/Math.PI)-t,nt=.5*(tt*S+h)-n,ft=.5*K*(F*X+tt*w*P*k)+1/Math.PI,vt=K*(N*E/4-tt*S*B),Mt=.125*K*(E*B-tt*S*F*N),Pt=.5*K*(k*P+tt*X*w)+.5,bt=vt*Mt-Pt*ft;y=(nt*vt-ct*Pt)/bt,b=(ct*Mt-nt*ft)/bt,s=ye(s-y,-Math.PI,Math.PI),h=ye(h-b,-hf,hf)}while((Math.abs(y)>g||Math.abs(b)>g)&&--f>0);return new qe(si(s),si(h))}}class df extends qo{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_e(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){const{scale:s,cosPhi:h}=this;return{x:_e(t)*h*s+.5,y:-Math.sin(_e(n))/h*s+.5,z:0}}unproject(t,n){const{scale:s,cosPhi:h}=this,f=-(n-.5)/s,g=ye(si((t-.5)/s)/h,-180,180),y=Math.asin(ye(f*h,-1,1)),b=ye(si(y),-85.051129,Jr);return new qe(g,b)}}class pf extends Dd{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(t,n,s){const h=eu(t,n,s);return Ii(h,h,Nl(jo(s))),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,n){const s=tu(n.lat,n.lng),h=dn([],s),f=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(n),t._centerAltitude):t._centerAltitude;rh(s,s,h,rr(1,0)*ce*f);const g=An(new Float64Array(16));return Tl(g,t.pixelMatrix,t.globeMatrix),Ii(s,s,g),new jt(s[0],s[1])}pixelsPerMeter(t,n){return rr(1,0)*n}pixelSpaceConversion(t,n,s){const h=Fe(rr(1,45)*n,rr(1,t)*n,s);return this.pixelsPerMeter(t,n)/h}createTileMatrix(t,n,s){const h=iu(jo(s.canonical));return Tl(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,n){const{center:s}=t,h=Nl(jo(n));return eh(h,h,_e(s.lng)),td(h,h,_e(s.lat)),ya(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,n,s,h){return yg(t,n,s,!0)||new Cl(0,0)}pointCoordinate3D(t,n,s){const h=this.pointCoordinate(t,n,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,n){return!yg(t,n.x,n.y,!1)}farthestPixelDistance(t){const n=function(h,f){const g=h.cameraToCenterDistance,y=h._centerAltitude*f,b=h._camera,w=h._camera.forward(),S=Cs([],Cr([],w,-g),[0,0,y]),E=h.worldSize/(2*Math.PI),k=[0,0,-E],F=h.width/h.height,P=Math.tan(h.fovAboveCenter),B=Cr([],b.up(),P),N=Cr([],b.right(),P*F),X=dn([],Cs([],Cs([],w,B),N)),it=[];let K;if(new Bc(S,X).closestPointOnSphere(k,E,it)){const tt=Cs([],it,k),ct=Mr([],tt,S);K=Math.cos(h.fovAboveCenter)*El(ct)}else{const tt=Mr([],S,k),ct=Mr([],k,S);dn(ct,ct);const nt=El(tt)-E;K=Math.sqrt(nt*(nt+2*E));const ft=Math.acos(K/(E+nt))-Math.acos(ar(w,ct));K*=Math.cos(ft)}return 1.01*K}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),s=nu(t.zoom);if(s>0){const h=lf(t,rr(1,t.center.lat)*t.worldSize),f=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Fe(n,h+f*(1-Math.cos(g)),Math.pow(s,10))}return n}upVector(t,n,s){return eu(n,s,t,1)}upVectorScale(t){return{metersToTile:nf*Ed(jo(t))}}}function ff(i){const t=i.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(i.name){case"mercator":return new Dd(i);case"equirectangular":return new Ma(i);case"naturalEarth":return new Mg(i);case"equalEarth":return new cf(i);case"winkelTripel":return new Ho(i);case"albers":return n?new df(i):new wg(i);case"lambertConformalConic":return n?new df(i):new Cg(i);case"globe":return new pf(i)}throw new Error(`Invalid projection name: ${i.name}`)}const mf=wa.VectorTileFeature.types,Ag=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xh(i,t,n,s,h,f,g,y,b,w,S,E,k){const F=y?Math.min(Ca,Math.round(y[0])):0,P=y?Math.min(Ca,Math.round(y[1])):0;i.emplaceBack(t,n,Math.round(32*s),Math.round(32*h),f,g,(F<<1)+(b?1:0),P,16*w,16*S,256*E,256*k)}function ql(i,t,n,s,h,f,g){i.emplaceBack(t,n,s,h,f,g)}function Id(i,t,n,s,h){i.emplaceBack(t,n,s,h),i.emplaceBack(t,n,s,h),i.emplaceBack(t,n,s,h),i.emplaceBack(t,n,s,h)}function bh(i){for(const t of i.sections)if(u(t.text))return!0;return!1}class Od{constructor(t){this.layoutVertexArray=new ai,this.indexArray=new Me,this.programConfigurations=t,this.segments=new Ti,this.dynamicLayoutVertexArray=new Te,this.opacityVertexArray=new $e,this.placedSymbolArray=new Hf,this.globeExtVertexArray=new vi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,n,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Nm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ph.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ag,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,r_.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Jt(Od,"SymbolBuffers");class Fd{constructor(t,n,s){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new s,this.segments=new Ti,this.collisionVertexArray=new ni,this.collisionVertexArrayExt=new di}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Um.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,jm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Jt(Fd,"CollisionBuffers");class Ds{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=An([]),this.placementViewportMatrix=An([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bl(this.zoom,n["text-size"]),this.iconSizeData=Bl(this.zoom,n["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(g=>cr[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new Od(new wl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Od(new wl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Zh,this.lineVertexArray=new Hh,this.symbolInstances=new Qd}calculateGlyphDependencies(t,n,s,h,f){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,h&&f){const y=Vl[t.charAt(g)];y&&(n[y.charCodeAt(0)]=!0)}}populate(t,n,s,h){const f=this.layers[0],g=f.layout,y="globe"===this.projection.name,b=g.get("text-font"),w=g.get("text-field"),S=g.get("icon-image"),E=("constant"!==w.value.kind||w.value.value instanceof Qi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),k="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,F=g.get("symbol-sort-key");if(this.features=[],!E&&!k)return;const P=n.iconDependencies,B=n.glyphDependencies,N=n.availableImages,X=new q(this.zoom);for(const{feature:it,id:K,index:tt,sourceLayerIndex:ct}of t){const nt=f._featureFilter.needGeometry,ft=ws(it,nt);if(!f._featureFilter.filter(X,ft,s))continue;if(nt||(ft.geometry=zo(it,s,h)),y&&1!==it.type&&s.z<=5){const bt=ft.geometry,St=.98078528056;for(let Ot=0;Ot<bt.length;Ot++)bt[Ot]=lm(bt[Ot],Tt=>Tt,(Tt,Rt)=>ar(eu(Tt.x,Tt.y,s,1),eu(Rt.x,Rt.y,s,1))<St)}let vt,Mt;if(E){const bt=f.getValueAndResolveTokens("text-field",ft,s,N),St=Qi.factory(bt);bh(St)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===V()||this.hasRTLText&&j.isParsed())&&(vt=Zm(St,f,ft))}if(k){const bt=f.getValueAndResolveTokens("icon-image",ft,s,N);Mt=bt instanceof cn?bt:cn.fromString(bt)}if(!vt&&!Mt)continue;const Pt=this.sortFeaturesByKey?F.evaluate(ft,{},s):void 0;if(this.features.push({id:K,text:vt,icon:Mt,index:tt,sourceLayerIndex:ct,geometry:ft.geometry,properties:it.properties,type:mf[it.type],sortKey:Pt}),Mt&&(P[Mt.name]=!0),vt){const bt=b.evaluate(ft,{},s).join(","),St="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(cr.vertical)>=0;for(const Ot of vt.sections)if(Ot.image)P[Ot.image.name]=!0;else{const Tt=Do(vt.toString()),Rt=Ot.fontStack||bt,It=B[Rt]=B[Rt]||{};this.calculateGlyphDependencies(Ot.text,It,St,this.allowVerticalPlacement,Tt)}}}"line"===g.get("symbol-placement")&&(this.features=function(it){const K={},tt={},ct=[];let nt=0;function ft(bt){ct.push(it[bt]),nt++}function vt(bt,St,Ot){const Tt=tt[bt];return delete tt[bt],tt[St]=Tt,ct[Tt].geometry[0].pop(),ct[Tt].geometry[0]=ct[Tt].geometry[0].concat(Ot[0]),Tt}function Mt(bt,St,Ot){const Tt=K[St];return delete K[St],K[bt]=Tt,ct[Tt].geometry[0].shift(),ct[Tt].geometry[0]=Ot[0].concat(ct[Tt].geometry[0]),Tt}function Pt(bt,St,Ot){const Tt=Ot?St[0][St[0].length-1]:St[0][0];return`${bt}:${Tt.x}:${Tt.y}`}for(let bt=0;bt<it.length;bt++){const St=it[bt],Ot=St.geometry,Tt=St.text?St.text.toString():null;if(!Tt){ft(bt);continue}const Rt=Pt(Tt,Ot),It=Pt(Tt,Ot,!0);if(Rt in tt&&It in K&&tt[Rt]!==K[It]){const Ht=Mt(Rt,It,Ot),de=vt(Rt,It,ct[Ht].geometry);delete K[Rt],delete tt[It],tt[Pt(Tt,ct[de].geometry,!0)]=de,ct[Ht].geometry=null}else Rt in tt?vt(Rt,It,Ot):It in K?Mt(Rt,It,Ot):(ft(bt),K[Rt]=nt-1,tt[It]=nt-1)}return ct.filter(bt=>bt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((it,K)=>it.sortKey-K.sortKey)}update(t,n,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,s,h),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,s,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ff(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const s=this.lineVertexArray.length,h=t.segment;if(void 0!==h){let f=t.dist(n[h+1]),g=t.dist(n[h]);const y={};for(let b=h+1;b<n.length;b++)y[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:f},b<n.length-1&&(f+=n[b+1].dist(n[b]));for(let b=h||0;b>=0;b--)y[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:g},b>0&&(g+=n[b-1].dist(n[b]));for(let b=0;b<n.length;b++){const w=y[b];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,n,s,h,f,g,y,b,w,S,E,k,F,P){const B=t.indexArray,N=t.layoutVertexArray,X=t.globeExtVertexArray,it=t.segments.prepareSegment(4*n.length,N,B,this.canOverlap?g.sortKey:void 0),K=this.glyphOffsetArray.length,tt=it.vertexLength,ct=this.allowVerticalPlacement&&y===cr.vertical?Math.PI/2:0,nt=g.text&&g.text.sections;for(let vt=0;vt<n.length;vt++){const{tl:Mt,tr:Pt,bl:bt,br:St,tex:Ot,pixelOffsetTL:Tt,pixelOffsetBR:Rt,minFontScaleX:It,minFontScaleY:Ht,glyphOffset:de,isSDF:be,sectionIndex:ne}=n[vt],Nt=it.vertexLength,Ee=de[1];if(xh(N,w.x,w.y,Mt.x,Ee+Mt.y,Ot.x,Ot.y,s,be,Tt.x,Tt.y,It,Ht),xh(N,w.x,w.y,Pt.x,Ee+Pt.y,Ot.x+Ot.w,Ot.y,s,be,Rt.x,Tt.y,It,Ht),xh(N,w.x,w.y,bt.x,Ee+bt.y,Ot.x,Ot.y+Ot.h,s,be,Tt.x,Rt.y,It,Ht),xh(N,w.x,w.y,St.x,Ee+St.y,Ot.x+Ot.w,Ot.y+Ot.h,s,be,Rt.x,Rt.y,It,Ht),b){const fe=b.anchor,$t=b.up;ql(X,fe.x,fe.y,fe.z,$t[0],$t[1],$t[2]),ql(X,fe.x,fe.y,fe.z,$t[0],$t[1],$t[2]),ql(X,fe.x,fe.y,fe.z,$t[0],$t[1],$t[2]),ql(X,fe.x,fe.y,fe.z,$t[0],$t[1],$t[2]),Id(t.dynamicLayoutVertexArray,fe.x,fe.y,fe.z,ct)}else Id(t.dynamicLayoutVertexArray,w.x,w.y,w.z,ct);B.emplaceBack(Nt,Nt+1,Nt+2),B.emplaceBack(Nt+1,Nt+2,Nt+3),it.vertexLength+=4,it.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(de[0]),vt!==n.length-1&&ne===n[vt+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,g,g.index,{},F,P,nt&&nt[ne])}const ft=b?b.anchor:w;t.placedSymbolArray.emplaceBack(ft.x,ft.y,ft.z,w.x,w.y,K,this.glyphOffsetArray.length-K,tt,S,E,w.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],y,0,!1,0,k,0)}_commitLayoutVertex(t,n,s,h,f,g,y){t.emplaceBack(n,s,h,f,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(t,n,s,h,f,g,y){const b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=b.vertexLength,S=y.tileAnchorX,E=y.tileAnchorY;for(let F=0;F<4;F++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(n,t.padding,-t.padding),s.collisionVertexArrayExt.emplaceBack(n,t.padding,t.padding),s.collisionVertexArrayExt.emplaceBack(n,-t.padding,t.padding),this._commitLayoutVertex(s.layoutVertexArray,h,f,g,S,E,new jt(t.x1,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,f,g,S,E,new jt(t.x2,t.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,f,g,S,E,new jt(t.x2,t.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,f,g,S,E,new jt(t.x1,t.y2)),b.vertexLength+=4;const k=s.indexArray;k.emplaceBack(w,w+1),k.emplaceBack(w+1,w+2),k.emplaceBack(w+2,w+3),k.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(t,n,s,h,f,g){for(let y=h;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(t,g,n,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,n,s,h,f,g){for(let y=h;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceIconSize(t,n,y);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fd(ir,Up.members,en),this.iconCollisionBox=new Fd(ir,Up.members,en);const s=Hc(this.iconSizeData,t),h=Hc(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,t,n,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,t,n,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,t,n,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,t,n,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,n,s,h){const f=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:h),g=xd(this.textSizeData,t,f)/24;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,n,s){const h=this.icon.placedSymbolArray.get(s),f=xd(this.iconSizeData,t,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(t,n,s){t.emplaceBack(n,-s,-s),t.emplaceBack(n,s,-s),t.emplaceBack(n,s,s),t.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(t,n,s,h,f,g){for(let y=h;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(t,g,n,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(t,n,s,h,f){for(let g=h;g<f;g++){const y=s.get(g),b=this.getSymbolInstanceIconSize(t,n,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding)}}updateCollisionDebugBuffers(t,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Hc(this.iconSizeData,t),h=Hc(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,t,n,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,t,n,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,t,n,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,t,n,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,n,s,h,f,g,y,b,w){const S={};for(let E=n;E<s;E++){const k=t.get(E);S.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.textFeatureIndex=k.featureIndex;break}for(let E=h;E<f;E++){const k=t.get(E);S.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalTextFeatureIndex=k.featureIndex;break}for(let E=g;E<y;E++){const k=t.get(E);S.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.iconFeatureIndex=k.featureIndex;break}for(let E=b;E<w;E++){const k=t.get(E);S.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},S.verticalIconFeatureIndex=k.featureIndex;break}return S}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const s=t.placedSymbolArray.get(n),h=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<h;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(t),s=Math.cos(t),h=[],f=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const b=this.symbolInstances.get(y);h.push(0|Math.round(n*b.tileAnchorX+s*b.tileAnchorY)),f.push(b.featureIndex)}return g.sort((y,b)=>h[y]-h[b]||f[b]-f[y]),g}addToSortKeyRanges(t,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((h,f,g)=>{h>=0&&g.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Jt(Ds,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ds.MAX_GLYPHS=65535,Ds.addDynamicAttributes=Id;const gf=new At({"symbol-placement":new rt(Ct.layout_symbol["symbol-placement"]),"symbol-spacing":new rt(Ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rt(Ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dt(Ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rt(Ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new rt(Ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new rt(Ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new rt(Ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rt(Ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new dt(Ct.layout_symbol["icon-size"]),"icon-text-fit":new rt(Ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new rt(Ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new dt(Ct.layout_symbol["icon-image"]),"icon-rotate":new dt(Ct.layout_symbol["icon-rotate"]),"icon-padding":new rt(Ct.layout_symbol["icon-padding"]),"icon-keep-upright":new rt(Ct.layout_symbol["icon-keep-upright"]),"icon-offset":new dt(Ct.layout_symbol["icon-offset"]),"icon-anchor":new dt(Ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rt(Ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rt(Ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rt(Ct.layout_symbol["text-rotation-alignment"]),"text-field":new dt(Ct.layout_symbol["text-field"]),"text-font":new dt(Ct.layout_symbol["text-font"]),"text-size":new dt(Ct.layout_symbol["text-size"]),"text-max-width":new dt(Ct.layout_symbol["text-max-width"]),"text-line-height":new dt(Ct.layout_symbol["text-line-height"]),"text-letter-spacing":new dt(Ct.layout_symbol["text-letter-spacing"]),"text-justify":new dt(Ct.layout_symbol["text-justify"]),"text-radial-offset":new dt(Ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rt(Ct.layout_symbol["text-variable-anchor"]),"text-anchor":new dt(Ct.layout_symbol["text-anchor"]),"text-max-angle":new rt(Ct.layout_symbol["text-max-angle"]),"text-writing-mode":new rt(Ct.layout_symbol["text-writing-mode"]),"text-rotate":new dt(Ct.layout_symbol["text-rotate"]),"text-padding":new rt(Ct.layout_symbol["text-padding"]),"text-keep-upright":new rt(Ct.layout_symbol["text-keep-upright"]),"text-transform":new dt(Ct.layout_symbol["text-transform"]),"text-offset":new dt(Ct.layout_symbol["text-offset"]),"text-allow-overlap":new rt(Ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new rt(Ct.layout_symbol["text-ignore-placement"]),"text-optional":new rt(Ct.layout_symbol["text-optional"])});var Pd={paint:new At({"icon-opacity":new dt(Ct.paint_symbol["icon-opacity"]),"icon-color":new dt(Ct.paint_symbol["icon-color"]),"icon-halo-color":new dt(Ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new dt(Ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dt(Ct.paint_symbol["icon-halo-blur"]),"icon-translate":new rt(Ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new rt(Ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new dt(Ct.paint_symbol["text-opacity"]),"text-color":new dt(Ct.paint_symbol["text-color"],{runtimeType:Tn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new dt(Ct.paint_symbol["text-halo-color"]),"text-halo-width":new dt(Ct.paint_symbol["text-halo-width"]),"text-halo-blur":new dt(Ct.paint_symbol["text-halo-blur"]),"text-translate":new rt(Ct.paint_symbol["text-translate"]),"text-translate-anchor":new rt(Ct.paint_symbol["text-translate-anchor"])}),layout:gf};class _f{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:go,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Jt(_f,"FormatSectionOverride",{omit:["defaultValue"]});class Zl extends Wr{constructor(t){super(t,Pd)}recalculate(t,n){super.recalculate(t,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const f of s)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,n,s,h){const f=this.layout.get(t).evaluate(n,{},s,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||cl(g.value)||!f?f:(y=n.properties,f.replace(/{([^{}]+)}/g,(w,S)=>S in y?String(y[S]):""));var y}createBucket(t){return new Ds(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Pd.paint.overridableProperties){if(!Zl.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),s=new _f(n),h=new ll(s,n.property.specification);let f=null;f="constant"===n.value.kind||"source"===n.value.kind?new Du("source",h):new ul("composite",h,n.value.zoomStops,n.value._interpolationType),this.paint._values[t]=new et(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&Zl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const s=t.get("text-field"),h=Pd.paint.properties[n];let f=!1;const g=y=>{for(const b of y)if(h.overrides&&h.overrides.hasOverride(b))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof Qi)g(s.value.value.sections);else if("source"===s.value.kind){const y=w=>{f||(w instanceof js&&yi(w.value)===Gs?g(w.value.sections):w instanceof qs?g(w.sections):w.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return f}getProgramConfiguration(t){return new xs(this,t)}}var yf={paint:new At({"background-color":new rt(Ct.paint_background["background-color"]),"background-pattern":new Lt(Ct.paint_background["background-pattern"]),"background-opacity":new rt(Ct.paint_background["background-opacity"])})},vf={paint:new At({"raster-opacity":new rt(Ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new rt(Ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rt(Ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rt(Ct.paint_raster["raster-brightness-max"]),"raster-saturation":new rt(Ct.paint_raster["raster-saturation"]),"raster-contrast":new rt(Ct.paint_raster["raster-contrast"]),"raster-resampling":new rt(Ct.paint_raster["raster-resampling"]),"raster-fade-duration":new rt(Ct.paint_raster["raster-fade-duration"])})};class Ld extends Wr{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var xf={paint:new At({"sky-type":new rt(Ct.paint_sky["sky-type"]),"sky-atmosphere-sun":new rt(Ct.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new rt(Ct.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new rt(Ct.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new rt(Ct.paint_sky["sky-gradient-radius"]),"sky-gradient":new gt(Ct.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new rt(Ct.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new rt(Ct.paint_sky["sky-atmosphere-color"]),"sky-opacity":new rt(Ct.paint_sky["sky-opacity"])})};function bf(i,t,n){const s=[0,0,1],h=Rc([]);return od(h,h,n?-_e(i)+Math.PI:_e(i)),zc(h,h,-_e(t)),Cp(s,s,h),dn(s,s)}const z_={circle:class extends Wr{constructor(i){super(i,xp)}createBucket(i){return new Qh(i)}queryRadius(i){const t=i;return _a("circle-radius",this,t)+_a("circle-stroke-width",this,t)+Qu(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,n,s,h,f,g,y){const b=Kr(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Sp(i,s,f,g,y,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new xs(this,i)}},heatmap:class extends Wr{createBucket(i){return new Ep(i)}constructor(i){super(i,_m),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ip({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return _a("heatmap-radius",this,i)}queryIntersectsFeature(i,t,n,s,h,f,g,y){const b=this.paint.get("heatmap-radius").evaluate(t,n);return Sp(i,s,f,g,y,!0,!0,new jt(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new xs(this,i)}},hillshade:class extends Wr{constructor(i){super(i,ym)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Wr{constructor(i){super(i,Em)}getProgramIds(){const i=this.paint.get("fill-pattern"),t=i&&i.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(i){return new xs(this,i)}recalculate(i,t){super.recalculate(i,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new eo(i)}queryRadius(){return Qu(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,n,s,h,f){return!i.queryGeometry.isAboveHorizon&&dm(vp(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Wr{constructor(i){super(i,t_)}createBucket(i){return new jc(i)}queryRadius(){return Qu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new xs(this,i)}queryIntersectsFeature(i,t,n,s,h,f,g,y,b){const w=Kr(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(t,n),E=this.paint.get("fill-extrusion-base").evaluate(t,n),k=[0,0],F=y&&f.elevation,P=f.elevation?f.elevation.exaggeration():1,B=i.tile.getBucket(this);if(F&&B instanceof jc){const it=B.centroidVertexArray,K=b+1;if(K<it.length){const tt=it.get(K);k[0]=tt.a_centroid_pos0,k[1]=tt.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;"globe"===f.projection.name&&(s=zm([s],[new jt(0,0),new jt(ce,ce)],i.tileID.canonical).map(it=>it.polygon).flat());const N=(K=s,tt=E,ct=S,nt=w,ft=g,vt=F?y:null,Mt=k,Pt=P,bt=f.center.lat,"globe"===(it=f).projection.name?function(Ot,Tt,Rt,It,Ht,de,be,ne,Nt,Ee,fe){const $t=[],Qe=[],Je=Ot.projection.upVectorScale(fe,Ot.center.lat,Ot.worldSize).metersToTile,pi=[0,0,0,1],Ce=[0,0,0,1],Be=(He,Ze,ti,ei)=>{He[0]=Ze,He[1]=ti,He[2]=ei,He[3]=1},oi=Rm();Rt>0&&(Rt+=oi),It+=oi;for(const He of Tt){const Ze=[],ti=[];for(const ei of He){const ki=ei.x+Ht.x,Sn=ei.y+Ht.y,De=Ot.projection.projectTilePoint(ki,Sn,fe),bi=Ot.projection.upVector(fe,ei.x,ei.y);let qi=Rt,Ne=It;if(be){const fi=Vp(ki,Sn,Rt,It,be,ne,Nt,Ee);qi+=fi.base,Ne+=fi.top}0!==Rt?Be(pi,De.x+bi[0]*Je*qi,De.y+bi[1]*Je*qi,De.z+bi[2]*Je*qi):Be(pi,De.x,De.y,De.z),Be(Ce,De.x+bi[0]*Je*Ne,De.y+bi[1]*Je*Ne,De.z+bi[2]*Je*Ne),Ii(pi,pi,de),Ii(Ce,Ce,de),Ze.push(_d(pi)),ti.push(_d(Ce))}$t.push(Ze),Qe.push(ti)}return[$t,Qe]}(it,K,tt,ct,nt,ft,vt,Mt,Pt,bt,i.tileID.canonical):vt?function(Ot,Tt,Rt,It,Ht,de,be,ne,Nt){const Ee=[],fe=[],$t=[0,0,0,1];for(const Qe of Ot){const Je=[],pi=[];for(const Ce of Qe){const Be=Ce.x+It.x,oi=Ce.y+It.y,He=Vp(Be,oi,Tt,Rt,de,be,ne,Nt);$t[0]=Be,$t[1]=oi,$t[2]=He.base,$t[3]=1,va($t,$t,Ht),$t[3]=Math.max($t[3],1e-5);const Ze=_d([$t[0]/$t[3],$t[1]/$t[3],$t[2]/$t[3]]);$t[0]=Be,$t[1]=oi,$t[2]=He.top,$t[3]=1,va($t,$t,Ht),$t[3]=Math.max($t[3],1e-5);const ti=_d([$t[0]/$t[3],$t[1]/$t[3],$t[2]/$t[3]]);Je.push(Ze),pi.push(ti)}Ee.push(Je),fe.push(pi)}return[Ee,fe]}(K,tt,ct,nt,ft,vt,Mt,Pt,bt):function(Ot,Tt,Rt,It,Ht){const de=[],be=[],ne=Ht[8]*Tt,Nt=Ht[9]*Tt,Ee=Ht[10]*Tt,fe=Ht[11]*Tt,$t=Ht[8]*Rt,Qe=Ht[9]*Rt,Je=Ht[10]*Rt,pi=Ht[11]*Rt;for(const Ce of Ot){const Be=[],oi=[];for(const He of Ce){const Ze=He.x+It.x,ti=He.y+It.y,ei=Ht[0]*Ze+Ht[4]*ti+Ht[12],ki=Ht[1]*Ze+Ht[5]*ti+Ht[13],Sn=Ht[2]*Ze+Ht[6]*ti+Ht[14],De=Ht[3]*Ze+Ht[7]*ti+Ht[15],bi=ei+ne,qi=ki+Nt,Ne=Sn+Ee,fi=Math.max(De+fe,1e-5),pn=ei+$t,mi=ki+Qe,Mi=Sn+Je,Zi=Math.max(De+pi,1e-5),_i=new jt(bi/fi,qi/fi);_i.z=Ne/fi,Be.push(_i);const Oi=new jt(pn/Zi,mi/Zi);Oi.z=Mi/Zi,oi.push(Oi)}de.push(Be),be.push(oi)}return[de,be]}(K,tt,ct,nt,ft)),X=i.queryGeometry;var it,K,tt,ct,nt,ft,vt,Mt,Pt,bt;return function(it,K,tt){let ct=1/0;dm(tt,K)&&(ct=Zc(tt,K[0]));for(let nt=0;nt<K.length;nt++){const ft=K[nt],vt=it[nt];for(let Mt=0;Mt<ft.length-1;Mt++){const Pt=ft[Mt],bt=[Pt,ft[Mt+1],vt[Mt+1],vt[Mt],Pt];pp(tt,bt)&&(ct=Math.min(ct,Zc(tt,bt)))}}return ct!==1/0&&ct}(N[0],N[1],X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Wr{constructor(i){super(i,Np),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof sc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=Vm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new vd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new xs(this,i)}queryRadius(i){const t=i,n=Gm(_a("line-width",this,t),_a("line-gap-width",this,t)),s=_a("line-offset",this,t);return n/2+Math.abs(s)+Qu(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,n,s,h,f){if(i.queryGeometry.isAboveHorizon)return!1;const g=vp(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),y=i.pixelToTileUnitsFactor/2*Gm(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),b=this.paint.get("line-offset").evaluate(t,n);return b&&(s=function(w,S){const E=[],k=new jt(0,0);for(let F=0;F<w.length;F++){const P=w[F],B=[];for(let N=0;N<P.length;N++){const X=P[N-1],it=P[N],K=P[N+1],tt=0===N?k:it.sub(X)._unit()._perp(),ct=N===P.length-1?k:K.sub(it)._unit()._perp(),nt=tt._add(ct)._unit();nt._mult(1/(nt.x*ct.x+nt.y*ct.y)),B.push(nt._mult(S)._add(it))}E.push(B)}return E}(s,b*i.pixelToTileUnitsFactor)),function(w,S,E){for(let k=0;k<S.length;k++){const F=S[k];if(w.length>=3)for(let P=0;P<F.length;P++)if(ga(w,F[P]))return!0;if(Wg(w,F,E))return!0}return!1}(g,s,y)}isTileClipped(){return!0}},symbol:Zl,background:class extends Wr{constructor(i){super(i,yf)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Wr{constructor(i){super(i,vf)}getProgramIds(){return["raster"]}},sky:class extends Wr{constructor(i){super(i,xf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"sky-gradient"===i?this._updateColorRamp():"sky-atmosphere-sun"!==i&&"sky-atmosphere-halo-color"!==i&&"sky-atmosphere-color"!==i&&"sky-atmosphere-sun-intensity"!==i||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ip({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(i,t){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),h=!s,f=i.style.light,g=f.properties.get("position");return h&&"viewport"===f.properties.get("anchor")&&ci("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?bf(g.azimuthal,90-g.polar,t):bf(s[0],90-s[1],t)}const n=this.paint.get("sky-gradient-center");return bf(n[0],90-n[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return"atmosphere"===i?["skyboxCapture","skybox"]:"gradient"===i?["skyboxGradient"]:null}}};class Hl{constructor(t,n,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(n,h)}update(t,n,s){const{width:h,height:f}=t,{context:g}=this,{gl:y}=g,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:S,ImageData:E,ImageBitmap:k}=Bt;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===h&&this.size[1]===f){const{x:F,y:P}=s||{x:0,y:0};t instanceof b||t instanceof w||t instanceof S||t instanceof E||k&&t instanceof k?y.texSubImage2D(y.TEXTURE_2D,0,F,P,y.RGBA,y.UNSIGNED_BYTE,t):y.texSubImage2D(y.TEXTURE_2D,0,F,P,h,f,y.RGBA,y.UNSIGNED_BYTE,t.data)}else this.size=[h,f],t instanceof b||t instanceof w||t instanceof S||t instanceof E||k&&t instanceof k?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,t):y.texImage2D(y.TEXTURE_2D,0,this.format,h,f,0,this.format,y.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(t,n){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.filter=t),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class wf{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.image=new Bo({width:t,height:n}),this.positions={},this.uploaded=!1}getDash(t,n){const s=this.getKey(t,n);return this.positions[s]}trim(){const t=this.width,n=this.height=Ls(this.nextRow);this.image.resize({width:t,height:n})}getKey(t,n){return t.join(",")+n}getDashRanges(t,n,s){const h=[];let f=t.length%2==1?-t[t.length-1]*s:0,g=t[0]*s,y=!0;h.push({left:f,right:g,isDash:y,zeroLength:0===t[0]});let b=t[0];for(let w=1;w<t.length;w++){y=!y;const S=t[w];f=b*s,b+=S,g=b*s,h.push({left:f,right:g,isDash:y,zeroLength:0===S})}return h}addRoundDash(t,n,s){const h=n/2;for(let f=-s;f<=s;f++){const g=this.width*(this.nextRow+s+f);let y=0,b=t[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=t[++y]);const S=Math.abs(w-b.left),E=Math.abs(w-b.right),k=Math.min(S,E);let F;const P=f/s*(h+1);if(b.isDash){const B=h-Math.abs(P);F=Math.sqrt(k*k+B*B)}else F=h-Math.sqrt(k*k+P*P);this.image.data[g+w]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(t,n){for(let b=t.length-1;b>=0;--b){const w=t[b],S=t[b+1];w.zeroLength?t.splice(b,1):S&&S.isDash===w.isDash&&(S.left=w.left,t.splice(b,1))}const s=t[0],h=t[t.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const f=this.width*this.nextRow;let g=0,y=t[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=t[++g]);const w=Math.abs(b-y.left),S=Math.abs(b-y.right),E=Math.min(w,S);this.image.data[f+b]=Math.max(0,Math.min(255,(y.isDash?E:-E)+n+128))}}addDash(t,n){const s=this.getKey(t,n);if(this.positions[s])return this.positions[s];const h="round"===n,f=h?7:0,g=2*f+1;if(this.nextRow+g>this.height)return ci("LineAtlas out of space"),null;0===t.length&&t.push(1);let y=0;for(let S=0;S<t.length;S++)t[S]<0&&(ci("Negative value is found in line dasharray, replacing values with 0"),t[S]=0),y+=t[S];if(0!==y){const S=this.width/y,E=this.getDashRanges(t,this.width,S);h?this.addRoundDash(E,S,f):this.addRegularDash(E,"square"===n?.5*S:0)}const b=this.nextRow+f;this.nextRow+=g;const w={tl:[b,f],br:[y,0]};return this.positions[s]=w,w}}Jt(wf,"LineAtlas");class Sg{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class B_{constructor(){this.tasks={},this.taskQueue=[],dr(["process"],this),this.invoker=new Sg(this.process),this.nextId=0}add(t,n){const s=this.nextId++,h=function({type:f,isSymbolTile:g,zoom:y}){return y=y||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-y:"maybePrepare"===f&&g?400-y:500:200-y:100-y}(n);if(0===h){an();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:t,metadata:n,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){an();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let t=null,n=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<n&&(n=f.priority,t=h)}if(null===t)return null;const s=this.taskQueue[t];return this.taskQueue.splice(t,1),s}remove(){this.invoker.remove()}}class Cf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const s=t[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const V_=["tile","layer","source","sourceLayer","state"];class Tg{constructor(t,n,s,h,f){this.type="Feature",this._vectorTileFeature=t,this._z=n,this._x=s,this._y=h,this.properties=t.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const n of V_)void 0!==this[n]&&(t[n]=this[n]);return t}}const Sa=new Uint16Array(8184);for(let i=0;i<2046;i++){let t=i+2,n=0,s=0,h=0,f=0,g=0,y=0;for(1&t?h=f=g=32:n=s=y=32;(t>>=1)>1;){const w=n+h>>1,S=s+f>>1;1&t?(h=n,f=s,n=g,s=y):(n=h,s=f,h=g,f=y),g=w,y=S}const b=4*i;Sa[b+0]=n,Sa[b+1]=s,Sa[b+2]=h,Sa[b+3]=f}const Sr=new Uint16Array(2178),Is=new Uint8Array(1089),wh=new Uint16Array(1089);function Eg(i){return 0===i?-.03125:32===i?.03125:0}var Rd=Et([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Mf={type:2,extent:ce,loadGeometry:()=>[[new jt(0,0),new jt(8193,0),new jt(8193,8193),new jt(0,8193),new jt(0,0)]]};class zd{constructor(t,n,s,h,f){this.tileID=t,this.uid=Jo(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<_n.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ul(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,s){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,f){const g={};if(!f)return g;for(const y of h){const b=y.layerIds.map(w=>f.getLayer(w)).filter(Boolean);if(0!==b.length){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(S=>S.id===w)[0]));for(const w of b)g[w.id]=y}}return g}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof Ds){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof Ds&&f.hasRTLText){this.hasRTLText=!0,j.isLoading()||j.isLoaded()||"deferred"!==V()||H();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Yr}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const s in this.buckets){const h=this.buckets[s];h.uploadPending()&&h.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hl(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hl(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hl(t,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,s,h,f,g,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:y,transform:g,params:f,tileTransform:this.tileTransform},t,n,s):{}}querySourceFeatures(t,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const h=s.loadVTLayers(),f=n?n.sourceLayer:"",g=h._geojsonTileLayer||h[f];if(!g)return;const y=ra(n&&n.filter),{z:b,x:w,y:S}=this.tileID.canonical,E={z:b,x:w,y:S};for(let k=0;k<g.length;k++){const F=g.feature(k);if(y.needGeometry){const N=ws(F,!0);if(!y.filter(new q(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!y.filter(new q(this.tileID.overscaledZ),F))continue;const P=s.getId(F,f),B=new Tg(F,b,w,S,P);B.tile=E,t.push(B)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const s=Yn(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const s=Date.now();let h=!1;if(this.expirationTime>s)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const f=this.expirationTime-n;f?this.expirationTime=s+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),h=n.style.listImages();for(const f in this.buckets){if(!n.style.hasLayer(f))continue;const g=this.buckets[f],y=g.layers[0].sourceLayer||"_geojsonTileLayer",b=s[y],w=t[y];if(!b||!w||0===Object.keys(w).length)continue;if(g.update(w,b,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof vd||g instanceof eo){const E=n.style._getSourceCache(g.layers[0].source);n._terrain&&n._terrain.enabled&&E&&g.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(E.id,this.tileID)}const S=n&&n.style&&n.style.getLayer(f);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_n.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=_n.now()+t}setTexture(t,n){const s=n.context,h=s.gl;this.texture=n.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new Hl(s,t,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(t,n){const s={};for(const h of n)s[h]=!0;this.dependencies[t]=s}hasDependency(t,n){for(const s of t){const h=this.dependencies[s];if(h)for(const f of n)if(h[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=zo(Mf,this.tileID.canonical,this.tileTransform)[0],h=new Ut,f=new Hr;for(let g=0;g<s.length;g++){const{x:y,y:b}=s[g];h.emplaceBack(y,b),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(h,yh.members),this._tileDebugSegments=Ti.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=zo(Mf,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const g=function(y,b){const w=Ul(y,b),S=Math.pow(2,y.z);for(let N=0;N<33;N++)for(let X=0;X<33;X++){const it=or((y.x+(X+Eg(X))/32)/S),K=Yi((y.y+(N+Eg(N))/32)/S),tt=b.project(it,K),ct=33*N+X;Sr[2*ct+0]=Math.round((tt.x*w.scale-w.x)*ce),Sr[2*ct+1]=Math.round((tt.y*w.scale-w.y)*ce)}Is.fill(0),wh.fill(0);for(let N=2045;N>=0;N--){const X=4*N,it=Sa[X+0],K=Sa[X+1],tt=Sa[X+2],ct=Sa[X+3],nt=it+tt>>1,ft=K+ct>>1,vt=nt+ft-K,Mt=ft+it-nt,Pt=33*K+it,bt=33*ct+tt,St=33*ft+nt,Ot=Math.hypot((Sr[2*Pt+0]+Sr[2*bt+0])/2-Sr[2*St+0],(Sr[2*Pt+1]+Sr[2*bt+1])/2-Sr[2*St+1])>=16;if(Is[St]=Is[St]||(Ot?1:0),N<1022){const Tt=33*(K+Mt>>1)+(it+vt>>1),Rt=33*(ct+Mt>>1)+(tt+vt>>1);Is[St]=Is[St]||Is[Tt]||Is[Rt]}}const E=new ie,k=new Me;let F=0;function P(N,X){const it=33*X+N;return 0===wh[it]&&(E.emplaceBack(Sr[2*it+0],Sr[2*it+1],N*ce/32,X*ce/32),wh[it]=++F),wh[it]-1}function B(N,X,it,K,tt,ct){const nt=N+it>>1,ft=X+K>>1;if(Math.abs(N-tt)+Math.abs(X-ct)>1&&Is[33*ft+nt])B(tt,ct,N,X,nt,ft),B(it,K,tt,ct,nt,ft);else{const vt=P(N,X),Mt=P(it,K),Pt=P(tt,ct);k.emplaceBack(vt,Mt,Pt)}}return B(0,0,32,32,32,0),B(32,32,0,0,0,32),{vertices:E,indices:k}}(this.tileID.canonical,n);h=g.vertices,f=g.indices}else{h=new ie,f=new Me;for(const{x:y,y:b}of s)h.emplaceBack(y,b,0,0);const g=ba(h.int16,void 0,4);for(let y=0;y<g.length;y+=3)f.emplaceBack(g[y],g[y+1],g[y+2])}this._tileBoundsBuffer=t.createVertexBuffer(h,Rd.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(f),this._tileBoundsSegments=Ti.simpleSegment(0,0,h.length,f.length)}_makeGlobeTileDebugBuffers(t,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const h=this.tileID.canonical,f=Nl(vg(h,n)),g=nu(n.zoom);let y;g>0&&(y=th(new Float64Array(16),n.globeMatrix));const b=(h.x+.5)/(1<<h.z)-Xr(n.center.lng);let w=0;b>.5?w=-1:b<-.5&&(w=1),this._makeGlobeTileDebugBorderBuffer(t,h,n,f,y,g,w),this._makeGlobeTileDebugTextBuffer(t,h,n,f,y,g,w)}_globePoint(t,n,s,h,f,g,y,b){let w=eu(t,n,s);if(g){const S=1<<s.z,E=[((t/ce+s.x)/S+b)*h,(n/ce+s.y)/S*h,0];Ii(E,E,g),w=os(w,E,y)}return Ii(w,w,f)}_makeGlobeTileDebugBorderBuffer(t,n,s,h,f,g,y){const b=new Ut,w=new Hr,S=new Qt,E=(F,P,B,N,X)=>{const it=(B-F)/(X-1),K=(N-P)/(X-1),tt=b.length;for(let ct=0;ct<X;ct++){const nt=F+ct*it,ft=P+ct*K;b.emplaceBack(nt,ft);const vt=this._globePoint(nt,ft,n,s.worldSize,h,f,g,y);S.emplaceBack(vt[0],vt[1],vt[2]),w.emplaceBack(tt+ct)}},k=ce;E(0,0,k,0,16),E(k,0,k,k,16),E(k,k,0,k,16),E(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(w),this._tileDebugBuffer=t.createVertexBuffer(b,yh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(S,_g.members),this._tileDebugSegments=Ti.simpleSegment(0,0,b.length,w.length)}_makeGlobeTileDebugTextBuffer(t,n,s,h,f,g,y){const b=new Ut,w=new Me,S=new Qt,E=25;w.reserve(32),b.reserve(E),S.reserve(E);const k=(F,P)=>E*F+P;for(let F=0;F<E;F++){const P=2048*F;for(let B=0;B<E;B++){const N=2048*B;b.emplaceBack(N,P);const X=this._globePoint(N,P,n,s.worldSize,h,f,g,y);S.emplaceBack(X[0],X[1],X[2])}}for(let F=0;F<4;F++)for(let P=0;P<4;P++){const B=k(F,P),N=k(F,P+1),X=k(F+1,P),it=k(F+1,P+1);w.emplaceBack(B,N,X),w.emplaceBack(X,N,it)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(w),this._tileDebugTextBuffer=t.createVertexBuffer(b,yh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(S,_g.members),this._tileDebugTextSegments=Ti.simpleSegment(0,0,E,32)}}class kg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,s){const h=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Ve(this.stateChanges[t][h],s),null===this.deletedStates[t]){this.deletedStates[t]={};for(const f in this.state[t])f!==h&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][h]){this.deletedStates[t][h]={};for(const f in this.state[t][h])s[f]||(this.deletedStates[t][h][f]=null)}else for(const f in s)this.deletedStates[t]&&this.deletedStates[t][h]&&null===this.deletedStates[t][h][f]&&delete this.deletedStates[t][h][f]}removeFeatureState(t,n,s){if(null===this.deletedStates[t])return;const h=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&void 0!==n)null!==this.deletedStates[t][h]&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][s]=null);else if(void 0!==n)if(this.stateChanges[t]&&this.stateChanges[t][h])for(s in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][s]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,n){const s=String(n),h=Ve({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const f=this.deletedStates[t][n];if(null===f)return{};for(const g in f)delete h[g]}return h}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const s={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const g in this.stateChanges[h])this.state[h][g]||(this.state[h][g]={}),Ve(this.state[h][g],this.stateChanges[h][g]),f[g]=this.state[h][g];s[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(null===this.deletedStates[h])for(const g in this.state[h])f[g]={},this.state[h][g]={};else for(const g in this.deletedStates[h]){if(null===this.deletedStates[h][g])this.state[h][g]={};else for(const y of Object.keys(this.deletedStates[h][g]))delete this.state[h][g][y];f[g]=this.state[h][g]}s[h]=s[h]||{},Ve(s[h],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const h in t)t[h].setFeatureState(s,n)}}class Af{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,n){const s=this.toIdx(t,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(t,n){return this.leaves[this.toIdx(t,n)]}toIdx(t,n){return n*this.size+t}}function Sf(i,t,n,s){let h=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(s[g])<1e-15){if(n[g]<i[g]||n[g]>t[g])return null}else{const y=1/s[g];let b=(i[g]-n[g])*y,w=(t[g]-n[g])*y;if(b>w){const S=b;b=w,w=S}if(b>h&&(h=b),w<f&&(f=w),h>f)return null}return h}function Tf(i,t,n,s,h,f,g,y,b,w,S){const E=s-i,k=h-t,F=f-n,P=g-i,B=y-t,N=b-n,X=S[1]*N-S[2]*B,it=S[2]*P-S[0]*N,K=S[0]*B-S[1]*P,tt=E*X+k*it+F*K;if(Math.abs(tt)<1e-15)return null;const ct=1/tt,nt=w[0]-i,ft=w[1]-t,vt=w[2]-n,Mt=(nt*X+ft*it+vt*K)*ct;if(Mt<0||Mt>1)return null;const Pt=ft*F-vt*k,bt=vt*E-nt*F,St=nt*k-ft*E,Ot=(S[0]*Pt+S[1]*bt+S[2]*St)*ct;return Ot<0||Mt+Ot>1?null:(P*Pt+B*bt+N*St)*ct}function Ef(i,t,n){return(i-t)/(n-t)}function Bd(i,t,n,s,h,f,g,y,b){const w=1<<n,S=f-s,E=g-h,k=(i+1)/w*S+s,F=(t+0)/w*E+h,P=(t+1)/w*E+h;y[0]=(i+0)/w*S+s,y[1]=F,b[0]=k,b[1]=P}class Vd{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(f){const g=Math.ceil(Math.log2(f.dim/8)),y=[];let b=Math.ceil(Math.pow(2,g));const w=1/b,S=(F,P,B,N,X)=>{const it=N?1:0,K=(F+1)*B-it,tt=P*B,ct=(P+1)*B-it;X[0]=F*B,X[1]=tt,X[2]=K,X[3]=ct};let E=new Af(b);const k=[];for(let F=0;F<b*b;F++){S(F%b,Math.floor(F/b),w,!1,k);const P=Os(k[0],k[1],f),B=Os(k[2],k[1],f),N=Os(k[2],k[3],f),X=Os(k[0],k[3],f);E.minimums.push(Math.min(P,B,N,X)),E.maximums.push(Math.max(P,B,N,X)),E.leaves.push(1)}for(y.push(E),b/=2;b>=1;b/=2){const F=y[y.length-1];E=new Af(b);for(let P=0;P<b*b;P++){S(P%b,Math.floor(P/b),2,!0,k);const B=F.getElevation(k[0],k[1]),N=F.getElevation(k[2],k[1]),X=F.getElevation(k[2],k[3]),it=F.getElevation(k[0],k[3]),K=F.isLeaf(k[0],k[1]),tt=F.isLeaf(k[2],k[1]),ct=F.isLeaf(k[2],k[3]),nt=F.isLeaf(k[0],k[3]),ft=Math.min(B.min,N.min,X.min,it.min),vt=Math.max(B.max,N.max,X.max,it.max),Mt=K&&tt&&ct&&nt;E.maximums.push(vt),E.minimums.push(ft),E.leaves.push(vt-ft<=5&&Mt?1:0)}y.push(E)}return y}(this.dem),s=n.length-1,h=n[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(t,n,s,h,f,g,y=1){return Sf([t,n,-100],[s,h,this.maximums[0]*y],f,g)}raycast(t,n,s,h,f,g,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(t,n,s,h,f,g,y);if(null==b)return null;const w=[],S=[],E=[],k=[],F=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:P,t:B,nodex:N,nodey:X,depth:it}=F.pop();if(this.leaves[P]){Bd(N,X,it,t,n,s,h,E,k);const tt=1<<it,ct=(N+0)/tt,nt=(N+1)/tt,ft=(X+0)/tt,vt=(X+1)/tt,Mt=Os(ct,ft,this.dem)*y,Pt=Os(nt,ft,this.dem)*y,bt=Os(nt,vt,this.dem)*y,St=Os(ct,vt,this.dem)*y,Ot=Tf(E[0],E[1],Mt,k[0],E[1],Pt,k[0],k[1],bt,f,g),Tt=Tf(k[0],k[1],bt,E[0],k[1],St,E[0],E[1],Mt,f,g),Rt=Math.min(null!==Ot?Ot:Number.MAX_VALUE,null!==Tt?Tt:Number.MAX_VALUE);if(Rt!==Number.MAX_VALUE)return Rt;{const It=rh([],f,g,B);if(kf(Mt,Pt,St,bt,Ef(It[0],E[0],k[0]),Ef(It[1],E[1],k[1]))>=It[2])return B}continue}let K=0;for(let tt=0;tt<this._siblingOffset.length;tt++){Bd((N<<1)+this._siblingOffset[tt][0],(X<<1)+this._siblingOffset[tt][1],it+1,t,n,s,h,E,k),E[2]=-100,k[2]=this.maximums[this.childOffsets[P]+tt]*y;const ct=Sf(E,k,f,g);if(null!=ct){const nt=ct;w[tt]=nt;let ft=!1;for(let vt=0;vt<K&&!ft;vt++)nt>=w[S[vt]]&&(S.splice(vt,0,tt),ft=!0);ft||(S[K]=tt),K++}}for(let tt=0;tt<K;tt++){const ct=S[tt];F.push({idx:this.childOffsets[P]+ct,t:w[ct],nodex:(N<<1)+this._siblingOffset[ct][0],nodey:(X<<1)+this._siblingOffset[ct][1],depth:it+1})}}return null}_addNode(t,n,s){return this.minimums.push(t),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(t,n,s,h,f){if(1===t[h].isLeaf(n,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=h-1,y=t[g];let b=0,w=0;for(let S=0;S<this._siblingOffset.length;S++){const E=2*n+this._siblingOffset[S][0],k=2*s+this._siblingOffset[S][1],F=y.getElevation(E,k),P=y.isLeaf(E,k),B=this._addNode(F.min,F.max,P);P&&(b|=1<<S),w||(w=B)}for(let S=0;S<this._siblingOffset.length;S++)b&1<<S||this._construct(t,2*n+this._siblingOffset[S][0],2*s+this._siblingOffset[S][1],g,w+S)}}function kf(i,t,n,s,h,f){return Fe(Fe(i,n,f),Fe(t,s,f),h)}function Os(i,t,n){const s=n.dim,h=ye(i*s-.5,0,s-1),f=ye(t*s-.5,0,s-1),g=Math.floor(h),y=Math.floor(f),b=Math.min(g+1,s-1),w=Math.min(y+1,s-1);return kf(n.get(g,y),n.get(b,y),n.get(g,w),n.get(b,w),h-g,f-y)}const Df={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ch{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,n,s,h=!1,f=!1){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return ci(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const g=this.dim=n.height-2,y=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=h,!h){for(let b=0;b<g;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(g,b)]=y[this._idx(g-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,g)]=y[this._idx(b,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Vd(this)}get(t,n,s=!1){s&&(t=ye(t,-1,this.dim),n=ye(n,-1,this.dim));const h=4*this._idx(t,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(t){return Df[t]}get unpackVector(){return Df[this.encoding]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}_unpackMapbox(t,n,s){return(256*t*256+256*n+s)/10-1e4}_unpackTerrarium(t,n,s){return 256*t+n+s/256-32768}static pack(t,n){const s=[0,0,0,0],h=Ch.getUnpackVector(n);let f=Math.floor((t+h[3])/h[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new On({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,n,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,f=n*this.dim+this.dim,g=s*this.dim,y=s*this.dim+this.dim;switch(n){case-1:h=f-1;break;case 1:f=h+1}switch(s){case-1:g=y-1;break;case 1:y=g+1}const b=-n*this.dim,w=-s*this.dim;for(let S=g;S<y;S++)for(let E=h;E<f;E++){const k=4*this._idx(E,S),F=4*this._idx(E+b,S+w);this.pixels[k+0]=t.pixels[F+0],this.pixels[k+1]=t.pixels[F+1],this.pixels[k+2]=t.pixels[F+2],this.pixels[k+3]=t.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Jt(Ch,"DEMData"),Jt(Vd,"DemMinMaxQuadTree",{omit:["dem"]});class Gd{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,s){const h=t.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const f={value:n,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(t,f)},s)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const s=t.wrapped().key,h=void 0===n?0:this.data[s].indexOf(n),f=this.data[s][h];return this.data[s].splice(h,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const s in this.data)for(const h of this.data[s])t(h.value)||n.push(h);for(const s of n)this.remove(s.value.tileID,s)}}class lu{constructor(t,n,s){this.func=t,this.mask=n,this.range=s}}lu.ReadOnly=!1,lu.ReadWrite=!0,lu.disabled=new lu(519,lu.ReadOnly,[0,1]);class Of{constructor(t,n,s,h,f,g){this.test=t,this.ref=n,this.mask=s,this.fail=h,this.depthFail=f,this.pass=g}}Of.disabled=new Of({func:519,mask:0},0,0,7680,7680,7680);class oo{constructor(t,n,s){this.blendFunction=t,this.blendColor=n,this.mask=s}}oo.Replace=[1,0],oo.disabled=new oo(oo.Replace,Xe.transparent,[!1,!1,!1,!1]),oo.unblended=new oo(oo.Replace,Xe.transparent,[!0,!0,!0,!0]),oo.alphaBlended=new oo([1,771],Xe.transparent,[!0,!0,!0,!0]);class Tr{constructor(t,n,s){this.enable=t,this.mode=n,this.frontFace=s}}Tr.disabled=new Tr(!1,1029,2305),Tr.backCCW=new Tr(!0,1029,2305),Tr.backCW=new Tr(!0,1029,2304),Tr.frontCW=new Tr(!0,1028,2304),Tr.frontCCW=new Tr(!0,1028,2305);class $l extends ee{constructor(t,n,s){super(),this.id=t,this._onlySymbols=s,n.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Gd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new kg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const n in this._tiles){const s=this._tiles[n];this._source.prepareTile(s)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,s.tileID),s.upload(t),s.prepare(this.map.style.imageManager)}else for(const n in this._tiles){const s=this._tiles[n];s.upload(t),s.prepare(this.map.style.imageManager)}}getIds(){return lo(this._tiles).map(t=>t.tileID).sort(Dg).map(t=>t.key)}getRenderableIds(t){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,t)&&n.push(this._tiles[s]);return t?n.sort((s,h)=>{const f=s.tileID,g=h.tileID,y=new jt(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new jt(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||b.y-y.y||b.x-y.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(Dg).map(s=>s.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const s=this._tiles[t];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,t,n)))}_tileLoaded(t,n,s,h){if(h)if(t.state="errored",404!==h.status)this._source.fire(new Ue(h,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=_n.now(),"expired"===s&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new We("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const f=n[h];if(t.neighboringTiles&&t.neighboringTiles[f]){const g=this.getTileByID(f);s(t,g),s(g,t)}}function s(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-h.tileID.canonical.x;const y=f.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),w=f.tileID.key;0===g&&0===y||Math.abs(y)>1||(Math.abs(g)>1&&(1===Math.abs(g+b)?g+=b:1===Math.abs(g-b)&&(g-=b)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,g,y),h.neighboringTiles&&h.neighboringTiles[w]&&(h.neighboringTiles[w].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,s,h){for(const f in this._tiles){let g=this._tiles[f];if(h[f]||!g.hasData()||g.tileID.overscaledZ<=n||g.tileID.overscaledZ>s)continue;let y=g.tileID;for(;g&&g.tileID.overscaledZ>n+1;){const w=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[w.key],g&&g.hasData()&&(y=w)}let b=y;for(;b.overscaledZ>n;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){h[y.key]=y;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const s=this._loadedParentTiles[t.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=t.overscaledZ-1;s>=n;s--){const h=t.scaledTo(s),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const s=Math.ceil(t.width/n)+1,h=Math.ceil(t.height/n)+1,f=Math.floor(s*h*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(t){const n=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,n){const s={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),s[f.tileID.key]=f}this._tiles=s;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(t,n,s){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let h;this.updateCacheSize(t,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Bi(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(h=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(y=>this._source.hasTile(y)))):h=[];const f=this._updateRetainedTiles(h);if(Ig(this._source.type)&&0!==h.length){const y={},b={},w=Object.keys(f);for(const E of w){const k=f[E],F=this._tiles[E];if(!F||F.fadeEndTime&&F.fadeEndTime<=_n.now())continue;const P=this.findLoadedParent(k,Math.max(k.overscaledZ-$l.maxOverzooming,this._source.minzoom));P&&(this._addTile(P.tileID),y[P.tileID.key]=P.tileID),b[E]=k}const S=h[h.length-1].overscaledZ;for(const E in this._tiles){const k=this._tiles[E];if(f[E]||!k.hasData())continue;let F=k.tileID;for(;F.overscaledZ>S;){F=F.scaledTo(F.overscaledZ-1);const P=this._tiles[F.key];if(P&&P.hasData()&&b[F.key]){f[E]=k.tileID;break}}}for(const E in y)f[E]||(this._coveredTiles[E]=!0,f[E]=y[E])}for(const y in f)this._tiles[y].clearFadeHold();const g=function(y,b){const w=[];for(const S in y)S in b||w.push(S);return w}(this._tiles,f);for(const y of g){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(0===t.length)return n;const s={},h=t.reduce((w,S)=>Math.min(w,S.overscaledZ),1/0),f=t[0].overscaledZ,g=Math.max(f-$l.maxOverzooming,this._source.minzoom),y=Math.max(f+$l.maxUnderzooming,this._source.minzoom),b={};for(const w of t){const S=this._addTile(w);n[w.key]=w,S.hasData()||h<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,h,y,n);for(const w of t){let S=this._tiles[w.key];if(S.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const k=w.children(this._source.maxzoom)[0],F=this.getTile(k);if(F&&F.hasData()){n[k.key]=k;continue}}else{const k=w.children(this._source.maxzoom);if(n[k[0].key]&&n[k[1].key]&&n[k[2].key]&&n[k[3].key])continue}let E=S.wasRequested();for(let k=w.overscaledZ-1;k>=g;--k){const F=w.scaledTo(k);if(s[F.key]||(s[F.key]=!0,S=this.getTile(F),!S&&E&&(S=this._addTile(F)),S&&(n[F.key]=F,E=S.wasRequested(),S.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let s,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}n.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;h=f}for(const f of n)this._loadedParentTiles[f]=s}}_addTile(t){let n=this._tiles[t.key];if(n)return this._source.prepareTile&&this._source.prepareTile(n),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const s=Boolean(n);if(!s){const h=this.map?this.map.painter:null;n=new zd(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._source.prepareTile&&this._source.prepareTile(n)||this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,s||this._source.fire(new We("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const s=n.getExpiryTimeout();s&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},s))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,s){const h=[],f=this.transform;if(!f)return h;const g="globe"===f.projection.name,y=Xr(f.center.lng);for(const b in this._tiles){const w=this._tiles[b];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let S;if(g){const E=w.tileID.canonical;if(0===E.z){const k=[Math.abs(ye(y,...Yl(E,-1))-y),Math.abs(ye(y,...Yl(E,1))-y)];S=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(ye(y,...Yl(E,-1))-y),Math.abs(ye(y,...Yl(E,0))-y),Math.abs(ye(y,...Yl(E,1))-y)];S=[k.indexOf(Math.min(...k))-1]}}else S=[0];for(const E of S){const k=t.containsTile(w,f,n,E);k&&h.push(k)}}return h}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Ig(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=_n.now())return!0}return!1}setFeatureState(t,n,s){this._state.updateState(t=t||"_geojsonTileLayer",n,s)}removeFeatureState(t,n,s){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,s)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,s){const h=this._tiles[t];h&&h.setDependencies(n,s)}reloadTilesForDependencies(t,n){for(const s in this._tiles)this._tiles[s].hasDependency(t,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(t,n))}_preloadTiles(t,n){const s=new Map,h=Array.isArray(t)?t:[t],f=this.map.painter.terrain,g=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of h){const b=y.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of b)s.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}Ji(Array.from(s.values()),(y,b)=>{const w=new zd(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,S=>{"raster-dem"===this._source.type&&w.dem&&this._backfillDEM(w),b(S,w)})},n)}}function Dg(i,t){const n=Math.abs(2*i.wrap)-+(i.wrap<0),s=Math.abs(2*t.wrap)-+(t.wrap<0);return i.overscaledZ-t.overscaledZ||s-n||t.canonical.y-i.canonical.y||t.canonical.x-i.canonical.x}function Ig(i){return"raster"===i||"image"===i||"video"===i}function Yl(i,t){const n=1<<i.z;return[i.x/n+t,(i.x+1)/n+t]}$l.maxOverzooming=10,$l.maxUnderzooming=3;class cu{constructor(t,n,s){this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(t,n,s){const h=s||t.findDEMTileFor(n);if(!h||!h.dem)return;const f=h.dem,g=h.tileID,y=1<<n.canonical.z-g.canonical.z;return new cu(h,h.tileSize/ce/y,[(n.canonical.x/y-g.canonical.x)*f.dim,(n.canonical.y/y-g.canonical.y)*f.dim])}tileCoordToPixel(t,n){const s=n*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),f=Math.floor(s);return new jt(h,f)}getElevationAt(t,n,s,h){const f=t*this._scale+this._offset[0],g=n*this._scale+this._offset[1],y=Math.floor(f),b=Math.floor(g),w=this._dem;return h=!!h,s?Fe(Fe(w.get(y,b,h),w.get(y,b+1,h),g-b),Fe(w.get(y+1,b,h),w.get(y+1,b+1,h),g-b),f-y):w.get(y,b,h)}getElevationAtPixel(t,n,s){return this._dem.get(t,n,!!s)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*rr(1,t)*this._dem.stride}}class jd{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Eo(ce,16,0),this.featureIndexArray=new ep,this.promoteId=n}insert(t,n,s,h,f,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,f,g);const b=this.grid;for(let w=0;w<n.length;w++){const S=n[w],E=[1/0,1/0,-1/0,-1/0];for(let k=0;k<S.length;k++){const F=S[k];E[0]=Math.min(E[0],F.x),E[1]=Math.min(E[1],F.y),E[2]=Math.max(E[2],F.x),E[3]=Math.max(E[3],F.y)}E[0]<ce&&E[1]<ce&&E[2]>=0&&E[3]>=0&&b.insert(y,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wa.VectorTile(new mh(this.rawTileData)).layers,this.sourceLayerCoder=new Cf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,n,s,h){this.loadVTLayers();const f=t.params||{},g=ra(f.filter),y=t.tileResult,b=t.transform,w=y.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(P,B,N,X)=>yp(y.bufferedTilespaceGeometry,P,B,N,X));S.sort(Pf);let E=null;b.elevation&&S.length>0&&(E=cu.create(b.elevation,this.tileID));const k={};let F;for(let P=0;P<S.length;P++){const B=S[P];if(B===F)continue;F=B;const N=this.featureIndexArray.get(B);let X=null;this.loadMatchingFeature(k,N,g,f.layers,f.availableImages,n,s,h,(it,K,tt,ct=0)=>(X||(X=zo(it,this.tileID.canonical,t.tileTransform)),K.queryIntersectsFeature(y,it,tt,X,this.z,t.transform,t.pixelPosMatrix,E,ct)))}return k}loadMatchingFeature(t,n,s,h,f,g,y,b,w){const{featureIndex:S,bucketIndex:E,sourceLayerIndex:k,layoutVertexArrayOffset:F}=n,P=this.bucketLayerIDs[E];if(h&&!function(it,K){for(let tt=0;tt<it.length;tt++)if(K.indexOf(it[tt])>=0)return!0;return!1}(h,P))return;const B=this.sourceLayerCoder.decode(k),N=this.vtLayers[B].feature(S);if(s.needGeometry){const it=ws(N,!0);if(!s.filter(new q(this.tileID.overscaledZ),it,this.tileID.canonical))return}else if(!s.filter(new q(this.tileID.overscaledZ),N))return;const X=this.getId(N,B);for(let it=0;it<P.length;it++){const K=P[it];if(h&&h.indexOf(K)<0)continue;const tt=g[K];if(!tt)continue;let ct={};void 0!==X&&b&&(ct=b.getState(tt.sourceLayer||"_geojsonTileLayer",X));const nt=Ve({},y[K]);nt.paint=Ff(nt.paint,tt.paint,N,ct,f),nt.layout=Ff(nt.layout,tt.layout,N,ct,f);const ft=!w||w(N,tt,ct,F);if(!ft)continue;const vt=new Tg(N,this.z,this.x,this.y,X);vt.layer=nt;let Mt=t[K];void 0===Mt&&(Mt=t[K]=[]),Mt.push({featureIndex:S,feature:vt,intersectionZ:ft})}}lookupSymbolFeatures(t,n,s,h,f,g,y,b){const w={};this.loadVTLayers();const S=ra(f);for(const E of t)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:h,featureIndex:E,layoutVertexArrayOffset:0},S,g,y,b,n);return w}loadFeature(t){const{featureIndex:n,sourceLayerIndex:s}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),f=this.vtFeatures[h];if(f[n])return f[n];const g=this.vtLayers[h].feature(n);return f[n]=g,g}hasLayer(t){for(const n of this.bucketLayerIDs)for(const s of n)if(t===s)return!0;return!1}getId(t,n){let s=t.id;return this.promoteId&&(s=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[n]],"boolean"==typeof s&&(s=Number(s))),s}}function Ff(i,t,n,s,h){return Vn(i,(f,g)=>{const y=t instanceof at?t.get(g):null;return y&&y.evaluate?y.evaluate(n,s,h):y})}function Pf(i,t){return t-i}Jt(jd,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Ta{constructor(t){const n={},s=[];for(const y in t){const b=t[y],w=n[y]={};for(const S in b.glyphs){const E=b.glyphs[+S];if(!E||0===E.bitmap.width||0===E.bitmap.height)continue;const k=E.metrics.localGlyph?2:1,F={x:0,y:0,w:E.bitmap.width+2*k,h:E.bitmap.height+2*k};s.push(F),w[S]=F}}const{w:h,h:f}=Hp(s),g=new Bo({width:h||1,height:f||1});for(const y in t){const b=t[y];for(const w in b.glyphs){const S=b.glyphs[+w];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const E=n[y][w],k=S.metrics.localGlyph?2:1;Bo.copy(S.bitmap,g,{x:0,y:0},{x:E.x+k,y:E.y+k},S.bitmap)}}this.image=g,this.positions=n}}Jt(Ta,"GlyphAtlas");class Lf{constructor(t){this.tileID=new Bi(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Ul(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,n,s,h,f){this.status="parsing",this.data=t,this.collisionBoxArray=new Yr;const g=new Cf(Object.keys(t.layers).sort()),y=new jd(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},w=new wf(256,256),S={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:s},E=n.familiesBySource[this.source];for(const ct in E){const nt=t.layers[ct];if(!nt)continue;let ft=!1,vt=!1;for(const bt of E[ct])"symbol"===bt[0].type?ft=!0:vt=!0;if(!0===this.isSymbolTile&&!ft||!1===this.isSymbolTile&&!vt)continue;1===nt.version&&ci(`Vector tile source "${this.source}" layer "${ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mt=g.encode(ct),Pt=[];for(let bt=0;bt<nt.length;bt++){const St=nt.feature(bt),Ot=y.getId(St,ct);Pt.push({feature:St,id:Ot,index:bt,sourceLayerIndex:Mt})}for(const bt of E[ct]){const St=bt[0];void 0!==this.isSymbolTile&&"symbol"===St.type!==this.isSymbolTile||St.minzoom&&this.zoom<Math.floor(St.minzoom)||St.maxzoom&&this.zoom>=St.maxzoom||"none"!==St.visibility&&(Mh(bt,this.zoom,s),(b[St.id]=St.createBucket({index:y.bucketLayerIDs.length,layers:bt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Pt,S,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(bt.map(Ot=>Ot.id)))}}let k,F,P,B;w.trim();const N={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},X=Vn(S.glyphDependencies,ct=>Object.keys(ct).map(Number));Object.keys(X).length?h.send("getGlyphs",{uid:this.uid,stacks:X},(ct,nt)=>{k||(k=ct,F=nt,tt.call(this))},void 0,!1,N):F={};const it=Object.keys(S.iconDependencies);it.length?h.send("getImages",{icons:it,source:this.source,tileID:this.tileID,type:"icons"},(ct,nt)=>{k||(k=ct,P=nt,tt.call(this))},void 0,!1,N):P={};const K=Object.keys(S.patternDependencies);function tt(){if(k)return f(k);if(F&&P&&B){const ct=new Ta(F),nt=new Jm(P,B);for(const ft in b){const vt=b[ft];vt instanceof Ds?(Mh(vt.layers,this.zoom,s),E_(vt,F,ct.positions,P,nt.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):vt.hasPattern&&(vt instanceof vd||vt instanceof eo||vt instanceof jc)&&(Mh(vt.layers,this.zoom,s),vt.addFeatures(S,this.tileID.canonical,nt.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:lo(b).filter(ft=>!ft.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ct.image,lineAtlas:w,imageAtlas:nt,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?P:null,glyphPositions:this.returnDependencies?ct.positions:null})}}K.length?h.send("getImages",{icons:K,source:this.source,tileID:this.tileID,type:"patterns"},(ct,nt)=>{k||(k=ct,B=nt,tt.call(this))},void 0,!1,N):B={},tt.call(this)}}function Mh(i,t,n){const s=new q(t);for(const h of i)h.recalculate(s,n)}class Rf{constructor(t){this.entries={},this.scheduler=t}request(t,n,s,h){const f=this.entries[t]=this.entries[t]||{callbacks:[]};if(f.result){const[g,y]=f.result;return this.scheduler?this.scheduler.add(()=>{h(g,y)},n):h(g,y),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=s((g,y)=>{f.result=[g,y];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,y)},n):b(g,y);setTimeout(()=>delete this.entries[t],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==h),f.callbacks.length||(f.cancel(),delete this.entries[t]))}}}function qd(i,t,n){const s=JSON.stringify(i.request);return i.data&&(this.deduped.entries[s]={result:[null,i.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const f=_t(i.request,(g,y,b,w)=>{g?h(g):y&&h(null,{vectorTile:n?void 0:new wa.VectorTile(new mh(y)),rawData:y,cacheControl:b,expires:w})});return()=>{f.cancel(),h()}},t)}d.ARRAY_TYPE=Mn,d.AUTH_ERR_MSG=Ki,d.Aabb=In,d.Actor=class{constructor(i,t,n){this.target=i,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},dr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=an()?i:Bt,this.scheduler=new B_}send(i,t,n,s,h=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=f,this.callbacks[g]=n);const y=uo(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:i,hasCallback:!!n,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:ca(t,y)},y),{cancel:()=>{n&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const t=i.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(t.mustQueue||an()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,t),s&&s.metadata||{type:"message"})}else this.processTask(n,t)}processTask(i,t){if("<response>"===t.type){const n=this.callbacks[i];delete this.callbacks[i],n&&(t.error?n(ys(t.error)):n(null,ys(t.data)))}else{const n=uo(this.globalScope)?void 0:[],s=t.hasCallback?(f,g)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:f?ca(f):null,data:ca(g,n)},n)}:f=>{},h=ys(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,h,s);else if(this.parent.getWorkerSource){const f=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,f[0],h.source)[f[1]](h,s)}else s(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=gd,d.Color=Xe,d.ColorMode=oo,d.CullFaceMode=Tr,d.DEMData=Ch,d.DataConstantProperty=rt,d.DedupedRequest=Rf,d.DepthMode=lu,d.EXTENT=ce,d.Elevation=class{isDataAvailableAtPoint(i){const t=this._source();if(!t||i.y<0||i.y>1)return!1;const n=t.getSource().maxzoom,s=1<<n,h=Math.floor(i.x),f=Math.floor((i.x-h)*s),g=Math.floor(i.y*s),y=this.findDEMTileFor(new Bi(n,h,n,f,g));return!(!y||!y.dem)}getAtPointOrZero(i,t=0){return this.getAtPoint(i,t)||0}getAtPoint(i,t,n=!0){null==t&&(t=null);const s=this._source();if(!s||i.y<0||i.y>1)return t;const h=s.getSource().maxzoom,f=1<<h,g=Math.floor(i.x),y=i.x-g,b=new Bi(h,g,h,Math.floor(y*f),Math.floor(i.y*f)),w=this.findDEMTileFor(b);if(!w||!w.dem)return t;const S=w.dem,E=1<<w.tileID.canonical.z,k=(y*E-w.tileID.canonical.x)*S.dim,F=(i.y*E-w.tileID.canonical.y)*S.dim,P=Math.floor(k),B=Math.floor(F);return(n?this.exaggeration():1)*Fe(Fe(S.get(P,B),S.get(P,B+1),F-B),Fe(S.get(P+1,B),S.get(P+1,B+1),F-B),k-P)}getAtTileOffset(i,t,n){const s=1<<i.canonical.z;return this.getAtPointOrZero(new Cl(i.wrap+(i.canonical.x+t/ce)/s,(i.canonical.y+n/ce)/s))}getAtTileOffsetFunc(i,t,n,s){return h=>{const f=this.getAtTileOffset(i,h.x,h.y),g=s.upVector(i.canonical,h.x,h.y);return Cr(g,g,f*s.upVectorScale(i.canonical,t,n).metersToTile),g}}getForTilePoints(i,t,n,s){const h=cu.create(this,i,s);return!!h&&(t.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],n)}),!0)}getMinMaxForTile(i){const t=this.findDEMTileFor(i);if(!t||!t.dem)return null;const n=t.dem.tree,s=t.tileID,h=1<<i.canonical.z-s.canonical.z;let f=i.canonical.x/h-s.canonical.x,g=i.canonical.y/h-s.canonical.y,y=0;for(let b=0;b<i.canonical.z-s.canonical.z&&!n.leaves[y];b++){f*=2,g*=2;const w=2*Math.floor(g)+Math.floor(f);y=n.childOffsets[y]+w,f%=1,g%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=Ue,d.EvaluationParameters=q,d.Event=We,d.Evented=ee,d.FillExtrusionBucket=jc,d.Frustum=Ap,d.FrustumCorners=oh,d.GLOBE_METERS_TO_ECEF=nf,d.GLOBE_RADIUS=ks,d.GLOBE_SCALE_MATCH_LATITUDE=45,d.GLOBE_ZOOM_THRESHOLD_MAX=6,d.GLOBE_ZOOM_THRESHOLD_MIN=5,d.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const t=new Ut,n=new Me,s=65;for(let h=0;h<s;h++)for(let f=0;f<s;f++)t.emplaceBack(f,h);this._gridSegments=[];for(let h=0,f=0;h<Qc.length;h++){const g=Qc[h];for(let b=0;b<g;b++)for(let w=0;w<64;w++){const S=b*s+w;n.emplaceBack(S+1,S,S+s),n.emplaceBack(S+s,S+s+1,S+1)}const y=64*g*2;this._gridSegments.push(Ti.simpleSegment(0,f,(g+1)*s,y)),f+=y}this._gridBuffer=i.createVertexBuffer(t,yh.members),this._gridIndexBuffer=i.createIndexBuffer(n,!0)}_createPoles(i){const t=new Me;for(let h=0;h<=64;h++)t.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=i.createIndexBuffer(t,!0);const n=new tn,s=new tn;this._poleSegments=[];for(let h=0,f=0;h<5;h++){const g=360/(1<<h);n.emplaceBack(0,-ks,0,.5,0),s.emplaceBack(0,-ks,0,.5,1);for(let y=0;y<=64;y++){const b=y/64,w=Fe(0,g,b),[S,E,k]=Pn(bg,L_,w,ks);n.emplaceBack(S,E,k,b,0),s.emplaceBack(S,E,k,b,1)}this._poleSegments.push(Ti.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(n,gg,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(s,gg,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,t){if(!this._wireframeSegments){const n=new en,s=64,h=s+1;this._wireframeSegments=[];for(let f=0,g=0;f<Qc.length;f++){const y=Qc[f];for(let w=0;w<y;w++)for(let S=0;S<s;S++){const E=w*h+S;n.emplaceBack(E,E+1),n.emplaceBack(E,E+h),n.emplaceBack(E,E+h+1)}const b=y*s*3;this._wireframeSegments.push(Ti.simpleSegment(0,g,(y+1)*h,b)),g+=b}this._wireframeIndexBuffer=i.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},d.GlyphManager=Jc,d.ImagePosition=$p,d.LineAtlas=wf,d.LngLat=qe,d.LngLatBounds=bs,d.LocalGlyphMode=Kp,d.MAX_MERCATOR_LATITUDE=Jr,d.MercatorCoordinate=Cl,d.ONE_EM=24,d.OverscaledTileID=Bi,d.Properties=At,d.RGBAImage=On,d.Ray=Bc,d.RequestManager=class{constructor(i,t,n){this._transformRequestFn=i,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const i=function(){let t="";for(let n=0;n<10;n++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",fo,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,t){return this._transformRequestFn&&this._transformRequestFn(i,t)||{url:i}}normalizeStyleURL(i,t){if(!yn(i))return i;const n=vn(i);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeGlyphsURL(i,t){if(!yn(i))return i;const n=vn(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(i,t,n,s){if(!yn(i))return i;const h=vn(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),n&&h.params.push(`language=${n}`),s&&h.params.push(`worldview=${s}`),this._makeAPIURL(h,this._customAccessToken||t)}normalizeSpriteURL(i,t,n,s){const h=vn(i);return yn(i)?(h.path=`/styles/v1${h.path}/sprite${t}${n}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${t}${n}`,Pr(h))}normalizeTileURL(i,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!yn(i))return i;const s=vn(i);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||n&&"raster"!==s.authority&&512===n?"@2x":""}${wi.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${Ie.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Ie.TILE_URL_VERSION}${s.path}`);const h=this._customAccessToken||function(f){for(const g of f){const y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||Ie.ACCESS_TOKEN;return Ie.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(i,t){const n=vn(i);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${Ie.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${Ie.TILE_URL_VERSION}/`,"")}`;let h=n.params;return t&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(i,t){const n=!!t&&yn(t),s=[];for(const h of i.tiles||[])mo(h)?s.push(this.canonicalizeTileURL(h,n)):s.push(h);return s}_makeAPIURL(i,t){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=vn(Ie.API_URL);if(i.protocol=s.protocol,i.authority=s.authority,"http"===i.protocol){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if("/"!==s.path&&(i.path=`${s.path}${i.path}`),!Ie.REQUIRE_ACCESS_TOKEN)return Pr(i);if(t=t||Ie.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(h=>-1===h.indexOf("access_token")),i.params.push(`access_token=${t||""}`),Pr(i)}},d.ResourceType=ut,d.SegmentVector=Ti,d.SourceCache=$l,d.StencilMode=Of,d.StructArrayLayout1ui2=Hr,d.StructArrayLayout2f1f2i16=nr,d.StructArrayLayout2i4=Ut,d.StructArrayLayout2ui4=en,d.StructArrayLayout3f12=di,d.StructArrayLayout3ui6=Me,d.StructArrayLayout4i8=ie,d.StructArrayLayout5f20=tn,d.Texture=Hl,d.Tile=zd,d.Transitionable=J,d.Uniform1f=Wu,d.Uniform1i=class extends Po{constructor(i){super(i),this.current=0}set(i,t,n){this.fetchUniformLocation(i,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},d.Uniform2f=class extends Po{constructor(i){super(i),this.current=[0,0]}set(i,t,n){this.fetchUniformLocation(i,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},d.Uniform3f=class extends Po{constructor(i){super(i),this.current=[0,0,0]}set(i,t,n){this.fetchUniformLocation(i,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},d.Uniform4f=sp,d.UniformColor=ap,d.UniformMatrix2f=class extends Po{constructor(i){super(i),this.current=Yg}set(i,t,n){if(this.fetchUniformLocation(i,t))for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},d.UniformMatrix3f=class extends Po{constructor(i){super(i),this.current=tm}set(i,t,n){if(this.fetchUniformLocation(i,t))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},d.UniformMatrix4f=class extends Po{constructor(i){super(i),this.current=Qf}set(i,t,n){if(this.fetchUniformLocation(i,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},d.UnwrappedTileID=dh,d.ValidationError=Yt,d.VectorTileWorkerSource=class extends ee{constructor(i,t,n,s,h){super(),this.actor=i,this.layerIndex=t,this.availableImages=n,this.loadVectorData=h||qd,this.loading={},this.loaded={},this.deduped=new Rf(i.scheduler),this.isSpriteLoaded=s,this.scheduler=i.scheduler}loadTile(i,t){const n=i.uid,s=i&&i.request,h=s&&s.collectResourceTiming,f=this.loading[n]=new Lf(i);f.abort=this.loadVectorData(i,(g,y)=>{const b=!this.loading[n];if(delete this.loading[n],b||g||!y)return f.status="done",b||(this.loaded[n]=f),t(g);const w=y.rawData,S={};y.expires&&(S.expires=y.expires),y.cacheControl&&(S.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new wa.VectorTile(new mh(w));const E=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,F)=>{if(k||!F)return t(k);const P={};if(h){const B=fr(s);B.length>0&&(P.resourceTiming=JSON.parse(JSON.stringify(B)))}t(null,Ve({rawTileData:w.slice(0)},F,S,P))})};this.isSpriteLoaded?E():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(E,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):E()}),this.loaded=this.loaded||{},this.loaded[n]=f})}reloadTile(i,t){const n=this.loaded,s=i.uid,h=this;if(n&&n[s]){const f=n[s];f.showCollisionBoxes=i.showCollisionBoxes,f.enableTerrain=!!i.enableTerrain,f.projection=i.projection,f.tileTransform=Ul(i.tileID.canonical,i.projection);const g=(y,b)=>{const w=f.reloadCallback;w&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,w)),t(y,b)};"parsing"===f.status?f.reloadCallback=g:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(i,t){const n=i.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),t()}removeTile(i,t){const n=this.loaded,s=i.uid;n&&n[s]&&delete n[s],t()}},d.WritingMode=cr,d.ZoomHistory=Cc,d.add=Cs,d.addDynamicAttributes=Id,d.adjoint=function(i,t){var n=t[0],s=t[1],h=t[2],f=t[3],g=t[4],y=t[5],b=t[6],w=t[7],S=t[8];return i[0]=g*S-y*w,i[1]=h*w-s*S,i[2]=s*y-h*g,i[3]=y*b-f*S,i[4]=n*S-h*b,i[5]=h*f-n*y,i[6]=f*w-g*b,i[7]=s*b-n*w,i[8]=n*g-s*f,i},d.asyncAll=Ji,d.bezier=ao,d.bindAll=dr,d.boundsAttributes=Rd,d.bufferConvexPolygon=function(i,t){const n=[];for(let s=0;s<i.length;s++){const h=Dr(s-1,-1,i.length-1),f=Dr(s+1,-1,i.length-1),g=i[s],y=i[f],b=i[h].sub(g).unit(),w=y.sub(g).unit(),S=w.angleWithSep(b.x,b.y),E=b.add(w).unit().mult(-1*t/Math.sin(S/2));n.push(g.add(E))}return n},d.cacheEntryPossiblyAdded=function(i){Q++,Q>ns&&(i.getActor().send("enforceCacheSizeLimit",is),Q=0)},d.calculateGlobeLabelMatrix=function(i,t){const{x:n,y:s}=i.point,h=kd(n,s,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Tl(h,h,iu(jo(t)))},d.calculateGlobeMatrix=function(i){const{x:t,y:n}=i.point,{lng:s,lat:h}=i._center;return kd(t,n,i.worldSize,s,h)},d.calculateGlobeMercatorMatrix=function(i){const t=i.pixelsPerMeter,n=t/rr(1,i.center.lat),s=An(new Float64Array(16));return Fc(s,s,[i.point.x,i.point.y,0]),ya(s,s,[n,n,t]),Float32Array.from(s)},d.circumferenceAtLatitude=up,d.clamp=ye,d.clearTileCache=function(i){const t=Y(),n=[];for(const s in Ri)t&&n.push(t.delete(s)),delete Ri[s];i&&Promise.all(n).catch(i).then(()=>i())},d.clipLine=lg,d.clone=function(i){var t=new Mn(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},d.clone$1=mn,d.collisionCircleLayout=o_,d.config=Ie,d.conjugate=function(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i},d.create=function(){var i=new Mn(16);return Mn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},d.create$1=Sl,d.createExpression=ps,d.createLayout=Et,d.createStyleLayer=function(i){return"custom"===i.type?new Ld(i):new z_[i.type](i)},d.cross=rd,d.degToRad=_e,d.distance=function(i,t){return Math.hypot(t[0]-i[0],t[1]-i[1],t[2]-i[2])},d.div=function(i,t,n){return i[0]=t[0]/n[0],i[1]=t[1]/n[1],i[2]=t[2]/n[2],i},d.dot=ar,d.ease=Xo,d.easeCubicInOut=Wo,d.emitValidationErrors=gl,d.endsWith=co,d.enforceCacheSizeLimit=function(i){for(const t in Ri)L(t),Ri[t].then(n=>{n.keys().then(s=>{for(let h=0;h<s.length-i;h++)n.delete(s[h])})})},d.evaluateSizeForFeature=xd,d.evaluateSizeForZoom=Hc,d.evaluateVariableOffset=pg,d.evented=R,d.exactEquals=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]},d.exactEquals$1=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]},d.exported=_n,d.exported$1=wi,d.extend=Ve,d.extend$1=xn,d.fillExtrusionHeightLift=Rm,d.filterObject=Or,d.fromMat4=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],i},d.fromQuat=function(i,t){var n=t[0],s=t[1],h=t[2],f=t[3],g=n+n,y=s+s,b=h+h,w=n*g,S=s*g,E=s*y,k=h*g,F=h*y,P=h*b,B=f*g,N=f*y,X=f*b;return i[0]=1-E-P,i[1]=S+X,i[2]=k-N,i[3]=0,i[4]=S-X,i[5]=1-w-P,i[6]=F+B,i[7]=0,i[8]=k+N,i[9]=F-B,i[10]=1-w-E,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.fromRotation=function(i,t){var n=Math.sin(t),s=Math.cos(t);return i[0]=s,i[1]=n,i[2]=0,i[3]=-n,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},d.fromScaling=bp,d.furthestTileCorner=function(i){const t=Math.round((i+45+360)%360/90)%4;return Ia[t]},d.getAABBPointSquareDist=function(i,t,n){let s=0;for(let h=0;h<2;++h){const f=n?n[h]:0;i[h]>f&&(s+=(i[h]-f)*(i[h]-f)),t[h]<f&&(s+=(f-t[h])*(f-t[h]))}return s},d.getAnchorAlignment=Xp,d.getAnchorJustification=tf,d.getBounds=function(i){let t=1/0,n=1/0,s=-1/0,h=-1/0;for(const f of i)t=Math.min(t,f.x),n=Math.min(n,f.y),s=Math.max(s,f.x),h=Math.max(h,f.y);return{min:new jt(t,n),max:new jt(s,h)}},d.getColumn=Gn,d.getGridMatrix=function(i,t,n){const s=t.getNorth(),h=t.getSouth(),f=t.getWest(),g=.015625;return[0,(t.getEast()-f)*g,1<<i.z,(h-s)/Qc[n],0,i.y,s,f,g]},d.getImage=oe,d.getJSON=function(i,t){return ht(Ve(i,{type:"json"}),t)},d.getLatitudinalLod=function(i){const t=80.051129;i=ye(i,-80.051129,t)/t*90;const n=Math.pow(Math.abs(Math.sin(_e(i))),3);return Math.round(n*(Qc.length-1))},d.getMapSessionAPI=za,d.getPerformanceMeasurement=fr,d.getProjection=ff,d.getRTLTextPluginStatus=V,d.getReferrer=pt,d.getTilePoint=function(i,{x:t,y:n},s=0){return new jt(((t-s)*i.scale-i.x)*ce,(n*i.scale-i.y)*ce)},d.getTileVec3=function(i,t,n=0){return kl(((t.x-n)*i.scale-i.x)*ce,(t.y*i.scale-i.y)*ce,hp(t.z,t.y))},d.getVideo=function(i,t){const n=Bt.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let s=0;s<i.length;s++){const h=Bt.document.createElement("source");Ft(i[s])||(n.crossOrigin="Anonymous"),h.src=i[s],n.appendChild(h)}return{cancel:()=>{}}},d.globeCenterToScreenPoint=function(i){const t=[0,0,0],n=An(new Float64Array(16));return Tl(n,i.pixelMatrix,i.globeMatrix),Ii(t,t,n),new jt(t[0],t[1])},d.globeDenormalizeECEF=iu,d.globeECEFOrigin=function(i,t){const n=[0,0,0];return Ii(n,n,Nl(jo(t.canonical))),Ii(n,n,i),n},d.globeNormalizeECEF=Nl,d.globePixelsToTileUnits=function(i,t){return ce/(512*Math.pow(2,i))*Ed(jo(t))},d.globePoleMatrixForTile=function(i,t,n){const s=An(new Float64Array(16)),h=(t/(1<<i)-.5)*Math.PI*2;return eh(s,n.globeMatrix,h),Float32Array.from(s)},d.globeTileBounds=jo,d.globeTiltAtLngLat=af,d.globeToMercatorTransition=nu,d.globeUseCustomAntiAliasing=function(i,t,n){const s=nu(n.zoom),h=i.style.map._antialias,f=!!t.extStandardDerivatives,g=t.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return 0===s&&!h&&!g&&f},d.identity=An,d.identity$1=Rc,d.invert=th,d.isFullscreen=function(){return!!Bt.document.fullscreenElement||!!Bt.document.webkitFullscreenElement},d.isLngLatBehindGlobe=function(i,t){return af(i,t)>Math.PI/2*1.01},d.isMapAuthenticated=function(i){return Lr.has(i)},d.isMapboxURL=yn,d.isSafariWithAntialiasingBug=function(i){const t=i.navigator?i.navigator.userAgent:null;return!!uo(i)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},d.latFromMercatorY=Yi,d.len=mm,d.length=El,d.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},d.loadVectorTile=qd,d.makeRequest=ht,d.mapValue=function(i,t,n,s,h){return ye((i-t)/(n-t)*(h-s)+s,s,h)},d.mercatorScale=am,d.mercatorXfromLng=Xr,d.mercatorYfromLat=Ro,d.mercatorZfromAltitude=rr,d.mul=ih,d.mul$1=fm,d.multiply=Tl,d.multiply$1=function(i,t,n){var s=t[0],h=t[1],f=t[2],g=t[3],y=t[4],b=t[5],w=t[6],S=t[7],E=t[8],k=n[0],F=n[1],P=n[2],B=n[3],N=n[4],X=n[5],it=n[6],K=n[7],tt=n[8];return i[0]=k*s+F*g+P*w,i[1]=k*h+F*y+P*S,i[2]=k*f+F*b+P*E,i[3]=B*s+N*g+X*w,i[4]=B*h+N*y+X*S,i[5]=B*f+N*b+X*E,i[6]=it*s+K*g+tt*w,i[7]=it*h+K*y+tt*S,i[8]=it*f+K*b+tt*E,i},d.multiply$2=wp,d.nextPowerOfTwo=Ls,d.normalize=dn,d.normalize$1=function(i,t){var n=t[0],s=t[1],h=t[2],f=t[3],g=n*n+s*s+h*h+f*f;return g>0&&(g=1/Math.sqrt(g)),i[0]=n*g,i[1]=s*g,i[2]=h*g,i[3]=f*g,i},d.number=Fe,d.ortho=function(i,t,n,s,h,f,g){var y=1/(t-n),b=1/(s-h),w=1/(f-g);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(t+n)*y,i[13]=(h+s)*b,i[14]=(g+f)*w,i[15]=1,i},d.pbf=mh,d.perspective=function(i,t,n,s,h){var f,g=1/Math.tan(t/2);return i[0]=g/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=h&&h!==1/0?(i[10]=(h+s)*(f=1/(s-h)),i[14]=2*h*s*f):(i[10]=-1,i[14]=-2*s),i},d.pick=function(i,t){const n={};for(let s=0;s<t.length;s++){const h=t[s];h in i&&(n[h]=i[h])}return n},d.plugin=j,d.pointGeometry=jt,d.polygonContainsPoint=ga,d.polygonIntersectsBox=yp,d.polygonIntersectsPolygon=pp,d.polygonizeBounds=function(i,t,n=0,s=!0){const h=new jt(n,n),f=i.sub(h),g=t.add(h),y=[f,new jt(g.x,f.y),g,new jt(f.x,g.y)];return s&&y.push(f.clone()),y},d.posAttributes=yh,d.postMapLoadEvent=Kl,d.postTurnstileEvent=Pa,d.potpack=Hp,d.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},d.radToDeg=si,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(i){return i({pluginStatus:A,pluginURL:T}),R.on("pluginStateChange",i),i},d.removeAuthState=function(i){Lr.delete(i)},d.renderColorRamp=Ip,d.resample=dp,d.rotateX=td,d.rotateX$1=zc,d.rotateY=eh,d.rotateY$1=od,d.rotateZ=function(i,t,n){var s=Math.sin(n),h=Math.cos(n),f=t[0],g=t[1],y=t[2],b=t[3],w=t[4],S=t[5],E=t[6],k=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*h+w*s,i[1]=g*h+S*s,i[2]=y*h+E*s,i[3]=b*h+k*s,i[4]=w*h-f*s,i[5]=S*h-g*s,i[6]=E*h-y*s,i[7]=k*h-b*s,i},d.rotateZ$1=function(i,t,n){n*=.5;var s=t[0],h=t[1],f=t[2],g=t[3],y=Math.sin(n),b=Math.cos(n);return i[0]=s*b+h*y,i[1]=h*b-s*y,i[2]=f*b+g*y,i[3]=g*b-f*y,i},d.scale=ya,d.scale$1=Mp,d.scale$2=Cr,d.scaleAndAdd=rh,d.setCacheLimits=function(i,t){is=i,ns=t},d.setColumn=function(i,t,n){i[4*t+0]=n[0],i[4*t+1]=n[1],i[4*t+2]=n[2],i[4*t+3]=n[3]},d.setRTLTextPlugin=function(i,t,n=!1){if(A===m||A===v||A===x)throw new Error("setRTLTextPlugin cannot be called multiple times.");T=_n.resolveURL(i),A=m,M=t,O(),n||H()},d.smoothstep=sn,d.spec=Ct,d.storeAuthState=function(i,t){t?Lr.add(i):Lr.delete(i)},d.sub=Mr,d.subtract=Pc,d.symbolSize=qm,d.tileAABB=function(i,t,n,s,h,f,g,y,b){if("globe"===b.name)return function P_(i,t,n){const s=t/i.worldSize,h=Number.MAX_VALUE,f=[-h,-h,-h],g=[h,h,h],y=i.globeMatrix;if(n.z<=1)return xg(g,f,jo(n).getCorners(),y,s),new In(g,f);const b=Sd(n),w=Td(b);if(xg(g,f,w,y,s),b.contains(i.center)){f[2]=0;const ft=i.point,vt=[ft.x*s,ft.y*s,0];return id(g,g,vt),nd(f,f,vt),new In(g,f)}const S=[y[12]*s,y[13]*s,y[14]*s],E=b.getCenter(),k=ye(i.center.lat,-85.051129,Jr),F=ye(E.lat,-85.051129,Jr),P=Xr(i.center.lng),B=Ro(k);let N=P-Xr(E.lng);const X=B-Ro(F);N>.5?N-=1:N<-.5&&(N+=1);let it=0;Math.abs(N)>Math.abs(X)?it=N>=0?1:3:(it=X>=0?0:2,rh(S,S,[y[4]*s,y[5]*s,y[6]*s],-Math.sin(_e(X>=0?b.getSouth():b.getNorth()))*ks));const K=w[it],tt=w[(it+1)%4],ct=new F_(K,tt,S),nt=[rf(ct,0)||K[0],rf(ct,1)||K[1],rf(ct,2)||K[2]];return g[2]=Math.min(K[2],tt[2]),id(g,g,nt),nd(f,f,nt),new In(g,f)}(i,t,new gd(n,s,h));const w=Ul({z:n,x:s,y:h},b);return new In([(f+w.x/w.scale)*t,t*(w.y/w.scale),g],[(f+w.x2/w.scale)*t,t*(w.y2/w.scale),y])},d.tileCornersToBounds=Sd,d.tileTransform=Ul,d.transformMat3=function(i,t,n){var s=t[0],h=t[1],f=t[2];return i[0]=s*n[0]+h*n[3]+f*n[6],i[1]=s*n[1]+h*n[4]+f*n[7],i[2]=s*n[2]+h*n[5]+f*n[8],i},d.transformMat4=Ii,d.transformMat4$1=va,d.transformQuat=Cp,d.transitionTileAABBinECEF=vg,d.translate=Fc,d.transpose=function(i,t){if(i===t){var n=t[1],s=t[2],h=t[5];i[1]=t[3],i[2]=t[6],i[3]=n,i[5]=t[7],i[6]=s,i[7]=h}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i},d.triggerPluginCompletionEvent=D,d.uniqueId=Jo,d.updateGlobeVertexNormal=function(i,t,n,s,h){const f=5*t+2;i.float32[f+0]=n,i.float32[f+1]=s,i.float32[f+2]=h},d.validateCustomStyleLayer=function(i){const t=[],n=i.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===i.render&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},d.validateFilter=i=>er(gs(i)),d.validateFog=i=>er(zu(i)),d.validateLayer=i=>er(fl(i)),d.validateLight=i=>er(Ru(i)),d.validateSource=i=>er(Lu(i)),d.validateStyle=la,d.validateTerrain=i=>er(_s(i)),d.values=lo,d.vectorTile=wa,d.version="2.10.0",d.warnOnce=ci,d.window=Bt,d.wrap=Dr}),ur(0,function(d){function Bt(Y){if("number"==typeof Y||"boolean"==typeof Y||"string"==typeof Y||null==Y)return JSON.stringify(Y);if(Array.isArray(Y)){let z="[";for(const W of Y)z+=`${Bt(W)},`;return`${z}]`}let L="{";for(const z of Object.keys(Y).sort())L+=`${z}:${Bt(Y[z])},`;return`${L}}`}function hr(Y){let L="";for(const z of d.refProperties)L+=`/${Bt(Y[z])}`;return L}class li{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,z){for(const Q of L)this._layerConfigs[Q.id]=Q,(this._layers[Q.id]=d.createStyleLayer(Q)).compileFilter(),this.keyCache[Q.id]&&delete this.keyCache[Q.id];for(const Q of z)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const W=function(Q,ut){const mt={};for(let ht=0;ht<Q.length;ht++){const _t=ut&&ut[Q[ht].id]||hr(Q[ht]);ut&&(ut[Q[ht].id]=_t);let Dt=mt[_t];Dt||(Dt=mt[_t]=[]),Dt.push(Q[ht])}const pt=[];for(const ht in mt)pt.push(mt[ht]);return pt}(d.values(this._layerConfigs),this.keyCache);for(const Q of W){const ut=Q.map(Wt=>this._layers[Wt.id]),mt=ut[0];if("none"===mt.visibility)continue;const pt=mt.source||"";let ht=this.familiesBySource[pt];ht||(ht=this.familiesBySource[pt]={});const _t=mt.sourceLayer||"_geojsonTileLayer";let Dt=ht[_t];Dt||(Dt=ht[_t]=[]),Dt.push(ut)}}}class jt{loadTile(L,z){const{uid:W,encoding:Q,rawImageData:ut,padding:mt,buildQuadTree:pt}=L,ht=d.window.ImageBitmap&&ut instanceof d.window.ImageBitmap?this.getImageData(ut,mt):ut;z(null,new d.DEMData(W,ht,Q,mt<1,pt))}getImageData(L,z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const W=this.offscreenCanvasContext.getImageData(-z,-z,L.width+2*z,L.height+2*z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),W}}var Ae=function Y(L,z){var W,Q=L&&L.type;if("FeatureCollection"===Q)for(W=0;W<L.features.length;W++)Y(L.features[W],z);else if("GeometryCollection"===Q)for(W=0;W<L.geometries.length;W++)Y(L.geometries[W],z);else if("Feature"===Q)Y(L.geometry,z);else if("Polygon"===Q)Xi(L.coordinates,z);else if("MultiPolygon"===Q)for(W=0;W<L.coordinates.length;W++)Xi(L.coordinates[W],z);return L};function Xi(Y,L){if(0!==Y.length){Bn(Y[0],L);for(var z=1;z<Y.length;z++)Bn(Y[z],!L)}}function Bn(Y,L){for(var z=0,W=0,Q=0,ut=Y.length,mt=ut-1;Q<ut;mt=Q++){var pt=(Y[Q][0]-Y[mt][0])*(Y[mt][1]+Y[Q][1]),ht=z+pt;W+=Math.abs(z)>=Math.abs(pt)?z-ht+pt:pt-ht+z,z=ht}z+W>=0!=!!L&&Y.reverse()}const _e=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class si{constructor(L){this._feature=L,this.extent=d.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(1===this._feature.type){const L=[];for(const z of this._feature.geometry)L.push([new d.pointGeometry(z[0],z[1])]);return L}{const L=[];for(const z of this._feature.geometry){const W=[];for(const Q of z)W.push(new d.pointGeometry(Q[0],Q[1]));L.push(W)}return L}}toGeoJSON(L,z,W){return _e.call(this,L,z,W)}}class Ia{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=L.length,this._features=L}feature(L){return new si(this._features[L])}}var Wo=d.vectorTile.VectorTileFeature,ao=Xo;function Xo(Y,L){this.options=L||{},this.features=Y,this.length=Y.length}function ye(Y,L){this.id="number"==typeof Y.id?Y.id:void 0,this.type=Y.type,this.rawGeometry=1===Y.type?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=L||4096}Xo.prototype.feature=function(Y){return new ye(this.features[Y],this.options.extent)},ye.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var L=0;L<Y.length;L++){for(var z=Y[L],W=[],Q=0;Q<z.length;Q++)W.push(new d.pointGeometry(z[Q][0],z[Q][1]));this.geometry.push(W)}return this.geometry},ye.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,L=1/0,z=-1/0,W=1/0,Q=-1/0,ut=0;ut<Y.length;ut++)for(var mt=Y[ut],pt=0;pt<mt.length;pt++){var ht=mt[pt];L=Math.min(L,ht.x),z=Math.max(z,ht.x),W=Math.min(W,ht.y),Q=Math.max(Q,ht.y)}return[L,W,z,Q]},ye.prototype.toGeoJSON=Wo.prototype.toGeoJSON;var sn=Ji,Dr=ao;function Ji(Y){var L=new d.pbf;return function(z,W){for(var Q in z.layers)W.writeMessage(3,lo,z.layers[Q])}(Y,L),L.finish()}function lo(Y,L){var z;L.writeVarintField(15,Y.version||1),L.writeStringField(1,Y.name||""),L.writeVarintField(5,Y.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<Y.length;z++)W.feature=Y.feature(z),L.writeMessage(2,Ve,W);var Q=W.keys;for(z=0;z<Q.length;z++)L.writeStringField(3,Q[z]);var ut=W.values;for(z=0;z<ut.length;z++)L.writeMessage(4,Rs,ut[z])}function Ve(Y,L){var z=Y.feature;void 0!==z.id&&L.writeVarintField(1,z.id),L.writeMessage(2,Hn,Y),L.writeVarintField(3,z.type),L.writeMessage(4,Ls,z)}function Hn(Y,L){var z=Y.feature,W=Y.keys,Q=Y.values,ut=Y.keycache,mt=Y.valuecache;for(var pt in z.properties){var ht=z.properties[pt],_t=ut[pt];if(null!==ht){void 0===_t&&(W.push(pt),ut[pt]=_t=W.length-1),L.writeVarint(_t);var Dt=typeof ht;"string"!==Dt&&"boolean"!==Dt&&"number"!==Dt&&(ht=JSON.stringify(ht));var Wt=Dt+":"+ht,Ft=mt[Wt];void 0===Ft&&(Q.push(ht),mt[Wt]=Ft=Q.length-1),L.writeVarint(Ft)}}}function Jo(Y,L){return(L<<3)+(7&Y)}function Ir(Y){return Y<<1^Y>>31}function Ls(Y,L){for(var z=Y.loadGeometry(),W=Y.type,Q=0,ut=0,mt=z.length,pt=0;pt<mt;pt++){var ht=z[pt],_t=1;1===W&&(_t=ht.length),L.writeVarint(Jo(1,_t));for(var Dt=3===W?ht.length-1:ht.length,Wt=0;Wt<Dt;Wt++){1===Wt&&1!==W&&L.writeVarint(Jo(2,Dt-1));var Ft=ht[Wt].x-Q,re=ht[Wt].y-ut;L.writeVarint(Ir(Ft)),L.writeVarint(Ir(re)),Q+=Ft,ut+=re}3===W&&L.writeVarint(Jo(7,1))}}function Rs(Y,L){var z=typeof Y;"string"===z?L.writeStringField(1,Y):"boolean"===z?L.writeBooleanField(7,Y):"number"===z&&(Y%1!=0?L.writeDoubleField(3,Y):Y<0?L.writeSVarintField(6,Y):L.writeVarintField(5,Y))}function dr(Y,L,z,W,Q,ut){if(Q-W<=z)return;const mt=W+Q>>1;co(Y,L,mt,W,Q,ut%2),dr(Y,L,z,W,mt-1,ut+1),dr(Y,L,z,mt+1,Q,ut+1)}function co(Y,L,z,W,Q,ut){for(;Q>W;){if(Q-W>600){const _t=Q-W+1,Dt=z-W+1,Wt=Math.log(_t),Ft=.5*Math.exp(2*Wt/3),re=.5*Math.sqrt(Wt*Ft*(_t-Ft)/_t)*(Dt-_t/2<0?-1:1);co(Y,L,z,Math.max(W,Math.floor(z-Dt*Ft/_t+re)),Math.min(Q,Math.floor(z+(_t-Dt)*Ft/_t+re)),ut)}const mt=L[2*z+ut];let pt=W,ht=Q;for(Vn(Y,L,W,z),L[2*Q+ut]>mt&&Vn(Y,L,W,Q);pt<ht;){for(Vn(Y,L,pt,ht),pt++,ht--;L[2*pt+ut]<mt;)pt++;for(;L[2*ht+ut]>mt;)ht--}L[2*W+ut]===mt?Vn(Y,L,W,ht):(ht++,Vn(Y,L,ht,Q)),ht<=z&&(W=ht+1),z<=ht&&(Q=ht-1)}}function Vn(Y,L,z,W){Or(Y,z,W),Or(L,2*z,2*W),Or(L,2*z+1,2*W+1)}function Or(Y,L,z){const W=Y[L];Y[L]=Y[z],Y[z]=W}function mn(Y,L,z,W){const Q=Y-z,ut=L-W;return Q*Q+ut*ut}sn.fromVectorTileJs=Ji,sn.fromGeojsonVt=function(Y,L){L=L||{};var z={};for(var W in Y)z[W]=new ao(Y[W].features,L),z[W].name=W,z[W].version=L.version,z[W].extent=L.extent;return Ji({layers:z})},sn.GeoJSONWrapper=Dr;const Ko=Y=>Y[0],ci=Y=>Y[1];class Vi{constructor(L,z=Ko,W=ci,Q=64,ut=Float64Array){this.nodeSize=Q,this.points=L;const mt=L.length<65536?Uint16Array:Uint32Array,pt=this.ids=new mt(L.length),ht=this.coords=new ut(2*L.length);for(let _t=0;_t<L.length;_t++)pt[_t]=_t,ht[2*_t]=z(L[_t]),ht[2*_t+1]=W(L[_t]);dr(pt,ht,Q,0,pt.length-1,0)}range(L,z,W,Q){return function(ut,mt,pt,ht,_t,Dt,Wt){const Ft=[0,ut.length-1,0],re=[];let ae,te;for(;Ft.length;){const oe=Ft.pop(),ve=Ft.pop(),Ge=Ft.pop();if(ve-Ge<=Wt){for(let ee=Ge;ee<=ve;ee++)ae=mt[2*ee],te=mt[2*ee+1],ae>=pt&&ae<=_t&&te>=ht&&te<=Dt&&re.push(ut[ee]);continue}const We=Math.floor((Ge+ve)/2);ae=mt[2*We],te=mt[2*We+1],ae>=pt&&ae<=_t&&te>=ht&&te<=Dt&&re.push(ut[We]);const Ue=(oe+1)%2;(0===oe?pt<=ae:ht<=te)&&(Ft.push(Ge),Ft.push(We-1),Ft.push(Ue)),(0===oe?_t>=ae:Dt>=te)&&(Ft.push(We+1),Ft.push(ve),Ft.push(Ue))}return re}(this.ids,this.coords,L,z,W,Q,this.nodeSize)}within(L,z,W){return function(Q,ut,mt,pt,ht,_t){const Dt=[0,Q.length-1,0],Wt=[],Ft=ht*ht;for(;Dt.length;){const re=Dt.pop(),ae=Dt.pop(),te=Dt.pop();if(ae-te<=_t){for(let Ue=te;Ue<=ae;Ue++)mn(ut[2*Ue],ut[2*Ue+1],mt,pt)<=Ft&&Wt.push(Q[Ue]);continue}const oe=Math.floor((te+ae)/2),ve=ut[2*oe],Ge=ut[2*oe+1];mn(ve,Ge,mt,pt)<=Ft&&Wt.push(Q[oe]);const We=(re+1)%2;(0===re?mt-ht<=ve:pt-ht<=Ge)&&(Dt.push(te),Dt.push(oe-1),Dt.push(We)),(0===re?mt+ht>=ve:pt+ht>=Ge)&&(Dt.push(oe+1),Dt.push(ae),Dt.push(We))}return Wt}(this.ids,this.coords,L,z,W,this.nodeSize)}}const $n={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},an=Math.fround||(Yn=new Float32Array(1),Y=>(Yn[0]=+Y,Yn[0]));var Yn;class pr{constructor(L){this.options=Wn(Object.create($n),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:z,minZoom:W,maxZoom:Q,nodeSize:ut}=this.options;z&&console.time("total time");const mt=`prepare ${L.length} points`;z&&console.time(mt),this.points=L;let pt=[];for(let ht=0;ht<L.length;ht++)L[ht].geometry&&pt.push(Qo(L[ht],ht));this.trees[Q+1]=new Vi(pt,mr,gn,ut,Float32Array),z&&console.timeEnd(mt);for(let ht=Q;ht>=W;ht--){const _t=+Date.now();pt=this._cluster(pt,ht),this.trees[ht]=new Vi(pt,mr,gn,ut,Float32Array),z&&console.log("z%d: %d clusters in %dms",ht,pt.length,+Date.now()-_t)}return z&&console.timeEnd("total time"),this}getClusters(L,z){let W=((L[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,L[1]));let ut=180===L[2]?180:((L[2]+180)%360+360)%360-180;const mt=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)W=-180,ut=180;else if(W>ut){const Dt=this.getClusters([W,Q,180,mt],z),Wt=this.getClusters([-180,Q,ut,mt],z);return Dt.concat(Wt)}const pt=this.trees[this._limitZoom(z)],ht=pt.range(fr(W),Fr(mt),fr(ut),Fr(Q)),_t=[];for(const Dt of ht){const Wt=pt.points[Dt];_t.push(Wt.numPoints?Gn(Wt):this.points[Wt.index])}return _t}getChildren(L){const z=this._getOriginId(L),W=this._getOriginZoom(L),Q="No cluster with the specified id.",ut=this.trees[W];if(!ut)throw new Error(Q);const mt=ut.points[z];if(!mt)throw new Error(Q);const pt=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ht=ut.within(mt.x,mt.y,pt),_t=[];for(const Dt of ht){const Wt=ut.points[Dt];Wt.parentId===L&&_t.push(Wt.numPoints?Gn(Wt):this.points[Wt.index])}if(0===_t.length)throw new Error(Q);return _t}getLeaves(L,z,W){const Q=[];return this._appendLeaves(Q,L,z=z||10,W=W||0,0),Q}getTile(L,z,W){const Q=this.trees[this._limitZoom(L)],ut=Math.pow(2,L),{extent:mt,radius:pt}=this.options,ht=pt/mt,_t=(W-ht)/ut,Dt=(W+1+ht)/ut,Wt={features:[]};return this._addTileFeatures(Q.range((z-ht)/ut,_t,(z+1+ht)/ut,Dt),Q.points,z,W,ut,Wt),0===z&&this._addTileFeatures(Q.range(1-ht/ut,_t,1,Dt),Q.points,ut,W,ut,Wt),z===ut-1&&this._addTileFeatures(Q.range(0,_t,ht/ut,Dt),Q.points,-1,W,ut,Wt),Wt.features.length?Wt:null}getClusterExpansionZoom(L){let z=this._getOriginZoom(L)-1;for(;z<=this.options.maxZoom;){const W=this.getChildren(L);if(z++,1!==W.length)break;L=W[0].properties.cluster_id}return z}_appendLeaves(L,z,W,Q,ut){const mt=this.getChildren(z);for(const pt of mt){const ht=pt.properties;if(ht&&ht.cluster?ut+ht.point_count<=Q?ut+=ht.point_count:ut=this._appendLeaves(L,ht.cluster_id,W,Q,ut):ut<Q?ut++:L.push(pt),L.length===W)break}return ut}_addTileFeatures(L,z,W,Q,ut,mt){for(const pt of L){const ht=z[pt],_t=ht.numPoints;let Dt,Wt,Ft;if(_t)Dt=zs(ht),Wt=ht.x,Ft=ht.y;else{const te=this.points[ht.index];Dt=te.properties,Wt=fr(te.geometry.coordinates[0]),Ft=Fr(te.geometry.coordinates[1])}const re={type:1,geometry:[[Math.round(this.options.extent*(Wt*ut-W)),Math.round(this.options.extent*(Ft*ut-Q))]],tags:Dt};let ae;_t?ae=ht.id:this.options.generateId?ae=ht.index:this.points[ht.index].id&&(ae=this.points[ht.index].id),void 0!==ae&&(re.id=ae),mt.features.push(re)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))}_cluster(L,z){const W=[],{radius:Q,extent:ut,reduce:mt,minPoints:pt}=this.options,ht=Q/(ut*Math.pow(2,z));for(let _t=0;_t<L.length;_t++){const Dt=L[_t];if(Dt.zoom<=z)continue;Dt.zoom=z;const Wt=this.trees[z+1],Ft=Wt.within(Dt.x,Dt.y,ht),re=Dt.numPoints||1;let ae=re;for(const te of Ft){const oe=Wt.points[te];oe.zoom>z&&(ae+=oe.numPoints||1)}if(ae>re&&ae>=pt){let te=Dt.x*re,oe=Dt.y*re,ve=mt&&re>1?this._map(Dt,!0):null;const Ge=(_t<<5)+(z+1)+this.points.length;for(const We of Ft){const Ue=Wt.points[We];if(Ue.zoom<=z)continue;Ue.zoom=z;const ee=Ue.numPoints||1;te+=Ue.x*ee,oe+=Ue.y*ee,Ue.parentId=Ge,mt&&(ve||(ve=this._map(Dt,!0)),mt(ve,this._map(Ue)))}Dt.parentId=Ge,W.push(uo(te/ae,oe/ae,Ge,ae,ve))}else if(W.push(Dt),ae>1)for(const te of Ft){const oe=Wt.points[te];oe.zoom<=z||(oe.zoom=z,W.push(oe))}}return W}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,z){if(L.numPoints)return z?Wn({},L.properties):L.properties;const W=this.points[L.index].properties,Q=this.options.map(W);return z&&Q===W?Wn({},Q):Q}}function uo(Y,L,z,W,Q){return{x:an(Y),y:an(L),zoom:1/0,id:z,parentId:-1,numPoints:W,properties:Q}}function Qo(Y,L){const[z,W]=Y.geometry.coordinates;return{x:an(fr(z)),y:an(Fr(W)),zoom:1/0,index:L,parentId:-1}}function Gn(Y){return{type:"Feature",id:Y.id,properties:zs(Y),geometry:{type:"Point",coordinates:[(L=Y.x,360*(L-.5)),Oe(Y.y)]}};var L}function zs(Y){const L=Y.numPoints,z=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return Wn(Wn({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:L,point_count_abbreviated:z})}function fr(Y){return Y/360+.5}function Fr(Y){const L=Math.sin(Y*Math.PI/180),z=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return z<0?0:z>1?1:z}function Oe(Y){const L=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Wn(Y,L){for(const z in L)Y[z]=L[z];return Y}function mr(Y){return Y.x}function gn(Y){return Y.y}function _n(Y,L,z,W){for(var Q,ut=W,mt=z-L>>1,pt=z-L,ht=Y[L],_t=Y[L+1],Dt=Y[z],Wt=Y[z+1],Ft=L+3;Ft<z;Ft+=3){var re=ho(Y[Ft],Y[Ft+1],ht,_t,Dt,Wt);if(re>ut)Q=Ft,ut=re;else if(re===ut){var ae=Math.abs(Ft-mt);ae<pt&&(Q=Ft,pt=ae)}}ut>W&&(Q-L>3&&_n(Y,L,Q,W),Y[Q+2]=ut,z-Q>3&&_n(Y,Q,z,W))}function ho(Y,L,z,W,Q,ut){var mt=Q-z,pt=ut-W;if(0!==mt||0!==pt){var ht=((Y-z)*mt+(L-W)*pt)/(mt*mt+pt*pt);ht>1?(z=Q,W=ut):ht>0&&(z+=mt*ht,W+=pt*ht)}return(mt=Y-z)*mt+(pt=L-W)*pt}function Ie(Y,L,z,W){var Q={id:void 0===Y?null:Y,type:L,geometry:z,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ut){var mt=ut.geometry,pt=ut.type;if("Point"===pt||"MultiPoint"===pt||"LineString"===pt)wi(ut,mt);else if("Polygon"===pt||"MultiLineString"===pt)for(var ht=0;ht<mt.length;ht++)wi(ut,mt[ht]);else if("MultiPolygon"===pt)for(ht=0;ht<mt.length;ht++)for(var _t=0;_t<mt[ht].length;_t++)wi(ut,mt[ht][_t])}(Q),Q}function wi(Y,L){for(var z=0;z<L.length;z+=3)Y.minX=Math.min(Y.minX,L[z]),Y.minY=Math.min(Y.minY,L[z+1]),Y.maxX=Math.max(Y.maxX,L[z]),Y.maxY=Math.max(Y.maxY,L[z+1])}function Li(Y,L,z,W){if(L.geometry){var Q=L.geometry.coordinates,ut=L.geometry.type,mt=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),pt=[],ht=L.id;if(z.promoteId?ht=L.properties[z.promoteId]:z.generateId&&(ht=W||0),"Point"===ut)Xn(Q,pt);else if("MultiPoint"===ut)for(var _t=0;_t<Q.length;_t++)Xn(Q[_t],pt);else if("LineString"===ut)ts(Q,pt,mt,!1);else if("MultiLineString"===ut){if(z.lineMetrics){for(_t=0;_t<Q.length;_t++)ts(Q[_t],pt=[],mt,!1),Y.push(Ie(ht,"LineString",pt,L.properties));return}Bs(Q,pt,mt,!1)}else if("Polygon"===ut)Bs(Q,pt,mt,!0);else{if("MultiPolygon"!==ut){if("GeometryCollection"===ut){for(_t=0;_t<L.geometry.geometries.length;_t++)Li(Y,{id:ht,geometry:L.geometry.geometries[_t],properties:L.properties},z,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_t=0;_t<Q.length;_t++){var Dt=[];Bs(Q[_t],Dt,mt,!0),pt.push(Dt)}}Y.push(Ie(ht,ut,pt,L.properties))}}function Xn(Y,L){L.push(po(Y[0])),L.push(fo(Y[1])),L.push(0)}function ts(Y,L,z,W){for(var Q,ut,mt=0,pt=0;pt<Y.length;pt++){var ht=po(Y[pt][0]),_t=fo(Y[pt][1]);L.push(ht),L.push(_t),L.push(0),pt>0&&(mt+=W?(Q*_t-ht*ut)/2:Math.sqrt(Math.pow(ht-Q,2)+Math.pow(_t-ut,2))),Q=ht,ut=_t}var Dt=L.length-3;L[2]=1,_n(L,0,Dt,z),L[Dt+2]=1,L.size=Math.abs(mt),L.start=0,L.end=L.size}function Bs(Y,L,z,W){for(var Q=0;Q<Y.length;Q++){var ut=[];ts(Y[Q],ut,z,W),L.push(ut)}}function po(Y){return Y/360+.5}function fo(Y){var L=Math.sin(Y*Math.PI/180),z=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return z<0?0:z>1?1:z}function Ki(Y,L,z,W,Q,ut,mt,pt){if(W/=L,ut>=(z/=L)&&mt<W)return Y;if(mt<z||ut>=W)return null;for(var ht=[],_t=0;_t<Y.length;_t++){var Dt=Y[_t],Wt=Dt.geometry,Ft=Dt.type,re=0===Q?Dt.minX:Dt.minY,ae=0===Q?Dt.maxX:Dt.maxY;if(re>=z&&ae<W)ht.push(Dt);else if(!(ae<z||re>=W)){var te=[];if("Point"===Ft||"MultiPoint"===Ft)yn(Wt,te,z,W,Q);else if("LineString"===Ft)mo(Wt,te,z,W,Q,!1,pt.lineMetrics);else if("MultiLineString"===Ft)vn(Wt,te,z,W,Q,!1);else if("Polygon"===Ft)vn(Wt,te,z,W,Q,!0);else if("MultiPolygon"===Ft)for(var oe=0;oe<Wt.length;oe++){var ve=[];vn(Wt[oe],ve,z,W,Q,!0),ve.length&&te.push(ve)}if(te.length){if(pt.lineMetrics&&"LineString"===Ft){for(oe=0;oe<te.length;oe++)ht.push(Ie(Dt.id,Ft,te[oe],Dt.tags));continue}"LineString"!==Ft&&"MultiLineString"!==Ft||(1===te.length?(Ft="LineString",te=te[0]):Ft="MultiLineString"),"Point"!==Ft&&"MultiPoint"!==Ft||(Ft=3===te.length?"Point":"MultiPoint"),ht.push(Ie(Dt.id,Ft,te,Dt.tags))}}}return ht.length?ht:null}function yn(Y,L,z,W,Q){for(var ut=0;ut<Y.length;ut+=3){var mt=Y[ut+Q];mt>=z&&mt<=W&&(L.push(Y[ut]),L.push(Y[ut+1]),L.push(Y[ut+2]))}}function mo(Y,L,z,W,Q,ut,mt){for(var pt,ht,_t=es(Y),Dt=0===Q?Jl:Oa,Wt=Y.start,Ft=0;Ft<Y.length-3;Ft+=3){var re=Y[Ft],ae=Y[Ft+1],te=Y[Ft+2],oe=Y[Ft+3],ve=Y[Ft+4],Ge=0===Q?re:ae,We=0===Q?oe:ve,Ue=!1;mt&&(pt=Math.sqrt(Math.pow(re-oe,2)+Math.pow(ae-ve,2))),Ge<z?We>z&&(ht=Dt(_t,re,ae,oe,ve,z),mt&&(_t.start=Wt+pt*ht)):Ge>W?We<W&&(ht=Dt(_t,re,ae,oe,ve,W),mt&&(_t.start=Wt+pt*ht)):Pr(_t,re,ae,te),We<z&&Ge>=z&&(ht=Dt(_t,re,ae,oe,ve,z),Ue=!0),We>W&&Ge<=W&&(ht=Dt(_t,re,ae,oe,ve,W),Ue=!0),!ut&&Ue&&(mt&&(_t.end=Wt+pt*ht),L.push(_t),_t=es(Y)),mt&&(Wt+=pt)}var ee=Y.length-3;re=Y[ee],ae=Y[ee+1],te=Y[ee+2],(Ge=0===Q?re:ae)>=z&&Ge<=W&&Pr(_t,re,ae,te),ee=_t.length-3,ut&&ee>=3&&(_t[ee]!==_t[0]||_t[ee+1]!==_t[1])&&Pr(_t,_t[0],_t[1],_t[2]),_t.length&&L.push(_t)}function es(Y){var L=[];return L.size=Y.size,L.start=Y.start,L.end=Y.end,L}function vn(Y,L,z,W,Q,ut){for(var mt=0;mt<Y.length;mt++)mo(Y[mt],L,z,W,Q,ut,!1)}function Pr(Y,L,z,W){Y.push(L),Y.push(z),Y.push(W)}function Jl(Y,L,z,W,Q,ut){var mt=(ut-L)/(W-L);return Y.push(ut),Y.push(z+(Q-z)*mt),Y.push(1),mt}function Oa(Y,L,z,W,Q,ut){var mt=(ut-z)/(Q-z);return Y.push(L+(W-L)*mt),Y.push(ut),Y.push(1),mt}function Fa(Y,L){for(var z=[],W=0;W<Y.length;W++){var Q,ut=Y[W],mt=ut.type;if("Point"===mt||"MultiPoint"===mt||"LineString"===mt)Q=Pa(ut.geometry,L);else if("MultiLineString"===mt||"Polygon"===mt){Q=[];for(var pt=0;pt<ut.geometry.length;pt++)Q.push(Pa(ut.geometry[pt],L))}else if("MultiPolygon"===mt)for(Q=[],pt=0;pt<ut.geometry.length;pt++){for(var ht=[],_t=0;_t<ut.geometry[pt].length;_t++)ht.push(Pa(ut.geometry[pt][_t],L));Q.push(ht)}z.push(Ie(ut.id,mt,Q,ut.tags))}return z}function Pa(Y,L){var z=[];z.size=Y.size,void 0!==Y.start&&(z.start=Y.start,z.end=Y.end);for(var W=0;W<Y.length;W+=3)z.push(Y[W]+L,Y[W+1],Y[W+2]);return z}function La(Y,L){if(Y.transformed)return Y;var z,W,Q,ut=1<<Y.z,mt=Y.x,pt=Y.y;for(z=0;z<Y.features.length;z++){var ht=Y.features[z],_t=ht.geometry,Dt=ht.type;if(ht.geometry=[],1===Dt)for(W=0;W<_t.length;W+=2)ht.geometry.push(Kl(_t[W],_t[W+1],L,ut,mt,pt));else for(W=0;W<_t.length;W++){var Wt=[];for(Q=0;Q<_t[W].length;Q+=2)Wt.push(Kl(_t[W][Q],_t[W][Q+1],L,ut,mt,pt));ht.geometry.push(Wt)}}return Y.transformed=!0,Y}function Kl(Y,L,z,W,Q,ut){return[Math.round(z*(Y*W-Q)),Math.round(z*(L*W-ut))]}function Ra(Y,L,z,W,Q){for(var ut=L===Q.maxZoom?0:Q.tolerance/((1<<L)*Q.extent),mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:W,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pt=0;pt<Y.length;pt++){mt.numFeatures++,za(mt,Y[pt],ut,Q);var ht=Y[pt].minX,_t=Y[pt].minY,Dt=Y[pt].maxX,Wt=Y[pt].maxY;ht<mt.minX&&(mt.minX=ht),_t<mt.minY&&(mt.minY=_t),Dt>mt.maxX&&(mt.maxX=Dt),Wt>mt.maxY&&(mt.maxY=Wt)}return mt}function za(Y,L,z,W){var Q=L.geometry,ut=L.type,mt=[];if("Point"===ut||"MultiPoint"===ut)for(var pt=0;pt<Q.length;pt+=3)mt.push(Q[pt]),mt.push(Q[pt+1]),Y.numPoints++,Y.numSimplified++;else if("LineString"===ut)Lr(mt,Q,Y,z,!1,!1);else if("MultiLineString"===ut||"Polygon"===ut)for(pt=0;pt<Q.length;pt++)Lr(mt,Q[pt],Y,z,"Polygon"===ut,0===pt);else if("MultiPolygon"===ut)for(var ht=0;ht<Q.length;ht++){var _t=Q[ht];for(pt=0;pt<_t.length;pt++)Lr(mt,_t[pt],Y,z,!0,0===pt)}if(mt.length){var Dt=L.tags||null;if("LineString"===ut&&W.lineMetrics){for(var Wt in Dt={},L.tags)Dt[Wt]=L.tags[Wt];Dt.mapbox_clip_start=Q.start/Q.size,Dt.mapbox_clip_end=Q.end/Q.size}var Ft={geometry:mt,type:"Polygon"===ut||"MultiPolygon"===ut?3:"LineString"===ut||"MultiLineString"===ut?2:1,tags:Dt};null!==L.id&&(Ft.id=L.id),Y.features.push(Ft)}}function Lr(Y,L,z,W,Q,ut){var mt=W*W;if(W>0&&L.size<(Q?mt:W))z.numPoints+=L.length/3;else{for(var pt=[],ht=0;ht<L.length;ht+=3)(0===W||L[ht+2]>mt)&&(z.numSimplified++,pt.push(L[ht]),pt.push(L[ht+1])),z.numPoints++;Q&&function(_t,Dt){for(var Wt=0,Ft=0,re=_t.length,ae=re-2;Ft<re;ae=Ft,Ft+=2)Wt+=(_t[Ft]-_t[ae])*(_t[Ft+1]+_t[ae+1]);if(Wt>0===Dt)for(Ft=0,re=_t.length;Ft<re/2;Ft+=2){var te=_t[Ft],oe=_t[Ft+1];_t[Ft]=_t[re-2-Ft],_t[Ft+1]=_t[re-1-Ft],_t[re-2-Ft]=te,_t[re-1-Ft]=oe}}(pt,ut),Y.push(pt)}}function gr(Y,L){var z=(L=this.options=function(Q,ut){for(var mt in ut)Q[mt]=ut[mt];return Q}(Object.create(this.options),L)).debug;if(z&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var Q,ut,mt,pt,ht,_t,W=function(Q,ut){var mt=[];if("FeatureCollection"===Q.type)for(var pt=0;pt<Q.features.length;pt++)Li(mt,Q.features[pt],ut,pt);else Li(mt,"Feature"===Q.type?Q:{geometry:Q},ut);return mt}(Y,L);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Q=W,ut=L,mt=ut.buffer/ut.extent,pt=Q,ht=Ki(Q,1,-1-mt,mt,0,-1,2,ut),_t=Ki(Q,1,1-mt,2+mt,0,-1,2,ut),(ht||_t)&&(pt=Ki(Q,1,-mt,1+mt,0,-1,2,ut)||[],ht&&(pt=Fa(ht,1).concat(pt)),_t&&(pt=pt.concat(Fa(_t,-1)))),W=pt).length&&this.splitTile(W,0,0,0),z&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function is(Y,L,z){return 32*((1<<Y)*z+L)+Y}function ns(Y,L){const z=Y.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const W=this._geoJSONIndex.getTile(z.z,z.x,z.y);if(!W)return L(null,null);const Q=new Ia(W.features);let ut=sn(Q);0===ut.byteOffset&&ut.byteLength===ut.buffer.byteLength||(ut=new Uint8Array(ut)),L(null,{vectorTile:Q,rawData:ut.buffer})}gr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gr.prototype.splitTile=function(Y,L,z,W,Q,ut,mt){for(var pt=[Y,L,z,W],ht=this.options,_t=ht.debug;pt.length;){W=pt.pop(),z=pt.pop(),L=pt.pop(),Y=pt.pop();var Dt=1<<L,Wt=is(L,z,W),Ft=this.tiles[Wt];if(!Ft&&(_t>1&&console.time("creation"),Ft=this.tiles[Wt]=Ra(Y,L,z,W,ht),this.tileCoords.push({z:L,x:z,y:W}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,z,W,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));var re="z"+L;this.stats[re]=(this.stats[re]||0)+1,this.total++}if(Ft.source=Y,Q){if(L===ht.maxZoom||L===Q)continue;var ae=1<<Q-L;if(z!==Math.floor(ut/ae)||W!==Math.floor(mt/ae))continue}else if(L===ht.indexMaxZoom||Ft.numPoints<=ht.indexMaxPoints)continue;if(Ft.source=null,0!==Y.length){_t>1&&console.time("clipping");var te,oe,ve,Ge,We,Ue,ee=.5*ht.buffer/ht.extent,Ct=.5-ee,xn=.5+ee,gi=1+ee;te=oe=ve=Ge=null,We=Ki(Y,Dt,z-ee,z+xn,0,Ft.minX,Ft.maxX,ht),Ue=Ki(Y,Dt,z+Ct,z+gi,0,Ft.minX,Ft.maxX,ht),Y=null,We&&(te=Ki(We,Dt,W-ee,W+xn,1,Ft.minY,Ft.maxY,ht),oe=Ki(We,Dt,W+Ct,W+gi,1,Ft.minY,Ft.maxY,ht),We=null),Ue&&(ve=Ki(Ue,Dt,W-ee,W+xn,1,Ft.minY,Ft.maxY,ht),Ge=Ki(Ue,Dt,W+Ct,W+gi,1,Ft.minY,Ft.maxY,ht),Ue=null),_t>1&&console.timeEnd("clipping"),pt.push(te||[],L+1,2*z,2*W),pt.push(oe||[],L+1,2*z,2*W+1),pt.push(ve||[],L+1,2*z+1,2*W),pt.push(Ge||[],L+1,2*z+1,2*W+1)}}},gr.prototype.getTile=function(Y,L,z){var W=this.options,Q=W.extent,ut=W.debug;if(Y<0||Y>24)return null;var mt=1<<Y,pt=is(Y,L=(L%mt+mt)%mt,z);if(this.tiles[pt])return La(this.tiles[pt],Q);ut>1&&console.log("drilling down to z%d-%d-%d",Y,L,z);for(var ht,_t=Y,Dt=L,Wt=z;!ht&&_t>0;)_t--,Dt=Math.floor(Dt/2),Wt=Math.floor(Wt/2),ht=this.tiles[is(_t,Dt,Wt)];return ht&&ht.source?(ut>1&&console.log("found parent tile z%d-%d-%d",_t,Dt,Wt),ut>1&&console.time("drilling down"),this.splitTile(ht.source,_t,Dt,Wt,Y,L,z),ut>1&&console.timeEnd("drilling down"),this.tiles[pt]?La(this.tiles[pt],Q):null):null};class Ri extends d.VectorTileWorkerSource{constructor(L,z,W,Q,ut){super(L,z,W,Q,ns),ut&&(this.loadGeoJSON=ut)}loadData(L,z){const W=L&&L.request,Q=W&&W.collectResourceTiming;this.loadGeoJSON(L,(ut,mt)=>{if(ut||!mt)return z(ut);if("object"!=typeof mt)return z(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{Ae(mt,!0);try{if(L.filter){const ht=d.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ht.result)throw new Error(ht.value.map(Dt=>`${Dt.key}: ${Dt.message}`).join(", "));const _t=mt.features.filter(Dt=>ht.value.evaluate({zoom:0},Dt));mt={type:"FeatureCollection",features:_t}}this._geoJSONIndex=L.cluster?new pr(function({superclusterOptions:ht,clusterProperties:_t}){if(!_t||!ht)return ht;const Dt={},Wt={},Ft={accumulated:null,zoom:0},re={properties:null},ae=Object.keys(_t);for(const te of ae){const[oe,ve]=_t[te],Ge=d.createExpression(ve),We=d.createExpression("string"==typeof oe?[oe,["accumulated"],["get",te]]:oe);Dt[te]=Ge.value,Wt[te]=We.value}return ht.map=te=>{re.properties=te;const oe={};for(const ve of ae)oe[ve]=Dt[ve].evaluate(Ft,re);return oe},ht.reduce=(te,oe)=>{re.properties=oe;for(const ve of ae)Ft.accumulated=te[ve],te[ve]=Wt[ve].evaluate(Ft,re)},ht}(L)).load(mt.features):new gr(ht=mt,L.geojsonVtOptions)}catch(ht){return z(ht)}this.loaded={};const pt={};if(Q){const ht=d.getPerformanceMeasurement(W);ht&&(pt.resourceTiming={},pt.resourceTiming[L.source]=JSON.parse(JSON.stringify(ht)))}z(null,pt)}var ht})}reloadTile(L,z){const W=this.loaded;return W&&W[L.uid]?super.reloadTile(L,z):this.loadTile(L,z)}loadGeoJSON(L,z){if(L.request)d.getJSON(L.request,z);else{if("string"!=typeof L.data)return z(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return z(null,JSON.parse(L.data))}catch{return z(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(W){z(W)}}getClusterChildren(L,z){try{z(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(W){z(W)}}getClusterLeaves(L,z){try{z(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(W){z(W)}}}class Rr{constructor(L){this.self=L,this.actor=new d.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:Ri},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(z,W)=>{if(this.workerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.workerSourceTypes[z]=W},this.self.registerRTLTextPlugin=z=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=z.applyArabicShaping,d.plugin.processBidirectionalText=z.processBidirectionalText,d.plugin.processStyledBidirectionalText=z.processStyledBidirectionalText}}clearCaches(L,z,W){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],W()}checkIfReady(L,z,W){W()}setReferrer(L,z){this.referrer=z}spriteLoaded(L,z){this.isSpriteLoaded[L]=z;for(const W in this.workerSources[L]){const Q=this.workerSources[L][W];for(const ut in Q)Q[ut]instanceof d.VectorTileWorkerSource&&(Q[ut].isSpriteLoaded=z,Q[ut].fire(new d.Event("isSpriteLoaded")))}}setImages(L,z,W){this.availableImages[L]=z;for(const Q in this.workerSources[L]){const ut=this.workerSources[L][Q];for(const mt in ut)ut[mt].availableImages=z}W()}enableTerrain(L,z,W){this.terrain=z,W()}setProjection(L,z){this.projections[L]=d.getProjection(z)}setLayers(L,z,W){this.getLayerIndex(L).replace(z),W()}updateLayers(L,z,W){this.getLayerIndex(L).update(z.layers,z.removedIds),W()}loadTile(L,z,W){const Q=this.enableTerrain?d.extend({enableTerrain:this.terrain},z):z;Q.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,z.type,z.source).loadTile(Q,W)}loadDEMTile(L,z,W){const Q=this.enableTerrain?d.extend({buildQuadTree:this.terrain},z):z;this.getDEMWorkerSource(L,z.source).loadTile(Q,W)}reloadTile(L,z,W){const Q=this.enableTerrain?d.extend({enableTerrain:this.terrain},z):z;Q.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,z.type,z.source).reloadTile(Q,W)}abortTile(L,z,W){this.getWorkerSource(L,z.type,z.source).abortTile(z,W)}removeTile(L,z,W){this.getWorkerSource(L,z.type,z.source).removeTile(z,W)}removeSource(L,z,W){if(!this.workerSources[L]||!this.workerSources[L][z.type]||!this.workerSources[L][z.type][z.source])return;const Q=this.workerSources[L][z.type][z.source];delete this.workerSources[L][z.type][z.source],void 0!==Q.removeSource?Q.removeSource(z,W):W()}loadWorkerSource(L,z,W){try{this.self.importScripts(z.url),W()}catch(Q){W(Q.toString())}}syncRTLPluginState(L,z,W){try{d.plugin.setState(z);const Q=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=Q){this.self.importScripts(Q);const ut=d.plugin.isParsed();W(ut?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),ut)}}catch(Q){W(Q.toString())}}getAvailableImages(L){let z=this.availableImages[L];return z||(z=[]),z}getLayerIndex(L){let z=this.layerIndexes[L];return z||(z=this.layerIndexes[L]=new li),z}getWorkerSource(L,z,W){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][z]||(this.workerSources[L][z]={}),this.workerSources[L][z][W]||(this.workerSources[L][z][W]=new this.workerSourceTypes[z]({send:(Q,ut,mt,pt,ht,_t)=>{this.actor.send(Q,ut,mt,L,ht,_t)},scheduler:this.actor.scheduler},this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])),this.workerSources[L][z][W]}getDEMWorkerSource(L,z){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][z]||(this.demWorkerSources[L][z]=new jt),this.demWorkerSources[L][z]}enforceCacheSizeLimit(L,z){d.enforceCacheSizeLimit(z)}getWorkerPerformanceMetrics(L,z,W){W(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Rr(self)),Rr}),ur(0,function(d){function Bt(p,r){if(Array.isArray(p)){if(!Array.isArray(r)||p.length!==r.length)return!1;for(let u=0;u<p.length;u++)if(!Bt(p[u],r[u]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==r){if("object"!=typeof r||Object.keys(p).length!==Object.keys(r).length)return!1;for(const u in p)if(!Bt(p[u],r[u]))return!1;return!0}return p===r}var hr=li;function li(p){return r=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,v,x=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(x);try{v=new Worker(M),m=!0}catch{m=!1}return v&&v.terminate(),URL.revokeObjectURL(M),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var v=m.getContext("2d");if(!v)return!1;var x=v.getImageData(0,0,1,1);return x&&x.width===m.width}()||(void 0===jt[u=r&&r.failIfMajorPerformanceCaveat]&&(jt[u]=function(m){var v,M,A,T,x=(M=m,A=document.createElement("canvas"),(T=Object.create(li.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,A.getContext("webgl",T)||A.getContext("experimental-webgl",T));if(!x)return!1;try{v=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!v||x.isContextLost())&&(x.shaderSource(v,"void main() {}"),x.compileShader(v),!0===x.getShaderParameter(v,x.COMPILE_STATUS))}(u)),!jt[u]||document.documentMode));var r,u}var jt={};function Ae(p,r,u){const m=d.window.document.createElement(p);return void 0!==r&&(m.className=r),u&&u.appendChild(m),m}function Xi(p,r,u){const m=d.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(r))m.setAttributeNS(null,v,r[v]);return u&&u.appendChild(m),m}li.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Bn=d.window.document&&d.window.document.documentElement.style,_e=Bn&&void 0!==Bn.userSelect?"userSelect":"WebkitUserSelect";let si;function Ia(){Bn&&_e&&(si=Bn[_e],Bn[_e]="none")}function Wo(){Bn&&_e&&(Bn[_e]=si)}function ao(p){p.preventDefault(),p.stopPropagation(),d.window.removeEventListener("click",ao,!0)}function Xo(){d.window.addEventListener("click",ao,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",ao,!0)},0)}function ye(p,r){const u=p.getBoundingClientRect();return Ji(p,u,r)}function sn(p,r){const u=p.getBoundingClientRect(),m=[];for(let v=0;v<r.length;v++)m.push(Ji(p,u,r[v]));return m}function Dr(p){return void 0!==d.window.InstallTrigger&&2===p.button&&p.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Ji(p,r,u){const m=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new d.pointGeometry((u.clientX-r.left)*m,(u.clientY-r.top)*m)}function lo(p,r){var u=r[0],m=r[1],v=r[2],x=r[3],M=u*x-v*m;return M?(p[0]=x*(M=1/M),p[1]=-m*M,p[2]=-v*M,p[3]=u*M,p):null}function Ve(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class Hn extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,m);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,u){this._validate(r,u)&&(this.images[r]=u)}_validate(r,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,u){if(!r)return!0;let m=0;for(const v of r){if(v[0]<m||v[1]<v[0]||u<v[1])return!1;m=v[1]}return!0}_validateContent(r,u){return!(r&&(4!==r.length||r[0]<0||u.data.width<r[0]||r[1]<0||u.data.height<r[1]||r[2]<0||u.data.width<r[2]||r[3]<0||u.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,u){u.version=this.images[r].version+1,this.images[r]=u,this.updatedImages[r]=!0}removeImage(r){const u=this.images[r];delete this.images[r],delete this.patterns[r],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,u){let m=!0;if(!this.isLoaded())for(const v of r)this.images[v]||(m=!1);this.isLoaded()||m?this._notify(r,u):this.requestors.push({ids:r,callback:u})}_notify(r,u){const m={};for(const v of r){this.images[v]||this.fire(new d.Event("styleimagemissing",{id:v}));const x=this.images[v];x?m[v]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:d.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,m)}getPixelSize(){const{width:r,height:u}=this.atlasImage;return{width:r,height:u}}getPattern(r){const u=this.patterns[r],m=this.getImage(r);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new d.ImagePosition(v,m);this.patterns[r]={bin:v,position:x}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const u=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(r,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const x in this.patterns)r.push(this.patterns[x].bin);const{w:u,h:m}=d.potpack(r),v=this.atlasImage;v.resize({width:u||1,height:m||1});for(const x in this.patterns){const{bin:M}=this.patterns[x],A=M.x+1,T=M.y+1,D=this.images[x].data,O=D.width,R=D.height;d.RGBAImage.copy(D,v,{x:0,y:0},{x:A,y:T},{width:O,height:R}),d.RGBAImage.copy(D,v,{x:0,y:R-1},{x:A,y:T-1},{width:O,height:1}),d.RGBAImage.copy(D,v,{x:0,y:0},{x:A,y:T+R},{width:O,height:1}),d.RGBAImage.copy(D,v,{x:O-1,y:0},{x:A-1,y:T},{width:1,height:R}),d.RGBAImage.copy(D,v,{x:0,y:0},{x:A+O,y:T},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const u of r){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const m=this.images[u];Ve(m)&&this.updateImage(u,m)}}}const Jo=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(p,r){return function([u,m,v]){const x=d.degToRad(m+90),M=d.degToRad(v);return{x:u*Math.cos(x)*Math.sin(M),y:u*Math.sin(x)*Math.sin(M),z:u*Math.cos(M),azimuthal:m,polar:v}}(p.expression.evaluate(r))}interpolate(p,r,u){return{x:d.number(p.x,r.x,u),y:d.number(p.y,r.y,u),z:d.number(p.z,r.z,u),azimuthal:d.number(p.azimuthal,r.azimuthal,u),polar:d.number(p.polar,r.polar,u)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),Ir="-transition";class Ls extends d.Evented{constructor(r){super(),this._transitionable=new d.Transitionable(Jo),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,u={}){if(!this._validate(d.validateLight,r,u))for(const m in r){const v=r[m];d.endsWith(m,Ir)?this._transitionable.setTransition(m.slice(0,-Ir.length),v):this._transitionable.setValue(m,v)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,r.call(d.validateStyle,d.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const Rs=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),dr="-transition";class co extends d.Evented{constructor(r,u){super(),this._transitionable=new d.Transitionable(Rs),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(r){for(const u in r){const m=r[u];d.endsWith(u,dr)?this._transitionable.setTransition(u.slice(0,-dr.length),m):this._transitionable.setValue(u,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Vn(p,r,u,m){const v=d.smoothstep(45,65,u),[x,M]=Or(p,m),A=d.length(r);let T=1-Math.min(1,Math.exp((A-x)/(M-x)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*v*p.alpha}function Or(p,r){const u=.5/Math.tan(.5*r);return[p.range[0]+u,p.range[1]+u]}const mn=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"high-color":new d.DataConstantProperty(d.spec.fog["high-color"]),"space-color":new d.DataConstantProperty(d.spec.fog["space-color"]),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"]),"star-intensity":new d.DataConstantProperty(d.spec.fog["star-intensity"])}),Ko="-transition";class ci extends d.Evented{constructor(r,u){super(),this._transitionable=new d.Transitionable(mn),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const r=this._transform,u="globe"===r.projection.name,m=d.globeToMercatorTransition(r.zoom),v=this.properties.get("range"),x=[.5,3];return{range:u?[d.number(x[0],v[0],m),d.number(x[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,u={}){if(!this._validate(d.validateFog,r,u)){for(const m of Object.keys(d.spec.fog))r&&void 0===r[m]&&(r[m]=d.spec.fog[m].default);for(const m in r){const v=r[m];d.endsWith(m,Ko)?this._transitionable.setTransition(m.slice(0,-Ko.length),v):this._transitionable.setValue(m,v)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.smoothstep(45,65,r))*u.a}getOpacityAtLatLng(r,u){return this._transform.projection.supportsFog?function(m,v,x){const M=d.MercatorCoordinate.fromLngLat(v),A=x.elevation?x.elevation.getAtPointOrZero(M):0,T=[M.x,M.y,A];return d.transformMat4(T,T,x.mercatorFogMatrix),Vn(m,T,x.pitch,x._fov)}(this.state,r,u):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Or(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,u,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,r.call(d.validateStyle,d.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class Vi{constructor(r,u){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const m=this.workerPool.acquire(this.id);for(let v=0;v<m.length;v++){const x=new Vi.Actor(m[v],u,this.id);x.name=`Worker ${v}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,u,m){d.asyncAll(this.actors,(v,x)=>{v.send(r,u,x)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function $n(p,r,u){return r*(d.EXTENT/(p.tileSize*Math.pow(2,u-p.tileID.overscaledZ)))}Vi.Actor=d.Actor;class an{constructor(r,u,m,v){this.screenBounds=r,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(r,u){let m,v;if(r instanceof d.pointGeometry||"number"==typeof r[0]){const x=d.pointGeometry.convert(r);m=[d.pointGeometry.convert(r)],v=u.isPointAboveHorizon(x)}else{const x=d.pointGeometry.convert(r[0]),M=d.pointGeometry.convert(r[1]);m=[x,M],v=d.polygonizeBounds(x,M).every(A=>u.isPointAboveHorizon(A))}return new an(m,u.getCameraPoint(),v,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const u=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],v=d.polygonizeBounds(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),d.bufferConvexPolygon(v,r)}bufferedCameraGeometryGlobe(r){const u=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],v=d.polygonizeBounds(u,m,r),x=this.cameraPoint.clone();switch(3*((x.y>u.y)+(x.y>m.y))+((x.x>u.x)+(x.x>m.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(r,u,m,v=0){const x=r.queryPadding/u._pixelsPerMercatorPixel+1,M=m?this._bufferedCameraMercator(x,u):this._bufferedScreenMercator(x,u);let A=r.tileID.wrap+(M.unwrapped?v:0);const T=M.polygon.map(Z=>d.getTilePoint(r.tileTransform,Z,A));if(!d.polygonIntersectsBox(T,0,0,d.EXTENT,d.EXTENT))return;A=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const D=this.screenGeometryMercator.polygon.map(Z=>d.getTileVec3(r.tileTransform,Z,A)),O=D.map(Z=>new d.pointGeometry(Z[0],Z[1])),R=u.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),V=d.getTileVec3(r.tileTransform,R,A),H=D.map(Z=>{const U=d.sub(Z,Z,V);return d.normalize(U,U),new d.Ray(V,U)}),j=$n(r,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:H,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(q=d.getBounds(T),q.min.x=d.clamp(q.min.x,0,d.EXTENT),q.min.y=d.clamp(q.min.y,0,d.EXTENT),q.max.x=d.clamp(q.max.x,0,d.EXTENT),q.max.y=d.clamp(q.max.y,0,d.EXTENT),q),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:j};var q}_bufferedScreenMercator(r,u){const m=uo(r);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),u):{polygon:this.bufferedScreenGeometry(r).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(r,u){const m=uo(r);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),u):{polygon:this.bufferedCameraGeometry(r).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(r,u){const m=function(x,M){const A=d.multiply([],M.pixelMatrix,M.globeMatrix),T=[0,-d.GLOBE_RADIUS,0,1],D=[0,d.GLOBE_RADIUS,0,1],O=[0,0,0,1];d.transformMat4$1(T,T,A),d.transformMat4$1(D,D,A),d.transformMat4$1(O,O,A);const R=new d.pointGeometry(T[0]/T[3],T[1]/T[3]),V=new d.pointGeometry(D[0]/D[3],D[1]/D[3]),H=d.polygonContainsPoint(x,R)&&T[3]<O[3],j=d.polygonContainsPoint(x,V)&&D[3]<O[3];if(!H&&!j)return null;const q=function(at,rt,dt){for(let yt=1;yt<at.length;yt++){const Lt=pr(rt.pointCoordinate3D(at[yt-1]).x),gt=pr(rt.pointCoordinate3D(at[yt]).x);if(dt<0){if(Lt<gt)return{idx:yt,t:-Lt/(gt-1-Lt)}}else if(gt<Lt)return{idx:yt,t:(1-Lt)/(gt+1-Lt)}}return null}(x,M,H?-1:1);if(!q)return null;const{idx:Z,t:U}=q;let J=Z>1?Yn(x.slice(0,Z),M):[],$=Z<x.length?Yn(x.slice(Z),M):[];J=J.map(at=>new d.pointGeometry(pr(at.x),at.y)),$=$.map(at=>new d.pointGeometry(pr(at.x),at.y));const lt=[...J];0===lt.length&&lt.push($[$.length-1]);const st=d.number(lt[lt.length-1].y,(0===$.length?J[0]:$[0]).y,U);let et;return et=H?[new d.pointGeometry(0,st),new d.pointGeometry(0,0),new d.pointGeometry(1,0),new d.pointGeometry(1,st)]:[new d.pointGeometry(1,st),new d.pointGeometry(1,1),new d.pointGeometry(0,1),new d.pointGeometry(0,st)],lt.push(...et),0===$.length?lt.push(J[0]):lt.push(...$),{polygon:lt.map(at=>new d.MercatorCoordinate(at.x,at.y)),unwrapped:!1}}(r,u);if(m)return m;const v=function(x,M){let A=!1,T=-1/0,D=0;for(let R=0;R<x.length-1;R++)x[R].x>T&&(T=x[R].x,D=R);for(let R=0;R<x.length-1;R++){const V=(D+R)%(x.length-1),H=x[V],j=x[V+1];Math.abs(H.x-j.x)>.5&&(H.x<j.x?(H.x+=1,0===V&&(x[x.length-1].x+=1)):(j.x+=1,V+1===x.length-1&&(x[0].x+=1)),A=!0)}const O=d.mercatorXfromLng(M.center.lng);return A&&O<Math.abs(O-1)&&x.forEach(R=>{R.x-=1}),{polygon:x,unwrapped:A}}(Yn(r,u).map(x=>new d.pointGeometry(pr(x.x),x.y)),u);return{polygon:v.polygon.map(x=>new d.MercatorCoordinate(x.x,x.y)),unwrapped:v.unwrapped}}}function Yn(p,r){return d.resample(p,u=>{const m=r.pointCoordinate3D(u);u.x=m.x,u.y=m.y},1/256)}function pr(p){return p<0?1+p%1:p%1}function uo(p){return 100*p|0}function Qo(p,r,u,m,v){const x=function(M,A){if(M)return v(M);if(A){const T=d.pick(d.extend(A,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(T.vectorLayers=A.vector_layers,T.vectorLayerIds=T.vectorLayers.map(D=>D.id)),A.language_options&&(T.languageOptions=A.language_options),A.language&&A.language[A.id]&&(T.language=A.language[A.id]),A.worldview_options&&(T.worldviewOptions=A.worldview_options),A.worldview?T.worldview=A.worldview[A.id]:A.worldview_default&&(T.worldview=A.worldview_default),T.tiles=r.canonicalizeTileset(T,p.url),v(null,T)}};return p.url?d.getJSON(r.transformRequest(r.normalizeSourceURL(p.url,null,u,m),d.ResourceType.Source),x):d.exported.frame(()=>x(null,p))}class Gn{constructor(r,u,m){this.bounds=d.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const u=Math.pow(2,r.z),m=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*u),x=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*u),M=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*u);return r.x>=m&&r.x<x&&r.y>=v&&r.y<M}}class zs{constructor(r,u,m){this.context=r;const v=r.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fr{constructor(r,u,m,v){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),r.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,u){for(let m=0;m<this.attributes.length;m++){const v=u.attributes[this.attributes[m].name];void 0!==v&&r.enableVertexAttribArray(v)}}setVertexAttribPointers(r,u,m){for(let v=0;v<this.attributes.length;v++){const x=this.attributes[v],M=u.attributes[x.name];void 0!==M&&r.vertexAttribPointer(M,x.components,r[fr[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Oe{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wn extends Oe{getDefault(){return d.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class mr extends Oe{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class gn extends Oe{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class _n extends Oe{getDefault(){return[!0,!0,!0,!0]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ho extends Oe{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Ie extends Oe{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class wi extends Oe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const u=this.current;(r.func!==u.func||r.ref!==u.ref||r.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Li extends Oe{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Xn extends Oe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=r,this.dirty=!1}}class ts extends Oe{getDefault(){return[0,1]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Bs extends Oe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=r,this.dirty=!1}}class po extends Oe{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class fo extends Oe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.BLEND):u.disable(u.BLEND),this.current=r,this.dirty=!1}}class Ki extends Oe{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class yn extends Oe{getDefault(){return d.Color.transparent}set(r){const u=this.current;(r.r!==u.r||r.g!==u.g||r.b!==u.b||r.a!==u.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class mo extends Oe{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class es extends Oe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;r?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=r,this.dirty=!1}}class vn extends Oe{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Pr extends Oe{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Jl extends Oe{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Oa extends Oe{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Fa extends Oe{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const u=this.current;(r[0]!==u[0]||r[1]!==u[1]||r[2]!==u[2]||r[3]!==u[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Pa extends Oe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class La extends Oe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Kl extends Oe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Ra extends Oe{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class za extends Oe{getDefault(){return null}set(r){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Lr extends Oe{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class gr extends Oe{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class is extends Oe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class ns extends Oe{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ri extends Oe{constructor(r,u){super(r),this.context=r,this.parent=u}getDefault(){return null}}class Rr extends Ri{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Y extends Ri{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class L extends Y{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class z{constructor(r,u,m,v){this.context=r,this.width=u,this.height=m;const x=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Rr(r,x),v&&(this.depthAttachment=new Y(r,x))}destroy(){const r=this.context.gl,u=this.colorAttachment.get();if(u&&r.deleteTexture(u),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class W{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Wn(this),this.clearDepth=new mr(this),this.clearStencil=new gn(this),this.colorMask=new _n(this),this.depthMask=new ho(this),this.stencilMask=new Ie(this),this.stencilFunc=new wi(this),this.stencilOp=new Li(this),this.stencilTest=new Xn(this),this.depthRange=new ts(this),this.depthTest=new Bs(this),this.depthFunc=new po(this),this.blend=new fo(this),this.blendFunc=new Ki(this),this.blendColor=new yn(this),this.blendEquation=new mo(this),this.cullFace=new es(this),this.cullFaceSide=new vn(this),this.frontFace=new Pr(this),this.program=new Jl(this),this.activeTexture=new Oa(this),this.viewport=new Fa(this),this.bindFramebuffer=new Pa(this),this.bindRenderbuffer=new La(this),this.bindTexture=new Kl(this),this.bindVertexBuffer=new Ra(this),this.bindElementBuffer=new za(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Lr(this),this.pixelStoreUnpack=new gr(this),this.pixelStoreUnpackPremultiplyAlpha=new is(this),this.pixelStoreUnpackFlipY=new ns(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,u){return new zs(this,r,u)}createVertexBuffer(r,u,m){return new Fr(this,r,u,m)}createRenderbuffer(r,u,m){const v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,r,u,m),this.bindRenderbuffer.set(null),x}createFramebuffer(r,u,m){return new z(this,r,u,m)}clear({color:r,depth:u,stencil:m}){const v=this.gl;let x=0;r&&(x|=v.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(x|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==m&&(x|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(x)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Bt(r.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Q extends d.Evented{constructor(r,u,m,v){super(),this.id=r,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},u),d.extend(this,d.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qo(this._options,this.map._requestManager,null,null,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new d.ErrorEvent(r)):u&&(d.extend(this,u),u.bounds&&(this.tileBounds=new Gn(u.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(u.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,u){const m=d.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);r.request=d.getImage(this.map._requestManager.transformRequest(v,d.ResourceType.Tile),(x,M,A,T)=>(delete r.request,r.aborted?(r.state="unloaded",u(null)):x?(r.state="errored",u(x)):M?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:A,expires:T}),r.setTexture(M,this.map.painter),r.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(r,u,m){r.setTexture(u,m)}static unloadTileData(r,u){r.texture&&u.saveTileTexture(r.texture)}abortTile(r,u){r.request&&(r.request.cancel(),delete r.request),u()}unloadTile(r,u){r.texture&&this.map.painter.saveTileTexture(r.texture),u()}hasTransition(){return!1}}let ut;function mt(p,r,u,m,v,x,M,A){const T=[p,u,v,r,m,x,1,1,1],D=[M,A,1],O=d.adjoint([],T),[R,V,H]=d.transformMat3(D,D,d.transpose(O,O));return d.multiply$1(T,[R,0,0,0,V,0,0,0,H],T)}class pt extends d.Evented{constructor(r,u,m,v){super(),this.id=r,this.dispatcher=m,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(r,u){this._loaded=u||!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(m,v)=>{if(this._loaded=!0,m)this.fire(new d.ErrorEvent(m));else if(v){const{HTMLImageElement:x}=d.window;this.image=v instanceof x?d.exported.getImageData(v):v,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const u=r.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let v=1/0,x=1/0,M=-1/0,A=-1/0;for(const R of m)v=Math.min(v,R.x),x=Math.min(x,R.y),M=Math.max(M,R.x),A=Math.max(A,R.y);const T=Math.max(M-v,A-x),D=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),O=Math.pow(2,D);return new d.CanonicalTileID(D,Math.floor((v+M)/2*O),Math.floor((x+A)/2*O))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const T in this.tiles){const D=this.tiles[T];"loaded"!==D.state&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const u=d.tileTransform(this.tileID,this.map.transform.projection),[m,v,x,M]=this.coordinates.map(T=>{const D=u.projection.project(T[0],T[1]);return d.getTilePoint(u,D)._round()});this.perspectiveTransform=function(T,D,O,R,V,H,j,q,Z,U){const J=mt(0,0,T,0,0,D,T,D),$=mt(O,R,V,H,j,q,Z,U);return d.multiply$1($,d.adjoint(J,J),$),[$[6]/$[8]*T/d.EXTENT,$[7]/$[8]*D/d.EXTENT]}(this.width,this.height,m.x,m.y,v.x,v.y,M.x,M.y,x.x,x.y);const A=this._boundsArray=new d.StructArrayLayout4i8;A.emplaceBack(m.x,m.y,0,0),A.emplaceBack(v.x,v.y,d.EXTENT,0),A.emplaceBack(M.x,M.y,0,d.EXTENT),A.emplaceBack(x.x,x.y,d.EXTENT,d.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(A,d.boundsAttributes.members),this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,u=r.gl;this.texture?this.texture.update(this.image):(this.texture=new d.Texture(r,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,u){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},u(null)):(r.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ht={vector:class extends d.Evented{constructor(p,r,u,m){if(super(),this.id=p,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(r,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(p){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"}));const r=this.language||this.map._language,u=this.worldview||this.map._worldview;this._tileJSONRequest=Qo(this._options,this.map._requestManager,r,u,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${r}`),u&&2!==u.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new d.ErrorEvent(m))):v&&(d.extend(this,v),v.bounds&&(this.tileBounds=new Gn(v.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.load(()=>{const r=this.map.style._getSourceCaches(this.id);for(const u of r)u.clearTiles()})}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}_setLanguage(p){return p===this.language||this.setSourceProperty(()=>{this.language=p}),this}_setWorldview(p){return p===this.worldview?this:this.worldviewOptions&&p&&!this.worldviewOptions[p]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${p}".`),this):(this.setSourceProperty(()=>{this.worldview=p}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(p,r){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(u,d.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=r:p.request=p.actor.send("reloadTile",m,v.bind(this));else if(p.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",m,v.bind(this),void 0,!0);else{const x=d.loadVectorTile.call({deduped:this._deduped},m,(M,A)=>{M||!A?v.call(this,M):(m.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},p.actor&&p.actor.send("loadTile",m,v.bind(this),void 0,!0))},!0);p.request={cancel:x}}function v(x,M){return delete p.request,p.aborted?r(null):x&&404!==x.status?r(x):(M&&M.resourceTiming&&(p.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&p.setExpiryData(M),p.loadVectorData(M,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Q,"raster-dem":class extends Q{constructor(p,r,u,m){super(p,r,u,m),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,x){v&&(p.state="errored",r(v)),x&&(p.dem=x,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=d.getImage(this.map._requestManager.transformRequest(u,d.ResourceType.Tile),function(v,x,M,A){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(v)p.state="errored",r(v);else if(x){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:M,expires:A});const T=d.window.ImageBitmap&&x instanceof d.window.ImageBitmap&&(null==ut&&(ut=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),ut),D=1-(x.width-d.prevPowerOfTwo(x.width))/2;D<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const O=T?x:d.exported.getImageData(x,D),R={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:D};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",R,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const r=p.canonical,u=Math.pow(2,r.z),m=(r.x-1+u)%u,v=0===r.x?p.wrap-1:p.wrap,x=(r.x+1+u)%u,M=r.x+1===u?p.wrap+1:p.wrap,A={};return A[new d.OverscaledTileID(p.overscaledZ,v,r.z,m,r.y).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,M,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(A[new d.OverscaledTileID(p.overscaledZ,v,r.z,m,r.y-1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,M,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<u&&(A[new d.OverscaledTileID(p.overscaledZ,v,r.z,m,r.y+1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,M,r.z,x,r.y+1).key]={backfilled:!1}),A}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends d.Evented{constructor(p,r,u,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=r.data,this._options=d.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const v=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*v,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*v,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*v,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},r),this}getClusterLeaves(p,r,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:r,offset:u},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=d.extend({},this.workerOptions),r=this._data;"string"==typeof r?(p.request=this.map._requestManager.transformRequest(d.exported.resolveURL(r),d.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new d.ErrorEvent(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v.resourceTiming=m.resourceTiming[this.id]),this.fire(new d.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,r){const u=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(u,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,v)=>(delete p.request,p.unloadVectorData(),p.aborted?r(null):m?r(m):(p.loadVectorData(v,this.map.painter,"reloadTile"===u),r(null))),void 0,"loadTile"===u)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pt{constructor(p,r,u,m){super(p,r,u,m),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,d.ResourceType.Source).url);d.getVideo(this.urls,(r,u)=>{this._loaded=!0,r?this.fire(new d.ErrorEvent(r)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(p,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pt,canvas:class extends pt{constructor(p,r,u,m){super(p,r,u,m),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(x=>"number"!=typeof x))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends d.Evented{constructor(p,r,u,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=r,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Gn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),d.extend(this,d.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:u,z:m}=p.canonical;return this._implementation.hasTile({x:r,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:u,y:m,z:v}=p.tileID.canonical,x=new d.window.AbortController,M=this._implementation.loadTile({x:u,y:m,z:v},{signal:x.signal});if(!M)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null);M.cancel=()=>x.abort(),p.request=M.then(function(A){return delete p.request,p.aborted?(p.state="unloaded",r(null)):A?(T=A)instanceof d.window.ImageData||T instanceof d.window.ImageBitmap||T instanceof d.window.HTMLCanvasElement?(this.loadTileData(p,A),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null));var T}.bind(this)).catch(A=>{20!==A.code&&(p.state="errored",r(A))})}loadTileData(p,r){Q.loadTileData(p,r,this._map.painter)}unloadTileData(p){Q.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:r,y:u,z:m}=p.tileID.canonical,v=this._implementation.prepareTile({x:r,y:u,z:m});return v?(this.loadTileData(p,v),p.state="loaded",v):null}unloadTile(p,r){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:u,y:m,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:v})}r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}}},_t=function(p,r,u,m){const v=new ht[r.type](p,r,u,m);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],v),v};function Dt(p,r){const u=d.identity([]);return d.scale(u,u,[.5*p.width,.5*-p.height,1]),d.translate(u,u,[1,-1,0]),d.multiply(u,u,p.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(u)}function Wt(p,r,u,m,v,x,M,A=!1){const T=p.tilesIn(m,M,A);T.sort(re);const D=[];for(const R of T)D.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(r,u,p._state,R,v,x,Dt(p.transform,R.tile.tileID),A)});const O=function(R){const V={},H={};for(const j of R){const q=j.queryResults,Z=j.wrappedTileID,U=H[Z]=H[Z]||{};for(const J in q){const $=q[J],lt=U[J]=U[J]||{},st=V[J]=V[J]||[];for(const et of $)lt[et.featureIndex]||(lt[et.featureIndex]=!0,st.push(et))}}return V}(D);for(const R in O)O[R].forEach(V=>{const H=V.feature,j=H.layer;j&&"background"!==j.type&&"sky"!==j.type&&(H.source=j.source,j["source-layer"]&&(H.sourceLayer=j["source-layer"]),H.state=void 0!==H.id?p.getFeatureState(j["source-layer"],H.id):{})});return O}function Ft(p,r){const u=p.getRenderableIds().map(x=>p.getTileByID(x)),m=[],v={};for(let x=0;x<u.length;x++){const M=u[x],A=M.tileID.canonical.key;v[A]||(v[A]=!0,M.querySourceFeatures(m,r))}return m}function re(p,r){const u=p.tileID,m=r.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function ae(){return null!=fa.workerClass?new fa.workerClass:new d.window.Worker(fa.workerUrl)}const te="mapboxgl_preloaded_worker_pool";class oe{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<oe.workerCount;)this.workers.push(new ae);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[te]}numActive(){return Object.keys(this.active).length}}let ve;function Ge(){return ve||(ve=new oe),ve}function We(p,r){const u={};for(const m in p)"ref"!==m&&(u[m]=p[m]);return d.refProperties.forEach(m=>{m in r&&(u[m]=r[m])}),u}function Ue(p){p=p.slice();const r=Object.create(null);for(let u=0;u<p.length;u++)r[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=We(p[u],r[p[u].ref]));return p}oe.workerCount=2;const ee={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ct(p,r,u){u.push({command:ee.addSource,args:[p,r[p]]})}function xn(p,r,u){r.push({command:ee.removeSource,args:[p]}),u[p]=!0}function gi(p,r,u,m){xn(p,u,m),Ct(p,r,u)}function zr(p,r,u){let m;for(m in p[u])if(p[u].hasOwnProperty(m)&&"data"!==m&&!Bt(p[u][m],r[u][m]))return!1;for(m in r[u])if(r[u].hasOwnProperty(m)&&"data"!==m&&!Bt(p[u][m],r[u][m]))return!1;return!0}function Vs(p,r,u,m,v,x){let M;for(M in r=r||{},p=p||{})p.hasOwnProperty(M)&&(Bt(p[M],r[M])||u.push({command:x,args:[m,M,r[M],v]}));for(M in r)r.hasOwnProperty(M)&&!p.hasOwnProperty(M)&&(Bt(p[M],r[M])||u.push({command:x,args:[m,M,r[M],v]}))}function Nn(p){return p.id}function Ql(p,r){return p[r.id]=r,p}class Ih{constructor(r,u){this.reset(r,u)}reset(r,u){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=d.clamp(r,0,1);let u=1,m=this._distances[u];const v=r*this.paddedLength+this.padding;for(;m<v&&u<this._distances.length;)m=this._distances[++u];const x=u-1,M=this._distances[x],A=m-M,T=A>0?(v-M)/A:0;return this.points[x].mult(1-T).add(this.points[u].mult(T))}}class go{constructor(r,u,m){const v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(u/m);for(let M=0;M<this.xCellCount*this.yCellCount;M++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=u,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,u,m,v,x){this._forEachCell(u,m,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(r,u,m,v){this._forEachCell(u-v,m-v,u+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(u),this.circles.push(m),this.circles.push(v)}_insertBoxCell(r,u,m,v,x,M){this.boxCells[x].push(M)}_insertCircleCell(r,u,m,v,x,M){this.circleCells[x].push(M)}_query(r,u,m,v,x,M){if(m<0||r>this.width||v<0||u>this.height)return!x&&[];const A=[];if(r<=0&&u<=0&&this.width<=m&&this.height<=v){if(x)return!0;for(let T=0;T<this.boxKeys.length;T++)A.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const D=this.circles[3*T],O=this.circles[3*T+1],R=this.circles[3*T+2];A.push({key:this.circleKeys[T],x1:D-R,y1:O-R,x2:D+R,y2:O+R})}return M?A.filter(M):A}return this._forEachCell(r,u,m,v,this._queryCell,A,{hitTest:x,seenUids:{box:{},circle:{}}},M),x?A.length>0:A}_queryCircle(r,u,m,v,x){const M=r-m,A=r+m,T=u-m,D=u+m;if(A<0||M>this.width||D<0||T>this.height)return!v&&[];const O=[];return this._forEachCell(M,T,A,D,this._queryCellCircle,O,{hitTest:v,circle:{x:r,y:u,radius:m},seenUids:{box:{},circle:{}}},x),v?O.length>0:O}query(r,u,m,v,x){return this._query(r,u,m,v,!1,x)}hitTest(r,u,m,v,x){return this._query(r,u,m,v,!0,x)}hitTestCircle(r,u,m,v){return this._queryCircle(r,u,m,!0,v)}_queryCell(r,u,m,v,x,M,A,T){const D=A.seenUids,O=this.boxCells[x];if(null!==O){const V=this.bboxes;for(const H of O)if(!D.box[H]){D.box[H]=!0;const j=4*H;if(r<=V[j+2]&&u<=V[j+3]&&m>=V[j+0]&&v>=V[j+1]&&(!T||T(this.boxKeys[H]))){if(A.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[H],x1:V[j],y1:V[j+1],x2:V[j+2],y2:V[j+3]})}}}const R=this.circleCells[x];if(null!==R){const V=this.circles;for(const H of R)if(!D.circle[H]){D.circle[H]=!0;const j=3*H;if(this._circleAndRectCollide(V[j],V[j+1],V[j+2],r,u,m,v)&&(!T||T(this.circleKeys[H]))){if(A.hitTest)return M.push(!0),!0;{const q=V[j],Z=V[j+1],U=V[j+2];M.push({key:this.circleKeys[H],x1:q-U,y1:Z-U,x2:q+U,y2:Z+U})}}}}}_queryCellCircle(r,u,m,v,x,M,A,T){const D=A.circle,O=A.seenUids,R=this.boxCells[x];if(null!==R){const H=this.bboxes;for(const j of R)if(!O.box[j]){O.box[j]=!0;const q=4*j;if(this._circleAndRectCollide(D.x,D.y,D.radius,H[q+0],H[q+1],H[q+2],H[q+3])&&(!T||T(this.boxKeys[j])))return M.push(!0),!0}}const V=this.circleCells[x];if(null!==V){const H=this.circles;for(const j of V)if(!O.circle[j]){O.circle[j]=!0;const q=3*j;if(this._circlesCollide(H[q],H[q+1],H[q+2],D.x,D.y,D.radius)&&(!T||T(this.circleKeys[j])))return M.push(!0),!0}}}_forEachCell(r,u,m,v,x,M,A,T){const D=this._convertToXCellCoord(r),O=this._convertToYCellCoord(u),R=this._convertToXCellCoord(m),V=this._convertToYCellCoord(v);for(let H=D;H<=R;H++)for(let j=O;j<=V;j++)if(x.call(this,r,u,m,v,this.xCellCount*j+H,M,A,T))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,u,m,v,x,M){const A=v-r,T=x-u,D=m+M;return D*D>A*A+T*T}_circleAndRectCollide(r,u,m,v,x,M,A){const T=(M-v)/2,D=Math.abs(r-(v+T));if(D>T+m)return!1;const O=(A-x)/2,R=Math.abs(u-(x+O));if(R>O+m)return!1;if(D<=T||R<=O)return!0;const V=D-T,H=R-O;return V*V+H*H<=m*m}}const Xt=Math.tan(85*Math.PI/180);function we(p,r,u,m,v,x,M){const A=d.create();if(u)if("globe"===x.name){const T=d.calculateGlobeLabelMatrix(v,r);d.multiply(A,A,T)}else{const T=lo([],M);A[0]=T[0],A[1]=T[1],A[4]=T[2],A[5]=T[3],m||d.rotateZ(A,A,v.angle)}else d.multiply(A,v.labelPlaneMatrix,p);return A}function Se(p,r,u,m,v,x,M){const A=we(p,r,u,m,v,x,M);return"globe"===x.name&&u||(A[2]=A[6]=A[10]=A[14]=0),A}function Tn(p,r,u,m,v,x,M){if(u){if("globe"===x.name){const A=we(p,r,u,m,v,x,M);return d.invert(A,A),d.multiply(A,p,A),A}{const A=d.clone(p),T=d.identity([]);return T[0]=M[0],T[1]=M[1],T[4]=M[2],T[5]=M[3],d.multiply(A,A,T),m||d.rotateZ(A,A,-v.angle),A}}return v.glCoordMatrix}function bn(p,r,u=0){const m=[p.x,p.y,u,1];u?d.transformMat4$1(m,m,r):ln(m,m,r);const v=m[3];return{point:[m[0]/v,m[1]/v,m[2]/v],signedDistanceFromCamera:v}}function xe(p,r){const u=[p[0],p[1],p[2],1];d.transformMat4$1(u,u,r);const m=u[3];return{point:[u[0]/m,u[1]/m,u[2]/m],signedDistanceFromCamera:m}}function Ba(p,r){return Math.min(.5+p/r*.5,1.5)}function Gs(p,r){const u=p[0]/p[3],m=p[1]/p[3];return u>=-r[0]&&u<=r[0]&&m>=-r[1]&&m<=r[1]}function _r(p,r,u,m,v,x,M,A,T,D){const O=u.transform,R=m?p.textSizeData:p.iconSizeData,V=d.evaluateSizeForZoom(R,u.transform.zoom),H="globe"===O.projection.name,j=[256/u.width*2+1,256/u.height*2+1],q=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;q.clear();let Z=null;H&&(Z=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const U=p.lineVertexArray,J=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,$=u.transform.width/u.transform.height;let lt=!1;for(let st=0;st<J.length;st++){const et=J.get(st);if(et.writingMode!==d.WritingMode.vertical||lt||0!==st&&J.get(st-1).writingMode===d.WritingMode.horizontal||(lt=!0),(et.hidden||et.writingMode===d.WritingMode.vertical)&&!lt){_o(et.numGlyphs,q);continue}lt=!1;const at=new d.pointGeometry(et.tileAnchorX,et.tileAnchorY),rt=T?T(at):[0,0,0],dt=O.projection.projectTilePoint(at.x,at.y,D.canonical),yt=[dt.x+rt[0],dt.y+rt[1],dt.z+rt[2]],Lt=[...yt,1];if(d.transformMat4$1(Lt,Lt,r),!Gs(Lt,j)){_o(et.numGlyphs,q);continue}const gt=Ba(u.transform.cameraToCenterDistance,Lt[3]),At=d.evaluateSizeForFeature(R,V,et),kt=M?At/gt:At*gt,Gt=bn(new d.pointGeometry(yt[0],yt[1]),v,yt[2]);if(Gt.signedDistanceFromCamera<=0){_o(et.numGlyphs,q);continue}let wt={};const zt=M?null:T,Et=tc(et,kt,!1,A,r,v,x,p.glyphOffsetArray,U,q,Z,Gt.point,at,wt,$,zt,O.projection,D,M);lt=Et.useVertical,zt&&Et.needsFlipping&&(wt={}),(Et.notEnoughRoom||lt||Et.needsFlipping&&tc(et,kt,!0,A,r,v,x,p.glyphOffsetArray,U,q,Z,Gt.point,at,wt,$,zt,O.projection,D,M).notEnoughRoom)&&_o(et.numGlyphs,q)}m?(p.text.dynamicLayoutVertexBuffer.updateData(q),Z&&p.text.globeExtVertexBuffer.updateData(Z)):(p.icon.dynamicLayoutVertexBuffer.updateData(q),Z&&p.icon.globeExtVertexBuffer.updateData(Z))}function Gi(p,r,u,m,v,x,M,A,T,D,O,R,V,H,j,q){const Z=A.glyphStartIndex+A.numGlyphs,U=A.lineStartIndex,J=A.lineStartIndex+A.lineLength,$=r.getoffsetX(A.glyphStartIndex),lt=r.getoffsetX(Z-1),st=Br(p*$,u,m,v,x,M,A.segment,U,J,T,D,O,R,V,!0,H,j,q);if(!st)return null;const et=Br(p*lt,u,m,v,x,M,A.segment,U,J,T,D,O,R,V,!0,H,j,q);return et?{first:st,last:et}:null}function ui(p,r,u,m){return p.writingMode===d.WritingMode.horizontal&&Math.abs(u.y-r.y)>Math.abs(u.x-r.x)*m?{useVertical:!0}:p.writingMode===d.WritingMode.vertical?r.y<u.y?{needsFlipping:!0}:null:0!==p.flipState&&function(v,x,M){const A=(x.x-v.x)*M;return 0===A||Math.abs((x.y-v.y)/A)>Xt}(r,u,m)?1===p.flipState?{needsFlipping:!0}:null:r.x>u.x?{needsFlipping:!0}:null}function tc(p,r,u,m,v,x,M,A,T,D,O,R,V,H,j,q,Z,U,J){const $=r/24,lt=p.lineOffsetX*$,st=p.lineOffsetY*$;let et;if(p.numGlyphs>1){const at=p.glyphStartIndex+p.numGlyphs,rt=p.lineStartIndex,dt=p.lineStartIndex+p.lineLength,yt=Gi($,A,lt,st,u,R,V,p,T,x,H,q,!1,Z,U,J);if(!yt)return{notEnoughRoom:!0};const Lt=xe(yt.first.point,M).point,gt=xe(yt.last.point,M).point,At=new d.pointGeometry(Lt[0],Lt[1]),kt=new d.pointGeometry(gt[0],gt[1]);if(m&&!u){const Gt=ui(p,At,kt,j);if(p.flipState=Gt&&Gt.needsFlipping?1:2,Gt)return Gt}et=[yt.first];for(let Gt=p.glyphStartIndex+1;Gt<at-1;Gt++)et.push(Br($*A.getoffsetX(Gt),lt,st,u,R,V,p.segment,rt,dt,T,x,H,q,!1,!1,Z,U,J));et.push(yt.last)}else{if(m&&!u){const rt=bn(V,v).point,dt=p.lineStartIndex+p.segment+1,yt=new d.pointGeometry(T.getx(dt),T.gety(dt)),Lt=bn(yt,v),gt=Lt.signedDistanceFromCamera>0?Lt.point:ec(V,yt,rt,1,v,void 0,Z,U.canonical),At=ui(p,new d.pointGeometry(rt[0],rt[1]),new d.pointGeometry(gt[0],gt[1]),j);if(p.flipState=At&&At.needsFlipping?1:2,At)return At}const at=Br($*A.getoffsetX(p.glyphStartIndex),lt,st,u,R,V,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,T,x,H,q,!1,!1,Z,U,J);if(!at)return{notEnoughRoom:!0};et=[at]}if(O)for(const at of et)d.updateGlobeVertexNormal(O,D.length+0,at.up[0],at.up[1],at.up[2]),d.updateGlobeVertexNormal(O,D.length+1,at.up[0],at.up[1],at.up[2]),d.updateGlobeVertexNormal(O,D.length+2,at.up[0],at.up[1],at.up[2]),d.updateGlobeVertexNormal(O,D.length+3,at.up[0],at.up[1],at.up[2]),d.addDynamicAttributes(D,at.point[0],at.point[1],at.point[2],at.angle);else for(const at of et)d.addDynamicAttributes(D,at.point[0],at.point[1],at.point[2],at.angle);return{}}function Jn(p,r,u,m,v){const x=m.projectTilePoint(p.x,p.y,r);if(!v)return bn(x,u,x.z);const M=v(p);return bn(new d.pointGeometry(x.x+M[0],x.y+M[1]),u,x.z+M[2])}function ec(p,r,u,m,v,x,M,A){const T=Jn(p.add(p.sub(r)._unit()),A,v,M,x).point,D=d.sub([],u,T);return d.scaleAndAdd([],u,D,m/d.length(D))}function Br(p,r,u,m,v,x,M,A,T,D,O,R,V,H,j,q,Z,U){const J=m?p-r:p+r;let $=J>0?1:-1,lt=0;m&&($*=-1,lt=Math.PI),$<0&&(lt+=Math.PI);let st=$>0?A+M:A+M+1,et=v,at=v,rt=0,dt=0;const yt=Math.abs(J),Lt=[],gt=[];let At=x;const kt=()=>{const Kt=st-$;return 0===rt?x:new d.pointGeometry(D.getx(Kt),D.gety(Kt))},Gt=()=>ec(kt(),At,at,yt-rt+1,O,V,q,Z.canonical);for(;rt+dt<=yt;){if(st+=$,st<A||st>=T)return null;if(at=et,Lt.push(et),H&&gt.push(At||kt()),et=R[st],void 0===et){At=new d.pointGeometry(D.getx(st),D.gety(st));const Kt=Jn(At,Z.canonical,O,q,V);et=Kt.signedDistanceFromCamera>0?R[st]=Kt.point:Gt()}else At=null;rt+=dt,dt=d.distance(at,et)}At=At||new d.pointGeometry(D.getx(st),D.gety(st));const wt=kt();j&&V&&(R[st]=et=void 0===R[st]?et:Gt(),dt=d.distance(at,et));const zt=(yt-rt)/dt,Et=At.sub(wt).mult(zt)._add(wt),Zt=d.sub([],et,at),Ut=d.scaleAndAdd([],at,Zt,zt);let Qt=[0,0,1],ie=Zt[0],se=Zt[1];if(U&&(Qt=q.upVector(Z.canonical,Et.x,Et.y),0!==Qt[0]||0!==Qt[1]||1!==Qt[2])){const Kt=[1,0,0],me=[0,1,0];Kt[0]=Qt[2],Kt[1]=0,Kt[2]=-Qt[0],d.cross(me,Qt,Kt),d.normalize(Kt,Kt),d.normalize(me,me),ie=d.dot(Zt,Kt),se=d.dot(Zt,me)}if(u){const Kt=d.cross([],Qt,Zt);d.normalize(Kt,Kt),d.scaleAndAdd(Ut,Ut,Kt,u*$)}const Te=lt+Math.atan2(se,ie);return Lt.push(Ut),H&&gt.push(Et),{point:Ut,angle:Te,path:Lt,tilePath:gt,up:Qt}}const Va=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function _o(p,r){for(let u=0;u<p;u++){const m=r.length;r.resize(m+4),r.float32.set(Va,4*m)}}function ln(p,r,u){const m=r[0],v=r[1];return p[0]=u[0]*m+u[4]*v+u[12],p[1]=u[1]*m+u[5]*v+u[13],p[3]=u[3]*m+u[7]*v+u[15],p}const Xe=100;class fu{constructor(r,u,m=new go(r.width+200,r.height+200,25),v=new go(r.width+200,r.height+200,25)){this.transform=r,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Xe,this.screenBottomBoundary=r.height+Xe,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=u}placeCollisionBox(r,u,m,v,x,M,A,T){let D=m.projectedAnchorX,O=m.projectedAnchorY,R=m.projectedAnchorZ;const V=m.elevation,H=m.tileID;if(V&&H){const st=r.getProjection().upVector(H.canonical,m.tileAnchorX,m.tileAnchorY),et=r.getProjection().upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=st[0]*V*et,O+=st[1]*V*et,R+=st[2]*V*et}const j=this.projectAndGetPerspectiveRatio(A,[D,O,R],m.tileID,"globe"===r.projection.name||!!V||this.transform.pitch>0,r.getProjection()),q=M*j.perspectiveRatio,Z=(m.x1*u+v.x-m.padding)*q+j.point.x,U=(m.y1*u+v.y-m.padding)*q+j.point.y,J=(m.x2*u+v.x+m.padding)*q+j.point.x,$=(m.y2*u+v.y+m.padding)*q+j.point.y,lt=j.perspectiveRatio<=.55||j.occluded;return!this.isInsideGrid(Z,U,J,$)||!x&&this.grid.hitTest(Z,U,J,$,T)||lt?{box:[],offscreen:!1,occluded:j.occluded}:{box:[Z,U,J,$],offscreen:this.isOffscreen(Z,U,J,$),occluded:!1}}placeCollisionCircles(r,u,m,v,x,M,A,T,D,O,R,V,H,j,q){const Z=[],U=this.transform.elevation,J=U?U.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,r.getProjection()):wt=>[0,0,0],$=new d.pointGeometry(m.tileAnchorX,m.tileAnchorY),lt=r.getProjection().projectTilePoint(m.tileAnchorX,m.tileAnchorY,q.canonical),st=J($),et=[lt.x+st[0],lt.y+st[1],lt.z+st[2]],at="globe"===r.projection.name,rt=this.projectAndGetPerspectiveRatio(A,[et[0],et[1],et[2]],q,at||!!U||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:dt}=rt,yt=(R?M/dt:M*dt)/d.ONE_EM,Lt=bn(new d.pointGeometry(et[0],et[1]),T,et[2]).point,gt=rt.signedDistanceFromCamera>0?Gi(yt,x,m.lineOffsetX*yt,m.lineOffsetY*yt,!1,Lt,$,m,v,T,{},U&&!R?J:null,R&&!!U,r.getProjection(),q,R):null;let At=!1,kt=!1,Gt=!0;if(gt&&!rt.occluded){const wt=.5*H*dt+j,zt=new d.pointGeometry(-100,-100),Et=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Zt=new Ih,Ut=gt.first,Qt=gt.last;let ie=[];for(let Kt=Ut.path.length-1;Kt>=1;Kt--)ie.push(Ut.path[Kt]);for(let Kt=1;Kt<Qt.path.length;Kt++)ie.push(Qt.path[Kt]);const se=2.5*wt;if(D){const Kt=ie.map(U&&!at?(me,ze)=>{const ai=J(ze<Ut.path.length-1?Ut.tilePath[Ut.path.length-1-ze]:Qt.tilePath[ze-Ut.path.length+2]);return me[2]=ai[2],xe(me,D)}:me=>xe(me,D));ie=Kt.some(me=>me.signedDistanceFromCamera<=0)?[]:Kt.map(me=>me.point)}let Te=[];if(ie.length>0){const Kt=ie.map($e=>new d.pointGeometry($e[0],$e[1]));let me=1/0,ze=-1/0,ai=1/0,vi=-1/0;for(let $e=0;$e<Kt.length;$e++)me=Math.min(me,Kt[$e].x),ai=Math.min(ai,Kt[$e].y),ze=Math.max(ze,Kt[$e].x),vi=Math.max(vi,Kt[$e].y);Te=me>=zt.x&&ze<=Et.x&&ai>=zt.y&&vi<=Et.y?[Kt]:ze<zt.x||me>Et.x||vi<zt.y||ai>Et.y?[]:d.clipLine([Kt],zt.x,zt.y,Et.x,Et.y)}for(const Kt of Te){Zt.reset(Kt,.25*wt);let me=0;me=Zt.length<=.5*wt?1:Math.ceil(Zt.paddedLength/se)+1;for(let ze=0;ze<me;ze++){const ai=ze/Math.max(me-1,1),vi=Zt.lerp(ai),$e=vi.x+Xe,ji=vi.y+Xe;Z.push($e,ji,wt,0);const ir=$e-wt,nr=ji-wt,ni=$e+wt,di=ji+wt;if(Gt=Gt&&this.isOffscreen(ir,nr,ni,di),kt=kt||this.isInsideGrid(ir,nr,ni,di),!u&&this.grid.hitTestCircle($e,ji,wt,V)&&(At=!0,!O))return{circles:[],offscreen:!1,collisionDetected:At,occluded:!1}}}}return{circles:!O&&At||!kt?[]:Z,offscreen:Gt,collisionDetected:At,occluded:rt.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let m=1/0,v=1/0,x=-1/0,M=-1/0;for(const O of r){const R=new d.pointGeometry(O.x+Xe,O.y+Xe);m=Math.min(m,R.x),v=Math.min(v,R.y),x=Math.max(x,R.x),M=Math.max(M,R.y),u.push(R)}const A=this.grid.query(m,v,x,M).concat(this.ignoredGrid.query(m,v,x,M)),T={},D={};for(const O of A){const R=O.key;if(void 0===T[R.bucketInstanceId]&&(T[R.bucketInstanceId]={}),T[R.bucketInstanceId][R.featureIndex])continue;const V=[new d.pointGeometry(O.x1,O.y1),new d.pointGeometry(O.x2,O.y1),new d.pointGeometry(O.x2,O.y2),new d.pointGeometry(O.x1,O.y2)];d.polygonIntersectsPolygon(u,V)&&(T[R.bucketInstanceId][R.featureIndex]=!0,void 0===D[R.bucketInstanceId]&&(D[R.bucketInstanceId]=[]),D[R.bucketInstanceId].push(R.featureIndex))}return D}insertCollisionBox(r,u,m,v,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,u,m,v,x){const M=u?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:v,collisionGroupID:x};for(let T=0;T<r.length;T+=4)M.insertCircle(A,r[T],r[T+1],r[T+2])}projectAndGetPerspectiveRatio(r,u,m,v,x){const M=[u[0],u[1],u[2],1];let A=!1;if(u[2]||this.transform.pitch>0){d.transformMat4$1(M,M,r);const T="globe"===x.name;this.fogState&&m&&!T&&(A=function(D,O,R,V,H,j){const q=j.calculateFogTileMatrix(H),Z=[O,R,V];return d.transformMat4(Z,Z,q),Vn(D,Z,j.pitch,j._fov)}(this.fogState,u[0],u[1],u[2],m.toUnwrapped(),this.transform)>.9)}else ln(M,M,r);return{point:new d.pointGeometry((M[0]/M[3]+1)/2*this.transform.width+Xe,(-M[1]/M[3]+1)/2*this.transform.height+Xe),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(x)/M[3]*.5,1.5),signedDistanceFromCamera:M[3],occluded:v&&M[2]>M[3]||A}}isOffscreen(r,u,m,v){return m<Xe||r>=this.screenRightBoundary||v<Xe||u>this.screenBottomBoundary}isInsideGrid(r,u,m,v){return m>=0&&r<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const r=d.identity([]);return d.translate(r,r,[-100,-100,0]),r}}function Ns(p,r,u){const m=r.createTileMatrix(p,p.worldSize,u.toUnwrapped());return d.multiply(new Float32Array(16),p.projMatrix,m)}function Qi(p,r,u){if(r.projection.name===u.projection.name)return p.projMatrix;const m=u.clone();return m.setProjection(r.projection),Ns(m,r.getProjection(),p)}function cn(p,r,u){return r.name===u.projection.name?p.projMatrix:Ns(u,r,p)}class Ga{constructor(r,u,m,v){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?u:-u))):v&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class yr{constructor(r,u,m,v,x,M=!1){this.text=new Ga(r?r.text:null,u,m,x),this.icon=new Ga(r?r.icon:null,u,v,x),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yi{constructor(r,u,m,v=!1){this.text=r,this.icon=u,this.skipFade=m,this.clipped=v}}class Us{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class Na{constructor(r,u,m,v,x){this.bucketInstanceId=r,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=x}}class js{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const u=++this.maxGroupID;this.collisionGroups[r]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[r]}}function Ni(p,r,u,m,v){const{horizontalAlign:x,verticalAlign:M}=d.getAnchorAlignment(p),A=-(x-.5)*r,T=-(M-.5)*u,D=d.evaluateVariableOffset(p,m);return new d.pointGeometry(A+D[0]*v,T+D[1]*v)}function rs(p,r,u,m,v){const x=new d.pointGeometry(p,r);return u&&x._rotate(m?v:-v),x}class ic{constructor(r,u,m,v,x){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new fu(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new js(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,u,m,v){const x=m.getBucket(u),M=m.latestFeatureIndex;if(!x||!M||u.id!==x.layerIds[0])return;const A=x.layers[0].layout,T=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),O=m.tileSize/d.EXTENT,R=m.tileID.toUnwrapped();this.transform.setProjection(x.projection);const V=(H=m.tileID,j=x.getProjection(),q=this.transform,j.name===this.projection?q.calculateProjMatrix(H.toUnwrapped()):Ns(q,j,H));var H,j,q;const Z="map"===A.get("text-pitch-alignment"),U="map"===A.get("text-rotation-alignment");u.compileFilter();const J=u.dynamicFilter(),$=u.dynamicFilterNeedsFeature(),lt=this.transform.calculatePixelsToTileUnitsMatrix(m),st=Se(V,m.tileID.canonical,Z,U,this.transform,x.getProjection(),lt);let et=null;if(Z){const dt=Tn(V,m.tileID.canonical,Z,U,this.transform,x.getProjection(),lt);et=d.multiply([],this.transform.labelPlaneMatrix,dt)}let at=null;J&&m.latestFeatureIndex&&(at={unwrappedTileID:R,dynamicFilter:J,dynamicFilterNeedsFeature:$,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Na(x.bucketInstanceId,M,x.sourceLayerIndex,x.index,m.tileID);const rt={bucket:x,layout:A,posMatrix:V,textLabelPlaneMatrix:st,labelToScreenMatrix:et,clippingData:at,scale:D,textPixelRatio:O,holdingForFade:m.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(v)for(const dt of x.sortKeyRanges){const{sortKey:yt,symbolInstanceStart:Lt,symbolInstanceEnd:gt}=dt;r.push({sortKey:yt,symbolInstanceStart:Lt,symbolInstanceEnd:gt,parameters:rt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:rt})}attemptAnchorPlacement(r,u,m,v,x,M,A,T,D,O,R,V,H,j,q,Z,U,J){const $=[V.textOffset0,V.textOffset1],lt=Ni(r,m,v,$,x),st=this.collisionIndex.placeCollisionBox(j,x,u,rs(lt.x,lt.y,M,A,this.transform.angle),R,T,D,O.predicate);if((!Z||0!==this.collisionIndex.placeCollisionBox(j,j.getSymbolInstanceIconSize(J,this.transform.zoom,H),Z,rs(lt.x,lt.y,M,A,this.transform.angle),R,T,D,O.predicate).box.length)&&st.box.length>0){let et;return this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(et=this.prevPlacement.variableOffsets[V.crossTileID].anchor),this.variableOffsets[V.crossTileID]={textOffset:$,width:m,height:v,anchor:r,textScale:x,prevAnchor:et},this.markUsedJustification(j,r,V,q),j.allowVerticalPlacement&&(this.markUsedOrientation(j,q,V),this.placedOrientations[V.crossTileID]=q),{shift:lt,placedGlyphBoxes:st}}}placeLayerBucketPart(r,u,m,v){const{bucket:x,layout:M,posMatrix:A,textLabelPlaneMatrix:T,labelToScreenMatrix:D,clippingData:O,textPixelRatio:R,holdingForFade:V,collisionBoxArray:H,partiallyEvaluatedTextSize:j,partiallyEvaluatedIconSize:q,collisionGroup:Z}=r.parameters,U=M.get("text-optional"),J=M.get("icon-optional"),$=M.get("text-allow-overlap"),lt=M.get("icon-allow-overlap"),st="map"===M.get("text-rotation-alignment"),et="map"===M.get("text-pitch-alignment"),at="none"!==M.get("icon-text-fit"),rt="viewport-y"===M.get("symbol-z-order");this.transform.setProjection(x.projection);let dt=$&&(lt||!x.hasIconData()||J),yt=lt&&($||!x.hasTextData()||U);!x.collisionArrays&&H&&x.deserializeCollisionBoxes(H),m&&v&&x.updateCollisionDebugBuffers(this.transform.zoom,H);const Lt=(gt,At,kt)=>{if(O){const ni={zoom:this.transform.zoom,pitch:this.transform.pitch};let di=null;if(O.dynamicFilterNeedsFeature){const Me=this.retainedQueryData[x.bucketInstanceId];di=O.featureIndex.loadFeature({featureIndex:gt.featureIndex,bucketIndex:Me.bucketIndex,sourceLayerIndex:Me.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(ni,di,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new d.pointGeometry(gt.tileAnchorX,gt.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[gt.crossTileID]=new yi(!1,!1,!1,!0),void(u[gt.crossTileID]=!0)}if(u[gt.crossTileID])return;if(V)return void(this.placements[gt.crossTileID]=new yi(!1,!1,!1));let Gt=!1,wt=!1,zt=!0,Et=!1,Zt=!1,Ut=null,Qt={box:null,offscreen:null,occluded:null},ie={box:null,offscreen:null,occluded:null},se=null,Te=null,Kt=null,me=0,ze=0,ai=0;kt.textFeatureIndex?me=kt.textFeatureIndex:gt.useRuntimeCollisionCircles&&(me=gt.featureIndex),kt.verticalTextFeatureIndex&&(ze=kt.verticalTextFeatureIndex);const vi=ni=>{ni.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||ni.elevation)&&(ni.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,ni.tileAnchorX,ni.tileAnchorY):0)},$e=kt.textBox;if($e){vi($e);const ni=Me=>{let Si=d.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Me&&this.prevPlacement){const $i=this.prevPlacement.placedOrientations[gt.crossTileID];$i&&(this.placedOrientations[gt.crossTileID]=$i,Si=$i,this.markUsedOrientation(x,Si,gt))}return Si},di=(Me,Si)=>{if(x.allowVerticalPlacement&&gt.numVerticalGlyphVertices>0&&kt.verticalTextBox){for(const $i of x.writingModes)if($i===d.WritingMode.vertical?(Qt=Si(),ie=Qt):Qt=Me(),Qt&&Qt.box&&Qt.box.length)break}else Qt=Me()};if(M.get("text-variable-anchor")){let Me=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[gt.crossTileID]){const Ke=this.prevPlacement.variableOffsets[gt.crossTileID];Me.indexOf(Ke.anchor)>0&&(Me=Me.filter(tn=>tn!==Ke.anchor),Me.unshift(Ke.anchor))}const Si=(Ke,tn,Io)=>{const en=x.getSymbolInstanceTextSize(j,gt,this.transform.zoom,At),Hr=(Ke.x2-Ke.x1)*en+2*Ke.padding,$r=(Ke.y2-Ke.y1)*en+2*Ke.padding,Oo=at&&!lt?tn:null;Oo&&vi(Oo);let nn={box:[],offscreen:!1,occluded:!1};const Fo=$?2*Me.length:Me.length;for(let Yr=0;Yr<Fo;++Yr){const ma=this.attemptAnchorPlacement(Me[Yr%Me.length],Ke,Hr,$r,en,st,et,R,A,Z,Yr>=Me.length,gt,At,x,Io,Oo,j,q);if(ma&&(nn=ma.placedGlyphBoxes,nn&&nn.box&&nn.box.length)){Gt=!0,Ut=ma.shift;break}}return nn};di(()=>Si($e,kt.iconBox,d.WritingMode.horizontal),()=>{const Ke=kt.verticalTextBox;return Ke&&vi(Ke),x.allowVerticalPlacement&&!(Qt&&Qt.box&&Qt.box.length)&&gt.numVerticalGlyphVertices>0&&Ke?Si(Ke,kt.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Qt&&(Gt=Qt.box,zt=Qt.offscreen,Et=Qt.occluded);const $i=ni(Qt&&Qt.box);if(!Gt&&this.prevPlacement){const Ke=this.prevPlacement.variableOffsets[gt.crossTileID];Ke&&(this.variableOffsets[gt.crossTileID]=Ke,this.markUsedJustification(x,Ke.anchor,gt,$i))}}else{const Me=(Si,$i)=>{const Ke=x.getSymbolInstanceTextSize(j,gt,this.transform.zoom,At),tn=this.collisionIndex.placeCollisionBox(x,Ke,Si,new d.pointGeometry(0,0),$,R,A,Z.predicate);return tn&&tn.box&&tn.box.length&&(this.markUsedOrientation(x,$i,gt),this.placedOrientations[gt.crossTileID]=$i),tn};di(()=>Me($e,d.WritingMode.horizontal),()=>{const Si=kt.verticalTextBox;return x.allowVerticalPlacement&&gt.numVerticalGlyphVertices>0&&Si?(vi(Si),Me(Si,d.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ni(Qt&&Qt.box&&Qt.box.length)}}if(se=Qt,Gt=se&&se.box&&se.box.length>0,zt=se&&se.offscreen,Et=se&&se.occluded,gt.useRuntimeCollisionCircles){const ni=x.text.placedSymbolArray.get(gt.centerJustifiedTextSymbolIndex>=0?gt.centerJustifiedTextSymbolIndex:gt.verticalPlacedTextSymbolIndex),di=d.evaluateSizeForFeature(x.textSizeData,j,ni),Me=M.get("text-padding");Te=this.collisionIndex.placeCollisionCircles(x,$,ni,x.lineVertexArray,x.glyphOffsetArray,di,A,T,D,m,et,Z.predicate,gt.collisionCircleDiameter*di/d.ONE_EM,Me,this.retainedQueryData[x.bucketInstanceId].tileID),Gt=$||Te.circles.length>0&&!Te.collisionDetected,zt=zt&&Te.offscreen,Et=Te.occluded}if(kt.iconFeatureIndex&&(ai=kt.iconFeatureIndex),kt.iconBox){const ni=di=>{vi(di);const Me=at&&Ut?rs(Ut.x,Ut.y,st,et,this.transform.angle):new d.pointGeometry(0,0),Si=x.getSymbolInstanceIconSize(q,this.transform.zoom,At);return this.collisionIndex.placeCollisionBox(x,Si,di,Me,lt,R,A,Z.predicate)};ie&&ie.box&&ie.box.length&&kt.verticalIconBox?(Kt=ni(kt.verticalIconBox),wt=Kt.box.length>0):(Kt=ni(kt.iconBox),wt=Kt.box.length>0),zt=zt&&Kt.offscreen,Zt=Kt.occluded}const ji=U||0===gt.numHorizontalGlyphVertices&&0===gt.numVerticalGlyphVertices,ir=J||0===gt.numIconVertices;if(ji||ir?ir?ji||(wt=wt&&Gt):Gt=wt&&Gt:wt=Gt=wt&&Gt,Gt&&se&&se.box&&this.collisionIndex.insertCollisionBox(se.box,M.get("text-ignore-placement"),x.bucketInstanceId,ie&&ie.box&&ze?ze:me,Z.ID),wt&&Kt&&this.collisionIndex.insertCollisionBox(Kt.box,M.get("icon-ignore-placement"),x.bucketInstanceId,ai,Z.ID),Te&&(Gt&&this.collisionIndex.insertCollisionCircles(Te.circles,M.get("text-ignore-placement"),x.bucketInstanceId,me,Z.ID),m)){const ni=x.bucketInstanceId;let di=this.collisionCircleArrays[ni];void 0===di&&(di=this.collisionCircleArrays[ni]=new Us);for(let Me=0;Me<Te.circles.length;Me+=4)di.circles.push(Te.circles[Me+0]),di.circles.push(Te.circles[Me+1]),di.circles.push(Te.circles[Me+2]),di.circles.push(Te.collisionDetected?1:0)}const nr="globe"!==x.projection.name;dt=dt&&(nr||!Et),yt=yt&&(nr||!Zt),this.placements[gt.crossTileID]=new yi(Gt||dt,wt||yt,zt||x.justReloaded),u[gt.crossTileID]=!0};if(rt){const gt=x.getSortedSymbolIndexes(this.transform.angle);for(let At=gt.length-1;At>=0;--At){const kt=gt[At];Lt(x.symbolInstances.get(kt),kt,x.collisionArrays[kt])}}else for(let gt=r.symbolInstanceStart;gt<r.symbolInstanceEnd;gt++)Lt(x.symbolInstances.get(gt),gt,x.collisionArrays[gt]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){const gt=this.collisionCircleArrays[x.bucketInstanceId];d.invert(gt.invProjMatrix,A),gt.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(r,u,m,v){let x;x=v===d.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(u)];const M=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const A of M)A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=x>=0&&A!==x?0:m.crossTileID)}markUsedOrientation(r,u,m){const v=u===d.WritingMode.horizontal||u===d.WritingMode.horizontalOnly?u:0,x=u===d.WritingMode.vertical?u:0,M=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const A of M)r.text.placedSymbolArray.get(A).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(r):1,x=u?u.opacities:{},M=u?u.variableOffsets:{},A=u?u.placedOrientations:{};for(const T in this.placements){const D=this.placements[T],O=x[T];O?(this.opacities[T]=new yr(O,v,D.text,D.icon,null,D.clipped),m=m||D.text!==O.text.placed||D.icon!==O.icon.placed):(this.opacities[T]=new yr(null,v,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const T in x){const D=x[T];if(!this.opacities[T]){const O=new yr(D,v,!1,!1);O.isHidden()||(this.opacities[T]=O,m=m||D.text.placed||D.icon.placed)}}for(const T in M)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=M[T]);for(const T in A)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=A[T]);m?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:r)}updateLayerOpacities(r,u){const m={};for(const v of u){const x=v.getBucket(r);x&&v.latestFeatureIndex&&r.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,v.collisionBoxArray)}}updateBucketOpacities(r,u,m){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const v=r.layers[0].layout,x=!!r.layers[0].dynamicFilter(),M=new yr(null,0,!1,!1,!0),A=v.get("text-allow-overlap"),T=v.get("icon-allow-overlap"),D=v.get("text-variable-anchor"),O="map"===v.get("text-rotation-alignment"),R="map"===v.get("text-pitch-alignment"),V="none"!==v.get("icon-text-fit"),H=new yr(null,0,A&&(T||!r.hasIconData()||v.get("icon-optional")),T&&(A||!r.hasTextData()||v.get("text-optional")),!0);!r.collisionArrays&&m&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(m);const j=(Z,U,J)=>{for(let $=0;$<U/4;$++)Z.opacityVertexArray.emplaceBack(J)};let q=0;for(let Z=0;Z<r.symbolInstances.length;Z++){const U=r.symbolInstances.get(Z),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:$,crossTileID:lt}=U;let st=this.opacities[lt];u[lt]?st=M:st||(st=H,this.opacities[lt]=st),u[lt]=!0;const et=J>0||$>0,at=U.numIconVertices>0,rt=this.placedOrientations[U.crossTileID],dt=rt===d.WritingMode.vertical,yt=rt===d.WritingMode.horizontal||rt===d.WritingMode.horizontalOnly;if(!et&&!at||st.isHidden()||q++,et){const Lt=vo(st.text);j(r.text,J,dt?Cn:Lt),j(r.text,$,yt?Cn:Lt);const gt=st.text.isHidden();[U.rightJustifiedTextSymbolIndex,U.centerJustifiedTextSymbolIndex,U.leftJustifiedTextSymbolIndex].forEach(Gt=>{Gt>=0&&(r.text.placedSymbolArray.get(Gt).hidden=gt||dt?1:0)}),U.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(U.verticalPlacedTextSymbolIndex).hidden=gt||yt?1:0);const At=this.variableOffsets[U.crossTileID];At&&this.markUsedJustification(r,At.anchor,U,rt);const kt=this.placedOrientations[U.crossTileID];kt&&(this.markUsedJustification(r,"left",U,kt),this.markUsedOrientation(r,kt,U))}if(at){const Lt=vo(st.icon);U.placedIconSymbolIndex>=0&&(j(r.icon,U.numIconVertices,dt?Cn:Lt),r.icon.placedSymbolArray.get(U.placedIconSymbolIndex).hidden=st.icon.isHidden()),U.verticalPlacedIconSymbolIndex>=0&&(j(r.icon,U.numVerticalIconVertices,yt?Cn:Lt),r.icon.placedSymbolArray.get(U.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Lt=r.collisionArrays[Z];if(Lt){let gt=new d.pointGeometry(0,0),At=!0;if(Lt.textBox||Lt.verticalTextBox){if(D){const Gt=this.variableOffsets[lt];Gt?(gt=Ni(Gt.anchor,Gt.width,Gt.height,Gt.textOffset,Gt.textScale),O&&gt._rotate(R?this.transform.angle:-this.transform.angle)):At=!1}x&&(At=!st.clipped),Lt.textBox&&wn(r.textCollisionBox.collisionVertexArray,st.text.placed,!At||dt,gt.x,gt.y),Lt.verticalTextBox&&wn(r.textCollisionBox.collisionVertexArray,st.text.placed,!At||yt,gt.x,gt.y)}const kt=At&&Boolean(!yt&&Lt.verticalIconBox);Lt.iconBox&&wn(r.iconCollisionBox.collisionVertexArray,st.icon.placed,kt,V?gt.x:0,V?gt.y:0),Lt.verticalIconBox&&wn(r.iconCollisionBox.collisionVertexArray,st.icon.placed,!kt,V?gt.x:0,V?gt.y:0)}}}if(r.fullyClipped=0===q,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Z.invProjMatrix,r.placementViewportMatrix=Z.viewportMatrix,r.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function wn(p,r,u,m,v){p.emplaceBack(r?1:0,u?1:0,m||0,v||0),p.emplaceBack(r?1:0,u?1:0,m||0,v||0),p.emplaceBack(r?1:0,u?1:0,m||0,v||0),p.emplaceBack(r?1:0,u?1:0,m||0,v||0)}const qs=Math.pow(2,25),Zs=Math.pow(2,24),nc=Math.pow(2,17),rc=Math.pow(2,16),yo=Math.pow(2,9),Oh=Math.pow(2,8),Vr=Math.pow(2,1);function vo(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const r=p.placed?1:0,u=Math.floor(127*p.opacity);return u*qs+r*Zs+u*nc+r*rc+u*yo+r*Oh+u*Vr+r}const Cn=0;class Ua{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,u,m,v,x){const M=this._bucketParts;for(;this._currentTileIndex<r.length;)if(u.getBucketParts(M,v,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((A,T)=>A.sortKey-T.sortKey));this._currentPartIndex<M.length;){const A=M[this._currentPartIndex];if(u.placeLayerBucketPart(A,this._seenCrossTileIDs,m,0===A.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class Kn{constructor(r,u,m,v,x,M,A,T){this.placement=new ic(r,x,M,A,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(r,u,m){const v=d.exported.now(),x=()=>{const M=d.exported.now()-v;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=u[r[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=A)&&(!M.maxzoom||M.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Ua(M)),this._inProgressLayer.continuePlacement(m[M.source],this.placement,this._showCollisionBoxes,M,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const ja=512/d.EXTENT/2;class qa{constructor(r,u,m){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let v=0;v<u.length;v++){const x=u.get(v),M=x.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,r)})}}getScaledCoordinates(r,u){const m=ja/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*d.EXTENT+r.tileAnchorX)*m),y:Math.floor((u.canonical.y*d.EXTENT+r.tileAnchorY)*m)}}findMatches(r,u,m){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let x=0;x<r.length;x++){const M=r.get(x);if(M.crossTileID)continue;const A=this.indexedSymbolInstances[M.key];if(!A)continue;const T=this.getScaledCoordinates(M,u);for(const D of A)if(Math.abs(D.coord.x-T.x)<=v&&Math.abs(D.coord.y-T.y)<=v&&!m[D.crossTileID]){m[D.crossTileID]=!0,M.crossTileID=D.crossTileID;break}}}}class Za{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const u=Math.round((r-this.lng)/360);if(0!==u)for(const m in this.indexes){const v=this.indexes[m],x={};for(const M in v){const A=v[M];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+u),x[A.tileID.key]=A}this.indexes[m]=x}this.lng=r}addBucket(r,u,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const v=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const M=this.indexes[x];if(Number(x)>r.overscaledZ)for(const A in M){const T=M[A];T.tileID.isChildOf(r)&&T.findMatches(u.symbolInstances,r,v)}else{const A=M[r.scaledTo(Number(x)).key];A&&A.findMatches(u.symbolInstances,r,v)}}for(let x=0;x<u.symbolInstances.length;x++){const M=u.symbolInstances.get(x);M.crossTileID||(M.crossTileID=m.generate(),v[M.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new qa(r,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(r,u){for(const m in u.indexedSymbolInstances)for(const v of u.indexedSymbolInstances[m])delete this.usedCrossTileIDs[r][v.crossTileID]}removeStaleBuckets(r){let u=!1;for(const m in this.indexes){const v=this.indexes[m];for(const x in v)r[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[x]),delete v[x],u=!0)}return u}}class Hs{constructor(){this.layerIndexes={},this.crossTileIDs=new Za,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,u,m,v){let x=this.layerIndexes[r.id];void 0===x&&(x=this.layerIndexes[r.id]=new Fh);let M=!1;const A={};"globe"!==v.name&&x.handleWrapJump(m);for(const T of u){const D=T.getBucket(r);D&&r.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(T.tileID,D,this.crossTileIDs)&&(M=!0),A[D.bucketInstanceId]=!0)}return x.removeStaleBuckets(A)&&(M=!0),M}pruneUnusedLayers(r){const u={};r.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const Ha=(p,r)=>d.emitValidationErrors(p,r&&r.filter(u=>"source.canvas"!==u.identifier)),$a=d.pick(ee,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ph=d.pick(ee,["setCenter","setZoom","setBearing","setPitch"]),mu={version:8,layers:[],sources:{}},gu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class En extends d.Evented{constructor(r,u={}){super(),this.map=r,this.dispatcher=new Vi(Ge(),this),this.imageManager=new Hn,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(r._requestManager,u.localFontFamily?d.LocalGlyphMode.all:u.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new Hs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const m=this;this._rtlTextPluginCallback=En.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,M)=>{if(d.triggerPluginCompletionEvent(x),M&&M.every(A=>A))for(const A in m._sourceCaches){const T=m._sourceCaches[A],D=T.getSource().type;"vector"!==D&&"geojson"!==D||T.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const x=this.getSource(v.sourceId);if(x&&x.vectorLayerIds)for(const M in this._layers){const A=this._layers[M];A.source===x.id&&this._validateLayer(A)}})}loadURL(r,u={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof u.validate?u.validate:!d.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,u.accessToken);const v=this.map._requestManager.transformRequest(r,d.ResourceType.Style);this._request=d.getJSON(v,(x,M)=>{this._request=null,x?this.fire(new d.ErrorEvent(x)):M&&this._load(M,m)})}loadJSON(r,u={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(r,!1!==u.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(mu,!1)}_updateLayerCount(r,u){const m=u?1:-1;r.is3D()&&(this._num3DLayers+=m),"circle"===r.type&&(this._numCircleLayers+=m),"symbol"===r.type&&(this._numSymbolLayers+=m)}_load(r,u){if(u&&Ha(this,d.validateStyle(r)))return;this._loaded=!0,this.stylesheet=d.clone$1(r),this._updateMapProjection();for(const v in r.sources)this.addSource(v,r.sources[v],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const m=Ue(this.stylesheet.layers);this._order=m.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of m)v=d.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ls(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(u,m,v){let x,M,A;const T=d.exported.devicePixelRatio>1?"@2x":"";let D=d.getJSON(m.transformRequest(m.normalizeSpriteURL(u,T,".json"),d.ResourceType.SpriteJSON),(V,H)=>{D=null,A||(A=V,x=H,R())}),O=d.getImage(m.transformRequest(m.normalizeSpriteURL(u,T,".png"),d.ResourceType.SpriteImage),(V,H)=>{O=null,A||(A=V,M=H,R())});function R(){if(A)v(A);else if(x&&M){const V=d.exported.getImageData(M),H={};for(const j in x){const{width:q,height:Z,x:U,y:J,sdf:$,pixelRatio:lt,stretchX:st,stretchY:et,content:at}=x[j],rt=new d.RGBAImage({width:q,height:Z});d.RGBAImage.copy(V,rt,{x:U,y:J},{x:0,y:0},{width:q,height:Z}),H[j]={data:rt,pixelRatio:lt,sdf:$,stretchX:st,stretchY:et,content:at}}v(null,H)}}return{cancel(){D&&(D.cancel(),D=null),O&&(O.cancel(),O=null)}}}(r,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new d.ErrorEvent(u));else if(m)for(const v in m)this.imageManager.addImage(v,m[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(r){const u=this.getSource(r.source);if(!u)return;const m=r.sourceLayer;m&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(m))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const u=[];for(const m of r){const v=this._layers[m];"custom"!==v.type&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&gu[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(v.length||x.length)&&this._updateWorkerLayers(v,x);for(const M in this._updatedSources){const A=this._updatedSources[M];"reload"===A?this._reloadSource(M):"clear"===A&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const m={};for(const v in this._sourceCaches){const x=this._sourceCaches[v];m[v]=x.used,x.used=!1}for(const v of this._order){const x=this._layers[v];if(x.recalculate(r,this._availableImages),!x.isHidden(r.zoom)){const A=this._getLayerSourceCache(x);A&&(A.used=!0)}const M=this.map.painter;if(M){const A=x.getProgramIds();if(!A)continue;const T=x.getProgramConfiguration(r.zoom);for(const D of A)M.useProgram(D,T)}}for(const v in m){const x=this._sourceCaches[v];m[v]!==x.used&&x.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Ha(this,d.validateStyle(r)))return!1;(r=d.clone$1(r)).layers=Ue(r.layers);const u=function(v,x){if(!v)return[{command:ee.setStyle,args:[x]}];let M=[];try{if(!Bt(v.version,x.version))return[{command:ee.setStyle,args:[x]}];Bt(v.center,x.center)||M.push({command:ee.setCenter,args:[x.center]}),Bt(v.zoom,x.zoom)||M.push({command:ee.setZoom,args:[x.zoom]}),Bt(v.bearing,x.bearing)||M.push({command:ee.setBearing,args:[x.bearing]}),Bt(v.pitch,x.pitch)||M.push({command:ee.setPitch,args:[x.pitch]}),Bt(v.sprite,x.sprite)||M.push({command:ee.setSprite,args:[x.sprite]}),Bt(v.glyphs,x.glyphs)||M.push({command:ee.setGlyphs,args:[x.glyphs]}),Bt(v.transition,x.transition)||M.push({command:ee.setTransition,args:[x.transition]}),Bt(v.light,x.light)||M.push({command:ee.setLight,args:[x.light]}),Bt(v.fog,x.fog)||M.push({command:ee.setFog,args:[x.fog]}),Bt(v.projection,x.projection)||M.push({command:ee.setProjection,args:[x.projection]});const A={},T=[];!function(R,V,H,j){let q;for(q in V=V||{},R=R||{})R.hasOwnProperty(q)&&(V.hasOwnProperty(q)||xn(q,H,j));for(q in V)V.hasOwnProperty(q)&&(R.hasOwnProperty(q)?Bt(R[q],V[q])||("geojson"===R[q].type&&"geojson"===V[q].type&&zr(R,V,q)?H.push({command:ee.setGeoJSONSourceData,args:[q,V[q].data]}):gi(q,V,H,j)):Ct(q,V,H))}(v.sources,x.sources,T,A);const D=[];v.layers&&v.layers.forEach(R=>{R.source&&A[R.source]?M.push({command:ee.removeLayer,args:[R.id]}):D.push(R)});let O=v.terrain;O&&A[O.source]&&(M.push({command:ee.setTerrain,args:[void 0]}),O=void 0),M=M.concat(T),Bt(O,x.terrain)||M.push({command:ee.setTerrain,args:[x.terrain]}),function(R,V,H){V=V||[];const j=(R=R||[]).map(Nn),q=V.map(Nn),Z=R.reduce(Ql,{}),U=V.reduce(Ql,{}),J=j.slice(),$=Object.create(null);let lt,st,et,at,rt,dt,yt;for(lt=0,st=0;lt<j.length;lt++)et=j[lt],U.hasOwnProperty(et)?st++:(H.push({command:ee.removeLayer,args:[et]}),J.splice(J.indexOf(et,st),1));for(lt=0,st=0;lt<q.length;lt++)et=q[q.length-1-lt],J[J.length-1-lt]!==et&&(Z.hasOwnProperty(et)?(H.push({command:ee.removeLayer,args:[et]}),J.splice(J.lastIndexOf(et,J.length-st),1)):st++,dt=J[J.length-lt],H.push({command:ee.addLayer,args:[U[et],dt]}),J.splice(J.length-lt,0,et),$[et]=!0);for(lt=0;lt<q.length;lt++)if(et=q[lt],at=Z[et],rt=U[et],!$[et]&&!Bt(at,rt))if(Bt(at.source,rt.source)&&Bt(at["source-layer"],rt["source-layer"])&&Bt(at.type,rt.type)){for(yt in Vs(at.layout,rt.layout,H,et,null,ee.setLayoutProperty),Vs(at.paint,rt.paint,H,et,null,ee.setPaintProperty),Bt(at.filter,rt.filter)||H.push({command:ee.setFilter,args:[et,rt.filter]}),Bt(at.minzoom,rt.minzoom)&&Bt(at.maxzoom,rt.maxzoom)||H.push({command:ee.setLayerZoomRange,args:[et,rt.minzoom,rt.maxzoom]}),at)at.hasOwnProperty(yt)&&"layout"!==yt&&"paint"!==yt&&"filter"!==yt&&"metadata"!==yt&&"minzoom"!==yt&&"maxzoom"!==yt&&(0===yt.indexOf("paint.")?Vs(at[yt],rt[yt],H,et,yt.slice(6),ee.setPaintProperty):Bt(at[yt],rt[yt])||H.push({command:ee.setLayerProperty,args:[et,yt,rt[yt]]}));for(yt in rt)rt.hasOwnProperty(yt)&&!at.hasOwnProperty(yt)&&"layout"!==yt&&"paint"!==yt&&"filter"!==yt&&"metadata"!==yt&&"minzoom"!==yt&&"maxzoom"!==yt&&(0===yt.indexOf("paint.")?Vs(at[yt],rt[yt],H,et,yt.slice(6),ee.setPaintProperty):Bt(at[yt],rt[yt])||H.push({command:ee.setLayerProperty,args:[et,yt,rt[yt]]}))}else H.push({command:ee.removeLayer,args:[et]}),dt=J[J.lastIndexOf(et)+1],H.push({command:ee.addLayer,args:[rt,dt]})}(D,x.layers,M)}catch(A){console.warn("Unable to compute style diff:",A),M=[{command:ee.setStyle,args:[x]}]}return M}(this.serialize(),r).filter(v=>!(v.command in Ph));if(0===u.length)return!1;const m=u.filter(v=>!(v.command in $a));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{"setTransition"!==v.command&&"setProjection"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,u){return this.getImage(r)?this.fire(new d.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,u),this._afterImageUpdated(r),this)}updateImage(r,u){this.imageManager.updateImage(r,u)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new d.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,u,m={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(d.validateSource,`sources.${r}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=_t(r,u,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:v.serialize(),sourceId:r}));const x=M=>{const A=(M?"symbol:":"other:")+r,T=this._sourceCaches[A]=new d.SourceCache(A,v,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[r]=T,T.style=this,T.onAdd(this.map)};x(!1),"vector"!==u.type&&"geojson"!==u.type||x(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const u=this.getSource(r);if(!u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===r)return this.fire(new d.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new d.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(r);for(const v of m)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,u){this._checkLoaded(),this.getSource(r).setData(u),this._changed=!0}getSource(r){const u=this._getSourceCache(r);return u&&u.getSource()}addLayer(r,u,m={}){this._checkLoaded();const v=r.id;if(this.getLayer(v))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let x;if("custom"===r.type){if(Ha(this,d.validateCustomStyleLayer(r)))return;x=d.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(v,r.source),r=d.clone$1(r),r=d.extend(r,{source:v})),this._validate(d.validateLayer,`layers.${v}`,r,{arrayIndex:-1},m))return;x=d.createStyleLayer(r),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const M=u?this._order.indexOf(u):this._order.length;if(u&&-1===M)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(M,0,v),this._layerOrderChanged=!0,this._layers[v]=x;const A=this._getLayerSourceCache(x);if(this._removedLayers[v]&&x.source&&A&&"custom"!==x.type){const T=this._removedLayers[v];delete this._removedLayers[v],T.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",A.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,u){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===u)return;const m=this._order.indexOf(r);this._order.splice(m,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new d.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(v,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const u=this._layers[r];if(!u)return void this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=u,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const u in this._layers)if(this._layers[u].type===r)return!0;return!1}setLayerZoomRange(r,u,m){this._checkLoaded();const v=this.getLayer(r);v?v.minzoom===u&&v.maxzoom===m||(null!=u&&(v.minzoom=u),null!=m&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,u,m={}){this._checkLoaded();const v=this.getLayer(r);if(v){if(!Bt(v.filter,u))return null==u?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(d.validateFilter,`layers.${v.id}.filter`,u,{layerType:v.type},m)||(v.filter=d.clone$1(u),this._updateLayer(v)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const u=this.getLayer(r);return u&&d.clone$1(u.filter)}setLayoutProperty(r,u,m,v={}){this._checkLoaded();const x=this.getLayer(r);x?Bt(x.getLayoutProperty(u),m)||(x.setLayoutProperty(u,m,v),this._updateLayer(x)):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,u){const m=this.getLayer(r);if(m)return m.getLayoutProperty(u);this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,u,m,v={}){this._checkLoaded();const x=this.getLayer(r);x?Bt(x.getPaintProperty(u),m)||(x.setPaintProperty(u,m,v)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,u){const m=this.getLayer(r);return m&&m.getPaintProperty(u)}setFeatureState(r,u){this._checkLoaded();const m=r.source,v=r.sourceLayer,x=this.getSource(m);if(!x)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const M=x.type;if("geojson"===M&&v)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!v)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(m);for(const T of A)T.setFeatureState(v,r.id,u)}removeFeatureState(r,u){this._checkLoaded();const m=r.source,v=this.getSource(m);if(!v)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const x=v.type,M="vector"===x?r.sourceLayer:void 0;if("vector"===x&&!M)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(m);for(const T of A)T.removeFeatureState(M,r.id,u)}getFeatureState(r){this._checkLoaded();const u=r.source,m=r.sourceLayer,v=this.getSource(u);if(v){if("vector"!==v.type||m)return void 0===r.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(m,r.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();r[m.id]||(r[m.id]=m.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(r){this._updatedLayers[r.id]=!0;const u=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[r.source]="reload",u.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const u=M=>"fill-extrusion"===this._layers[M].type,m={},v=[];for(let M=this._order.length-1;M>=0;M--){const A=this._order[M];if(u(A)){m[A]=M;for(const T of r){const D=T[A];if(D)for(const O of D)v.push(O)}}}v.sort((M,A)=>A.intersectionZ-M.intersectionZ);const x=[];for(let M=this._order.length-1;M>=0;M--){const A=this._order[M];if(u(A))for(let T=v.length-1;T>=0;T--){const D=v[T].feature;if(m[D.layer.id]<M)break;x.push(D),v.pop()}else for(const T of r){const D=T[A];if(D)for(const O of D)x.push(O.feature)}}return x}queryRenderedFeatures(r,u,m){u&&u.filter&&this._validate(d.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const T of u.layers){const D=this._layers[T];if(!D)return this.fire(new d.ErrorEvent(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];v[D.source]=!0}}const x=[];u.availableImages=this._availableImages;const M=u&&u.layers?u.layers.some(T=>{const D=this.getLayer(T);return D&&D.is3D()}):this.has3DLayers(),A=an.createFromScreenPoints(r,m);for(const T in this._sourceCaches){const D=this._sourceCaches[T].getSource().id;u.layers&&!v[D]||x.push(Wt(this._sourceCaches[T],this._layers,this._serializedLayers,A,u,m,M,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(T,D,O,R,V,H,j){const q={},Z=H.queryRenderedSymbols(R),U=[];for(const J of Object.keys(Z).map(Number))U.push(j[J]);U.sort(re);for(const J of U){const $=J.featureIndex.lookupSymbolFeatures(Z[J.bucketInstanceId],D,J.bucketIndex,J.sourceLayerIndex,V.filter,V.layers,V.availableImages,T);for(const lt in $){const st=q[lt]=q[lt]||[],et=$[lt];et.sort((at,rt)=>{const dt=J.featureSortOrder;if(dt){const yt=dt.indexOf(at.featureIndex);return dt.indexOf(rt.featureIndex)-yt}return rt.featureIndex-at.featureIndex});for(const at of et)st.push(at)}}for(const J in q)q[J].forEach($=>{const lt=$.feature,st=O(T[J]).getFeatureState(lt.layer["source-layer"],lt.id);lt.source=lt.layer.source,lt.layer["source-layer"]&&(lt.sourceLayer=lt.layer["source-layer"]),lt.state=st});return q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(r,u){u&&u.filter&&this._validate(d.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const m=this._getSourceCaches(r);let v=[];for(const x of m)v=v.concat(Ft(x,u));return v}addSourceType(r,u,m){return En.getSourceType(r)?m(new Error(`A source type called "${r}" already exists.`)):(En.setSourceType(r,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:u.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(r,u={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const M in r)if(!Bt(r[M],m[M])){v=!0;break}if(!v)return;const x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,u),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,u=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof r.source){const m="terrain-dem-src";this.addSource(m,r.source),r=d.clone$1(r),r=d.extend(r,{source:m})}if(this._validate(d.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(r,u);else{const m=this.terrain,v=m.get();for(const x of Object.keys(d.spec.terrain))!r.hasOwnProperty(x)&&d.spec.terrain[x].default&&(r[x]=d.spec.terrain[x].default);for(const x in r)if(!Bt(r[x],v[x])){m.set(r),this.stylesheet.terrain=r;const M=this._setTransitionParameters({duration:0});m.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const u=this.fog=new ci(r,this.map.transform);this.stylesheet.fog=r;const m=this._setTransitionParameters({duration:0});u.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,m=u.get();0===Object.keys(r).length&&u.set(r);for(const v in r)if(!Bt(r[v],m[v])){u.set(r),this.stylesheet.fog=r;const x=this._setTransitionParameters({duration:0});u.updateTransitions(x);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:d.exported.now(),transition:d.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(m=>this.isLayerDraped(this._layers[m])),u=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...u)}_createTerrain(r,u){const m=this.terrain=new co(r,u);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const r in this._layers){const u=this._layers[r];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const u=this._layers[r];"symbol"===u.type&&this._updateLayer(u)}}_validate(r,u,m,v,x={}){return(!x||!1!==x.validate)&&Ha(this,r.call(d.validateStyle,d.extend({key:u,style:this.serialize(),value:m,styleSpec:d.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const u=this._getSourceCaches(r);for(const m of u)m.clearTiles()}_reloadSource(r){const u=this._getSourceCaches(r);for(const m of u)m.resume(),m.reload()}_updateSources(r){for(const u in this._sourceCaches)this._sourceCaches[u].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const u=this._sourceCaches[r];u.resume(),u.reload()}}_updatePlacement(r,u,m,v,x=!1){let M=!1,A=!1;const T={};for(const D of this._order){const O=this._layers[D];if("symbol"!==O.type)continue;if(!T[O.source]){const V=this._getLayerSourceCache(O);if(!V)continue;T[O.source]=V.getRenderableIds(!0).map(H=>V.getTileByID(H)).sort((H,j)=>j.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(j.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(O,T[O.source],r.center.lng,r.projection);M=M||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),r.zoom))&&(this.pauseablePlacement=new Kn(r,this._order,x,u,m,v,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),A=!0),M&&this.pauseablePlacement.placement.setStale()),A||M)for(const D of this._order){const O=this._layers[D];"symbol"===O.type&&this.placement.updateLayerOpacities(O,T[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,u,m){this.imageManager.getImages(u.icons,m),this._updateTilesForChangedImages();const v=x=>{x&&x.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(r,u,m){this.glyphManager.getGlyphs(u.stacks,m)}getResource(r,u,m){return d.makeRequest(u,m)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const u=[];return this._otherSourceCaches[r]&&u.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&u.push(this._symbolSourceCaches[r]),u}_isSourceCacheLoaded(r){const u=this._getSourceCaches(r);return 0===u.length?(this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}En.getSourceType=function(p){return ht[p]},En.setSourceType=function(p,r){ht[p]=r},En.registerForPluginStateChange=d.registerForPluginStateChange;var _u="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",$s="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",oc="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Ya="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",xo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Qn={},bo={};const vr=[];xr(_u,vr),xr(oc,vr),xr(Ya,vr),xr(xo,vr),Qn=Pe("",oc),bo=Pe(xo,Ya);const Ys=Pe("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ws=_u,Wa="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Xa={background:Pe("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Pe("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Pe("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Pe("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pe("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Pe("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pe("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pe("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pe("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Pe("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Pe("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Pe("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Pe("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Pe("uniform lowp vec3 u_lightpos;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvoid main() {vec4 color=v_color;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Pe("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Pe("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pe("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Pe("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Pe("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Pe("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Pe("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Pe("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Pe("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Pe("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Pe("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Pe("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",$s),skyboxGradient:Pe("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",$s),skyboxCapture:Pe("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pe("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Pe("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function xr(p,r){const u=p.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let m of u)if(m=m.trim(),"#"===m[0]&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=m.split(" ");for(const x of v)r.includes(x)||r.push(x)}}function Pe(p,r){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},x=[...vr];return xr(p,x),xr(r,x),{fragmentSource:p=p.replace(u,(M,A,T,D,O)=>(v[O]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${O}\nvarying ${T} ${D} ${O};\n#else\nuniform ${T} ${D} u_${O};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${O}\n    ${T} ${D} ${O} = u_${O};\n#endif\n`)),vertexSource:r=r.replace(u,(M,A,T,D,O)=>{const R="float"===D?"vec2":"vec4",V=O.match(/color/)?"color":R;return v[O]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${O}\nuniform lowp float u_${O}_t;\nattribute ${T} ${R} a_${O};\nvarying ${T} ${D} ${O};\n#else\nuniform ${T} ${D} u_${O};\n#endif\n`:"vec4"===V?`\n#ifndef HAS_UNIFORM_u_${O}\n    ${O} = a_${O};\n#else\n    ${T} ${D} ${O} = u_${O};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${O}\n    ${O} = unpack_mix_${V}(a_${O}, u_${O}_t);\n#else\n    ${T} ${D} ${O} = u_${O};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${O}\nuniform lowp float u_${O}_t;\nattribute ${T} ${R} a_${O};\n#else\nuniform ${T} ${D} u_${O};\n#endif\n`:"vec4"===V?`\n#ifndef HAS_UNIFORM_u_${O}\n    ${T} ${D} ${O} = a_${O};\n#else\n    ${T} ${D} ${O} = u_${O};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${O}\n    ${T} ${D} ${O} = unpack_mix_${V}(a_${O}, u_${O}_t);\n#else\n    ${T} ${D} ${O} = u_${O};\n#endif\n`}),staticAttributes:m,usedDefines:x}}class Ja{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,u,m,v,x,M,A){this.context=r;let T=this.boundPaintVertexBuffers.length!==v.length;for(let O=0;!T&&O<v.length;O++)this.boundPaintVertexBuffers[O]!==v[O]&&(T=!0);let D=this.boundDynamicVertexBuffers.length!==A.length;for(let O=0;!D&&O<A.length;O++)this.boundDynamicVertexBuffers[O]!==A[O]&&(D=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==m||T||D||this.boundIndexBuffer!==x||this.boundVertexOffset!==M)this.freshBind(u,m,v,x,M,A);else{r.bindVertexArrayOES.set(this.vao);for(const O of A)O&&O.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(r,u,m,v,x,M){let A;const T=r.numAttributes,D=this.context,O=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=r,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=M;else{A=D.currentNumAttributes||0;for(let R=T;R<A;R++)O.disableVertexAttribArray(R)}u.enableAttributes(O,r),u.bind(),u.setVertexAttribPointers(O,r,x);for(const R of m)R.enableAttributes(O,r),R.bind(),R.setVertexAttribPointers(O,r,x);for(const R of M)R&&(R.enableAttributes(O,r),R.bind(),R.setVertexAttribPointers(O,r,x));v&&v.bind(),D.currentNumAttributes=T}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ka(p,r){const u=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new d.MercatorCoordinate(0,m/u).toLngLat().lat,new d.MercatorCoordinate(0,(m+1)/u).toLngLat().lat]}function sc(p,r,u,m,v,x,M){const A=p.context,T=A.gl,D=u.fbo;if(!D)return;p.prepareDrawTile();const O=p.useProgram("hillshade");A.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,D.colorAttachment.get());const R=((q,Z,U,J)=>{const $=U.paint.get("hillshade-shadow-color"),lt=U.paint.get("hillshade-highlight-color"),st=U.paint.get("hillshade-accent-color");let et=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===U.paint.get("hillshade-illumination-anchor")&&(et-=q.transform.angle);const at=!q.options.moving;return{u_matrix:J||q.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),at),u_image:0,u_latrange:Ka(0,Z.tileID),u_light:[U.paint.get("hillshade-exaggeration"),et],u_shadow:$,u_highlight:lt,u_accent:st}})(p,u,m,p.terrain?r.projMatrix:null);p.prepareDrawProgram(A,O,r.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:H,tileBoundsSegments:j}=p.getTileBoundsBuffers(u);O.draw(A,T.TRIANGLES,v,x,M,d.CullFaceMode.disabled,R,m.id,V,H,j)}function Fe(p,r,u){if(!r.needsDEMTextureUpload)return;const m=p.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(u.stride);const x=u.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new d.Texture(m,x,v.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function os(p,r,u,m,v,x){const M=p.context,A=M.gl;if(!r.dem)return;const T=r.dem;if(M.activeTexture.set(A.TEXTURE1),Fe(p,r,T),!r.demTexture)return;r.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const D=T.dim;M.activeTexture.set(A.TEXTURE0);let O=r.fbo;if(!O){const j=new d.Texture(M,{width:D,height:D,data:null},A.RGBA);j.bind(A.LINEAR,A.CLAMP_TO_EDGE),O=r.fbo=M.createFramebuffer(D,D,!0),O.colorAttachment.set(j.texture)}M.bindFramebuffer.set(O.framebuffer),M.viewport.set([0,0,D,D]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:V,tileBoundsSegments:H}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(M,A.TRIANGLES,m,v,x,d.CullFaceMode.disabled,((j,q)=>{const Z=q.stride,U=d.create();return d.ortho(U,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(U,U,[0,-d.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[Z,Z],u_zoom:j.overscaledZ,u_unpack:q.unpackVector}})(r.tileID,T),u.id,R,V,H),r.needsHillshadePrepare=!1}const ss=p=>({u_matrix:new d.UniformMatrix4f(p),u_image0:new d.Uniform1i(p),u_skirt_height:new d.Uniform1f(p)}),ac=(p,r)=>({u_matrix:p,u_image0:0,u_skirt_height:r}),Qa=(p,r,u,m,v,x,M,A,T,D,O,R,V,H)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:M,u_frustum_tr:A,u_frustum_br:T,u_frustum_bl:D,u_globe_pos:O,u_globe_radius:R,u_viewport:V,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9)});function yu(p,r){return null!=p&&null!=r&&!(!p.hasData()||!r.hasData())&&null!=p.demTexture&&null!=r.demTexture&&p.tileID.key!==r.tileID.key}const wo=new class{constructor(){this.operations={}}newMorphing(p,r,u,m,v){if(p in this.operations){const x=this.operations[p];x.to.tileID.key!==u.tileID.key&&(x.queued=u)}else this.operations[p]={startTime:m,phase:0,duration:v,from:r,to:u,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const u=this.operations[r];for(u.phase=(p-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},tl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Lh(p,r){const u=1<<p.z;return!r&&(0===p.x||p.x===u-1)||0===p.y||p.y===u-1}const vu=p=>({u_matrix:p});function as(p,r,u,m,v){if(v>0){const x=d.exported.now(),M=(x-p.timeAdded)/v,A=r?(x-r.timeAdded)/v:-1,T=u.getSource(),D=m.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),O=!r||Math.abs(r.tileID.overscaledZ-D)>Math.abs(p.tileID.overscaledZ-D),R=O&&p.refreshedUponExpiration?1:d.clamp(O?M:1-A,0,1);return p.refreshedUponExpiration&&M>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class el extends d.SourceCache{constructor(r){const u={type:"raster-dem",maxzoom:r.transform.maxZoom},m=new Vi(Ge(),null),v=_t("mock-dem",u,m,r.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,u){r.state="loaded",u(null)}}class xu extends d.SourceCache{constructor(r){const u=_t("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Vi(Ge(),null),r.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,u,m){if(r.freezeTileCoverage)return;this.transform=r;const v=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,M)=>{if(x[M.key]="",!this._tiles[M.key]){const A=new d.Tile(M,this._source.tileSize*M.overscaleFactor(),r.tileZoom);A.state="loaded",this._tiles[M.key]=A}return x},{});for(const x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){const u=this.proxyCachedFBO[r];if(void 0!==u){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class lc extends d.OverscaledTileID{constructor(r,u,m){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class cc extends d.Elevation{constructor(r,u){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,x]=function(T){const D=new d.StructArrayLayout4i8,O=new d.StructArrayLayout3ui6,R=131;D.reserve(17161),O.reserve(33800);const V=d.EXTENT/128,H=d.EXTENT+V/2,j=H+V;for(let Z=-V;Z<j;Z+=V)for(let U=-V;U<j;U+=V){const J=U<0||U>H||Z<0||Z>H?24575:0,$=d.clamp(Math.round(U),0,d.EXTENT),lt=d.clamp(Math.round(Z),0,d.EXTENT);D.emplaceBack($+J,lt,$,lt)}const q=(Z,U)=>{const J=U*R+Z;O.emplaceBack(J+1,J,J+R),O.emplaceBack(J+R,J+R+1,J+1)};for(let Z=1;Z<129;Z++)for(let U=1;U<129;U++)q(U,Z);return[0,129].forEach(Z=>{for(let U=0;U<130;U++)q(U,Z),q(Z,U)}),[D,O,32768]}(),M=r.context;this.gridBuffer=M.createVertexBuffer(m,d.boundsAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(v),this.gridSegments=d.SegmentVector.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new xu(u.map),this.orthoMatrix=d.create(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const A=M.gl;this._overlapStencilMode=new d.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new el(u.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,u,m){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const v=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const x=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(u,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),u.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(T=>{const D=u.getTileByID(T).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(T,D){const O=D.transform.pointCoordinate(D.transform.getCameraPoint()),R=new d.pointGeometry(O.x,O.y);T.sort((V,H)=>{if(H.overscaledZ-V.overscaledZ)return H.overscaledZ-V.overscaledZ;const j=new d.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),q=new d.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),Z=R.mult(1<<V.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(j)-Z.distSqr(q)})})(v,this.painter),this._previousZoom=m.zoom;const x=this.proxyToSource||{};this.proxyToSource={},v.forEach(T=>{this.proxyToSource[T.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const T in M){const D=M[T];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,r[T],x),D.usedForTerrain))continue;const O=r[T];D.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[u.id]=v.map(T=>new lc(T,T.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const A={};this._visibleDemTiles=[];for(const T of this.proxyCoords){const D=this.terrainTileForTile[T.key];if(!D)continue;const O=D.tileID.key;O in A||(this._visibleDemTiles.push(D),A[O]=O)}}_assignTerrainTiles(r){this._initializing||r.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const r=this.painter.context,u=r.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(r.activeTexture.set(u.TEXTURE1),Fe(this.painter,v,x))}}_prepareDemTileUniforms(r,u,m,v){if(!u||null==u.demTexture)return!1;const x=r.tileID.canonical,M=Math.pow(2,u.tileID.canonical.z-x.z),A=v||"";return m[`u_dem_tl${A}`]=[x.x*M%1,x.y*M%1],m[`u_dem_scale${A}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,u=r.gl;if(!this._emptyDepthBufferTexture){const m=new d.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new d.Texture(r,m,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const u=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const x=v.dem.tree.minimums[0];return x>0&&r++,m+x},0);return r?u/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,u=r.gl;r.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new d.RGBAImage({width:1,height:1},new Uint8Array(d.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new d.Texture(r,v,u.RGBA,{premultiply:!1}),x}setupElevationDraw(r,u,m){const v=this.painter.context,x=v.gl,M=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();const T=this.painter.transform,D=T.projection,O=r.tileID.canonical;M.u_tile_tl_up=D.upVector(O,0,0),M.u_tile_tr_up=D.upVector(O,d.EXTENT,0),M.u_tile_br_up=D.upVector(O,d.EXTENT,d.EXTENT),M.u_tile_bl_up=D.upVector(O,0,d.EXTENT),M.u_tile_up_scale=m&&m.useDenormalizedUpVectorScale?d.GLOBE_METERS_TO_ECEF:D.upVectorScale(O,T.center.lat,T.worldSize).metersToTile;let R=null,V=null,H=1;if(m&&m.morphing&&this._useVertexMorphing){const j=m.morphing.srcDemTile,q=m.morphing.dstDemTile;H=m.morphing.phase,j&&q&&(this._prepareDemTileUniforms(r,j,M,"_prev")&&(V=j),this._prepareDemTileUniforms(r,q,M)&&(R=q))}if(V&&R?(v.activeTexture.set(x.TEXTURE2),R.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),v.activeTexture.set(x.TEXTURE4),V.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),M.u_dem_lerp=H):(R=this.terrainTileForTile[r.tileID.key],v.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(r,R,M)?R.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),v.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&R){const j=(1<<R.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=j}m&&m.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(v,M)}renderToBackBuffer(r){const u=this.painter,m=this.painter.context;0!==r.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,M,A,T){if("globe"===v.transform.projection.name)!function(D,O,R,V,H){const j=D.context,q=j.gl;let Z,U;const J=D.options.showTerrainWireframe?2:0,$=D.transform,lt=d.globeUseCustomAntiAliasing(D,j,$),st=(Gt,wt)=>{if(U===Gt)return;const zt=[tl[Gt],"PROJECTION_GLOBE_VIEW"];lt&&zt.push("CUSTOM_ANTIALIASING"),wt&&zt.push(tl[J]),Z=D.useProgram("globeRaster",null,zt),U=Gt},et=D.colorModeForRenderPass(),at=new d.DepthMode(q.LEQUAL,d.DepthMode.ReadWrite,D.depthRangeFor3D);wo.update(H);const rt=d.calculateGlobeMercatorMatrix($),dt=[d.mercatorXfromLng($.center.lng),d.mercatorYfromLat($.center.lat)],yt=J?[!1,!0]:[!1],Lt=D.globeSharedBuffers,gt=[$.width*d.exported.devicePixelRatio,$.height*d.exported.devicePixelRatio],At=Float32Array.from($.globeMatrix),kt={useDenormalizedUpVectorScale:!0};if(yt.forEach(Gt=>{U=-1;const wt=Gt?q.LINES:q.TRIANGLES;for(const zt of V){const Et=R.getTile(zt),Zt=d.StencilMode.disabled,Ut=O.prevTerrainTileForTile[zt.key],Qt=O.terrainTileForTile[zt.key];yu(Ut,Qt)&&wo.newMorphing(zt.key,Ut,Qt,H,250),j.activeTexture.set(q.TEXTURE0),Et.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const ie=wo.getMorphValuesForProxy(zt.key),se=ie?1:0;ie&&d.extend$1(kt,{morphing:{srcDemTile:ie.from,dstDemTile:ie.to,phase:d.easeCubicInOut(ie.phase)}});const Te=d.tileCornersToBounds(zt.canonical),Kt=d.getLatitudinalLod(Te.getCenter().lat),me=d.getGridMatrix(zt.canonical,Te,Kt),ze=d.globeNormalizeECEF(d.globeTileBounds(zt.canonical)),ai=Qa($.projMatrix,At,rt,ze,d.globeToMercatorTransition($.zoom),dt,$.frustumCorners.TL,$.frustumCorners.TR,$.frustumCorners.BR,$.frustumCorners.BL,$.globeCenterInViewSpace,$.globeRadius,gt,me);if(st(se,Gt),O.setupElevationDraw(Et,Z,kt),D.prepareDrawProgram(j,Z,zt.toUnwrapped()),Lt){const[vi,$e,ji]=Gt?Lt.getWirefameBuffers(D.context,Kt):Lt.getGridBuffers(Kt);Z.draw(j,wt,at,Zt,et,d.CullFaceMode.backCCW,ai,"globe_raster",vi,$e,ji)}}}),Lt){const Gt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];lt&&Gt.push("CUSTOM_ANTIALIASING"),Z=D.useProgram("globeRaster",null,Gt);for(const wt of V){const{x:zt,y:Et,z:Zt}=wt.canonical,Ut=0===Et,Qt=Et===(1<<Zt)-1,[ie,se,Te,Kt]=Lt.getPoleBuffers(Zt);if(Kt&&(Ut||Qt)){const me=R.getTile(wt);j.activeTexture.set(q.TEXTURE0),me.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let ze=d.globePoleMatrixForTile(Zt,zt,$);const ai=d.globeNormalizeECEF(d.globeTileBounds(wt.canonical)),vi=($e,ji)=>$e.draw(j,q.TRIANGLES,at,d.StencilMode.disabled,et,d.CullFaceMode.disabled,Qa($.projMatrix,ze,ze,ai,0,dt,$.frustumCorners.TL,$.frustumCorners.TR,$.frustumCorners.BR,$.frustumCorners.BL,$.globeCenterInViewSpace,$.globeRadius,gt),"globe_pole_raster",ji,Te,Kt);O.setupElevationDraw(me,Z,kt),D.prepareDrawProgram(j,Z,wt.toUnwrapped()),Ut&&vi(Z,ie),Qt&&(ze=d.scale(d.create(),ze,[1,-1,1]),vi(Z,se))}}}}(v,x,M,A,T);else{const D=v.context,O=D.gl;let R,V;const H=v.options.showTerrainWireframe?2:0,j=($,lt)=>{if(V===$)return;const st=[tl[$]];lt&&st.push(tl[H]),R=v.useProgram("terrainRaster",null,st),V=$},q=v.colorModeForRenderPass(),Z=new d.DepthMode(O.LEQUAL,d.DepthMode.ReadWrite,v.depthRangeFor3D);wo.update(T);const U=v.transform,J=6*Math.pow(1.5,22-U.zoom)*x.exaggeration();(H?[!1,!0]:[!1]).forEach($=>{V=-1;const lt=$?O.LINES:O.TRIANGLES,[st,et]=$?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const at of A){const rt=M.getTile(at),dt=d.StencilMode.disabled,yt=x.prevTerrainTileForTile[at.key],Lt=x.terrainTileForTile[at.key];yu(yt,Lt)&&wo.newMorphing(at.key,yt,Lt,T,250),D.activeTexture.set(O.TEXTURE0),rt.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const gt=wo.getMorphValuesForProxy(at.key),At=gt?1:0;let kt;gt&&(kt={morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:d.easeCubicInOut(gt.phase)}});const Gt=ac(at.projMatrix,Lh(at.canonical,U.renderWorldCopies)?J/10:J);j(At,$),x.setupElevationDraw(rt,R,kt),v.prepareDrawProgram(D,R,at.toUnwrapped()),R.draw(D,lt,Z,dt,q,d.CullFaceMode.backCCW,Gt,"terrain_raster",x.gridBuffer,st,et)}})}}(u,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],M=this._drapedRenderBatches.shift(),A=[],T=u.style.order;let D=0;for(const O of x){const R=v.getTileByID(O.proxyTileKey),V=v.proxyCachedFBO[O.key]?v.proxyCachedFBO[O.key][r]:void 0,H=void 0!==V?v.renderCache[V]:this.pool[D++],j=void 0!==V;if(R.texture=H.tex,j&&!H.dirty){A.push(R.tileID);continue}let q;m.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(m.clear({color:d.Color.transparent,stencil:0}),H.dirty=!1);for(let Z=M.start;Z<=M.end;++Z){const U=u.style._layers[T[Z]];if(U.isHidden(u.transform.zoom))continue;const J=u.style._getLayerSourceCache(U),$=J?this.proxyToSource[O.key][J.id]:[O];if(!$)continue;const lt=$;m.viewport.set([0,0,H.fb.width,H.fb.height]),q!==(J?J.id:null)&&(this._setupStencil(H,$,U,J),q=J?J.id:null),u.renderLayer(u,J,U,lt)}this.renderedToTile?(H.dirty=!0,A.push(R.tileID)):j||--D,5===D&&(D=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),M.end+1}postRender(){}renderCacheEfficiency(r){const u=r.order.length;if(0===u)return{efficiency:100};let m,v=0,x=0,M=!1;for(let A=0;A<u;++A){const T=r._layers[r.order[A]];this._style.isLayerDraped(T)?(M&&++v,++x):M||(M=!0,m=T.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-v/x),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{r=Math.min(r,u.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,u,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const M=x.tileID,A=1<<M.overscaledZ,{x:T,y:D}=M.canonical,O=T/A,R=(T+1)/A,V=D/A,H=(D+1)/A;return{minx:O,miny:V,maxx:R,maxy:H,t:x.dem.tree.raycastRoot(O,V,R,H,r,u,m),tile:x}});v.sort((x,M)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const x of v){if(null==x.t)return null;const M=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,u,m);if(null!=M)return M}return null}_createFBO(){const r=this.painter.context,u=r.gl,m=this.drapeBufferSize;r.activeTexture.set(u.TEXTURE0);const v=new d.Texture(r,{width:m[0],height:m[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const x=r.createFramebuffer(m[0],m[1],!1);return x.colorAttachment.set(v.texture),x.depthAttachment=new L(r,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const u=this._style._layers[r],m=u.isHidden(this.painter.transform.zoom),v=u.getCrossfadeParameters(),x=!!v&&1!==v.t,M=u.hasTransition();return"custom"!==u.type&&!m&&(x||M)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof Q){r=!0;break}if(r)for(let u=0;u<this._style.order.length;++u){const m=this._style._layers[this._style.order[u]],v=m.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(m);if("raster"!==m.type||v||!x)continue;const M=m.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const T=this.proxyToSource[A.key][x.id];if(T)for(const D of T){const O=as(x.getTile(D),x.findLoadedParent(D,0),x,this.painter.transform,M);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(x.id,D)}}}}_setupDrapedRenderBatches(){const r=this._style.order,u=r.length;if(0===u)return;const m=[];let v,x=0,M=this._style._layers[r[x]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++x<u;)M=this._style._layers[r[x]];for(;x<u;++x){const A=this._style._layers[r[x]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===v&&(v=x):void 0!==v&&(m.push({start:v,end:x-1}),v=void 0))}void 0!==v&&m.push({start:v,end:x-1}),this._drapedRenderBatches=m}_setupRenderCache(r){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const M=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let A=0;A<M.length;++A){const T=Object.values(M[A]);u.renderCachePool.push(...T)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let M=m.length-1;M>=0;M--){const A=m[M];if(u.getTileByID(A.key),void 0!==u.proxyCachedFBO[A.key]){const T=r[A.key],D=this.proxyToSource[A.key];let O=0;for(const R in D){const V=D[R],H=T[R];if(!H||H.length!==V.length||V.some((j,q)=>j!==H[q]||v[R]&&v[R].hasOwnProperty(j.key))){O=-1;break}++O}for(const R in u.proxyCachedFBO[A.key])u.renderCache[u.proxyCachedFBO[A.key][R]].dirty=O<0||O!==Object.values(T).length}}const x=[...this._drapedRenderBatches];x.sort((M,A)=>A.end-A.start-(M.end-M.start));for(const M of x)for(const A of m){if(u.proxyCachedFBO[A.key])continue;let T=u.renderCachePool.pop();void 0===T&&u.renderCache.length<50&&(T=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==T&&(u.proxyCachedFBO[A.key]={},u.proxyCachedFBO[A.key][M.start]=T,u.renderCache[T].dirty=!0)}this._tilesDirty={}}_setupStencil(r,u,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,M=x.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let A;if(m.isTileClipped())A=u.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(r,u){const m=this.painter,v=this.painter.context,x=v.gl;m._tileClippingMaskIDs={},v.setColorMode(d.ColorMode.disabled),v.setDepthMode(d.DepthMode.disabled);const M=m.useProgram("clippingMask");for(const A of r){const T=m._tileClippingMaskIDs[A.key]=--u;M.draw(v,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},T,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,vu(A.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(r){const u=this.painter.transform;if(r.x<0||r.x>u.width||r.y<0||r.y>u.height)return null;const m=[r.x,r.y,1,1];d.transformMat4$1(m,m,u.pixelMatrixInverse),d.scale$1(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const v=u._camera.position,x=d.mercatorZfromAltitude(1,u.center.lat),M=[v[0],v[1],v[2]/x,0],A=d.subtract([],m.slice(0,3),M);d.normalize(A,A);const T=this.raycast(M,A,this._exaggeration);return null!==T&&T?(d.scaleAndAdd(M,M,A,T),M[3]=M[2],M[2]*=x,M):null}drawDepth(){const r=this.painter,u=r.context,m=this.proxySourceCache,v=Math.ceil(r.width),x=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=u.gl,A=u.createFramebuffer(v,x,!0);u.activeTexture.set(M.TEXTURE0);const T=new d.Texture(u,{width:v,height:x,data:null},M.RGBA);T.bind(M.NEAREST,M.CLAMP_TO_EDGE),A.colorAttachment.set(T.texture);const D=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,x);A.depthAttachment.set(D),this._depthFBO=A,this._depthTexture=T}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,x]),function(M,A,T,D){if("globe"===M.transform.projection.name)return;const O=M.context,R=O.gl;O.clear({depth:1});const V=M.useProgram("terrainDepth"),H=new d.DepthMode(R.LESS,d.DepthMode.ReadWrite,M.depthRangeFor3D);for(const j of D){const q=T.getTile(j),Z=ac(j.projMatrix,0);A.setupElevationDraw(q,V),V.draw(O,R.TRIANGLES,H,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,Z,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(r,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,u,m){if(r.getSource()instanceof pt)return this._setupProxiedCoordsForImageSource(r,u,m);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const v=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let A=0;A<x.length;A++){const T=x[A],D=this._findTileCoveringTileID(T,r);if(D){const O=this._createProxiedId(T,D,m[T.key]&&m[T.key][r.id]);v.push(O),this.proxyToSource[T.key][r.id]=[O]}}let M=!1;for(let A=0;A<u.length;A++){const T=r.getTile(u[A]);if(!T||!T.hasData())continue;const D=this._findTileCoveringTileID(T.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==T.tileID.canonical.z){const O=this.proxyToSource[D.tileID.key][r.id],R=this._createProxiedId(D.tileID,T,m[D.tileID.key]&&m[D.tileID.key][r.id]);O?O.splice(O.length-1,0,R):this.proxyToSource[D.tileID.key][r.id]=[R],v.push(R),M=!0}}this._sourceTilesOverlap[r.id]=M}_setupProxiedCoordsForImageSource(r,u,m){if(!r.getSource().loaded())return;const v=this.proxiedCoords[r.id]=[],x=this.proxyCoords,M=r.getSource(),A=new d.pointGeometry(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),T=M.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((O,R)=>(O.min.x=Math.min(O.min.x,R.x-A.x),O.min.y=Math.min(O.min.y,R.y-A.y),O.max.x=Math.max(O.max.x,R.x-A.x),O.max.y=Math.max(O.max.y,R.y-A.y),O),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(O,R)=>{const V=O.wrap+O.canonical.x/(1<<O.canonical.z),H=O.canonical.y/(1<<O.canonical.z),j=d.EXTENT/(1<<O.canonical.z),q=R.wrap+R.canonical.x/(1<<R.canonical.z),Z=R.canonical.y/(1<<R.canonical.z);return V+j<q+T.min.x||V>q+T.max.x||H+j<Z+T.min.y||H>Z+T.max.y};for(let O=0;O<x.length;O++){const R=x[O];for(let V=0;V<u.length;V++){const H=r.getTile(u[V]);if(!H||!H.hasData()||D(R,H.tileID))continue;const j=this._createProxiedId(R,H,m[R.key]&&m[R.key][r.id]),q=this.proxyToSource[R.key][r.id];q?q.push(j):this.proxyToSource[R.key][r.id]=[j],v.push(j)}}}_createProxiedId(r,u,m){let v=this.orthoMatrix;if(m){const x=m.find(M=>M.key===u.tileID.key);if(x)return x}if(u.tileID.key!==r.key){const x=r.canonical.z-u.tileID.canonical.z;let M,A,T;v=d.create();const D=u.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(M=d.EXTENT>>x,A=M*((u.tileID.canonical.x<<x)-r.canonical.x+D),T=M*((u.tileID.canonical.y<<x)-r.canonical.y)):(M=d.EXTENT<<-x,A=d.EXTENT*(u.tileID.canonical.x-(r.canonical.x+D<<-x)),T=d.EXTENT*(u.tileID.canonical.y-(r.canonical.y<<-x))),d.ortho(v,0,M,0,M,0,1),d.translate(v,v,[A,T,0])}return new lc(u.tileID,r.key,v)}_findTileCoveringTileID(r,u){let m=u.getTile(r);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[u.id],x=v[r.key];if(m=x?u.getTileByID(x):null,m&&m.hasData()||null===x)return m;let M=m?m.tileID:r,A=M.overscaledZ;const T=u.getSource().minzoom,D=[];if(!x){const R=u.getSource().maxzoom;if(r.canonical.z>=R){const V=r.canonical.z-R;u.getSource().reparseOverscaled?(A=Math.max(r.canonical.z+2,u.transform.tileZoom),M=new d.OverscaledTileID(A,r.wrap,R,r.canonical.x>>V,r.canonical.y>>V)):0!==V&&(A=R,M=new d.OverscaledTileID(A,r.wrap,R,r.canonical.x>>V,r.canonical.y>>V))}M.key!==r.key&&(D.push(M.key),m=u.getTile(M))}const O=R=>{D.forEach(V=>{v[V]=R}),D.length=0};for(A-=1;A>=T&&(!m||!m.hasData());A--){m&&O(m.tileID.key);const R=M.calculateScaledKey(A);if(m=u.getTileByID(R),m&&m.hasData())break;const V=v[R];if(null===V)break;void 0===V?D.push(R):m=u.getTileByID(V)}return O(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,u){let m=this._tilesDirty[r];m||(m=this._tilesDirty[r]={}),m[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(u){let m=0;const v=new d.StructArrayLayout2ui4,x=131;for(let M=1;M<129;M++){for(let A=1;A<129;A++)m=M*x+A,v.emplaceBack(m,m+1),v.emplaceBack(m,m+x),v.emplaceBack(m+1,m+x),128===M&&v.emplaceBack(m+x,m+x+1);v.emplaceBack(m+1,m+1+x)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class il{static cacheKey(r,u,m,v){let x=`${u}${v?v.cacheKey:""}`;for(const M of m)r.usedDefines.includes(M)&&(x+=`/${M}`);return x}constructor(r,u,m,v,x,M){const A=r.gl;this.program=A.createProgram();const T=function(Z){const U=[];for(let J=0;J<Z.length;J++){if(null===Z[J])continue;const $=Z[J].split(" ");U.push($.pop())}return U}(m.staticAttributes),D=v?v.getBinderAttributes():[],O=T.concat(D);let R=v?v.defines():[];R=R.concat(M.map(Z=>`#define ${Z}`));const V=R.concat(r.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(Wa):Wa,Wa,Ws,Ys.fragmentSource,bo.fragmentSource,m.fragmentSource).join("\n"),H=R.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ws,Ys.vertexSource,bo.vertexSource,Qn.vertexSource,m.vertexSource).join("\n"),j=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(j,V),A.compileShader(j),A.attachShader(this.program,j);const q=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(q,H),A.compileShader(q),A.attachShader(this.program,q),this.attributes={},this.numAttributes=O.length;for(let Z=0;Z<this.numAttributes;Z++)O[Z]&&(A.bindAttribLocation(this.program,Z,O[Z]),this.attributes[O[Z]]=Z);A.linkProgram(this.program),A.deleteShader(q),A.deleteShader(j),this.fixedUniforms=x(r),this.binderUniforms=v?v.getUniforms(r):[],-1!==M.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(Z=r),u_dem_prev:new d.Uniform1i(Z),u_dem_unpack:new d.Uniform4f(Z),u_dem_tl:new d.Uniform2f(Z),u_dem_scale:new d.Uniform1f(Z),u_dem_tl_prev:new d.Uniform2f(Z),u_dem_scale_prev:new d.Uniform1f(Z),u_dem_size:new d.Uniform1f(Z),u_dem_lerp:new d.Uniform1f(Z),u_exaggeration:new d.Uniform1f(Z),u_depth:new d.Uniform1i(Z),u_depth_size_inv:new d.Uniform2f(Z),u_meter_to_dem:new d.Uniform1f(Z),u_label_plane_matrix_inv:new d.UniformMatrix4f(Z),u_tile_tl_up:new d.Uniform3f(Z),u_tile_tr_up:new d.Uniform3f(Z),u_tile_br_up:new d.Uniform3f(Z),u_tile_bl_up:new d.Uniform3f(Z),u_tile_up_scale:new d.Uniform1f(Z)}),-1!==M.indexOf("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new d.UniformMatrix4f(Z),u_fog_range:new d.Uniform2f(Z),u_fog_color:new d.Uniform4f(Z),u_fog_horizon_blend:new d.Uniform1f(Z),u_fog_temporal_offset:new d.Uniform1f(Z),u_frustum_tl:new d.Uniform3f(Z),u_frustum_tr:new d.Uniform3f(Z),u_frustum_br:new d.Uniform3f(Z),u_frustum_bl:new d.Uniform3f(Z),u_globe_pos:new d.Uniform3f(Z),u_globe_radius:new d.Uniform1f(Z),u_globe_transition:new d.Uniform1f(Z),u_is_globe:new d.Uniform1i(Z),u_viewport:new d.Uniform2f(Z)}))(r))}var Z}setTerrainUniformValues(r,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const v in u)m[v].set(this.program,v,u[v])}}setFogUniformValues(r,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const v in u)m[v].set(this.program,v,u[v])}}draw(r,u,m,v,x,M,A,T,D,O,R,V,H,j,q){const Z=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(v),r.setColorMode(x),r.setCullFace(M);for(const J of Object.keys(this.fixedUniforms))this.fixedUniforms[J].set(this.program,J,A[J]);j&&j.setUniforms(this.program,r,this.binderUniforms,V,{zoom:H});const U={[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[u];for(const J of R.get()){const $=J.vaos||(J.vaos={});($[T]||($[T]=new Ja)).bind(r,this,D,j?j.getPaintVertexBuffers():[],O,J.vertexOffset,q||[]),Z.drawElements(u,J.primitiveLength*U,Z.UNSIGNED_SHORT,J.primitiveOffset*U*2)}}}function Rh(p,r,u){const m=1/$n(u,1,r.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),x=u.tileSize*Math.pow(2,r.transform.tileZoom)/v,M=x*(u.tileID.canonical.x+u.tileID.wrap*v),A=x*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[m,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[M>>16,A>>16],u_pixel_coord_lower:[65535&M,65535&A]}}const nl=d.create(),Xs=(p,r,u,m,v,x,M,A,T,D,O)=>{const R=r.style.light,V=R.properties.get("position"),H=[V.x,V.y,V.z],j=d.create$1();"viewport"===R.properties.get("anchor")&&(d.fromRotation(j,-r.transform.angle),d.transformMat3(H,H,j));const q=R.properties.get("color"),Z=r.transform,U={u_matrix:p,u_lightpos:H,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nl,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:x};return"globe"===Z.projection.name&&(U.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],U.u_zoom_transition=T,U.u_inv_rot_matrix=O,U.u_merc_center=D,U.u_up_dir=Z.projection.upVector(new d.CanonicalTileID(0,0,0),D[0]*d.EXTENT,D[1]*d.EXTENT),U.u_height_lift=A),U},le=(p,r,u,m,v,x,M,A,T,D,O,R,V)=>{const H=Xs(p,r,u,m,v,x,M,D,O,R,V),j={u_height_factor:-Math.pow(2,M.overscaledZ)/T.tileSize/8};return d.extend(H,Rh(A,r,T),j)},ls=p=>({u_matrix:p}),Un=(p,r,u,m)=>d.extend(ls(p),Rh(u,r,m)),hi=(p,r)=>({u_matrix:p,u_world:r}),Co=(p,r,u,m,v)=>d.extend(Un(p,r,u,m),{u_world:v}),bu=d.create(),uc=(p,r,u,m,v,x)=>{const M=p.transform,A="globe"===M.projection.name;let T;if("map"===x.paint.get("circle-pitch-alignment"))if(A){const O=d.globePixelsToTileUnits(M.zoom,r.canonical)*M._pixelsPerMercatorPixel;T=Float32Array.from([O,0,0,O])}else T=M.calculatePixelsToTileUnitsMatrix(u);else T=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:p.translatePosMatrix(r.projMatrix,u,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=m,D.u_merc_center=v,D.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],D.u_zoom_transition=d.globeToMercatorTransition(M.zoom);const O=v[0]*d.EXTENT,R=v[1]*d.EXTENT;D.u_up_dir=M.projection.upVector(new d.CanonicalTileID(0,0,0),O,R)}return D},hc=p=>{const r=[];return"map"===p.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},Js=(p,r,u,m)=>{const v=d.EXTENT/u.tileSize;return{u_matrix:p,u_camera_to_center_distance:r.getCameraToCenterDistance(m),u_extrude_scale:[r.pixelsToGLUnits[0]/v,r.pixelsToGLUnits[1]/v]}},Gr=(p,r,u=1)=>({u_matrix:p,u_color:r,u_overlay:0,u_overlay_scale:u}),rl=d.create(),dc=(p,r,u,m,v,x,M)=>{const A=p.transform,T="globe"===A.projection.name,D=T?d.globePixelsToTileUnits(A.zoom,r.canonical)*A._pixelsPerMercatorPixel:$n(u,1,x),O={u_matrix:r.projMatrix,u_extrude_scale:D,u_intensity:M,u_inv_rot_matrix:rl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){O.u_inv_rot_matrix=m,O.u_merc_center=v,O.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],O.u_zoom_transition=d.globeToMercatorTransition(A.zoom);const R=v[0]*d.EXTENT,V=v[1]*d.EXTENT;O.u_up_dir=A.projection.upVector(new d.CanonicalTileID(0,0,0),R,V)}return O},un=(p,r,u,m,v,x,M,A)=>{const T=p.transform,D=T.calculatePixelsToTileUnitsMatrix(r),O={u_matrix:pc(p,r,u,v),u_pixels_to_tile_units:D,u_device_pixel_ratio:M,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:A};if(us(u)){const R=cs(r,p.transform);O.u_texsize=r.lineAtlasTexture.size,O.u_scale=[R,m.fromScale,m.toScale],O.u_mix=m.t}return O},Mo=(p,r,u,m,v,x)=>{const M=p.transform,A=cs(r,M);return{u_matrix:pc(p,r,u,v),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:x,u_image:0,u_scale:[A,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function cs(p,r){return 1/$n(p,1,r.tileZoom)}function pc(p,r,u,m){return p.translatePosMatrix(m||r.tileID.projMatrix,r,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function us(p){const r=p.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const wu=(p,r,u,m,v,x)=>{return{u_matrix:p,u_tl_parent:r,u_scale_parent:u,u_fade_t:m.mix,u_opacity:m.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(A=v.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(M=v.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:ol(v.paint.get("raster-hue-rotate")),u_perspective_transform:x};var M,A};function ol(p){p*=Math.PI/180;const r=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*r-u+1)/3,(Math.sqrt(3)*r-u+1)/3]}const Cu=d.create(),fc=(p,r,u,m,v,x,M,A,T,D,O,R,V,H,j,q)=>{const Z=v.transform,U={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:Z.width/Z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:M,u_coord_matrix:A,u_is_text:+T,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Cu,u_up_vector:[0,-1,0]};return"globe"===q.name&&(U.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],U.u_zoom_transition=R,U.u_inv_rot_matrix=H,U.u_merc_center=V,U.u_camera_forward=Z._camera.forward(),U.u_ecef_origin=d.globeECEFOrigin(Z.globeMatrix,O.toUnwrapped()),U.u_tile_matrix=Float32Array.from(Z.globeMatrix),U.u_up_vector=j),U},mc=(p,r,u,m,v,x,M,A,T,D,O,R,V,H,j,q,Z)=>d.extend(fc(p,r,u,m,v,x,M,A,T,D,R,V,H,j,q,Z),{u_gamma_scale:m?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+O}),ii=(p,r,u,m,v,x,M,A,T,D,O,R,V,H,j,q)=>d.extend(mc(p,r,u,m,v,x,M,A,!0,T,!0,O,R,V,H,j,q),{u_texsize_icon:D,u_texture_icon:1}),zh=(p,r,u)=>({u_matrix:p,u_opacity:r,u_color:u}),Mu=(p,r,u,m,v,x)=>d.extend(function(M,A,T,D){const O=T.imageManager.getPattern(M.from.toString()),R=T.imageManager.getPattern(M.to.toString()),{width:V,height:H}=T.imageManager.getPixelSize(),j=Math.pow(2,D.tileID.overscaledZ),q=D.tileSize*Math.pow(2,T.transform.tileZoom)/j,Z=q*(D.tileID.canonical.x+D.tileID.wrap*j),U=q*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[V,H],u_mix:A.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/$n(D,1,T.transform.tileZoom),u_pixel_coord_upper:[Z>>16,U>>16],u_pixel_coord_lower:[65535&Z,65535&U]}}(m,x,u,v),{u_matrix:p,u_opacity:r}),Au={fillExtrusion:p=>({u_matrix:new d.UniformMatrix4f(p),u_lightpos:new d.Uniform3f(p),u_lightintensity:new d.Uniform1f(p),u_lightcolor:new d.Uniform3f(p),u_vertical_gradient:new d.Uniform1f(p),u_opacity:new d.Uniform1f(p),u_edge_radius:new d.Uniform1f(p),u_ao:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_up_dir:new d.Uniform3f(p),u_height_lift:new d.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_lightpos:new d.Uniform3f(p),u_lightintensity:new d.Uniform1f(p),u_lightcolor:new d.Uniform3f(p),u_vertical_gradient:new d.Uniform1f(p),u_height_factor:new d.Uniform1f(p),u_edge_radius:new d.Uniform1f(p),u_ao:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_up_dir:new d.Uniform3f(p),u_height_lift:new d.Uniform1f(p),u_image:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_pixel_coord_upper:new d.Uniform2f(p),u_pixel_coord_lower:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_fade:new d.Uniform1f(p),u_opacity:new d.Uniform1f(p)}),fill:p=>({u_matrix:new d.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_image:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_pixel_coord_upper:new d.Uniform2f(p),u_pixel_coord_lower:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_fade:new d.Uniform1f(p)}),fillOutline:p=>({u_matrix:new d.UniformMatrix4f(p),u_world:new d.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_world:new d.Uniform2f(p),u_image:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_pixel_coord_upper:new d.Uniform2f(p),u_pixel_coord_lower:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_fade:new d.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new d.Uniform1f(p),u_extrude_scale:new d.UniformMatrix2f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_up_dir:new d.Uniform3f(p)}),collisionBox:p=>({u_matrix:new d.UniformMatrix4f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_extrude_scale:new d.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new d.UniformMatrix4f(p),u_inv_matrix:new d.UniformMatrix4f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_viewport_size:new d.Uniform2f(p)}),debug:p=>({u_color:new d.UniformColor(p),u_matrix:new d.UniformMatrix4f(p),u_overlay:new d.Uniform1i(p),u_overlay_scale:new d.Uniform1f(p)}),clippingMask:p=>({u_matrix:new d.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new d.Uniform1f(p),u_intensity:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_up_dir:new d.Uniform3f(p)}),heatmapTexture:p=>({u_image:new d.Uniform1i(p),u_color_ramp:new d.Uniform1i(p),u_opacity:new d.Uniform1f(p)}),hillshade:p=>({u_matrix:new d.UniformMatrix4f(p),u_image:new d.Uniform1i(p),u_latrange:new d.Uniform2f(p),u_light:new d.Uniform2f(p),u_shadow:new d.UniformColor(p),u_highlight:new d.UniformColor(p),u_accent:new d.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new d.UniformMatrix4f(p),u_image:new d.Uniform1i(p),u_dimension:new d.Uniform2f(p),u_zoom:new d.Uniform1f(p),u_unpack:new d.Uniform4f(p)}),line:p=>({u_matrix:new d.UniformMatrix4f(p),u_pixels_to_tile_units:new d.UniformMatrix2f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_units_to_pixels:new d.Uniform2f(p),u_dash_image:new d.Uniform1i(p),u_gradient_image:new d.Uniform1i(p),u_image_height:new d.Uniform1f(p),u_texsize:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_mix:new d.Uniform1f(p),u_alpha_discard_threshold:new d.Uniform1f(p),u_trim_offset:new d.Uniform2f(p)}),linePattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_texsize:new d.Uniform2f(p),u_pixels_to_tile_units:new d.UniformMatrix2f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_image:new d.Uniform1i(p),u_units_to_pixels:new d.Uniform2f(p),u_scale:new d.Uniform3f(p),u_fade:new d.Uniform1f(p),u_alpha_discard_threshold:new d.Uniform1f(p)}),raster:p=>({u_matrix:new d.UniformMatrix4f(p),u_tl_parent:new d.Uniform2f(p),u_scale_parent:new d.Uniform1f(p),u_fade_t:new d.Uniform1f(p),u_opacity:new d.Uniform1f(p),u_image0:new d.Uniform1i(p),u_image1:new d.Uniform1i(p),u_brightness_low:new d.Uniform1f(p),u_brightness_high:new d.Uniform1f(p),u_saturation_factor:new d.Uniform1f(p),u_contrast_factor:new d.Uniform1f(p),u_spin_weights:new d.Uniform3f(p),u_perspective_transform:new d.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new d.Uniform1i(p),u_is_size_feature_constant:new d.Uniform1i(p),u_size_t:new d.Uniform1f(p),u_size:new d.Uniform1f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_rotate_symbol:new d.Uniform1i(p),u_aspect_ratio:new d.Uniform1f(p),u_fade_change:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_label_plane_matrix:new d.UniformMatrix4f(p),u_coord_matrix:new d.UniformMatrix4f(p),u_is_text:new d.Uniform1i(p),u_pitch_with_map:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_camera_forward:new d.Uniform3f(p),u_tile_matrix:new d.UniformMatrix4f(p),u_up_vector:new d.Uniform3f(p),u_ecef_origin:new d.Uniform3f(p),u_texture:new d.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new d.Uniform1i(p),u_is_size_feature_constant:new d.Uniform1i(p),u_size_t:new d.Uniform1f(p),u_size:new d.Uniform1f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_rotate_symbol:new d.Uniform1i(p),u_aspect_ratio:new d.Uniform1f(p),u_fade_change:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_label_plane_matrix:new d.UniformMatrix4f(p),u_coord_matrix:new d.UniformMatrix4f(p),u_is_text:new d.Uniform1i(p),u_pitch_with_map:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_texture:new d.Uniform1i(p),u_gamma_scale:new d.Uniform1f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_tile_id:new d.Uniform3f(p),u_zoom_transition:new d.Uniform1f(p),u_inv_rot_matrix:new d.UniformMatrix4f(p),u_merc_center:new d.Uniform2f(p),u_camera_forward:new d.Uniform3f(p),u_tile_matrix:new d.UniformMatrix4f(p),u_up_vector:new d.Uniform3f(p),u_ecef_origin:new d.Uniform3f(p),u_is_halo:new d.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new d.Uniform1i(p),u_is_size_feature_constant:new d.Uniform1i(p),u_size_t:new d.Uniform1f(p),u_size:new d.Uniform1f(p),u_camera_to_center_distance:new d.Uniform1f(p),u_rotate_symbol:new d.Uniform1i(p),u_aspect_ratio:new d.Uniform1f(p),u_fade_change:new d.Uniform1f(p),u_matrix:new d.UniformMatrix4f(p),u_label_plane_matrix:new d.UniformMatrix4f(p),u_coord_matrix:new d.UniformMatrix4f(p),u_is_text:new d.Uniform1i(p),u_pitch_with_map:new d.Uniform1i(p),u_texsize:new d.Uniform2f(p),u_texsize_icon:new d.Uniform2f(p),u_texture:new d.Uniform1i(p),u_texture_icon:new d.Uniform1i(p),u_gamma_scale:new d.Uniform1f(p),u_device_pixel_ratio:new d.Uniform1f(p),u_is_halo:new d.Uniform1i(p)}),background:p=>({u_matrix:new d.UniformMatrix4f(p),u_opacity:new d.Uniform1f(p),u_color:new d.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new d.UniformMatrix4f(p),u_opacity:new d.Uniform1f(p),u_image:new d.Uniform1i(p),u_pattern_tl_a:new d.Uniform2f(p),u_pattern_br_a:new d.Uniform2f(p),u_pattern_tl_b:new d.Uniform2f(p),u_pattern_br_b:new d.Uniform2f(p),u_texsize:new d.Uniform2f(p),u_mix:new d.Uniform1f(p),u_pattern_size_a:new d.Uniform2f(p),u_pattern_size_b:new d.Uniform2f(p),u_scale_a:new d.Uniform1f(p),u_scale_b:new d.Uniform1f(p),u_pixel_coord_upper:new d.Uniform2f(p),u_pixel_coord_lower:new d.Uniform2f(p),u_tile_units_to_pixels:new d.Uniform1f(p)}),terrainRaster:ss,terrainDepth:ss,skybox:p=>({u_matrix:new d.UniformMatrix4f(p),u_sun_direction:new d.Uniform3f(p),u_cubemap:new d.Uniform1i(p),u_opacity:new d.Uniform1f(p),u_temporal_offset:new d.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new d.UniformMatrix4f(p),u_color_ramp:new d.Uniform1i(p),u_center_direction:new d.Uniform3f(p),u_radius:new d.Uniform1f(p),u_opacity:new d.Uniform1f(p),u_temporal_offset:new d.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new d.UniformMatrix3f(p),u_sun_direction:new d.Uniform3f(p),u_sun_intensity:new d.Uniform1f(p),u_color_tint_r:new d.Uniform4f(p),u_color_tint_m:new d.Uniform4f(p),u_luminance:new d.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new d.UniformMatrix4f(p),u_globe_matrix:new d.UniformMatrix4f(p),u_normalize_matrix:new d.UniformMatrix4f(p),u_merc_matrix:new d.UniformMatrix4f(p),u_zoom_transition:new d.Uniform1f(p),u_merc_center:new d.Uniform2f(p),u_image0:new d.Uniform1i(p),u_grid_matrix:new d.UniformMatrix3f(p),u_frustum_tl:new d.Uniform3f(p),u_frustum_tr:new d.Uniform3f(p),u_frustum_br:new d.Uniform3f(p),u_frustum_bl:new d.Uniform3f(p),u_globe_pos:new d.Uniform3f(p),u_globe_radius:new d.Uniform1f(p),u_viewport:new d.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new d.Uniform3f(p),u_frustum_tr:new d.Uniform3f(p),u_frustum_br:new d.Uniform3f(p),u_frustum_bl:new d.Uniform3f(p),u_horizon:new d.Uniform1f(p),u_transition:new d.Uniform1f(p),u_fadeout_range:new d.Uniform1f(p),u_color:new d.Uniform4f(p),u_high_color:new d.Uniform4f(p),u_space_color:new d.Uniform4f(p),u_star_intensity:new d.Uniform1f(p),u_star_density:new d.Uniform1f(p),u_star_size:new d.Uniform1f(p),u_temporal_offset:new d.Uniform1f(p),u_horizon_angle:new d.Uniform1f(p),u_rotation_matrix:new d.UniformMatrix4f(p)})};let Ks;function gc(p,r,u,m,v,x,M){const A=p.context,T=A.gl,D=p.transform,O=p.useProgram("collisionBox"),R=[];let V=0,H=0;for(let lt=0;lt<m.length;lt++){const st=m[lt],et=r.getTile(st),at=et.getBucket(u);if(!at)continue;const rt=Qi(st,at,D);let dt=rt;0===v[0]&&0===v[1]||(dt=p.translatePosMatrix(rt,et,v,x));const yt=M?at.textCollisionBox:at.iconCollisionBox,Lt=at.collisionCircleArray;if(Lt.length>0){const gt=d.create(),At=dt;d.mul(gt,at.placementInvProjMatrix,D.glCoordMatrix),d.mul(gt,gt,at.placementViewportMatrix),R.push({circleArray:Lt,circleOffset:H,transform:At,invTransform:gt,projection:at.getProjection()}),V+=Lt.length/4,H=V}yt&&(p.terrain&&p.terrain.setupElevationDraw(et,O),O.draw(A,T.LINES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,Js(dt,D,et,at.getProjection()),u.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,null,D.zoom,null,[yt.collisionVertexBuffer,yt.collisionVertexBufferExt]))}if(!M||!R.length)return;const j=p.useProgram("collisionCircle"),q=new d.StructArrayLayout2f1f2i16;q.resize(4*V),q._trim();let Z=0;for(const lt of R)for(let st=0;st<lt.circleArray.length/4;st++){const et=4*st,at=lt.circleArray[et+0],rt=lt.circleArray[et+1],dt=lt.circleArray[et+2],yt=lt.circleArray[et+3];q.emplace(Z++,at,rt,dt,yt,0),q.emplace(Z++,at,rt,dt,yt,1),q.emplace(Z++,at,rt,dt,yt,2),q.emplace(Z++,at,rt,dt,yt,3)}(!Ks||Ks.length<2*V)&&(Ks=function(lt){const st=2*lt,et=new d.StructArrayLayout3ui6;et.resize(st),et._trim();for(let at=0;at<st;at++){const rt=6*at;et.uint16[rt+0]=4*at+0,et.uint16[rt+1]=4*at+1,et.uint16[rt+2]=4*at+2,et.uint16[rt+3]=4*at+2,et.uint16[rt+4]=4*at+3,et.uint16[rt+5]=4*at+0}return et}(V));const U=A.createIndexBuffer(Ks,!0),J=A.createVertexBuffer(q,d.collisionCircleLayout.members,!0);for(const lt of R){const st={u_matrix:lt.transform,u_inv_matrix:lt.invTransform,u_camera_to_center_distance:($=D).getCameraToCenterDistance(lt.projection),u_viewport_size:[$.width,$.height]};j.draw(A,T.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,st,u.id,J,U,d.SegmentVector.simpleSegment(0,2*lt.circleOffset,lt.circleArray.length,lt.circleArray.length/2),null,D.zoom)}var $;J.destroy(),U.destroy()}const _c=d.create();function sl(p,r,u,m,v,x){const{horizontalAlign:M,verticalAlign:A}=d.getAnchorAlignment(p),T=-(M-.5)*r,D=-(A-.5)*u,O=d.evaluateVariableOffset(p,m);return new d.pointGeometry((T/v+O[0])*x,(D/v+O[1])*x)}function jn(p,r,u,m,v,x,M,A,T,D,O){const R=p.text.placedSymbolArray,V=p.text.dynamicLayoutVertexArray,H=p.icon.dynamicLayoutVertexArray,j={},q=cn(A,p.getProjection(),x),Z=x.elevation,U=p.getProjection().upVectorScale(A.canonical,x.center.lat,x.worldSize);V.clear();for(let J=0;J<R.length;J++){const $=R.get(J),lt=p.allowVerticalPlacement&&!$.placedOrientation,st=$.hidden||!$.crossTileID||lt?null:m[$.crossTileID];if(st){const et=new d.pointGeometry($.tileAnchorX,$.tileAnchorY),at=p.getProjection().upVector(A.canonical,et.x,et.y),rt=Z?Z.getAtTileOffset(A,et.x,et.y):0,dt=xe([$.projectedAnchorX+rt*at[0]*U.metersToTile,$.projectedAnchorY+rt*at[1]*U.metersToTile,$.projectedAnchorZ+rt*at[2]*U.metersToTile],u?q:M),yt=Ba(x.getCameraToCenterDistance(p.getProjection()),dt.signedDistanceFromCamera);let Lt=v.evaluateSizeForFeature(p.textSizeData,D,$)*yt/d.ONE_EM;u&&(Lt*=p.tilePixelRatio/T);const{width:gt,height:At,anchor:kt,textOffset:Gt,textScale:wt}=st,zt=sl(kt,gt,At,Gt,wt,Lt);let Et;if(u){const Ut=et.add(zt),{x:Qt,y:ie,z:se}=p.getProjection().projectTilePoint(Ut.x,Ut.y,A.canonical);Et=xe([Qt+rt*at[0]*U.metersToTile,ie+rt*at[1]*U.metersToTile,se+rt*at[2]*U.metersToTile],M).point}else{const Ut=r?zt.rotate(-x.angle):zt;Et=[dt.point[0]+Ut.x,dt.point[1]+Ut.y,0]}const Zt=p.allowVerticalPlacement&&$.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let Ut=0;Ut<$.numGlyphs;Ut++)d.addDynamicAttributes(V,Et[0],Et[1],Et[2],Zt);O&&$.associatedIconIndex>=0&&(j[$.associatedIconIndex]={shiftedAnchor:Et,angle:Zt})}else _o($.numGlyphs,V)}if(O){H.clear();const J=p.icon.placedSymbolArray;for(let $=0;$<J.length;$++){const lt=J.get($);if(lt.hidden)_o(lt.numGlyphs,H);else{const st=j[$];if(st)for(let et=0;et<lt.numGlyphs;et++)d.addDynamicAttributes(H,st.shiftedAnchor[0],st.shiftedAnchor[1],st.shiftedAnchor[2],st.angle);else _o(lt.numGlyphs,H)}}p.icon.dynamicLayoutVertexBuffer.updateData(H)}p.text.dynamicLayoutVertexBuffer.updateData(V)}function Su(p,r,u){return u.iconsInText&&r?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function yc(p,r,u,m,v,x,M,A,T,D,O,R){const V=p.context,H=V.gl,j=p.transform,q="map"===A,Z="map"===T,U=q&&"point"!==u.layout.get("symbol-placement"),J=q&&!Z&&!U,$=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let lt=!1;const st=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),et=[d.mercatorXfromLng(j.center.lng),d.mercatorYfromLat(j.center.lat)],at=u.layout.get("text-variable-anchor"),rt="globe"===j.projection.name,dt=[],yt=[0,-1,0];let Lt=yt;!rt&&!j.mercatorFromTransition||q||(Lt=function(gt){const At=gt._camera.getWorldToCamera(gt.worldSize,1),kt=d.multiply([],At,gt.globeMatrix);d.invert(kt,kt);const Gt=[0,0,0],wt=[0,1,0,0];return d.transformMat4$1(wt,wt,kt),Gt[0]=wt[0],Gt[1]=wt[1],Gt[2]=wt[2],d.normalize(Gt,Gt),Gt}(j));for(const gt of m){const At=r.getTile(gt),kt=At.getBucket(u);if(!kt||"mercator"===kt.projection.name&&rt)continue;const Gt=v?kt.text:kt.icon;if(!Gt||kt.fullyClipped||!Gt.segments.get().length)continue;const wt=Gt.programConfigurations.get(u.id),zt=v||kt.sdfIcons,Et=v?kt.textSizeData:kt.iconSizeData,Zt=Z||0!==j.pitch,Ut=d.evaluateSizeForZoom(Et,j.zoom);let Qt,ie,se,Te,Kt=[0,0],me=null;if(v){if(ie=At.glyphAtlasTexture,se=H.LINEAR,Qt=At.glyphAtlasTexture.size,kt.iconsInText){Kt=At.imageAtlasTexture.size,me=At.imageAtlasTexture;const nn="composite"===Et.kind||"camera"===Et.kind;Te=Zt||p.options.rotating||p.options.zooming||nn?H.LINEAR:H.NEAREST}}else{const nn=1!==u.layout.get("icon-size").constantOr(0)||kt.iconsNeedLinear;ie=At.imageAtlasTexture,se=zt||p.options.rotating||p.options.zooming||nn||Zt?H.LINEAR:H.NEAREST,Qt=At.imageAtlasTexture.size}const ze="globe"===kt.projection.name,ai=ze?Lt:yt,vi=ze?d.globeToMercatorTransition(j.zoom):0,$e=cn(gt,kt.getProjection(),j),ji=j.calculatePixelsToTileUnitsMatrix(At),ir=we($e,At.tileID.canonical,Z,q,j,kt.getProjection(),ji),nr=p.terrain&&Z&&U?d.invert(d.create(),ir):_c,ni=Tn($e,At.tileID.canonical,Z,q,j,kt.getProjection(),ji),di=at&&kt.hasTextData(),Me="none"!==u.layout.get("icon-text-fit")&&di&&kt.hasIconData();if(U){const nn=j.elevation,Fo=nn?nn.getAtTileOffsetFunc(gt,j.center.lat,j.worldSize,kt.getProjection()):ma=>[0,0,0],Yr=Se($e,At.tileID.canonical,Z,q,j,kt.getProjection(),ji);_r(kt,$e,p,v,Yr,ni,Z,D,Fo,gt)}const Si=U||v&&at||Me,$i=p.translatePosMatrix($e,At,x,M),Ke=Si?_c:ir,tn=p.translatePosMatrix(ni,At,x,M,!0),Io=kt.getProjection().createInversionMatrix(j,gt.canonical),en=[];p.terrain&&Z&&en.push("PITCH_WITH_MAP_TERRAIN"),ze&&en.push("PROJECTION_GLOBE_VIEW"),Si&&en.push("PROJECTED_POS_ON_VIEWPORT");const Hr=zt&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let $r;$r=zt?kt.iconsInText?ii(Et.kind,Ut,J,Z,p,$i,Ke,tn,Qt,Kt,gt,vi,et,Io,ai,kt.getProjection()):mc(Et.kind,Ut,J,Z,p,$i,Ke,tn,v,Qt,!0,gt,vi,et,Io,ai,kt.getProjection()):fc(Et.kind,Ut,J,Z,p,$i,Ke,tn,v,Qt,gt,vi,et,Io,ai,kt.getProjection());const Oo={program:p.useProgram(Su(zt,v,kt),wt,en),buffers:Gt,uniformValues:$r,atlasTexture:ie,atlasTextureIcon:me,atlasInterpolation:se,atlasInterpolationIcon:Te,isSDF:zt,hasHalo:Hr,tile:At,labelPlaneMatrixInv:nr};if($&&kt.canOverlap){lt=!0;const nn=Gt.segments.get();for(const Fo of nn)dt.push({segments:new d.SegmentVector([Fo]),sortKey:Fo.sortKey,state:Oo})}else dt.push({segments:Gt.segments,sortKey:0,state:Oo})}lt&&dt.sort((gt,At)=>gt.sortKey-At.sortKey);for(const gt of dt){const At=gt.state;if(p.terrain&&p.terrain.setupElevationDraw(At.tile,At.program,{useDepthForOcclusion:!rt,labelPlaneMatrixInv:At.labelPlaneMatrixInv}),V.activeTexture.set(H.TEXTURE0),At.atlasTexture.bind(At.atlasInterpolation,H.CLAMP_TO_EDGE),At.atlasTextureIcon&&(V.activeTexture.set(H.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),At.isSDF){const kt=At.uniformValues;At.hasHalo&&(kt.u_is_halo=1,vc(At.buffers,gt.segments,u,p,At.program,st,O,R,kt)),kt.u_is_halo=0}vc(At.buffers,gt.segments,u,p,At.program,st,O,R,At.uniformValues)}}function vc(p,r,u,m,v,x,M,A,T){const D=m.context,O=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];v.draw(D,D.gl.TRIANGLES,x,M,A,d.CullFaceMode.disabled,T,u.id,p.layoutVertexBuffer,p.indexBuffer,r,u.paint,m.transform.zoom,p.programConfigurations.get(u.id),O)}function al(p,r,u,m,v,x,M){const A=p.context.gl,T=u.paint.get("fill-pattern"),D=T&&T.constantOr(1),O=u.getCrossfadeParameters();let R,V,H,j,q;M?(V=D&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=A.LINES):(V=D?"fillPattern":"fill",R=A.TRIANGLES);for(const Z of m){const U=r.getTile(Z);if(D&&!U.patternsLoaded())continue;const J=U.getBucket(u);if(!J)continue;p.prepareDrawTile();const $=J.programConfigurations.get(u.id),lt=p.useProgram(V,$);D&&(p.context.activeTexture.set(A.TEXTURE0),U.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),$.updatePaintBuffers(O));const st=T.constantOr(null);if(st&&U.imageAtlas){const at=U.imageAtlas,rt=at.patternPositions[st.to.toString()],dt=at.patternPositions[st.from.toString()];rt&&dt&&$.setConstantPatternPositions(rt,dt)}const et=p.translatePosMatrix(Z.projMatrix,U,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(M){j=J.indexBuffer2,q=J.segments2;const at=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];H="fillOutlinePattern"===V&&D?Co(et,p,O,U,at):hi(et,at)}else j=J.indexBuffer,q=J.segments,H=D?Un(et,p,O,U):ls(et);p.prepareDrawProgram(p.context,lt,Z.toUnwrapped()),lt.draw(p.context,R,v,p.stencilModeForClipping(Z),x,d.CullFaceMode.disabled,H,u.id,J.layoutVertexBuffer,j,q,u.paint,p.transform.zoom,$)}}function br(p,r,u,m,v,x,M){const A=p.context,T=A.gl,D=p.transform,O=u.paint.get("fill-extrusion-pattern"),R=O.constantOr(1),V=u.getCrossfadeParameters(),H=u.paint.get("fill-extrusion-opacity"),j=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],q=u.layout.get("fill-extrusion-edge-radius"),Z="globe"===D.projection.name?d.fillExtrusionHeightLift():0,U="globe"===D.projection.name,J=U?d.globeToMercatorTransition(D.zoom):0,$=[d.mercatorXfromLng(D.center.lng),d.mercatorYfromLat(D.center.lat)],lt=[];U&&(lt.push("PROJECTION_GLOBE_VIEW"),p.style.terrainSetForDrapingOnly()&&lt.push("TERRAIN")),j[0]>0&&lt.push("FAUX_AO");for(const st of m){const et=r.getTile(st),at=et.getBucket(u);if(!at||at.projection.name!==D.projection.name)continue;const rt=at.programConfigurations.get(u.id),dt=p.useProgram(R?"fillExtrusionPattern":"fillExtrusion",rt,lt);if(p.terrain){const wt=p.terrain;if(p.style.terrainSetForDrapingOnly())wt.setupElevationDraw(et,dt,{useMeterToDem:!0});else{if(!at.enableTerrain)continue;if(wt.setupElevationDraw(et,dt,{useMeterToDem:!0}),Qs(A,r,st,at,u,wt),!at.centroidVertexBuffer){const zt=dt.attributes.a_centroid_pos;void 0!==zt&&T.vertexAttrib2f(zt,0,0)}}}R&&(p.context.activeTexture.set(T.TEXTURE0),et.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),rt.updatePaintBuffers(V));const yt=O.constantOr(null);if(yt&&et.imageAtlas){const wt=et.imageAtlas,zt=wt.patternPositions[yt.to.toString()],Et=wt.patternPositions[yt.from.toString()];zt&&Et&&rt.setConstantPatternPositions(zt,Et)}const Lt=p.translatePosMatrix(st.projMatrix,et,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),gt=D.projection.createInversionMatrix(D,st.canonical),At=u.paint.get("fill-extrusion-vertical-gradient"),kt=R?le(Lt,p,At,H,j,q,st,V,et,Z,J,$,gt):Xs(Lt,p,At,H,j,q,st,Z,J,$,gt);p.prepareDrawProgram(A,dt,st.toUnwrapped());const Gt=[];p.terrain&&Gt.push(at.centroidVertexBuffer),U&&Gt.push(at.layoutVertexExtBuffer),dt.draw(A,A.gl.TRIANGLES,v,x,M,d.CullFaceMode.backCCW,kt,u.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,u.paint,p.transform.zoom,rt,Gt)}}function Qs(p,r,u,m,v,x){const M=[U=>{let J=U.canonical.x-1,$=U.wrap;return J<0&&(J=(1<<U.canonical.z)-1,$--),new d.OverscaledTileID(U.overscaledZ,$,U.canonical.z,J,U.canonical.y)},U=>{let J=U.canonical.x+1,$=U.wrap;return J===1<<U.canonical.z&&(J=0,$++),new d.OverscaledTileID(U.overscaledZ,$,U.canonical.z,J,U.canonical.y)},U=>new d.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(0===U.canonical.y?1<<U.canonical.z:U.canonical.y)-1),U=>new d.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],A=U=>{const J=r.getSource().minzoom,$=st=>{const et=r.getTileByID(st);if(et&&et.hasData())return et.getBucket(v)},lt=[0,-1,1];for(const st of lt){if(U.overscaledZ+st<J)continue;const et=$(U.calculateScaledKey(U.overscaledZ+st));if(et)return et}},T=[0,0,0],D=(U,J)=>(T[0]=Math.min(U.min.y,J.min.y),T[1]=Math.max(U.max.y,J.max.y),T[2]=d.EXTENT-J.min.x>U.max.x?J.min.x-d.EXTENT:U.max.x,T),O=(U,J)=>(T[0]=Math.min(U.min.x,J.min.x),T[1]=Math.max(U.max.x,J.max.x),T[2]=d.EXTENT-J.min.y>U.max.y?J.min.y-d.EXTENT:U.max.y,T),R=[(U,J)=>D(U,J),(U,J)=>D(J,U),(U,J)=>O(U,J),(U,J)=>O(J,U)],V=new d.pointGeometry(0,0);let H,j,q;const Z=(U,J,$,lt,st)=>{const et=[[lt?$:U,lt?U:$,0],[lt?$:J,lt?J:$,0]],at=st<0?d.EXTENT+st:st,rt=[lt?at:(U+J)/2,lt?(U+J)/2:at,0];return 0===$&&st<0||0!==$&&st>0?x.getForTilePoints(q,[rt],!0,j):et.push(rt),x.getForTilePoints(u,et,!0,H),Math.max(et[0][2],et[1][2],rt[2])/x.exaggeration()};for(let U=0;U<4;U++){const J=(U<2?1:5)-U,$=m.borders[U];if(0===$.length)continue;const lt=q=M[U](u),st=A(lt);if(!(st&&st instanceof d.FillExtrusionBucket&&st.enableTerrain)||m.borderDoneWithNeighborZ[U]===st.canonical.z&&st.borderDoneWithNeighborZ[J]===m.canonical.z||(j=x.findDEMTileFor(lt),!j||!j.dem))continue;if(!H){const dt=x.findDEMTileFor(u);if(!dt||!dt.dem)return;H=dt}const et=st.borders[J];let at=0;const rt=st.borderDoneWithNeighborZ[J]!==m.canonical.z;if(m.canonical.z===st.canonical.z){for(let dt=0;dt<$.length;dt++){const yt=m.featuresOnBorder[$[dt]],Lt=yt.borders[U];let gt;for(;at<et.length&&(gt=st.featuresOnBorder[et[at]],!(gt.borders[J][1]>Lt[0]+3));)rt&&st.encodeCentroid(void 0,gt,!1),at++;if(gt&&at<et.length){const At=at;let kt=0;for(;!(gt.borders[J][0]>Lt[1]-3)&&(kt++,++at!==et.length);)gt=st.featuresOnBorder[et[at]];if(gt=st.featuresOnBorder[et[At]],yt.intersectsCount()>1||gt.intersectsCount()>1||1!==kt){1!==kt&&(at=At),m.encodeCentroid(void 0,yt,!1),rt&&st.encodeCentroid(void 0,gt,!1);continue}const Gt=R[U](yt,gt),wt=U%2?d.EXTENT-1:0;V.x=Z(Gt[0],Math.min(d.EXTENT-1,Gt[1]),wt,U<2,Gt[2]),V.y=0,m.encodeCentroid(V,yt,!1),rt&&st.encodeCentroid(V,gt,!1)}else m.encodeCentroid(void 0,yt,!1)}m.borderDoneWithNeighborZ[U]=st.canonical.z,m.needsCentroidUpdate=!0,rt&&(st.borderDoneWithNeighborZ[J]=m.canonical.z,st.needsCentroidUpdate=!0)}else{for(const dt of $)m.encodeCentroid(void 0,m.featuresOnBorder[dt],!1);if(rt){for(const dt of et)st.encodeCentroid(void 0,st.featuresOnBorder[dt],!1);st.borderDoneWithNeighborZ[J]=m.canonical.z,st.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[U]=st.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(p)}const Tu=new d.Color(1,0,0,1),Ao=new d.Color(0,1,0,1),tr=new d.Color(0,0,1,1),Eu=new d.Color(1,0,1,1),So=new d.Color(0,1,1,1);function Le(p,r,u){const m=p.context,v=p.transform,x=m.gl,M="globe"===v.projection.name,A=M?["PROJECTION_GLOBE_VIEW"]:null;let T=u.projMatrix;if(M&&d.globeToMercatorTransition(v.zoom)>0){const yt=d.transitionTileAABBinECEF(u.canonical,v),Lt=d.globeDenormalizeECEF(yt);T=d.multiply(new Float32Array(16),v.globeMatrix,Lt),d.multiply(T,v.projMatrix,T)}const D=p.useProgram("debug",null,A),O=r.getTileByID(u.key);p.terrain&&p.terrain.setupElevationDraw(O,D);const R=d.DepthMode.disabled,V=d.StencilMode.disabled,H=p.colorModeForRenderPass(),j="$debug";m.activeTexture.set(x.TEXTURE0),p.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),M?O._makeGlobeTileDebugBuffers(p.context,v):O._makeDebugTileBoundsBuffers(p.context,v.projection);const q=O._tileDebugBuffer||p.debugBuffer,Z=O._tileDebugIndexBuffer||p.debugIndexBuffer,U=O._tileDebugSegments||p.debugSegments;D.draw(m,x.LINE_STRIP,R,V,H,d.CullFaceMode.disabled,Gr(T,d.Color.red),j,q,Z,U,null,null,null,[O._globeTileDebugBorderBuffer]);const J=O.latestRawTileData,$=Math.floor((J&&J.byteLength||0)/1024),lt=r.getTile(u).tileSize,st=512/Math.min(lt,512)*(u.overscaledZ/v.zoom)*.5;let et=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(et+=` => ${u.overscaledZ}`),et+=` ${$}kb`,function(yt,Lt){yt.initDebugOverlayCanvas();const gt=yt.debugOverlayCanvas,At=yt.context.gl,kt=yt.debugOverlayCanvas.getContext("2d");kt.clearRect(0,0,gt.width,gt.height),kt.shadowColor="white",kt.shadowBlur=2,kt.lineWidth=1.5,kt.strokeStyle="white",kt.textBaseline="top",kt.font="bold 36px Open Sans, sans-serif",kt.fillText(Lt,5,5),kt.strokeText(Lt,5,5),yt.debugOverlayTexture.update(gt),yt.debugOverlayTexture.bind(At.LINEAR,At.CLAMP_TO_EDGE)}(p,et);const at=O._tileDebugTextBuffer||p.debugBuffer,rt=O._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,dt=O._tileDebugTextSegments||p.debugSegments;D.draw(m,x.TRIANGLES,R,V,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,Gr(T,d.Color.transparent,st),j,at,rt,dt,null,null,null,[O._globeTileDebugTextBuffer])}function hs(p,r,u,m){ta(p,0,r+u/2,p.transform.width,u,m)}function ku(p,r,u,m){ta(p,r-u/2,0,u,p.transform.height,m)}function ta(p,r,u,m,v,x){const M=p.context,A=M.gl;A.enable(A.SCISSOR_TEST),A.scissor(r*d.exported.devicePixelRatio,u*d.exported.devicePixelRatio,m*d.exported.devicePixelRatio,v*d.exported.devicePixelRatio),M.clear({color:x}),A.disable(A.SCISSOR_TEST)}const ea=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Bh}=ea;function To(p,r,u,m){p.emplaceBack(r,u,m)}class Nr{constructor(r){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,To(this.vertexArray,-1,-1,1),To(this.vertexArray,1,-1,1),To(this.vertexArray,-1,1,1),To(this.vertexArray,1,1,1),To(this.vertexArray,-1,-1,-1),To(this.vertexArray,1,-1,-1),To(this.vertexArray,-1,1,-1),To(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Bh),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function ds(p,r,u,m,v,x){const M=p.gl,A=r.paint.get("sky-atmosphere-color"),T=r.paint.get("sky-atmosphere-halo-color"),D=r.paint.get("sky-atmosphere-sun-intensity"),O={u_matrix_3f:d.fromMat4(d.create$1(),m),u_sun_direction:v,u_sun_intensity:D,u_color_tint_r:[(j=A).r,j.g,j.b,j.a],u_color_tint_m:[(q=T).r,q.g,q.b,q.a],u_luminance:5e-5};var j,q;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),u.draw(p,M.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,O,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const ll=d.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class cl{constructor(r){const u=new d.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const m=new d.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(u,ll.members),this.indexBuffer=r.createIndexBuffer(m),this.segments=d.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ps={symbol:function(p,r,u,m,v){if("translucent"!==p.renderPass)return;const x=d.StencilMode.disabled,M=p.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(A,T,D,O,R,V,H){const j=T.transform,q="map"===R,Z="map"===V;for(const U of A){const J=O.getTile(U),$=J.getBucket(D);if(!$||!$.text||!$.text.segments.get().length)continue;const lt=d.evaluateSizeForZoom($.textSizeData,j.zoom),st=cn(U,$.getProjection(),j),et=j.calculatePixelsToTileUnitsMatrix(J),at=we(st,J.tileID.canonical,Z,q,j,$.getProjection(),et),rt="none"!==D.layout.get("icon-text-fit")&&$.hasIconData();if(lt){const dt=Math.pow(2,j.zoom-J.tileID.overscaledZ);jn($,q,Z,H,d.symbolSize,j,at,U,dt,lt,rt)}}}(m,p,u,r,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),0!==u.paint.get("icon-opacity").constantOr(1)&&yc(p,r,u,m,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),x,M),0!==u.paint.get("text-opacity").constantOr(1)&&yc(p,r,u,m,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),x,M),r.map.showCollisionBoxes&&(gc(p,r,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),gc(p,r,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,u,m){if("translucent"!==p.renderPass)return;const v=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),M=u.paint.get("circle-stroke-opacity"),A=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===x.constantOr(1)||0===M.constantOr(1)))return;const T=p.context,D=T.gl,O=p.transform,R=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),V=d.StencilMode.disabled,H=p.colorModeForRenderPass(),j="globe"===O.projection.name,q=[d.mercatorXfromLng(O.center.lng),d.mercatorYfromLat(O.center.lat)],Z=[];for(let J=0;J<m.length;J++){const $=m[J],lt=r.getTile($),st=lt.getBucket(u);if(!st||st.projection.name!==O.projection.name)continue;const et=st.programConfigurations.get(u.id),at=hc(u);j&&at.push("PROJECTION_GLOBE_VIEW");const rt=p.useProgram("circle",et,at),dt=st.layoutVertexBuffer,yt=st.globeExtVertexBuffer,Lt=st.indexBuffer,gt=O.projection.createInversionMatrix(O,$.canonical),At={programConfiguration:et,program:rt,layoutVertexBuffer:dt,globeExtVertexBuffer:yt,indexBuffer:Lt,uniformValues:uc(p,$,lt,gt,q,u),tile:lt};if(A){const kt=st.segments.get();for(const Gt of kt)Z.push({segments:new d.SegmentVector([Gt]),sortKey:Gt.sortKey,state:At})}else Z.push({segments:st.segments,sortKey:0,state:At})}A&&Z.sort((J,$)=>J.sortKey-$.sortKey);const U={useDepthForOcclusion:!j};for(const J of Z){const{programConfiguration:$,program:lt,layoutVertexBuffer:st,globeExtVertexBuffer:et,indexBuffer:at,uniformValues:rt,tile:dt}=J.state,yt=J.segments;p.terrain&&p.terrain.setupElevationDraw(dt,lt,U),p.prepareDrawProgram(T,lt,dt.tileID.toUnwrapped()),lt.draw(T,D.TRIANGLES,R,V,H,d.CullFaceMode.disabled,rt,u.id,st,at,yt,u.paint,O.zoom,$,[et])}},heatmap:function(p,r,u,m){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const v=p.context,x=v.gl,M=d.StencilMode.disabled,A=new d.ColorMode([x.ONE,x.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(H,j,q,Z){const U=H.gl,J=j.width*Z,$=j.height*Z;H.activeTexture.set(U.TEXTURE1),H.viewport.set([0,0,J,$]);let lt=q.heatmapFbo;if(!lt||lt&&(lt.width!==J||lt.height!==$)){lt&&lt.destroy();const st=U.createTexture();U.bindTexture(U.TEXTURE_2D,st),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),lt=q.heatmapFbo=H.createFramebuffer(J,$,!1),function(et,at,rt,dt,yt,Lt){const gt=et.gl;gt.texImage2D(gt.TEXTURE_2D,0,gt.RGBA,yt,Lt,0,gt.RGBA,et.extRenderToTextureHalfFloat?et.extTextureHalfFloat.HALF_FLOAT_OES:gt.UNSIGNED_BYTE,null),dt.colorAttachment.set(rt)}(H,0,st,lt,J,$)}else U.bindTexture(U.TEXTURE_2D,lt.colorAttachment.get()),H.bindFramebuffer.set(lt.framebuffer)})(v,p,u,"globe"===p.transform.projection.name?.5:.25),v.clear({color:d.Color.transparent});const T=p.transform,D="globe"===T.projection.name,O=D?["PROJECTION_GLOBE_VIEW"]:null,R=D?d.CullFaceMode.frontCCW:d.CullFaceMode.disabled,V=[d.mercatorXfromLng(T.center.lng),d.mercatorYfromLat(T.center.lat)];for(let H=0;H<m.length;H++){const j=m[H];if(r.hasRenderableParent(j))continue;const q=r.getTile(j),Z=q.getBucket(u);if(!Z||Z.projection.name!==T.projection.name)continue;const U=Z.programConfigurations.get(u.id),J=p.useProgram("heatmap",U,O),{zoom:$}=p.transform;p.terrain&&p.terrain.setupElevationDraw(q,J),p.prepareDrawProgram(v,J,j.toUnwrapped());const lt=T.projection.createInversionMatrix(T,j.canonical);J.draw(v,x.TRIANGLES,d.DepthMode.disabled,M,A,R,dc(p,j,q,lt,V,$,u.paint.get("heatmap-intensity")),u.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,u.paint,p.transform.zoom,U,D?[Z.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,x){const M=v.context,A=M.gl,T=x.heatmapFbo;if(!T)return;M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,T.colorAttachment.get()),M.activeTexture.set(A.TEXTURE1);let D=x.colorRampTexture;D||(D=x.colorRampTexture=new d.Texture(M,x.colorRamp,A.RGBA)),D.bind(A.LINEAR,A.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(M,A.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,v.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(p,u))},line:function(p,r,u,m){if("translucent"!==p.renderPass)return;const v=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(0===v.constantOr(1)||0===x.constantOr(1))return;const M=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),A=p.colorModeForRenderPass(),T=p.terrain&&p.terrain.renderingToTexture?1:d.exported.devicePixelRatio,D=u.paint.get("line-dasharray"),O=D.constantOr(1),R=u.layout.get("line-cap"),V=u.paint.get("line-pattern"),H=V.constantOr(1),j=u.paint.get("line-gradient"),q=u.getCrossfadeParameters(),Z=H?"linePattern":"line",U=p.context,J=U.gl,$=(st=>{const et=[];us(st)&&et.push("RENDER_LINE_DASH"),st.paint.get("line-gradient")&&et.push("RENDER_LINE_GRADIENT");const at=st.paint.get("line-trim-offset");0===at[0]&&0===at[1]||et.push("RENDER_LINE_TRIM_OFFSET");const rt=st.paint.get("line-pattern").constantOr(1),dt=1!==st.paint.get("line-opacity").constantOr(1);return!rt&&dt&&et.push("RENDER_LINE_ALPHA_DISCARD"),et})(u);let lt=$.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(lt=!1);for(const st of m){const et=r.getTile(st);if(H&&!et.patternsLoaded())continue;const at=et.getBucket(u);if(!at)continue;p.prepareDrawTile();const rt=at.programConfigurations.get(u.id),dt=p.useProgram(Z,rt,$),yt=V.constantOr(null);if(yt&&et.imageAtlas){const Et=et.imageAtlas,Zt=Et.patternPositions[yt.to.toString()],Ut=Et.patternPositions[yt.from.toString()];Zt&&Ut&&rt.setConstantPatternPositions(Zt,Ut)}const Lt=D.constantOr(null),gt=R.constantOr(null);if(!H&&Lt&&gt&&et.lineAtlas){const Et=et.lineAtlas,Zt=Et.getDash(Lt.to,gt),Ut=Et.getDash(Lt.from,gt);Zt&&Ut&&rt.setConstantPatternPositions(Zt,Ut)}let[At,kt]=u.paint.get("line-trim-offset");("round"===gt||"square"===gt)&&At!==kt&&(0===At&&(At-=1),1===kt&&(kt+=1));const Gt=p.terrain?st.projMatrix:null,wt=H?Mo(p,et,u,q,Gt,T):un(p,et,u,q,Gt,at.lineClipsArray.length,T,[At,kt]);if(j){const Et=at.gradients[u.id];let Zt=Et.texture;if(u.gradientVersion!==Et.version){let Ut=256;if(u.stepInterpolant){const Qt=r.getSource().maxzoom,ie=st.canonical.z===Qt?Math.ceil(1<<p.transform.maxZoom-st.canonical.z):1;Ut=d.clamp(d.nextPowerOfTwo(at.maxLineLength/d.EXTENT*1024*ie),256,U.maxTextureSize)}Et.gradient=d.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Ut,image:Et.gradient||void 0,clips:at.lineClipsArray}),Et.texture?Et.texture.update(Et.gradient):Et.texture=new d.Texture(U,Et.gradient,J.RGBA),Et.version=u.gradientVersion,Zt=Et.texture}U.activeTexture.set(J.TEXTURE1),Zt.bind(u.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}O&&(U.activeTexture.set(J.TEXTURE0),et.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),rt.updatePaintBuffers(q)),H&&(U.activeTexture.set(J.TEXTURE0),et.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),rt.updatePaintBuffers(q)),p.prepareDrawProgram(U,dt,st.toUnwrapped());const zt=Et=>{dt.draw(U,J.TRIANGLES,M,Et,A,d.CullFaceMode.disabled,wt,u.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,u.paint,p.transform.zoom,rt,[at.layoutVertexBuffer2])};if(lt){const Et=p.stencilModeForClipping(st).ref;0===Et&&p.terrain&&U.clear({stencil:0});const Zt={func:J.EQUAL,mask:255};wt.u_alpha_discard_threshold=.8,zt(new d.StencilMode(Zt,Et,255,J.KEEP,J.KEEP,J.INVERT)),wt.u_alpha_discard_threshold=0,zt(new d.StencilMode(Zt,Et,255,J.KEEP,J.KEEP,J.KEEP))}else zt(p.stencilModeForClipping(st))}lt&&(p.resetStencilClippingMasks(),p.terrain&&U.clear({stencil:0}))},fill:function(p,r,u,m){const v=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(0===x.constantOr(1))return;const M=p.colorModeForRenderPass(),A=u.paint.get("fill-pattern"),T=p.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===v.constantOr(d.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(p.renderPass===T){const D=p.depthModeForSublayer(1,"opaque"===p.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);al(p,r,u,m,D,M,!1)}if("translucent"===p.renderPass&&u.paint.get("fill-antialias")){const D=p.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);al(p,r,u,m,D,M,!0)}},"fill-extrusion":function(p,r,u,m){const v=u.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===p.renderPass){const x=new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==v||u.paint.get("fill-extrusion-pattern").constantOr(1))br(p,r,u,m,x,d.StencilMode.disabled,d.ColorMode.disabled),br(p,r,u,m,x,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const M=p.colorModeForRenderPass();br(p,r,u,m,x,d.StencilMode.disabled,M)}}},hillshade:function(p,r,u,m){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const v=p.context,x=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),M=p.colorModeForRenderPass(),A=p.terrain&&p.terrain.renderingToTexture,[T,D]="translucent"!==p.renderPass||A?[{},m]:p.stencilConfigForOverlap(m);for(const O of D){const R=r.getTile(O);if(R.needsHillshadePrepare&&"offscreen"===p.renderPass)os(p,R,u,x,d.StencilMode.disabled,M);else if("translucent"===p.renderPass){const V=A&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):T[O.overscaledZ];sc(p,O,R,u,x,V,M)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,u,m,v,x){if("translucent"!==p.renderPass||0===u.paint.get("raster-opacity")||!m.length)return;const M=p.context,A=M.gl,T=r.getSource(),D=p.useProgram("raster"),O=p.colorModeForRenderPass(),R=p.terrain&&p.terrain.renderingToTexture,[V,H]=T instanceof pt||R?[{},m]:p.stencilConfigForOverlap(m),j=H[H.length-1].overscaledZ,q=!p.options.moving;for(const Z of H){const U=R?d.DepthMode.disabled:p.depthModeForSublayer(Z.overscaledZ-j,1===u.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,A.LESS),J=Z.toUnwrapped(),$=r.getTile(Z);if(R&&(!$||!$.hasData()))continue;const lt=R?Z.projMatrix:p.transform.calculateProjMatrix(J,q),st=p.terrain&&R?p.terrain.stencilModeForRTTOverlap(Z):V[Z.overscaledZ],et=x?0:u.paint.get("raster-fade-duration");$.registerFadeDuration(et);const at=r.findLoadedParent(Z,0),rt=as($,at,r,p.transform,et);let dt,yt;p.terrain&&p.terrain.prepareDrawTile();const Lt="nearest"===u.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;M.activeTexture.set(A.TEXTURE0),$.texture.bind(Lt,A.CLAMP_TO_EDGE),M.activeTexture.set(A.TEXTURE1),at?(at.texture.bind(Lt,A.CLAMP_TO_EDGE),dt=Math.pow(2,at.tileID.overscaledZ-$.tileID.overscaledZ),yt=[$.tileID.canonical.x*dt%1,$.tileID.canonical.y*dt%1]):$.texture.bind(Lt,A.CLAMP_TO_EDGE);const gt=wu(lt,yt||[0,0],dt||1,rt,u,T instanceof pt?T.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(M,D,J),T instanceof pt)T.boundsBuffer&&T.boundsSegments&&D.draw(M,A.TRIANGLES,U,d.StencilMode.disabled,O,d.CullFaceMode.disabled,gt,u.id,T.boundsBuffer,p.quadTriangleIndexBuffer,T.boundsSegments);else{const{tileBoundsBuffer:At,tileBoundsIndexBuffer:kt,tileBoundsSegments:Gt}=p.getTileBoundsBuffers($);D.draw(M,A.TRIANGLES,U,st,O,d.CullFaceMode.disabled,gt,u.id,At,kt,Gt)}}p.resetStencilClippingMasks()},background:function(p,r,u,m){const v=u.paint.get("background-color"),x=u.paint.get("background-opacity");if(0===x)return;const M=p.context,A=M.gl,T=p.transform,D=T.tileSize,O=u.paint.get("background-pattern");if(p.isPatternMissing(O))return;const R=!O&&1===v.a&&1===x&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==R)return;const V=d.StencilMode.disabled,H=p.depthModeForSublayer(0,"opaque"===R?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),j=p.colorModeForRenderPass(),q=p.useProgram(O?"backgroundPattern":"background");let Z,U=m;U||(Z=p.getBackgroundTiles(),U=Object.values(Z).map($=>$.tileID)),O&&(M.activeTexture.set(A.TEXTURE0),p.imageManager.bind(p.context));const J=u.getCrossfadeParameters();for(const $ of U){const lt=$.toUnwrapped(),st=m?$.projMatrix:p.transform.calculateProjMatrix(lt);p.prepareDrawTile();const et=r?r.getTile($):Z?Z[$.key]:new d.Tile($,D,T.zoom,p),at=O?Mu(st,x,p,O,{tileID:$,tileSize:D},J):zh(st,x,v);p.prepareDrawProgram(M,q,lt);const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:dt,tileBoundsSegments:yt}=p.getTileBoundsBuffers(et);q.draw(M,A.TRIANGLES,H,V,j,d.CullFaceMode.disabled,at,u.id,rt,dt,yt)}},sky:function(p,r,u){const m=p.transform,v="mercator"===m.projection.name||"globe"===m.projection.name?1:d.smoothstep(7,8,m.zoom),x=u.paint.get("sky-opacity")*v;if(0===x)return;const M=p.context,A=u.paint.get("sky-type"),T=new d.DepthMode(M.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),D=p.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===p.renderPass?u.needsSkyboxCapture(p)&&(function(O,R,V,H){const j=O.context,q=j.gl;let Z=R.skyboxFbo;if(!Z){Z=R.skyboxFbo=j.createFramebuffer(32,32,!1),R.skyboxGeometry=new Nr(j),R.skyboxTexture=j.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,R.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let lt=0;lt<6;++lt)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(Z.framebuffer),j.viewport.set([0,0,32,32]);const U=R.getCenter(O,!0),J=O.useProgram("skyboxCapture"),$=new Float64Array(16);d.identity($),d.rotateY($,$,.5*-Math.PI),ds(j,R,J,$,U,0),d.identity($),d.rotateY($,$,.5*Math.PI),ds(j,R,J,$,U,1),d.identity($),d.rotateX($,$,.5*-Math.PI),ds(j,R,J,$,U,2),d.identity($),d.rotateX($,$,.5*Math.PI),ds(j,R,J,$,U,3),d.identity($),ds(j,R,J,$,U,4),d.identity($),d.rotateY($,$,Math.PI),ds(j,R,J,$,U,5),j.viewport.set([0,0,O.width,O.height])}(p,u),u.markSkyboxValid(p)):"sky"===p.renderPass&&function(O,R,V,H,j){const q=O.context,Z=q.gl,U=O.transform,J=O.useProgram("skybox");q.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,R.skyboxTexture);const $={u_matrix:U.skyboxMatrix,u_sun_direction:R.getCenter(O,!1),u_cubemap:0,u_opacity:H,u_temporal_offset:j};O.prepareDrawProgram(q,J),J.draw(q,Z.TRIANGLES,V,d.StencilMode.disabled,O.colorModeForRenderPass(),d.CullFaceMode.backCW,$,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(p,u,T,x,D):"gradient"===A&&"sky"===p.renderPass&&function(O,R,V,H,j){const q=O.context,Z=q.gl,U=O.transform,J=O.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Nr(q)),q.activeTexture.set(Z.TEXTURE0);let $=R.colorRampTexture;$||($=R.colorRampTexture=new d.Texture(q,R.colorRamp,Z.RGBA)),$.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const lt=(st=U.skyboxMatrix,et=R.getCenter(O,!1),at=R.paint.get("sky-gradient-radius"),rt=H,dt=j,{u_matrix:st,u_color_ramp:0,u_center_direction:et,u_radius:d.degToRad(at),u_opacity:rt,u_temporal_offset:dt});var st,et,at,rt,dt;O.prepareDrawProgram(q,J),J.draw(q,Z.TRIANGLES,V,d.StencilMode.disabled,O.colorModeForRenderPass(),d.CullFaceMode.backCW,lt,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(p,u,T,x,D)},debug:function(p,r,u){for(let m=0;m<u.length;m++)Le(p,r,u[m])},custom:function(p,r,u){const m=p.context,v=u.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const x=v.prerender;x&&(p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),x.call(v,m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),m.setStencilMode(d.StencilMode.disabled);const x="3d"===v.renderingMode?new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,d.DepthMode.ReadOnly);m.setDepthMode(x),v.render(m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState(),m.bindFramebuffer.set(null)}}};class Du{constructor(r,u){this.context=new W(r),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Hs,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,u){const m=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cc(this,r));const v=this._terrain;this.transform.elevation=m?v:null,v.update(r,this.transform,u)}_updateFog(r){const u=r.fog;if(!u||"globe"===this.transform.projection.name||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=u.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const x=m+.78*(v-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,u){if(this.width=r*d.exported.devicePixelRatio,this.height=u*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const r=this.context,u=new d.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(d.EXTENT,0),u.emplaceBack(0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(u,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const m=new d.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(d.EXTENT,0),m.emplaceBack(0,d.EXTENT),m.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=r.createVertexBuffer(m,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const v=new d.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(v,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const x=new d.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(d.EXTENT,0,d.EXTENT,0),x.emplaceBack(0,d.EXTENT,0,d.EXTENT),x.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(x,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const M=new d.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(M);const A=new d.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])A.emplaceBack(D);this.debugIndexBuffer=r.createIndexBuffer(A),this.emptyTexture=new d.Texture(r,new d.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=d.create();const T=this.context.gl;this.stencilClearMode=new d.StencilMode({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.loadTimeStamps.push(d.window.performance.now()),this.atmosphereBuffer=new cl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,u=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,u.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,vu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,u,m){if(!u||this.currentStencilSource===u.id||!r.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const T of m)if(void 0===this._tileClippingMaskIDs[T.key]){A=!0;break}if(!A)return}this.currentStencilSource=u.id;const v=this.context,x=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(d.ColorMode.disabled),v.setDepthMode(d.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of m){const T=u.getTile(A),D=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:R,tileBoundsSegments:V}=this.getTileBoundsBuffers(T);M.draw(v,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,vu(A.projMatrix),"$clipping",O,R,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,u=this.context.gl;return new d.StencilMode({func:u.NOTEQUAL,mask:255},r,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const u=this.context.gl;return new d.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(r){const u=this.context.gl,m=r.sort((M,A)=>A.overscaledZ-M.overscaledZ),v=m[m.length-1].overscaledZ,x=m[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const M={};for(let A=0;A<x;A++)M[A+v]=new d.StencilMode({func:u.GEQUAL,mask:255},A+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[M,m]}return[{[v]:d.StencilMode.disabled},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new d.ColorMode([r.CONSTANT_COLOR,r.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(r,u,m){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new d.DepthMode(m||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,u){this.style=r,this.options=u,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const m=this.style.order,v=this.style._sourceCaches;for(const T in v){const D=v[T];D.used&&D.prepare(this.context)}const x={},M={},A={};for(const T in v){const D=v[T];x[T]=D.getVisibleCoordinates(),M[T]=x[T].slice().reverse(),A[T]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<m.length;T++)if(this.style._layers[m[T]].is3D()){this.opaquePassCutoff=T;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.GlobeSharedBuffers(this.context)),d.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const T of m){const D=this.style._layers[T],O=r._getLayerSourceCache(D);if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const R=O?M[O.id]:void 0;("custom"===D.type||D.isSky()||R&&R.length)&&this.renderLayer(this,O,D,R)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(T);if(T.isSky())continue;const O=D?M[D.id]:void 0;this._renderTileClippingMasks(T,D,O),this.renderLayer(this,D,T,O)}if(this.style.fog&&this.transform.projection.supportsFog&&function(T,D){const O=T.context,R=O.gl,V=T.transform,H=new d.DepthMode(R.LEQUAL,d.DepthMode.ReadOnly,[0,1]),j=T.useProgram("globeAtmosphere",null,"globe"===V.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),q=d.globeToMercatorTransition(V.zoom),Z=D.properties.get("color").toArray01(),U=D.properties.get("high-color").toArray01(),J=D.properties.get("space-color").toArray01PremultipliedAlpha(),$=d.identity$1([]);d.rotateY$1($,$,-d.degToRad(V._center.lng)),d.rotateX$1($,$,d.degToRad(V._center.lat)),d.rotateZ$1($,$,V.angle),d.rotateX$1($,$,-V._pitch);const lt=d.fromQuat(new Float32Array(16),$),st=d.mapValue(D.properties.get("star-intensity"),0,1,0,.25),at=d.mapValue(D.properties.get("horizon-blend"),0,1,5e-4,.25),rt=d.globeUseCustomAntiAliasing(T,O,V)&&5e-4===at?V.worldSize/(2*Math.PI*1.025)-1:V.globeRadius,dt=T.frameCounter/1e3%1,yt=d.length(V.globeCenterInViewSpace),Lt=Math.sqrt(Math.pow(yt,2)-Math.pow(rt,2)),gt=Math.acos(Lt/yt),At={u_frustum_tl:V.frustumCorners.TL,u_frustum_tr:V.frustumCorners.TR,u_frustum_br:V.frustumCorners.BR,u_frustum_bl:V.frustumCorners.BL,u_horizon:V.frustumCorners.horizon,u_transition:q,u_fadeout_range:at,u_color:Z,u_high_color:U,u_space_color:J,u_star_intensity:st,u_star_size:5*d.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:dt,u_horizon_angle:gt,u_rotation_matrix:lt};T.prepareDrawProgram(O,j);const kt=T.atmosphereBuffer;kt&&j.draw(O,R.TRIANGLES,H,d.StencilMode.disabled,d.ColorMode.alphaBlended,d.CullFaceMode.backCW,At,"skybox",kt.vertexBuffer,kt.indexBuffer,kt.segments)}(this,this.style.fog),this.renderPass="sky",(d.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const T=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(T);T.isSky()&&this.renderLayer(this,D,T,D?M[D.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const T=this.style._layers[m[this.currentLayer]],D=r._getLayerSourceCache(T);if(T.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(T)){if(T.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=D?("symbol"===T.type?A:M)[D.id]:void 0;this._renderTileClippingMasks(T,D,D?x[D.id]:void 0),this.renderLayer(this,D,T,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let T=null;d.values(this.style._layers).forEach(D=>{const O=r._getLayerSourceCache(D);O&&!D.isHidden(this.transform.zoom)&&(!T||T.getSource().maxzoom<O.getSource().maxzoom)&&(T=O)}),T&&this.options.showTileBoundaries&&ps.debug(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const D=T.transform.padding;hs(T,T.transform.height-(D.top||0),3,Tu),hs(T,D.bottom||0,3,Ao),ku(T,D.left||0,3,tr),ku(T,T.transform.width-(D.right||0),3,Eu);const O=T.transform.centerPoint;var R,V,H,j;ta(R=T,(V=O.x)-1,(H=T.transform.height-O.y)-10,2,20,j=So),ta(R,V-10,H-1,20,2,j)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,u,m,v){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(m.type)||ps[m.type](r,u,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let m=this.gpuTimers[r.id];m||(m=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),m.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,u=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),r.beginQueryEXT(r.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const u={};for(const m in r){const v=r[m],x=this.context.extTimerQuery,M=x.getQueryObjectEXT(v.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(v.query),u[m]=M}return u}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let m=0;for(const v of r)m+=u.getQueryObjectEXT(v,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(v);return m}translatePosMatrix(r,u,m,v,x){if(!m[0]&&!m[1])return r;const M=x?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(M){const D=Math.sin(M),O=Math.cos(M);m=[m[0]*O-m[1]*D,m[0]*D+m[1]*O]}const A=[x?m[0]:$n(u,m[0],this.transform.zoom),x?m[1]:$n(u,m[1],this.transform.zoom),0],T=new Float32Array(16);return d.translate(T,r,A),T}saveTileTexture(r){const u=this._tileTextures[r.size[0]];u?u.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const u=this._tileTextures[r];return u&&u.length>0?u.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const u=this.imageManager.getPattern(r.from.toString()),m=this.imageManager.getPattern(r.to.toString());return!u||!m}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),u&&!r&&0!==u.getOpacity(this.transform.pitch)&&m.push("FOG"),r&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(r,u,m){this.cache=this.cache||{};const v=m||[],x=this.currentGlobalDefines().concat(v),M=il.cacheKey(Xa[r],r,x,u);return this.cache[M]||(this.cache[M]=new il(this.context,r,Xa[r],u,Au[r],x)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,u,m){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const x=v.getOpacity(this.transform.pitch),M=((A,T,D,O,R,V,H,j,q,Z,U)=>{const J=A.transform,$=T.properties.get("color").toArray01();$[3]=O;const lt=A.frameCounter/1e3%1;return{u_fog_matrix:D?J.calculateFogTileMatrix(D):A.identityMat,u_fog_range:T.getFovAdjustedRange(J._fov),u_fog_color:$,u_fog_horizon_blend:T.properties.get("horizon-blend"),u_fog_temporal_offset:lt,u_frustum_tl:R,u_frustum_tr:V,u_frustum_br:H,u_frustum_bl:j,u_globe_pos:q,u_globe_radius:Z,u_viewport:U,u_globe_transition:d.globeToMercatorTransition(J.zoom),u_is_globe:+("globe"===J.projection.name)}})(this,v,m,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.exported.devicePixelRatio,this.transform.height*d.exported.devicePixelRatio]);u.setFogUniformValues(r,M)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,u=r.createTexture();return r.bindTexture(r.TEXTURE_2D,u),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)u[v.key]=r[v.key]||new d.Tile(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class ul{constructor(r=0,u=0,m=0,v=0){if(isNaN(r)||r<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=u,this.left=m,this.right=v}interpolate(r,u,m){return null!=u.top&&null!=r.top&&(this.top=d.number(r.top,u.top,m)),null!=u.bottom&&null!=r.bottom&&(this.bottom=d.number(r.bottom,u.bottom,m)),null!=u.left&&null!=r.left&&(this.left=d.number(r.left,u.left,m)),null!=u.right&&null!=r.right&&(this.right=d.number(r.right,u.right,m)),this}getCenter(r,u){const m=d.clamp((this.left+r-this.right)/2,0,r),v=d.clamp((this.top+u-this.bottom)/2,0,u);return new d.pointGeometry(m,v)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ul(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Iu(p,r){const u=d.getColumn(p,3);d.fromQuat(p,r),d.setColumn(p,3,u)}function ia(p,r){const u=d.identity$1([]);return d.rotateZ$1(u,u,-r),d.rotateX$1(u,u,-p),u}function na(p,r){const u=[p[0],p[1],0],m=[r[0],r[1],0];if(d.length(u)>=1e-15){const M=d.normalize([],u);d.scale$2(m,M,d.dot(m,M)),r[0]=m[0],r[1]=m[1]}const v=d.cross([],r,p);if(d.len(v)<1e-15)return null;const x=Math.atan2(-v[1],v[0]);return ia(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),x)}class Yt{constructor(r,u){this.position=r,this.orientation=u}get position(){return this._position}set position(r){if(r){const u=r instanceof d.MercatorCoordinate?r:new d.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(u.x=d.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(r,u){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(r)):0,v=this.position,x=d.MercatorCoordinate.fromLngLat(r,m),M=[x.x-v.x,x.y-v.y,x.z-v.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=na(M,u)}setPitchBearing(r,u){this.orientation=ia(d.degToRad(r),d.degToRad(-u))}}class Re{constructor(r,u){this._transform=d.identity([]),this.orientation=u,this.position=r}get mercatorPosition(){const r=this.position;return new d.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=d.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var u;r&&d.setColumn(this._transform,3,[(u=r)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||d.identity$1([]),r&&Iu(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,u){this._orientation=ia(r,u),Iu(this._transform,this._orientation)}forward(){const r=d.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=d.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=d.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,u){const m=new Float64Array(16);return d.invert(m,this.getWorldToCamera(r,u)),m}getWorldToCameraPosition(r,u,m){const v=this.position;d.scale$2(v,v,-r);const x=new Float64Array(16);return d.fromScaling(x,[m,m,m]),d.translate(x,x,v),x[10]*=u,x}getWorldToCamera(r,u){const m=new Float64Array(16),v=new Float64Array(4),x=this.position;return d.conjugate(v,this._orientation),d.scale$2(x,x,-r),d.fromQuat(m,v),d.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(r,u,m,v){const x=new Float64Array(16);return d.perspective(x,r,u,m,v),x}getDistanceToElevation(r){const u=0===r?0:d.mercatorZfromAltitude(r,this.position[1]),m=this.forward();return(u-this.position[2])/m[2]}clone(){return new Re([...this.position],[...this.orientation])}}function xi(p,r){const u=fs(p.projection,p.zoom,p.width,p.height),m=function(x,M,A,T,D){const O=new d.LngLat(A.lng-180*je,A.lat),R=new d.LngLat(A.lng+180*je,A.lat),V=x.project(O.lng,O.lat),H=x.project(R.lng,R.lat),j=-Math.atan2(H.y-V.y,H.x-V.x),q=d.MercatorCoordinate.fromLngLat(A);q.y=d.clamp(q.y,-.999975,.999975);const Z=q.toLngLat(),U=x.project(Z.lng,Z.lat),J=d.MercatorCoordinate.fromLngLat(Z);J.x+=je;const $=J.toLngLat(),lt=x.project($.lng,$.lat),st=ge(lt.x-U.x,lt.y-U.y,j),et=d.MercatorCoordinate.fromLngLat(Z);et.y+=je;const at=et.toLngLat(),rt=x.project(at.lng,at.lat),dt=ge(rt.x-U.x,rt.y-U.y,j),yt=Math.abs(st.x)/Math.abs(dt.y),Lt=d.identity([]);d.rotateZ(Lt,Lt,-j*(1-(D?0:T)));const gt=d.identity([]);return d.scale(gt,gt,[1,1-(1-yt)*T,1]),gt[4]=-dt.x/dt.y*T,d.rotateZ(gt,gt,j),d.multiply(gt,Lt,gt),gt}(p.projection,0,p.center,u,r),v=hl(p);return d.scale(m,m,[v,v,1]),m}function hl(p){const r=p.projection,u=fs(p.projection,p.zoom,p.width,p.height),m=dl(r,p.center),v=dl(r,d.LngLat.convert(r.center));return Math.pow(2,m*u+(1-u)*v)}function fs(p,r,u,m,v=1/0){const x=p.range;if(!x)return 0;const M=Math.min(v,Math.max(u,m)),A=Math.log(M/1024)/Math.LN2;return d.smoothstep(x[0]+A,x[1]+A,r)}const je=1/4e4;function dl(p,r){const u=d.clamp(r.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=new d.LngLat(r.lng-180*je,u),v=new d.LngLat(r.lng+180*je,u),x=p.project(m.lng,u),M=p.project(v.lng,u),A=d.MercatorCoordinate.fromLngLat(m),T=d.MercatorCoordinate.fromLngLat(v),D=M.x-x.x,O=M.y-x.y,R=T.x-A.x,V=T.y-A.y,H=Math.sqrt((R*R+V*V)/(D*D+O*O));return Math.log(H)/Math.LN2}function ge(p,r,u){const m=Math.cos(u),v=Math.sin(u);return{x:p*m-r*v,y:p*v+r*m}}class zi{constructor(r,u,m,v,x,M,A){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=r||0,this._maxZoom=u||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(M),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ul,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Re,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new zi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||u)&&this._updateCameraOnTerrain(),(r||u)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=d.getProjection(this.projectionOptions);const m=!Bt(u,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=d.getProjection({name:"mercator"});const u=r!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const u=-r*Math.PI/180;var m,v,x,M,A,T,D,O,R,V;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(m=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),v=this.rotationMatrix,M=this.angle,A=(x=this.rotationMatrix)[0],T=x[1],D=x[2],O=x[3],R=Math.sin(M),V=Math.cos(M),v[0]=A*V+D*R,v[1]=T*V+O*R,v[2]=A*-R+D*V,v[3]=T*-R+O*V)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const u=d.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const u=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,x=0;for(let M=0;M<u.length;M++){const A=new d.pointGeometry(u[M][0]*this.width,m+u[M][1]*(this.height-m)),T=r.pointCoordinate(A);if(!T)continue;const D=1/Math.hypot(T[0]-this._camera.position[0],T[1]-this._camera.position[1]);v+=T[3]*D,x+=D}return 0===x?NaN:v/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),M=Math.max(v-m,x);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let m;m=r.z<this._camera.position[2]?[u.x,u.y,u.z]:[r.x,r.y,r.z];const v=d.length(d.sub([],this._camera.position,m));return d.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let u=!1;if(r.orientation&&!d.exactEquals(r.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(r.orientation)),r.position){const m=[r.position.x,r.position.y,r.position.z];d.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,u=new Yt;return u.position=new d.MercatorCoordinate(r[0],r[1],r[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(r){if(!d.length$1(r))return!1;d.normalize$1(r,r);const u=d.transformQuat([],[0,0,-1],r),m=d.transformQuat([],[0,-1,0],r);if(m[2]<0)return!1;const v=na(u,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(r){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;r[2]=d.clamp(r[2],v/m,v/u),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,u,m){this._unmodified=!1,this._edgeInsets.interpolate(r,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const u=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(r){const u=[new d.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const m=this.pointCoordinate(new d.pointGeometry(0,0)),v=this.pointCoordinate(new d.pointGeometry(this.width,0)),x=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),M=this.pointCoordinate(new d.pointGeometry(0,this.height)),A=Math.floor(Math.min(m.x,v.x,x.x,M.x)),T=Math.floor(Math.max(m.x,v.x,x.x,M.x)),D=1;for(let O=A-D;O<=T+D;O++)0!==O&&u.push(new d.UnwrappedTileID(O,r))}return u}coveringTiles(r){let u=this.coveringZoomLevel(r);const m=u,v=this.elevation&&!r.isTerrainDEM,x="mercator"===this.projection.name;if(void 0!==r.minzoom&&u<r.minzoom)return[];void 0!==r.maxzoom&&u>r.maxzoom&&(u=r.maxzoom);const M=this.locationCoordinate(this.center),A=this.center.lat,T=1<<u,D=[T*M.x,T*M.y,0],O="globe"===this.projection.name,R=!O,V=d.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,R),H=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=T*d.mercatorZfromAltitude(1,this.center.lat),q=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),Z=[T*H.x,T*H.y,q*(R?1:j)],U=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,$=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,lt=r.isTerrainDEM?-$:this._elevation?this._elevation.getMinElevationBelowMSL():0,st=this.projection.isReprojectedInTileSpace?hl(this):1,et=wt=>{const Et=new d.MercatorCoordinate(wt.x+25e-6,wt.y,wt.z),Zt=new d.MercatorCoordinate(wt.x,wt.y+25e-6,wt.z),Ut=wt.toLngLat(),Qt=Et.toLngLat(),ie=Zt.toLngLat(),se=this.locationCoordinate(Ut),Te=this.locationCoordinate(Qt),Kt=this.locationCoordinate(ie),me=Math.hypot(Te.x-se.x,Te.y-se.y),ze=Math.hypot(Kt.x-se.x,Kt.y-se.y);return Math.sqrt(me*ze)*st/25e-6},at=wt=>{const zt=$,Et=lt;return{aabb:d.tileAABB(this,T,0,0,0,wt,Et,zt,this.projection),zoom:0,x:0,y:0,minZ:Et,maxZ:zt,wrap:wt,fullyVisible:!1}},rt=[];let dt=[];const yt=u,Lt=r.reparseOverscaled?m:u,gt=wt=>wt*wt,At=gt((q-this._centerAltitude)*j),kt=wt=>{if(!this._elevation||!wt.tileID||!x)return;const zt=this._elevation.getMinMaxForTile(wt.tileID),Et=wt.aabb;zt?(Et.min[2]=zt.min,Et.max[2]=zt.max,Et.center[2]=(Et.min[2]+Et.max[2])/2):(wt.shouldSplit=Gt(wt),wt.shouldSplit||(Et.min[2]=Et.max[2]=Et.center[2]=this._centerAltitude))},Gt=wt=>{if(wt.zoom<J)return!0;if(wt.zoom===yt)return!1;if(null!=wt.shouldSplit)return wt.shouldSplit;const zt=wt.aabb.distanceX(Z),Et=wt.aabb.distanceY(Z);let Zt=At,Ut=1;if(O){Zt=gt(wt.aabb.distanceZ(Z));const ie=Math.pow(2,wt.zoom),se=d.latFromMercatorY((wt.y+1)/ie),Te=d.latFromMercatorY(wt.y/ie),Kt=Math.min(Math.max(A,se),Te),me=d.circumferenceAtLatitude(Kt)/d.circumferenceAtLatitude(A);if(Ut=Kt===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,me/this._mercatorScaleRatio),this.zoom<=d.GLOBE_ZOOM_THRESHOLD_MIN&&wt.zoom===yt-1&&me>=.9)return!0}else if(v&&(Zt=gt(wt.aabb.distanceZ(Z)*j)),this.projection.isReprojectedInTileSpace&&m<=5){const ie=Math.pow(2,wt.zoom),se=et(new d.MercatorCoordinate((wt.x+.5)/ie,(wt.y+.5)/ie));Ut=se>.85?1:se}const Qt=zt*zt+Et*Et+Zt;return Qt<gt((1<<yt-wt.zoom)*U*Ut*((ie,se)=>{if(se*gt(.707)<ie)return 1;const Te=Math.sqrt(se/ie);return Te/(1.4144271570014144+(Math.pow(1.1,Te-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Zt,At),Qt))};if(this.renderWorldCopies)for(let wt=1;wt<=3;wt++)rt.push(at(-wt)),rt.push(at(wt));for(rt.push(at(0));rt.length>0;){const wt=rt.pop(),zt=wt.x,Et=wt.y;let Zt=wt.fullyVisible;if(!Zt){const Ut=wt.aabb.intersects(V);if(0===Ut)continue;Zt=2===Ut}if(wt.zoom!==yt&&Gt(wt))for(let Ut=0;Ut<4;Ut++){const Qt=(zt<<1)+Ut%2,ie=(Et<<1)+(Ut>>1),se={aabb:x?wt.aabb.quadrant(Ut):d.tileAABB(this,T,wt.zoom+1,Qt,ie,wt.wrap,wt.minZ,wt.maxZ,this.projection),zoom:wt.zoom+1,x:Qt,y:ie,wrap:wt.wrap,fullyVisible:Zt,tileID:void 0,shouldSplit:void 0,minZ:wt.minZ,maxZ:wt.maxZ};v&&!O&&(se.tileID=new d.OverscaledTileID(wt.zoom+1===yt?Lt:wt.zoom+1,wt.wrap,wt.zoom+1,Qt,ie),kt(se)),rt.push(se)}else{const Ut=wt.zoom===yt?Lt:wt.zoom;if(r.minzoom&&r.minzoom>Ut)continue;const Qt=D[0]-(.5+zt+(wt.wrap<<wt.zoom))*(1<<u-wt.zoom),ie=D[1]-.5-Et,se=wt.tileID?wt.tileID:new d.OverscaledTileID(Ut,wt.wrap,wt.zoom,zt,Et);dt.push({tileID:se,distanceSq:Qt*Qt+ie*ie})}}if(this.fogCullDistSq){const wt=this.fogCullDistSq,zt=this.horizonLineFromTop();dt=dt.filter(Et=>{const Zt=[0,0,0,1],Ut=[d.EXTENT,d.EXTENT,0,1],Qt=this.calculateFogTileMatrix(Et.tileID.toUnwrapped());d.transformMat4$1(Zt,Zt,Qt),d.transformMat4$1(Ut,Ut,Qt);const ie=d.getAABBPointSquareDist(Zt,Ut);if(0===ie)return!0;let se=!1;const Te=this._elevation;if(Te&&ie>wt&&0!==zt){const Kt=this.calculateProjMatrix(Et.tileID.toUnwrapped());let me;r.isTerrainDEM||(me=Te.getMinMaxForTile(Et.tileID)),me||(me={min:lt,max:$});const ze=d.furthestTileCorner(this.rotation),ai=[ze[0]*d.EXTENT,ze[1]*d.EXTENT,me.max];d.transformMat4(ai,ai,Kt),se=(1-ai[1])*this.height*.5<zt}return ie<wt||se})}return dt.sort((wt,zt)=>wt.distanceSq-zt.distanceSq).map(wt=>wt.tileID)}resize(r,u){this.width=r,this.height=u,this.pixelsToGLUnits=[2/r,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const u=d.clamp(r.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=this.projection.project(r.lng,u);return new d.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,u){let m,v;const x=this.centerPoint;if("globe"===this.projection.name){const A=this.worldSize;m=(u.x-x.x)/A,v=(u.y-x.y)/A}else{const A=this.pointCoordinate(u),T=this.pointCoordinate(x);m=A.x-T.x,v=A.y-T.y}const M=this.locationCoordinate(r);this.setLocation(new d.MercatorCoordinate(M.x-m,M.y-v))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,u){const m=u?d.mercatorZfromAltitude(u,r.lat):void 0,v=this.projection.project(r.lng,r.lat);return new d.MercatorCoordinate(v.x,v.y,m)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,u){const m=u??this._centerAltitude,v=[r.x,r.y,0,1],x=[r.x,r.y,1,1];d.transformMat4$1(v,v,this.pixelMatrixInverse),d.transformMat4$1(x,x,this.pixelMatrixInverse);const M=x[3];d.scale$1(v,v,1/v[3]),d.scale$1(x,x,1/M);const A=v[2],T=x[2];return{p0:v,p1:x,t:A===T?0:(m-A)/(T-A)}}screenPointToMercatorRay(r){const u=[r.x,r.y,0,1],m=[r.x,r.y,1,1];return d.transformMat4$1(u,u,this.pixelMatrixInverse),d.transformMat4$1(m,m,this.pixelMatrixInverse),d.scale$1(u,u,1/u[3]),d.scale$1(m,m,1/m[3]),u[2]=d.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,m[2]=d.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,d.scale$1(u,u,1/this.worldSize),d.scale$1(m,m,1/this.worldSize),new d.Ray([u[0],u[1],u[2]],d.normalize([],d.sub([],m,u)))}rayIntersectionCoordinate(r){const{p0:u,p1:m,t:v}=r,x=d.mercatorZfromAltitude(u[2],this._center.lat),M=d.mercatorZfromAltitude(m[2],this._center.lat);return new d.MercatorCoordinate(d.number(u[0],m[0],v)/this.worldSize,d.number(u[1],m[1],v)/this.worldSize,d.number(x,M,v))}pointCoordinate(r,u=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,u)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let u=this.projection.pointCoordinate3D(this,r.x,r.y);if(u)return new d.MercatorCoordinate(u[0],u[1],u[2]);let m=0,v=this.horizonLineFromTop();if(r.y>v)return this.pointCoordinate(r);const x=.02*v,M=r.clone();for(let A=0;A<10&&v-m>x;A++){M.y=d.number(m,v,.66);const T=this.projection.pointCoordinate3D(this,M.x,M.y);T?(v=M.y,u=T):m=M.y}return u?new d.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,v=[r.x*this.worldSize,r.y*this.worldSize,m+r.toAltitude(),1];return d.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new d.pointGeometry(v[0]/v[3],v[1]/v[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,u){const m=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),M=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(m,r),T=this.pointCoordinate(v,r);const D=this.pointCoordinate(x,u),O=this.pointCoordinate(M,u),R=(V,H)=>(H.y-V.y)/(H.x-V.x);return A.y>1&&T.y>=0?A=new d.MercatorCoordinate((1-O.y)/R(O,A)+O.x,1):A.y<0&&T.y<=1&&(A=new d.MercatorCoordinate(-O.y/R(O,A)+O.x,0)),T.y>1&&A.y>=0?T=new d.MercatorCoordinate((1-D.y)/R(D,T)+D.x,1):T.y<0&&A.y<=1&&(T=new d.MercatorCoordinate(-D.y/R(D,T)+D.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(T)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(D))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const u=r.visibleDemTiles.reduce((m,v)=>{if(v.dem){const x=v.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*r.exaggeration(),u.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return r?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,u){return this.projection.createTileMatrix(this,u,r)}calculateDistanceTileData(r){const u=r.key,m=this._distanceTileDataCache;if(m[u])return m[u];const v=r.canonical,x=1/this.height,M=this.cameraWorldSize/this.zoomScale(v.z),A=(v.x+Math.pow(2,v.z)*r.wrap)*M,T=v.y*M,D=this.point,O=this.angle,R=Math.sin(-O),V=-Math.cos(-O);return m[u]={bearing:[R,V],center:[(D.x-A)*x,(D.y-T)*x],scale:M/d.EXTENT*x},m[u]}calculateFogTileMatrix(r){const u=r.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const v=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return d.multiply(v,this.worldToFogMatrix,v),m[u]=new Float32Array(v),m[u]}calculateProjMatrix(r,u=!1){const m=r.key,v=u?this._alignedProjMatrixCache:this._projMatrixCache;if(v[m])return v[m];const x=this.calculatePosMatrix(r,this.worldSize);return d.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,x),v[m]=new Float32Array(x),v[m]}calculatePixelsToTileUnitsMatrix(r){const u=r.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const v=function(x,M){const{scale:A}=x.tileTransform,T=A*d.EXTENT/(x.tileSize*Math.pow(2,M.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return D=new Float32Array(4),V=(O=M.inverseAdjustmentMatrix)[1],H=O[2],j=O[3],Z=(R=[T,T])[1],D[0]=O[0]*(q=R[0]),D[1]=V*q,D[2]=H*Z,D[3]=j*Z,D;var D,O,R,V,H,j,q,Z}(r,this);return m[u]=v,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const u=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),v=this._camera.forward(),x=d.mercatorZfromAltitude(1,this._center.lat);m[2]/=x,v[2]/=x,d.normalize(v,v);const M=r.raycast(m,v,r.exaggeration());if(M){const A=d.scaleAndAdd([],m,v,M),T=new d.MercatorCoordinate(A[0],A[1],d.mercatorZfromAltitude(A[2],d.latFromMercatorY(A[1]))),D=(T.z+d.length([T.x-m[0],T.y-m[1],T.z-m[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=T.toAltitude(),this._center=this.coordinateLocation(T),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const u=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),v=r.getAtPointOrZero(new d.MercatorCoordinate(...m)),x=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),M=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(M<x){const A=this.locationCoordinate(this._center,this._centerAltitude),T=[A.x-m[0],A.y-m[1],A.z-m[2]],D=d.length(T);T[2]-=(x-M)/this._pixelsPerMercatorPixel;const O=d.length(T);if(0===O)return;d.scale$2(T,T,D/O*this._pixelsPerMercatorPixel),this._camera.position=[A.x-T[0],A.y-T[1],A.z*this._pixelsPerMercatorPixel-T[2]],this._camera.orientation=na(T,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const V=this.center;return V.lat=d.clamp(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(V.lng=d.clamp(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const u=this._unmodified,{x:m,y:v}=this.point;let x=0,M=m,A=v;const T=this.width/2,D=this.height/2,O=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(v-D<O&&(A=O+D),v+D>R&&(A=R-D),R-O<this.height&&(x=Math.max(x,this.height/(R-O)),A=(R+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,j=this.worldSize/2-(V+H)/2;M=(m+j+this.worldSize)%this.worldSize-j,M-T<V&&(M=V+T),M+T>H&&(M=H-T),H-V<this.width&&(x=Math.max(x,this.width/(H-V)),M=(H+V)/2)}M===m&&A===v||(this.center=this.unproject(new d.pointGeometry(M,A))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCameraAltitude(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,u=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=d.mercatorZfromAltitude(1,this.center.lat)/d.mercatorZfromAltitude(1,d.GLOBE_SCALE_MATCH_LATITUDE));const m=fs(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?u:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-r.x/this.width,x[9]=2*r.y/this.height;let M=d.mul([],x,v);if(this.projection.isReprojectedInTileSpace){const st=this.locationCoordinate(this.center),et=d.identity([]);d.translate(et,et,[st.x*this.worldSize,st.y*this.worldSize,0]),d.multiply(et,et,xi(this)),d.translate(et,et,[-st.x*this.worldSize,-st.y*this.worldSize,0]),d.multiply(M,M,et),this.inverseAdjustmentMatrix=function(at){const rt=xi(at,!0);return lo([],[rt[0],rt[1],rt[4],rt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale([],M,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=M,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const A=d.invert([],x);this.frustumCorners=d.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const T=new Float32Array(16);d.identity(T),d.scale(T,T,[1,-1,1]),d.rotateX(T,T,this._pitch),d.rotateZ(T,T,this.angle);const D=d.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-r.x/this.width,D[9]=2*(r.y+O)/this.height,this.skyboxMatrix=d.multiply(T,D,T);const R=this.point,V=R.x,H=R.y,j=this.width%2/2,q=this.height%2/2,Z=Math.cos(this.angle),U=Math.sin(this.angle),J=V-Math.round(V)+Z*j+U*q,$=H-Math.round(H)+Z*q+U*j,lt=new Float64Array(M);if(d.translate(lt,lt,[J>.5?J-1:J,$>.5?$-1:$,0]),this.alignedProjMatrix=lt,M=d.create(),d.scale(M,M,[this.width/2,-this.height/2,1]),d.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=d.create(),d.scale(M,M,[1,-1,1]),d.translate(M,M,[-1,-1,0]),d.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=d.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.calculateGlobeMatrix(this);const st=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.transformMat4(st,st,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,u=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,u];d.scale$2(x,x,v),d.scale$2(m,m,-1),d.multiply$2(m,m,x);const M=d.create();d.translate(M,M,m),d.scale(M,M,x),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,u,v)}_computeCameraPosition(r){const u=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-r/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*x,v.y/this.worldSize-m[1]*x,r/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=r[2];let v=1;m>0&&(v=Math.min((u-this._camera.position[2])/m,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,r,v),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),x=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),A=Math.max((r[2]-x)/Math.cos(m),M),T=this._zoomFromMercatorZ(A);d.scaleAndAdd(r,r,u,A),this._pitch=d.clamp(m,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(v,-Math.PI,Math.PI),this._setZoom(d.clamp(T,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,u){const m=Math.min(r.x,u.x),v=Math.max(r.x,u.x),x=Math.min(r.y,u.y),M=Math.max(r.y,u.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new d.pointGeometry(m,x),new d.pointGeometry(v,M),new d.pointGeometry(m,M),new d.pointGeometry(v,x)],T=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const O of A){const R=this.pointRayIntersection(O);if(R.t<0)return!0;const V=this.rayIntersectionCoordinate(R);if(V.x<T||V.y<0||V.x>D||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,u){const m=d.length(d.sub([],this._camera.position,r)),v=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const r=function(u,m){const v=[u[0],u[1],u[2],1];d.transformMat4$1(v,v,m);const x=Math.max(v[3],1e-6);return[v[0]/x,v[1]/x,v[2]/x,x]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,r))}}getCameraToCenterDistance(r){const u=fs(r,this.zoom,this.width,this.height,1024),m=r.pixelSpaceConversion(this.center.lat,this.worldSize,u);return.5/Math.tan(.5*this._fov)*this.height*m}}function ra(p,r){let u=!1,m=null;const v=()=>{m=null,u&&(p(),m=setTimeout(v,r),u=!1)};return()=>(u=!0,m||v(),m)}class oa{constructor(r){this._hashName=r&&encodeURIComponent(r),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ra(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,d.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),d.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const u=Ci(r);if(this._hashName){const m=this._hashName;let v=!1;const x=d.window.location.hash.slice(1).split("&").map(M=>{const A=M.split("=")[0];return A===m?(v=!0,`${A}=${u}`):M}).filter(M=>M);return v||x.push(`${m}=${u}`),`#${x.join("&")}`}return`#${u}`}_getCurrentHash(){const r=d.window.location.hash.replace("#","");if(this._hashName){let u;return r.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(m))){const m=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(u[3]||0):r.getBearing();return r.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,r)}}function Ci(p,r){const u=p.getCenter(),m=Math.round(100*p.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),M=Math.round(u.lng*x)/x,A=Math.round(u.lat*x)/x,T=p.getBearing(),D=p.getPitch();let O=r?`/${M}/${A}/${m}`:`${m}/${A}/${M}`;return(T||D)&&(O+="/"+Math.round(10*T)/10),D&&(O+=`/${Math.round(D)}`),O}const Ui={linearity:.3,easing:d.bezier(0,0,.3,1)},Jd=d.extend({deceleration:2500,maxSpeed:1400},Ui),ms=d.extend({deceleration:20,maxSpeed:1400},Ui),ke=d.extend({deceleration:1e3,maxSpeed:360},Ui),pl=d.extend({deceleration:1e3,maxSpeed:90},Ui);class xc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,u=d.exported.now();for(;r.length>0&&u-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const x=sa(u.pan.mag(),m,d.extend({},Jd,r||{}));v.offset=u.pan.mult(x.amount/u.pan.mag()),v.center=this._map.transform.center,Ur(v,x)}if(u.zoom){const x=sa(u.zoom,m,ms);v.zoom=this._map.transform.zoom+x.amount,Ur(v,x)}if(u.bearing){const x=sa(u.bearing,m,ke);v.bearing=this._map.transform.bearing+d.clamp(x.amount,-179,179),Ur(v,x)}if(u.pitch){const x=sa(u.pitch,m,pl);v.pitch=this._map.transform.pitch+x.amount,Ur(v,x)}if(v.zoom||v.bearing){const x=void 0===u.pinchAround?u.around:u.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Ur(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function sa(p,r,u){const{maxSpeed:m,linearity:v,deceleration:x}=u,M=d.clamp(p*v/(r/1e3),-m,m),A=Math.abs(M)/(x*v);return{easing:u.easing,duration:1e3*A,amount:M*(A/2)}}class Hi extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m,v={}){const x=ye(u.getCanvasContainer(),m),M=u.unproject(x);super(r,d.extend({point:x,lngLat:M,originalEvent:m},v)),this._defaultPrevented=!1,this.target=u}}class gs extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m){const v="touchend"===r?m.changedTouches:m.touches,x=sn(u.getCanvasContainer(),v),M=x.map(T=>u.unproject(T)),A=x.reduce((T,D,O,R)=>T.add(D.div(R.length)),new d.pointGeometry(0,0));super(r,{points:x,point:A,lngLats:M,lngLat:u.unproject(A),originalEvent:m}),this._defaultPrevented=!1}}class Ou extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,u,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class Vh{constructor(r,u){this._map=r,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Ou(r.type,this._map,r))}mousedown(r,u){return this._mousedownPos=u,this._firePreventable(new Hi(r.type,this._map,r))}mouseup(r){this._map.fire(new Hi(r.type,this._map,r))}preclick(r){const u=d.extend({},r);u.type="preclick",this._map.fire(new Hi(u.type,this._map,u))}click(r,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Hi(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Hi(r.type,this._map,r))}mouseover(r){this._map.fire(new Hi(r.type,this._map,r))}mouseout(r){this._map.fire(new Hi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new gs(r.type,this._map,r))}touchmove(r){this._map.fire(new gs(r.type,this._map,r))}touchend(r){this._map.fire(new gs(r.type,this._map,r))}touchcancel(r){this._map.fire(new gs(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Hi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Hi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pu{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,u){this.isEnabled()&&r.shiftKey&&0===r.button&&(Ia(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(r,u){if(!this._active)return;const m=u;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=Ae("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const x=Math.min(v.x,m.x),M=Math.max(v.x,m.x),A=Math.min(v.y,m.y),T=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${A}px)`,this._box.style.width=M-x+"px",this._box.style.height=T-A+"px")})}mouseupWindow(r,u){if(!this._active||0!==r.button)return;const m=this._startPos,v=u;if(this.reset(),Xo(),m.x!==v.x||m.y!==v.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Wo(),delete this._startPos,delete this._lastPos}_fireEvent(r,u){return this._map.fire(new d.Event(r,{originalEvent:u}))}}function fl(p,r){const u={};for(let m=0;m<p.length;m++)u[p[m].identifier]=r[m];return u}class aa{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const x=new d.pointGeometry(0,0);for(const M of v)x._add(M);return x.div(v.length)}(u),this.touches=fl(m,u)))}touchmove(r,u,m){if(this.aborted||!this.centroid)return;const v=fl(m,u);for(const x in this.touches){const M=this.touches[x],A=v[x];(!A||A.dist(M)>30)&&(this.aborted=!0)}}touchend(r,u,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class jr{constructor(r){this.singleTap=new aa(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,u,m){this.singleTap.touchstart(r,u,m)}touchmove(r,u,m){this.singleTap.touchmove(r,u,m)}touchend(r,u,m){const v=this.singleTap.touchend(r,u,m);if(v){const x=r.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(v)<30;if(x&&M||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Lu{constructor(){this._zoomIn=new jr({numTouches:1,numTaps:2}),this._zoomOut=new jr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,u,m){this._zoomIn.touchstart(r,u,m),this._zoomOut.touchstart(r,u,m)}touchmove(r,u,m){this._zoomIn.touchmove(r,u,m),this._zoomOut.touchmove(r,u,m)}touchend(r,u,m){const v=this._zoomIn.touchend(r,u,m),x=this._zoomOut.touchend(r,u,m);return v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(v)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ru={0:1,2:2};class _s{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,u){return!1}_move(r,u){return{}}mousedown(r,u){if(this._lastPoint)return;const m=Dr(r);this._correctButton(r,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(r,u){const m=this._lastPoint;if(m)if(r.preventDefault(),null!=this._eventButton&&function(v,x){const M=Ru[x];return void 0===v.buttons||(v.buttons&M)!==M}(r,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}mouseupWindow(r){this._lastPoint&&Dr(r)===this._eventButton&&(this._moved&&Xo(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zu extends _s{mousedown(r,u){super.mousedown(r,u),this._lastPoint&&(this._active=!0)}_correctButton(r,u){return 0===u&&!r.ctrlKey}_move(r,u){return{around:u,panDelta:u.sub(r)}}}class Bu extends _s{_correctButton(r,u){return 0===u&&r.ctrlKey||2===u}_move(r,u){const m=.8*(u.x-r.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(r){r.preventDefault()}}class Di extends _s{_correctButton(r,u){return 0===u&&r.ctrlKey||2===u}_move(r,u){const m=-.5*(u.y-r.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(r){r.preventDefault()}}class Gh{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(r,u,m){return this._calculateTransform(r,u,m)}touchmove(r,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length&&!d.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,u,m)}}touchend(r,u,m){this._calculateTransform(r,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,u,m){m.length>0&&(this._active=!0);const v=fl(m,u),x=new d.pointGeometry(0,0),M=new d.pointGeometry(0,0);let A=0;for(const D in v){const O=v[D],R=this._touches[D];R&&(x._add(O),M._add(O.sub(R)),A++,v[D]=O)}if(this._touches=v,A<this._minTouches||!M.mag())return;const T=M.div(A);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(A),panDelta:T}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class la{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,u,m){return{}}touchstart(r,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(r,u,m){const v=this._firstTwoTouches;if(!v)return;r.preventDefault();const[x,M]=v,A=ml(m,u,x),T=ml(m,u,M);if(!A||!T)return;const D=this._aroundCenter?null:A.add(T).div(2);return this._move([A,T],D,r)}touchend(r,u,m){if(!this._firstTwoTouches)return;const[v,x]=this._firstTwoTouches,M=ml(m,u,v),A=ml(m,u,x);M&&A||(this._active&&Xo(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ml(p,r,u){for(let m=0;m<p.length;m++)if(p[m].identifier===u)return r[m]}function Vu(p,r){return Math.log(p/r)/Math.LN2}class er extends la{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,u){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Vu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vu(this._distance,m),pinchAround:u}}}function gl(p,r){return 180*p.angleWith(r)/Math.PI}class Eo extends la{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,u){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:gl(this._vector,m),pinchAround:u}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const u=25/(Math.PI*this._minDiameter)*360,m=gl(r,this._startVector);return Math.abs(m)<u}}function kn(p){return Math.abs(p.y)>Math.abs(p.x)}class _l extends la{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,kn(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,u,m){const v=this._lastPoints;if(!v)return;const x=r[0].sub(v[0]),M=r[1].sub(v[1]);return this._map._cooperativeGestures&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(x,M,m.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+M.y)/2*-.5})}gestureBeginsVertically(r,u,m){if(void 0!==this._valid)return this._valid;const v=r.mag()>=2,x=u.mag()>=2;if(!v&&!x)return;if(!v||!x)return null==this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const M=r.y>0==u.y>0;return kn(r)&&kn(u)&&M}}const Jt={panStep:100,bearingStep:15,pitchStep:10};class bc{constructor(){const r=Jt;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let u=0,m=0,v=0,x=0,M=0;switch(r.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?v=1:(r.preventDefault(),M=-1);break;case 40:r.shiftKey?v=-1:(r.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:A=>{const T=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:wc,zoom:u?Math.round(T)+u*(r.shiftKey?2:1):T,bearing:A.getBearing()+m*this._bearingStep,pitch:A.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-M*this._panStep],center:A.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wc(p){return p*(2-p)}const ca=4.000244140625;class ys{constructor(r,u){this._map=r,this._el=r.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||d.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=r.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=d.exported.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==u&&u%ca==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),r.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=r,this._delta-=u,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=ye(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,u=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const T="wheel"===this._type&&Math.abs(this._delta)>ca?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&0!==D&&(D=1/D);const O=u(),R=Math.pow(2,O),V="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(V*D))),"wheel"===this._type&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:u(),v=this._startZoom,x=this._easing;let M,A=!1;if("wheel"===this._type&&v&&x){const T=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),D=x(T);M=d.number(v,m,D),T<1?this._frameId||(this._frameId=!0):A=!0}else M=m,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:M-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let u=d.ease;if(this._prevEase){const m=this._prevEase,v=(d.exported.now()-m.start)/m.duration,x=m.easing(v+.01)-m.easing(v),M=.27/Math.sqrt(x*x+1e-4)*.01,A=Math.sqrt(.0729-M*M);u=d.bezier(M,A,.25,1)}return this._prevEase={start:d.exported.now(),duration:r,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ae("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Cc{constructor(r,u){this._clickZoom=r,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,u){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(r.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hn{constructor(){this._tap=new jr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,u,m){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(r,u,m))}touchmove(r,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=u[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,u,m)}touchend(r,u,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(r,u,m)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nh{constructor(r,u,m){this._el=r,this._mousePan=u,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ko{constructor(r,u,m){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class yl{constructor(r,u,m,v){this._el=r,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qr=p=>p.zoom||p.drag||p.pitch||p.rotate;class vl extends d.Event{}class xl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,u){const m=d.sub([],u,r);this.radius=d.length(m[2]<0?d.div([],m,this.constants):[m[0],m[1],0])}projectRay(r){d.div(r,r,this.constants),d.normalize(r,r),d.mul$1(r,r,this.constants);const u=d.scale$2([],r,this.radius);if(u[2]>0){const m=d.scale$2([],[0,0,1],d.dot(u,[0,0,1])),v=d.scale$2([],d.normalize([],[u[0],u[1],0]),this.radius),x=d.add([],u,d.scale$2([],d.sub([],d.add([],v,m),u),2));u[0]=x[0],u[1]=x[1]}return u}}function qn(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Nu{constructor(r,u){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xc(r),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),d.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[v,x,M]of this._listeners)v.addEventListener(x,v===d.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[r,u,m]of this._listeners)r.removeEventListener(u,r===d.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new Vh(u,r));const v=u.boxZoom=new Pu(u,r);this._add("boxZoom",v);const x=new Lu,M=new Gu;u.doubleClickZoom=new Cc(M,x),this._add("tapZoom",x),this._add("clickZoom",M);const A=new hn;this._add("tapDragZoom",A);const T=u.touchPitch=new _l(u);this._add("touchPitch",T);const D=new Bu(r),O=new Di(r);u.dragRotate=new ko(r,D,O),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const R=new zu(r),V=new Gh(u,r);u.dragPan=new Nh(m,R,V),this._add("mousePan",R),this._add("touchPan",V,["touchZoom","touchRotate"]);const H=new Eo,j=new er;u.touchZoomRotate=new yl(m,j,H,A),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fu(u));const q=u.scrollZoom=new ys(u,this);this._add("scrollZoom",q,["mousePan"]);const Z=u.keyboard=new bc;this._add("keyboard",Z);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[U]&&u[U].enable(r[U])}_add(r,u,m){this._handlers.push({handlerName:r,handler:u,allowed:m}),this._handlersById[r]=u}stop(r){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qr(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,u,m){for(const v in r)if(v!==m&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const u=[];for(const m of r)this._el.contains(m.target)&&u.push(m);return u}handleEvent(r,u){this._updatingCamera=!0;const m="renderFrame"===r.type,v=m?void 0:r,x={needsRenderFrame:!1},M={},A={},T=r.touches?this._getMapTouches(r.touches):void 0,D=T?sn(this._el,T):m?void 0:ye(this._el,r);for(const{handlerName:V,handler:H,allowed:j}of this._handlers){if(!H.isEnabled())continue;let q;this._blockedByActive(A,j,V)?H.reset():H[u||r.type]&&(q=H[u||r.type](r,D,T),this.mergeHandlerResult(x,M,q,V,v),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||H.isActive())&&(A[V]=H)}const O={};for(const V in this._previousActiveHandlers)A[V]||(O[V]=v);this._previousActiveHandlers=A,(Object.keys(O).length||qn(x))&&(this._changes.push([x,M,O]),this._triggerRenderFrame()),(Object.keys(A).length||qn(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=x;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(r,u,m,v,x){if(!m)return;d.extend(r,m);const M={handlerName:v,originalEvent:m.originalEvent||x};void 0!==m.zoomDelta&&(u.zoom=M),void 0!==m.panDelta&&(u.drag=M),void 0!==m.pitchDelta&&(u.pitch=M),void 0!==m.bearingDelta&&(u.rotate=M)}_applyChanges(){const r={},u={},m={};for(const[v,x,M]of this._changes)v.panDelta&&(r.panDelta=(r.panDelta||new d.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(r.around=v.around),void 0!==v.aroundCoord&&(r.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(r.pinchAround=v.pinchAround),v.noInertia&&(r.noInertia=v.noInertia),d.extend(u,x),d.extend(m,M);this._updateMapTransform(r,u,m),this._changes=[]}_updateMapTransform(r,u,m){const v=this._map,x=v.transform,M=J=>[J.x,J.y,J.z];if((J=>{const $=this._eventsInProgress.drag;return $&&!this._handlersById[$.handlerName].isActive()})()&&!qn(r)){const J=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",J!==x.zoom&&this._map._update(!0)}if(!qn(r))return void this._fireEvents(u,m,!0);let{panDelta:A,zoomDelta:T,bearingDelta:D,pitchDelta:O,around:R,aroundCoord:V,pinchAround:H}=r;void 0!==H&&(R=H),(J=>u.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=M(x.pointCoordinate3D(R)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),R=R||v.transform.centerPoint,D&&(x.bearing+=D),O&&(x.pitch+=O),x._updateCameraState();const j=[0,0,0];if(A)if("mercator"===x.projection.name){const J=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(R).dir),$=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(R.sub(A)).dir);j[0]=$[0]-J[0],j[1]=$[1]-J[1]}else{const J=x.pointCoordinate(R);if("globe"===x.projection.name){A=A.rotate(-x.angle);const $=x._pixelsPerMercatorPixel/x.worldSize;j[0]=-A.x*d.mercatorScale(d.latFromMercatorY(J.y))*$,j[1]=-A.y*d.mercatorScale(x.center.lat)*$}else{const $=x.pointCoordinate(R.sub(A));J&&$&&(j[0]=$.x-J.x,j[1]=$.y-J.y)}}const q=x.zoom,Z=[0,0,0];if(T){const J=M(V||x.pointCoordinate3D(R)),$={dir:d.normalize([],d.sub([],J,x._camera.position))};if($.dir[2]<0){const lt=x.zoomDeltaToMovement(J,T);d.scale$2(Z,$.dir,lt)}}const U=d.add(j,j,Z);x._translateCameraConstrained(U),T&&Math.abs(x.zoom-q)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(u,m,!0)}_fireEvents(r,u,m){const v=qr(this._eventsInProgress),x=qr(r),M={};for(const O in r){const{originalEvent:R}=r[O];this._eventsInProgress[O]||(M[`${O}start`]=R),this._eventsInProgress[O]=r[O]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(const O in M)this._fireEvent(O,M[O]);x&&this._fireEvent("move",x.originalEvent);for(const O in r){const{originalEvent:R}=r[O];this._fireEvent(O,R)}const A={};let T;for(const O in this._eventsInProgress){const{handlerName:R,originalEvent:V}=this._eventsInProgress[O];this._handlersById[R].isActive()||(delete this._eventsInProgress[O],T=u[R]||V,A[`${O}end`]=T)}for(const O in A)this._fireEvent(O,A[O]);const D=qr(this._eventsInProgress);if(m&&(v||x)&&!D){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=V=>0!==V&&-this._bearingSnap<V&&V<this._bearingSnap;O?(R(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:T})):(this._map.fire(new d.Event("moveend",{originalEvent:T})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,u){this._map.fire(new d.Event(r,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new vl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Mc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Uu extends d.Evented{constructor(r,u){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=u.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,u){return this.jumpTo({center:r},u)}panBy(r,u,m){return r=d.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,d.extend({offset:r},u),m)}panTo(r,u,m){return this.easeTo(d.extend({center:r},u),m)}getZoom(){return this.transform.zoom}setZoom(r,u){return this.jumpTo({zoom:r},u),this}zoomTo(r,u,m){return this.easeTo(d.extend({zoom:r},u),m)}zoomIn(r,u){return this.zoomTo(this.getZoom()+1,r,u),this}zoomOut(r,u){return this.zoomTo(this.getZoom()-1,r,u),this}getBearing(){return this.transform.bearing}setBearing(r,u){return this.jumpTo({bearing:r},u),this}getPadding(){return this.transform.padding}setPadding(r,u){return this.jumpTo({padding:r},u),this}rotateTo(r,u,m){return this.easeTo(d.extend({bearing:r},u),m)}resetNorth(r,u){return this.rotateTo(0,d.extend({duration:1e3},r),u),this}resetNorthPitch(r,u){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},r),u),this}snapToNorth(r,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,u):this}getPitch(){return this.transform.pitch}setPitch(r,u){return this.jumpTo({pitch:r},u),this}cameraForBounds(r,u){"globe"===this.transform.projection.name&&d.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),r=d.LngLatBounds.convert(r);const m=u&&u.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),m,u)}_extendCameraOptions(r){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=d.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const m=r.padding;r.padding={top:m,bottom:m,right:m,left:m}}return r.padding=d.extend(u,r.padding),r}_cameraForBoxAndBearing(r,u,m,v){const x=this._extendCameraOptions(v),M=this.transform,A=M.padding,T=M.project(d.LngLat.convert(r)),D=M.project(d.LngLat.convert(u)),O=new d.pointGeometry(T.x,D.y),R=new d.pointGeometry(D.x,T.y),V=-d.degToRad(m),H=T.rotate(V),j=D.rotate(V),q=O.rotate(V),Z=R.rotate(V),U=new d.pointGeometry(Math.max(H.x,j.x,q.x,Z.x),Math.max(H.y,j.y,q.y,Z.y)),J=new d.pointGeometry(Math.min(H.x,j.x,q.x,Z.x),Math.min(H.y,j.y,q.y,Z.y)),$=U.sub(J),lt=(M.width-((A.left||0)+(A.right||0)+x.padding.left+x.padding.right))/$.x,st=(M.height-((A.top||0)+(A.bottom||0)+x.padding.top+x.padding.bottom))/$.y;if(st<0||lt<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const et=Math.min(M.scaleZoom(M.scale*Math.min(lt,st)),x.maxZoom),at="number"==typeof x.offset.x&&"number"==typeof x.offset.y?new d.pointGeometry(x.offset.x,x.offset.y):d.pointGeometry.convert(x.offset),rt=new d.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(m*Math.PI/180),dt=at.add(rt).mult(M.scale/M.zoomScale(et));return{center:M.unproject(T.add(D).div(2).sub(dt)),zoom:et,bearing:m}}_cameraForBox(r,u,m,v,x){const M=this._extendCameraOptions(x);m=m||0,v=v||0,r=d.LngLat.convert(r),u=d.LngLat.convert(u);const A=this.transform.clone();A.padding=M.padding;const T=this.getFreeCameraOptions(),D=new d.LngLat(.5*(r.lng+u.lng),.5*(r.lat+u.lat)),O=.5*(m+v);if(A._camera.position[2]<d.mercatorZfromAltitude(O,D.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");T.lookAtPoint(D),A.setFreeCameraOptions(T);const R=d.MercatorCoordinate.fromLngLat(r),V=d.MercatorCoordinate.fromLngLat(u),H=A.pointRayIntersection(A.centerPoint,O),j=[(q=A.rayIntersectionCoordinate(H)).x,q.y,q.z];var q;const Z=A.screenPointToMercatorRay(A.centerPoint),U="globe"!==A.projection.name;let J,$=0;do{const lt=Math.floor(A.zoom),st=1<<lt,et=Math.min(st*R.x,st*V.x),at=Math.min(st*R.y,st*V.y),rt=Math.max(st*R.x,st*V.x),dt=Math.max(st*R.y,st*V.y),yt=new d.Aabb([et,at,m],[rt,dt,v]),Lt=d.Frustum.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,lt,U);if(2!==yt.intersects(Lt)){J&&(A._camera.position=d.scaleAndAdd([],A._camera.position,Z.dir,-J),A._updateStateFromCamera());break}const gt=d.sub([],A._camera.position,j);J=.5*d.length(gt),A._camera.position=d.scaleAndAdd([],A._camera.position,Z.dir,J);try{A._updateStateFromCamera()}catch{return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++$<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(r,u,m){return"globe"===this.transform.projection.name&&d.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(r,u),u,m)}_raycastElevationBox(r,u){const m=this.transform.elevation;if(!m)return;const v=new d.pointGeometry(r.x,u.y),x=new d.pointGeometry(u.x,r.y),M=m.pointCoordinate(r);if(!M)return;const A=m.pointCoordinate(u);if(!A)return;const T=m.pointCoordinate(v);if(!T)return;const D=m.pointCoordinate(x);if(!D)return;const O=new d.MercatorCoordinate(M[0],M[1]).toLngLat(),R=new d.MercatorCoordinate(A[0],A[1]).toLngLat(),V=new d.MercatorCoordinate(T[0],T[1]).toLngLat(),H=new d.MercatorCoordinate(D[0],D[1]).toLngLat(),j=Math.min(O.lng,Math.min(R.lng,Math.min(V.lng,H.lng))),q=Math.min(O.lat,Math.min(R.lat,Math.min(V.lat,H.lat))),Z=Math.max(O.lng,Math.max(R.lng,Math.max(V.lng,H.lng))),U=Math.max(O.lat,Math.max(R.lat,Math.max(V.lat,H.lat))),J=Math.min(M[3],Math.min(A[3],Math.min(T[3],D[3]))),$=Math.max(M[3],Math.max(A[3],Math.max(T[3],D[3])));return{minLngLat:new d.LngLat(j,q),maxLngLat:new d.LngLat(Z,U),minAltitude:J,maxAltitude:$}}fitScreenCoordinates(r,u,m,v,x){let M,A,T,D;"globe"===this.transform.projection.name&&d.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const O=d.pointGeometry.convert(r),R=d.pointGeometry.convert(u),V=this._raycastElevationBox(O,R);if(V)M=V.minLngLat,A=V.maxLngLat,T=V.minAltitude,D=V.maxAltitude;else{if(this.transform.anyCornerOffEdge(O,R))return this;M=this.transform.pointLocation(O),A=this.transform.pointLocation(R)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(r)),this.transform.pointLocation(d.pointGeometry.convert(u)),m,v):this._cameraForBox(M,A,T,D,v),v,x)}_fitInternal(r,u,m){return r?(delete(u=d.extend(r,u)).padding,u.linear?this.easeTo(u,m):this.flyTo(u,m)):this}jumpTo(r,u){this.stop();const m=r.preloadOnly?this.transform.clone():this.transform;let v=!1,x=!1,M=!1;return"zoom"in r&&m.zoom!==+r.zoom&&(v=!0,m.zoom=+r.zoom),void 0!==r.center&&(m.center=d.LngLat.convert(r.center)),"bearing"in r&&m.bearing!==+r.bearing&&(x=!0,m.bearing=+r.bearing),"pitch"in r&&m.pitch!==+r.pitch&&(M=!0,m.pitch=+r.pitch),null==r.padding||m.isPaddingEqual(r.padding)||(m.padding=r.padding),r.preloadOnly?(this._preloadTiles(m),this):(this.fire(new d.Event("movestart",u)).fire(new d.Event("move",u)),v&&this.fire(new d.Event("zoomstart",u)).fire(new d.Event("zoom",u)).fire(new d.Event("zoomend",u)),x&&this.fire(new d.Event("rotatestart",u)).fire(new d.Event("rotate",u)).fire(new d.Event("rotateend",u)),M&&this.fire(new d.Event("pitchstart",u)).fire(new d.Event("pitch",u)).fire(new d.Event("pitchend",u)),this.fire(new d.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.warnOnce(Mc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return d.warnOnce(Mc),this;this.stop();const v=m.zoom,x=m.pitch,M=m.bearing;m.setFreeCameraOptions(r);const A=v!==m.zoom,T=x!==m.pitch,D=M!==m.bearing;return this.fire(new d.Event("movestart",u)).fire(new d.Event("move",u)),A&&this.fire(new d.Event("zoomstart",u)).fire(new d.Event("zoom",u)).fire(new d.Event("zoomend",u)),D&&this.fire(new d.Event("rotatestart",u)).fire(new d.Event("rotate",u)).fire(new d.Event("rotateend",u)),T&&this.fire(new d.Event("pitchstart",u)).fire(new d.Event("pitch",u)).fire(new d.Event("pitchend",u)),this.fire(new d.Event("moveend",u)),this}easeTo(r,u){this._stop(!1,r.easeId),(!1===(r=d.extend({offset:[0,0],duration:500,easing:d.ease},r)).animate||!r.essential&&d.exported.prefersReducedMotion)&&(r.duration=0);const m=this.transform,v=this.getZoom(),x=this.getBearing(),M=this.getPitch(),A=this.getPadding(),T="zoom"in r?+r.zoom:v,D="bearing"in r?this._normalizeBearing(r.bearing,x):x,O="pitch"in r?+r.pitch:M,R="padding"in r?r.padding:m.padding,V=d.pointGeometry.convert(r.offset);let H,j,q;if("globe"===m.projection.name){const dt=d.MercatorCoordinate.fromLngLat(m.center),yt=V.rotate(-m.angle);dt.x+=yt.x/m.worldSize,dt.y+=yt.y/m.worldSize;const Lt=dt.toLngLat(),gt=d.LngLat.convert(r.center||Lt);this._normalizeCenter(gt),H=m.centerPoint.add(yt),j=new d.pointGeometry(dt.x,dt.y).mult(m.worldSize),q=new d.pointGeometry(d.mercatorXfromLng(gt.lng),d.mercatorYfromLat(gt.lat)).mult(m.worldSize).sub(j)}else{H=m.centerPoint.add(V);const dt=m.pointLocation(H),yt=d.LngLat.convert(r.center||dt);this._normalizeCenter(yt),j=m.project(dt),q=m.project(yt).sub(j)}const Z=m.zoomScale(T-v);let U,J;r.around&&(U=d.LngLat.convert(r.around),J=m.locationPoint(U));const $=this._zooming||T!==v,lt=this._rotating||x!==D,st=this._pitching||O!==M,et=!m.isPaddingEqual(R),at=dt=>yt=>{if($&&(dt.zoom=d.number(v,T,yt)),lt&&(dt.bearing=d.number(x,D,yt)),st&&(dt.pitch=d.number(M,O,yt)),et&&(dt.interpolatePadding(A,R,yt),H=dt.centerPoint.add(V)),U)dt.setLocationAtPoint(U,J);else{const Lt=dt.zoomScale(dt.zoom-v),gt=T>v?Math.min(2,Z):Math.max(.5,Z),At=Math.pow(gt,1-yt),kt=dt.unproject(j.add(q.mult(yt*At)).mult(Lt));dt.setLocationAtPoint(dt.renderWorldCopies?kt.wrap():kt,H)}return r.preloadOnly||this._fireMoveEvents(u),dt};if(r.preloadOnly){const dt=this._emulate(at,r.duration,m);return this._preloadTiles(dt),this}const rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=$,this._rotating=lt,this._pitching=st,this._padding=et,this._easeId=r.easeId,this._prepareEase(u,r.noMoveStart,rt),this._ease(at(m),dt=>{m.recenterOnTerrain(),this._afterEase(u,dt)},r),this}_prepareEase(r,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||m.moving||this.fire(new d.Event("movestart",r)),this._zooming&&!m.zooming&&this.fire(new d.Event("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new d.Event("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new d.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new d.Event("move",r)),this._zooming&&this.fire(new d.Event("zoom",r)),this._rotating&&this.fire(new d.Event("rotate",r)),this._pitching&&this.fire(new d.Event("pitch",r))}_afterEase(r,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new d.Event("zoomend",r)),v&&this.fire(new d.Event("rotateend",r)),x&&this.fire(new d.Event("pitchend",r)),this.fire(new d.Event("moveend",r))}flyTo(r,u){if(!r.essential&&d.exported.prefersReducedMotion){const Zt=d.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Zt,u)}this.stop(),r=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},r);const m=this.transform,v=this.getZoom(),x=this.getBearing(),M=this.getPitch(),A=this.getPadding(),T="zoom"in r?d.clamp(+r.zoom,m.minZoom,m.maxZoom):v,D="bearing"in r?this._normalizeBearing(r.bearing,x):x,O="pitch"in r?+r.pitch:M,R="padding"in r?r.padding:m.padding,V=m.zoomScale(T-v),H=d.pointGeometry.convert(r.offset);let j=m.centerPoint.add(H);const q=m.pointLocation(j),Z=d.LngLat.convert(r.center||q);this._normalizeCenter(Z);const U=m.project(q),J=m.project(Z).sub(U);let $=r.curve;const lt=Math.max(m.width,m.height),st=lt/V,et=J.mag();if("minZoom"in r){const Zt=d.clamp(Math.min(r.minZoom,v,T),m.minZoom,m.maxZoom),Ut=lt/m.zoomScale(Zt-v);$=Math.sqrt(Ut/et*2)}const at=$*$;function rt(Zt){const Ut=(st*st-lt*lt+(Zt?-1:1)*at*at*et*et)/(2*(Zt?st:lt)*at*et);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function dt(Zt){return(Math.exp(Zt)-Math.exp(-Zt))/2}function yt(Zt){return(Math.exp(Zt)+Math.exp(-Zt))/2}const Lt=rt(0);let gt=function(Zt){return yt(Lt)/yt(Lt+$*Zt)},At=function(Zt){return lt*((yt(Lt)*(dt(Ut=Lt+$*Zt)/yt(Ut))-dt(Lt))/at)/et;var Ut},kt=(rt(1)-Lt)/$;if(Math.abs(et)<1e-6||!isFinite(kt)){if(Math.abs(lt-st)<1e-6)return this.easeTo(r,u);const Zt=st<lt?-1:1;kt=Math.abs(Math.log(st/lt))/$,At=function(){return 0},gt=function(Ut){return Math.exp(Zt*$*Ut)}}r.duration="duration"in r?+r.duration:1e3*kt/("screenSpeed"in r?+r.screenSpeed/$:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Gt=x!==D,wt=O!==M,zt=!m.isPaddingEqual(R),Et=Zt=>Ut=>{const Qt=Ut*kt,ie=1/gt(Qt);Zt.zoom=1===Ut?T:v+Zt.scaleZoom(ie),Gt&&(Zt.bearing=d.number(x,D,Ut)),wt&&(Zt.pitch=d.number(M,O,Ut)),zt&&(Zt.interpolatePadding(A,R,Ut),j=Zt.centerPoint.add(H));const se=1===Ut?Z:Zt.unproject(U.add(J.mult(At(Qt))).mult(ie));return Zt.setLocationAtPoint(Zt.renderWorldCopies?se.wrap():se,j),Zt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(u),Zt};if(r.preloadOnly){const Zt=this._emulate(Et,r.duration,m);return this._preloadTiles(Zt),this}return this._zooming=!0,this._rotating=Gt,this._pitching=wt,this._padding=zt,this._prepareEase(u,!1),this._ease(Et(m),()=>this._afterEase(u),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!r){const m=this.handlers;m&&m.stop(!1)}return this}_ease(r,u,m){!1===m.animate||0===m.duration?(r(1),u()):(this._easeStart=d.exported.now(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,u){r=d.wrap(r,-180,180);const m=Math.abs(r-u);return Math.abs(r-360-u)<m&&(r-=360),Math.abs(r+360-u)<m&&(r+=360),r}_normalizeCenter(r){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const m=r.lng-u.center.lng;r.lng+=m>180?-360:m<-180?360:0}_emulate(r,u,m){const v=Math.ceil(15*u/1e3),x=[],M=r(m.clone());for(let A=0;A<=v;A++){const T=M(A/v);x.push(T.clone())}return x}}class Ac{constructor(r={}){this.options=r,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const u=this.options&&this.options.compact;return this._map=r,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ae("button","mapboxgl-ctrl-attrib-button",this._container),Ae("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ae("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,u){const m=this._map._getUIString(`AttributionControl.${u}`);r.setAttribute("aria-label",m),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(r){const m=u.reduce((v,x,M)=>(x.value&&(v+=`${x.key}=${x.value}${M<u.length-1?"&":""}`),v),"?");r.href=`${d.config.FEEDBACK_URL}/${m}#${Ci(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._sourceCaches;for(const v in u){const x=u[v];if(x.used){const M=x.getSource();M.attribution&&r.indexOf(M.attribution)<0&&r.push(M.attribution)}}r.sort((v,x)=>v.length-x.length),r=r.filter((v,x)=>{for(let M=x+1;M<r.length;M++)if(r[M].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ju{constructor(){d.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=Ae("div","mapboxgl-ctrl");const u=Ae("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const u in r){const m=r[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const u=r[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Sc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const u=++this._id;return this._queue.push({callback:r,id:u,cancelled:!1}),u}remove(r){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const v of m)if(v.id===r)return void(v.cancelled=!0)}run(r=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Zr(p,r,u){if(p=new d.LngLat(p.lng,p.lat),r){const m=new d.LngLat(p.lng-360,p.lat),v=new d.LngLat(p.lng+360,p.lat),x=360*Math.ceil(Math.abs(p.lng-u.center.lng)/360),M=u.locationPoint(p).distSqr(r),A=r.x<0||r.y<0||r.x>u.width||r.y>u.height;u.locationPoint(m).distSqr(r)<M&&(A||Math.abs(m.lng-u.center.lng)<x)?p=m:u.locationPoint(v).distSqr(r)<M&&(A||Math.abs(v.lng-u.center.lng)<x)&&(p=v)}for(;Math.abs(p.lng-u.center.lng)>180;){const m=u.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}const ua={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ha extends d.Evented{constructor(r,u){if(super(),(r instanceof d.window.HTMLElement||u)&&(r=d.extend({element:r},u)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=d.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ae("div");const v=41,x=27,M=Xi("svg",{display:"block",height:v*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${v}`},this._element),A=Xi("radialGradient",{id:"shadowGradient"},Xi("defs",{},M));Xi("stop",{offset:"10%","stop-opacity":.4},A),Xi("stop",{offset:"100%","stop-opacity":.05},A),Xi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Xi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Xi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Xi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=d.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const m=this._element.classList;for(const v in ua)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=d.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const u=r.code,m=r.charCode||r.keyCode;"Space"!==u&&"Enter"!==u&&32!==m&&13!==m||this.togglePopup()}_onMapClick(r){const u=r.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map;if(!r)return!1;const u=r.unproject(this._pos),m=r.getFreeCameraOptions();if(!m.position)return!1;const v=m.position.toLngLat();return v.distanceTo(u)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const u=this._pos;if(!u||u.x<0||u.x>r.transform.width||u.y<0||u.y>r.transform.height)return void this._clearFadeTimer();const m=r.unproject(u);let v;r._showingGlobe()&&d.isLngLatBehindGlobe(r.transform,this._lngLat)?v=0:(v=1-r._queryFogOpacity(m),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(v*=.2)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${ua[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${u.x}px,${u.y}px)\n        `}_calculateXYTransform(){const r=this._pos,u=this._map,m=this.getPitchAlignment();if(!u||!r||"map"!==m)return"";if(!u._showingGlobe()){const T=u.getPitch();return T?`rotateX(${T}deg)`:""}const v=d.radToDeg(d.globeTiltAtLngLat(u.transform,this._lngLat)),x=r.sub(d.globeCenterToScreenPoint(u.transform)),M=Math.abs(x.x)+Math.abs(x.y);if(0===M)return"";const A=v/M;return`rotateX(${-x.y*A}deg) rotateY(${x.x*A}deg)`}_calculateZTransform(){const r=this._pos,u=this._map;if(!u||!r)return"";let m=0;const v=this.getRotationAlignment();if("map"===v)if(u._showingGlobe()){const x=u.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),M=u.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);m=d.radToDeg(Math.atan2(M.y,M.x))-90}else m=-u.getBearing();else if("horizon"===v){const x=d.smoothstep(4,6,u.getZoom()),M=d.globeCenterToScreenPoint(u.transform);M.y+=x*u.transform.height;const A=r.sub(M),T=d.radToDeg(Math.atan2(A.y,A.x));m=(T>90?T-270:T+90)*(1-x)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(r){d.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Zr(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===r?this._updateFrameId=d.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=d.pointGeometry.convert(r),this._update(),this}_onMove(r){const u=this._map;if(u){if(!this._isDragging){const m=this._clickTolerance||u._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(r){const u=this._map;u&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const u=this._map;return u&&(r?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class qu{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const u=d.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,u,m){this._start=this.getValue(u),this._end=r,this._startTime=u,this._endTime=u+m}}const Zu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Uh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function da(p){p.parentNode&&p.parentNode.removeChild(p)}const Tc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ec{constructor(r,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new Bu({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,m&&(this.mousePitch=new Di({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(r,u){this.mouseRotate.mousedown(r,u),this.mousePitch&&this.mousePitch.mousedown(r,u),Ia()}move(r,u){const m=this.map,v=this.mouseRotate.mousemoveWindow(r,u),x=v&&v.bearingDelta;if(x&&m.setBearing(m.getBearing()+x),this.mousePitch){const M=this.mousePitch.mousemoveWindow(r,u),A=M&&M.pitchDelta;A&&m.setPitch(m.getPitch()+A)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Wo(),d.window.removeEventListener("mousemove",this.mousemove),d.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(d.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),ye(this.element,r)),d.window.addEventListener("mousemove",this.mousemove),d.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,ye(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=sn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=sn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Hu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},kc={maxWidth:100,unit:"metric"};function Dc(p,r,u){const m=Do(r),v=m/r,x={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[u];this._map._requestDomTask(()=>{this._container.style.width=p*v+"px",this._container.innerHTML=`${m}&nbsp;${x}`})}function Do(p){const r=Math.pow(10,`${Math.floor(p)}`.length-1);let u=p/r;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:function(m){const v=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*v)/v}(u),r*u}const jh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pa(p=new d.pointGeometry(0,0),r="bottom"){if("number"==typeof p){const u=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new d.pointGeometry(0,p);case"top-left":return new d.pointGeometry(u,u);case"top-right":return new d.pointGeometry(-u,u);case"bottom":return new d.pointGeometry(0,-p);case"bottom-left":return new d.pointGeometry(u,-u);case"bottom-right":return new d.pointGeometry(-u,-u);case"left":return new d.pointGeometry(p,0);case"right":return new d.pointGeometry(-p,0)}return new d.pointGeometry(0,0)}return p instanceof d.pointGeometry||Array.isArray(p)?d.pointGeometry.convert(p):d.pointGeometry.convert(p[r]||[0,0])}const fa={version:d.version,supported:hr,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends Uu{constructor(p){if(null!=(p=d.extend({},Uh,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&d.isSafariWithAntialiasingBug(d.window)&&(p.antialias=!1,d.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new zi(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language="auto"===p.language?d.window.navigator.language:p.language,this._worldview=p.worldview,this._renderTaskQueue=new Sc,this._domRenderTaskQueue=new Sc,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},Zu,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new qu(0),this._useExplicitProjection=!1,this._requestManager=new d.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=d.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof d.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&d.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Nu(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new oa("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new Ac({customAttribution:p.customAttribution})),this._logoControl=new ju,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new d.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new d.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(p,r){if(void 0===r&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[r];return-1!==r.indexOf("bottom")?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new d.Event("movestart",p)).fire(new d.Event("move",p)),this.fire(new d.Event("resize",p)),r&&this.fire(new d.Event("moveend",p)),this}getBounds(){return"globe"===this.transform.projection.name&&d.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(d.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getLanguage(){return this._language}setLanguage(p){if(this._language="auto"===p?d.window.navigator.language:p,this.style)for(const r in this.style._sourceCaches){const u=this.style._sourceCaches[r]._source;u._setLanguage&&u._setLanguage(this._language)}for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){if(this._worldview=p,this.style)for(const r in this.style._sourceCaches){const u=this.style._sourceCaches[r]._source;u._setWorldview&&u._setWorldview(p)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const p=this.transform,r=p.projection.name;let u;"globe"===r&&p.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),u=!0):"mercator"===r&&p.zoom<d.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;if(r="globe"===p.name&&this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0)}return this}project(p){return this.transform.locationPoint3D(d.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(d.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,r,u){if("mouseenter"===p||"mouseover"===p){let m=!1;const v=M=>{const A=r.filter(D=>this.getLayer(D)),T=A.length?this.queryRenderedFeatures(M.point,{layers:A}):[];T.length?m||(m=!0,u.call(this,new Hi(p,this,M.originalEvent,{features:T}))):m=!1},x=()=>{m=!1};return{layers:new Set(r),listener:u,delegates:{mousemove:v,mouseout:x}}}if("mouseleave"===p||"mouseout"===p){let m=!1;const v=M=>{const A=r.filter(T=>this.getLayer(T));(A.length?this.queryRenderedFeatures(M.point,{layers:A}):[]).length?m=!0:m&&(m=!1,u.call(this,new Hi(p,this,M.originalEvent)))},x=M=>{m&&(m=!1,u.call(this,new Hi(p,this,M.originalEvent)))};return{layers:new Set(r),listener:u,delegates:{mousemove:v,mouseout:x}}}{const m=v=>{const x=r.filter(A=>this.getLayer(A)),M=x.length?this.queryRenderedFeatures(v.point,{layers:x}):[];M.length&&(v.features=M,u.call(this,v),delete v.features)};return{layers:new Set(r),listener:u,delegates:{[p]:m}}}}on(p,r,u){if(void 0===u)return super.on(p,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(p,r,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(p,r,u){if(void 0===u)return super.once(p,r);Array.isArray(r)||(r=[r]);const m=this._createDelegatedListener(p,r,u);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(p,r,u){if(void 0===u)return super.off(p,r);r=new Set(Array.isArray(r)?r:[r]);const m=(x,M)=>{if(x.size!==M.size)return!1;for(const A of x)if(!M.has(A))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[p]:void 0;return v&&(x=>{for(let M=0;M<x.length;M++){const A=x[M];if(A.listener===u&&m(A.layers,r)){for(const T in A.delegates)this.off(T,A.delegates[T]);return x.splice(M,1),this}}})(v),this}queryRenderedFeatures(p,r){return this.style?(void 0!==r||void 0===p||p instanceof d.pointGeometry||Array.isArray(p)||(r=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(p,r){return this.style.querySourceFeatures(p,r)}queryTerrainElevation(p,r){const u=this.transform.elevation;return u?(r=d.extend({},{exaggerated:!0},r),u.getAtPoint(d.MercatorCoordinate.fromLngLat(p),null,r.exaggerated)):null}setStyle(p,r){return!1!==(r=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(null==r)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new En(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new En(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,r){if("string"==typeof p){const u=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(u,d.ResourceType.Style);d.getJSON(m,(v,x)=>{v?this.fire(new d.ErrorEvent(v)):x&&this._updateDiff(x,r)})}else"object"==typeof p&&this._updateDiff(p,r)}_updateDiff(p,r){try{this.style.setState(p)&&this._update(!0)}catch(u){d.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(p,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.warnOnce("There is no style added to the map."),!1)}addSource(p,r){return this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const r in p){const u=p[r]._tiles;for(const m in u){const v=u[m];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(p,r,u){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,u)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,r,{pixelRatio:u=1,sdf:m=!1,stretchX:v,stretchY:x,content:M}={}){if(this._lazyInitEmptyStyle(),r instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&r instanceof d.window.ImageBitmap){const{width:A,height:T,data:D}=d.exported.getImageData(r);this.style.addImage(p,{data:new d.RGBAImage({width:A,height:T},D),pixelRatio:u,stretchX:v,stretchY:x,content:M,sdf:m,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:T}=r,D=r;this.style.addImage(p,{data:new d.RGBAImage({width:A,height:T},new Uint8Array(D.data)),pixelRatio:u,stretchX:v,stretchY:x,content:M,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,p)}}updateImage(p,r){const u=this.style.getImage(p);if(!u)return void this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&r instanceof d.window.ImageBitmap?d.exported.getImageData(r):r,{width:v,height:x}=m;void 0!==v&&void 0!==x?v===u.data.width&&x===u.data.height?(u.data.replace(m.data,!(r instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&r instanceof d.window.ImageBitmap)),this.style.updateImage(p,u)):this.fire(new d.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${x})\n                must be that same as the previous version of the image\n                (${u.data.width}, ${u.data.height})`))):this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,r){d.getImage(this._requestManager.transformRequest(p,d.ResourceType.Image),(u,m)=>{r(u,m instanceof d.window.HTMLImageElement?d.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(p,r){return this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)}moveLayer(p,r){return this.style.moveLayer(p,r),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,r,u){return this.style.setLayerZoomRange(p,r,u),this._update(!0)}setFilter(p,r,u={}){return this.style.setFilter(p,r,u),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,r,u,m={}){return this.style.setPaintProperty(p,r,u,m),this._update(!0)}getPaintProperty(p,r){return this.style.getPaintProperty(p,r)}setLayoutProperty(p,r,u,m={}){return this.style.setLayoutProperty(p,r,u,m),this._update(!0)}getLayoutProperty(p,r){return this.style.getLayoutProperty(p,r)}setLight(p,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(p),this.transform):0}setFeatureState(p,r){return this.style.setFeatureState(p,r),this._update()}removeFeatureState(p,r){return this.style.removeFeatureState(p,r),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let u,m,v,x=this._container;for(;x&&(!m||!v);){const M=d.window.getComputedStyle(x).transform;M&&"none"!==M&&(u=M.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(m=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(v=u[3])),x=x.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=v?Math.abs(r/v):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ae("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Ae("div","mapboxgl-canvas-container",p);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=Ae("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Ae("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=Ae("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const u=d.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(p),this._canvas.height=u*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);-1!==r&&this._markers.splice(r,1)}_setupPainter(){const p=d.extend({},hr.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);r?(d.storeAuthState(r,!0),this.painter=new Du(r,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(r)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;const u=this.painter.context.extTimerQuery,m=d.exported.now();if(this.listens("gpu-timing-frame")&&(r=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let v=!1;const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const T=this.transform.zoom,D=this.transform.pitch,O=d.exported.now();this.style.zoomHistory.update(T,O);const R=new d.EvaluationParameters(T,{now:O,fadeDuration:x,pitch:D,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),V=R.crossFadingFactor();1===V&&V===this._crossFadingFactor||(v=!0,this._crossFadingFactor=V),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerUpdate()):M=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const T=d.exported.now()-m;u.endQueryEXT(u.TIME_ELAPSED_EXT,r),setTimeout(()=>{const D=u.getQueryObjectEXT(r,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(r),this.fire(new d.Event("gpu-timing-frame",{cpuTime:T,gpuTime:D})),d.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:D}})},50)}if(this.listens("gpu-timing-layer")){const T=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(T);this.fire(new d.Event("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(T);this.fire(new d.Event("gpu-timing-deferred-render",{gpuTime:D}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(A||this._repaint)this.triggerRepaint();else{const T=!this.isMoving()&&this.loaded();if(T&&(M=this._updateAverageElevation(m,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,r=!1){const u=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const m=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const M=Math.abs(m-v);if(M>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,p,300)}else if(M>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(p)&&u(this._averageElevation.getValue(p))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===d.AUTH_ERR_MSG||401===p.status)){const r=this.painter.context.gl;d.storeAuthState(r,!1),this._logoControl instanceof ju&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function v(x){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,x,0);const M=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,M),M}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(v(p),r.canvasCopies.map(v),r.timeStamps)}_canvasPixelComparison(p,r,u){let m=u[1]-u[0];const v=p.length/4;for(let x=0;x<r.length;x++){const M=r[x];let A=0;for(let T=0;T<M.length;T+=4)M[T]===p[T]&&M[T+1]===p[T+1]&&M[T+2]===p[T+2]&&M[T+3]===p[T+3]&&(A+=1);m+=(u[x+2]-u[x+1])*(1-A/v)}return m}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),da(this._canvasContainer),da(this._controlContainer),da(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=d.exported.frame(r=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(r)}))}_preloadTiles(p){const r=this.style?Object.values(this.style._sourceCaches):[];return d.asyncAll(r,(u,m)=>u._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,r){d.setCacheLimits(p,r)}get version(){return d.version}},NavigationControl:class{constructor(p){this.options=d.extend({},Tc,p),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),Ae("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),Ae("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:r}):u.resetNorth({},{originalEvent:r}))}),this._compassIcon=Ae("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),u=r===p.getMaxZoom(),m=r===p.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ec(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const u=Ae("button",p,this._container);return u.type="button",u.addEventListener("click",r),u}_setButtonTitle(p,r){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",u),p.firstElementChild&&p.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends d.Evented{constructor(p){super(),this.options=d.extend({geolocation:d.window.navigator.geolocation},Hu,p),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ra(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(r=>{this._supportsGeolocation="denied"!==r.state,p(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,p(this._supportsGeolocation))}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),u=p.coords;return!!r&&(u.longitude<r.getWest()||u.longitude>r.getEast()||u.latitude<r.getSouth()||u.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",p)),this._finish()}}_updateCamera(p){const r=new d.LngLat(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,m=this._map.getBearing(),v=d.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(u),v,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new d.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=d.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,u=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Ae("button","mapboxgl-ctrl-geolocate",this._container),Ae("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae("div","mapboxgl-user-location"),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ae("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ha({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ae("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ha({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientation),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ac,ScaleControl:class{constructor(p){this.options=d.extend({},kc,p),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Dc.bind(this)),d.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,u=r._containerHeight/2,m=r._containerWidth/2-p/2,v=r.unproject([m,u]),x=r.unproject([m+p,u]),M=v.distanceTo(x);if("imperial"===this.options.unit){const A=3.2808*M;A>5280?this._setScale(p,A/5280,"mile"):this._setScale(p,A,"foot")}else"nautical"===this.options.unit?this._setScale(p,M/1852,"nautical-mile"):M>=1e3?this._setScale(p,M/1e3,"kilometer"):this._setScale(p,M,"meter")}_setScale(p,r,u){const m=Do(r),v=m/r;this._map._requestDomTask(()=>{this._container.style.width=p*v+"px",this._container.innerHTML="nautical-mile"!==u?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:u}).format(m):`${m}&nbsp;nm`})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof d.window.HTMLElement?this._container=p.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=Ae("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ae("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(p){super(),this.options=d.extend(Object.create(jh),p),d.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=d.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(d.window.document.createTextNode(p))}setHTML(p){const r=d.window.document.createDocumentFragment(),u=d.window.document.createElement("body");let m;for(u.innerHTML=p;m=u.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=Ae("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const u=this._closeButton=Ae("button","mapboxgl-popup-close-button",r);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,u=this._container,m=this._pos;if(!r||!u||!m)return"bottom";const v=u.offsetWidth,x=u.offsetHeight,M=m.x<v/2,A=m.x>r.transform.width-v/2;if(m.y+p<x)return M?"top-left":A?"top-right":"top";if(m.y>r.transform.height-x){if(M)return"bottom-left";if(A)return"bottom-right"}return M?"left":A?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,u=this._content;if(!r||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=Ae("div","mapboxgl-popup",r.getContainer()),this._tip=Ae("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zr(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p?p:r.project(this._lngLat),x=pa(this.options.offset),M=this._anchor=this._getAnchor(x.y),A=pa(this.options.offset,M),T=v.add(A).round();r._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${ua[M]} translate(${T.x}px,${T.y}px)`)})}if(!this._marker&&r._showingGlobe()){const v=d.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(qh);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:ha,Style:En,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:Yt,Evented:d.Evented,config:d.config,prewarm:function(){Ge().acquire(te)},clearPrewarmedResources:function(){const p=ve;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(te),ve=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(p){d.config.ACCESS_TOKEN=p},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(p){d.config.API_URL=p},get workerCount(){return oe.workerCount},set workerCount(p){oe.workerCount=p},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){d.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){d.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return fa}),Vt}()}}]);